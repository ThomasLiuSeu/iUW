// Copyright (c) 2009-2014 SAP SE, All Rights Reserved
(function(){"use strict";jQuery.sap.declare("sap.ushell.components.factsheet.factory.ThingInspector");sap.ushell.components.factsheet.factory=(function(){jQuery.sap.require("sap.suite.ui.commons.UnifiedThingInspector");jQuery.sap.require("sap.ushell.components.factsheet.annotation.Mapping");jQuery.sap.require("sap.ui.vbm.library");var t,M={},g,c,d,f,h,q,r,s,u,v={},w,x,y,z,A,B,C,D,E,F,G,H,I,J,L,K,N,O,P,Q,R,S,T="displayFactSheet";jQuery.sap.require("sap.ui.base.Object");jQuery.sap.require("sap.ui.core.format.NumberFormat");L=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale();if(sap.ui.getCore().getConfiguration().getLanguage()==="ZH"){L=new sap.ui.core.Locale("zh_CN");}function U(a){return a<0?true:false;}function V(a){var b=Number(a).toFixed(0);if(U(a)){b=Number(b)*-1;}return b;}function W(a,b){var e,o,i,n;if(!a){return"";}o=new RegExp(sap.ui.core.format.NumberFormat.oDefaultFloatFormat.groupingSeparator,"g");if(b>=0){b=parseInt(b,10);n=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:b,maxFractionDigits:b},L);}else{n=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:0,maxFractionDigits:99},L);}e=n.format(a);i=e.replace(/[\D]/g,"");if(i&&i.length>6){a=a.replace(o,"");if(V(a)<1000){return sap.ui.core.format.NumberFormat.getIntegerInstance().format(a);}n=sap.ui.core.format.NumberFormat.getFloatInstance({minFractionDigits:1,maxFractionDigits:1,style:"short"},L);return n.format(a);}else{return e;}}function X(){var p,a,o="",b,m,e,k,i,j,n,l,Y;b=this.getElementBinding().sPath.split("/")[1];m=this.getModel();e=this.mBindingInfos.value.parameters;k=this.mBindingInfos.value.parts;for(i=0;i<e.length;i+=1){o=o+e[i].string;}for(j=0;j<k.length;j+=1){p=k[j].path;l="{"+p+"}";a=m.oData[b][p];o=o.replace(l,a);}n=w(o);if($.isNumeric(n)){Y=this.mBindingInfos.value.parts.filter(function(Z){return(Z.path===p);});n=W(n,Y[0].type.oFormatOptions.maxFractionDigits);this.setDoubleFontSize(true);}this.setValue(n);this.getElementBinding().detachChange(X);}Q=function(){var a="";if(t.getName()&&t.getDescription()){a=t.getName()+", "+t.getDescription();}else if(t.getName()&&!t.getDescription()){a=t.getName();}else if(!t.getName()&&t.getDescription()){a=t.getDescription();}return a;};g=function(a){var b,e,i;b=a.slice(1).split("/");e="/";for(i=0;i<b.length;i+=1){if((b[i].indexOf("(")>0)&&(b[i].indexOf("sid(")<0)){break;}else{e+=b[i]+"/";}}return e;};c=function(a,m){var e,b,i,n;b=a.slice(m.sServiceUrl.length+1);if(b.indexOf("/")>=0){i=b.split("/");n=i[i.length];e=i[i.length-1];if(e.indexOf("(")>=0){e=e.slice(e.indexOf("("));}e=this.getNavEntitySet(e,n,m.getMetadata());}else{if(b.indexOf("(")>=0){e=b.slice(0,b.indexOf("("));}else{if(b.indexOf("?")>=0){e=b.slice(0,b.indexOf("?"));}else{e=b;}}}return e;};z=function(a,m){var e,k="",o,b;e=a.slice(m.sServiceUrl.length+1);if(e.indexOf("(")>=0){k=e.slice(e.indexOf("(")+1,e.indexOf(")"));if(k.indexOf("=")<=0){o=m.getServiceMetadata();b=f(c(a,m),o);k=A(b,o)+"="+k;}}return k;};A=function(e,m){var i,a,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.namespace===e.slice(0,e.lastIndexOf("."))){for(j=0;j<a.entityType.length;j+=1){if(a.entityType[j].name===e.slice(e.lastIndexOf(".")+1)){return a.entityType[j].key.propertyRef[0].name;}}}}};d=function(e,m){var i,a,b,j;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){b=a.entityContainer[0].entitySet;for(j=b.length-1;j>=0;j-=1){if(b[j].entityType===e){return b[j].name;}}}}};f=function(e,m,b){var i,a,k,j,l;for(i=m.dataServices.schema.length-1;i>=0;i-=1){a=m.dataServices.schema[i];if(a.entityContainer){k=a.entityContainer[0].entitySet;for(j=k.length-1;j>=0;j-=1){if(k[j].name===e){if(b){l=k[j].entityType.slice(a.namespace.length+1);}else{l=k[j].entityType;}return l;}}}}};h=function(e,n,m){var a,i,b,l,k,j,o;a=e.split(".");for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];l=a[0];if(a.length>2){for(k=1;k<a.length-1;k+=1){l+="."+a[k];}}if(b.namespace===l){for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===a[a.length-1]){if(b.entityType[j].navigationProperty){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){o=b.entityType[j].navigationProperty[k];return{name:o.relationship,toRole:o.toRole};}}}}}}}};q=function(e,n,m){var a,b,o,i,l,j,p,k;a=f(e,m);if(n.charAt(0)==="@"){if(M.termDefinitions&&M.termDefinitions[n]){b=M.termDefinitions[n];if(b.indexOf("Collection")>=0){b=b.slice(b.indexOf("(")+1,b.indexOf(")"));}return d(b,m);}}else{o=h(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){l=m.dataServices.schema[i];if(l.entityContainer&&l.entityContainer[0].associationSet){for(j=l.entityContainer[0].associationSet.length-1;j>=0;j-=1){p=l.entityContainer[0].associationSet[j];if(p.association===o.name){for(k=0;k<p.end.length;k+=1){if(p.end[k].role===o.toRole){return p.end[k].entitySet;}}}}}}}}};r=function(e,n,m){var a,o,i,b,j,l,k,p,Y;a=f(e,m);p=a.split(".")[a.split(".").length-1];o=h(a,n,m);if(o){for(i=m.dataServices.schema.length-1;i>=0;i-=1){b=m.dataServices.schema[i];for(j=0;j<b.entityType.length&&!Y;j+=1){if(b.entityType[j].name===p){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===n){Y=b.entityType[j].navigationProperty[k].toRole;break;}}}}for(j=b.association.length-1;j>=0;j-=1){l=b.association[j];if(b.namespace+"."+l.name===o.name){for(k=0;k<l.end.length;k+=1){if(l.end[k].role===Y){return l.end[k].multiplicity;}}}}}}else{jQuery.sap.log.error("\""+n+"\" wasn't found in the metadata document. Check whether the corresponding search connector is active.");return 0;}};s=function(e,m){var o,a,b,i;o={};if(M.expand){if(M.expand[f(e,m)]){a=M.expand[f(e,m)];b=[];for(i in a){if(a.hasOwnProperty(i)){b.push(a[i]);}}o.expand=b.join(", ");}}return o;};S=function(a,e,o){var m,b,j,k,l,n;for(m=o.dataServices.schema.length-1;m>=0;m-=1){b=o.dataServices.schema[m];for(j=0;j<b.entityType.length;j+=1){if(b.entityType[j].name===e.split(".")[e.split(".").length-1]){for(k=0;k<b.entityType[j].navigationProperty.length;k+=1){if(b.entityType[j].navigationProperty[k].name===a){for(l=0;l<b.association.length;l+=1){for(n=b.association[l].end.length-1;n>=0;n-=1){if(b.association[l].end[n].role===b.entityType[j].navigationProperty[k].toRole){return(b.association[l].end[n].type);}}}}}}}}};u=function(p,o){var b={},j;b.parts=[];b.parameters=[];for(j=p.length-1;j>=0;j-=1){if(p[j].Type==="Path"){if(p[j].EdmType){switch(p[j].EdmType){case"Edm.DateTimeOffset":case"Edm.DateTime":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.DateTime()});break;case"Edm.Time":b.parts.push({path:p[j].Value+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})});break;case"Edm.Date":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Date()});break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Float()});break;case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":b.parts.push({path:p[j].Value,type:new sap.ui.model.type.Integer()});break;default:b.parts.push({path:p[j].Value});break;}}else{b.parts.push({path:p[j].Value});}}else if(p[j].Type==="String"){b.parameters.unshift({string:p[j].Value});}}b.formatter=function(){var a="",e,k,l,i,m="",n=false,Y=0,Z=0;if(arguments&&arguments.length>=1){e=arguments.length-1;l="";i=0;if(p&&p[0]&&(p[0].Type==="String")&&(p[0].Value.substr(0,1)==="#")){n=true;}for(k=0;k<p.length;k+=1){if(p[k].Type==="Path"){l=arguments[e];if(!l||(l.length===0)){if(a.length>i){if(a.indexOf("(")>i){a=a.substr(0,i);}else{a=a.substr(0,i);l=a;}}}else{if(n){l=encodeURIComponent(l);}a+=l;Y+=1;}e-=1;i=a.length;}else{i=a.length;m=p[k].Value;if(m.indexOf("(")!==-1){Z+=1;}if((l&&l.length>0)||(m.indexOf("(")!==-1)||(m&&(m.substr(0,1)==="#"))){a+=p[k].Value;}else{m="";}}}if(o){a=o(a);}a=a.trim();if((Y===1)&&(Z>0)&&(a.substr(0,1)==="(")&&(a.substr(-1)===")")){a=a.substr(1,a.length-2);}return a.trim();}};return b;};F=function(o,p){var k;for(k in o){if(o.hasOwnProperty(k)){if(k==="__metadata"){continue;}else if(k===p){return o[k];}else if(typeof o[k]==="object"){return F(o[k],p);}}}};w=function(a){var l,n,b,e={},i;l=a.lastIndexOf("/");n=a.slice(0,l);b=a.slice(l+1);if(!v[a]){e=new sap.ui.model.json.JSONModel();e.loadData(n,null,false);v[a]=e.getData();}else{e=v[a];}if(v[a]&&v[a].d){if(!v[a].d[b]){i=F(v[a].d,b);}else{i=v[a].d[b];}}return i;};x=function(o,e,m){var a,b,n,i;a=new sap.ui.core.Control();b=G(o.Value,o.EdmType,e);if(o.Value&&o.Value["com.sap.vocabularies.UI.v1.IsImageURL"]){a=new sap.m.Image({height:"50px"});if(b.BindingInfo){a.bindProperty("src",b.BindingInfo);}else{a.setProperty("src",b.String);}}else{if(o.UrlRef||o.Url||(o.Target&&o.Target.Path)){a=new sap.m.Link({wrapping:true});}else{a=new sap.m.Text();if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a.setTextAlign(sap.ui.core.TextAlign.End);}}a.addStyleClass("sapFactsheetUtiDataField");if(b.BindingInfo){a.bindProperty("text",b.BindingInfo);}else{a.setProperty("text",b.String);}}if((o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithNavigation")&&m){n=o.Target.Path;if(M[e][n.slice(1)]){if(n.charAt(0)==="@"){if(n.indexOf("/")<0){i=M[e][n.slice(1)].UrlRef;}else{i=M[e][n.slice(1,n.indexOf("/"))].UrlRef;}a.bindProperty("href",B(i));}}a.attachPress(function(j){return false;});}if(o.RecordType==="com.sap.vocabularies.UI.v1.DataFieldWithUrl"){if(o.Url.String){a.setHref(o.Url.String);}else{a.bindProperty("href",B(o.Url));}}return a;};y=function(o,l,p,b){var a,e="",i="",m,j,k,n;a=new sap.m.Label(l);a.addStyleClass("sapFactsheetUtiLabel");if(b){e=":";}if(o.Label){if(o.Label.String){a.setText(o.Label.String.trim()+e);a.setTooltip(o.Label.String.trim());}else{if(o.Label.Path){a.bindProperty("text",o.Label.Path);a.bindProperty("tooltip",o.Label.Path);}}}else{if(o.Value){if(o.Value.Path&&p){m=p[o.Value.Path];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}}else if(o.Value.Apply&&(o.Value.Apply.Name==="odata.concat")){for(k in o.Value.Apply.Parameters){if(o.Value.Apply.Parameters.hasOwnProperty(k)){n=o.Value.Apply.Parameters[k];if(n.Type==="Path"){m=p[n.Value];for(j in m){if(m.hasOwnProperty(j)){if(j==="http://www.sap.com/Protocols/SAPData"){if(m[j].label){i=m[j].label;break;}}}}break;}}}}a.setText(i+e);a.setTooltip(i);}}return a;};G=function(o,e,a){var b={},p,k,l=[],j,m,n,Y=[],Z,_,i,a1,b1,c1,d1,e1=[],f1;f1=function(a,g1,h1){var p,i1={};p=M.propertyAnnotations[a];if(p&&p[g1]&&p[g1][h1]){if(p[g1][h1].Path){i1.Type="Path";i1.Value=p[g1][h1].Path;}else{i1.Type="String";i1.Value=p[g1][h1].String;}}return i1;};if(!o){return false;}if(o.Apply){if(o.Apply.Name==="odata.concat"){if(a&&M.propertyAnnotations&&M.propertyAnnotations[a]){k=o.Apply.Parameters;for(j=0;j<k.length;j+=1){l.push(k[j]);if(k[j].Type==="Path"){p=f1(a,k[j].Value,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}p=f1(a,k[j].Value,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){l.push({Type:"String",Value:" "});l.push({Type:p.Type,Value:p.Value});}}}b.BindingInfo=u(l);}else{b.BindingInfo=u(o.Apply.Parameters);}}}else{if(o.Path){if(o.Path.charAt(0)==="@"){m=M[a][o.Path.slice(1,o.Path.indexOf("/"))].UrlRef;n=o.Path.slice(o.Path.indexOf("/")+1);if(m&&m.Apply){Z=m.Apply.Parameters;switch(m.Apply.Name){case"odata.concat":Y=Z;Y.push({Type:"String",Value:"/"+n});break;case"odata.fillUriTemplate":_=Z[0].Value.split("{");for(i in _){if(_.hasOwnProperty(i)){if(_[i].indexOf("}")<0){Y.push({Type:"String",Value:_[i]});}else{a1=_[i].split("}");for(j=1;j<Z.length;j+=1){if(Z[j].Name===a1[0]){b1=Z[j].Value;if(b1.Path){Y.push({Type:"Path",Value:b1.Path});}else{if(b1.Apply&&b1.Apply.Name&&(b1.Apply.Name.toLowerCase()==="odata.uriencode")){c1=b1.Apply.Parameters[0];Y.push({Type:c1.Type,Value:encodeURIComponent(c1.Value)});Y.push({Type:"String",Value:"{"+encodeURIComponent(c1.Value)+"}"});}}}}Y.push({Type:"String",Value:a1[1]});}}}Y.push({Type:"String",Value:"/"+n});b.fnChange=X;break;default:break;}b.BindingInfo=u(Y,w);}else{if(m&&m.Path){Y.push({Type:"Path",Value:m.Path},{Type:"String",Value:"/"+n});b.BindingInfo=u(Y,w);}else{if(m&&m.String){b.String=w(m.String+"/"+n);}}}}else{b.BindingInfo={};switch(e){case"Edm.DateTimeOffset":case"Edm.DateTime":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.DateTime()};break;case"Edm.Time":b.BindingInfo={path:o.Path+"/ms",type:new sap.ui.model.type.Time({source:{pattern:"timestamp"}})};break;case"Edm.Date":b.BindingInfo={path:o.Path,type:new sap.ui.model.type.Date()};break;case"Edm.Decimal":case"Edm.Double":case"Edm.Single":case"Edm.Int16":case"Edm.Int32":case"Edm.Int64":if((e==="Edm.Decimal")||(e==="Edm.Double")||(e==="Edm.Single")){d1=new sap.ui.model.type.Float();}else if((e==="Edm.Int16")||(e==="Edm.Int32")||(e==="Edm.Int64")){d1=new sap.ui.model.type.Integer();}if(M.propertyAnnotations){e1.push({Type:"Path",Value:o.Path,EdmType:e},{Type:"String",Value:" "});p=f1(a,o.Path,"Org.OData.Measures.V1.ISOCurrency");if(!$.isEmptyObject(p)){e1.push({Type:p.Type,Value:p.Value});}p=f1(a,o.Path,"Org.OData.Measures.V1.Unit");if(!$.isEmptyObject(p)){e1.push({Type:p.Type,Value:p.Value});}b.BindingInfo=u(e1);}else{b.BindingInfo={path:o.Path,type:d1};}break;default:b.BindingInfo={path:o.Path};break;}}}else{if(o.String){b.String=o.String;}}}return b;};B=function(o){var a=[],p,b,j,e,i={},k,l,m;if(o&&o.Apply){p=o.Apply.Parameters;switch(o.Apply.Name){case"odata.fillUriTemplate":p[0].Value=p[0].Value.trim();b=p[0].Value.split("{");for(j=0;j<b.length;j+=1){if(b[j].indexOf("}")<0){a.push({"Value":b[j],"Type":"String"});}else{e=b[j].split("}");i={};i.Value=e[0];i.Type="Path";for(j=1;j<p.length;j+=1){if(p[j].Name===i.Value){k=p[j].Value;if(k.Path){i.Value=k.Path;}else{if(k.Apply&&k.Apply.Name&&k.Apply.Name.toLowerCase()==="odata.uriencode"){i.Value=k.Apply.Parameters[0].Value;}}break;}}a.push(i);a.push({"Value":e[1],"Type":"String"});}}l=sap.ushell.Container.getService("NavTargetResolution").getCurrentResolution();if(l&&l.url){m=jQuery.sap.getUriParameters(l.url).get("sap-system");if(m){a.push({Type:"String",Value:"&sap-system="+m});}}break;default:break;}}return u(a);};C=function(o){var a=sap.ui.core.TextAlign.Begin;if(o.EdmType==="Edm.Decimal"||o.EdmType==="Edm.Double"||o.EdmType==="Edm.Single"||o.EdmType==="Edm.Int16"||o.EdmType==="Edm.Int32"||o.EdmType==="Edm.Int64"){a=sap.ui.core.TextAlign.End;}return a;};H=function(m,e,a,o,b){var k,p,j=0,l=0,n=0,Y=0,Z,i,_,a1,b1;if(!b){b=m.getServiceMetadata();}if(!a){a=[];}k=f(e,b);b1=new sap.ui.layout.form.SimpleForm({labelMinWidth:150,maxContainerCols:2});p=(M.propertyExtensions)?M.propertyExtensions[k]:[];if(o&&o.High){l=o.High;}if(o&&o.Medium){n=o.Medium;}if(o&&o.Low){Y=o.Low;}for(i=0;i<a.length;i+=1){Z=R(a[i]);if(o&&(Z==="High")){if(l){l-=1;}else{continue;}}else if(o&&(Z==="Medium")){if(n){n-=1;}else{continue;}}else if(o&&(Z==="Low")){if(Y){Y-=1;}else{continue;}}if(o&&o.Total&&(j>=o.Total)){break;}j+=1;_=new sap.ui.core.Control().setModel(m);a1=y(a[i],{textAlign:sap.ui.core.TextAlign.End},p,false);a1.addStyleClass("sapFactsheetUtiFormPadding");_=x(a[i],k,b);_.addStyleClass("sapFactsheetUtiFormPadding");if(_.setTextAlign){_.setTextAlign(sap.ui.core.TextAlign.Begin);}b1.addContent(a1);b1.addContent(_);}b1.addStyleClass("sapFactsheetUtiFormLayout");return b1;};I=function(m,e,o,b){var a,j="",k,n,l,p,Y,Z,_,a1,b1,c1,d1=[],i,e1,f1,g1;a=m.getServiceMetadata();switch(o.RecordType){case"com.sap.vocabularies.UI.v1.ReferenceFacet":k=new sap.suite.ui.commons.UnifiedThingGroup();if(o.Label&&o.Label.String){k.setTitle(o.Label.String);}n=o.Target.AnnotationPath;l=n.substring(n.lastIndexOf("@")+1);n=n.substring(0,n.lastIndexOf("@")-1);if(n){j=r(e,n,a);}p=l.split("#");switch(p[0]){case"com.sap.vocabularies.UI.v1.LineItem":case"com.sap.vocabularies.UI.v1.Chart":case"com.sap.vocabularies.UI.v1.Badge":case"com.sap.vocabularies.UI.v1.Identification":if(n){Y=q(e,n,a);e1=f(Y,a);}else{e1=f(e,a);}if(p[0]==="com.sap.vocabularies.UI.v1.Chart"){l="com.sap.vocabularies.UI.v1.LineItem";}f1=M[e1][l];if(M.propertyExtensions){g1=M.propertyExtensions[e1];}if(j==="*"&&p[0]!=="com.sap.vocabularies.UI.v1.Identification"){Z=J(m,f1,e1,a,b+"/"+n,o,g1);k.setContent(Z);}if(p[0]==="com.sap.vocabularies.UI.v1.Identification"){_=M[e1]["com.sap.vocabularies.UI.v1.Identification"];a1=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(m);if(n){a1.addContent(H(m,Y,_)).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n);}else{a1.addContent(H(m,e,_).addStyleClass("sapFactsheetUtiPanel"));}k.setContent(a1);}break;case"com.sap.vocabularies.UI.v1.StatusInfo":if(n){Y=q(e,n,a);b1=M[f(Y,a)]["com.sap.vocabularies.UI.v1.StatusInfo"];k.setContent(H(m,Y,b1).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{b1=M[f(e,a)]["com.sap.vocabularies.UI.v1.StatusInfo"];k.setContent(H(m,e,b1).addStyleClass("sapFactsheetUtiPanel"));}break;case"com.sap.vocabularies.UI.v1.FieldGroup":c1=M[f(e,a)][l];if(c1){if(!k.getTitle()||(k.getTitle()==="")){if(c1.Label){if(c1.Label.String){k.setTitle(c1.Label.String);}else{if(c1.Label.Path){k.bindProperty("title",c1.Label.Path);}}}}if(n){Y=q(e,n,a);k.setContent(H(m,Y,c1.Data).addStyleClass("sapFactsheetUtiPanel").bindElement(b+"/"+n));}else{k.setContent(H(m,e,c1.Data).addStyleClass("sapFactsheetUtiPanel"));}}break;default:break;}return k;case"com.sap.vocabularies.UI.v1.ReferenceURLFacet":k=new sap.ui.ux3.ThingGroup({title:o.Label.String});k.setContent(D(o));return k;case"com.sap.vocabularies.UI.v1.CollectionFacet":for(i=0;i<o.Facets.length;i+=1){d1.push(I(m,e,o.Facets[i],b));}return d1;default:break;}};D=function(o){var i,a,b;switch(o.UrlContentType.String){case"image/png":case"image/jpeg":case"image/gif":i=new sap.m.Image({width:"100%"});if(o.Url.String){i.setSrc(o.Url.String);}return i;default:a=new sap.ui.core.HTML();if(o.Url.String){a.setContent("<iframe src = '"+o.Url.String+"' width='100%' height='250px' frameborder='0'></iframe>");}else{if(o.Url.Path){a.bindProperty("content",{path:o.Url.Path,formatter:function(e){b="<iframe src = '"+o.Url.Path+"' width='100%' height='250px' frameborder='0'></iframe>";return b;}});}}return a;}};J=function(m,a,e,o,b,l,n){var Y,Z,_,a1,b1,i,k,c1=[],d1=[],e1=[],f1=[],g1,h1,i1,j1,k1,l1,m1,n1=[],o1,p1,q1,r1=[],s1,t1,u1,v1,w1,x1,y1,z1,A1,B1=false,C1,D1;A1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");if(!o){o=m.getServiceMetadata();}Y=(M.propertyExtensions)?M.propertyExtensions[e]:[];Z=6;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){Z=5;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){Z=4;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){Z=3;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){Z=2;}_=0;a1=0;for(i=0;i<a.length;i+=1){b1=R(a[i]);if(b1==="High"){_+=1;}}if(Z>_){a1=Z-_;}else if(Z<_){_=Z;}d1.push(new sap.m.Column({visible:false}));c1.push(new sap.m.Text().bindText("__metadata/uri"));for(i=0;i<a.length;i+=1){D1="";i1=new sap.ui.core.Control();b1=R(a[i]);i1=x(a[i],e,o);g1=y(a[i],null,Y);if(a[i].Value.Path){q1=a[i].Value.Path;if(n&&n[q1]&&n[q1]["http://www.sap.com/Protocols/SAPData"]&&n[q1]["http://www.sap.com/Protocols/SAPData"].sortable){g1.data("IsSortable",n[q1]["http://www.sap.com/Protocols/SAPData"].sortable);if(n[q1]["http://www.sap.com/Protocols/SAPData"].sortable==="true"){B1=true;}}else{g1.data("IsSortable","true");B1=true;}if(n&&n[q1]&&n[q1]["http://www.sap.com/Protocols/SAPData"]&&n[q1]["http://www.sap.com/Protocols/SAPData"].filterable){g1.data("IsFilterable",n[q1]["http://www.sap.com/Protocols/SAPData"].filterable);if(n[q1]["http://www.sap.com/Protocols/SAPData"].filterable==="true"){B1=true;}}else{g1.data("IsFilterable","true");B1=true;}}else{C1=true;for(k=0;k<a[i].Value.Apply.Parameters.length;k+=1){if(a[i].Value.Apply.Parameters[k].Type==="Path"){q1=a[i].Value.Apply.Parameters[k].Value;if(n[q1]&&n[q1]["http://www.sap.com/Protocols/SAPData"]&&n[q1]["http://www.sap.com/Protocols/SAPData"].sortable){if(n[q1]["http://www.sap.com/Protocols/SAPData"].sortable==="false"){C1=false;D1="";break;}}if(D1){D1+=";";}D1+=q1;}}q1=D1;if(C1===false){g1.data("IsSortable","false");}else{g1.data("IsSortable","true");B1=true;}g1.data("IsFilterable","false");}if(a[i].EdmType){g1.data("EdmType",a[i].EdmType);}g1.data("ColumnName",q1);e1.push(g1);f1.push(i1);if(b1==="High"){if(_>0){h1=true;_-=1;}else{h1=false;}}else if(b1==="Medium"){if(a1>0){h1=true;a1-=1;}else{h1=false;}}else{h1=false;}d1.push(new sap.m.Column({header:g1,hAlign:C(a[i]),visible:h1}));c1.push(i1);}j1=new sap.m.ColumnListItem({type:sap.m.ListType.Navigation,unread:false,cells:c1});if(l){k1=l.Label.String;}j1.attachPress({aColumns:a,aLabels:e1,aControls:f1,sTitle:k1},function(j,p){var E1={},F1,G1,g1,i,H1,I1;E1.items={};F1=j.getSource().getCells()[0].getText().substr(j.getSource().getCells()[0].getText().lastIndexOf("/"));G1=new sap.m.Table({backgroundDesign:sap.m.BackgroundDesign.Transparent,showSeparators:sap.m.ListSeparators.None,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.End}),new sap.m.Column()]});G1.addStyleClass("sapFactsheetUtiPanel");G1.addStyleClass("sapFactsheetUtiTilePadding");G1.addStyleClass("sapFactsheetUtiTableNoTopBorder");G1.bindElement(F1);for(i=0;i<a.length;i+=1){g1=e1[i].clone();g1.setText(g1.getText()+":");G1.addItem(new sap.m.ColumnListItem({cells:[g1,f1[i].clone()]}));}H1=new sap.suite.ui.commons.UnifiedThingGroup({content:G1,title:k1,description:Q()});I1=new sap.m.Page({title:t.getTitle(),showNavButton:true,content:[H1]});t.navigateToPage(I1,true);});l1=new sap.m.Table({growing:true,columns:d1});l1.setModel(m);l1.bindItems({path:b,template:j1});t1=new sap.m.VBox({items:[new sap.m.Input({placeholder:A1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,E1,F1,G1,i;p=j.getSource().getParent().getParent().getId();E1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));F1=E1.getFilterItems();for(i=0;i<F1.length;i+=1){if(F1[i]instanceof sap.m.ViewSettingsCustomItem&&F1[i].getKey()===this.oParent.data("ColumnName")){G1=F1[i];break;}}if(G1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){G1.setSelected(false);G1.setFilterCount(0);}else{G1.setSelected(true);G1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});u1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_GREATER_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_EQUALS")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_LESS_THEN")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.Input({placeholder:A1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,E1,F1,G1,i;p=j.getSource().getParent().getParent().getId();E1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));F1=E1.getFilterItems();for(i=0;i<F1.length;i+=1){if((F1[i]instanceof sap.m.ViewSettingsCustomItem)&&(F1[i].getKey()===this.oParent.data("ColumnName"))){G1=F1[i];break;}}if(G1){if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){G1.setSelected(false);G1.setFilterCount(0);}else{G1.setSelected(true);G1.setFilterCount(1);}}}}).addStyleClass("sapFactsheetUtiFilterInput")]});v1=new sap.m.VBox({items:[new sap.m.List({mode:sap.m.ListMode.SingleSelectLeft,includeItemInSelection:true,items:[new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_AFTER")}).data("FilterOperator",sap.ui.model.FilterOperator.GT),new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_AT")}).data("FilterOperator",sap.ui.model.FilterOperator.EQ),new sap.m.StandardListItem({title:A1.getText("USHELL_FACTSHEET_BEFORE")}).data("FilterOperator",sap.ui.model.FilterOperator.LT)]}),new sap.m.DateTimeInput({type:sap.m.DateTimeInputType.Date,valueFormat:new sap.ui.model.type.DateTime({pattern:"yyyy/MM/dd HH:mm:ss UTC+00:00"}).getOutputPattern(),placeholder:A1.getText("USHELL_FACTSHEET_ENTER_YOUR_FILTER"),change:function(j){var p,E1,F1,G1,i;p=j.getSource().getParent().getParent().getId();E1=sap.ui.getCore().byId(p.substr(0,p.indexOf("-")));F1=E1.getFilterItems();for(i=0;i<F1.length;i+=1){if((F1[i]instanceof sap.m.ViewSettingsCustomItem)&&(F1[i].getKey()===this.oParent.data("ColumnName"))){G1=F1[i];break;}}if((j.getParameter("newValue")===undefined)||(j.getParameter("newValue")==="")){G1.setSelected(false);G1.setFilterCount(0);}else{G1.setSelected(true);G1.setFilterCount(1);}}}).addStyleClass("sapFactsheetUtiFilterInput")]});w1=function(i1){var j=[],i,p,E1=i1.getItems(),F1;if(E1[0].getParent().data("EdmType")==="Edm.String"&&E1[0].getValue()){j.push(new sap.ui.model.Filter(E1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.Contains,E1[0].getValue()));}else if(E1[0].getParent().data("EdmType")==="Edm.Decimal"&&E1[1].getValue()){for(i=0;i<E1[0].getItems().length;i+=1){if(E1[0].getItems()[i].getSelected()===true){p=E1[0].getItems()[i].data("FilterOperator");break;}}F1=E1[1].getValue();for(i=F1.length-1;i>0;i-=1){if(F1[i]===","){F1=F1.replace(F1[i],".");break;}}j.push(new sap.ui.model.Filter(E1[1].getParent().data("ColumnName"),p,F1));}else if(E1[0].getParent().data("EdmType")==="Edm.Date"&&E1[1].getValue()){for(i=0;i<E1[0].getItems().length;i+=1){if(E1[0].getItems()[i].getSelected()===true){p=E1[0].getItems()[i].data("FilterOperator");break;}}j.push(new sap.ui.model.Filter(E1[1].getParent().data("ColumnName"),p,E1[1].getValue()));}else{j.push(new sap.ui.model.Filter(E1[0].getParent().data("ColumnName"),sap.ui.model.FilterOperator.EQ,E1[0].getValue()));}return j;};x1=function(p){var E1=p.getSource(),F1=E1.getFilterItems(),G1,i,j;for(i=0;i<F1.length;i+=1){if(F1[i]&&F1[i]instanceof sap.m.ViewSettingsCustomItem){F1[i].setSelected(false);F1[i].setFilterCount(0);G1=F1[i].getCustomControl().getItems();for(j=0;j<G1.length;j+=1){if((G1[j]instanceof sap.m.Input)||(G1[j]instanceof sap.m.DateTimeInput)){G1[j].setValue("");}if((G1[j]instanceof sap.m.List)&&(G1[j].getSelectedItem()!==null)){G1[j].removeSelections();}}}}};y1=x1;for(i=0;i<d1.length;i+=1){if(d1[i+1]){g1=e1[i].clone();if(g1.getText()&&(g1.data("IsSortable")==="true")&&d1[i+1].getVisible()){o1=new sap.m.ViewSettingsItem({text:g1.getText(),key:g1.data("ColumnName")});if(i===0){o1.setSelected(true);}o1.Sort=g1.Sort;n1.push(o1);}if(g1.getText()&&(g1.data("IsFilterable")==="true")){if(g1.data("EdmType")==="Edm.String"){z1=t1.clone().data("ColumnName",g1.data("ColumnName")).data("EdmType",g1.data("EdmType"));}else if(g1.data("EdmType")==="Edm.Decimal"){z1=u1.clone().data("ColumnName",g1.data("ColumnName")).data("EdmType",g1.data("EdmType"));}if((g1.data("EdmType")==="Edm.String")||(g1.data("EdmType")==="Edm.Decimal")){s1=new sap.m.ViewSettingsCustomItem({key:g1.data("ColumnName"),text:g1.getText(),customControl:z1,customData:new sap.ui.core.CustomData({key:"callback",value:w1})});r1.push(s1);}}}}p1=new sap.m.ViewSettingsDialog({sortItems:n1,filterItems:r1,cancel:y1,resetFilters:x1,confirm:function(j){var E1,F1,G1=[],H1,I1=[],J1,K1=[],L1=[],p,i,M1;E1=j.getParameters();F1=l1.getBinding("items");if(E1.sortItem){H1=E1.sortItem.getKey();J1=E1.sortDescending;if(H1.indexOf(";")>0){I1=H1.split(";");for(i=0;i<I1.length;i+=1){G1.push(new sap.ui.model.Sorter(I1[i],J1));}}else if(H1){G1.push(new sap.ui.model.Sorter(H1,J1));}F1.sort(G1);}p=E1;for(i=0;i<p.filterItems.length;i+=1){if(p.filterItems[i]instanceof sap.m.ViewSettingsCustomItem){M1=p.filterItems[i].getCustomData()[0].getValue();K1=M1.apply(this,[p.filterItems[i].getCustomControl()]);if(K1){if(!Array.isArray(K1)){K1=[K1];}L1=L1.concat(K1);}}else if(p.filterItems[i]instanceof sap.m.ViewSettingsItem){K1=p.filterItems[i].getCustomData()[0].getValue();if(K1){if(!Array.isArray(K1)){K1=[K1];}L1=L1.concat(K1);}}}F1.filter(L1);}});if(B1===true&&(n1.length>0||r1.length>0)){l1.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(j){p1.open();}})]}));}l1.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));m1=function(){if(this.getItems().length===0){this.setNoDataText(A1.getText("FACETOVERVIEW_NO_CONTENT_TEXT"));}else{this.setNoDataText(sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PULL2REFRESH_LOADING_LONG"));}};l1.attachUpdateFinished(m1);return l1;};K=function(a,o,b,e){var i;switch(a){case"com.sap.vocabularies.UI.v1.ChartType/Area":i=new sap.viz.ui5.Area({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bar":i=new sap.viz.ui5.Bar({});break;case"com.sap.vocabularies.UI.v1.ChartType/Bubble":i=new sap.viz.ui5.Bubble({});break;case"com.sap.vocabularies.UI.v1.ChartType/Column":i=new sap.viz.ui5.Column({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked":i=new sap.viz.ui5.StackedColumn({});break;case"com.sap.vocabularies.UI.v1.ChartType/ColumnStacked100":i=new sap.viz.ui5.StackedColumn100({});break;case"com.sap.vocabularies.UI.v1.ChartType/Donut":i=new sap.viz.ui5.Donut({});break;case"com.sap.vocabularies.UI.v1.ChartType/HeatMap":i=new sap.viz.ui5.Heatmap({});break;case"com.sap.vocabularies.UI.v1.ChartType/HorizontalArea":i=new sap.viz.ui5.HorizontalArea({});break;case"com.sap.vocabularies.UI.v1.ChartType/Line":i=new sap.viz.ui5.Line({});break;case"com.sap.vocabularies.UI.v1.ChartType/Pie":i=new sap.viz.ui5.Pie({});break;case"com.sap.vocabularies.UI.v1.ChartType/Scatter":i=new sap.viz.ui5.Scatter({});break;case"com.sap.vocabularies.UI.v1.ChartType/TreeMap":i=new sap.viz.ui5.Treemap({});break;case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/AreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked":case"com.sap.vocabularies.UI.v1.ChartType/BarStacked100":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked":case"com.sap.vocabularies.UI.v1.ChartType/HorizontalAreaStacked100":case"com.sap.vocabularies.UI.v1.ChartType/Radar":case"com.sap.vocabularies.UI.v1.ChartType/Waterfall":break;}if(i){if(o&&o.String){i.setTitle(new sap.viz.ui5.types.Title({visible:true,text:o.String}));}if(b&&b.String){i.setTooltip(b.String);}i.setWidth("100%");i.setHeight("17rem");i.setDataset(e);}else{i=new sap.m.Text({});}return i;};N=function(i){var a;i=i||1;if(jQuery.device.is.phone){a=(7*i)+"rem";}else{a=(11*i-1)+"rem";}return a;};O=function(a){var i,b=0,e=0,j=0,o;for(i=0;i<a.length;i+=1){o=R(a[i]);if(o){switch(o){case"High":b+=1;break;case"Medium":e+=1;break;case"Low":j+=1;break;}}}return{High:b,Medium:e,Low:j};};R=function(o){var e="";if(o.Importance){e=o.Importance.EnumMember;}else if(o["com.sap.vocabularies.UI.v1.Importance"]){e=o["com.sap.vocabularies.UI.v1.Importance"].EnumMember;}return e.substr(e.indexOf("/")+1);};P=function(m,a,e,b){var i=false,o,j,k,l;o=new sap.suite.ui.commons.KpiTile({doubleFontSize:false});if(a.ValueFormat){j=a.ValueFormat.NumberOfFractionalDigits.Int;}if(a.Title&&a.Title.String){o.setDescription(a.Title.String);}else{if(a.Title&&a.Title.Path){o.bindProperty("description",{path:a.Title.Path});}}if(a.Value&&a.Value.String){o.setValue(a.Value.String);}else{if(a.Value&&a.Value.Path){k=G(a.Value,a.Value.EdmType,e);if(k.fnChange){o.setModel(m);o.bindElement(b);o.getElementBinding().attachChange(k.fnChange,o);}if(k.String){if($.isNumeric(k.String)){i=true;o.setValue(W(k.String,j));}else{o.setValue(k.String);}}else if(k.BindingInfo){l=k.BindingInfo;if(l.parts&&l.parts.length===2){o.bindProperty("valueUnit",l.parts[0]);l.parts[1].type=undefined;l.parts[1].formatter=(function(){return function(n){return W(n,j);};}(j));o.bindProperty("value",l.parts[1]);}else if(l.parts&&l.parts.length===1){l.parts[0].type=undefined;l.parts[0].formatter=(function(){return function(n){return W(n,j);};}(j));o.bindProperty("value",l);}else{o.bindProperty("value",l);}}}}if(a.Value.EdmType==="Edm.Decimal"||a.Value.EdmType==="Edm.Double"||a.Value.EdmType==="Edm.Single"||a.Value.EdmType==="Edm.Int16"||a.Value.EdmType==="Edm.Int32"||a.Value.EdmType==="Edm.Int64"||i===true){o.setDoubleFontSize(true);}return o;};E=function(e,l,t){var m,n,p,Y,Z,_,a1,b1,i,c1={},d1,e1,f1,g1,j,h1,i1,j1,k1,l1,m1,n1,o1,p1,q1=0,r1=0,s1,t1,u1,v1,w1,x1,y1,z1=[],A1,B1,C1,D1,E1,F1,G1,H1,I1,J1,K1,L1,M1,N1,O1,P1,Q1,R1=0,S1,T1,U1,V1,W1,X1,Y1,Z1;m=g(e);m1=l.substring(0,l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));n1=l.substring(l.substring(0,l.lastIndexOf("/")).lastIndexOf("/"));if(window.location.search.indexOf("cbn_keep_anno_case%3Dtrue")===-1){n1=n1.toLowerCase();}n=new sap.ui.model.odata.ODataModel(m,{annotationURI:m1+n1,loadAnnotationsJoined:true,loadMetadataAsync:false,json:true});n.setCountSupported(false);t.setModel(n);p=c(e,n);Y="/"+e.slice(m.length);Z=n.getServiceMetadata();M=n.getServiceAnnotations();_=f(p,Z);a1=M[_]["com.sap.vocabularies.UI.v1.HeaderInfo"];b1=M[_]["com.sap.vocabularies.UI.v1.Facets"];t.bindElement(Y,s(p,Z));o1=sap.ui.getCore().getLibraryResourceBundle("sap.suite.ui.commons");t.addStyleClass("sapFactsheetUtiThingType"+p.replace(/\s/g,""));if(a1.TypeName.String){t.setTitle(a1.TypeName.String);}else{if(a1.TypeName.Path){t.bindProperty("title",{path:a1.TypeName.Path});}}if(a1.ImageUrl&&a1.ImageUrl.String){t.setIcon(a1.ImageUrl.String);}else if(a1.ImageUrl&&a1.ImageUrl.Path){t.bindProperty("icon",{path:a1.ImageUrl.Path});}else if(a1.TypeImageUrl&&a1.TypeImageUrl.String){t.setIcon(a1.TypeImageUrl.String);}else if(a1.TypeImageUrl&&a1.TypeImageUrl.Path){t.bindProperty("icon",{path:a1.TypeImageUrl.Path});}if(a1.Title.Value.String){t.setName(a1.Title.Value.String);}else{t.bindProperty("name",G(a1.Title.Value,a1.Title.EdmType,_).BindingInfo);}if(a1.Description&&a1.Description.Value){if(a1.Description.Value.String){t.setDescription(a1.Description.Value.String);}else{t.bindProperty("description",G(a1.Description.Value,a1.Description.EdmType,_).BindingInfo);}}for(S1 in M[_]){if(M[_].hasOwnProperty(S1)){if(S1.search("com.sap.vocabularies.UI.v1.DataPoint")!==-1){T1=M[_][S1];if(T1){t.addKpi(P(n,T1,_,Y));R1+=1;}}if(R1>=3){break;}}}for(i=0;i<b1.length;i+=1){if(b1[i]["com.sap.vocabularies.UI.v1.IsSummary"]){i1=b1[i];break;}}if(i1){p1=15;for(j=0;j<i1.Facets.length;j+=1){s1=i1.Facets[j].Target.AnnotationPath.substring(i1.Facets[j].Target.AnnotationPath.lastIndexOf("@")+1);d1=i1.Facets[j].Target.AnnotationPath;d1=d1.substring(0,d1.lastIndexOf("@")-1);i1.Facets[j].NavPath=d1;t1=q(p,d1,Z);i1.Facets[j].NavEntitySet=t1;if(t1){u1=t1;}else{u1=p;}i1.Facets[j].EntitySet=u1;v1=f(t1,Z);if(v1){w1=v1;}else{w1=_;}i1.Facets[j].EntityType=w1;x1=[];if(M[w1][s1].length){x1=M[w1][s1];}else if(M[w1][s1].Data.length){x1=M[w1][s1].Data;}i1.Facets[j].Content=x1;for(i=0;i<x1.length;i+=1){y1=R(x1[i]);if(y1==="High"){q1+=1;}else if(y1==="Medium"){r1+=1;}}}if(q1>=p1){q1=p1;r1=0;}else if((q1+r1)>p1){r1=p1-q1;if(r1<0){r1=0;}}if(jQuery.device.is.phone){r1=0;}C1=p1-q1-r1;D1=[];F1=r1+q1;for(j=0;j<i1.Facets.length;j+=1){G1=H(n,i1.Facets[j].EntitySet,i1.Facets[j].Content,{High:q1,Medium:r1,Low:0},null).addStyleClass("sapFactsheetUtiTilePadding");if(j>0){G1.addStyleClass("sapFactsheetUtiPaddingTop");}if(i1.Facets[j].NavPath){G1.bindElement(Y+"/"+i1.Facets[j].NavPath);}E1=O(i1.Facets[j].Content);q1-=E1.High;r1-=E1.Medium;if(((E1.High>0)&&((q1+E1.High)>0))||((E1.Medium>0)&&((r1+E1.Medium)>0))){D1.push(G1);if(j>0){if(C1>0){C1-=1;}else if(r1>0){r1-=1;}else if(q1>0){q1-=1;}}}if((q1<1)&&(r1<1)){break;}}if(q1<0){q1=0;}if(r1<0){r1=0;}c1=new sap.ui.layout.VerticalLayout({content:D1,width:"100%"});H1=N();J1=1;if((F1>3)&&(F1<=9)){H1=N(2);J1=2;}else if(F1>9){H1=N(3);J1=3;}K1=new sap.suite.ui.commons.FacetOverview({title:o1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"),rowSpan:J1,content:c1});if(jQuery.device.is.phone){K1.setHeightType(sap.suite.ui.commons.FacetOverviewHeight.Auto);}else{K1.setHeight(H1);}K1.addStyleClass("sapFactsheetUtiGeneralInformationOverviewFacet");K1.attachPress({facets:i1},function(o,a){var b,k,$1,_1,c1;t.removeAllFacetContent();$1=new sap.suite.ui.commons.UnifiedThingGroup();$1.setDescription(Q());$1.setTitle(o1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));$1.addStyleClass("sapFactsheetUtiGeneralInformationUtg");if(a.facets.Facets.length>1){b="L6 M12 S12";}else{b="L12 M12 S12";}_1=new sap.ui.layout.VerticalLayout({width:"100%"});for(i=0;i<a.facets.Facets.length;i+=1){if(i%2===0){k=new sap.ui.layout.Grid({hSpacing:1,vSpacing:1,defaultSpan:b});}c1=I(n,p,a.facets.Facets[i],Y);c1.addStyleClass("sapFactsheetUtiGeneralInformationUtgContent");if((i===0)&&(a.facets.Facets.length>1)&&(c1.getTitle().trim()==="")){c1.setTitle(o1.getText("UNIFIEDTHINGINSPECTOR_GENERAL_INFORMATION_HEADER_TEXT"));}k.addContent(c1);if(i%2!==0){_1.addContent(k);}}if(i%2!==0){_1.addContent(k);}$1.setContent(_1);t.addFacetContent($1);t.navigateToDetail();});t.addFacet(K1);}f1=function(g1){return function(a){var o,b,k,$1,_1,a2,b2,c2,d2,e2,Y,f2,g2,h2,i2,j2,k2,l2,m2,i;if((g1.cardinality==="*"&&a.results&&a.results.length&&a.results.length!==0)||(g1.cardinality==="1"&&a)){e2=new sap.ui.model.json.JSONModel();if(g1.cardinality==="*"){if(a.results&&a.results.length){e2.setData(a);}}else{e2.setData({result:a});Y="/result";}o=new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/VBI_APPL_DEF_SRV",false);b=M[g1.navigationType]["com.sap.vocabularies.UI.v1.GeoLocation"];g2=M[g1.navigationType]["com.sap.vocabularies.UI.v1.HeaderInfo"];h2=M[g1.navigationType]["com.sap.vocabularies.UI.v1.Identification"];if(b.Longitude&&b.Latitude){$1={"Data":{"Set":{"N":[{"name":"Spots","E":[]}]}}};if(g1.cardinality==="1"){if(b.Longitude.Path&&b.Latitude.Path){k=a[b.Longitude.Path]+";"+a[b.Latitude.Path]+";0";}$1.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}else{for(i=0;i<a.results.length;i+=1){if(b.Longitude.Path&&b.Latitude.Path){k=a.results[i][b.Longitude.Path]+";"+a.results[i][b.Latitude.Path]+";0";}$1.Data.Set.N[0].E.push({"A":k,"I":"pin_blue.png"});}if(a.results.length!==0){k=a.results[0][b.Longitude.Path]+";"+a.results[0][b.Latitude.Path]+";0";}}}m2=parseInt(a.__count,10);if(Number(m2)){g1.facet.setQuantity(m2);}b2=function(n2){var o2,p2,q2,r2,s2;o2=$.parseJSON(n2.getParameters().data);if(o2.Action.name==="DETAIL_REQUEST"&&o2.Action.instance){p2=o2.Action.instance;if(e2.oData.results){Y="/results/"+p2.split(".")[1];}l2=g2.TypeName.String.substring(0,17);r2=parseFloat(N(0.7))*16;s2=parseFloat(N(1.5))*16;q2={"SAPVB":{"version":"2.0","xmlns:VB":"VB","Windows":{"Remove":{"name":"Detail1"},"Set":{"name":"Detail1","Window":{"id":"Detail1","type":"callout","refParent":"Main","refScene":"","offsetX":"16","offsetY":"-27","modal":"false","width":s2,"height":r2,"caption":l2,"pos.bind":p2+".GeoPosition"}}},"Scenes":{"Set":{"name":"Details","Scene":{"id":"Details","navControlVisible":"false"}}}}};this.load(q2);}};c2=function(n2){var S1,o2,t1,p2;if(!i2){i2=x(g2.Title,g1.navigationType,Z);i2.setModel(e2);i2.bindElement(Y);j2=x(g2.Description,g1.navigationType,Z);j2.setModel(e2);j2.bindElement(Y);for(S1 in b.Address){if(S1==="label"){f2=x({Value:b.Address[S1]},g1.navigationType,Z);f2.setModel(e2);f2.bindElement(Y);break;}}p2=7;if(jQuery.device.is.tablet&&jQuery.device.is.landscape){p2=4;}else if(jQuery.device.is.tablet&&jQuery.device.is.portrait){p2=5;}else if(jQuery.device.is.phone&&jQuery.device.is.landscape){p2=2;}else if(jQuery.device.is.phone&&jQuery.device.is.portrait){p2=3;}k2=new sap.ui.layout.VerticalLayout({width:"100%"}).setModel(n);if(g1.navigationPath){t1=q(g1.entitySet,g1.navigationPath,Z);k2.addContent(H(n,t1,h2,{High:p2})).setModel(e2).bindElement(Y);}else{k2.addContent(H(n,g1.entitySet,h2,{High:p2})).setModel(e2).bindElement(Y);}}else{i2.bindElement(Y);if(j2){j2.bindElement(Y);}if(f2){f2.bindElement(Y);}if(k2){k2.bindElement(Y);}}o2=parseFloat(N(1.5))*16*0.95+"px";if(i2){i2.placeAt(n2.getParameter("contentarea").id);i2.addStyleClass("sapFactsheetUtiGeoPopupHead");if(jQuery.device.is.phone){i2.addStyleClass("sapFactsheetUtiGeoPopupHeadFontPhone");}i2.setWidth(o2);}if(j2){j2.placeAt(n2.getParameter("contentarea").id);j2.addStyleClass("sapFactsheetUtiGeoPopupDescr");if(jQuery.device.is.phone){j2.addStyleClass("sapFactsheetUtiGeoPopupDescrFontPhone");}j2.setWidth(o2);}if(f2){f2.placeAt(n2.getParameter("contentarea").id);f2.addStyleClass("sapFactsheetUtiGeoPopupText");f2.setWidth(o2);}if(k2&&k2.getContent()[0]&&k2.getContent()[0].getContent&&k2.getContent()[0].getContent().length>0){k2.placeAt(n2.getParameter("contentarea").id);k2.addStyleClass("sapFactsheetUtiGeoPopupText");k2.setWidth(o2);}};d2=function(n2){if(i2){i2.destroy();i2=undefined;}if(j2){j2.destroy();j2=undefined;}if(f2){f2.destroy();f2=undefined;}if(k2){k2.destroy();k2=undefined;}$(n2.getParameter("contentarea").id).empty();};_1=function(g1){return function(a){var n2,o2,p2,q2,i;q2=a.ProjectJSON;q2=q2.indexOf("{")?q2.substr(q2.indexOf("{")):q2;n2=$.parseJSON(q2);n2.SAPVB.Scenes.Set.SceneGeo.initialStartPosition=k;n2.SAPVB.Scenes.Set.SceneGeo.initialZoom=12;n2.SAPVB.Actions.Set.Action.push({id:"200",name:"TAP_ON_MAP",refEvent:"Click",refScene:"MainScene",refVO:"Map"});if($1){n2.SAPVB.Data=$1.Data;}for(i=0;i<n2.SAPVB.Scenes.Set.SceneGeo.VO.length;i+=1){if(n2.SAPVB.Scenes.Set.SceneGeo.VO[i].datasource==="Spots"){if(n2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale&&n2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale.split(";").length!==3){n2.SAPVB.Scenes.Set.SceneGeo.VO[i].scale="1.0;1.0;1.0";break;}}}g1.facet.getContent().attachSubmit(function(r2){if(jQuery.device.is.tablet||jQuery.device.is.phone){g1.facet.firePress();}});g1.facet.getContent().load(n2);g1.facet.attachPress("",function(r2,s2){var t2=[],u2=[],i,v2;if(!o2){o2=new sap.ui.vbm.VBI({width:"100%",height:"100%",plugin:false,config:null});o2.addStyleClass("sapFactsheetUtiGeoPopup");}n2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.move="false";n2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.zoom="false";n2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.pitch="false";n2.SAPVB.Scenes.Set.SceneGeo.NavigationDisablement.yaw="false";n2.SAPVB.Scenes.Set.SceneGeo.SuppressedNavControlVisibility="false";o2.load(n2);if(g1.cardinality==="*"){for(i=0;i<e2.oData.results.length;i+=1){t2.push(e2.oData.results[i][b.Longitude.Path]);u2.push(e2.oData.results[i][b.Latitude.Path]);}}o2.attachSubmit(b2);o2.attachOpenWindow(c2);o2.attachCloseWindow(d2);p2=new sap.suite.ui.commons.UnifiedThingGroup({content:o2,title:g1.facetContent.Label.String,description:Q()});t.removeAllFacetContent();t.addFacetContent(p2);t.navigateToDetail();t.attachAfterNavigate(t2,function(r2){if(r2.getParameters().getParameters().toId.indexOf("-detail-page")!==-1){if(jQuery.device.is.phone){v2="300px";}else{v2=Math.floor($("#"+r2.getParameters().getParameters().toId+"-cont").height()-128)+"px";}o2.setHeight(v2);if(t2.length>1){o2.zoomToGeoPosition(t2,u2);}}});});};};a2=function(n2){return function(o2){t.removeFacet(n2);};};o.read("VBIApplicationSet('ZFACTSHEETS')","","",false,_1(g1),a2(g1.facet));}else{g1.facet.setQuantity(undefined);g1.facet.addStyleClass("sapFactsheetUtiEmptyTile");g1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);g1.facet.setContent(undefined);g1.facet.setTitle(undefined);}};};Y1=function(o){var a,b;a=o.srcControl.getParent().getParent().getDomRef().clientWidth;b=a;if(o.srcControl.getParent().getContent()[0]){b-=o.srcControl.getParent().getContent()[0].getDomRef().clientWidth;if(a<o.srcControl.getParent().getContent()[0].getDomRef().clientWidth){o.srcControl.getParent().getContent()[0].getDomRef().setAttribute("style","width:"+a+"px");return;}}if(o.srcControl.getParent().getContent()[1]){b-=o.srcControl.getParent().getContent()[1].getDomRef().clientWidth;}if(b<10){b=0;}if(o.srcControl.getParent().getContent()[2]){o.srcControl.getParent().getContent()[2].getDomRef().setAttribute("style","width:"+b+"px");}};e1=function(g1){return function(a){var o,b,k,$1,_1,a2,b2,c2,i,j,c1,d2,e2,f2,g2,b2,h2,i2,j2,k2,l2,m2,n2,o2,p2,q2,r2,s2,t2="",u2,v2,w2,x2,y2,z2;o=new sap.ui.model.json.JSONModel();if(g1.facetContent.Target&&g1.facetContent.Target.AnnotationPath&&g1.facetContent.Target.AnnotationPath.split("#")[1]&&M[g1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+g1.facetContent.Target.AnnotationPath.split("#")[1]]){b=M[g1.navigationType]["com.sap.vocabularies.UI.v1.Badge#"+g1.facetContent.Target.AnnotationPath.split("#")[1]];}else{b=M[g1.navigationType]["com.sap.vocabularies.UI.v1.Badge"];}if(g1.cardinality==="*"){if(a.results&&a.results.length){u2=g1.facetContent.Target.AnnotationPath;U1=u2.substring(u2.lastIndexOf("@")+1);if(U1==="com.sap.vocabularies.UI.v1.Chart"){jQuery.sap.require("sap.viz.ui5.data.FlattenedDataset");v2=M[g1.navigationType]["com.sap.vocabularies.UI.v1.Chart"];w2=M.propertyExtensions[g1.navigationType];x2=[];for(i=0;i<v2.Dimensions.length;i+=1){x2.push({axis:1,name:w2[v2.Dimensions[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+v2.Dimensions[i].PropertyPath+"}"});}y2=[];for(i=0;i<v2.Measures.length;i+=1){y2.push({name:w2[v2.Measures[i].PropertyPath]["http://www.sap.com/Protocols/SAPData"].label,value:"{"+v2.Measures[i].PropertyPath+"}"});}z2=new sap.viz.ui5.data.FlattenedDataset({dimensions:x2,measures:y2,data:{path:"/results"}});c1=K(v2.ChartType.EnumMember,v2.Title,v2.Description,z2);c1.setModel(o);g1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.XL);}else{c1=new sap.ui.layout.VerticalLayout({width:"100%"}).addStyleClass("sapFactsheetUtiVLayoutPadding");for(i=0;i<a.results.length;i+=1){b2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutPadding");$1=x(b.Title,g1.navigationType,Z);$1.setWrapping(false);$1.addDelegate({onAfterRendering:function(A2){Y1(A2);}});o=new sap.ui.model.json.JSONModel();o.setData({result:a.results[i]});$1.setModel(o);$1.bindElement("/result");c2=false;if(a.results[i][b.Title.Value.Path]){c2=true;}if(b.Title.Value.Apply){for(j=0;j<b.Title.Value.Apply.Parameters.length;j+=1){if(b.Title.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.Title.Value.Apply.Parameters[j].Value]){c2=true;break;}}}}t2="";if(c2){b2.addContent($1);if(b.MainInfo&&((b.MainInfo.EdmType&&b.MainInfo.EdmType==="Edm.Decimal")||(b.MainInfo.Value&&b.MainInfo.Value.Apply&&b.MainInfo.Value.Apply.Parameters[0]&&b.MainInfo.Value.Apply.Parameters[0].EdmType&&b.MainInfo.Value.Apply.Parameters[0].EdmType==="Edm.Decimal"))){t2="comma";}else if(b.MainInfo&&b.MainInfo.Value.Path&&a.results[i][b.MainInfo.Value.Path]){t2="dash";}else if(b.MainInfo&&b.MainInfo.Value.Apply){for(j=0;j<b.MainInfo.Value.Apply.Parameters.length;j+=1){if(b.MainInfo.Value.Apply.Parameters[j].Type==="Path"){if(a.results[i][b.MainInfo.Value.Apply.Parameters[j].Value]){t2="dash";break;}}}}if(t2==="dash"){b2.addContent(new sap.ui.core.HTML({content:"<span class=\"sapFactsheetUtiSeparatorPadding sapMText\"> &ndash; </span>"}));}if(t2==="comma"){b2.addContent(new sap.m.Text({text:", "}).addStyleClass("sapFactsheetUtiSeparatorPaddingForDecimal"));}}if(b.MainInfo){a2=x(b.MainInfo,g1.navigationType,Z);a2.setWrapping(false);a2.addDelegate({onAfterRendering:function(A2){Y1(A2);}});a2.setModel(o);a2.bindElement("/result");b2.addContent(a2);}c1.addContent(b2);}}d2=parseInt(a.__count,10);if(Number(d2)){g1.facet.setQuantity(d2);}g1.facet.setContent(c1);g1.facet.attachPress({facet:g1.facetContent},function(A2,_1){var c1;t.removeAllFacetContent();c1=I(n,g1.entitySet,_1.facet,g1.bindingPath);c1.setDescription(Q());t.addFacetContent(c1);t.navigateToDetail();});}else{g1.facet.setQuantity(0);g1.facet.addStyleClass("sapFactsheetUtiEmptyTile");g1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}}else{o.setData({result:a});for(r2 in a){if(a.hasOwnProperty(r2)){if(r2!=="__metadata"){if(typeof a[r2]==="string"&&a[r2]){if(parseInt(a[r2],10)!==0){s2=true;break;}}else if(typeof a[r2]==="number"&&parseInt(a[r2],10)!==0){s2=true;break;}}}}if(s2){e2=new sap.ui.layout.VerticalLayout();f2=(M.propertyExtensions)?M.propertyExtensions[g1.navigationType]:[];g2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");h2=y(b.Title,{},f2,true).addStyleClass("sapFactsheetUtiLabelMargin");$1=x(b.Title,g1.navigationType,Z);$1.setModel(o);$1.bindElement("/result");g2.addContent(h2);g2.addContent($1);e2.addContent(g2);if(b.MainInfo){i2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");j2=y(b.MainInfo,{},f2,true).addStyleClass("sapFactsheetUtiLabelMargin");a2=x(b.MainInfo,g1.navigationType,Z);a2.setModel(o);a2.bindElement("/result");i2.addContent(j2);i2.addContent(a2);e2.addContent(i2);}if(b.SecondaryInfo){k2=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiHLayoutLabelValue");l2=y(b.SecondaryInfo,{},f2,true).addStyleClass("sapFactsheetUtiLabelMargin");m2=x(b.SecondaryInfo,g1.navigationType,Z);m2.setModel(o);m2.bindElement("/result");k2.addContent(l2);k2.addContent(m2);e2.addContent(k2);}if(b.TypeImageUrl||b.ImageUrl){if(b.ImageUrl){n2=b.ImageUrl;}else{n2=b.TypeImageUrl;}o2=new sap.ui.layout.HorizontalLayout();p2="64px";if(jQuery.device.is.phone){p2="48px";}if(n2.String&&(n2.String.substr(0,11)==="sap-icon://")){q2=new sap.ui.core.Icon({size:p2,width:p2});}else{q2=new sap.m.Image({width:p2});}q2.addStyleClass("sapFactsheetUtiRelIcon");if(n2&&n2.String){q2.setSrc(n2.String);}else{if(n2&&n2.Path){q2.bindProperty("src",n2.Path);}}o2.addContent(q2);o2.addContent(e2);g1.facet.setContent(o2);}else{g1.facet.setContent(e2);}g1.facet.attachPress({facet:g1.facetContent},function(A2,_1){var c1;t.removeAllFacetContent();c1=I(n,g1.entitySet,_1.facet,g1.bindingPath);c1.setDescription(Q());t.addFacetContent(c1);t.navigateToDetail();});}else{g1.facet.addStyleClass("sapFactsheetUtiEmptyTile");g1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}}};};X1=function(g1){return function(a){t.removeFacet(g1.facet);};};V1=function(g1){return function(a){var o,b,i,k,$1;b=M[g1.navigationType]["com.sap.vocabularies.UI.v1.MediaResource"];if(g1.cardinality==="*"){if(a.results&&a.results.length){o=new sap.ui.layout.HorizontalLayout().addStyleClass("sapFactsheetUtiPictureViewerOverview");for(i=0;i<a.results.length;i+=1){o.addContent(new sap.m.Image({src:a.results[i][b.Thumbnail.Url.Path],height:"85px"}));if(i===3){break;}}k=parseInt(a.__count,10);if(Number(k)){g1.facet.setQuantity(k);}g1.facet.setContent(o);g1.facet.attachPress({facet:g1.facetContent,data:a},function(_1,a2){var b2,W1,c2;t.removeAllFacetContent();$1=new sap.suite.ui.commons.UnifiedThingGroup();if(a2.facet.Label&&a2.facet.Label.String){$1.setTitle(a2.facet.Label.String);}$1.setDescription(Q());if(jQuery.device.is.phone){W1="350px";}else{W1="550px";}b2=new sap.m.Carousel({height:W1});for(i=0;i<a2.data.results.length;i+=1){c2=new sap.m.Image({src:a2.data.results[i][b.Url.Path]});if(jQuery.device.is.phone){c2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeightPhone");}else{c2.addStyleClass("sapFactsheetUtiCarouselMaxImageHeight");}b2.addPage(c2);}$1.setContent(b2);t.addFacetContent($1);t.navigateToDetail();});}else{g1.facet.setQuantity(0);g1.facet.addStyleClass("sapFactsheetUtiEmptyTile");g1.facet.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.S);}}};};Z1=function(o,$1){var k,i,j,_1=[],a2={},b2,c2,d2,e2,f2,g2,h2,i2,j2;c2=function(Z,a){var i,b="";if(Z){if(Z.Path){return a[Z.Path];}else if(Z.String){return Z.String;}else if(Z.Apply.Name==="odata.concat"){for(i=0;i<Z.Apply.Parameters.length;i+=1){if(Z.Apply.Parameters[i].Type==="Path"){b=b+a[Z.Apply.Parameters[i].Value];}else if(Z.Apply.Parameters[i].Type==="String"){b=b+Z.Apply.Parameters[i].Value;}}return b;}}};a2.iCount=0;a2.aContacts=[];for(i=0;i<o.__batchResponses.length;i+=1){if(!o.__batchResponses[i].data){continue;}_1=o.__batchResponses[i].data.results;if(!_1){_1=[];_1.push(o.__batchResponses[i].data);}if(_1.length>0){b2=M[_1[0].__metadata.type]["com.sap.vocabularies.Communication.v1.Contact"];if(b2){for(j=0;j<_1.length;j+=1){d2=e2=f2="";if(b2.tel){for(k=0;k<b2.tel.length;k+=1){if(b2.tel[k].type&&b2.tel[k].type.EnumMember){g2=c2(b2.tel[k].uri,_1[j]);switch(b2.tel[k].type.EnumMember){case"com.sap.vocabularies.Communication.v1.PhoneType/voice":d2=g2?g2.replace("tel:",""):"";d2=d2?d2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/cell":e2=g2?g2.replace("tel:",""):"";e2=e2?e2.replace(";ext=",""):"";break;case"com.sap.vocabularies.Communication.v1.PhoneType/fax":f2=g2?g2.replace("tel:",""):"";f2=f2?f2.replace(";ext=",""):"";break;}}}}j2=b2.email&&b2.email.address?b2.email.address:"";h2=c2(b2.photo,_1[j]);a2.iCount+=1;a2.aContacts.push({fn:c2(b2.fn,_1[j]),title:c2(b2.title,_1[j]),org:c2(b2.org,_1[j]),phone:d2,mobile:e2,fax:f2,photo:h2,email:c2(j2,_1[j]),sEntity:_1[0].__metadata.type,bExistsPhoto:h2?true:false,bUseIcon:h2?false:true,sOrder:a2.iCount});}}}}if($1){a2.aContacts.sort(function(a,b){return a[$1]>b[$1]?1:-1;});}return a2;};B1=function(g1){return function(o){var i,a,b,k,$1,_1,a2,b2;a=Z1(o,"sOrder");b=new sap.ui.layout.Grid({defaultSpan:"L6 M6 S12",hSpacing:0,vSpacing:0}).addStyleClass("sapFactsheetUtiContactsGrid");for(i=0;i<a.aContacts.length&&i<4;i+=1){_1=new sap.ui.layout.VerticalLayout();if(a.aContacts[i].photo){a2=new sap.m.Image({height:"55px",src:a.aContacts[i].photo});}else{a2=new sap.ui.core.Icon({size:"50px",src:sap.ui.core.IconPool.getIconURI("person-placeholder")}).addStyleClass("sapFactsheetUtiRelIcon");}_1.addContent(a2);_1.addStyleClass("sapFactsheetUtiContactsImage");$1=new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:a.aContacts[i].fn}).addStyleClass("sapFactsheetUtiTextName"),new sap.m.Text({text:a.aContacts[i].title}).addStyleClass("sapFactsheetUtiTextValue")]});k=new sap.ui.layout.HorizontalLayout({content:[_1,$1]}).addStyleClass("sapFactsheetUtiContactsBox");b.addContent(k);}K1=sap.ui.getCore().byId(t.data("contactFacetId"));K1.setQuantity(a.iCount);if(i>0){K1.setContent(b);if(i<=2){b2=sap.suite.ui.commons.FacetOverviewHeight.M;}else{b2=sap.suite.ui.commons.FacetOverviewHeight.L;}K1.attachPress(function(){var i,z1=[],A1;n.clearBatch();for(i=0;i<M[_]["com.sap.vocabularies.UI.v1.Contacts"].length;i+=1){d1=M[_]["com.sap.vocabularies.UI.v1.Contacts"][i].AnnotationPath;d1=d1.substring(0,d1.lastIndexOf("@")-1);if(d1!==""){A1=Y+"/"+d1;}else{A1=Y;}z1.push(n.createBatchOperation(A1,"GET"));}n.addBatchReadOperations(z1);n.submitBatch(function(o){var a,c2,d2,e2,f2,g2,h2;h2=jQuery.sap.resources({url:jQuery.sap.getModulePath("sap.ushell.components.container.")+"/resources/resources.properties",language:sap.ui.getCore().getConfiguration().getLanguage()});a=Z1(o,"sEntity");c2=new sap.ui.model.json.JSONModel();c2.setData(a);d2=new sap.m.ColumnListItem({type:sap.m.Inactive,unread:false,cells:[new sap.ui.layout.VerticalLayout({content:[new sap.m.Image({src:"{photo}",width:"74px",visible:"{bExistsPhoto}"}),new sap.ui.core.Icon({size:"76px",src:sap.ui.core.IconPool.getIconURI("person-placeholder"),visible:"{bUseIcon}"}).addStyleClass("sapFactsheetUtiRelIcon")]}),new sap.ui.layout.VerticalLayout({content:[new sap.m.Text({text:"{fn}"}).addStyleClass("sapFactsheetUtiContactsName"),new sap.m.Label({text:"{title}"}),new sap.m.Label({text:"{org}"})]}),new sap.m.Link({text:"{phone}",href:"tel:{phone}"}),new sap.m.Link({text:"{mobile}",href:"tel:{mobile}"}),new sap.m.Link({text:"{fax}",href:"tel:{fax}"}),new sap.m.Link({text:"{email}",href:"mailto:{email}"})]});e2=new sap.m.Table({threshold:2,inset:false,showUnread:true,scrollToLoad:true,columns:[new sap.m.Column({hAlign:sap.ui.core.TextAlign.Center,width:"12%",header:new sap.m.Text({text:""})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,header:new sap.m.Text({text:h2.getText("USHELL_FACTSHEET_NAME")})}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:h2.getText("USHELL_FACTSHEET_PHONE")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("mobile")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"12%",header:new sap.m.Text({text:sap.ushell.resources.i18n.getText("fax")}),minScreenWidth:"Tablet",demandPopin:true}),new sap.m.Column({hAlign:sap.ui.core.TextAlign.Begin,width:"26%",header:new sap.m.Text({text:h2.getText("USHELL_FACTSHEET_EMAIL")}),minScreenWidth:"Tablet",demandPopin:true})],items:{path:"/aContacts",template:d2}});f2=new sap.m.ViewSettingsDialog({sortItems:[new sap.m.ViewSettingsItem({key:"fn",text:h2.getText("USHELL_FACTSHEET_NAME")}),new sap.m.ViewSettingsItem({key:"phone",text:h2.getText("USHELL_FACTSHEET_PHONE")}),new sap.m.ViewSettingsItem({key:"mobile",text:sap.ushell.resources.i18n.getText("mobile")}),new sap.m.ViewSettingsItem({key:"fax",text:sap.ushell.resources.i18n.getText("fax")}),new sap.m.ViewSettingsItem({key:"email",text:h2.getText("USHELL_FACTSHEET_EMAIL")})],confirm:function(i2){var j2,k2,l2=[];j2=i2.getParameters();k2=e2.getBinding("items");if(j2.sortItem){l2.push(new sap.ui.model.Sorter(j2.sortItem.getKey(),j2.sortDescending));k2.sort(l2);}}});e2.setHeaderToolbar(new sap.m.Toolbar({content:[new sap.m.Label(),new sap.m.ToolbarSpacer(),new sap.m.Button({icon:"sap-icon://drop-down-list",press:function(i2){f2.open();}})]}));e2.setModel(c2);g2=new sap.suite.ui.commons.UnifiedThingGroup({title:K1.getTitle(),description:Q(),content:e2});t.removeAllFacetContent();t.addFacetContent(g2);t.navigateToDetail();});});}else{b2=sap.suite.ui.commons.FacetOverviewHeight.S;K1.addStyleClass("sapFactsheetUtiEmptyTile");K1.setQuantity(0);}K1.setHeightType(jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:b2);};};for(i=0;i<b1.length;i+=1){if(b1[i]["com.sap.vocabularies.UI.v1.Map"]){d1=b1[i].Target.AnnotationPath;d1=d1.substring(0,d1.lastIndexOf("@")-1);N1="1";M1=_;if(d1){M1=S(d1,_,Z);N1=r(p,d1,Z);}W1="100%";if(jQuery.device.is.phone){W1="150px";}L1=new sap.ui.vbm.VBI({width:"100%",height:W1,plugin:false,config:null});K1=new sap.suite.ui.commons.FacetOverview({title:b1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.L,content:L1});g1={cardinality:N1,navigationPath:d1,facet:K1,facetContent:b1[i],navigationType:M1,metadata:Z,bindingPath:Y,entitySet:p};if(N1==="*"){O1=["$inlinecount=allpages","$top=1000"];}else{O1=[];}n.read(Y+"/"+d1,"",O1,true,f1(g1));t.addFacet(K1);}else{if(b1[i].Target){d1=b1[i].Target.AnnotationPath;d1=d1.substring(0,d1.lastIndexOf("@")-1);U1=b1[i].Target.AnnotationPath.substring(b1[i].Target.AnnotationPath.lastIndexOf("@")+1);if(d1){M1=S(d1,_,Z);K1=new sap.suite.ui.commons.FacetOverview({title:b1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});N1=r(p,d1,Z);if(N1!==0){g1={cardinality:N1,navigationPath:d1,facet:K1,facetContent:b1[i],navigationType:M1,metadata:Z,bindingPath:Y,entitySet:p};if(b1[i]["com.sap.vocabularies.UI.v1.Gallery"]){if(N1==="*"){O1=["$inlinecount=allpages"];}else{O1=[];}n.read(Y+"/"+d1,"",O1,true,V1(g1));}else{if(N1==="*"){O1=["$inlinecount=allpages","$top=3"];}else{O1=[];}n.read(Y+"/"+d1,"",O1,true,e1(g1),X1(g1));}t.addFacet(K1);}}else{if(U1==="com.sap.vocabularies.UI.v1.Contacts"){K1=new sap.suite.ui.commons.FacetOverview({title:b1[i].Label.String.trim(),heightType:jQuery.device.is.phone?sap.suite.ui.commons.FacetOverviewHeight.Auto:sap.suite.ui.commons.FacetOverviewHeight.M});t.data("contactFacetId",K1.sId);g1={facet:K1};n.clearBatch();for(j=0;j<M[_][U1].length;j+=1){d1=M[_][U1][j].AnnotationPath;d1=d1.substring(0,d1.lastIndexOf("@")-1);if(d1!==""){N1=r(p,d1,Z);if(N1==="*"){A1=Y+"/"+d1+"?$top=4"+"&$inlinecount=allpages";}else{A1=Y+"/"+d1;}}else{A1=Y;}z1.push(n.createBatchOperation(A1,"GET"));}n.addBatchReadOperations(z1);n.submitBatch(B1(g1));t.addFacet(K1);}}}}}I1=new sap.ushell.ui.footerbar.AddBookmarkButton();Q1=function(){var b,i,U1,a,k,$1={},S1,_1,a2,b2,o,c2;I1.setAppData({title:t.getTitle(),subtitle:t.getName()+" - "+t.getDescription()});I1.setEnabled(true);a2=f(p,Z,true);k1=new sap.suite.ui.commons.LinkActionSheet({showCancelButton:true,placement:sap.m.PlacementType.Top});h1=z(e,n);b=h1.split(",");for(i=0;i<b.length;i+=1){b[i]=b[i].replace("='","=","g");if(b[i].lastIndexOf("'")===b[i].length-1){b[i]=b[i].slice(0,-1);}}for(U1 in M[_]){if(M[_].hasOwnProperty(U1)){if(U1.indexOf("com.sap.vocabularies.Common.v1.SecondaryKey")===0){a=M[_][U1];for(i=0;i<a.length;i+=1){k=this.getBoundContext().getProperty(a[i].PropertyPath);if(k){b.push(a[i].PropertyPath+"="+k);}}}}}for(i=0;i<b.length;i+=1){S1=b[i].substr(0,b[i].indexOf("="));_1=b[i].substr(b[i].indexOf("=")+1,b[i].length);$1[decodeURIComponent(S1)]=decodeURIComponent(_1);}j1=sap.ushell.Container.getService("CrossApplicationNavigation").getSemanticObjectLinks(a2,$1);j1.done(jQuery.proxy(function(d2){var i,e2;for(i=0;i<d2.length;i+=1){if(d2[i].intent.indexOf(T)<0){e2=sap.ushell.Container.getService("CrossApplicationNavigation").hrefForExternal({target:{shellHash:d2[i].intent}});k1.addItem(new sap.m.Link({text:d2[i].text,href:e2}));t.setTransactionsVisible(true);}}}));t.attachTransactionsButtonPress(function(d2){k1.openBy(d2.getParameter("caller"));});this.detachChange(Q1);sap.ushell.services.AppConfiguration.setWindowTitle(t.getTitle().trim()+": "+t.getName().trim()+" ("+t.getDescription().trim()+")");t.setActionsVisible(true);P1=new sap.m.Button({text:o1.getText("UNIFIEDTHINGINSPECTOR_FOOTER_BUTTON_EMAIL_LINK"),icon:"sap-icon://email",press:function(oE){sap.m.URLHelper.triggerEmail("",t.getName(),window.location.href);}});l1=new sap.m.ActionSheet({placement:sap.m.PlacementType.Top});b2=e.substr(0,e.lastIndexOf("/")+1);for(o in n.oData){if(n.oData.hasOwnProperty(o)){b2=b2+o;c2=o.substring(o.indexOf("(")+1,o.indexOf(")"));break;}}l1.addButton(new sap.ushell.ui.footerbar.JamDiscussButton({jamData:{businessObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:c2,name:t.getTitle(),ui_url:window.location.href}}}));l1.addButton(new sap.ushell.ui.footerbar.JamShareButton({jamData:{object:{id:window.location.href,display:new sap.m.Text({text:t.getTitle()}),share:""},externalObject:{appContext:"CB",odataServicePath:e.substr(0,e.lastIndexOf("/")+1),collection:p,key:c2,name:t.getTitle()}}}));l1.addButton(I1);l1.addButton(P1);t.attachActionsButtonPress(function(d2){l1.openBy(d2.getParameter("caller"));});};t.getElementBinding().attachChange(Q1);t.attachBackAction(function(o){history.back();});t.addDelegate({onAfterRendering:function(){t._adjustFacetLayout();}});return t;};return{ThingInspector:function(a,b){try{t=E(a,b,new sap.suite.ui.commons.UnifiedThingInspector({configurationVisible:false}));}catch(e){throw e;}return t;}};}());}());

(function(){"use strict";jQuery.sap.require("sap.ushell.components.tiles.generic");sap.ushell.components.tiles.generic.extend("tiles.indicatordeviation.DeviationTile",{onInit:function(){this.KPI_VALUE_REQUIRED=true;},doProcess:function(k,t){var a=this;var f,b;var c=Number(k);var d=this.setThresholdValues();if(this.oConfig.EVALUATION.SCALING==-2){c*=100;}b=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(Number(c),this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION);if(this.oConfig.EVALUATION.SCALING==-2){b+=" %";}this.CALCULATED_KPI_VALUE=Number(k);var e={};var g=this.getThresholdsObjAndColor(d).returnColor;var h={value:Number(k),color:g};e.actualValueLabel=b.toString();e.actual=h;e.thresholds=[];e.thresholds=this.getThresholdsObjAndColor(d).arrObj;var i=this.DEFINITION_DATA.EVALUATION_VALUES;if(this.DEFINITION_DATA.EVALUATION.VALUES_SOURCE=="MEASURE"){var j=Number(d.targetValue);if(this.oConfig.EVALUATION.SCALING==-2)j*=100;f=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(j,this.oConfig.EVALUATION.SCALING,this.oConfig.EVALUATION.DECIMAL_PRECISION);if(this.oConfig.EVALUATION.SCALING==-2)f+="%";e.targetValue=Number(d.targetValue);e.targetValueLabel=f.toString();}else{for(var l=0;l<i.length;l++){if(i[l].TYPE==="TA"){var j=Number(i[l].FIXED);if(this.oConfig.EVALUATION.SCALING==-2)j*=100;f=sap.ushell.components.tiles.indicatorTileUtils.util.getLocaleFormattedValue(j);if(this.oConfig.EVALUATION.SCALING==-2)f+="%";e.targetValue=Number(i[l].FIXED);e.targetValueLabel=f.toString();}}}this._updateTileModel(e);if(this.DEFINITION_DATA.TILE_PROPERTIES.frameType==sap.suite.ui.commons.FrameType.TwoByOne){a.getView().getViewData().parentController._updateTileModel(this.getTile().getModel().getData());a.getView().getViewData().deferredObj.resolve();}else{var n=sap.ushell.components.tiles.indicatorTileUtils.util.getNavigationTarget(a.oConfig,a.system);a.oKpiTileView.oGenericTile.$().wrap("<a href ='"+n+"'/>");this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded);}this.setToolTip(g,c,"DT");},getThresholdsObjAndColor:function(t){try{var T={};T.arrObj=[];T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Neutral;var i=this.DEFINITION_DATA.EVALUATION.GOAL_TYPE;var a=this.DEFINITION_DATA.EVALUATION_VALUES;var w,c,b,d;if(i==="MI"){b=Number(t.criticalHighValue)||0;d=Number(t.warningHighValue)||0;if(b&&d){b=window.parseFloat(b);d=window.parseFloat(d);T.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});T.arrObj.push({value:d,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(this.CALCULATED_KPI_VALUE<d){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}else if(this.CALCULATED_KPI_VALUE<=b){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}}}else if(i==="MA"){c=Number(t.criticalLowValue)||0;w=Number(t.warningLowValue)||0;if(c&&w){c=window.parseFloat(c);w=window.parseFloat(w);T.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});T.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});if(this.CALCULATED_KPI_VALUE<c){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}else if(this.CALCULATED_KPI_VALUE<=w){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}}}else{b=Number(t.criticalHighValue)||0;d=Number(t.warningHighValue)||0;c=Number(t.criticalLowValue)||0;w=Number(t.warningLowValue)||0;if(w&&d&&c&&c){b=window.parseFloat(b);d=window.parseFloat(d);w=window.parseFloat(w);c=window.parseFloat(c);T.arrObj.push({value:b,color:sap.suite.ui.commons.InfoTileValueColor.Error});T.arrObj.push({value:d,color:sap.suite.ui.commons.InfoTileValueColor.Critical});T.arrObj.push({value:w,color:sap.suite.ui.commons.InfoTileValueColor.Critical});T.arrObj.push({value:c,color:sap.suite.ui.commons.InfoTileValueColor.Error});if(this.CALCULATED_KPI_VALUE<c||this.CALCULATED_KPI_VALUE>b){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Error;}else if((this.CALCULATED_KPI_VALUE>=c&&this.CALCULATED_KPI_VALUE<=w)||(this.CALCULATED_KPI_VALUE>=d&&this.CALCULATED_KPI_VALUE<=b)){T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Critical;}else{T.returnColor=sap.suite.ui.commons.InfoTileValueColor.Good;}}}return T;}catch(e){this.logError(e);}},doDummyProcess:function(){var t=this;this.setTextInTile();t._updateTileModel({actual:{value:120,color:sap.suite.ui.commons.InfoTileValueColor.Good},targetValue:100,thresholds:[{value:0,color:sap.suite.ui.commons.InfoTileValueColor.Error},{value:50,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:150,color:sap.suite.ui.commons.InfoTileValueColor.Critical},{value:200,color:sap.suite.ui.commons.InfoTileValueColor.Error}],showActualValue:true,showTargetValue:true});this.oKpiTileView.oGenericTile.setState(sap.suite.ui.commons.LoadState.Loaded);}});}());

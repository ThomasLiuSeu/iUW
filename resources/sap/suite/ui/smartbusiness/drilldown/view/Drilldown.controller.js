/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2013 SAP SE. All rights reserved
 * @deprecated since SAPUI 5 version 1.28.0
 */
jQuery.sap.require("sap.ca.scfld.md.controller.BaseFullscreenController");jQuery.sap.require("sap.m.MessageBox");sap.ca.scfld.md.controller.BaseFullscreenController.extend("sap.suite.ui.smartbusiness.drilldown.view.Drilldown",{_getEvaluationId:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;return s["evaluationId"][0];}catch(e){return sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters().evaluationId[0];}},_getDataFromUrl:function(){try{var s=this.oConnectionManager.getComponent().oComponentData.startupParameters;this.TILE_TYPE='';this.DIMENSION='';if(s["tileType"]){this.TILE_TYPE=s["tileType"][0];}if(s["dimension"]){this.DIMENSION=s["dimension"][0];}if(s["sap-system"]){this.SAP_SYSTEM=s["sap-system"][0];}if(s["chipId"]){this.CHIP_ID=s["chipId"][0];}}catch(e){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();if(p){if(p.tileType){this.TILE_TYPE=p.tileType[0];}if(p.dimension){this.DIMENSION=p.dimension[0];}if(p["sap-system"]){this.SAP_SYSTEM=p["sap-system"][0];}if(p["chipId"]){this.CHIP_ID=p["chipId"][0];}}}},fetchAllEvaluations:function(p){var h=[this._getEvaluationId()];var H=this.CONFIGURATION.getHeaders();H.forEach(function(c){if(c.isAssociated()){if(h.indexOf(c.getReferenceEvaluationId())==-1){h.push(c.getReferenceEvaluationId());}if(h.indexOf(c.getEvaluationId())==-1){h.push(c.getEvaluationId());}}});this._bundled_evaluations_call_ref=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.setEvaluationsCache({evalIdArray:h,sapSystem:this.SAP_SYSTEM,success:p.success,context:p.context});},onAfterRendering:function(){var E=this._getEvaluationId();var a=E;this._EVALUATION_ID=E;this.firstTimeFlag=false;this._getDataFromUrl();if(!this._proxyHashChangeListener){this._proxyHashChangeListener=jQuery.proxy(this.hashChangeListener,this);this._attachHashChangeEvent();}this._busyDialog.open();var i=sap.suite.ui.smartbusiness.Configuration.isMetadataFromABAP();if(i){var r=sap.suite.ui.smartbusiness.Adapter.getService("RuntimeServices");r.getDataByEntity({entity:"PROPERTIES",filter:"TYPE eq 'EV' and IS_ACTIVE eq 1 and ID eq '"+E+"' and NAME eq 'SAP:Copied_From'",async:false,success:function(d){if(d&&d.length){a=d[0].VALUE||E;}},error:function(e){jQuery.sap.log.error(e&&e.message);}});}var s=new Date().getTime();this.DDA_CONFIG_ODATA_CALL_REF=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.loadConfiguration({evaluationId:a,cache:true,success:function(b){var e=new Date().getTime();this._requestTimeLog["DDA_CONFIG_FETCH"]={title:"Configuration",time:e-s};this.CONFIGURATION=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.parse(a,b);var t=this;if(this.CONFIGURATION.getAllViews().length==0){jQuery.sap.log.error("drilldown not configured");var I=t.getView().getModel("i18n");sap.m.MessageBox.alert(I.getResourceBundle().getText("DDA_NOT_CONFIGURED"),function(){window.location.hash="";t._busyDialog.close();});return;}var c=new Date().getTime();this.fetchAllEvaluations({success:function(){var d=new Date().getTime();this._requestTimeLog["BUNDLED_EVALUATIONS_FETCH"]={title:"Evaluations",time:d-c};this.EVALUATION_ODATA_CALL_REF=sap.suite.ui.smartbusiness.drilldown.lib.Configuration.getEvaluationById({id:E,cache:true,filters:true,thresholds:true,success:function(f){this._busyDialog.close();this.EVALUATION=sap.suite.ui.smartbusiness.lib.Util.kpi.parseEvaluation(f);this._initialize();},error:function(){this._busyDialog.close();throw new Error("Evaluation Details Not Found with ID : "+E);},context:this,sapSystem:this.SAP_SYSTEM});},context:this,});},error:function(){jQuery.sap.log.error("Drilldown Configuration Fetching Failed");this._busyDialog.close();},context:this,sapSystem:this.SAP_SYSTEM});},onInit:function(){var t=this;if(jQuery.device.is.desktop){this.getOwnerComponent().setRouterSetCloseDialogs(false);}if(jQuery.device.is.ipad){$(window).on("orientationchange",function(e){t.getUIComponents().getHeaderContainer().rerender();});}sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();this._requestTimeLog={};this._busyDialog=new sap.m.BusyDialog();sap.sb_drilldown_app=this;this.EVALUATION=null;this.CONFIGURATION=null;this.SELECTED_VIEW=null;this.POPOVER_VIEW_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"VIEW_NAVIGATION":[]});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL=new sap.ui.model.json.JSONModel({"APP_NAVIGATION":[]});this.SEMANTIC_OBJECT=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject();this.ACTION=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getAction();this.use_CA=false;if(jQuery.sap.getUriParameters()&&jQuery.sap.getUriParameters().get("useCA")){this.use_CA=true;}this.urlParsingService=sap.ushell.Container.getService("URLParsing");this.metadataRef=sap.suite.ui.smartbusiness.Adapter.getService("ModelerServices");this.addExportMethodToTable();},updateFilter:function(){var f=this.getUIComponents().getFilter();var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(f.getVisible()){f.refreshFilter();}else{f.setVisible(true);}this._fixFacetListSelection();},onBeforeRendering:function(){},_initialize:function(){this.setHeaderFooterOptions(this.getHeaderFooterOptions());this._initExternalNavigationLinks();this.nDecimal=this.EVALUATION.getDecimalPrecision();this.oFormatOptions_ca={style:"standard"};this.oFormatOptions_core={style:"short"};this.oFormatOptions_percent={style:"percent"};if(!(this.nDecimal==null||this.nDecimal==-1)){this.oFormatOptions_ca.decimals=this.nDecimal;this.oFormatOptions_core.minFractionDigits=this.nDecimal;this.oFormatOptions_core.maxFractionDigits=this.nDecimal;}if(this.nDecimal==-1){this.oFormatOptions_ca.decimals=2;this.oFormatOptions_core.minFractionDigits=2;this.oFormatOptions_core.maxFractionDigits=2;}var w=this.EVALUATION.getKpiName()+" - "+this.EVALUATION.getTitle();try{if(sap.ushell.services.AppConfiguration&&sap.ushell.services.AppConfiguration.setWindowTitle){sap.ushell.services.AppConfiguration.setWindowTitle(w);}}catch(e){jQuery.sap.log.error("Error Setting Window Page Title : "+w)}var p=sap.suite.ui.smartbusiness.lib.Util.odata.properties(this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),this.EVALUATION.getEntitySet());this.COLUMN_LABEL_MAPPING=p.getLabelMappingObject();this.DIMENSION_TEXT_PROPERTY_MAPPING=p.getTextPropertyMappingObject();this.MEASURE_UNIT_PROPERTY_MAPPING=p.getUnitPropertyMappingObject();this._initAddToHomeDialogBox();var v=new sap.ui.model.json.JSONModel();v.setData(this.CONFIGURATION.getAllViews());var U=this.getUIComponents();if(this.use_CA)U.getChartToolbar().setModel(v,"VIEW_SWITCH");else U.getVizChartContainer().setModel(v,"VIEW_SWITCH");this.chartModel=new sap.ui.model.json.JSONModel();var c=9999;this.chartModel.setSizeLimit(c);if(this.use_CA)U.getChartToolbar().setModel(this.chartModel);else U.getVizChartContainer().setModel(this.chartModel);this.EvaluationHeaderModel=new sap.ui.model.json.JSONModel();U.getHeader().setModel(this.EvaluationHeaderModel);this.titleModel=new sap.ui.model.json.JSONModel();U.getPage().getCustomHeader().getContentMiddle()[0].setModel(this.titleModel);this.renderDrilldownHeader();this._initRequestTimeLogChart();this.hashChangeListener();sap.ui.Device.orientation.attachHandler(this.renderTitle,this);},applyTrendColor:function(W,C,a,b,g,k){var r=null;var w=parseFloat(W);var c=parseFloat(C);var d=parseFloat(a);var e=parseFloat(b);if(g=="MI"){if(d&&e){if(k<e){r=sap.ui.core.ValueState.Success;}else if(k<=d){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Error;}}}else if(g=="MA"){if(c&&w){if(k<c){r=sap.ui.core.ValueState.Error;}else if(k<=w){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Success;}}}else{if(w&&e&&c&&d){if(k<c||k>d){r=sap.ui.core.ValueState.Error;}else if((k>=c&&k<=w)||(k>=e&&k<=d)){r=sap.ui.core.ValueState.Warning;}else{r=sap.ui.core.ValueState.Success;}}}return r;},switchedToTableView:function(){if(this.getUIComponents().getChart()){this.setChartSelectionContextObject(null);}},switchedToChartView:function(){this.getUIComponents().getTable().setSelectedContext(null);},renderDrilldownHeader:function(){var f=this.CONFIGURATION.getFilters();var o=this.getUIComponents().getHeaderContainer();this.renderFilters(f);var h=this.CONFIGURATION.getHeaders();if(!((h&&h.length)||this.EVALUATION.getDescription())){this.getUIComponents().getHeader().setShowTitleSelector(false);}this.renderTitle();this.renderEvaluationHeader();},renderTitle:function(){var t=this.getUIComponents().getPage().getCustomHeader().getContentMiddle()[0];if(t){if(this.EVALUATION){t.setText(this.EVALUATION.getKpiName());}}},renderFilters:function(f){var a=this.getUIComponents().getFilter();a.setEvaluationData(this.EVALUATION);a.setEvaluationId(this.EVALUATION.getId());a.setDimensions(f);a.setSapSystem(this.SAP_SYSTEM);},displayMiniCharts:function(){var o=this.getUIComponents().getHeader();var a=this.getUIComponents().getHeaderContainer();var b=o.getAttributes()||[];if(a.getVisible()||b.length){a.setVisible(false);o.removeAllAttributes();}else{var h=this.CONFIGURATION.getHeaders();if(!(h&&h.length)){a.setVisible(false);}else{a.setVisible(true);this.renderKpiHeaders(h);}o.removeAllAttributes();o.addAttribute(new sap.m.ObjectAttribute({text:this.EVALUATION.getDescription()}));}this._fixPostResizeIssue();$(window).trigger('resize');},renderKpiHeaders:function(h){var s=this;var a=this.getUIComponents().getTileContainer();a.removeAllItems();this.miniChartManager=sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager.renderHeaders({allTiles:h,headerContainer:a,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters()});},renderView:function(c){this.table=null;this.chart=null;this.geoMap=null;this.analyticalMap=null;this._addUIComponents(c);var a=c.getColumns();var b=c.getChartConfiguration();this.renderTable(a,b[0].getColorScheme());if(this.chart){this.renderChart(c,b[0],a);}else if(this.analyticalMap){this.renderAnalyticalMap(c);}else if(this.geoMap){this.renderGeoMap(c);}},renderEvaluationHeader:function(){var o=this.getUIComponents().getHeader(),t=this;o.setTitle(this.EVALUATION.getTitle());var k=this.EVALUATION.getKpiMeasureName();var f=k;var a=this.MEASURE_UNIT_PROPERTY_MAPPING[k];o.bindProperty("number","/data/"+f,f!=k?function(v){return v}:function(v){if(v){var V=sap.ca.ui.model.format.NumberFormat.getInstance(t.oFormatOptions_ca);if(t.EVALUATION.getScaling()==-2){return(V.format(v*100)+"%");}else{return(V.format(v));}}return v;});if(a){o.bindProperty("numberUnit","/data/"+a);}},fetchKpiValue:function(){if(!this.CONFIGURATION.isAggregateValueEnabled()){return;}var t=this;var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),measure:this._getEvaluationThresholdMeasures(),filter:this.getAllFilters()});var s=new Date().getTime();var e=this._getEvaluationId();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS=function(d){var a=new Date().getTime();t._requestTimeLog["KPI_VALUE"]={title:"Kpi Value",time:a-s};if(d&&d.results.length){t.EvaluationHeaderModel.setData({data:d.results[0]});var h=t.getView().byId("header-ribbon");var k=d.results[0];if(t.EVALUATION){var b,W,C,c,g,j;b=parseFloat(k[t.EVALUATION.getKpiMeasureName()]);var l=t.EVALUATION.getThresholds();if(t.EVALUATION.getThresholdValueType()=="MEASURE"){var i,v=t.EVALUATION.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){W=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="CL"){C=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="CH"){c=k[v[i].COLUMN_NAME];}if(v[i].TYPE=="WH"){g=k[v[i].COLUMN_NAME];}}j=t.applyTrendColor(W,C,c,g,t.EVALUATION.getGoalType(),b);h.setNumberState(j);}else if(t.EVALUATION.getThresholdValueType()=="RELATIVE"){var i,m,v=t.EVALUATION.getValues().results;for(i=0;i<v.length;i++){if(v[i].TYPE=="TA"){m=k[v[i].COLUMN_NAME];break;}}for(i=0;i<v.length;i++){if(v[i].TYPE=="WL"){W=m*(k[v[i].COLUMN_NAME]/100);}if(v[i].TYPE=="CL"){C=m*(k[v[i].COLUMN_NAME]/100);}if(v[i].TYPE=="CH"){c=m*(k[v[i].COLUMN_NAME]/100);}if(v[i].TYPE=="WH"){g=m*(k[v[i].COLUMN_NAME]/100);}}j=t.applyTrendColor(W,C,c,g,t.EVALUATION.getGoalType(),b);h.setNumberState(j);}}sap.suite.ui.smartbusiness.lib.Util.cache.setKpiDetailsById(e,d);if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){var x=sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];x.resolve();}}else{delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];jQuery.sap.log.error("Couldn't fetch Aggregate Value. Response was "+d+" for uri : "+u.uri);t.EvaluationHeaderModel.setData({data:{}});}};this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL=function(a){jQuery.sap.log.error(a);t.EvaluationHeaderModel.setData({data:{}});if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){var x=sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];delete sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e];x.reject();}};var f=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(e);if(f){this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(f);}else if(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]){jQuery.when(sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]).then(function(){var d=sap.suite.ui.smartbusiness.lib.Util.cache.getKpiDetailsById(e);t.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS(d);},function(a){jQuery.sap.log.error(a)});}else{sap.suite.ui.smartbusiness.lib.Util.cache.current_calls[e]=jQuery.Deferred();this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_SUCCESS,this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF_FAIL);}},_addPopoverContent:function(c,i){var l=new sap.m.List({visible:{path:"/VIEW_NAVIGATION",formatter:function(A){if(A&&A.length>0){return true;}return false;}}});l.bindItems("/VIEW_NAVIGATION",new sap.m.StandardListItem({title:"{TITLE}",type:sap.m.ListType.Navigation,customData:new sap.ui.core.CustomData({key:"{ID}",value:"{ID}"}),press:jQuery.proxy(this._onViewSelection,this,{publishContext:true,isTable:!!i})}).setTooltip("{TITLE}"));var a=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());l.setModel(this.POPOVER_VIEW_NAVIGATION_MODEL);var b=new sap.m.List({});this._popoverNavigationListReferences.push(b);b.bindItems("/APP_NAVIGATION",new sap.m.StandardListItem({title:"{text}",type:sap.m.ListType.Navigation,customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationType}"}),press:jQuery.proxy(this._onAppSelection,this,{publishContext:true,isTable:!!i})}).setTooltip("{text}"));b.setModel(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL);var p=new sap.m.VBox({items:[l,b],width:"99%"});c.setPopoverFooter(p);},_addUIComponents:function(v){this.table=null;this.chart=null;this.geoMap=null;this.analyticalMap=null;if(this.use_CA){var c=this.getUIComponents().getChartToolbar();c.removeAllCharts();}else{var c=this.getUIComponents().getVizChartContainer();c.removeAllContent();}var a=v.getChartConfiguration()[0];if(a){var t=this;this._popoverNavigationListReferences=[];this.table=new sap.suite.ui.smartbusiness.drilldown.lib.CustomTable({mode:sap.m.ListMode.SingleSelectMaster}).addStyleClass("smartBusinessDrilldownTable");this.table.attachSelectionChange(function(){t._onTableRowSelected();});this.table.addEventDelegate({onAfterRendering:function(){t.switchedToTableView();}});this.table.setModel(this.getView().getModel("i18n"),"i18n");this._addPopoverContent(this.table,true);if(a.getChartType().isTable()){if(this.use_CA){c.addChart(this.table);}else{var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});b.setContent(this.table);c.addContent(b);}}else if(a.getChartType().isGeoMap()){}else if(a.getChartType().isAnalyticalMap()){try{this.analyticalMap=new sap.ui.core.mvc.JSView({viewName:"sap.suite.ui.smartbusiness.drilldown.view.AnalyticalMap",viewData:{parent:this}});}catch(e){jQuery.sap.log.error("Map view not available");jQuery.sap.log.error(e.message);throw(e);}if(this.use_CA){c.addChart(this.analyticalMap);}else{var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});var m=new sap.m.VBox({items:[this.analyticalMap],fitContainer:true});b.setContent(m);c.addContent(b);}}else{if(this.use_CA){this.chart=new sap.ca.ui.charts.Chart({showPopover:true,chartType:"Bar"});this.chart.setAdvancedChartSettings({plotArea:{animation:{dataLoading:false,dataUpdating:false,resizing:false}},legend:{title:{visible:false},isScrollable:true},yAxis:{title:{visible:true}},xAxis:{title:{visible:true}}});this.chart.addEventDelegate({onAfterRendering:function(){t.setChartSelectionContextObject(null);t.switchedToChartView();}});c.addChart(this.chart);c.addChart(this.table);this._addPopoverContent(this.chart,false);}else{this.chart=new sap.viz.ui5.controls.VizFrame({vizType:"bar",uiConfig:{applicationSet:'fiori'},});this.chart.setVizProperties({plotArea:{dataLabel:{visible:true,formatString:"dataLabelFormatter"}},legend:{title:{visible:false},isScrollable:true},title:{visible:false},valueAxis:{label:{formatString:"yValueAxisFormatter"}}});this.vizChartPopover=new sap.viz.ui5.controls.Popover().setFormatString("vizPopOver");this.vizChartPopover.connect(this.chart.getVizUid());this.chart.addEventDelegate({onAfterRendering:function(){t.switchedToChartView();}});var d=new sap.suite.ui.commons.ChartContainerContent({icon:"sap-icon://bar-chart",});d.setContent(this.chart);c.addContent(d);var b=new sap.suite.ui.commons.ChartContainerContent({icon:'sap-icon://table-chart',});b.setContent(this.table);c.addContent(b);}}}else{jQuery.sap.log.error("NO Chart Configuration found!! ");}},_setNoDataText:function(p){this.table.setNoDataText(this.getView().getModel("i18n").getProperty(p));if(this.chart){if(this.use_CA){this.chart.setNoData(new sap.m.Label({text:this.getView().getModel("i18n").getProperty(p)}));}else{}}},fetchDataForChart:function(){if(this.use_CA)var c=this.getUIComponents().getChartToolbar();else var c=this.getUIComponents().getVizChartContainer();var V=this.SELECTED_VIEW;var t=this;try{this.chartModel.setData({data:[]});c.setBusy(true);var d=[].concat(this.SELECTED_VIEW.getDimensions());var m=this.SELECTED_VIEW.getMeasures();var s=null;if(this.TABLE_SORTING&&this.TABLE_SORTING.length){s=this.TABLE_SORTING;}else if(this.COLUMNS_SORT&&this.COLUMNS_SORT.length){s=this.COLUMNS_SORT;}var a=null;try{var D=window.parseInt(this.SELECTED_VIEW.getChartConfiguration()[0].getDataLimit());if(isNaN(D)){jQuery.sap.log.error("Invalid Data Limit Value : "+a);}else{if(D!=-1){a=D;}}}catch(e){jQuery.sap.log.error("Error parsing Data Limit Value")}var u=sap.suite.ui.smartbusiness.lib.Util.odata.getUri({serviceUri:this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM),entitySet:this.EVALUATION.getEntitySet(),dimension:d,measure:m,filter:this.getAllFilters(),sort:s,dataLimit:a});this._setNoDataText("DATA_LOADING");var b=new Date().getTime();this.CHART_TABLE_DATA_ODATA_CALL_REF=u.model.read(u.uri,null,null,true,function(f){var g=new Date().getTime();t._requestTimeLog["CHART_TABLE_DATA"]={title:"Chart/Table Data",time:g-b};if(f.results.length===0){t._setNoDataText("DATA_NODATA");}t.chartModel.setData({data:f.results});c.setBusy(false);if(t.getUIComponents().getChart()){if(t.use_CA){var p=t.getChartPopoverFormatter();t.getUIComponents().getChart().setPopoverFormatter(p);}else{t.setAllVizFormatters();}}if(f.results.length){t._appendUOMToTableHeader(f.results[0]);if(t.use_CA){t._appendUOMToChartAxis(f.results[0]);}else{t._appendUOMToVizChartAxis(f.results[0]);}}},function(){jQuery.sap.log.error("Error fetching data : "+u.uri);t._setNoDataText("DATA_LOADING_FAILED");t.chartModel.setData({data:[]});c.setBusy(false);t.chartModel.setData({data:[]});});}catch(e){t._setNoDataText("DATA_LOADING_FAILED");jQuery.sap.log.error(e);c.setBusy(false);this.chartModel.setData({data:[]});}},_getTableContextParameters:function(d){var e={};var t=this.getUIComponents().getTable().getSelectedContext();if(t&&t.length){t.forEach(function(a){d.forEach(function(b){var c=a[b];if(c==null){c="SAP_SMARTBUSINESS_NULL";}if(c||c==0||c==''){if(c.getTime){c=c.getTime();}if(!e[b]){e[b]=[];}e[b].push(c);}});});}return e;},_getChartContextParameters:function(d){var e,c;c=this.getChartSelectionContextObject();e={};if(c){var a=this.getUIComponents().getChart().getDataset();for(var b in c){var f=c[b];var g=a.findContext(f).getObject();d.forEach(function(h){var i=g[h];if(i==null){i="SAP_SMARTBUSINESS_NULL";}if(i||i==0||i==''){if(i.getTime){i=i.getTime();}if(e[h]){e[h].push(i);}else{e[h]=[];e[h].push(i);}}});}}return e;},_onViewSelection:function(c,e){var v=e.getSource().getCustomData()[0].getKey();var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var d=this.SELECTED_VIEW.getDimensions();var a=this[c.isTable?"_getTableContextParameters":"_getChartContextParameters"](d,false);for(var b in a){if(p[b]){delete p[b];}p[b]=a[b]}p["viewId"]=v;sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(p,false);if(c.isTable){this.getUIComponents().getTable().setSelectedContext(null);}else{this.setChartSelectionContextObject(null);}sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateHash();},getChartSelectionContextObject:function(){if(this.use_CA){return this._chartPopoverContext;}},setChartSelectionContextObject:function(v){if(this.use_CA){this._chartPopoverContext=v;}},_detachHashChangeListener:function(){try{this.hashChanger.detachEvent("hashChanged",this._proxyHashChangeListener);this._proxyHashChangeListener=null;}catch(e){jQuery.sap.log.error("Error Detaching hashChanged Event");}},_onAppSelection:function(c,e){var a=function(i,m){if(m){for(var p in m){if(i&&i[p]){delete i[p];}}}};var b,n=e.getSource().getCustomData()[0].getKey();var d=e.getSource().getCustomData()[0].getValue();var s=n.split("~")[0];var f=s.split("-");var g=f[0];var h=f[1];var i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(g=="AdhocAnalysis"){i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();}var j=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();var k={};var l=this.SELECTED_VIEW.getDimensions();if(c.isFromOpenIn){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);b=this.use_CA?this._getChartContextParameters(l):this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{if(c.isTable){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{b=this._getChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}}jQuery.extend(true,k,j,i);if(sap.ushell.Container&&sap.ushell.Container.getService){var C=sap.ushell.Container.getService("CrossApplicationNavigation");if(C){var t=C.hrefForExternal({target:{semanticObject:g,action:h},params:k});if(d=="SAPUI5"){this._detachHashChangeListener();}window.location.hash=t;}else{jQuery.sap.log.error("ushell CrossApplicationNavigation service returns null");}}else{jQuery.sap.log.error("ushell Services not running");}},_fillChartTablePopoverContent:function(){var t=this;var v=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());this.POPOVER_VIEW_NAVIGATION_MODEL.setData({VIEW_NAVIGATION:v});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:[]});if(this._popoverNavigationListReferences&&this._popoverNavigationListReferences.length){this._popoverNavigationListReferences.forEach(function(n){n.setNoDataText(" ");n.setBusy(true);},this);}t._fetchNavigationLinks().done(function(){var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");t.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF=N.getLinksByContext({semanticObject:t.SEMANTIC_OBJECT,dimensions:t.SELECTED_VIEW.getDimensions(),context:t,viewId:t.EVALUATION.getId()+"_"+t.SELECTED_VIEW.getId(),success:function(l){var O=jQuery.extend({},t._OPEN_IN_LINKS);var u=t._getUniqueNavLinks(l,O);if(u.length){t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:u});}if(t._popoverNavigationListReferences&&t._popoverNavigationListReferences.length){t._popoverNavigationListReferences.forEach(function(n){n.setBusy(false);n.setNoDataText("-");},t);}}});});},_getListOfViewsForPopover:function(a,e){var b=[];a.forEach(function(v){if(v.ID!==e){b.push(jQuery.extend(false,{},v));}});return b;},_onTableRowSelected:function(){this._fillChartTablePopoverContent();},_onChartDataPointSelection:function(e){var g=function(c){var a=Object.keys(c).sort();var b="";a.forEach(function(k){b+=k+"#"+c[k]+"#";});return b;};this._chartPopoverContext=this._chartPopoverContext||{};var s=e.getParameter("srcEvent");var d=s.getParameter("data")||[];d.forEach(function(S){contextPath=S.data[0].ctx.path;var _=g(contextPath);if(this._chartPopoverContext[_]){delete this._chartPopoverContext[_];}else{this._chartPopoverContext[_]=contextPath;}},this);if(this.chart.getInternalVizChart().getVIZInstance().selection().length==0){this.setChartSelectionContextObject(null);}this._fillChartTablePopoverContent();},_getStacking:function(c){var s={stacking:false,dimensionStacked:false,measureStacked:false,stackedDimensionName:null};var a=this.SELECTED_VIEW;c.forEach(function(e){var C=a.findColumnByName(e);if(C.isMeasure()){if(C.isStacked()){s.stacking=true;s.measureStacked=true;return false;}}});if(!s.stacking){c.forEach(function(e){var C=a.findColumnByName(e);if(C.isDimension()){if(C.isStacked()){s.stacking=true;s.dimensionStacked=true;if(C.getAxis()==2){s.stackedDimensionName=C.getName();return false;}}}});}return s;},_getEvaluationThresholdMeasures:function(){var t=[];t.push(this.EVALUATION.getKpiMeasureName());if(this.EVALUATION.getThresholdValueType()==="MEASURE"){var a=this.EVALUATION.getValues().results;if(a&&a.length){for(var i=0;i<a.length;i++){if((a[i]).COLUMN_NAME&&!((a[i]).FIXED)){t.push((a[i]).COLUMN_NAME);}}}}return t;},_addDimensionAndMeasureToDataset:function(c,d,C,a){this.thresholdMeasuresArray=this._getEvaluationThresholdMeasures();var s=this._getStacking(a);var V=this.SELECTED_VIEW;var o=C.getChartType();if((o.isBar()||o.isColumn())&&s.dimensionStacked){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isDimension()){var A=1;if(e.getName()==s.stackedDimensionName&&V.getDimensionCount()>1){A=2;c.setStackedChartWidthEnhancer(true);}var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],axis:A,value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],true)}});D.column_name=e.getName();d.addDimension(D);}},this);}else{a.forEach(function(b){var e=V.findColumnByName(b);if(e.isDimension()){var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],axis:1,value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[e.getName()],true)}});D.column_name=e.getName();d.addDimension(D);}},this);}if(o.isLine()||o.isCombination()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m);}},this);}else if(o.isBubble()){var _=0;a.forEach(function(b,i){var e=V.findColumnByName(b);if(e.isMeasure()){++_;var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],group:_,value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m);}},this);}else if(o.isBar()||o.isColumn()){if(C.isSingleAxis()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m);}},this);}else if(C.isDualAxis()){a.forEach(function(b){var e=V.findColumnByName(b);if(e.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({group:e.getAxis(),name:this.COLUMN_LABEL_MAPPING[e.getName()],value:{path:e.getName()}});m.column_name=e.getName();d.addMeasure(m);}},this);}}},_appendUOMToChartAxis:function(d){var c,m,a,U,u,b,e,f,g;var h=function(o){var k=[];for(var l in o){k.push(o[l]);}return k.join(" & ");};var i=function(A){return{title:{visible:true,text:A}};};c=this.getUIComponents().getChart();if(!c){return;}m=this.SELECTED_VIEW.getMeasures();a=c.getAdvancedChartSettings()||{};U={};u=false;if(m.length==1&&m[0]==this.EVALUATION.getKpiMeasureName()){var M=m[0];b=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(b){e=d[b];if(e){U[M]=e;u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{m.forEach(function(M){b=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(b){e=d[b];if(e){U[M]=this.COLUMN_LABEL_MAPPING[M]+" ("+e+")";u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}},this);}f=this.SELECTED_VIEW.getChartConfiguration()[0];g=f.getChartType();if(u){if(g.isColumn()||g.isBar()){if(f.isSingleAxis()){if(g.isBar()){a.xAxis=i(h(U));}else{a.yAxis=i(h(U));}}else{var x={},j={};m.forEach(function(M){var o=this.SELECTED_VIEW.findMeasureByName(M);if(o.getAxis()==1){x[M]=U[M];}else if(o.getAxis()==2){j[M]=U[M];}},this);if(g.isBar()){a.xAxis=i(h(j));a.xAxis2=i(h(x));}else{a.yAxis=i(h(x));a.yAxis2=i(h(j));}}}else if(g.isBubble()){var D=c.getDataset().getMeasures();D.forEach(function(o){var s=o.column_name;var l=U[s];if(o.getGroup()==1){a.xAxis=i(l);}else if(o.getGroup()==2){a.yAxis=i(l);}},this);}else if(g.isTable()){}else{a.yAxis=i(h(U));}}},_updateAxisLabelIfRequired:function(c,d,C,a){var o=C.getChartType();var V=this.SELECTED_VIEW;var b=c.getAdvancedChartSettings()||{};var I="("+this.getView().getModel("i18n").getProperty("IN_PERCENTAGE")+")";var g=function(l){return{title:{visible:true,text:l}};};if(C.isPercentageValue()){if(o.isBar()||o.isColumn()){var m=V.getMeasures();if(C.isSingleAxis()){var M=[];m.forEach(function(i){M.push(this.COLUMN_LABEL_MAPPING[i]);},this);var s=M.join(" & ")+I;if(o.isColumn()){b.yAxis=g(s);}else{b.xAxis=g(s);}}else{var f=[];var S=[];m.forEach(function(i){var j=V.findMeasureByName(i);if(j.getAxis()==1){f.push(this.COLUMN_LABEL_MAPPING[i]);}else if(j.getAxis()==2){S.push(this.COLUMN_LABEL_MAPPING[i]);}},this);var e=f.join(" & ")+I;var h=S.join(" & ")+I;if(o.isColumn()){b.yAxis=g(e);b.yAxis2=g(h);}else{b.xAxis2=g(e);b.xAxis=g(h);}}}}},renderChart:function(v,c,a){var t=this;var b=this.getUIComponents().getChart();if(!c||!a.length)return;var d=this.getUIComponents().getCAvbox();var e=this.getUIComponents().getVIZvbox();if(this.use_CA){d.setVisible(true);e.setVisible(false);b.attachSelectDataPoint(jQuery.proxy(this._onChartDataPointSelection,this));var f=new sap.viz.core.FlattenedDataset({data:{path:"/data"}});b.setStackedChartWidthEnhancer(false);this._addDimensionAndMeasureToDataset(b,f,c,a);b.setChartType(this.getCAChartType(c,v));b.setDataset(f);this.setChartLabelFormatters(b,c,this.SELECTED_VIEW);this._overrideChartAxisLabelFormatters(b,c);if((this.EVALUATION.getScaling()==-2)&&(c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){this._handleDualAxisWhenPercentScale(b,c.getChartType());}this.applyColorToChart(b,c);}else{d.setVisible(false);e.setVisible(true);b.addEventDelegate({onAfterRendering:function(){t._fillVizChartPopoverContent(t.vizChartPopover,false);}});b.attachSelectData(jQuery.proxy(this._onVizChartDataPointSelection,this,{chartPopover:this.vizChartPopover}));var f=this.create_vizDataset(c,a);var V=this.getVizTypeAndIcon(c,v);b.setVizType(V.type);b.getParent().setIcon(V.icon);b.setDataset(f);this._addFeedsToVizFrame(b,c,a);this.applyColorToVizChart(b,c);if(c.isDualAxis()||c.getChartType().isBubble()){var p=this.chart.getVizProperties();p.valueAxis2={label:{formatString:"y2ValueAxisFormatter"}};this.chart.setVizProperties(p);if((this.EVALUATION.getScaling()==-2)&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){this._handleVizDualAxisWhenPercentScale(t.chart);}}}this._showChartLegendIfApplicable(c,a);},renderAnalyticalMap:function(v){var a=this.getUIComponents().getAnalyticalMap();var m=a.analyticalMap.getParent().getController();m.renderMap();},renderGeoMap:function(v){var g=this.getUIComponents().getGeoMap();},_showChartLegendIfApplicable:function(c,C){if(this.use_CA)var o=this.getUIComponents().getChartToolbar();else var o=this.getUIComponents().getVizChartContainer();var s=this._getStacking(C);var V=this.SELECTED_VIEW;var a=c.getChartType();var i=((a.isBar()||a.isColumn())&&s.dimensionStacked&&s.stackedDimensionName&&(V.getDimensionCount()>1))?true:false;if((V.getMeasures().length>1)||(i)){o.setShowLegend(true);}else{o.setShowLegend(false);}},_overrideChartAxisLabelFormatters:function(c,C){var p=sap.ca.ui.model.format.NumberFormat.getInstance({});if(C.isPercentageValue()){var o=C.getChartType();if(o.isBar()){c.setXAxisLabelFormatter(function(r){return p.format_percentage(r);});c.setYAxisLabelFormatter(function(r){return r;});if(C.isDualAxis()){c.setXAxis2LabelFormatter(function(r){return p.format_percentage(r);});}}else if(o.isColumn()){c.setYAxisLabelFormatter(function(r){return p.format_percentage(r);});c.setXAxisLabelFormatter(function(r){return r;});if(C.isDualAxis()){c.setYAxis2LabelFormatter(function(r){return p.format_percentage(r);});}}}},_handleDualAxisWhenPercentScale:function(c,a){var t=this;var V=this.SELECTED_VIEW;var m=V.getMeasures();var b=this._getMeasuresByAxis();var i=this._isMeasureSetPercentScaled(b.axis1Msr);var d=this._isMeasureSetPercentScaled(b.axis2Msr);var l=[[],[]];if(i)l[0].push(t._getChartPercentFormatter());else l[0].push(t._getChartNumberFormatter());if(d)l[1].push(t._getChartPercentFormatter());else l[1].push(t._getChartNumberFormatter());c.setDataLabelFormatter(l);if(a.isBar()){c.setXAxisLabelFormatter(i?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setYAxisLabelFormatter(t._pseudoChartFormatter);c.setXAxis2LabelFormatter(d?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setYAxis2LabelFormatter(t._pseudoChartFormatter);}else if(a.isColumn()){c.setXAxisLabelFormatter(t._pseudoChartFormatter);c.setYAxisLabelFormatter(i?t._getChartPercentFormatter():t._getChartNumberFormatter());c.setXAxis2LabelFormatter(t._pseudoChartFormatter);c.setYAxis2LabelFormatter(d?t._getChartPercentFormatter():t._getChartNumberFormatter());}},_isEvaluationThresholdMeasure:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length){if(t.indexOf(m)!=-1){return true;}}return false;},_getMeasuresByAxis:function(){var t=this;var V=this.SELECTED_VIEW;var m=V.getMeasures();var a=[],b=[];for(var i=0;i<m.length;i++){var c=V.findColumnByName(m[i]);if(c.isMeasure()&&(c.getAxis()==1)){a.push(m[i]);}else if(c.isMeasure()&&(c.getAxis()==2)){b.push(m[i]);}}return{axis1Msr:a,axis2Msr:b}},_isMeasureSetPercentScaled:function(m){if(this.thresholdMeasuresArray&&this.thresholdMeasuresArray.length){var t=this.thresholdMeasuresArray;}else{var t=this._getEvaluationThresholdMeasures();}if(t&&t.length&&m&&m.length){for(var i=0;i<m.length;i++){if(t.indexOf(m[i])!=-1){return true;}}}return false;},setChartLabelFormatters:function(c,o,v){var i=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());if((this.EVALUATION.getScaling()==-2)&&!((o.isPercentageValue())&&(o.getChartType().isBar()||o.getChartType().isColumn()))&&i){var f=this.getChartLabelFormatter(o,v,true);c.setXAxisLabelFormatter(f.x1);c.setYAxisLabelFormatter(f.y1);c.setXAxis2LabelFormatter(f.x2);c.setYAxis2LabelFormatter(f.y2);c.setDataLabelFormatter(f.dataLabel);}else{var f=this.getChartLabelFormatter(o,v);c.setXAxisLabelFormatter(f.x1);c.setYAxisLabelFormatter(f.y1);c.setXAxis2LabelFormatter(f.x2);c.setYAxis2LabelFormatter(f.y2);c.setDataLabelFormatter(f.dataLabel);}},_pseudoChartFormatter:function(s){return s;},_getChartNumberFormatter:function(i,d){jQuery.sap.require("sap.ca.ui.model.format.AmountFormat");function a(n){return!isNaN(parseFloat(n))&&isFinite(n);}var f={style:i?'standard':'short'};if(!(this.nDecimal==null||this.nDecimal==-1)){if(i){f["decimals"]=d;}f["shortDecimals"]=d;}var c=sap.ca.ui.model.format.AmountFormat.getInstance('',f);return function(s){return a(s)?c.format(s):s;};},_getChartPercentFormatter:function(){var t=this;jQuery.sap.require("sap.ui.core.format.NumberFormat");var p=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_percent);function i(n){return!isNaN(parseFloat(n))&&isFinite(n);}return function(s){return i(s)?p.format(s):s;};},getChartLabelFormatter:function(c,v,i){if(i){var f={x1:this._pseudoChartFormatter,y1:this._getChartPercentFormatter(),x2:this._pseudoChartFormatter,y2:this._pseudoChartFormatter,dataLabel:[[this._getChartPercentFormatter()],[this._getChartPercentFormatter()],[this._getChartPercentFormatter()]]};}else{var f={x1:this._pseudoChartFormatter,y1:this._getChartNumberFormatter(false,1),x2:this._pseudoChartFormatter,y2:this._pseudoChartFormatter,dataLabel:[[this._getChartNumberFormatter(false,this.nDecimal)],[this._getChartNumberFormatter(false,this.nDecimal)],[this._getChartNumberFormatter(false,this.nDecimal)]]};}if(c.getChartType().isBubble()||(c.getChartType().isBar()&&c.isAbsoluteValue())){if(i)f.x1=this._getChartPercentFormatter();else f.x1=this._getChartNumberFormatter(false,1);}if(c.getChartType().isBar()||(c.getChartType().isColumn()&&c.isStackingEnabled(v)&&c.isPercentageValue())){f.y1=this._pseudoChartFormatter;}if(c.getChartType().isBar()&&c.isDualAxis()&&c.isStackingEnabled(v)){if(i)f.x2=this._getChartPercentFormatter();else f.x2=this._getChartNumberFormatter(false,1);}if(c.getChartType().isColumn()&&c.isStackingEnabled(v)&&c.isDualAxis()){if(i)f.y2=this._getChartPercentFormatter();else f.y2=this._getChartNumberFormatter(false,1);}return f;},getColumnValueFormatter:function(n,i,a,b){var t=this;var V=this.SELECTED_VIEW;var c=(V.getChartConfiguration())[0];var f;if(i){f=function(s){return s==0?s+"":s;}}else{if(a){if(c.getChartType().isTable()){if(t._isEvaluationThresholdMeasure(n))f=this._getChartPercentFormatter();else f=this._getChartNumberFormatter(true,this.nDecimal);}else if((c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){var C=V.findColumnByName(n);if(b[(C.getAxis())-1])f=this._getChartPercentFormatter();else f=this._getChartNumberFormatter(true,this.nDecimal);}else{f=this._getChartPercentFormatter();}}else f=this._getChartNumberFormatter(true,this.nDecimal);}var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var m=sap.suite.ui.smartbusiness.lib.Util.odata.getEdmType(u,n,true);var T=m.type;var F=m.format;F=F.toUpperCase();if(T=='Edm.DateTime'){if(!sap.suite.ui.smartbusiness.lib.Util.odata.isTimeZoneIndependent(u,this.EVALUATION.getEntitySet())){var d;if(F=="DATE"||F=="NONE"){d="daysAgo";}else if(F=="DATETIME"){d="";}if(d){var o=new sap.ca.ui.model.type.Date({style:d});f=function(s){return o.formatValue(s,"string");}}else{var o=sap.ui.core.format.DateFormat.getDateTimeInstance();f=function(e){if(e&&e.getMinutes){return o.format(e);}return e;}}}else{f=function(e){if(e&&e.getMinutes){e.setMinutes(e.getMinutes()+e.getTimezoneOffset());var g=(F=="DATE")?"getDateInstance":"getDateTimeInstance";return sap.ui.core.format.DateFormat[g]().format(e);}return e;}}}return f;},getChartPopoverFormatter:function(){jQuery.sap.require("sap.ui.core.format.NumberFormat");jQuery.sap.require("sap.ca.ui.model.format.AmountFormat");var c=this.SELECTED_VIEW.getChartConfiguration()[0];var f=[[],[],[]];var t=this;var V=this.SELECTED_VIEW;var m=this.SELECTED_VIEW.getMeasures();var u=this.MEASURE_UNIT_PROPERTY_MAPPING;var C=c.getChartType();var U=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var e=this.EVALUATION.getEntitySet();var d=this.getUIComponents().getChart().getModel().getData().data;var p=sap.ui.core.format.NumberFormat.getPercentInstance(this.oFormatOptions_percent);var i=((this.EVALUATION.getScaling()==-2)&&(this._isMeasureSetPercentScaled(m)));function _(M,U,e,j){var l=sap.suite.ui.smartbusiness.lib.Util.odata.getFormattingMetadata(U,e,M);return function(v){if(l._hasSapText){return sap.ca.ui.model.format.AmountFormat.FormatAmountStandard(v);}else if(l._hasCurrency){var n=(j&&j[0])?j[0][l._currencyColumn]?j[0][l._currencyColumn]:"":"";return sap.ca.ui.model.format.AmountFormat.FormatAmountStandardWithCurrency(v,n);}else{var o="";var d=t.getUIComponents().getChart().getModel().getData().data;if(d&&d.length){o=(d&&d[0])?d[0][u[M]]?" "+d[0][u[M]]:"":"";d[0][u[M]]}var q=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);return q.format(v)+o;}}}function a(M){return function(v){return p.format(v);}}if(c.isPercentageValue()){for(var k=0;k<m.length;k++){f[0].push(function(v){return p.format(v);});f[1].push(function(v){return p.format(v);});}}else{if((c.isDualAxis())&&(c.isAbsoluteValue())&&(c.getChartType().isBar()||c.getChartType().isColumn())){var b=this._getMeasuresByAxis();var g=this._isMeasureSetPercentScaled(b.axis1Msr);var h=this._isMeasureSetPercentScaled(b.axis2Msr);if(i&&g){for(var k=0;k<b.axis1Msr.length;k++){f[0].push(a((b.axis1Msr)[k]));}}else{for(var k=0;k<b.axis1Msr.length;k++){f[0].push(_((b.axis1Msr)[k],U,e,d));}}if(i&&h){for(var k=0;k<b.axis2Msr.length;k++){f[1].push(a((b.axis2Msr)[k]));}}else{for(var k=0;k<b.axis2Msr.length;k++){f[1].push(_((b.axis2Msr)[k],U,e,d));}}}else if(c.getChartType().isBubble()){for(var k=0;k<m.length;k++){if(!(f[k]))f[k]=[];if(i)f[k].push(a(m[k]));else f[k].push(_(m[k],U,e,d));}}else{for(var k=0;k<m.length;k++){if(i)f[0].push(a(m[k]));else f[0].push(_(m[k],U,e,d));}}}return f;},applyColorToChart:function(c,a){var t=a.getThresholdMeasure();var C=this;var b=a.getColorScheme();if(!b.getText()){jQuery.sap.log.error("Color Scheme Value Missing");return;}var m=c.getDataset().getMeasures();if(b.isManual()){m.forEach(function(M,i,o){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getColor();if(!_){if(b.isManualSemantic()){jQuery.sap.log.warning("Semantic Color NOT found for measure name : "+M.getName()+", assigning default to 'Neutral Light'");_="sapCaUiChartSemanticColor-Neutral-Light";}else{jQuery.sap.log.warning("Color NOT found for measure name : "+M.getName()+", assigning default color");_="";}}M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:_}));},this);}else if(b.isAutoSemantic()&&!this.EVALUATION.isTargetKpi()){if(t){m.forEach(function(M,i,o){if(M.getName()==t){M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:sap.ca.ui.charts.ChartSemanticColor.Neutral}));}else{M.addCustomData(new sap.ui.core.CustomData({key:"fillColor",value:sap.ca.ui.charts.ChartSemanticColor.Good}));}},this);c.setChartSemanticColorFormatter(function(o){var d=c.getModel().getData().data;var e=o.ctx.path.dii_a1;var f=d[e];var r=f[t];if(r!=null&&typeof r!='undefined'){if(C.EVALUATION.isTargetKpi()){if(o.val==r){return sap.ca.ui.charts.ChartSemanticColor.Neutral;}return sap.ca.ui.charts.ChartSemanticColor.NeutralLight;}else{if(o.val>r){if(C.EVALUATION.isMaximizingKpi()){return sap.ca.ui.charts.ChartSemanticColor.Good;}return sap.ca.ui.charts.ChartSemanticColor.Bad;}else if(o.val<r){if(C.EVALUATION.isMinimizingKpi()){return sap.ca.ui.charts.ChartSemanticColor.Good}return sap.ca.ui.charts.ChartSemanticColor.Bad;}else{return sap.ca.ui.charts.ChartSemanticColor.Neutral;}}}else{jQuery.sap.log.error("Threshold Measure:'"+t+"'  not in Dataset. Error Applying Semantic Color");return sap.ca.ui.charts.ChartSemanticColor.NeutralLight;}});}else{jQuery.sap.log.error("Chart Color Scheme is Auto-Semantic but no threshold measure Configured!!!");}}else{jQuery.sap.log.debug("Color Scheme is None: Default Color will be used by CA Chart");}if(b.isAutoSemantic()){if(this.EVALUATION.isTargetKpi()){jQuery.sap.log.error("Auto Semantic Coloring can not be applied on target type KPI");}}},getCAChartType:function(c,v){if(c.getChartType().isBar()){if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){return sap.ca.ui.charts.ChartType.StackedBar;}else{return sap.ca.ui.charts.ChartType.Bar;}}else{return sap.ca.ui.charts.ChartType.StackedBar100;}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){return sap.ca.ui.charts.ChartType.DualStackedBar;}else{return sap.ca.ui.charts.ChartType.DualStackedBar100;}}}else if(c.getChartType().isColumn()){if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){return sap.ca.ui.charts.ChartType.StackedColumn;}else{return sap.ca.ui.charts.ChartType.Column;}}else{return sap.ca.ui.charts.ChartType.StackedColumn100;}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){return sap.ca.ui.charts.ChartType.DualStackedColumn;}else{return sap.ca.ui.charts.ChartType.DualStackedColumn100;}}}else{return c.getChartType().getText();}},_getVisibleColumns:function(d){var v=[];d.forEach(function(c,i,a){var C=this.SELECTED_VIEW.findColumnByName(c);if(C.isVisibleInTable()){v.push(c);}},this);return v;},_getValueState:function(a,t){if(!this.EVALUATION.isTargetKpi()){if(a<t){return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Error:sap.ui.core.ValueState.Success;}else if(a==t){return sap.ui.core.ValueState.None;}else{return this.EVALUATION.isMaximizingKpi()?sap.ui.core.ValueState.Success:sap.ui.core.ValueState.Error;}}else{return sap.ui.core.ValueState.None;}},_getTableCell:function(o,c,i,a){var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var b=this.EVALUATION.getEntitySet();var f=sap.suite.ui.smartbusiness.lib.Util.odata.getFormattingMetadata(u,b,o);var t=this.SELECTED_VIEW.getChartConfiguration()[0]&&this.SELECTED_VIEW.getChartConfiguration()[0].getThresholdMeasure();var d=this;function _(m){jQuery.sap.require("sap.ca.ui.model.format.AmountFormat");return function(s,e){return sap.ca.ui.model.format.AmountFormat.FormatAmountStandard(s,e);};}if(f._hasCurrency&&!i){if(this.EVALUATION.isTargetKpi()){return new sap.m.Label({text:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()}});}else{if(c.isAutoSemantic()&&t){return new sap.m.ObjectNumber({number:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()},state:{parts:[{path:o},{path:t}],formatter:function(m,g){try{m=window.parseFloat(m);g=window.parseFloat(g);return d._getValueState(m,g);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{parts:[{path:o},{path:f._currencyColumn}],formatter:_()}});}}}else{if(this.EVALUATION.isTargetKpi()){return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}});}else{if(c.isAutoSemantic()&&t){return new sap.m.ObjectNumber({number:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)},state:{parts:[{path:o},{path:t}],formatter:function(m,g){try{m=window.parseFloat(m);g=window.parseFloat(g);return d._getValueState(m,g);}catch(e){return sap.ui.core.ValueState.None;}}}});}else{return new sap.m.Label({text:{path:o,formatter:this.getColumnValueFormatter(o,false,i,a)}});}}}},_sortTableByColumnName:function(c){var i={"asc":String.fromCharCode(0xe1e1),"desc":String.fromCharCode(0xe1e2)};var s=null;if(c.sort_by===void(0)){s="desc";}else{s=c.sort_by=="asc"?"desc":"asc";}c.sort_by=s;var a=this.getUIComponents().getTable().getColumns();a.forEach(function(C){var h=C.getHeader();h.setText(h.dimension_label+(h.UOM?" ("+h.UOM+")":""));});c.setText(i[s]+" "+c.dimension_label+(c.UOM?" ("+c.UOM+")":""));var C=this.SELECTED_VIEW.findColumnByName(c.dimension_key);var b=C.getSortBy();this.TABLE_SORTING=[{name:b,order:s}];this.fetchDataForChart();},_appendUOMToTableHeader:function(r){if(this.UOM_APPENDED_TO_HEADER){return;}var c=this.getUIComponents().getTable().getColumns();c.forEach(function(C){var a=C.getHeader().getText();var b=C.column_name;var o=this.SELECTED_VIEW.findColumnByName(b);if(o.isMeasure()){var u=this.MEASURE_UNIT_PROPERTY_MAPPING[b];if(u!==b){var d=r[u];if(d){C.getHeader().UOM=d;C.getHeader().setText(a+" ("+d+")");}}}},this);this.UOM_APPENDED_TO_HEADER=true;},renderTable:function(t,c){var a=this;var b=this.getUIComponents().getCAvbox();var v=this.getUIComponents().getVIZvbox();if(this.use_CA){b.setVisible(true);v.setVisible(false);}else{b.setVisible(false);v.setVisible(true);}var d=this.getUIComponents().getTable();var C=(this.SELECTED_VIEW.getChartConfiguration())[0];d.removeAllColumns();var S=this.SELECTED_VIEW;var e=this._getVisibleColumns(t);this.COLUMNS_SORT=[];t.forEach(function(s,n,p){var o=this.SELECTED_VIEW.findColumnByName(s);if(o.getSortBy()&&o.getSortOrder()){if(o.getSortOrder()=="asc"||o.getSortOrder()=="desc"){this.COLUMNS_SORT.push({name:o.getSortBy(),order:o.getSortOrder()});}}},this);var f=false;if((this.EVALUATION.getScaling()==-2)&&!((C.isPercentageValue())&&(C.getChartType().isBar()||C.getChartType().isColumn()))){f=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());}var g=[];if(f){if((C.isDualAxis())&&(C.isAbsoluteValue())&&(C.getChartType().isBar()||C.getChartType().isColumn())){var h=this._getMeasuresByAxis();g.push(this._isMeasureSetPercentScaled(h.axis1Msr));g.push(this._isMeasureSetPercentScaled(h.axis2Msr));}}var j=new sap.m.ColumnListItem();for(var i=0,l=e.length;i<l;i++){var o=this.SELECTED_VIEW.findColumnByName(e[i]);var L=new sap.m.Label({text:this.COLUMN_LABEL_MAPPING[e[i]]}).addStyleClass("tableColumnHeader");L.dimension_key=e[i];L.dimension_label=this.COLUMN_LABEL_MAPPING[e[i]];L.attachBrowserEvent("click",function(){a._sortTableByColumnName(this);});var k=new sap.m.Column({hAlign:o.isMeasure()?"End":"Begin",styleClass:"qty",header:L,minScreenWidth:"Tablet",demandPopin:true,});k.column_name=e[i];if(o.isMeasure()){var m=this._getTableCell(e[i],c,f,g);j.addCell(m);}else{var m=new sap.m.Label({text:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[e[i]],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[e[i]],true)}});j.addCell(m);}d.addColumn(k);}d.bindAggregation("items","/data",j);},_abortPendingODataCalls:function(){var a=function(d){try{if(d){d.abort();}}catch(e){}};var b=function(o){if(o&&o.length){o.forEach(function(c){a(c);});}};a(this.DDA_CONFIG_ODATA_CALL_REF);a(this._bundled_evaluations_call_ref);a(this.EVALUATION_ODATA_CALL_REF);a(this.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF);b(this.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF);a(this.CHART_TABLE_DATA_ODATA_CALL_REF);a(this.FETCH_AGREGATION_VALUE_ODATA_CALL_REF);},onBack:function(e){this._abortPendingODataCalls();window.history.back();},_resetConfigurations:function(){this.TABLE_SORTING=null;this.UOM_APPENDED_TO_HEADER=null;this.setChartSelectionContextObject(null);},onViewChange:function(e){this._resetConfigurations();var s=e.getParameters()["selectedKey"];var A=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();A["viewId"]=[s];sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(A);},_attachHashChangeEvent:function(){this.hashChanger=this.oRouter.oHashChanger;var t=this;if(this.hashChanger){try{if(!t.hashChangerAttached){this.hashChanger.attachEvent("hashChanged",this._proxyHashChangeListener);this.hashChanger.viewRef=this;}t.hashChangerAttached=true;}catch(e){jQuery.sap.log.error("Couldn't Attach HashChange Event");}}else{jQuery.sap.log.error("Router HashChanger Object Found NULL");}},getUrlFilters:function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(F){var O={};O["NAME"]=k;O["OPERATOR"]="EQ";O["VALUE_1"]=F;O["VALUE_2"]="";O["TYPE"]="FI";u.push(O);});}}return u;},getAllFilters:function(){var e=this.EVALUATION.getFilters()["results"]||[];var u=this.getUrlFilters();var t={};u.forEach(function(o){t[o.NAME]=true;});return u.concat(e.filter(function(o){return!t[o.NAME];}));},getAdditionFiltersForChipConfiguration:function(){var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var u=[];if(p){for(var k in p){var f=p[k];if(f&&f.length){f.forEach(function(e){var t=[];t[0]=k;t[1]="EQ";t[2]=e;t[3]="";u.push(t);});}}}return u;},_hideKpiHeaderIfRequired:function(){return;if(this.CONFIGURATION.getHeaders().length==0){return;}try{var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(a){if(Object.keys(a).length){this.getUIComponents().getTileContainer().$().css("overflow","hidden");this.getUIComponents().getTileContainer().$().animate({height:"0px"});return;}}this.getUIComponents().getTileContainer().$().animate({height:"156px"});}catch(e){jQuery.sap.log.error("Failed to Hide KPI Header : "+e);}},hashChangeListener:function(h){this.NEW_HASH=h?h.getParameter("newHash"):"";this.OLD_HASH=h?h.getParameter("oldHash"):"";var A=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var K="viewId";if(!A[K]){this.SELECTED_VIEW=this.CONFIGURATION.getDefaultView();if(this.SELECTED_VIEW){this.renderView(this.SELECTED_VIEW);A.viewId=[this.SELECTED_VIEW.getId()];sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(A,false);var a=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getHash();window.location.replace("#"+a);}else{jQuery.sap.log.error("Evaluation does not have any views configured");}}else if(!this.SELECTED_VIEW){this.firstTimeFlag=true;this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.SELECTED_VIEW){this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this._hideKpiHeaderIfRequired();this._setViewComboBoxSelectedIndex();this.fetchKpiValue();this.fetchDataForChart();this.updateFilter();}else{jQuery.sap.log.error("The view with viewId : "+A[K][0]+" does not exist");}}else if(this.SELECTED_VIEW&&A[K][0]!=this.SELECTED_VIEW.getId()){this.SELECTED_VIEW=this.CONFIGURATION.findViewById(A[K][0]);if(this.firstTimeFlag){sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();}this._setViewComboBoxSelectedIndex();this._resetConfigurations();this.renderView(this.SELECTED_VIEW);this.fetchKpiValue();this.fetchDataForChart();this._hideKpiHeaderIfRequired();this.updateFilter();this._refreshKpiHeaderTiles();}else{if(this.firstTimeFlag){sap.suite.ui.smartbusiness.lib.Util.cache.invalidateKpiDetailsCache();}this._setViewComboBoxSelectedIndex();this._hideKpiHeaderIfRequired();this.updateFilter();this.fetchKpiValue();this.fetchDataForChart();this._refreshKpiHeaderTiles();}},_refreshKpiHeaderTiles:function(){var h=this.getUIComponents().getTileContainer();sap.suite.ui.smartbusiness.drilldown.lib.MiniChartManager.hashChangeListner({allTiles:this.CONFIGURATION.getHeaders(),headerContainer:h,sapSystem:this.SAP_SYSTEM,urlFilters:this.getUrlFilters(),firstTimeFlag:this.firstTimeFlag});this.firstTimeFlag=true;},_setViewComboBoxSelectedIndex:function(){try{if(this.use_CA)this.getUIComponents().getChartToolbar()._oFirstDimensionSelect.setSelectedKey(this.SELECTED_VIEW.getId());else{var v=this.getView().byId("vizViewSelector");v.setSelectedKey(this.SELECTED_VIEW.getId());}}catch(e){jQuery.sap.log.error("Failed to Set Selected Index of View ComboBox");}},_fixFacetListSelection:function(){try{var f=this.getUIComponents().getFilter();var a=f.getFacetFilterReference();var u=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);var b=a.getLists();if(b.length){b.forEach(function(c){var d=c._techName;if(u[d]){var F=u[d];var i=c.getItems();if(i.length){i.forEach(function(g){var h=g.getBindingContext().getObject()[c._techName]||"";h=h.getTime?h.getTime()+"":h+"";if(F.indexOf(h)>-1){g.setSelected(true);}else{g.setSelected(false);}});}}else{var i=c.getItems();if(i.length){i.forEach(function(g){g.setSelected(false);});}}},this);}}catch(e){}},_getUniqueNavLinks:function(r,e){var u=[];var c=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject()+"-"+sap.suite.ui.smartbusiness.drilldown.lib.Hash.getAction();r.forEach(function(s){var t=s.id.split("~")[0];if(t){if(!e[t]){e[t]=t;if(s.id.indexOf(c)==-1){u.push(s);}}}});return u;},_initExternalNavigationLinks:function(){var t=this;this.noNavigationLinks=false;this.listOfLinks=new sap.m.List({noDataText:"-"});this._OPEN_IN_LINKS={};this._externalLinkPromiseObject={};sap.suite.ui.smartbusiness.Adapter.getService("Navigation").reset();this._oExternalNavLinksSOPopover=new sap.m.ResponsivePopover({modal:false,showHeader:false,enableScrolling:true,verticalScrolling:true,horizontalScrolling:false,placement:sap.m.PlacementType.Top,contentWidth:"18rem",content:t.listOfLinks});if(jQuery.device.is.phone){this._oExternalNavLinksSOPopover.setShowHeader(true);}var m=new sap.ui.model.json.JSONModel({"EXTERNAL_APP_LINKS":null});t.listOfLinks.bindItems("/EXTERNAL_APP_LINKS",new sap.m.StandardListItem({title:"{text}",customData:new sap.ui.core.CustomData({key:"{id}",value:"{applicationType}"}),tooltip:"{text}",type:sap.m.ListType.Navigation,press:jQuery.proxy(t._onAppSelection,t,{publishContext:true,isFromOpenIn:true})})).setModel(m);this._oExternalNavLinksSOPopover.attachAfterOpen(function(){t._fetchNavigationLinks();});},_externalLinkPromiseObject:{},_fetchNavigationLinks:function(){var k="EXTERNAL_NAV_LINK";if(!this._externalLinkPromiseObject[k]){var t=this;var d=new jQuery.Deferred();this._externalLinkPromiseObject[k]=d.promise();this._oExternalNavLinksSOPopover.setBusy(true);var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");var s=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getSemanticObject();var a=new Date().getTime();var b={};if(this.CHIP_ID){b["chipId"]=this.CHIP_ID;}if(this._EVALUATION_ID){b["evaluationId"]=this._EVALUATION_ID;}t.SEMANTIC_OBJECT_LINKS_ODATA_CALL_REF=N.getLinksBySemanticObject({success:function(r){var e=new Date().getTime();t._requestTimeLog["SEMANTIC_OBJECT_LINKS"]={title:"Semantic Object Links",time:e-a};r=t._getUniqueNavLinks(r,t._OPEN_IN_LINKS)||[];if(r.length){t.listOfLinks.getModel().setData({"EXTERNAL_APP_LINKS":r});}t._oExternalNavLinksSOPopover.setBusy(false);d.resolve();},async:true,error:function(e){jQuery.sap.log.error("Error fetching navigation links by semantic object : "+s);t._oExternalNavLinksSOPopover.setBusy(false);d.reject();},semanticObject:s,businessParam:b,context:t});}return this._externalLinkPromiseObject[k];},_showExternalNavigationLinks:function(s){if(!this._oExternalNavLinksSOPopover.isOpen()){this._oExternalNavLinksSOPopover.openBy(s);}},_toggleFilter:function(){var c=this;var f=this.getUIComponents().getFilter();if(!f.getSelectedItems()){f.setVisible(!f.getVisible());}else if(f.getSelectedItems()&&f.getVisible()==true){this.oI18nModel=c.getView().getModel("i18n");sap.m.MessageBox.alert(c.oI18nModel.getResourceBundle().getText("Do_you_really_want_to_reset_the_filters?"),{onClose:function(e){if(e=="OK"){f.resetFilter();f.setVisible(false);}else if(e=="CANCEL"){f.setVisible(true);}},title:c.oI18nModel.getResourceBundle().getText("Reset_Filters"),actions:[sap.m.MessageBox.Action.OK,sap.m.MessageBox.Action.CANCEL]});}},setHeaderFooterOptionsWithoutOpenInButton:function(){var o=this.getHeaderFooterOptions();o.buttonList=[];this.setHeaderFooterOptions(o);this.renderTitle();},getHeaderFooterOptions:function(){var o=this._getHeaderFooterOptions();var c=this;var i=c.getView().getModel("i18n");var a=sap.ui.Device.os.name;if(a&&a==sap.ui.Device.os.OS.WINDOWS){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("EXPORT_AS_CSV"),sIcon:"sap-icon://excel-attachment",onBtnPressed:function(e){c._exportAsCSV();}});}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbcmode")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Enable Compact Mode",sIcon:"sap-icon://resize",onBtnPressed:function(e){if(c._compactMode){c.getView().removeStyleClass("sapUiSizeCompact");c._compactMode=false;e.getSource().setText("Enable Compact Mode");}else{c.getView().addStyleClass("sapUiSizeCompact");c._compactMode=true;e.getSource().setText("Disable Compact Mode");}this._fixPostResizeIssue();jQuery(window).trigger("resize");}});}if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){o.additionalShareButtonList.push({sBtnTxt:"Request-Time Log",sIcon:"sap-icon://time-entry-request",onBtnPressed:function(e){c._performance.start(c._requestTimeLog,c._compactMode);}});}if(c.CHIP_ID&&c.CHIP_ID!=sap.suite.ui.smartbusiness.Configuration.Constants.SMARTBUSINESS_NULL_VALUE){o.additionalShareButtonList.push({sBtnTxt:i.getResourceBundle().getText("SAVE_AS_TILE"),sIcon:"sap-icon://add-favorite",onBtnPressed:function(e){c._openAddToHomeDialogBox();}});}return o;},_getHeaderFooterOptions:function(){var c=this;var i=c.getView().getModel("i18n");this.oListItem=new sap.m.ObjectListItem();var a=String.fromCharCode(0xe078);var o={onBack:function(){c._abortPendingODataCalls();window.history.back();},sFullscreenTitle:"",onFacetFilter:function(){c._toggleFilter();c._fixPostResizeIssue();$(window).trigger('resize');},buttonList:[{sBtnTxt:i.getResourceBundle().getText("OPEN_IN_LABEL"),onBtnPressed:function(e){c._showExternalNavigationLinks(e.getSource());}}],bSuppressBookmarkButton:true,oJamOptions:{fGetShareSettings:function(){var h=c.getView().byId("header-ribbon");var l=new sap.m.ObjectListItem();l.setTitle(h.getTitle());l.setNumber(h.getNumber());l.setNumberUnit(h.getNumberUnit());var s={object:{id:window.location.href,display:l,share:"SAP Smart Business"}};return s;},},additionalShareButtonList:[],oEmailSettings:{fGetMailBody:function(){var h=c.getView().byId("header-ribbon");if(h.getNumberUnit()){return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+" "+(h.getNumberUnit())+")"+"\n"+window.location.href;}else{return"("+c.EVALUATION.getKpiName().trim()+"/"+h.getTitle().trim()+": "+h.getNumber()+")"+"\n"+window.location.href;}}},};return o;},_initRequestTimeLogChart:function(){if((window.location.hostname=="localhost")||(jQuery.sap.getUriParameters().get("sbrequestlog")=="99")){jQuery.sap.require("sap.suite.ui.smartbusiness.drilldown.lib.Performance");this._performance=new sap.suite.ui.smartbusiness.drilldown.lib.Performance();}},addExportMethodToTable:function(){var t=this;sap.m.Table.prototype.exportData=sap.m.Table.prototype.exportData||function(s){jQuery.sap.require("sap.ui.core.util.Export");s=s||{};if(!s.rows){s.rows={path:"/data",};}var e=new sap.ui.core.util.Export(s);this.addDependent(e);return e;}},_exportAsCSV:function(){var t=this;jQuery.sap.require("sap.ui.core.util.ExportTypeCSV");var c=[];var a=[];var C=(this.SELECTED_VIEW.getChartConfiguration())[0];var b=false;a=this.SELECTED_VIEW.getColumns();for(var i=0;i<a.length;i++){c.push(a[i]);var d=this.DIMENSION_TEXT_PROPERTY_MAPPING[a[i]];var u=this.MEASURE_UNIT_PROPERTY_MAPPING[a[i]];if(d&&d!=a[i]){c.push(d);}if(u){c.push(u);}}if((t.EVALUATION.getScaling()==-2)&&!((C.isPercentageValue())&&(C.getChartType().isBar()||C.getChartType().isColumn()))){b=t._isMeasureSetPercentScaled(t.SELECTED_VIEW.getMeasures());}var e=jQuery.map(c,function(f){return{name:t.COLUMN_LABEL_MAPPING[f]||f,template:{content:{path:f,formatter:t.getColumnValueFormatter(f,t.SELECTED_VIEW.getDimensions().indexOf(f)>-1?true:false,b,false)}}};});this.getUIComponents().getTable().exportData({exportType:new sap.ui.core.util.ExportTypeCSV({separatorChar:";"}),columns:e}).saveFile().always(function(){this.destroy();});},_openAddToHomeDialogBox:function(){this.oATHDialog.setModel(this.getView().getModel("i18n"),"i18n");this._compactMode?this.oATHDialog.addStyleClass("sapUiSizeCompact"):this.oATHDialog.removeStyleClass("sapUiSizeCompact");this.oATHDialog.open();},_initAddToHomeDialogBox:function(){var c=this;this.oATHDialogContent=new sap.ui.view({type:"XML",viewName:"sap.suite.ui.smartbusiness.drilldown.view.AddToHome",viewData:this});this.oATHDialog=new sap.m.Dialog({title:"{i18n>SAVE_AS_TILE_DIALOG_TITLE}",content:[this.oATHDialogContent],beginButton:new sap.m.Button({text:"{i18n>OK_BUTTON}",press:function(){c.oATHDialogContent.getController().publishTile(function(){c.oATHDialog.close();});}}),endButton:new sap.m.Button({text:"{i18n>CANCEL_BUTTON}",press:function(){c.oATHDialog.close();}})});this.oATHDialog.addStyleClass("sbAddToHomeDialogBox");this.getView().addDependent(this.oATHDialog);},getUIComponents:function(){var p=this.getView().byId("smartbusiness_drilldown_page");var c=this.getView().byId("chartToolbar");var v=this.getView().byId("vizChartContainer");var h=this.getView().byId("header-ribbon");var a=this.byId('headerContainerVBox');var t=this.getView().byId("header-container");var f=this.getView().byId("facetFilter");var b=this.getView().byId("caVbox");var d=this.getView().byId("vizVbox");var e=this;return{getChart:function(){return e.chart;},getTable:function(){return e.table;},getChartToolbar:function(){return c;},getVizChartContainer:function(){return v;},getFilter:function(){return f;},getHeader:function(){return h;},getHeaderContainer:function(){return a;},getTileContainer:function(){return t;},getPage:function(){return p;},getCAvbox:function(){return b;},getVIZvbox:function(){return d;},getAnalyticalMap:function(){return e.analyticalMap;},getGeoMap:function(){return e.geoMap;}};},onExit:function(){this._abortPendingODataCalls();this._detachHashChangeListener();},create_vizDataset:function(c,C){var d=new sap.viz.ui5.data.FlattenedDataset({data:{path:"/data"}});var s=this._getStacking(C);var V=this.SELECTED_VIEW;var o=c.getChartType();C.forEach(function(a){var b=V.findColumnByName(a);if(b.isDimension()){var D=new sap.viz.ui5.data.DimensionDefinition({name:this.COLUMN_LABEL_MAPPING[b.getName()],value:{path:this.DIMENSION_TEXT_PROPERTY_MAPPING[b.getName()],formatter:this.getColumnValueFormatter(this.DIMENSION_TEXT_PROPERTY_MAPPING[b.getName()],true)}});D.column_name=b.getName();d.addDimension(D);}},this);if(o.isLine()||o.isCombination()||o.isBubble()||o.isBar()||o.isColumn()){C.forEach(function(a){var b=V.findColumnByName(a);if(b.isMeasure()){var m=new sap.viz.ui5.data.MeasureDefinition({name:this.COLUMN_LABEL_MAPPING[b.getName()],value:{path:b.getName()}});m.column_name=b.getName();d.addMeasure(m);}},this);}return d;},setAllVizFormatters:function(){var t=this;sap.viz.api.env.Format.useDefaultFormatter(false);jQuery.sap.require("sap.ui.core.format.NumberFormat");var u=this.metadataRef.addSystemToServiceUrl(this.EVALUATION.getODataUrl(),this.SAP_SYSTEM);var e=this.EVALUATION.getEntitySet();var d=this.getUIComponents().getChart().getModel().getData().data;var v=this.chart;var c=(this.SELECTED_VIEW.getChartConfiguration())[0];var C=c.getChartType();var i=this._isMeasureSetPercentScaled(this.SELECTED_VIEW.getMeasures());if((this.EVALUATION.getScaling()==-2)&&(c.isDualAxis())&&(c.isAbsoluteValue())&&(C.isBar()||C.isColumn())){var a=this._getMeasuresByAxis();var b=this._isMeasureSetPercentScaled(a.axis1Msr);var f=this._isMeasureSetPercentScaled(a.axis2Msr);}function _(h,u,e,j,v){var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);return n.format(h);}var g={locale:function(){},format:function(h,p){if(p=="yValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((t.EVALUATION.getScaling()==-2)&&i&&(c.isDualAxis())&&(C.isBar()||C.isColumn())){if(b){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(h);}else if(p=="y2ValueAxisFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){n=sap.ui.core.format.NumberFormat.getPercentInstance();}else if((t.EVALUATION.getScaling()==-2)&&i&&(c.isDualAxis())&&(C.isBar()||C.isColumn())){if(f){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}}else if((t.EVALUATION.getScaling()==-2)&&i){n=sap.ui.core.format.NumberFormat.getPercentInstance({style:'short',minFractionDigits:1,maxFractionDigits:1,});}return n.format(h);}else if(p=="dataLabelFormatter"){var n=sap.ui.core.format.NumberFormat.getFloatInstance(t.oFormatOptions_core);if((t.EVALUATION.getScaling()==-2)&&i&&!((c.isPercentageValue()||c.isDualAxis())&&(C.isBar()||C.isColumn()))){n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);}return n.format(h);}else if(p=="dataLabelPercentFormatter"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(h);}else if(p=="vizPopOver"){if(c.isPercentageValue()&&(C.isBar()||C.isColumn())){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(h);}else if((t.EVALUATION.getScaling()==-2)&&i&&!((c.isPercentageValue()||c.isDualAxis())&&(C.isBar()||C.isColumn()))){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(h);}return _(h,u,e,d,v);}else if(p=="vizPercentPopOver"){var n=sap.ui.core.format.NumberFormat.getPercentInstance(t.oFormatOptions_core);return n.format(h);}}};jQuery.sap.require("sap.viz.ui5.api.env.Format");sap.viz.ui5.api.env.Format.numericFormatter(g);},_handleVizDualAxisWhenPercentScale:function(c){var t=this;var p=c.getVizProperties();var f={};var a={};var b=this._getMeasuresByAxis();var d=this._isMeasureSetPercentScaled(b.axis1Msr);var e=this._isMeasureSetPercentScaled(b.axis2Msr);if(d){for(var i=0;i<b.axis1Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="dataLabelPercentFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis1Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="dataLabelFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis1Msr)[i])])]="vizPopOver";}}if(e){for(var i=0;i<b.axis2Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="dataLabelPercentFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="vizPercentPopOver";}}else{for(var i=0;i<b.axis2Msr.length;i++){f[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="dataLabelFormatter";a[(t.COLUMN_LABEL_MAPPING[((b.axis2Msr)[i])])]="vizPopOver";}}p.plotArea.dataLabel={visible:true,formatString:f};c.setVizProperties(p);this.vizChartPopover.setFormatString(a);},_appendUOMToVizChartAxis:function(d){var c,m,v,U,u,a,b,e,f;var g=function(o){var k=[];for(var n in o){k.push(o[n]);}return k.join(" & ");};var h=function(A){return{visible:true,text:A};};c=this.getUIComponents().getChart();if(!c){return;}m=this.SELECTED_VIEW.getMeasures();v=c.getVizProperties()||{};U={};u=false;if(m.length==1&&m[0]==this.EVALUATION.getKpiMeasureName()){var M=m[0];a=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(a){b=d[a];if(b){U[M]=b;u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{m.forEach(function(M){a=this.MEASURE_UNIT_PROPERTY_MAPPING[M];if(a){b=d[a];if(b){U[M]=this.COLUMN_LABEL_MAPPING[M]+" ("+b+")";u=true;}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}}else{U[M]=this.COLUMN_LABEL_MAPPING[M];}},this);}e=this.SELECTED_VIEW.getChartConfiguration()[0];f=e.getChartType();if(u){if(!(v.valueAxis)){v.valueAxis={};}if(f.isColumn()||f.isBar()){if(e.isSingleAxis()){v.valueAxis.title=h(g(U));}else{var x={},j={};m.forEach(function(M){var o=this.SELECTED_VIEW.findMeasureByName(M);if(o.getAxis()==1){x[M]=U[M];}else if(o.getAxis()==2){j[M]=U[M];}},this);v.valueAxis.title=h(g(x));if(!(v.valueAxis2)){v.valueAxis2={};}v.valueAxis2.title=h(g(j));}}else if(f.isBubble()){var l=[];for(var i=0;i<2;i++){l[i]=U[(m[i])];}v.valueAxis.title=h(l[0]);if(!(v.valueAxis2)){v.valueAxis2={};}v.valueAxis2.title=h(l[1]);}else if(f.isTable()){}else{v.valueAxis.title=h(g(U));}c.setVizProperties(v);}},onVizViewChange:function(e){this._resetConfigurations();var s=e.getParameters().selectedItem.getProperty("key");var A=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();A["viewId"]=[s];sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(A);},getVizTypeAndIcon:function(c,v){var t="bar";var i="sap-icon://bar-chart";var T=c.getChartType();if(T.isBar()){i="sap-icon://horizontal-bar-chart";if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){t="stacked_bar";i="sap-icon://horizontal-stacked-chart";}else{t="bar";}}else{t="100_stacked_bar";i="sap-icon://full-stacked-chart";}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){t="dual_stacked_bar";i="sap-icon://horizontal-bar-chart";}else{t="100_dual_stacked_bar";i="sap-icon://full-stacked-chart";}}}else if(T.isColumn()){t="column";i="sap-icon://vertical-bar-chart";if(c.isSingleAxis()){if(c.isAbsoluteValue()){if(c.isStackingEnabled(v)){t="stacked_column";i="sap-icon://vertical-stacked-chart";}else{t="column";}}else{t="100_stacked_column";i="sap-icon://full-stacked-column-chart";}}else if(c.isDualAxis()){if(c.isAbsoluteValue()){t="dual_stacked_column";i="sap-icon://vertical-bar-chart";}else{t="100_dual_stacked_column";i="sap-icon://full-stacked-column-chart";}}}else if(T.isLine()){t="line";i="sap-icon://line-chart";}else if(T.isCombination()){t="combination";i="sap-icon://business-objects-experience";}else if(T.isBubble()){t="bubble";i="sap-icon://bubble-chart";}return{type:t,icon:i};},_fillVizChartPopoverContent:function(c,I){var t=this;var v=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());this.POPOVER_VIEW_NAVIGATION_MODEL.setData({VIEW_NAVIGATION:v});this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:[]});var p=[];for(var i=0;i<this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i].TITLE,press:jQuery.proxy(t._onVizViewSelection,t,{customData:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i],publishContext:true,isTable:!!I})});}p.push({type:'action',text:"-",press:function(){jQuery.sap.log.error("No Navigation links available");},});c.setActionItems(p);t._fetchNavigationLinks().done(function(){var N=sap.suite.ui.smartbusiness.Adapter.getService("Navigation");t.SEMANTIC_OBJECT_BY_CONTEXT_LINKS_ODATA_CALL_REF=N.getLinksByContext({semanticObject:t.SEMANTIC_OBJECT,dimensions:t.SELECTED_VIEW.getDimensions(),context:t,viewId:t.EVALUATION.getId()+"_"+t.SELECTED_VIEW.getId(),success:function(l){var O=jQuery.extend({},t._OPEN_IN_LINKS);var u=t._getUniqueNavLinks(l,O);if(u.length){t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.setData({APP_NAVIGATION:u});}if(u.length){p.pop();for(var i=0;i<t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length;i++){p.push({type:'action',text:(t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i].text,press:jQuery.proxy(t._onVizAppSelection,t,{customData:(t.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i],publishContext:true,isTable:!!I}),});}c.setActionItems(p);}}});});},_addVizPopoverContent:function(c,I){var t=this;var a=this._getListOfViewsForPopover(this.CONFIGURATION.getAllViews(),this.SELECTED_VIEW.getId());var p=[];for(var i=0;i<this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i].TITLE,press:jQuery.proxy(t._onVizViewSelection,t,{customData:(this.POPOVER_VIEW_NAVIGATION_MODEL.getData().VIEW_NAVIGATION)[i],publishContext:true,isTable:!!I})});}if(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length){for(var i=0;i<this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION.length;i++){p.push({type:'action',text:(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i].text,press:jQuery.proxy(t._onVizAppSelection,t,{customData:(this.POPOVER_EXTERNAL_APP_NAVIGATION_MODEL.getData().APP_NAVIGATION)[i],publishContext:true,isTable:!!I}),});}}else{p.push({type:'action',text:"-",press:function(){jQuery.sap.log.error("No Navigation links available");},});}c.setActionItems(p);},_onVizViewSelection:function(c,e){var v=c.customData.ID;var p=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();var d=this.SELECTED_VIEW.getDimensions();var a=this[c.isTable?"_getTableContextParameters":"_getVizChartContextParameters"](d,false);for(var b in a){if(p[b]){delete p[b];}p[b]=a[b]}p["viewId"]=v;sap.suite.ui.smartbusiness.drilldown.lib.Hash.setApplicationParameters(p,false);if(c.isTable){this.getUIComponents().getTable().setSelectedContext(null);}else{this.setChartSelectionContextObject(null);}sap.suite.ui.smartbusiness.drilldown.lib.Hash.updateHash();},_getVizChartContextParameters:function(d){var t=this;var e,c;e={};if(this.chart){c=this.chart.vizSelection();var a=this.chart.getModel().getData().data;if(c&&c.length){for(var i=0;i<c.length;i++){var b=c[i];d.forEach(function(f){var g=a[(b.data._context_row_number)][f];if(g==null){g="SAP_SMARTBUSINESS_NULL";}if(g||g==0||g==''){if(g.getTime){g=g.getTime();}if(e[f]){e[f].push(g);}else{e[f]=[];e[f].push(g);}}});}}}return e;},_onVizAppSelection:function(c,e){var a=function(i,m){if(m){for(var p in m){if(i&&i[p]){delete i[p];}}}};var b,n=c.customData.id;var d=c.customData.value;var s=n.split("~")[0];var f=s.split("-");var g=f[0];var h=f[1];var i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters(["viewId"]);if(g=="AdhocAnalysis"){i=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getApplicationParameters();}var j=sap.suite.ui.smartbusiness.drilldown.lib.Hash.getStartupParameters();var k={};var l=this.SELECTED_VIEW.getDimensions();if(c.isFromOpenIn){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);b=this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{if(c.isTable){b=this._getTableContextParameters(l);a(i,b);jQuery.extend(true,k,b);}else{b=this._getVizChartContextParameters(l);a(i,b);jQuery.extend(true,k,b);}}jQuery.extend(true,k,j);if(sap.ushell.Container&&sap.ushell.Container.getService){var C=sap.ushell.Container.getService("CrossApplicationNavigation");if(C){var t=C.hrefForExternal({target:{semanticObject:g,action:h},params:k});if(d=="SAPUI5"){this._detachHashChangeListener();}window.location.hash=t;}else{jQuery.sap.log.error("ushell CrossApplicationNavigation service returns null");}}else{jQuery.sap.log.error("ushell Services not running");}},_onVizChartDataPointSelection:function(c,e){if(!(c.chartPopover.getActionItems()&&c.chartPopover.getActionItems().length)){this._fillVizChartPopoverContent(c.chartPopover,false);}},_addFeedsToVizFrame:function(v,c,C){var t=this;var s=this._getStacking(C);var V=this.SELECTED_VIEW;var o=c.getChartType();var d=[],m=[];for(var i=0;i<V.getDimensions().length;i++){d.push(t.COLUMN_LABEL_MAPPING[((V.getDimensions())[i])]);}for(var i=0;i<V.getMeasures().length;i++){m.push(t.COLUMN_LABEL_MAPPING[((V.getMeasures())[i])]);}if(o.isBubble()){var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:[m[0]]}),a=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:[m[1]]}),b=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"bubbleWidth",type:"Measure",values:[m[2]]}),e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:d});v.addFeed(f);v.addFeed(a);v.addFeed(b);v.addFeed(e);}else if((o.isBar()||o.isColumn())&&(c.isDualAxis())){var g=this._getMeasuresByAxis();var h=[],j=[];for(var i=0;i<g.axis1Msr.length;i++){h.push(t.COLUMN_LABEL_MAPPING[g.axis1Msr[i]]||g.axis1Msr[i]);}for(var i=0;i<g.axis2Msr.length;i++){j.push(t.COLUMN_LABEL_MAPPING[g.axis2Msr[i]]||g.axis2Msr[i]);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:h});var k=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"secondaryValues",type:"Measure",values:j});var l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(k);v.addFeed(l);}else if((o.isBar()||o.isColumn())&&s.dimensionStacked&&s.stackedDimensionName&&(V.getDimensionCount()>1)){var n=d.indexOf(t.COLUMN_LABEL_MAPPING[(s.stackedDimensionName)]);if(n>-1){var D=d.splice(n,1);}var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(l);if(D&&D.length){var e=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"regionColor",type:"Dimension",values:D});v.addFeed(e);}}else{var f=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"primaryValues",type:"Measure",values:m}),l=new sap.viz.ui5.controls.common.feeds.FeedItem({uid:"axisLabels",type:"Dimension",values:d});v.addFeed(f);v.addFeed(l);}},applyColorToVizChart:function(c,a){var C=this;var o=a.getChartType();var b=this.getCAtoVizColorMapping();var t=a.getThresholdMeasure();var d=a.getColorScheme();if(!d.getText()){jQuery.sap.log.error("Color Scheme Value Missing");return;}var m=c.getDataset().getMeasures();var v=c.getVizProperties();v.plotArea.dataPointStyle={};c.setVizProperties(v);if((o.isBar()||o.isColumn())&&(a.isDualAxis())){v.plotArea.primaryValuesColorPalette=[];v.plotArea.secondaryValuesColorPalette=[];}else{v.plotArea.colorPalette=[];}if(d.isManual()){m.forEach(function(M,i,e){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getColor();var f=this.SELECTED_VIEW.findMeasureByName(M.column_name).getAxis();if(!_){if(d.isManualSemantic()){jQuery.sap.log.warning("Semantic Color NOT found for measure name : "+M.getName()+", assigning default to 'Neutral Light'");_="sapCaUiChartSemanticColor-Neutral-Light";}else{jQuery.sap.log.warning("Color NOT found for measure name : "+M.getName()+", assigning default color");_="";}}var g=(b[_])||(b[("sapUiChart"+((i%11)+1))]);if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(f==1){(v.plotArea.primaryValuesColorPalette).push(g);}else if(f==2){(v.plotArea.secondaryValuesColorPalette).push(g);}}else{(v.plotArea.colorPalette).push(g);}},this);c.setVizProperties(v);}else if(d.isAutoSemantic()&&!this.EVALUATION.isTargetKpi()){if(t){m.forEach(function(M,i,e){var _=this.SELECTED_VIEW.findMeasureByName(M.column_name).getAxis();if(M.getName()==t){if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(_==1){(v.plotArea.primaryValuesColorPalette).push("sapUiChartPaletteSemanticNeutral");}else if(_==2){(v.plotArea.secondaryValuesColorPalette).push("sapUiChartPaletteSemanticNeutral");}}else{(v.plotArea.colorPalette).push("sapUiChartPaletteSemanticNeutral");}}else{if((o.isBar()||o.isColumn())&&(a.isDualAxis())){if(_==1){(v.plotArea.primaryValuesColorPalette).push("sapUiChartPaletteSemanticGood");}else if(_==2){(v.plotArea.secondaryValuesColorPalette).push("sapUiChartPaletteSemanticGood");}}else{(v.plotArea.colorPalette).push("sapUiChartPaletteSemanticGood");}}},this);v.plotArea.dataPointStyle={rules:[{callback:function(e){var f=c.getModel().getData().data;var g=e._context_row_number;var h=f[g];var r=h[t];if(r!=null&&typeof r!='undefined'){if(e[e.measureNames]>r){if(C.EVALUATION.isMaximizingKpi())return true;}else if(e[e.measureNames]<r){if(C.EVALUATION.isMinimizingKpi())return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticGoodLight1"},},{callback:function(e){var f=c.getModel().getData().data;var g=e._context_row_number;var h=f[g];var r=h[t];if(r!=null&&typeof r!='undefined'){if(e[e.measureNames]>r){if(C.EVALUATION.isMinimizingKpi())return true;}else if(e[e.measureNames]<r){if(C.EVALUATION.isMaximizingKpi())return true;}}else return false;},properties:{color:"sapUiChartPaletteSemanticBadLight1"},},{callback:function(e){var f=c.getModel().getData().data;var g=e._context_row_number;var h=f[g];var r=h[t];if(r==null||typeof r=='undefined'){jQuery.sap.log.error("Threshold Measure:'"+t+"' not in Dataset. Error Applying Semantic Color");return true;}},properties:{color:"sapUiChartPaletteSemanticNeutralLight1"},}],others:{properties:{color:'sapUiChartPaletteSemanticNeutral'}}};c.setVizProperties(v);}else{jQuery.sap.log.error("Chart Color Scheme is Auto-Semantic but no threshold measure Configured!!!");}}else{jQuery.sap.log.debug("Color Scheme is None: Default Color will be used by viz Chart");}if(d.isAutoSemantic()){if(this.EVALUATION.isTargetKpi()){jQuery.sap.log.error("Auto Semantic Coloring can not be applied on target type KPI");}}},getCAtoVizColorMapping:function(){var c={"sapUiChart1":"sapUiChartPaletteQualitativeHue1","sapUiChart2":"sapUiChartPaletteQualitativeHue2","sapUiChart3":"sapUiChartPaletteQualitativeHue3","sapUiChart4":"sapUiChartPaletteQualitativeHue4","sapUiChart5":"sapUiChartPaletteQualitativeHue5","sapUiChart6":"sapUiChartPaletteQualitativeHue6","sapUiChart7":"sapUiChartPaletteQualitativeHue7","sapUiChart8":"sapUiChartPaletteQualitativeHue8","sapUiChart9":"sapUiChartPaletteQualitativeHue9","sapUiChart10":"sapUiChartPaletteQualitativeHue10","sapUiChart11":"sapUiChartPaletteQualitativeHue11","sapCaUiChartSemanticColor-Bad":"sapUiChartPaletteSemanticBad","sapCaUiChartSemanticColor-Bad-Dark":"sapUiChartPaletteSemanticBadDark1","sapCaUiChartSemanticColor-Bad-Light":"sapUiChartPaletteSemanticBadLight1","sapCaUiChartSemanticColor-Critical":"sapUiChartPaletteSemanticCritical","sapCaUiChartSemanticColor-Critical-Dark":"sapUiChartPaletteSemanticCriticalDark1","sapCaUiChartSemanticColor-Critical-Light":"sapUiChartPaletteSemanticCriticalLight1","sapCaUiChartSemanticColor-Good":"sapUiChartPaletteSemanticGood","sapCaUiChartSemanticColor-Good-Dark":"sapUiChartPaletteSemanticGoodDark1","sapCaUiChartSemanticColor-Good-Light":"sapUiChartPaletteSemanticGoodLight1","sapCaUiChartSemanticColor-Neutral":"sapUiChartPaletteSemanticNeutral","sapCaUiChartSemanticColor-Neutral-Dark":"sapUiChartPaletteSemanticNeutralDark1","sapCaUiChartSemanticColor-Neutral-Light":"sapUiChartPaletteSemanticNeutralLight1",};return c;},_fixPostResizeIssue:function(){this.setChartSelectionContextObject(null);}});

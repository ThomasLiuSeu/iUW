/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget",{onInit:function(){this.getView().addStyleClass("sapUiSizeCompact");this.oViewData=this.getView().getViewData();this.oConfigurationHandler=this.oViewData.oConfigurationHandler;this.oConfigurationEditor=this.oViewData.oConfigurationEditor;this.getText=this.oViewData.getText;this.params=this.oViewData.oParams;this.createMessageObject=this.oViewData.createMessageObject;this.putMessage=this.oViewData.putMessage;this.updateTitleAndBreadCrumb=this.oViewData.updateTitleAndBreadCrumb;this.getAllAvailableSemanticObjects=this.oViewData.getAllAvailableSemanticObjects;this.getSemanticActions=this.oViewData.getSemanticActions;var s=this;if(!this.oConfigurationEditor){this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId,function(c){s.oConfigurationEditor=c;});}this._setDisplayText();var m=[];m.push(this.byId("idSemanticObjectField"));m.push(this.byId("idActionField"));this._setMandatoryFields(m);this.getAllAvailableSemanticObjects(function(a,b){if(b===undefined){s._populateSemanticObjectModel(a);s.setDetailData();}else{var M=s.createMessageObject({code:"12004"});M.setPrevious(b);s.putMessage(M);}});},_populateSemanticObjectModel:function(a){var A;var b=[];a.forEach(function(S){var o={};o.semanticObjectKey=S.id;o.semanticObjectName=S.id;b.push(o);});var s={aAllSemanticObjects:b};A=new sap.ui.model.json.JSONModel();A.setSizeLimit(500);A.setData(s);this.byId("idSemanticObjectField").setModel(A);},_setDisplayText:function(){this.byId("idSemanticObjectLabel").setText("* "+this.getText("semanticObject")+": ");this.byId("idActionLabel").setText("* "+this.getText("action")+": ");this.byId("idDescriptionLabel").setText(this.getText("description")+": ");},setDetailData:function(){var s=this.byId("idSemanticObjectField").getModel().getData().aAllSemanticObjects;if(this.params&&this.params.arguments&&this.params.arguments.navTargetId){this.oNavTarget=this.oConfigurationEditor.getNavigationTarget(this.params.arguments.navTargetId);}if(this.oNavTarget){var S;var a=this.oNavTarget.getSemanticObject();for(var i=0;i<s.length;i++){if(a===s[i].semanticObjectKey){S=true;break;}}this.byId("idSemanticObjectField").setValue(a);var b={changeSemanticObject:false,semanticObjectInList:S?true:false};this._populateActions(a,b);}else{var n=this.oConfigurationEditor.createNavigationTarget();this.oNavTarget=this.oConfigurationEditor.getNavigationTarget(n);s.splice(0,0,{semanticObjectKey:"",semanticObjectName:""});var o={aAllSemanticObjects:s};this.byId("idSemanticObjectField").getModel().setData(o);this.byId("idSemanticObjectField").setSelectedKey("");var m=new sap.ui.model.json.JSONModel();var d={aActions:[{id:"",text:""}]};m.setData(d);this.byId("idActionField").setModel(m);this.byId("idActionField").setSelectedKey("");var A={id:n};this.oViewData.updateSelectedNode(A);}},handleChangeSemanticObjectValue:function(e){var s=this.byId("idSemanticObjectField").getModel().getData().aAllSemanticObjects;if(s[0].semanticObjectKey===""){s.splice(0,1);var S={aAllSemanticObjects:s};this.byId("idSemanticObjectField").getModel().setData(S);}var a=e.getParameter("value");var b=this.byId("idSemanticObjectField").getSelectedKey();var c={changeSemanticObject:true,semanticObjectInList:a===b?true:false};if(a!==""&&a!==null){this.oConfigurationEditor.setIsUnsaved();this.oNavTarget.setSemanticObject(a);this._populateActions(a,c);}},_getActionText:function(){var t;var s=this.byId("idActionField").getModel().getData().aActions;for(var i=0;i<s.length;i++){if(s[i].id===this.oNavTarget.getAction()){t=s[i].text;break;}}return t;},handleChangeofAction:function(e){var t;var a=e.getParameter("value");if(a!==""&&a!==null){this.oNavTarget.setAction(a);}this.oConfigurationEditor.setIsUnsaved();t=this._getActionText();if(t===undefined){t=this.oNavTarget.getSemanticObject();}var A={name:t};this.byId("idDescription").setValue(t);this.oViewData.updateSelectedNode(A);t=this.getText("navigationTarget")+": "+t;this.updateTitleAndBreadCrumb(t);},_updateDescriptionAndTitle:function(s,t){if(s.changeSemanticObject){if(t===undefined){t=this.oNavTarget.getSemanticObject();}var a={name:t};this.byId("idDescription").setValue(t);this.oViewData.updateSelectedNode(a);t=this.getText("navigationTarget")+": "+t;this.updateTitleAndBreadCrumb(t);}},_populateActions:function(s,a){var b=this;var t;if(a&&a.semanticObjectInList){var p=this.getSemanticActions(s);p.then(function(S){var A={aActions:S.semanticActions};var o=new sap.ui.model.json.JSONModel();o.setData(A);b.byId("idActionField").setModel(o);if(b.oNavTarget.getAction()&&a&&a.changeSemanticObject===false){b.byId("idActionField").setValue(b.oNavTarget.getAction());var T=b._getActionText()?b._getActionText():b.oNavTarget.getSemanticObject();b.byId("idDescription").setValue(T);}else if(o.getData().aActions.length>0){b.byId("idActionField").setSelectedKey(o.getData().aActions[0].id);b.oNavTarget.setAction(o.getData().aActions[0].id);t=o.getData().aActions[0].text;}b._updateDescriptionAndTitle(a,t);},function(c){var M=b.createMessageObject({code:"12005"});M.setPrevious(c);b.putMessage(M);});}else{var m=new sap.ui.model.json.JSONModel();var d={aActions:[]};m.setData(d);this.byId("idActionField").setModel(m);if(this.oNavTarget.getAction()&&a&&a.changeSemanticObject===false){this.byId("idActionField").setValue(this.oNavTarget.getAction());var T=b.oNavTarget.getSemanticObject();b.byId("idDescription").setValue(T);}else{this.byId("idActionField").setValue("");}this._updateDescriptionAndTitle(a,t);}},_getMandatoryFields:function(){return this.mandatoryFields;},_setMandatoryFields:function(f){this.mandatoryFields=this.mandatoryFields||[];for(var i=0;i<f.length;i++){f[i].isMandatory=true;this.mandatoryFields.push(f[i]);}},_setValidationState:function(){var m=this._getMandatoryFields();if(m.length!==0){for(var i=0;i<m.length;i++){if(m[i].isMandatory===true){this.isValidState=(m[i].getValue()!=="")?true:false;if(this.isValidState===false){break;}}}}},getValidationState:function(){this._setValidationState();var i=(this.isValidState!==undefined)?this.isValidState:true;return i;}});

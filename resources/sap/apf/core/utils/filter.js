/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.core.utils.filter');jQuery.sap.require('sap.apf.core.utils.filterTerm');jQuery.sap.require('sap.apf.core.constants');
sap.apf.core.utils.Filter=function(m,a,b,c,d){var e="%20and%20";var f="%20or%20";var t=this;this.type="internalFilter";var l;if(a&&a.type&&(a.type==="filterTerm"||a.type==="internalFilter")){l=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){l=new sap.apf.core.utils.FilterTerm(m,a,b,c,d);}else if(a===undefined&&b===undefined&&c===undefined){}else{m.check(false,"wrong arguments in construction of  sap.apf.core.utils.Filter");}var r=[];var g;this.getProperties=function(){var i;var p=[];var P=[];var j="";if(l===undefined){return p;}else if(l instanceof sap.apf.core.utils.FilterTerm){j=l.getProperty();p.push(j);}else if(l instanceof sap.apf.core.utils.Filter){p=l.getProperties();}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){p.push(r[i].getProperty());}else{P=r[i].getProperties();p=p.concat(P);}}return sap.apf.utils.eliminateDuplicatesInArray(m,p);};this.copy=function(){var F;var i=0;if(l===undefined){return new sap.apf.core.utils.Filter(m);}else{F=new sap.apf.core.utils.Filter(m,l);if(g===undefined){return F;}for(i=0;i<r.length;i++){if(g===sap.apf.core.constants.BooleFilterOperators.AND){F.addAnd(r[i].copy());}else{F.addOr(r[i].copy());}}return F;}};this.isRestrictedToSingleValue=function(){if(l===undefined||r.length>0){return false;}if(l instanceof sap.apf.core.utils.FilterTerm&&l.getOp()===sap.apf.core.constants.FilterOperators.EQ){return true;}return false;};this.getNumberOfTerms=function(){if(l===undefined){return 0;}else{return 1+r.length;}};this.isEqual=function(F){if(this===F){return true;}if(F===undefined){return false;}return(this.getHash()===F.getHash());};this.getHash=function(L){var n=L||1;var j=0;if(r.length===0){j=n;}else{j=n+1;}if(l===undefined){return 0;}var H=l.getHash(j);var i;if(g===undefined){return H;}else if(g===sap.apf.core.constants.BooleFilterOperators.AND){H=H+Math.pow(2,n);}else if(g===sap.apf.core.constants.BooleFilterOperators.OR){H=H+Math.pow(3,n);}for(i=0;i<r.length;i++){H=H+r[i].getHash(j);}return H;};this.filterArray=function(D){var F=[];var i;var j=0;var k=D.length;if(k===0){return F;}var C=false;var n=this.getProperties();var o=[];for(var p in D[0]){if(jQuery.inArray(p,n)>-1){o.push(p);}}if(o.length===0){return D;}for(i=0;i<k;i++){C=true;for(j in o){p=o[j];if(this.contains(p,D[i][p])===false){C=false;break;}}if(C){F.push(D[i]);}}return F;};this.getFilterTermsForProperty=function(p){var T=[];var i;if(l===undefined){return T;}if(l instanceof sap.apf.core.utils.Filter){T=l.getFilterTermsForProperty(p);}else if(p===l.getProperty()){T.push(l);}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){if(p===r[i].getProperty()){T.push(r[i]);}}else{T=T.concat(r[i].getFilterTermsForProperty(p));}}return T;};this.getFilterTerms=function(){var T=[];var i;if(l===undefined){return T;}if(l instanceof sap.apf.core.utils.Filter){T=l.getFilterTerms();}else{T.push(l);}for(i=0;i<r.length;i++){if(r[i]instanceof sap.apf.core.utils.FilterTerm){T.push(r[i]);}else{T=T.concat(r[i].getFilterTerms());}}return T;};this.contains=function(p,v){var R=false;var i=0;if(l===undefined){return true;}if(g===undefined){return l.contains(p,v);}else if(g===sap.apf.core.constants.BooleFilterOperators.AND){R=l.contains(p,v);if(R===false){return false;}for(i=0;i<r.length;i++){R=r[i].contains(p,v);if(R===false){return false;}}return true;}else if(g===sap.apf.core.constants.BooleFilterOperators.OR){R=l.contains(p,v);if(R===true){return true;}for(i=0;i<r.length;i++){R=r[i].contains(p,v);if(R===true){return true;}}return false;}};this.removeTermsByProperty=function(p){var i,R,o;if(l===undefined){return this.copy();}R=l.removeTermsByProperty(p);if(R instanceof sap.apf.core.utils.FilterTerm){R=new sap.apf.core.utils.Filter(m,R.getProperty(),R.getOp(),R.getValue(),R.getHighValue());}if(g===undefined){return R;}for(i=0;i<r.length;i++){o=r[i].removeTermsByProperty(p);if(R===undefined){if(o instanceof sap.apf.core.utils.FilterTerm){R=new sap.apf.core.utils.Filter(m,o);}else{R=o;}}else if(o!==undefined){if(g===sap.apf.core.constants.BooleFilterOperators.AND){R.addAnd(o);}else{R.addOr(o);}}}if(R){return new sap.apf.core.utils.Filter(m,R);}};this.removeTerms=function(p,o,v){var i;if(l===undefined){return this.copy();}var F=l.removeTerms(p,o,v);var j;if(F instanceof sap.apf.core.utils.FilterTerm){F=new sap.apf.core.utils.Filter(m,F.getProperty(),F.getOp(),F.getValue(),F.getHighValue());}if(g===undefined){return F;}for(i=0;i<r.length;i++){j=r[i].removeTerms(p,o,v);if(F===undefined){if(j instanceof sap.apf.core.utils.FilterTerm){F=new sap.apf.core.utils.Filter(m,j);}else{F=j;}}else if(j!==undefined){if(g===sap.apf.core.constants.BooleFilterOperators.AND){F.addAnd(j);}else{F.addOr(j);}}}return F;};this.addOr=function(a,b,c){var F;if(a instanceof sap.apf.core.utils.Filter||a instanceof sap.apf.core.utils.FilterTerm){F=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){F=new sap.apf.core.utils.FilterTerm(m,a,b,c);}else{m.check(false,"sap.apf.core.utils.Filter.addOr: wrong arguments in construction of  Filter");}if(l===undefined){l=F;return t;}if(g===undefined){g=sap.apf.core.constants.BooleFilterOperators.OR;}r.push(F);m.check(g===sap.apf.core.constants.BooleFilterOperators.OR,"sap.apf.core.utils.Filter - addOr wrong operation");return t;};this.addAnd=function(a,b,c){var F;if(a instanceof sap.apf.core.utils.Filter||a instanceof sap.apf.core.utils.FilterTerm){F=a;}else if(a!==undefined&&b!==undefined&&c!==undefined){F=new sap.apf.core.utils.FilterTerm(m,a,b,c);}else{m.check(false,"sap.apf.core.utils.Filter.addAnd: wrong arguments in construction of  Filter");}if(l===undefined){l=F;return t;}if(g===undefined){g=sap.apf.core.constants.BooleFilterOperators.AND;}m.check(g===sap.apf.core.constants.BooleFilterOperators.AND,"sap.apf.core.utils.Filter - addAnd wrong operation");r.push(F);return t;};this.toUrlParam=function(j){var A=false;var p=[];var E="";if(j!==undefined&&j.asFilterArray===true){A=true;}if(l===undefined){if(A===true){return[];}else{return"";}}if(A===true){p=l.toUrlParam(j);}else{E=l.toUrlParam(j);}var i=0;var k=r.length;var C="";if(k===0){if(A===true){return p;}else{return E;}}if(g===sap.apf.core.constants.BooleFilterOperators.AND){C=e;}else{C=f;}var R="";if(A===true){for(i=0;i<k;i++){p=p.concat(r[i].toUrlParam(j));}return p;}for(i=0;i<k;i++){R=r[i].toUrlParam(j);if(E===""){E=R;}else if(R!==""){E=E+C+R;}}return'('+E+')';};this.mapToSelectionVariant=function(){m.check(g===sap.apf.core.constants.BooleFilterOperators.AND,"sap.apf.core.utils.Filter.mapToSelectionVariant: filter structure too complex");var i={operator:sap.apf.core.constants.BooleFilterOperators.AND,terms:[]};this._getAndFilterTermsForSelectionVariant().forEach(function(j){i.terms.push(j._mapOrFilterToSelectionVariant());});return i;};this._mapOrFilterToSelectionVariant=function(){if(r.length>0){m.check(g===sap.apf.core.constants.BooleFilterOperators.OR,"sap.apf.core.utils.Filter._mapOrFilterToSelectionVariant: filter structure too complex");}var i=[];h().forEach(function(n){if(n.type==="filterTerm"){i.push(n);}else{Array.prototype.push.apply(i,n._getOrFilterTermsForSelectionVariant(n));}});if(i.length>0){var j=i[0].getProperty();}i.forEach(function(n){m.check(n.getProperty()===j,"sap.apf.core.utils.Filter._mapOrFilterToSelectionVariant: filter structure too complex");});var k={property:j,operator:sap.apf.core.constants.BooleFilterOperators.OR,expressions:[]};i.forEach(function(n){k.expressions.push(n.mapToSelectionVariant());});return k;};this.mapToSapUI5FilterExpression=function(){var i,j,F=[];if(l===undefined){return{};}if(r.length===0){return l.mapToSapUI5FilterExpression();}else{F.push(l.mapToSapUI5FilterExpression());for(i=0;i<r.length;i++){F.push(r[i].mapToSapUI5FilterExpression());}j={filters:F,and:(g===sap.apf.core.constants.BooleFilterOperators.AND)}}return j;};this._getOrFilterTermsForSelectionVariant=function(){var i=[];if(r.length>0){m.check(g===sap.apf.core.constants.BooleFilterOperators.OR,"sap.apf.core.utils.Filter._getOrFilterTermsForSelectionVariant: filter structure too complex");}h().forEach(function(j){if(j.type==="filterTerm"){i.push(j);}else{Array.prototype.push.apply(i,j._getOrFilterTermsForSelectionVariant());}});return i;};this._getAndFilterTermsForSelectionVariant=function(){var i=[];if(r.length>0&&g!==sap.apf.core.constants.BooleFilterOperators.AND){i.push(this);return i;}h().forEach(function(j){if(j.type==="filterTerm"){i.push(j);}else{Array.prototype.push.apply(i,j._getAndFilterTermsForSelectionVariant());}});return i;};this.overwriteWith=function(F){var p=F.getProperties();var R;if(p.length!==0){R=this.removeTermsByProperty(p);if(R===undefined){return F.copy();}R.addAnd(F);return R;}return this.copy();};this.mapProperties=function(M){var i=0;if(l===undefined){return undefined;}l.mapProperties(M);if(g===undefined){return;}for(i=0;i<r.length;i++){r[i].mapProperties(M);}};this.reduceToProperty=function(){var p=[];var P;switch(arguments.length){case 1:P=arguments[0];if(P instanceof Array){p=P;}else{p.push(P);}break;default:p=Array.prototype.slice.call(arguments,0);}var F=S(this.getProperties(),p);return this.copy().removeTermsByProperty(F)||new sap.apf.core.utils.Filter(m);function S(s,j){var i;var k=[];var n={};var o=s?s.length:0;var q=j?j.length:0;for(i=0;i<q;i++){n[j[i]]=undefined;}for(i=0;i<o;i++){if(!(s[i]in n)){k.push(s[i]);}}return k;}};function h(){var i=[];if(l===undefined){return i;}i.push(l);r.forEach(function(j){i.push(j);});return i;};};
sap.apf.core.utils.Filter.createFromArray=function(m,p,d,I){m.check(p instanceof Array&&p.length>0,"sap.apf.core.utils.Filter.createFromArray incorrect argument aProperties");m.check(d instanceof Array,"sap.apf.core.utils.Filter.createFromArray incorrect argument aData");if(I.length>0){var l=p.length;var i;var n;var j;var f;var F;var o;for(i in I){F=undefined;n=I[i];if(!d[n]){continue;}for(j=0;j<l;j++){o=new sap.apf.core.utils.Filter(m,p[j],sap.apf.core.constants.FilterOperators.EQ,d[n][p[j]]);if(F===undefined){F=new sap.apf.core.utils.Filter(m,o);}else{F.addAnd(o);}}if(f===undefined){f=new sap.apf.core.utils.Filter(m,F);}else{f.addOr(F);}}return f;}return new sap.apf.core.utils.Filter(m);};
sap.apf.core.utils.Filter.createEmptyFilter=function(m,p){m.check(jQuery.isArray(p)&&p.length>0,"sap.apf.core.utils.Filter.createEmptyFilter - array with property names expected");return new sap.apf.core.utils.Filter(m,p[0],sap.apf.core.constants.FilterOperators.EQ,'').addAnd(p[0],sap.apf.core.constants.FilterOperators.NE,'');};

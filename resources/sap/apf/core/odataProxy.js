/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.odataProxy");jQuery.sap.require('sap.apf.utils.utils');jQuery.sap.require("sap.ui.thirdparty.datajs");jQuery.sap.require('sap.apf.core.constants');(function(){'use strict';sap.apf.core.OdataProxy=function(s,a){var c=a.instance.coreApi;var m=a.instance.messageHandler;var b=s.serviceRoot;var e="";function g(b,e){return c.getEntityTypeMetadata(b,e);}function f(p,v){var i="'";var E=g(b,e).getPropertyMetadata(p);if(E&&E.dataType){return sap.apf.utils.formatValue(v,E.dataType.type);}if(typeof v==='number'){return v;}return i+sap.apf.utils.escapeOdata(v)+i;};function d(j){var i,o,p;if(!j){return"";}o=j.length;if(o===1){return"('"+j[0].value+"')";}p="(";for(i=0;i<o;i++){if(i>0){p=p+",";}p=p+j[i].name+"='"+j[i].value+"'";}return p+")";}function h(E){var i;if(E.messageObject&&E.messageObject.getCode){i=E.messageObject;}else if(E.response&&E.response.statusCode&&E.response.statusCode>=400){i=m.createMessageObject({code:'11005',aParameters:[E.response.statusCode.toString(),E.response.statusText]});}else{i=m.createMessageObject({code:'5201'});}m.putMessage(i);return i;}function k(E,i){var j=h(E);i(undefined,undefined,j);}function l(D,b,e,i){var r;var j;if(D&&D.results){r=D.results;}else if(D){r=D;}else{j=m.createMessageObject({code:'5201'});}i(r,g(b,e),j);}this.readEntity=function(i,j,o,p,q){var A;var e=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var u=b+'/'+e;u=u+d(o);if(p&&p.length>0){u=u+"?$select="+p.join();}if(q===undefined){A=true;}else{A=q;}var r={requestUri:u,async:A,method:"GET",headers:{"x-csrf-token":x}};c.odataRequest(r,function(D){l(D,b,e,j);},function(E){k(E,j);});};function n(r){var x=c.getXsrfToken(b);var j=[];var i,o=r.length;var u,S,p,q;for(i=0;i<o;i++){S=false;e=sap.apf.core.constants.entitySets[r[i].entitySetName];u=e;u=u+d(r[i].inputParameters);if(r[i].selectList&&r[i].selectList.length>0){u=u+"?$select="+r[i].selectList.join();S=true;}if(r[i].filter){if(S){u=u+'&';}else{u=u+'?';}u=u+'$filter='+r[i].filter.toUrlParam({formatValue:f});}p=r[i].method||'GET';q={requestUri:u,method:p,headers:{"Accept-Language":sap.ui.getCore().getConfiguration().getLanguage(),"x-csrf-token":x}};if(p!=="GET"){q.data=r[i].data;}j.push(q);}return j;};this.doChangeOperationsInBatch=function(r,o){var x=c.getXsrfToken(b);var p=n(r);var q={requestUri:b+'/'+'$batch',method:"POST",headers:{"x-csrf-token":x},data:{__batchRequests:[{__changeRequests:p}]}};var S=function(t,u){var v;var w;var y="";var i,j;if(t&&t.__batchResponses){for(i=0;i<t.__batchResponses.length;i++){if(t.__batchResponses[i].message){var z=t.__batchResponses[i].message;var A="";y=u.requestUri;v=m.createMessageObject({code:"5001",aParameters:[A,z,"",y]});break;}for(j=0;j<t.__batchResponses[i].__changeResponses.length;j++){w=t.__batchResponses[i].__changeResponses[j];if(w.message){var z=w.message;var B=w.data;var A=w.statusCode;y=u.requestUri;v=m.createMessageObject({code:"5001",aParameters:[A,z,B,y]});break;}}}o(v);}};var E=function(i){var j="unknown error";var t="unknown error";var u="";if(i.message!==undefined){j=i.message;}var v="unknown";if(i.response&&i.response.statusCode){v=i.response.statusCode;t=i.response.statusText||"";u=i.response.requestUri;}if(i.messageObject&&i.messageObject.type==="messageObject"){o(i.messageObject);}else{o(m.createMessageObject({code:"5001",aParameters:[v,j,t,u]}));}};c.odataRequest(q,S,E,OData.batchHandler);};this.readCollectionsInBatch=function(r,j,o){var x=c.getXsrfToken(b);var p=n(r);var A;if(o===undefined){A=true;}else{A=o;}var q={requestUri:b+'/'+'$batch',async:A,method:"POST",headers:{"x-csrf-token":x},data:{__batchRequests:p}};var S=function(t,u){var u=[];var v;var w="";var i;if(t&&t.__batchResponses){for(i=0;i<t.__batchResponses.length;i++){if(t.__batchResponses[i].data&&t.__batchResponses[i].data.results){u.push(t.__batchResponses[i].data.results)}else if(t.__batchResponses[i].message){var y=t.__batchResponses[i].message;var z=t.__batchResponses[i].response.body;var B=t.__batchResponses[i].response.statusCode;w=u.requestUri;v=m.createMessageObject({code:"5001",aParameters:[B,y,z,w]});break;}else{w=u.requestUri;v=m.createMessageObject({code:"5001",aParameters:["unknown","unknown error","unknown error",w]});break;}}j(u,v);}};var E=function(i){var t="unknown error";var u="unknown error";var v="";if(i.message!==undefined){t=i.message;}var w="unknown";if(i.response&&i.response.statusCode){w=i.response.statusCode;u=i.response.statusText||"";v=i.response.requestUri;}if(i.messageObject&&i.messageObject.type==="messageObject"){j([],i.messageObject);}else{j([],m.createMessageObject({code:"5001",aParameters:[w,t,u,v]}));}};c.odataRequest(q,S,E,OData.batchHandler);};this.readCollection=function(i,j,o,p,q,r){var A;e=sap.apf.core.constants.entitySets[i];var Q='';var x=c.getXsrfToken(b);var u=b+'/'+e;u=u+d(o);if(p&&p.length>0){Q="$select="+p.join();}if(q){if(Q){Q=Q+'&';}Q=Q+'$filter='+q.toUrlParam({formatValue:f});}if(e===sap.apf.core.constants.entitySets.application){if(Q){Q=Q+'&';}Q=Q+'$orderby=ApplicationName';}if(Q){u=u+'?'+Q;}if(r===undefined){A=true;}else{A=r;}var t={requestUri:u,async:A,method:"GET",headers:{"x-csrf-token":x}};c.odataRequest(t,function(D){l(D,b,e,j);},function(E){k(E,j);});};this.create=function(i,j,o,p){var A;e=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var u=b+'/'+e;if(p===undefined){A=true;}else{A=p;}var r={requestUri:u,async:A,method:"POST",headers:{"x-csrf-token":x},data:j};function q(D,R){var v;var w;if(D&&R.statusText==="Created"){v=D;}else{w=m.createMessageObject({code:'5201'});}o(v,g(b,e),w);}function t(E){var v=h(E);o(undefined,undefined,v);}c.odataRequest(r,q,t);};this.update=function(i,j,o,p){e=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var u=b+'/'+e+d(p);var r={requestUri:u,method:"PUT",headers:{"x-csrf-token":x},data:j};function q(D,R){var v;if(R.statusCode!==204){v=m.createMessageObject({code:'5201'});}o(g(b,e),v);}function t(E){var v=h(E);o(undefined,v);}c.odataRequest(r,q,t);};this.remove=function(i,j,o,p){e=sap.apf.core.constants.entitySets[i];var x=c.getXsrfToken(b);var u=b+'/'+e+d(j);if(p){u=u+'$filter='+p.toUrlParam({formatValue:f});}var r={requestUri:u,method:"DELETE",headers:{"x-csrf-token":x}};function q(D,R){var v;var w;if(R.statusText==="No Content"){w=g(b,e);}else{v=m.createMessageObject({code:'5201'});}o(w,v);}function t(E){var v=h(E);o(undefined,v);}c.odataRequest(r,q,t);};};}());

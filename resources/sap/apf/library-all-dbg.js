// This file has been generated by the SAPUI5 'AllInOne' Builder
sap.ui.controller("sap.apf.modeler.ui.controller.configurationListNew", {
	onInit : function() {
		var oComponent = this.getOwnerComponent();
		if (oComponent) {
			this.oCoreApi = oComponent.oCoreApi;
		}
		// Data
		this.aData = [];
		this.oModel = new sap.ui.model.json.JSONModel({
			tableData : this.aData
		});
		this.oView = this.getView();
		this.oView.setModel(this.oModel);
		// Listen to route changed event.
		sap.ui.core.UIComponent.getRouterFor(this).attachRouteMatched(this._handleRouteChanged.bind(this));
	},
	_handleRouteChanged : function(oEvent) {
		var mEventParams = oEvent.getParameters();
		if (mEventParams.name !== "applicationList") {
			this.sAppId = mEventParams.arguments.appId;
			this._displayApplicationName();
			this._getConfigHandler().then(this._populateConfigList);
			this.oModel.updateBindings();
		}
	},
	_getConfigHandler : function() {
		var self = this;
		var oConfigHandlerDeferred = new jQuery.Deferred();
		this.oCoreApi.getConfigurationHandler(this.sAppId, function(oConfigHandler) {
			self.oConfigHandler = oConfigHandler;
			oConfigHandlerDeferred.resolveWith(self, [ oConfigHandler ]);
		});
		return oConfigHandlerDeferred;
	},
	_populateConfigList : function() {
		var self = this;
		var aConfigList = this.oConfigHandler.getList();
		aConfigList.forEach(function (oConfig) {
			self.aData.push({
				AnalyticalConfiguration : oConfig.AnalyticalConfiguration,
				Application : oConfig.Application,
				name : oConfig.AnalyticalConfigurationName,
				type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION
			});
		});
		this.oModel.updateBindings();
	},
	_displayApplicationName : function() {
		var self = this;
		this.oCoreApi.getApplicationHandler(function (oApplicationHandler) {
			var sAppName = oApplicationHandler.getApplication(self.sAppId).ApplicationName;
			self.byId("idConfigTitleMaster").setText(self.oCoreApi.getText("configurationObjectTitle") + " : " + sAppName);
		});
	}
});
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
//jQuery.sap.require("sap.apf.modeler.ui.utils.textPoolHelper");
/**
* @class category
* @memberOf sap.apf.modeler.ui.controller
* @name category
* @description controller for view.category
*/
sap.ui.controller("sap.apf.modeler.ui.controller.navigationTarget", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#onInit
	* @description Called on initialization of the view.
	* 			Sets the static texts for all controls in UI.
	* 			Adds style classes to all UI controls.
	* 			Prepares dependencies.
	*  			Sets dynamic text for input controls
	* */
	onInit : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		this.getText = this.oViewData.getText;
		this.params = this.oViewData.oParams;
		this.createMessageObject = this.oViewData.createMessageObject;
		this.putMessage = this.oViewData.putMessage;
		this.updateTitleAndBreadCrumb = this.oViewData.updateTitleAndBreadCrumb;
		this.getAllAvailableSemanticObjects = this.oViewData.getAllAvailableSemanticObjects;
		this.getSemanticActions = this.oViewData.getSemanticActions;
		var self = this;
		if (!this.oConfigurationEditor) {
			this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId, function(configurationEditor) {
				self.oConfigurationEditor = configurationEditor;
			});
		}
		this._setDisplayText();
		//Set Mandatory Fields
		var mandatoryFields = [];
		mandatoryFields.push(this.byId("idSemanticObjectField"));
		mandatoryFields.push(this.byId("idActionField"));
		this._setMandatoryFields(mandatoryFields);
		//API Callback return an array of semantic objects of with each object having an id and text
		this.getAllAvailableSemanticObjects(function(semanticObjects, messageObject) {
			if (messageObject === undefined) {
				self._populateSemanticObjectModel(semanticObjects);
				self.setDetailData();
			} else {
				var oMessageObject = self.createMessageObject({
					code : "12004"
				});
				oMessageObject.setPrevious(messageObject);
				self.putMessage(oMessageObject);
			}
		});
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#_populateSemanticObjectModel
	* @description Prepares the model for semantic object field and sets it
	* @param {Array} Array of semantic objects from getAllAvailableSemanticObjects API
	* */
	_populateSemanticObjectModel : function(aAllSemObj) {
		var aAllSemanticObjectsModel;
		var aAllSemanticObjects = [];
		aAllSemObj.forEach(function(oSemanticObject) {
			var oSemOb = {};
			oSemOb.semanticObjectKey = oSemanticObject.id;
			oSemOb.semanticObjectName = oSemanticObject.id;
			aAllSemanticObjects.push(oSemOb);
		});
		var oSemObjData = {
			aAllSemanticObjects : aAllSemanticObjects
		};
		aAllSemanticObjectsModel = new sap.ui.model.json.JSONModel();
		aAllSemanticObjectsModel.setSizeLimit(500);
		aAllSemanticObjectsModel.setData(oSemObjData);
		this.byId("idSemanticObjectField").setModel(aAllSemanticObjectsModel);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#_setDisplayText
	* @description Sets static texts in UI
	* */
	_setDisplayText : function() {
		this.byId("idSemanticObjectLabel").setText("* " + this.getText("semanticObject") + ": ");
		this.byId("idActionLabel").setText("* " + this.getText("action") + ": ");
		this.byId("idDescriptionLabel").setText(this.getText("description") + ": ");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#setDetailData
	* @description Sets dynamic texts for controls
	* */
	setDetailData : function() {
		var aSemanticObjects = this.byId("idSemanticObjectField").getModel().getData().aAllSemanticObjects;
		if (this.params && this.params.arguments && this.params.arguments.navTargetId) {
			this.oNavTarget = this.oConfigurationEditor.getNavigationTarget(this.params.arguments.navTargetId);
		}
		if (this.oNavTarget) {
			var sSemanticObjectKey;
			var sSemanticObject = this.oNavTarget.getSemanticObject();
			//Loop through semantic objects model to find if the existing navigation target's semantic object is present in the model
			for( var index = 0; index < aSemanticObjects.length; index++) {
				if (sSemanticObject === aSemanticObjects[index].semanticObjectKey) {
					sSemanticObjectKey = true;//If semantic object present in list, set as true
					break;
				}
			}
			this.byId("idSemanticObjectField").setValue(sSemanticObject);
			var semanticObjectInfo = {
				changeSemanticObject : false,
				semanticObjectInList : sSemanticObjectKey ? true : false//If semantic object part of the list then set true; else if semantic object is through user input set false
			};
			this._populateActions(sSemanticObject, semanticObjectInfo);
		} else {
			var navigationTargetId = this.oConfigurationEditor.createNavigationTarget();
			this.oNavTarget = this.oConfigurationEditor.getNavigationTarget(navigationTargetId);
			//Adds the empty string key to the semantic object model in case of a new navigation target
			aSemanticObjects.splice(0, 0, {
				semanticObjectKey : "",
				semanticObjectName : ""
			});
			var oSemObjData = {
				aAllSemanticObjects : aSemanticObjects
			};
			this.byId("idSemanticObjectField").getModel().setData(oSemObjData);
			this.byId("idSemanticObjectField").setSelectedKey("");
			var oModelAction = new sap.ui.model.json.JSONModel();
			var oData = {
				aActions : [ {
					id : "",
					text : ""
				} ]
			};
			oModelAction.setData(oData);
			this.byId("idActionField").setModel(oModelAction);
			this.byId("idActionField").setSelectedKey("");
			var oActionInfo = {
				id : navigationTargetId
			};
			this.oViewData.updateSelectedNode(oActionInfo);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#handleChangeSemanticObjectValue
	* @description Handler for change event on Semantic Object drop down
	* */
	handleChangeSemanticObjectValue : function(oEvent) {
		var aSemanticObjects = this.byId("idSemanticObjectField").getModel().getData().aAllSemanticObjects;
		if (aSemanticObjects[0].semanticObjectKey === "") {
			aSemanticObjects.splice(0, 1);//Removes the empty string key from the semantic object model after a semantic object is set
			var oSemObjData = {
				aAllSemanticObjects : aSemanticObjects
			};
			this.byId("idSemanticObjectField").getModel().setData(oSemObjData);
		}
		var sSemanticObject = oEvent.getParameter("value");
		var sSemanticObjectKey = this.byId("idSemanticObjectField").getSelectedKey();
		var semanticObjectInfo = {
			changeSemanticObject : true,
			semanticObjectInList : sSemanticObject === sSemanticObjectKey ? true : false
		};
		if (sSemanticObject !== "" && sSemanticObject !== null) {
			this.oConfigurationEditor.setIsUnsaved();
			this.oNavTarget.setSemanticObject(sSemanticObject);
			this._populateActions(sSemanticObject, semanticObjectInfo);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#_getActionText
	* @description Matches the selected Navigation target action with the model to find the description of the action
	* @returns {String} The description of the selected action is returned 
	* */
	_getActionText : function() {
		var sTitle;
		var aSemanticActions = this.byId("idActionField").getModel().getData().aActions;
		for( var i = 0; i < aSemanticActions.length; i++) {
			if (aSemanticActions[i].id === this.oNavTarget.getAction()) {
				sTitle = aSemanticActions[i].text;
				break;
			}
		}
		return sTitle;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#handleChangeofAction
	* @description Handler for change event on Actions drop down
	* */
	handleChangeofAction : function(oEvent) {
		var sTitle;
		var sAction = oEvent.getParameter("value");
		if (sAction !== "" && sAction !== null) {
			this.oNavTarget.setAction(sAction);
		}
		this.oConfigurationEditor.setIsUnsaved();
		sTitle = this._getActionText();
		if (sTitle === undefined) {//Handle user input of action
			sTitle = this.oNavTarget.getSemanticObject();//If action does not have description(user input case) use the semantic object for title and description
		}
		var oActionInfo = {
			name : sTitle
		};
		this.byId("idDescription").setValue(sTitle);
		this.oViewData.updateSelectedNode(oActionInfo);
		sTitle = this.getText("navigationTarget") + ": " + sTitle;
		this.updateTitleAndBreadCrumb(sTitle);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#_updateDescriptionAndTitle
	* @param {Object} - {boolean} whether semantic object is part of the list of semantic objects or user input
	* 				  - {boolean} whether change triggered from handleChangeSemanticObjectValue or onInit of navigation target
	* 		 {String} - Title and bread crumb; Also set on description
	* @description Sets the title, bread crumb, description and updates tree node
	* */	
	_updateDescriptionAndTitle : function(semanticObjectInfo, sTitle) {
		if (semanticObjectInfo.changeSemanticObject) { //If change is triggered from handleChangeSemanticObjectValue
			if (sTitle === undefined) {//Handle user input of semantic object and action
				sTitle = this.oNavTarget.getSemanticObject();//If action does not have description(user input case) use the semantic object for title and description
			}
			var oActionInfo = {
				name : sTitle
			};
			this.byId("idDescription").setValue(sTitle);
			this.oViewData.updateSelectedNode(oActionInfo);
			sTitle = this.getText("navigationTarget") + ": " + sTitle;
			this.updateTitleAndBreadCrumb(sTitle);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.navigationTarget#_populateActions
	* @description Accepts a semantic object and populates the action drop down with the list of actions for the semantic object.
	* Also accepts a boolean changeSemanticObject to differentiate between the call from change of semantic object or at initial load for an existing navigation target.
	* If boolean is true, call is from handleChangeSemanticObjectValue
	* If boolean is false, the call is from on initial load so only certain details like description is updated.
	* Accepts boolean semanticObjectInList to check if the semantic object is part of the semantic object list or an user input. If the boolean is true it is part of the semantic object list else it is an user input
	* The title, bread crumb, tree node and description are updated with the description of the action if semantic object is part of the list else updated with the semantic object
	* @param {String} Semantic object; 
	* 		 {Object} - {boolean} whether semantic object is part of the list of semantic objects or user input
	* 				  - {boolean} whether change triggered from handleChangeSemanticObjectValue or onInit of navigation target
	* */
	_populateActions : function(semanticObject, semanticObjectInfo) {
		var self = this;
		var sTitle;
		if (semanticObjectInfo && semanticObjectInfo.semanticObjectInList) {//Semantic object present in the list of semantic objects
			var oPromise = this.getSemanticActions(semanticObject);//Promise based call to get the list of actions for the given semantic object
			oPromise.then(function(aSemanticActions) {//Once promise is done populate action model
				var oActionsData = {
					aActions : aSemanticActions.semanticActions
				};
				var oActionModel = new sap.ui.model.json.JSONModel();
				oActionModel.setData(oActionsData);
				self.byId("idActionField").setModel(oActionModel);
				if (self.oNavTarget.getAction() && semanticObjectInfo && semanticObjectInfo.changeSemanticObject === false) {//If change is triggered from on load of existing navigation target
					self.byId("idActionField").setValue(self.oNavTarget.getAction());
					var sText = self._getActionText() ? self._getActionText() : self.oNavTarget.getSemanticObject(); //If action is from list of actions, get action's description; If action is from user input use semantic object as description
					self.byId("idDescription").setValue(sText);
				} else if (oActionModel.getData().aActions.length > 0) {//If change is triggered from handleChangeSemanticObjectValue
					self.byId("idActionField").setSelectedKey(oActionModel.getData().aActions[0].id);//Set the first action on the list as selected by default
					self.oNavTarget.setAction(oActionModel.getData().aActions[0].id);
					sTitle = oActionModel.getData().aActions[0].text;
				}
				self._updateDescriptionAndTitle(semanticObjectInfo, sTitle);
			}, function(messageObject) {//If promise fails display a message
				var oMessageObject = self.createMessageObject({
					code : "12005"
				});
				oMessageObject.setPrevious(messageObject);
				self.putMessage(oMessageObject);
			});
		} else {//If the semantic object is an user input
			var oModelAction = new sap.ui.model.json.JSONModel();
			var oData = {
				aActions : []
			};
			oModelAction.setData(oData);//Set the action model as empty for user input of semantic object
			this.byId("idActionField").setModel(oModelAction);
			if (this.oNavTarget.getAction() && semanticObjectInfo && semanticObjectInfo.changeSemanticObject === false) { //If change is triggered from on load of existing navigation target and an action is available
				this.byId("idActionField").setValue(this.oNavTarget.getAction());
				var sText = self.oNavTarget.getSemanticObject();
				self.byId("idDescription").setValue(sText);//For user input semantic objects, set description as semantic object
			} else {
				this.byId("idActionField").setValue("");//If change is triggered from handleChangeSemanticObjectValue and action is not available
			}
			this._updateDescriptionAndTitle(semanticObjectInfo, sTitle);//For user input semantic objects, set title, bread crumb and description as semantic object
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.navigationTarget#_getMandatoryFields
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description getter for mandatory fields
	 * */
	_getMandatoryFields : function() {
		return this.mandatoryFields;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.navigationTarget#_setMandatoryFields
	 * @param {Array} fields - Array of form fields
	 * @description Set mandatory fields on the instance level  
	 * */
	_setMandatoryFields : function(fields) {
		this.mandatoryFields = this.mandatoryFields || [];
		for( var i = 0; i < fields.length; i++) {
			fields[i].isMandatory = true;
			this.mandatoryFields.push(fields[i]);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.navigationTarget#_setValidationState
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description Set validation state of sub view
	 * */
	_setValidationState : function() {
		var mandatoryFields = this._getMandatoryFields();
		if (mandatoryFields.length !== 0) {
			for( var i = 0; i < mandatoryFields.length; i++) {
				if (mandatoryFields[i].isMandatory === true) {
					this.isValidState = (mandatoryFields[i].getValue() !== "") ? true : false;
					if (this.isValidState === false) {
						break;
					}
				}
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.navigationTarget#getValidationState
	 * @description Getter for getting the current validation state of sub view
	 * */
	getValidationState : function() {
		this._setValidationState(); //Set the validation state of view
		var isValidState = (this.isValidState !== undefined) ? this.isValidState : true;
		return isValidState;
	}
});
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
/**
* @class titleBreadCrumb
* @memberOf sap.apf.modeler.ui.controller
* @name titleBreadCrumb
* @description controller for view.titleBreadCrumb
*/
sap.ui.controller("sap.apf.modeler.ui.controller.titleBreadCrumb", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.titleBreadCrumb#onInit
	* @description Reads data from view#getViewData.
	* Adds style class to the title and breadcrumb
	* Updates the title and breadcrumb of the subview
	* */
	onInit : function() {
		this.oViewData = this.getView().getViewData();
		this.getText = this.oViewData.getText;
		this._addConfigStyleClass();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.titleBreadCrumb#_addConfigStyleClass
	* @description Adds style classes to the title and breadcrumb of the subview
	* */
	_addConfigStyleClass : function() {
		this.byId("IdBreadCrumb").addStyleClass("breadCrumb");
		this.byId("IdFormTitle").addStyleClass("formTitle");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.titleBreadCrumb#setTitleAndBreadCrumb
	* @param {String} Form Title of the detail page 
	* @param {String} BreadCrumb Of the detail page
	* @description Updates the title and breadcrumb
	* */
	setTitleAndBreadCrumb : function(sFormTitle, sBreadCrumb) {
		this.byId("IdFormTitle").setText(sFormTitle);
		this.byId("IdBreadCrumb").setText(sBreadCrumb);
	}
});
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
/**
* @class toolbar
* @memberOf sap.apf.modeler.ui.controller
* @name toolbar
* @description controller for view.toolbar
*/
sap.ui.controller("sap.apf.modeler.ui.controller.toolbar", {
	/**
	 * @public
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#onInit
	 * @description Called on initialization of the view.
	 * Gets the coreApi and configurationList instance from viewdata
	 * */
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oConfigListInstance.oCoreApi;
		this.oConfigListInstance = this.getView().getViewData().oConfigListInstance;
		this._setDisplayText();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_setDisplayText
	 * @description Sets the text for each of the toolbar buttons
	 * */
	_setDisplayText : function() {
		this.byId("idAddButton").setText(this.oCoreApi.getText("addButton"));
		this.byId("idCopyButton").setText(this.oCoreApi.getText("copyButton"));
		this.byId("idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#enableCopyDeleteButton
	 * @description Enables copy and delete button in the toolbar
	 * */
	enableCopyDeleteButton : function() {
		if (!this.byId("idCopyButton").getEnabled()) {
			this.byId("idCopyButton").setEnabled(true);
		}
		if (!this.byId("idDeleteButton").getEnabled()) {
			this.byId("idDeleteButton").setEnabled(true);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#disableCopyDeleteButton
	 * @description Disables copy and delete button in the toolbar
	 * */
	disableCopyDeleteButton : function() {
		if (this.byId("idCopyButton").getEnabled()) {
			this.byId("idCopyButton").setEnabled(false);
		}
		if (this.byId("idDeleteButton").getEnabled()) {
			this.byId("idDeleteButton").setEnabled(false);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_setAddMenuText
	 * @description Sets text for all the menu items present in add menu fragment
	 * */
	_setAddMenuText : function() {
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewConfig").setText(this.oCoreApi.getText("newConfiguration"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewFacetFilter").setText(this.oCoreApi.getText("newFacetFilter"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewCategory").setText(this.oCoreApi.getText("newCategory"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewNavigationTarget").setText(this.oCoreApi.getText("newNavigationTarget"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idStep").setText(this.oCoreApi.getText("step"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewStep").setText(this.oCoreApi.getText("newStep"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idExistingStep").setText(this.oCoreApi.getText("existingStep"));
		sap.ui.core.Fragment.byId("idAddMenuFragment", "idNewRepresentation").setText(this.oCoreApi.getText("newRepresentation"));
	},
	/**
     * @private
     * @function
     * @name sap.apf.modeler.ui.controller.toolbar#_setExistingStepDialogText
     * @description Sets text for all items present in existing step dialog fragment
     * */
    _setExistingStepDialogText : function(){
        sap.ui.core.Fragment.byId("idExistingStepDialogFragment", "idExistingStepDialog").setTitle(this.oCoreApi.getText("existingStepDialogTitle"));
    },
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_enableDisableAddMenuItems
	 * @param {Object} Context of the selected node
	 * @param {sap.ui.xmlfragment} Add menu fragment which contains all the menu items
	 * @description Enables and disables menu items in add menu fragment based on selected node object type
	 * */
	_enableDisableAddMenuItems : function(oSelectedTreeNodeDetails, addMenu) { // enable/disable the menu items in the add menu based on object type
		var aAddMenuItems = addMenu.getItems();
		var nodeObjectType;
		if (this.oConfigListInstance.configurationHandler.getList().length === 0 || oSelectedTreeNodeDetails === null) { //if there is no configuration initially
			nodeObjectType = "default"; //only the add configuration should be enabled
		} else {
			nodeObjectType = oSelectedTreeNodeDetails.nodeObjectType;
		}
		var oMapNodeObjectType = {};
		oMapNodeObjectType["default"] = 1;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION] = 4;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER] = 4;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY] = 5;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP] = 6;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION] = 6;
		oMapNodeObjectType[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET] = 4;
		aAddMenuItems.forEach(function(oMenuItem, index) {
			if (index < oMapNodeObjectType[nodeObjectType]) {
				oMenuItem.setEnabled(true);
			} else {
				oMenuItem.setEnabled(false);
			}
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressAddButton
	 * @description Handler for add button in the toolbar
	 * */
	_handlePressAddButton : function(oEvent) { //handler for add button in the toolbar above tree control
		var oSubViewInstance;
		var oSelf = this;
		if (this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length >= 1) {
			oSubViewInstance = (typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController === "function") ? this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController()
					: undefined;
		}
		//Remove Focus from the button
		oEvent.getSource().$().blur();
		//check if there is any unsaved change
		var oNavigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
		var isMandatoryFilled = (oSubViewInstance !== undefined) ? (typeof oSubViewInstance.getValidationState === "function" ? oSubViewInstance.getValidationState.call(oSubViewInstance) : true) : true;
		this.oConfigListInstance.bIsSaved = this.oConfigListInstance.configEditor ? this.oConfigListInstance.configEditor.isSaved() : undefined;
		var isDirtyState = false;
		var addAction = function() {
			var oAddButton = oEvent.getSource();
			var oSelectedTreeNodeDetails = this.oConfigListInstance.oTreeInstance.getNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());
			if (!this.addMenu) { // create add menu only once    
				this.addMenu = new sap.ui.xmlfragment("idAddMenuFragment", "sap.apf.modeler.ui.fragment.addMenu", this); // enable/disable menu items has to be set to default (creating a new instance each time)
				this.getView().addDependent(this.addMenu);
				this._setAddMenuText();
			}
			var addButtonDock = sap.ui.core.Popup.Dock;
			this._enableDisableAddMenuItems(oSelectedTreeNodeDetails, this.addMenu); // enable/disable the menu items in the add button based on the object type
			this.addMenu.open(false, oAddButton, addButtonDock.BeginTop, addButtonDock.BeginBottom, oAddButton); // opens the menu right below the add button
		};
		if (!isMandatoryFilled) { //check mandatory state
			oNavigationHandlerInstance.throwMandatoryPopup(oSelf.oConfigListInstance, {
				yes : function() {
					var bNavState = oSelf.oConfigListInstance._navMandatoryResetState(oSelf.oConfigListInstance);
					if (!bNavState.isNewView) {
						addAction.call(oSelf);
					}
				}
			});
			isDirtyState = true;
		}
		if (!isDirtyState) { //if clean state proceed with add
			addAction.call(oSelf);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressAddButton
	 * @description Handler for menu items of add button in the toolbar
	 * */
	_handleAddMenuItemPress : function(oEvent) {
		var aItems = this.addMenu.getItems();
		var oAddMenuSelectedItem = oEvent.getParameters("item");
		var sNodeObjectType;
		var oNodeObjectType = {
			"idAddMenuFragment--idNewFacetFilter" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER,
			"idAddMenuFragment--idNewCategory" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY,
			"idAddMenuFragment--idNewStep" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,
			"idAddMenuFragment--idNewRepresentation" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,
			"idAddMenuFragment--idNewConfig" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION,
			"idAddMenuFragment--idNewNavigationTarget" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET,
			"default" : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION
		};
		aItems.forEach(function(oItem) {
			if (oItem.getId() === oAddMenuSelectedItem.id) {
				sNodeObjectType = oNodeObjectType[oItem.getId()];
			}
			else if(oItem.getSubmenu()){//In case of step submenu
				oItem.getSubmenu().getItems().forEach(function(oItem){
					if (oItem.getId() === oAddMenuSelectedItem.id) {
						sNodeObjectType = oNodeObjectType[oItem.getId()];
					}
				});
			}
		});
		if(oAddMenuSelectedItem.id === "idAddMenuFragment--idExistingStep"){
			this._handleAddExistingStepPress();
		}
		else if(oAddMenuSelectedItem.id !== "idAddMenuFragment--idStep" && sNodeObjectType !== undefined){//In case of existing step, the existing step dialog is opened
			this.oConfigListInstance.oTreeInstance.addNodeInTree(sNodeObjectType);
		}
	},
	/**
	 * @private
	 * @function 
	 * @param {String} Copied configuration id #sCopiedConfigurationId
	 * @param {Object} New context of the copied node #newContextForCopiedNode
	 * @name sap.apf.modeler.ui.controller.toolbar#_copyConfiguration
	 * @description Copies the Configuration object
	 * */
	_copyConfiguration : function(sCopiedConfigurationId, newContextForCopiedNode) {
		var oCopiedConfig = this.oConfigListInstance.configurationHandler.getConfiguration(sCopiedConfigurationId);
		var oConfigDetails = {};
		oConfigDetails.AnalyticalConfiguration = oCopiedConfig.AnalyticalConfiguration;
		oConfigDetails.name = "< " + oCopiedConfig.AnalyticalConfigurationName + " >";
		oConfigDetails.Application = oCopiedConfig.Application;
		oConfigDetails.type = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;
		oConfigDetails.bIsLoaded = false; //boolean to check the creation of tree structure set to false
		oConfigDetails.bToggleState = false; // Toggle state boolean attached with each new node
		oConfigDetails.isSelected = true;
		oConfigDetails.expanded = true;
		oConfigDetails.selectable = true;
		oConfigDetails.hasExpander = true;
		this.oConfigListInstance.oModel.getData().aConfigDetails.push(oConfigDetails);
		this.oConfigListInstance.oModel.updateBindings();
		this.oConfigListInstance.selectedNode = this.oConfigListInstance.oTreeInstance.getNodeByContext(newContextForCopiedNode);
		var context = {
			appId : this.oConfigListInstance.appId,
			configId : sCopiedConfigurationId
		};
		sap.ui.core.UIComponent.getRouterFor(this.oConfigListInstance).navTo(oConfigDetails.type, context);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressCopyButton
	 * @description Handler for copy button in the toolbar
	 * */
	_handlePressCopyButton : function(oEvent) {// event handler for copy button press
		var oSubViewInstance;
		var oSelf = this;
		if (this.oConfigListInstance.getView().byId("idConfigDetailData").getContent().length >= 1) {
			oSubViewInstance = (typeof this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController === "function") ? this.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController()
					: undefined;
		}
		//Remove Focus from the button
		oEvent.getSource().$().blur();
		//check if there is any unsaved change
		var oNavigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
		var isMandatoryFilled = (oSubViewInstance !== undefined) ? (typeof oSubViewInstance.getValidationState === "function" ? oSubViewInstance.getValidationState.call(oSubViewInstance) : true) : true;
		this.oConfigListInstance.bIsSaved = this.oConfigListInstance.configEditor ? this.oConfigListInstance.configEditor.isSaved() : undefined;
		var isDirtyState = false;
		var copyAction = function() {
			var oCopySelf = this;
			var oSelectedTreeNodeDetails = this.oTreeInstance.getNodeContext(this.oTreeInstance.getSelection() || this.selectedNode);
			this.selectedNode = this.oTreeInstance.getSelection() || this.selectedNode;
			var newContextForCopiedNode, oldContextForSelectedNode, newIndexForNewNode, aOldContextForSelectedNode, oParentNode, indexOfConfig, indexOffacetFilter, indexOfCategory, indexOfNavTarget, indexOfStep, indexOfRep;
			oldContextForSelectedNode = oSelectedTreeNodeDetails.nodeContext;
			switch (oSelectedTreeNodeDetails.nodeObjectType) {
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
					var sFacetFilterLabel = this.oCoreApi.getText("copyOf") + "  " + oSelectedTreeNodeDetails.nodeTitle;
					var sCopiedFacetFilterId = this.configEditor.copyFacetFilter(oSelectedTreeNodeDetails.nodeAPFId);
					var oCopiedFacetFilter = this.configEditor.getFacetFilter(sCopiedFacetFilterId);
					var oTranslationFormatForFacetFilterLabel = sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;
					var sFacetFilterLabelId = this.oTextPool.setText(sFacetFilterLabel, oTranslationFormatForFacetFilterLabel);
					oCopiedFacetFilter.setLabelKey(sFacetFilterLabelId);
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					indexOffacetFilter = aOldContextForSelectedNode[6];
					var oFacetFilterForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[0].filters[indexOffacetFilter];
					oFacetFilterForTree.isSelected = false;
					var oCopiedFacetFilterForTree = jQuery.extend(true, {}, oFacetFilterForTree);
					oCopiedFacetFilterForTree.id = sCopiedFacetFilterId;
					oCopiedFacetFilterForTree.name = "< " + sFacetFilterLabel + " >";
					oCopiedFacetFilterForTree.isSelected = true;
					newIndexForNewNode = this.oModel.getData().aConfigDetails[indexOfConfig].configData[0].filters.length;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[0].filters.push(oCopiedFacetFilterForTree);
					aOldContextForSelectedNode[6] = newIndexForNewNode;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
					var sCategoryLabel = this.oCoreApi.getText("copyOf") + "  " + oSelectedTreeNodeDetails.nodeTitle;
					var sCopiedCategoryId = this.configEditor.copyCategory(oSelectedTreeNodeDetails.nodeAPFId);
					var oCopiedCategory = this.configEditor.getCategory(sCopiedCategoryId);
					var oTranslationFormatForCategoryLabel = sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;
					var sCategoryLabelId = this.oTextPool.setText(sCategoryLabel, oTranslationFormatForCategoryLabel);
					var categoryObj = {
						labelKey : sCategoryLabelId
					};
					this.configEditor.setCategory(categoryObj, sCopiedCategoryId);
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					indexOfCategory = aOldContextForSelectedNode[6];
					var aNewStepIds = [];
					var aSteps = this.configEditor.getSteps();
					aSteps.forEach(function(oStep) {
						if (oCopySelf.configEditor.getCategoriesForStep(oStep.getId())[0] === sCopiedCategoryId) {
							aNewStepIds.push(oStep.getId());
						}
					});
					var oCategoryForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory];
					oCategoryForTree.isSelected = false;
					var oCopiedCategoryForTree = jQuery.extend(true, {}, oCategoryForTree);
					if (oCopiedCategoryForTree.steps) {
						for( var i = 0; i < oCopiedCategoryForTree.steps.length; i++) {
							oCopiedCategoryForTree.steps[i].id = aNewStepIds[i];
							var oNewStep = oCopySelf.configEditor.getStep(aNewStepIds[i]);
							var aNewReps = oNewStep.getRepresentations();
							if (oCopiedCategoryForTree.steps[i].representations) {
								for( var j = 0; j < oCopiedCategoryForTree.steps[i].representations.length; j++) {
									oCopiedCategoryForTree.steps[i].representations[j].id = aNewReps[j].getId();
								}
							}
						}
					}
					oCopiedCategoryForTree.id = sCopiedCategoryId;
					oCopiedCategoryForTree.name = "< " + sCategoryLabel + " >";
					oCopiedCategoryForTree.isSelected = true;
					newIndexForNewNode = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories.length;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories.push(oCopiedCategoryForTree);
					aOldContextForSelectedNode[6] = newIndexForNewNode;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
					var sNavTargetName = this.oCoreApi.getText("copyOf") + "  " + oSelectedTreeNodeDetails.nodeTitle;
					var sCopiedNavTargetId = this.configEditor.copyNavigationTarget(oSelectedTreeNodeDetails.nodeAPFId);
					var oCopiedNavTarget = this.configEditor.getNavigationTarget(sCopiedNavTargetId);
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					indexOfNavTarget = aOldContextForSelectedNode[6];
					var oNavTargetForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[2].navTargets[indexOfNavTarget];
					oNavTargetForTree.isSelected = false;
					var oCopiedNavTargetForTree = jQuery.extend(true, {}, oNavTargetForTree);
					oCopiedNavTargetForTree.id = sCopiedNavTargetId;
					oCopiedNavTargetForTree.name = "< " + sNavTargetName + " >";
					oCopiedNavTargetForTree.isSelected = true;
					newIndexForNewNode = this.oModel.getData().aConfigDetails[indexOfConfig].configData[2].navTargets.length;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[2].navTargets.push(oCopiedNavTargetForTree);
					aOldContextForSelectedNode[6] = newIndexForNewNode;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
					var sStepTitle = this.oCoreApi.getText("copyOf") + "  " + oSelectedTreeNodeDetails.nodeTitle;
					var sCopiedStepId = this.configEditor.copyStep(oSelectedTreeNodeDetails.nodeAPFId);
					var aCategoriesForCopiedStep = this.configEditor.getCategoriesForStep(sCopiedStepId);
					var oCopiedStep = this.configEditor.getStep(sCopiedStepId);
					var oTranslationFormatForStepTitle = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;
					var sStepTitleId = this.oTextPool.setText(sStepTitle, oTranslationFormatForStepTitle);
					oCopiedStep.setTitleId(sStepTitleId);
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					indexOfCategory = aOldContextForSelectedNode[6];
					indexOfStep = aOldContextForSelectedNode[8];
					var oStepForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep];
					oStepForTree.isSelected = false;
					var oCopiedStepForTree = jQuery.extend(true, {}, oStepForTree);
					aNewReps = oCopiedStep.getRepresentations();
					oCopiedStepForTree.id = sCopiedStepId;
					oCopiedStepForTree.name = "< " + sStepTitle + " >";
					if (oCopiedStepForTree.representations) {
						for(j = 0; j < oCopiedStepForTree.representations.length; j++) {
							oCopiedStepForTree.representations[j].id = aNewReps[j].getId();
						}
					}
					newIndexForNewNode = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps.length;
					aOldContextForSelectedNode[8] = newIndexForNewNode;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					for(var index = 0; index < aCategoriesForCopiedStep.length; index++){
						var oStepInTree = jQuery.extend(true, {}, oCopiedStepForTree);
						var paramsForCategory = {
								arguments : {
									configId : oSelf.oConfigListInstance.configId,
									categoryId : aCategoriesForCopiedStep[index]
								}
						};
						var sPathForCopiedStep = oSelf.oConfigListInstance.getSPathFromURL(paramsForCategory).sPath.split("/");
						var categoryIndexForCopiedStep = sPathForCopiedStep[6];
						this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndexForCopiedStep].steps.push(oStepInTree);
					}
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[newIndexForNewNode].isSelected = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION://TODO pending for representations
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					indexOfCategory = aOldContextForSelectedNode[6];
					indexOfStep = aOldContextForSelectedNode[8];
					indexOfRep = aOldContextForSelectedNode[10];
					var oParentStepIdForRep = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].id;
					var oParentStep = this.configEditor.getStep(oParentStepIdForRep);
					var aCategoriesForParentStep = this.configEditor.getCategoriesForStep(oParentStepIdForRep);
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].representations[indexOfRep].isSelected = false;
					var oRepForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].representations[indexOfRep];
					var oCopiedRepForTree = jQuery.extend(true, {}, oRepForTree);
					var oCopiedRepId = oParentStep.copyRepresentation(oCopiedRepForTree.id);
					oCopiedRepForTree.id = oCopiedRepId;
					newIndexForNewNode = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].representations.length;
					aOldContextForSelectedNode[10] = newIndexForNewNode;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					for(var categoryIndex = 0; categoryIndex < aCategoriesForParentStep.length ; categoryIndex++){
						var repInTree = jQuery.extend(true, {}, oCopiedRepForTree);
						var paramsForStep = {
								arguments : {
									configId : oSelf.oConfigListInstance.configId,
									categoryId : aCategoriesForParentStep[categoryIndex],
									stepId : oParentStepIdForRep									
								}
						};
						var sPathForCopiedRep= oSelf.oConfigListInstance.getSPathFromURL(paramsForStep).sPath.split("/");
						var categoryIndexForCopiedRep = sPathForCopiedRep[6];
						var stepIndexForCopiedRep = sPathForCopiedRep[8];
						this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndexForCopiedRep].steps[stepIndexForCopiedRep].representations.push(repInTree);
					}
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].representations[newIndexForNewNode].isSelected = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
					var sConfigTitle = this.oCoreApi.getText("copyOf") + "  " + oSelectedTreeNodeDetails.nodeTitle;
					aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
					indexOfConfig = aOldContextForSelectedNode[2];
					var oConfig = this.oModel.getData().aConfigDetails[indexOfConfig];
					oConfig.isSelected = false;
					aOldContextForSelectedNode[2] = this.oModel.getData().aConfigDetails.length;
					newContextForCopiedNode = aOldContextForSelectedNode.join("/");
					this.configurationHandler.copyConfiguration(oSelectedTreeNodeDetails.nodeAPFId, function(sCopiedConfigurationId) {
						var configObj = {
							AnalyticalConfigurationName : sConfigTitle
						};
						var tempConfigId = oCopySelf.configurationHandler.setConfiguration(configObj, sCopiedConfigurationId);
						//sets the application title
						oCopySelf.configTitle = sConfigTitle;
						oCopySelf.configurationHandler.loadConfiguration(tempConfigId, function(configurationEditor) {
							var sConfigTitle = oCopySelf.configTitle;
							var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;
							var sApplicationTitleId = oCopySelf.configurationHandler.getTextPool().setText(sConfigTitle, oTranslationFormat);
							configurationEditor.setApplicationTitle(sApplicationTitleId);
						});
						oSelf._copyConfiguration(sCopiedConfigurationId, newContextForCopiedNode);
					});
				case "default":
					break;
			}
			if (oSelectedTreeNodeDetails.nodeObjectType !== sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) {
				this.oModel.updateBindings();
				this.selectedNode = this.oTreeInstance.getNodeByContext(newContextForCopiedNode);
				var selectedNodeDetails = this.oTreeInstance.getNodeContext(this.selectedNode);
				var oParentNodeDetails = this.oTreeInstance.getParentNodeContext(selectedNodeDetails);
				this.navigateToDifferntView(oParentNodeDetails, selectedNodeDetails);
				this.configEditor.setIsUnsaved();
			}
		};
		//Disable the copy, export when no config is selected
		var disableBtnOnNoConfigSelected = function() {
			var noConfigSelected = new sap.m.Label().addStyleClass("noConfigSelected");
			noConfigSelected.setText(oSelf.oConfigListInstance.oCoreApi.getText("noConfigSelected"));
			noConfigSelected.placeAt(oSelf.oConfigListInstance.byId("idConfigDetailData"));
			oSelf.oConfigListInstance.toolbarController.disableCopyDeleteButton();
			oSelf.oConfigListInstance.disableExportButton();
		};
		var onConfigSwitch;
		if (!isMandatoryFilled) { //check mandatory state
			oNavigationHandlerInstance.throwMandatoryPopup(oSelf.oConfigListInstance, {
				yes : function() {
					oSelf.oConfigListInstance.bIsDifferntConfig = oSelf.oConfigListInstance.oTreeInstance.isConfigurationSwitched(oSelf.oConfigListInstance.oPreviousSelectedNode, oSelf.oConfigListInstance.selectedNode);
					if (oSelf.oConfigListInstance.bIsDifferntConfig === false) {
						var routeContext = oSelf.oConfigListInstance.getRouteContext(oSelf.oConfigListInstance.oParentNodeDetails);
						var oSubViewInstance = (typeof oSelf.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController === "function") ? oSelf.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0]
								.getController() : undefined;
						var isNewView = oSelf.oConfigListInstance._isNewSubView(oSubViewInstance.oViewData.oParams);
						if (!isNewView) {
							var sPathForConfig = oSelf.oConfigListInstance.getSPathForConfig(oSelf.oConfigListInstance.configId);
							copyAction.call(oSelf.oConfigListInstance);
							oSelf.oConfigListInstance._navHandleExpandDelete.call(oSelf.oConfigListInstance, oSelf.oConfigListInstance.oSelectedNodeDetails, routeContext);
						} else {
							oSelf.oConfigListInstance.handleConfirmDeletion();
						}
					} else {
						var bNavState = oSelf.oConfigListInstance._navMandatoryResetState(oSelf.oConfigListInstance);
						if (!bNavState.isNewView) {
							if (!bNavState.bIsSaved) {
								onConfigSwitch(oSelf.oConfigListInstance); //Throw loss of data pop up
							} else {
								copyAction.call(oSelf.oConfigListInstance);
							}
						}
					}
				}
			});
			isDirtyState = true;
		}
		
		var isSwitchConfig;
		if (oSubViewInstance.oViewData.oParams.name === "configuration") {
			isSwitchConfig = true;
		}
		
		onConfigSwitch = function (context) {
			oNavigationHandlerInstance.throwLossOfDataPopup(context, {
				yes : function(saveEditor) {
					oSelf.oConfigListInstance._navSaveState(function() {
						saveEditor(function(id) {
							if (oSelf.oConfigListInstance.selectedNode) {
								var sBindingContext = oSelf.oConfigListInstance.selectedNode.getBindingContext().sPath;
								var aContextForSelectedNode = sBindingContext.split("/");
								var indexOfConfig = aContextForSelectedNode[2];
							}
							oSelf.oConfigListInstance.oModel.getData().aConfigDetails[indexOfConfig].AnalyticalConfiguration = oSelf.oConfigListInstance.configId;
							oSelf.oConfigListInstance.oModel.updateBindings();
							copyAction.call(oSelf.oConfigListInstance);
						});
					});
				},
				no : function() {
					var context = {
						appId : oSelf.oConfigListInstance.appId,
						configId : oSelf.oConfigListInstance.configId
					};
					var oSubViewInstance = (typeof oSelf.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0].getController === "function") ? oSelf.oConfigListInstance.getView().byId("idConfigDetailData").getContent()[0]
							.getController() : undefined;
					var isSwitchConfig = (oSubViewInstance.oViewData.oParams.name === "configuration") ? true : false;
					if (oSelf.oConfigListInstance.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //If new confiuration splice from model before navigating 
						oSelf.oConfigListInstance._navHandleExpandDelete.call(oSelf.oConfigListInstance, {}, context, isSwitchConfig);
						oSelf.oConfigListInstance.clearTitleAndBreadCrumb();
						oSelf.oConfigListInstance.byId("idConfigDetailData").removeAllContent(); //Remove All Previous Stacked Content from DOM
						disableBtnOnNoConfigSelected();
					} else {
						oSelf.oConfigListInstance._navConfigResetState(oSelf.oConfigListInstance, function() {
							copyAction.call(oSelf.oConfigListInstance);
						});
					}
				}
			});
		};
		
		//On check of saved state and mandatory field filled
		if (!oSelf.oConfigListInstance.bIsSaved && isMandatoryFilled && isSwitchConfig) {
			onConfigSwitch(oSelf.oConfigListInstance); //Throw loss of data pop up
			isDirtyState = true;
		}
		
		if (!isDirtyState) { //if clean state then copy the node
			copyAction.call(oSelf.oConfigListInstance);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressDeleteButton
	 * @description Handler for delete button in the toolbar
	 * */
	_handlePressDeleteButton : function(oEvent) { // handler for delete button in the toolbar above tree control
		var sDialogMessage;
		var oSelectedTreeNodeDetails = this.oConfigListInstance.oTreeInstance.getNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());
		var nodeTypeName = this.oCoreApi.getText(oSelectedTreeNodeDetails.nodeObjectType);
		//Remove Focus from the button
		oEvent.getSource().$().blur();
		if(oSelectedTreeNodeDetails.nodeObjectType === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP){
            sDialogMessage = this.oCoreApi.getText("confirmStepDeletion", [ oSelectedTreeNodeDetails.nodeTitle ]);
        }
        else{
            sDialogMessage = this.oCoreApi.getText("confirmDeletion", [ nodeTypeName, oSelectedTreeNodeDetails.nodeTitle ]);
        }
		this._openDeleteConfirmationDialog(sDialogMessage);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_openDeleteConfirmationDialog
	 * @description Opens a confirmation dialog before deleting a node from the tree
	 * */
	_openDeleteConfirmationDialog : function(sDialogMessage) {
		var oSelf = this;
		var oContext = jQuery.extend(oSelf.oConfigListInstance, {
			closeDialog : oSelf.closeDialog.bind(oSelf)
		});
		
		if (!this.confirmationDialog) {
			this.confirmationDialog = sap.ui.xmlfragment("idConfigConfirmationDialogFragment", "sap.apf.modeler.ui.fragment.confirmationDialog", oContext);
			this.getView().addDependent(this.confirmationDialog);
			this._setConfirmationDialogText();
		}
		var confirmationMessageLabel = new sap.m.Label();
		confirmationMessageLabel.addStyleClass("dialogText");
		confirmationMessageLabel.setText(sDialogMessage);
		this.confirmationDialog.removeAllContent();
		this.confirmationDialog.addContent(confirmationMessageLabel); // add the confirmation message to the dialog
		jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.confirmationDialog);
		this.confirmationDialog.open();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#closeDialog
	 * @description Closes the delete confirmation dialog
	 * */
	closeDialog : function() {
		if (this.confirmationDialog && this.confirmationDialog.isOpen()) {
			this.confirmationDialog.close();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_setConfirmationDialogText
	 * @description Sets text for the delete confirmation dialog
	 * */
	_setConfirmationDialogText : function() {
		sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment", "idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));
		sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment", "idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));
		sap.ui.core.Fragment.byId("idConfigConfirmationDialogFragment", "idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressMoveUpButton
	 * @description Handler for move up button in the toolbar
	 * */
	_handlePressMoveUpButton : function() {//handler for moving an object of the tree one level up
		this.bIsDown = false;
		var selectedNode = this.oConfigListInstance.oTreeInstance.getSelection();
		if (selectedNode !== null) {
			var selectedNodeContext = this.oConfigListInstance.oTreeInstance.getNodeContext(selectedNode);
			if (selectedNodeContext !== undefined) {
				this._moveUpOrDown(selectedNodeContext, this.bIsDown);
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handlePressMoveUpButton
	 * @description Handler for move down button in the toolbar
	 * */
	_handlePressMoveDownButton : function() {//handler for moving an object of the tree one level down
		this.bIsDown = true;
		var selectedNode = this.oConfigListInstance.oTreeInstance.getSelection();
		if (selectedNode !== null) {
			var selectedNodeContext = this.oConfigListInstance.oTreeInstance.getNodeContext(selectedNode);
			if (selectedNodeContext !== undefined) {
				this._moveUpOrDown(selectedNodeContext, this.bIsDown);
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_moveUpOrDown
	 * @param {Object} Selected node context
	 * @param {boolean} Boolean stating whether down button is pressed
	 * @description Moves the node up or down depending upon which button is pressed in the toolbar
	 * */
	_moveUpOrDown : function(selectedNodeContext, bIsDown) {
		var selectedNodeObjectType = selectedNodeContext.nodeObjectType;
		var selectedNodeId = selectedNodeContext.nodeAPFId;
		var nodeContext = selectedNodeContext.nodeContext;
		var configIndexInTree = nodeContext.split('/')[2];
		var aObjectArray, swapToIndex, oTemp1, oTemp2, len;
		var bSwap = false;
		var swapFromIndex = nodeContext.split('/')[nodeContext.split('/').length - 1];
		switch (selectedNodeObjectType) {
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
				aObjectArray = this.oConfigListInstance.oModel.getData().aConfigDetails[configIndexInTree].configData[0].filters;
				len = aObjectArray.length;
				if (bIsDown) {
					if (parseInt(swapFromIndex, 10) !== (len - 1)) {
						this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(selectedNodeId, 1);
						swapToIndex = parseInt(swapFromIndex, 10) + 1;
						bSwap = true;
					}
				} else {
					if (parseInt(swapFromIndex, 10) !== 0) {
						this.oConfigListInstance.configEditor.moveFacetFilterUpOrDown(selectedNodeId, -1);
						swapToIndex = parseInt(swapFromIndex, 10) - 1;
						bSwap = true;
					}
				}
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
				aObjectArray = this.oConfigListInstance.oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories;
				len = aObjectArray.length;
				if (bIsDown) {
					if (parseInt(swapFromIndex, 10) !== (len - 1)) {
						this.oConfigListInstance.configEditor.moveCategoryUpOrDown(selectedNodeId, 1);
						swapToIndex = parseInt(swapFromIndex, 10) + 1;
						bSwap = true;
					}
				} else {
					if (parseInt(swapFromIndex, 10) !== 0) {
						this.oConfigListInstance.configEditor.moveCategoryUpOrDown(selectedNodeId, -1);
						swapToIndex = parseInt(swapFromIndex, 10) - 1;
						bSwap = true;
					}
				}
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
				aObjectArray = this.oConfigListInstance.oModel.getData().aConfigDetails[configIndexInTree].configData[2].navTargets;
				len = aObjectArray.length;
				if (bIsDown) {
					if (parseInt(swapFromIndex, 10) !== (len - 1)) {
						this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(selectedNodeId, 1);
						swapToIndex = parseInt(swapFromIndex, 10) + 1;
						bSwap = true;
					}
				} else {
					if (parseInt(swapFromIndex, 10) !== 0) {
						this.oConfigListInstance.configEditor.moveNavigationTargetUpOrDown(selectedNodeId, -1);
						swapToIndex = parseInt(swapFromIndex, 10) - 1;
						bSwap = true;
					}
				}
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
				var categoryIndexInConfig = nodeContext.split('/')[6];
				var categoryInConfig = this.oConfigListInstance.oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig];
				aObjectArray = categoryInConfig.steps;
				len = aObjectArray.length;
				if (bIsDown) {
					if (parseInt(swapFromIndex, 10) !== (len - 1)) {
						this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(categoryInConfig.id, selectedNodeId, 1);
						swapToIndex = parseInt(swapFromIndex, 10) + 1;
						bSwap = true;
					}
				} else {
					if (parseInt(swapFromIndex, 10) !== 0) {
						this.oConfigListInstance.configEditor.moveCategoryStepAssignmentUpOrDown(categoryInConfig.id, selectedNodeId, -1);
						swapToIndex = parseInt(swapFromIndex, 10) - 1;
						bSwap = true;
					}
				}
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
				var selectedStep = this.oConfigListInstance.oTreeInstance.getSelection();
				var selectedStepObj = sap.ui.getCore().byId(selectedStep.getId());
				var stepNode = selectedStepObj.getParent();
				var stepNodeId = this.oConfigListInstance.oTreeInstance.getNodeContext(stepNode).nodeAPFId;
				var step = this.oConfigListInstance.configEditor.getStep(stepNodeId);
				categoryIndexInConfig = nodeContext.split('/')[6]; //get the category and step index
				var stepIndexInCategory = nodeContext.split('/')[8];
				aObjectArray = this.oConfigListInstance.oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].representations;
				len = aObjectArray.length;
				if (bIsDown) {
					if (parseInt(swapFromIndex, 10) !== (len - 1)) {
						step.moveRepresentationUpOrDown(selectedNodeId, 1);
						swapToIndex = parseInt(swapFromIndex, 10) + 1;
						bSwap = true;
					}
				} else {
					if (parseInt(swapFromIndex, 10) !== 0) {
						step.moveRepresentationUpOrDown(selectedNodeId, -1);
						swapToIndex = parseInt(swapFromIndex, 10) - 1;
						bSwap = true;
					}
				}
				break;
		}
		if (bSwap) {
			oTemp1 = aObjectArray[swapFromIndex];
			oTemp2 = aObjectArray[swapToIndex];
			aObjectArray[swapToIndex] = oTemp1;
			aObjectArray[swapFromIndex] = oTemp2;
			this.oConfigListInstance.oModel.updateBindings();
			this.oConfigListInstance.configEditor.setIsUnsaved();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handleAddExistingStepPress
	 * @description Handler for existing step menu item in the toolbar
	 * */
	_handleAddExistingStepPress : function(){
		var self = this;
		var selectedNodeDetails = this.oConfigListInstance.oTreeInstance.getNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());
		var categoryId = this.oConfigListInstance.oTreeInstance.getParentNodeContext(selectedNodeDetails).categoryId;
		var aStepsNotAssignedToCategoryIds = this.oConfigListInstance.configEditor.getStepsNotAssignedToCategory(categoryId);
		var sStepTitle;
		var aStepsNotAssignedToCategory = [];
		aStepsNotAssignedToCategoryIds.forEach(function(stepId){
			var oStepNotAssignedToCategory = {};
			var oStep = self.oConfigListInstance.configEditor.getStep(stepId);
			sStepTitle = self.oConfigListInstance.oTextPool.get(oStep.getTitleId()).TextElementDescription;
			oStepNotAssignedToCategory.id = stepId;
			oStepNotAssignedToCategory.name = sStepTitle;
			aStepsNotAssignedToCategory.push(oStepNotAssignedToCategory);
		});
		var oModelDialog = new sap.ui.model.json.JSONModel({
			existingStepData : aStepsNotAssignedToCategory
		});
		if(!this.addExistingStepDialog){
			this.addExistingStepDialog= sap.ui.xmlfragment("idExistingStepDialogFragment", "sap.apf.modeler.ui.fragment.existingStepDialog", this);
			this._setExistingStepDialogText();
		}
		this.getView().addDependent(this.addExistingStepDialog);
		this.addExistingStepDialog.setModel(oModelDialog);
		this.addExistingStepDialog.open();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handleExistingStepDialogOK
	 * @description Handler for press of ok in the existing step dialog
	 * */
	_handleExistingStepDialogOK : function(oEvent){
		var self = this;
		var nodeObjectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;
		var selectedSteps = oEvent.getParameters("listItem").selectedItems;
		var noOfSteps = selectedSteps.length;
		var selectedNodeDetails = this.oConfigListInstance.oTreeInstance.getNodeContext(this.oConfigListInstance.oTreeInstance.getSelection());
		var categoryId = this.oConfigListInstance.oTreeInstance.getParentNodeContext(selectedNodeDetails).categoryId;
		var aExistingStepsToBeAdded = [];
		for(var i = 0; i < noOfSteps; i++){
			var sPathOfExistingStep = oEvent.getParameters("selectedItems").selectedContexts[i].sPath.split('/')[2];
			var oExistingStep = oEvent.getSource().getModel().getData().existingStepData[sPathOfExistingStep];
			var step = this.oConfigListInstance.configEditor.getStep(oExistingStep.id);
			this.oConfigListInstance.configEditor.addCategoryStepAssignment(categoryId, oExistingStep.id);
			var aRepresentations = step.getRepresentations();
			var noOfReps = aRepresentations.length;
			var aRepresentationsToBeAdded = [];
			for(var j = 0; j< noOfReps; j++){
				var oRepresentation = {};
				oRepresentation.id = aRepresentations[j].getId();
				oRepresentation.name = aRepresentations[j].getRepresentationType();
				oRepresentation.icon = this._getRepresentationIcon(oRepresentation.name);
				aRepresentationsToBeAdded.push(oRepresentation);
			}
			var oStep = {};
			oStep.step = oExistingStep;
			oStep.representations = aRepresentationsToBeAdded;
			oStep.noOfReps = noOfReps;
			aExistingStepsToBeAdded.push(oStep);
		}
		if(noOfSteps !== 0){
			var params = {
					noOfSteps : noOfSteps,
					aExistingStepsToBeAdded : aExistingStepsToBeAdded
			};
			this.oConfigListInstance.oTreeInstance.addNodeInTree(nodeObjectType, params);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_getRepresentationIcon
	 * @description Returns teh representation icon for a representation type
	 * @param {String} Representation type
	 * @return {String} Picture or icon of the representation type
	 * */
	_getRepresentationIcon : function(sRepresentationName) {
		var icon;
		var oRepresentationTypes = this.oCoreApi.getRepresentationTypes();
		for(var index = 0; index < oRepresentationTypes.length; index++){
			if(sRepresentationName === oRepresentationTypes[index].id){
				icon = oRepresentationTypes[index].picture;
				break;
			}
		}
		return icon;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handleExistingStepDialogSearch
	 * @description Handler for search in the existing step dialog
	 * */
	_handleExistingStepDialogSearch: function(oEvent) {
	    var sValue = oEvent.getParameter("value");
	    var oFilter = new sap.ui.model.Filter("name", sap.ui.model.FilterOperator.Contains, sValue);
	    var oBinding = oEvent.getSource().getBinding("items");
	    oBinding.filter([oFilter]);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.toolbar#_handleExistingStepDialogOK
	 * @description Handler for press of ok in the existing step dialog
	 * */
	_handleExistingStepDialogClose : function(oEvent) {
		if (this.addExistingStepDialog) {
			oEvent.getSource().getBinding("items").filter([]);
		}
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class analysisPath
 *@memberOf sap.apf.ui.reuse.controller
 *@name analysisPath
 *@description controller for view.analysisPath
 */
sap.ui.controller("sap.apf.ui.reuse.controller.analysisPath", {
	/**
	 *@this {sap.apf.ui.reuse.controller.analysisPath}
	 */
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 */
	refreshAnalysisPath : function() {
		this.getView().getCarousel().getController().refreshCarousel();
	},
	isOpenPath : false,
	isNewPath : false,
	bIsBackNavigation : false,
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
		this.bIsDirtyState = false;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method refresh
	 *@description Adds loading sign to steps which have changed 
	 *@param {number} nStartIndex index of step in analysis path after which filter has changed
	 */
	refresh : function(nStartIndex) {
		var oView = this.getView().oCarousel;
		var aStepViews = oView.stepViews;
		var i;
		if (nStartIndex !== -1) {
			for(i = nStartIndex; i < aStepViews.length; i++) {
				var oStepView = {};
				oStepView = aStepViews[i];
				if (oStepView !== undefined) {
					oStepView.oThumbnailChartLayout.setBusy(true);
					//oStepView.rerender();
				}
			}
		}
		var nActiveStepIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
		if (nActiveStepIndex > nStartIndex) {
			var oChartView = this.oUiApi.getStepContainer();
			oChartView.vLayout.setBusy(true);
		}
		var pathName = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		if ((this.bIsDirtyState === undefined || this.bIsDirtyState === false) && this.oCoreApi.getSteps().length !== 0) {
			var pathHasChanged = "*" + pathName;
			this.bIsDirtyState = true;
			this.oUiApi.getAnalysisPath().oSavedPathName.setTitle(pathHasChanged);
		}
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method callBackforUpdatePath 
	 *@param {object} oCurrentStep: Current Step instance 
	 *@param {boolean} bStepChanged  returns true if filter of step has changed
	 *@description Calls method updateCurrentStep if current step has changed 
	 */
	callBackForUpdatePath : function(oCurrentStep, bStepChanged) {
		var nIndex = this.oCoreApi.getSteps().indexOf(oCurrentStep);
		if (nIndex === 0) {
			this.refreshAnalysisPath();
		}
		this.updateCurrentStep(oCurrentStep, nIndex, bStepChanged);
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method callBackForUpdatePathAndSetLastStepAsActive
	 *@param {object} oCurrentStep: Current Step instance
	 *@param {boolean} bStepChanged returns true if step has changed
	 *@description Sets last step as active and calls method update Path 
	 */
	callBackForUpdatePathAndSetLastStepAsActive : function(oCurrentStep, bStepChanged) {
		var nIndex = this.oCoreApi.getSteps().indexOf(oCurrentStep);
		if (nIndex === 0) {
			var oStep = this.oCoreApi.getSteps()[this.oCoreApi.getSteps().length - 1];
			this.oCoreApi.setActiveStep(oStep);
			this.refreshAnalysisPath();
		}
		this.updateCurrentStep(oCurrentStep, nIndex, bStepChanged);
		this.oUiApi.getLayoutView().setBusy(false);
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method updateCurrentStep
	 *@param {object} oCurrentStep: CurrentStep instance
	 *@param {number} nIndex: index of CurrentStep
	 *@param {boolean} bStepChanged returns true if step has changed
	 *@description updates Analysis Path if steps following current step has changed. If CurrentStep is active draws chart in main area.
	 */
	updateCurrentStep : function(oCurrentStep, nIndex, bStepChanged) {
		var isOpenPath = this.oUiApi.getAnalysisPath().getController().isOpenPath;
		var nActiveIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
		var isActiveStep = (nIndex === nActiveIndex);
		var isLastStep = (nIndex === this.oCoreApi.getSteps().length - 1);
		this.drawThumbnail(nIndex, bStepChanged || isOpenPath);
		if (isActiveStep) {
			this.drawMainChart(bStepChanged);
		}
		if (this.oUiApi.getAnalysisPath().getController().isOpenPath && (this.oCoreApi.getSteps().indexOf(oCurrentStep) === (this.oCoreApi.getSteps().length - 1))) {
			this.oUiApi.getLayoutView().setBusy(false);
			this.oUiApi.getAnalysisPath().getController().isOpenPath = false;
		}
		if (this.oUiApi.getAnalysisPath().getController().bIsBackNavigation && (this.oCoreApi.getSteps().indexOf(oCurrentStep) === (this.oCoreApi.getSteps().length - 1))) {
			this.oUiApi.getLayoutView().setBusy(false);
			this.oUiApi.getAnalysisPath().getController().bIsBackNavigation = false;
		}
		this.oUiApi.getAnalysisPath().getController().isNewPath = false;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method drawMainChart
	 *@param {boolean} bStepChanged returns true if step has changed
	 *@description gets chartArea of application from API sap.apf.ui.getStepConatiner() and draws Chart 
	 */
	drawMainChart : function(bStepChanged) {
		var oChartView = this.oUiApi.getStepContainer();
		oChartView.getController().drawStepContent(bStepChanged);
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.analysisPath
	 *@method drawMainChart
	 *@param {number} nIndex index of step for which thumbnail has to be drawn
	 *@param {boolean} bStepChanged returns true if step has changed
	 *@description gets chartArea of application from API sap.apf.ui.getStepConatiner() and draws Chart 
	 */
	drawThumbnail : function(nIndex, bStepChanged) {
		var oStepView = this.getView().getCarousel().getStepView(nIndex);
		oStepView.getController().drawThumbnailContent(bStepChanged);
	}
});
/*!

 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/* globals document */
/**
 *@class carousel
 *@name carousel
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller for view.carousel
 */
sap.ui.controller("sap.apf.ui.reuse.controller.carousel", {
	/**
	*@this {sap.apf.ui.reuse.controller.carousel}
	*/
	onAfterRendering : function() {
		if (this.oCoreApi.getSteps().length < 1) {
			jQuery(".DnD-separator").hide(); //Hide the Separator initially 
		}
		// remaining code from getInitialStep:
		this.oViewData = this.getView().getViewData().oInject;
		this.oUiApi = this.oViewData.uiApi;
		jQuery(this.oUiApi.getStepContainer().getDomRef()).hide();
		if (jQuery("#" + this.initialText.getId()).length === 0) {
			jQuery('#' + this.oUiApi.getStepContainer().getId()).parent().append(sap.ui.getCore().getRenderManager().getHTML(this.initialText));
		}
		if (this.oUiApi.getAnalysisPath().getController().isOpenPath) {
			jQuery(".initialText").remove();
		}
	},
	onInit : function() {
		var oViewData = this.getView().getViewData().oInject;
		this.oCoreApi = oViewData.oCoreApi;
		this.oUiApi = oViewData.uiApi;
		this.stepGalleryView = sap.ui.view({
			type : sap.ui.core.mvc.ViewType.JS,
			viewName : "sap.apf.ui.reuse.view.stepGallery",
			viewData : oViewData
		});
		this.initialText = new sap.m.Label({
			text : oViewData.oCoreApi.getTextNotHtmlEncoded('initialText')
		}).addStyleClass('initialText');
	},
	showStepGallery : function() {
		this.stepGalleryView.oController.openHierarchicalSelectDialog();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.carousel
	*@method onAfterRendering 
	*@description Attaches event on Add Step Button and instantiate Step Gallery
	* Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.
	* This hook is the same one that SAPUI5 controls get after being rendered.
	*/
	onBeforeRendering : function() {
		this.oUiApi.getLayoutView().getController().addMasterFooterContentLeft(this.getView().up);
		this.oUiApi.getLayoutView().getController().addMasterFooterContentLeft(this.getView().down);
	},
	getStepData : function(stepObj) {
		var oSelf = this;
		var fStep = stepObj;
		var oStep = {};
		oStep.index = this.oCoreApi.getSteps().indexOf(stepObj);
		oStep.title = this.oCoreApi.getTextNotHtmlEncoded(fStep.title);
		oStep.thumbnail = this.getThumbnailDataset(stepObj);
		return oStep;
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.carousel
	*@method refreshCarousel
	*@description Binds to model and set the Steps as droppable 
	 */
	refreshCarousel : function() {
		if (this.oCoreApi.getSteps().length > this.getView().stepViews.length) {
			this.addStep(this.oCoreApi.getSteps());//sap.apf.getSteps()[sap.apf.getSteps().length - 1]
		}
		//		var indexActive = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
		//		var activeStep = this.getView().dndBox.eleRefs.blocks[indexActive];
		//		if (activeStep !== undefined) {
		//			//activeStep.scrollIntoViewIfNeeded();
		//		}
	},
	addStep : function(stepObj) {
		this.oViewData = this.getView().getViewData().apfInstance;
		if (stepObj instanceof Array) {
			if (this.oUiApi.getAnalysisPath().getController().isOpenPath || this.oUiApi.getAnalysisPath().getController().bIsBackNavigation) {
				var i;
				for(i = 0; i < stepObj.length; i++) {
					this.addStep(stepObj[i]);
				}
				return;
			} else {
				this.addStep(stepObj[this.oCoreApi.getSteps().length - 1]);
				return;
			}
		}
		var stepView = new sap.ui.view({
			viewName : "sap.apf.ui.reuse.view.step",
			type : sap.ui.core.mvc.ViewType.JS,
			viewData : this.getView().getViewData().oInject
		});
		var jsonModel = new sap.ui.model.json.JSONModel();
		stepView.setModel(jsonModel);
		var stepData = this.getStepData(stepObj);
		jsonModel.setData(stepData);
		this.getView().stepViews.push(stepView);
		var sampleDiv = document.createElement('div');
		sampleDiv.innerHTML = sap.ui.getCore().getRenderManager().getHTML(stepView);
		var dndBox = this.getView().dndBox;
		var blockIndex = dndBox.eleRefs.blocks.length - 1;
		jQuery(".initialText").remove();
		jQuery(this.oUiApi.getStepContainer().getDomRef()).show(); // Show the step container
		jQuery(".DnD-separator").show(); //Show the Seperator once the step is added
		var isConfigInitial = this.Step ? this.Step.categories[0].id : undefined;
		if (isConfigInitial === "initial") {
			dndBox.insertBlock({
				blockElement : sampleDiv,
				dragState : false,
				dropState : false,
				removable : false
			}, blockIndex);
		} else {
			dndBox.insertBlock({
				blockElement : sampleDiv
			}, blockIndex);
		}
		if (stepData.index === this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep())) {
			stepView.toggleActiveStep();
		}
		stepView.rerender();
		this.oUiApi.getLayoutView().setBusy(true);
	},
	moveStep : function(dragIndex, dropIndex) {
		var carouselView = this.oUiApi.getAnalysisPath().getCarousel();
		if (dragIndex === dropIndex) {
			return;
		}
		carouselView.stepViews = (function(array, from, to) {
			var diff = Math.abs(to - from);
			var adder = (to - from) > 0 ? 1 : -1;
			var temp;
			while (diff--) {
				temp = array[from];
				array[from] = array[from + adder];
				array[from + adder] = temp;
				from = from + adder;
			}
			return array;
		})(carouselView.stepViews, dragIndex, dropIndex);
		this.oUiApi.getAnalysisPath().getController().refresh(Math.min(dragIndex, dropIndex));
		var draggedStep = this.oCoreApi.getSteps()[dragIndex];
		this.oCoreApi.moveStepToPosition(draggedStep, dropIndex, this.oUiApi.getAnalysisPath().getController().callBackForUpdatePath.bind(this.oUiApi.getAnalysisPath().getController()));
	},
	removeStep : function(removeIndex) {
		var carouselView = this.oUiApi.getAnalysisPath().getCarousel();
		carouselView.stepViews.splice(removeIndex, 1);
		var stepLength = carouselView.stepViews.length;
		var activeStepIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
		if (stepLength > 0) {
			if (removeIndex === activeStepIndex) {
				var newActiveStepIndex;
				var stepView;
				if (activeStepIndex === 0) {
					newActiveStepIndex = activeStepIndex;
					stepView = carouselView.stepViews[newActiveStepIndex];
					stepView.toggleActiveStep();
					this.oCoreApi.setActiveStep(this.oCoreApi.getSteps()[newActiveStepIndex + 1]);
				} else {
					newActiveStepIndex = activeStepIndex - 1;
					stepView = carouselView.stepViews[newActiveStepIndex];
					stepView.toggleActiveStep();
					this.oCoreApi.setActiveStep(this.oCoreApi.getSteps()[newActiveStepIndex]);
				}
			}
		} else {
			jQuery(".DnD-separator").hide();// If step length is 0 then hide the seperator
			jQuery(this.oUiApi.getStepContainer().getDomRef()).hide(); //Hide the step container
			this.oUiApi.getStepContainer().getStepToolbar().chartToolbar.removeAllCharts();
			jQuery('#' + this.oUiApi.getStepContainer().getId()).parent().append(sap.ui.getCore().getRenderManager().getHTML(this.initialText));
		}
		var removeStep = this.oCoreApi.getSteps()[removeIndex];
		this.oUiApi.getAnalysisPath().getController().refresh(removeIndex);
		this.oCoreApi.removeStep(removeStep, this.oUiApi.getAnalysisPath().getController().callBackForUpdatePath.bind(this.oUiApi.getAnalysisPath().getController()));
	},
	removeAllSteps : function() {
		var removeIndex = 0;
		var i;
		var dndBox = this.getView().dndBox;
		var carouselView = this.oUiApi.getAnalysisPath().getCarousel();
		var stepLength = carouselView.stepViews.length;
		for(i = 1; i <= stepLength; i++) {
			dndBox.removeBlock(removeIndex, function() {
				return;
			});
			carouselView.stepViews.splice(removeIndex, 1);
		}
		jQuery(".DnD-separator").hide(); //Hide the seperator 
		this.oUiApi.getStepContainer().getStepToolbar().chartToolbar.removeAllCharts();
	},
	getThumbnailDataset : function(oStep) {
		var oSelf = this;
		var aThumbnails = [ "leftUpper", "rightUpper", "leftLower", "rightLower" ];
		var oThumbnailFromStep = oStep.thumbnail;
		var oThumbnailFromRepresentation = oStep.getSelectedRepresentationInfo().thumbnail;
		var oResultThumbnail = {};
		aThumbnails.forEach(function(sThumbnail) {
			var bHasRepresentationThumbnail = oThumbnailFromRepresentation && oThumbnailFromRepresentation[sThumbnail];
			bHasRepresentationThumbnail = bHasRepresentationThumbnail && !oSelf.oCoreApi.isInitialTextKey(oThumbnailFromRepresentation[sThumbnail]);
			var bHasStepThumbnail = oThumbnailFromStep && oThumbnailFromStep[sThumbnail];
			bHasStepThumbnail = bHasStepThumbnail && !oSelf.oCoreApi.isInitialTextKey(oThumbnailFromStep[sThumbnail]);
			if (bHasRepresentationThumbnail) {
				oResultThumbnail[sThumbnail] = oSelf.oCoreApi.getTextNotHtmlEncoded(oThumbnailFromRepresentation[sThumbnail]);
				return;
			} else if (bHasStepThumbnail) {
				oResultThumbnail[sThumbnail] = oSelf.oCoreApi.getTextNotHtmlEncoded(oThumbnailFromStep[sThumbnail]);
				return;
			}
		});
		return oResultThumbnail;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class deleteAnalysisPath
 *@name deleteAnalysisPath
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller of view.deleteAnalysisPath
 */
sap.ui.controller("sap.apf.ui.reuse.controller.deleteAnalysisPath", {
	/**
	 *@this {sap.apf.ui.reuse.controller.pathGallery}
	 */
	onInit : function() {
		var self = this;
		this.oCoreApi = this.getView().getViewData().oInject.oCoreApi;
		this.oUiApi = this.getView().getViewData().oInject.uiApi;
		this.oSerializationMediator = this.getView().getViewData().oInject.oSerializationMediator;
		this.contentWidth = jQuery(window).height() * 0.6 + "px"; // height and width for the dialog relative to the window
		this.contentHeight = jQuery(window).height() * 0.6 + "px";
		this.stdDialog = new sap.m.Dialog({
			title : self.oCoreApi.getTextNotHtmlEncoded("select-analysis-path"),
			contentWidth : self.contentWidth,
			contentHeight : self.contentHeight,
			content : this.getView().getContent()[0],
			leftButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("cancel"),
				press : function() {
					self.stdDialog.close();
					self.oUiApi.getLayoutView().setBusy(false);
				}
			})
		});
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.pathGallery
	*@method openPathGalleryWithDelete
	*@description opens the path gallery with delete mode
	*/
	openPathGalleryWithDelete : function() {
		this.stdDialog.open();
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.pathGallery
	 *@method getGuidForPath
	 *@description Fetches guid for a path
	 */
	getGuidForPath : function(sPathName, viewData) {
		var i;
		for(  i = 0; i < viewData.length; i++) {
			var oData = viewData[i];
			if (oData.AnalysisPathName === sPathName) {
				return oData.guid;
			}
		}
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.pathGallery
	 *@method deleteSavedPath
	 *@description deletes the section and path from path gallery.
	 *@param {object} sectionDom
	 */
	deleteSavedPath : function(sPathName, oInfo) {
		var self = this;
		var guid = oInfo.guid;
		var pathName = sPathName;
		var oMessageObject;
		var currentPath = self.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		self.oSerializationMediator.deletePath(guid, function(oResponse, metaData, msgObj) {
			if (msgObj === undefined && (typeof oResponse === "object")) {
				oInfo.list.removeItem(oInfo.item);
				self.oCoreApi.readPaths(function(oResponse, metaData, msgObj) {
					if (msgObj === undefined && (typeof oResponse === "object")) {
						var noOfPaths = oResponse.paths.length;
						//Text to be shown in galery when all paths are deleted
						if (noOfPaths === 0) {
							jQuery(".pathText").removeClass("pathTextDontShow");
							jQuery(".pathText").addClass("pathTextShow");
						}
					} else {
						oMessageObject = self.oCoreApi.createMessageObject({
							code : "6005",
							aParameters : [ pathName ]
						});
						oMessageObject.setPrevious(msgObj);
						self.oCoreApi.putMessage(oMessageObject);
					}
				});
			} else {
				oMessageObject = self.oCoreApi.createMessageObject({
					code : "6009",
					aParameters : [ "delete", pathName ]
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
		//If current path is deleted reset the analysis path
		if (currentPath === pathName) {
			self.oUiApi.getAnalysisPath().getToolbar().getController().resetAnalysisPath();
		}
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.controller("sap.apf.ui.reuse.controller.layout", {
	onInit : function() {
		//Application Title
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
		this.oNavigationHandler = this.getView().getViewData().oNavigationHandler;
		var applicationTitleKey;
		// Check if app config properties are available
		if (this.oCoreApi.getApplicationConfigProperties()) {
			applicationTitleKey = this.oCoreApi.getApplicationConfigProperties().appName;
		}
		this.applicationTitle = this.oCoreApi.getTextNotHtmlEncoded(applicationTitleKey);
		this.getView().byId("application").addStyleClass("sapApfHeader");
		this.getView().byId("application").setText(this.applicationTitle);
		//Initialize Message Handler
		var oMessageHandlerView = this.oUiApi.getNotificationBar();
		this.getView().byId("applicationPage").addContent(oMessageHandlerView);
		var fnCallbackMessageHandling = oMessageHandlerView.initializeHandler;
		//this.oCoreApi.activateOnErrorHandling(true);
		this.oCoreApi.setCallbackForMessageHandling(fnCallbackMessageHandling.bind(oMessageHandlerView));
		this.loadLayout();
	},
	/**
	 *@description Layout specific content settings
	 */
	loadLayout : function() {
		var chartView = this.oUiApi.getStepContainer();
		var analysisPath = this.oUiApi.getAnalysisPath();
		this.getView().byId("application").setText(this.applicationTitle);
		this.getView().byId("masterFooter").addStyleClass("applicationFooter");
		this.getView().byId("detailFooter").addStyleClass("applicationFooter");
		this.getView().byId("stepContainer").addContent(chartView);
		this.getView().byId("analysisPath").addContent(analysisPath);
		this.addOpenInButton();//adds the "Open In..." button to the footer for navigation targets
	},
	onAfterRendering : function() {
		var self = this;
		var showMasterButton = new sap.m.Button({
			text : this.oCoreApi.getTextNotHtmlEncoded("showAnalyticalPath"),
			press : function() {
				self.getView().byId("applicationView").showMaster();
			},
			lite : true,
			type : "Transparent"
		});
		this.getView().byId("applicationView").attachAfterMasterClose(function() {
			self.getView().byId("detailFooter").removeContentLeft(showMasterButton);
			self.addDetailFooterContentLeft(showMasterButton);
		});
		this.getView().byId("applicationView").attachAfterMasterOpen(function() {
			if (self.getView().byId('detailFooter')) {
				self.getView().byId("detailFooter").removeAllContentLeft();
			}
		});
		if (this.getView().byId("applicationView").isMasterShown() === false) {
			this.addDetailFooterContentLeft(showMasterButton);
		}
		
	},
	hideMaster : function() {
		if (sap.ui.Device.system.phone || sap.ui.Device.system.tablet) {
			this.getView().byId("applicationView").hideMaster();
			if (sap.ui.Device.system.phone) {
				this.getView().byId("applicationView").toDetail(this.getView().byId("stepContainer").getId());
			}
		}
	},
	showMaster : function() {
		this.getView().byId("applicationView").showMaster();
	},
	//            setDetailTitle : function(oControl) {
	//                            this.detailTitleRemoveAllContent();
	//                            this.getView().byId("headerDetail").addContentMiddle(oControl);
	//            },
	//            detailTitleRemoveAllContent : function() {
	//                            this.getView().byId("headerDetail").removeAllContentMiddle();
	//            },
	/**
	 *@description Adds content to Master Footer alignment: Left
	 *@param oControl
	 */
	addMasterFooterContentLeft : function(oControl) {
		this.getView().byId("masterFooter").addContentLeft(oControl);
	},
	/**
	 *@description Adds content to Master Footer alignment: Right
	 *@param oControl
	 */
	addMasterFooterContentRight : function(oControl) {
		if (this.getView().byId("masterFooter").getContentRight().length === 0) {
			this.getView().byId("masterFooter").insertContentRight(oControl);
		} else {
			this.addMasterFooterContent(oControl);
		}
	},
	/**
	 *@description Adds content to Master Footer alignment: Right
	 *@param oControl
	 */
	addMasterFooterContent : function(oControl) {
		var self = this;
		if (this.oActionListPopover === undefined) {
			this.oActionListPopover = new sap.m.Popover({
				showHeader : false,
				placement : sap.m.PlacementType.Top
			});
		}
		
		if(typeof oControl.getWidth === "function"){
			oControl.setWidth("100%");
		}
		if (this.footerContentButton === undefined) {
			this.getView().byId("masterFooter").getContentRight()[0].setWidth("71%"); //Max character length 14 for first content in this case
			this.footerContentButton = new sap.m.Button({
				text : '...',
				press : function(oEvent) {
					self.oActionListPopover.openBy(oEvent.getSource());
				},
				lite : true,
				type : "Transparent"
			});
		}
		this.oActionListPopover.addContent(oControl);
		this.getView().byId("masterFooter").insertContentRight(this.footerContentButton, 1);
	},
	/**
	 *@description Adds content to Detail Footer alignment: Left
	 *@param oContol
	 */
	addDetailFooterContentLeft : function(oControl) {
		this.getView().byId("detailFooter").addContentLeft(oControl);
	},
	/**
	 *@description Adds facetfilter to the layout view
	 *@param facetFilter {object} - UI5 control
	 */
	addFacetFilter : function(facetFilter) {
		this.getView().byId("subHeader").addItem(facetFilter);
	},
	/**
	 *@description Adds the "Open In..." button to the footer and makes call for the popover
	 */
	addOpenInButton : function(){
	//call to view for NavigationTarget Action list
		var self = this;
		if(self.oNavListPopover === undefined) {
			this.oNavListPopover = new sap.m.Popover({
				showHeader : false,
				placement : sap.m.PlacementType.Top
				
			});
		}
		//creates the button and appends it to the footer content
		this.openInBtn = new sap.m.Button({
			text : this.oCoreApi.getTextNotHtmlEncoded("openIn"),
			type : "Transparent",
			press : function(oEvent) {
				//call to view for NavigationTarget Action list	only on press of openIn button
				self.oNavTargetsView = sap.ui.view({
					viewName : "sap.apf.ui.reuse.view.navigationTarget",
					type : sap.ui.core.mvc.ViewType.JS,
					viewData : {
						oNavigationHandler : self.oNavigationHandler,
						oNavListPopover : self.oNavListPopover,//Required by navigationTarget.view in order to add the action list content to the pop over
						oOpenInButtonEventSource : oEvent.getSource(),//Required by navigationTarget.view in order to open the pop over after content is added
						oUiApi : self.oUiApi//Required by navigationTarget.view in order to set busy indicator
					}
				});
			}
		});
		if(this.oNavigationHandler.getNavigationTargets().length === 0){//Disable open in button when there are no navigation targets
			this.openInBtn.setEnabled(false);
		}
		this.getView().byId("detailFooter").insertContentRight(this.openInBtn, 1);
	}
	
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 **@class messageHandler
 **@name messageHandler 
 **@memberOf sap.apf.ui.reuse.controller
 **@description controller for view.messageHandler
 * 
 */
sap.ui.controller("sap.apf.ui.reuse.controller.messageHandler", {
	/**
	 **@this {sap.apf.ui.reuse.controller.messageHandler}
	 */
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
	},
	/**
	 **@memberOf sap.apf.ui.reuse.controller.messageHandler
	 **@method showMessage
	 **@param {string} sText Message text
	 **@param {string} severity Message severity
	 **@description  error messages to be shown on notification bar
	 */
	showMessage : function(oMessageObject) {
		var sText = oMessageObject.getMessage();
		var sCode = oMessageObject.getCode();
		var severity = oMessageObject.getSeverity();
		var dateTime = oMessageObject.getTimestampAsdateObject();
		var oMessage = new sap.ui.core.Message({
			text : sText,
			timestamp : dateTime
		});
		var fatal = sap.apf.core.constants.message.severity.fatal;
		var warning = sap.apf.core.constants.message.severity.warning;
		var technError = sap.apf.core.constants.message.severity.technError;
		var error = sap.apf.core.constants.message.severity.error;
		var self = this;
		switch (severity) {
			case fatal:
				oMessage.setLevel(sap.ui.core.MessageType.Error);
				this.oUiApi.getLayoutView().setBusy(false);
				self.showDialog(sText, sCode);
				break;
			case warning:
				oMessage.setLevel(sap.ui.core.MessageType.Warning);
				break;
			case error:
				this.oUiApi.getLayoutView().setBusy(false);
				oMessage.setLevel(sap.ui.core.MessageType.Error);
				break;
			case technError:
				/**Technical Error being logged already from core messageHandler.js */
//				var techText = this.oCoreApi.getTextNotHtmlEncoded("technical-error");
//				var oURLParameters = jQuery.sap.getUriParameters().mParams;
//				var debugMode = oURLParameters["sap-ui-debug"] || [ jQuery.sap.debug().toString() ];
//				if (debugMode !== undefined && debugMode[0] === "true") {
//					jQuery.sap.log.error(techText + sText);
//					jQuery.sap.log.error(oMessageObject.getStack());
//				}
				break;
			default:
				jQuery.sap.log.error("Error type not defined");
				break;
		}
		if (severity === fatal || severity === warning || severity === error) {
			jQuery.sap.require("sap.m.MessageToast");
			sap.m.MessageToast.show(oMessage.getText(), {
				duration : 3000,
				width : "40%",
				my : "center bottom",
				at : "center bottom",
				of : window,
				offset : "0 -50",
				collision : "fit fit",
				onClose : null,
				autoClose : true,
				animationTimingFunction : "ease",
				animationDuration : 2000
			});
		}
	},
	/**
	 **@memberOf sap.apf.ui.reuse.controller.messageHandler
	 **@method showDialog
	 **@param {string} sText Message text
	 **@description  shows dialog for fatal errors
	 */
	showDialog : function(sText) {
		var self = this;
		var buttonText = this.oCoreApi.getTextNotHtmlEncoded("application-logout");
		var dialogTitle = this.oCoreApi.getTextNotHtmlEncoded("fatal-error");
		var aLogMessages = this.oCoreApi.getLogMessages();
		var sessionTimeOut = false;
		var i;
		for(i = 0; i < aLogMessages.length; i++) {
			if (aLogMessages[i].search(5021) !== -1) {
				sessionTimeOut = true;
				break;
			}
		}
		if (sessionTimeOut === true) {
			sText = this.oCoreApi.getTextNotHtmlEncoded("application-reload");
			buttonText = this.oCoreApi.getTextNotHtmlEncoded("reload-button");
			dialogTitle = this.oCoreApi.getTextNotHtmlEncoded("sessionTimeout");
		}
		var sDetailedText;
		for( i = 0; i < aLogMessages.length; i++) {
			if (sDetailedText){
				sDetailedText = sDetailedText + "\n" + aLogMessages[i];
			}
			else{
				sDetailedText = aLogMessages[i];
			}
		}
		//this uses the ushell function
		var bIsMsgBoxClosed = false;
		self.fnClose = function() {
			bIsMsgBoxClosed = true;
			if(window.location.hash){
				window.location.hash="";
			}
			
		};
		sap.ca.ui.message.showMessageBox({
			type : sap.ca.ui.message.Type.ERROR,
			message : sText,
			details : sDetailedText
			}, self.fnClose);
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 *@class navigationTarget
 *@memberOf sap.apf.ui.reuse.controller
 *@name navigationTarget
 *@description controller for view.navigationTarget
 */
sap.ui.controller("sap.apf.ui.reuse.controller.navigationTarget", {
	
	onInit : function () {
		
		this.oNavigationHandler  = this.getView().getViewData().oNavigationHandler;

	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.navigationTarget
	 *@method handleNavigation  
	 *@param selected Navigation Target 
	 *@description Launches the APF Core API for navigating externally to another application 
	 */
	handleNavigation : function(selectedNavTarget){
		
		this.oNavigationHandler.navigateToApp(selectedNavTarget);
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class pathGallery
 *@name pathGallery
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller of view.pathGallery
 */
sap.ui.controller("sap.apf.ui.reuse.controller.pathGallery", {
	/**
	 *@this {sap.apf.ui.reuse.controller.pathGallery}
	 */
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oInject.oCoreApi;
		this.oUiApi = this.getView().getViewData().oInject.uiApi;
		this.oSerializationMediator = this.getView().getViewData().oInject.oSerializationMediator;
	},

	/**
	*@memberOf sap.apf.ui.reuse.controller.pathGallery
	*@method openPathGallery
	*@description opens the path gallery with list of all saved paths
	*/
	openPathGallery : function() {
		if (this.oHierchicalPathGalleryDialog) {
			this.oHierchicalPathGalleryDialog.destroy();
		}
		this.oHierchicalPathGalleryDialog = new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.pathGallery", this);
		var oModel = new sap.ui.model.json.JSONModel();
		var jsonData = this.getPathGalleryData();
		oModel.setData(jsonData);
		this.oHierchicalPathGalleryDialog.setModel(oModel, "json");
		this.oHierchicalPathGalleryDialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.pathGallery
	*@method getPathGalleryData
	*@description Gets data for building the path gallery
	*/
	getPathGalleryData : function() {
		var self = this;
		var jsonData = this.getView().getViewData() ? this.getView().getViewData().jsonData : {};
		//Get the application Configuration data
		var fetchConfigData = function() {
			var configData = {
				"steps" : self.oCoreApi.getStepTemplates()
			};
			return configData;
		};
		//Inject Image and Title in json data
		if(jsonData.GalleryElements.length!==0){
			var savedPaths = jsonData.GalleryElements;
			var configData = fetchConfigData();
			var i, j, k, index;
			for( i = 0; i < savedPaths.length; i++) {
				for( j = 0; j < savedPaths[i].StructuredAnalysisPath.steps.length; j++) {
					for(  k = 0; k < configData.steps.length; k++) {
						var stepId = savedPaths[i].StructuredAnalysisPath.steps[j].stepId;
						var selectedRepresentationId = savedPaths[i].StructuredAnalysisPath.steps[j].selectedRepresentationId;
						if (stepId === configData.steps[k].id) {
							for(  index in configData.steps[k].getRepresentationInfo()) {
								if (selectedRepresentationId === configData.steps[k].getRepresentationInfo()[index].representationId) {
									jsonData.GalleryElements[i].StructuredAnalysisPath.steps[j].imgSrc = configData.steps[k].getRepresentationInfo()[index].picture;
									jsonData.GalleryElements[i].StructuredAnalysisPath.steps[j].title = self.oCoreApi.getTextNotHtmlEncoded(configData.steps[k].title.key);
								}
							}
						}
					}
				}
			}
		}
		return jsonData;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.pathGallery
	 *@method openPath
	 *@description opens a saved analysis path
	 *@param Takes analysis path name, guid and step which has been clicked as parameters
	 */
	openPath : function(pathName, guid, activeStepindex) {
		var self = this;
		var oMessageObject;
		var carousel = self.oUiApi.getAnalysisPath().getCarousel();
		self.oSerializationMediator.openPath(guid, (function(self) {
			return function(oResponse, oEntityTypeMetadata, msgObj) {
				if (msgObj === undefined && (typeof oResponse === "object")) {
					self.oUiApi.getAnalysisPath().getController().isOpenPath = true;
					self.oUiApi.contextChanged();
//					self.oUiApi.getLayoutView().getController().setFilter(oResponse.path.SerializedAnalysisPath.context);
					self.oUiApi.getAnalysisPath().getCarousel().oController.removeAllSteps();
					self.oUiApi.getAnalysisPath().getController().refresh(-1);
					self.oCoreApi.updatePath(self.oUiApi.getAnalysisPath().getController().callBackForUpdatePath.bind(self.oUiApi.getAnalysisPath().getController()));
					self.oUiApi.getAnalysisPath().oSavedPathName.setTitle(pathName);
					self.oUiApi.getAnalysisPath().getController().bIsDirtyState = false;
					if (self.oHierchicalPathGalleryDialog !== undefined) {
						self.oHierchicalPathGalleryDialog.close();
					}
					carousel.rerender();
					self.oUiApi.getLayoutView().setBusy(false);
				} else {
					oMessageObject = self.oCoreApi.createMessageObject({
						code : "6008",
						aParameters : [ pathName ]
					});
					oMessageObject.setPrevious(msgObj);
					self.oUiApi.getLayoutView().setBusy(false);
					self.oCoreApi.putMessage(oMessageObject);
				}
			};
		}(this)), activeStepindex);
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class step
 *@name step
 *@memberOf sap.apf.ui.reuse.controller
 *@description handle actions possible over step (example: drag and drop , delete, set Active etc)
 *             
 */
sap.ui.controller("sap.apf.ui.reuse.controller.step", {
	/**
	 *@memberOf sap.apf.ui.reuse.controller.step
	 *@method setActiveStep
	 *@param {number} index  of step to be set as active
	 *@description set step as active with given index
	 */
	setActiveStep : function(sIndex) {
		var oldActiveStep = this.oCoreApi.getActiveStep();
		var oldActiveStepIndex = this.oCoreApi.getSteps().indexOf(oldActiveStep);
		if (oldActiveStepIndex === sIndex) {
			return;
		}
		var activeStep = this.oCoreApi.getSteps()[sIndex];
		this.oCoreApi.setActiveStep(activeStep);
		this.oUiApi.getAnalysisPath().getController().drawMainChart();
		var stepView = this.oUiApi.getAnalysisPath().getCarousel().stepViews[sIndex];
		stepView.toggleActiveStep();
	},
	bindEvts : function() {
		var self = this;
		var oCarousel = this.oUiApi.getAnalysisPath().getCarousel();
		var stepLayout = this.getView().oVChartTiltleLayout;
		stepLayout.attachBrowserEvent('click', function() {
			var stepIndex = oCarousel.stepViews.indexOf(self.getView());
			self.setActiveStep(stepIndex);
		});
	},
	onAfterRendering : function() {
		this.bindEvts();
	},
	/*getActiveStepIndex : function() {
		var oCarousel = this.oUiApi.getAnalysisPath().getCarousel().getController();
		return oCarousel.getActiveStepIndex();
	},*///Deprecated
	/**
	 *@memberOf sap.apf.ui.reuse.controller.step
	 *@method showLoading
	 *@description show busy indicator
	 */
	/*showLoading : function() {
		var oView = this.getView();
		oView.oThumbnailChartLayout.removeAllContent();
		oView.oThumbnailChartLayout.setBusy(true);
		oView.bRefreshing = true;
	},*///Deprecated
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
		this.isSwitched = false;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.step
	 *@method  showChart
	 *@param {boolean} bDrawThumbnail boolean to decide whether to redraw the thumbnail in case of any changes
	 *@description display thumbnail for the step
	 */
	drawThumbnailContent : function(bDrawThumbnail) {
		var oView = this.getView();
		var sIndex = this.oUiApi.getAnalysisPath().getCarousel().stepViews.indexOf(oView);
		if (this.representationInstance !== undefined) {
			if (this.representationInstance !== this.oCoreApi.getSteps()[sIndex].getSelectedRepresentation().type) {
				this.isSwitched = true;
			}
		}
		this.representationInstance = this.oCoreApi.getSteps()[sIndex].getSelectedRepresentation().type;
		if (this.oCoreApi.getSteps()[sIndex].getSelectedRepresentation().toggleInstance !== undefined) {
			this.bToggleInstanceExists = true;
		}
		if (this.isSwitched === true || bDrawThumbnail === undefined || bDrawThumbnail === true || this.bToggleInstanceExists === true) {
			this.isSwitched = false;
			oView.oThumbnailChartLayout.removeAllItems();
			var oStep = this.oCoreApi.getSteps()[sIndex];
			var oChart;
			if (oStep.getSelectedRepresentation().bIsAlternateView) {
				if (oStep.getSelectedRepresentation().toggleInstance !== undefined) {
					var data = oStep.getSelectedRepresentation().getData();
					var metadata = oStep.getSelectedRepresentation().getMetaData();
					oStep.getSelectedRepresentation().toggleInstance.setData(data, metadata);
					oChart = oStep.getSelectedRepresentation().toggleInstance.getThumbnailContent();
				} else {
					oStep.getSelectedRepresentation().toggleInstance = this.oUiApi.getStepContainer().getController().createAlternateRepresentation(sIndex);
					oChart = oStep.getSelectedRepresentation().toggleInstance.getThumbnailContent();
				}
			} else {
				oChart = oStep.getSelectedRepresentation().getThumbnailContent();
			}
			var overLayThumbnailWrapper = new sap.m.VBox({}).addStyleClass("overlayThumbnailWrapper");
			oView.oThumbnailChartLayout.addItem(oChart);
			oView.oThumbnailChartLayout.addItem(overLayThumbnailWrapper);
			var oCarouselController = this.oUiApi.getAnalysisPath().getCarousel().getController();
			var oThumbnailDataset = oCarouselController.getThumbnailDataset(oStep);
			oView.getModel().getData().thumbnail = oThumbnailDataset;
			oView.getModel().updateBindings();
			oView.oThumbnailChartLayout.rerender();
			oView.oThumbnailChartLayout.setBusy(false);
		} else {
			oView.oThumbnailChartLayout.setBusy(false);
		}
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class stepContainer
 *@name  stepContainer
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller of view.stepContainer
 */
sap.ui.controller("sap.apf.ui.reuse.controller.stepContainer", {
	/**
	 *@this {sap.apf.ui.reuse.controller.stepContainer}
	 */
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method drawSelectionContainer
	 *@description returns the selection label and count
	 */
	drawSelectionContainer : function() {
		this.getView().getStepToolbar().getController().showSelectionCount();
	},
	resizeContent : function() {
		if (this.oCoreApi.getActiveStep()) { //If Active Step Exists
			//Set Scroll Position to first Visible Row for table representation
			if (this.oCoreApi.getActiveStep().getSelectedRepresentation().type === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
				//var representation = this.oCoreApi.getActiveStep().getSelectedRepresentation();
				this.drawStepContent();
				var scrollContainerHeight = ((window.innerHeight - jQuery('.tableWithoutHeaders').offset().top) - 20) + "px";
				jQuery('.tableWithoutHeaders').css({
					"height" : scrollContainerHeight
				});
			} else {
				this.drawStepContent();
			}
		}
	},
	onAfterRendering : function() {
		var self = this;
		var timeoutResize;
		jQuery(window).resize(function() {
			clearTimeout(timeoutResize);
			timeoutResize = setTimeout(function() {
				self.resizeContent();
			}, 500);
		});
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method getCurrentRepresentation
	 *@description returns the representation instance
	 */
	getCurrentRepresentation : function() {
		return this.representationInstance;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method drawRepresentation
	 *@description returns the representation, sets the title and calculates the height of representation before rendering
	 */
	drawRepresentation : function() {
		var self = this;
		var oActiveStep = this.oCoreApi.getActiveStep();
		if (oActiveStep.getSelectedRepresentation().bIsAlternateView === undefined || oActiveStep.getSelectedRepresentation().bIsAlternateView === false) {
			this.representationInstance = oActiveStep.getSelectedRepresentation();
		} else {
			this.representationInstance = oActiveStep.getSelectedRepresentation().toggleInstance;
			var data = oActiveStep.getSelectedRepresentation().getData(), metadata = oActiveStep.getSelectedRepresentation().getMetaData();
			this.representationInstance.setData(data, metadata);
		}
		var oLongTitle = oActiveStep.longTitle && !this.oCoreApi.isInitialTextKey(oActiveStep.longTitle.key) ? oActiveStep.longTitle : undefined;
		var oTitle = oLongTitle || oActiveStep.title;
		var oStepTitle = this.oCoreApi.getTextNotHtmlEncoded(oTitle);
//		var stepTitle = new sap.m.Label({
//			text : oStepTitle,
//			design : "Bold"
//		}).addStyleClass("sapApfDetailTitle");
		var content = this.representationInstance.getMainContent(oStepTitle);
		var chartToolbarID = this.getView().getStepToolbar().chartToolbar.getId();
		this.setHeightAndWidth = function() {
			var toolbarHeight;
			var toolbarWidth;
			if (jQuery("#" + chartToolbarID).length !== 0) {
				toolbarHeight = jQuery("#" + chartToolbarID + " > div:first-child > div:nth-child(2)").offset().top;
				toolbarWidth = jQuery("#" + chartToolbarID + " > div:first-child > div:nth-child(2)").width();
			} else {
				toolbarHeight = "0";
				toolbarWidth = jQuery(window).width();
			}
			var cHeight = self.getView().getStepToolbar().chartToolbar.getFullScreen() ? (jQuery(window).height() - toolbarHeight) : (jQuery(window).height() - toolbarHeight) - jQuery(".applicationFooter").height();
			var cWidth = toolbarWidth;
			if (self.oCoreApi.getActiveStep().getSelectedRepresentation().bIsAlternateView || self.oCoreApi.getActiveStep().getSelectedRepresentation().type === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
				content.getContent()[0].setHeight((cHeight - 5) + "px");
				content.getContent()[0].setWidth(cWidth + "px");
			} else if (self.oCoreApi.getActiveStep().getSelectedRepresentation().type === sap.apf.ui.utils.CONSTANTS.representationTypes.GEO_MAP) {
				var div = (jQuery(content.getContent())[0]);
				div.style.height = cHeight + "px";
				div.style.width = cWidth + "px";
				content.setContent(div.outerHTML);
			} else {
				content.setHeight(cHeight + "px");
				content.setWidth(cWidth + "px");
			}
		};
		//Undefined methods Viz Charts 		
		content.getIcon = function() {
			return;
		};
		content.getLabel = function() {
			return;
		};
		content.addEventDelegate({
			onBeforeRendering : function() {
				self.setHeightAndWidth();
			}
		});
		//this.getView().getRepresentationContainer().getController().drawRepresentation(content);
		this.getView().getStepToolbar().getController().drawRepresentation(content);
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method createAlternateRepresentation
	 *@description creates the alternate representation from chart and returns the main content
	 */
	createAlternateRepresentation : function(sIndex) {
		var self = this;
		var addAdditionalFields = function(param) {
			var dimensions = param.dimensions;
			var metadata = self.oCoreApi.getSteps()[sIndex].getSelectedRepresentation().getMetaData();
			if (metadata === undefined) {
				return param;
			}
			var i;
			for(  i = 0; i < dimensions.length; i++) {
				var bSapTextExists = metadata.getPropertyMetadata(dimensions[i].fieldName).hasOwnProperty('text');
				if (bSapTextExists) {
					var newField = {};
					newField.fieldName = metadata.getPropertyMetadata(dimensions[i].fieldName).text;
					param.dimensions.push(newField);
				}
			}
			param.isAlternateRepresentation = true;
			return param;
		};

		var oActiveStep = self.oCoreApi.getSteps()[sIndex];
		var currentRepresentation = oActiveStep.getSelectedRepresentation();
		var parameter = jQuery.extend(true, {}, currentRepresentation.getParameter());
		delete parameter.alternateRepresentationTypeId;
		delete parameter.alternateRepresentationType;
		parameter = addAdditionalFields(parameter);
		
		// Using the APF Core method to create alternate representation instance
		this.newToggleInstance = this.oCoreApi.createRepresentation(currentRepresentation.getParameter().alternateRepresentationType.constructor, parameter);
		
		var data = currentRepresentation.getData();
		var metadata = currentRepresentation.getMetaData();
		if (data !== undefined && metadata !== undefined) { //Done in order to match the setData invocation through APFCore in case of switch representation
			this.newToggleInstance.setData(data, metadata);
		}
		this.newToggleInstance.adoptSelection(currentRepresentation);
		return this.newToggleInstance;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method isActiveStepChanged
	 *@description Decides whether the active Step is drawn on the main content or not.
	 */
	isActiveStepChanged : function() {
		var bActiveStepChange;
		if (this.currentActiveStepIndex === undefined) {
			this.currentActiveStepIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
			bActiveStepChange = true;
		} else if (this.currentActiveStepIndex !== this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep())) {
			this.currentActiveStepIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
			bActiveStepChange = true;
		} else {
			bActiveStepChange = false;
		}
		return bActiveStepChange;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method isSelectedRepresentationChanged
	 *@description Decides whether the active Step's selected representation has changed or not.
	 */
	isSelectedRepresentationChanged : function() {
		var bSelectedRepresentationChange;
		if (this.currentSelectedRepresentationId === undefined) {
			this.currentSelectedRepresentationId = this.oCoreApi.getActiveStep().getSelectedRepresentationInfo().representationId;
			bSelectedRepresentationChange = true;
		} else if (this.currentSelectedRepresentationId !== this.oCoreApi.getActiveStep().getSelectedRepresentationInfo().representationId) {
			this.currentSelectedRepresentationId = this.oCoreApi.getActiveStep().getSelectedRepresentationInfo().representationId;
			bSelectedRepresentationChange = true;
		} else if (this.getCurrentRepresentation().type !== this.oCoreApi.getActiveStep().getSelectedRepresentation().type) {
			this.currentSelectedRepresentationId = this.oCoreApi.getActiveStep().getSelectedRepresentationInfo().representationId;
			bSelectedRepresentationChange = true;
		} else {
			bSelectedRepresentationChange = false;
		}
		return bSelectedRepresentationChange;
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepContainer
	 *@method drawStepContent
	 *@description Draws the main content of the chart
	 */
	drawStepContent : function(bDrawRepresentation) {
		var nActiveStepIndex = this.oCoreApi.getSteps().indexOf(this.oCoreApi.getActiveStep());
		var bThumbnailRefreshing = this.oUiApi.getAnalysisPath().getCarousel().getStepView(nActiveStepIndex).oThumbnailChartLayout.isBusy();
		var isOpenPath = this.oUiApi.getAnalysisPath().getController().isOpenPath;
		var isNewPath = this.oUiApi.getAnalysisPath().getController().isNewPath;
		if (bThumbnailRefreshing) {
			this.getView().vLayout.setBusy(true);
			return;
		}
		var bActiveStepChange = this.isActiveStepChanged();
		var bSelectedRepresentationChange = this.isSelectedRepresentationChanged();
		var bRedrawRepresentation = (bDrawRepresentation === undefined || bDrawRepresentation === true);
		if (bRedrawRepresentation || bActiveStepChange || bSelectedRepresentationChange || isOpenPath || isNewPath) {
			this.drawRepresentation();
		} else {
			if (this.oCoreApi.getSteps().length >= 1) {
				this.drawSelectionContainer();
			}
		}
		if (this.getView().vLayout.isBusy()) {
			this.getView().vLayout.removeAllContent();
			this.getView().vLayout.addContent(this.getView().stepLayout);
			this.getView().vLayout.setBusy(false);
		}
		this.getView().vLayout.setBusy(false);
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
*@class toolbar
*@name toolbar
*@memberOf sap.apf.ui.reuse.controller
*@description controller for view.toolbar
*/
/* globals window, setTimeout, input */
sap.ui.controller("sap.apf.ui.reuse.controller.toolbar", {
	/**
	*@this {sap.apf.ui.reuse.controller.toolbar}
	*/
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method resetAnalysisPath
	*@description Refresh carousel on new Analysis path 
	 */
	resetAnalysisPath : function() {
		this.oCoreApi.resetPath();
		this.oUiApi.getAnalysisPath().getController().isNewPath = true;
		this.oPathContextHandler.restoreInitialContext();
		this.oUiApi.contextChanged(true);
//		this.oUiApi.getLayoutView().getController().setFilter();
		this.oUiApi.getAnalysisPath().getCarousel().getController().removeAllSteps();
		this.oUiApi.getAnalysisPath().getController().refreshAnalysisPath();
		this.oUiApi.getAnalysisPath().oSavedPathName.setTitle(this.oCoreApi.getTextNotHtmlEncoded("unsaved"));
		this.oUiApi.getAnalysisPath().getController().bIsDirtyState = false;
		this.oUiApi.getAnalysisPath().getCarousel().rerender();
	},
	onInit : function() {
		this.view = this.getView();
		this.oViewData = this.getView().getViewData();
		this.oCoreApi = this.oViewData.oCoreApi;
		this.oSerializationMediator = this.oViewData.oSerializationMediator;
		this.oUiApi = this.oViewData.uiApi;
		this.oPathContextHandler = this.oViewData.oPathContextHandler;
		this.oPrintHelper = new sap.apf.ui.utils.PrintHelper(this.oViewData);
		this.bIsPathGalleryWithDelete = false;
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method open dialog for showing saved paths with delete mode
	*@description Opens an overlay which holds saved analysis Paths
	*@see sap.apf.ui.view.deleteAnalysisPath
	*/
	openPathGalleryWithDelete : function() {
		var jsonData = {};
		var self = this;
		var oMessageObject;
		var i;
		self.oCoreApi.readPaths(function(data, metaData, msgObj) {
			if (msgObj === undefined && (typeof data === "object")) {
				var galleryData = data.paths;
				for(i = 0; i<galleryData.length; i++) {
					var noOfSteps = galleryData[i].StructuredAnalysisPath.steps.length;
					var utcDate = galleryData[i].LastChangeUTCDateTime;
					var numberPattern = /\d+/g;
					var timeStamp = parseInt(utcDate.match(numberPattern)[0], 10);
					var date = ((new Date(timeStamp)).toString()).split(' ');
					var dateToShow = date[1] + "-" + date[2] + "-" + date[3];
					galleryData[i].guid = galleryData[i].AnalysisPath;
					galleryData[i].StructuredAnalysisPath.noOfSteps = noOfSteps;
					galleryData[i].description = dateToShow + "  -   (" + self.oCoreApi.getTextNotHtmlEncoded("no-of-steps", [ noOfSteps ]) + ")";
					galleryData[i].summary = galleryData[i].AnalysisPathName + "- (" + dateToShow + ") - (" + self.oCoreApi.getTextNotHtmlEncoded("no-of-steps", [ noOfSteps ]) + ")";
				}
				jsonData = {
					GalleryElements : galleryData
				};
				self.deleteAnalysisPath = new sap.ui.view({
					type : sap.ui.core.mvc.ViewType.JS,
					viewName : "sap.apf.ui.reuse.view.deleteAnalysisPath",
					viewData : {
						jsonData : jsonData,
						oInject : self.oViewData
					}
				});
				self.deleteAnalysisPath.getController().openPathGalleryWithDelete();
				self.oUiApi.getLayoutView().setBusy(false);
			} else {
				oMessageObject = self.oCoreApi.createMessageObject({
					code : "6005",
					aParameters : []
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
				self.oUiApi.getLayoutView().setBusy(false);
			}
		});
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method open dialog for showing saved paths
	*@description Opens an overlay which holds saved analysis Paths
	*@see sap.apf.ui.view.pathGallery
	*/
	openPathGallery : function() {
		var jsonData = {};
		var self = this;
		var i, oMessageObject;
		self.oCoreApi.readPaths(function(data, metaData, msgObj) {
			if (msgObj === undefined && (typeof data === "object")) {
				var galleryData = data.paths;
				for(i =0 ; i<galleryData.length ; i++) {
					var noOfSteps = galleryData[i].StructuredAnalysisPath.steps.length;
					var utcDate = galleryData[i].LastChangeUTCDateTime;
					var numberPattern = /\d+/g;
					var timeStamp = parseInt(utcDate.match(numberPattern)[0], 10);
					var date = ((new Date(timeStamp)).toString()).split(' ');
					var dateToShow = date[1] + "-" + date[2] + "-" + date[3];
					galleryData[i].guid = galleryData[i].AnalysisPath;
					galleryData[i].StructuredAnalysisPath.noOfSteps = noOfSteps;
					galleryData[i].description = dateToShow + "  -   (" + self.oCoreApi.getTextNotHtmlEncoded("no-of-steps", [ noOfSteps ]) + ")";
					galleryData[i].summary = galleryData[i].AnalysisPathName + "- (" + dateToShow + ") - (" + self.oCoreApi.getTextNotHtmlEncoded("no-of-steps", [ noOfSteps ]) + ")";
				}
				jsonData = {
					GalleryElements : galleryData
				};
				self.pathGallery = new sap.ui.view({
					type : sap.ui.core.mvc.ViewType.JS,
					viewName : "sap.apf.ui.reuse.view.pathGallery",
					viewData : {
						jsonData : jsonData,
						oInject : self.oViewData
					}
				});
				self.pathGallery.getController().openPathGallery();
				self.oUiApi.getLayoutView().setBusy(false);
			} else {
				oMessageObject = self.oCoreApi.createMessageObject({
					code : "6005",
					aParameters : []
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
				self.oUiApi.getLayoutView().setBusy(false);
			}
		});
	},
	doPrint : function() {
		var oPrint = this.oPrintHelper;
		oPrint.doPrint();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getSaveDialog
	*@description Getter for save dialog. Opens a new dialog for saving analysis Path
	*@param {object} reset callback for save 
	 */
	getSaveDialog : function(bSaveAs, reset, aPath) {
		var self = this;
		var hintText = this.oCoreApi.getTextNotHtmlEncoded("saveName");
		var savedAPNameExist = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		var oModelPath = new sap.ui.model.json.JSONModel();
		oModelPath.setData(aPath);
		if (savedAPNameExist) {
			var firstChar = savedAPNameExist.charAt(0);
			if (firstChar === "*"){
				savedAPNameExist = savedAPNameExist.split('*')[1];
			}
		}
		this.oInput = new sap.m.Input({
			type : sap.m.InputType.Text,
			placeholder : hintText,
			showSuggestion : true,
			suggestionItems : {
				path : "/",
				template : new sap.ui.core.Item({
					text : "{AnalysisPathName}",
					additionalText : "{AnalysisPath}"
				}),
				showValueHelp : true,
				valueHelpRequest : function(evt) {
					var handleClose = function(evt) {
						var oSelectedItem = evt.getParameter("selectedItem");
						if (oSelectedItem) {
							input.setValue(oSelectedItem.getTitle());
						}
						evt.getSource().getBinding("items").filter([]);
					};
				}
			}
		}).addStyleClass("saveStyle");
		this.oInput.setModel(oModelPath);
		//destroy the input assisted items
		if (!bSaveAs) {
			this.oInput.destroySuggestionItems();
		}
		this.oInput.attachEvent("click", function(oEvent) {
			jQuery(oEvent.currentTarget).attr('value', '');
		});
		//Save input field validation
		this.oInput.attachLiveChange(function(data) {
			var val = this.getValue();
			var dialog = self.saveDialog;
			var regEx = new RegExp("[*]", "g");
			if (val === "") {
				dialog.getBeginButton().setEnabled(false);
			}
			if ((val.match(regEx) !== null)) {
				dialog.getBeginButton().setEnabled(false);
				dialog.setSubHeader(new sap.m.Bar({
					contentMiddle : new sap.m.Text({
						text : this.oCoreApi.getTextNotHtmlEncoded('invalid-entry')
					})
				}));
				this.setValueState(sap.ui.core.ValueState.Error);
				return false;
			} else {
				dialog.getBeginButton().setEnabled(true);
				dialog.destroySubHeader();
				this.setValueState(sap.ui.core.ValueState.None);
			}
			if (val.trim() !== "") {
				dialog.getBeginButton().setEnabled(true);
				dialog.destroySubHeader();
			} else {
				dialog.getBeginButton().setEnabled(false);
				dialog.setSubHeader(new sap.m.Bar({
					contentMiddle : new sap.m.Text({
						text : self.oCoreApi.getTextNotHtmlEncoded('enter-valid-path-name')
					})
				}));
			}
		});
		//setting existing path name in input field
		if (savedAPNameExist !== (self.oCoreApi.getTextNotHtmlEncoded("unsaved"))) {
			this.oInput.setValue(savedAPNameExist);
		} else {
			//this.oInput.setValue(hintText);
		}
		this.analysisPathName = (self.oInput.getValue()).trim();
		this.saveDialog = new sap.m.Dialog({
			type : sap.m.DialogType.Standard,
			title : self.oCoreApi.getTextNotHtmlEncoded("save-analysis-path"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("ok"),
				enabled : false,
				press : function() {
					self.saveDialog.getBeginButton().setEnabled(false);
					self.saveDialog.getEndButton().setEnabled(false);
					var analysisPathName = (self.oInput.getValue()).trim();
					self.saveAnalysisPath(analysisPathName, reset, bSaveAs);
					this.destroy();
				}
			}),
			endButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("cancel"),
				press : function() {
					self.saveDialog.close();
					this.destroy();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
			}
		});
		this.saveDialog.addContent(this.oInput);
		// conditional opening of save dialog(save/saveAs)
		if (this.oInput.getValue() === savedAPNameExist) {
			this.saveDialog.getBeginButton().setEnabled(true);
		}
		//open only if steps are present in the path
		if (self.oCoreApi.getSteps().length >= 1) {
			if (!bSaveAs && savedAPNameExist === (self.oCoreApi.getTextNotHtmlEncoded("unsaved"))) {
				this.saveDialog.open();
			} else if (bSaveAs) {
				this.saveDialog.open();
			} else {
				self.saveAnalysisPath(savedAPNameExist, reset, bSaveAs);
			}
		}
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method doOkOnNewAnalysisPath
	*@description Executes operations on click of "Ok" button of New Analysis Path dialog
	*/
	doOkOnNewAnalysisPath : function() {
		var self = this;
		this.isOpen = false;
		self.oCoreApi.readPaths(function(respObj, metaData, msgObj) {
			var bSaveAs = true;
			var paths = respObj.paths;
			if (metaData !== undefined) {
				self.getView().maxNumberOfSteps = metaData.getEntityTypeMetadata().maximumNumberOfSteps;
				self.getView().maxNumberOfPaths = metaData.getEntityTypeMetadata().maxOccurs;
			}
			if (msgObj === undefined && (typeof respObj === "object")) {
				self.getSaveDialog(bSaveAs, function() {
					self.resetAnalysisPath();
					//					sap.apf.ui.createApplicationLayout();
				}, paths);
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "6005",
					aParameters : []
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method doOkOnOpenAnalysisPath
	*@description Executes operations on click of "Ok" btton of Open Analysis Path dialog
	*/
	doOkOnOpenAnalysisPath : function(bIsPathGalleryWithDelete) {
		var self = this;
		this.isOpen = true;
		this.bIsPathGalleryWithDelete = bIsPathGalleryWithDelete;
		self.oCoreApi.readPaths(function(respObj, metaData, msgObj) {
			var bSaveAs = true;
			var paths = respObj.paths;
			if (metaData !== undefined) {
				self.getView().maxNumberOfSteps = metaData.getEntityTypeMetadata().maximumNumberOfSteps;
				self.getView().maxNumberOfPaths = metaData.getEntityTypeMetadata().maxOccurs;
			}
			if (msgObj === undefined && (typeof respObj === "object")) {
				self.getSaveDialog(bSaveAs, function() {
				}, paths);
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "6005",
					aParameters : []
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getNewAnalysisPathDialog
	*@description Getter for New Analysis Path dialog 
	 */
	getNewAnalysisPathDialog : function() {
		var self = this;
		if (self.oUiApi.getAnalysisPath().oSavedPathName.getTitle().slice(0, 1) === "*" && self.oCoreApi.getSteps().length !== 0) {
			var newDialog = new sap.m.Dialog({
				type : sap.m.DialogType.Standard,
				title : self.oCoreApi.getTextNotHtmlEncoded("newPath"),
				content : new sap.m.Text({
					text : self.oCoreApi.getTextNotHtmlEncoded("analysis-path-not-saved")
				}).addStyleClass("textStyle"),
				beginButton : new sap.m.Button({
					text : self.oCoreApi.getTextNotHtmlEncoded("yes"),
					press : function() {
						self.doOkOnNewAnalysisPath();
						newDialog.close();
					}
				}),
				endButton : new sap.m.Button({
					text : self.oCoreApi.getTextNotHtmlEncoded("no"),
					press : function() {
						self.resetAnalysisPath();
						newDialog.close();
					}
				}),
				afterClose : function() {
					self.oUiApi.getLayoutView().setBusy(false);
					this.destroy();
				}
			});
			newDialog.open();
		} else {
			this.resetAnalysisPath();
		}
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getOpenDialog
	*@description Getter for New Analysis Path dialog
	*/
	getOpenDialog : function(bIsPathGalleryWithDelete) {
		var self = this;
		var dialog = new sap.m.Dialog({
			type : sap.m.DialogType.Standard,
			title : self.oCoreApi.getTextNotHtmlEncoded("newPath"),
			content : new sap.m.Text({
				text : self.oCoreApi.getTextNotHtmlEncoded("analysis-path-not-saved")
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("yes"),
				press : function() {
					self.doOkOnOpenAnalysisPath(self.bIsPathGalleryWithDelete);
					dialog.close();
				}
			}),
			endButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("no"),
				press : function() {
					dialog.close();
					self.resetAnalysisPath();
					if (self.bIsPathGalleryWithDelete) {
						self.openPathGalleryWithDelete();
					} else {
						self.openPathGallery();
					}
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getConfirmDelDialog
	*@description confirm dialog before deleting path
	*@param {object} sectionDom Returns to DOM object on which the delete is called 
	 */
	getConfirmDelDialog : function(oListInfo) {
		var self = this;
		var pathName = oListInfo.sPathName;
		var dialog = new sap.m.Dialog({
			type : sap.m.DialogType.Standard,
			title : self.oCoreApi.getTextNotHtmlEncoded("delPath"),
			content : new sap.m.Text({
				text : self.oCoreApi.getTextNotHtmlEncoded("do-you-want-to-delete-analysis-path") + " '" + pathName + "'?"
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("yes"),
				press : function() {
					self.oUiApi.getAnalysisPath().getPathGalleryWithDeleteMode().getController().deleteSavedPath(pathName, oListInfo);
					dialog.close();
				}
			}),
			endButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("no"),
				press : function() {
					dialog.close();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getConfirmDelDialog
	*@description confirm dialog before overwriting path
	*/
	getConfirmDialog : function(oParam) {
		var self = this;
		var opt = oParam || {};
		var options = {
			success : opt.success || function() {
			},
			fail : opt.fail || function() {
			},
			msg : opt.msg || ""
		};
		var dialog = new sap.m.Dialog({
			title : self.oCoreApi.getTextNotHtmlEncoded("caution"),
			type : sap.m.DialogType.Standard,
			content : new sap.m.Text({
				text : options.msg
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("yes"),
				press : function() {
					//fnCallback = options.success();
					self.overWriteAnalysisPath();
					dialog.close();
				}
			}),
			endButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("no"),
				press : function() {
					var bSaveAs = true;
					var aData = self.oInput.getModel().getData();
					//fnCallback = options.success()
					self.getSaveDialog(bSaveAs, function() {
					}, aData);
					dialog.close();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getConfirmLogOffDialog
	*@description confirm dialog before logging out  
	*/
	getConfirmLogOffDialog : function() {
		var self = this;
		var dialog = new sap.m.Dialog({
			title : self.oCoreApi.getTextNotHtmlEncoded("confirmation"),
			type : sap.m.DialogType.Standard,
			content : new sap.m.Text({
				text : self.oCoreApi.getTextNotHtmlEncoded("do-you-want-to-logout")
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("yes"),
				press : function() {
					self.oCoreApi.logoutHanaXse();
					dialog.close();
				}
			}),
			endButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("no"),
				press : function() {
					dialog.close();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method getErrorMessageDialog
	*@description Getter for save dialog. Opens a new dialog for saving analysis Path
	*@param {string} errorText Text to be shown in case of an error
	*/
	getErrorMessageDialog : function(msg) {
		var self = this;
		var dialog = new sap.m.Dialog({
			title : self.oCoreApi.getTextNotHtmlEncoded("error"),
			type : sap.m.DialogType.Message,
			content : new sap.m.Text({
				text : msg
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("ok"),
				press : function() {
					var fncallback = function() {
					};
					if (fncallback) {
						setTimeout(function() {
							self.callbackforSave(fncallback);
						}, 200);
					}
					dialog.close();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	},
	callbackforSave : function(fncallback) {
		fncallback();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method onOpenAnalysisPath
	*@description On click event of open button in Menu Popover
	*/
	onOpenPathGallery : function() {
		this.bIsPathGalleryWithDelete = false;
		var pathName = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		var firstChar = pathName.charAt(0);
		if (firstChar === "*" && this.oCoreApi.getSteps().length !== 0) {
			this.getOpenDialog(this.bIsPathGalleryWithDelete);
		} else {
			this.openPathGallery();
		}
		this.isOpen = false;
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.toolbar
	*@method onOpenPathGalleryWithDelete
	*@description On click event of Delete button in  Menu PopOver
	*/
	onOpenPathGalleryWithDelete : function() {
		this.bIsPathGalleryWithDelete = true;
		var pathName = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		var firstChar = pathName.charAt(0);
		if (firstChar === "*" && this.oCoreApi.getSteps().length !== 0) {
			this.getOpenDialog(this.bIsPathGalleryWithDelete);
		} else {
			this.openPathGalleryWithDelete();
		}
		this.isOpen = false;
	},
	saveAnalysisPath : function(analysisPathName, fncallback, bSaveAs) {
		var self = this;
		this.saveCallback = fncallback;
		this.analysisPathName = analysisPathName; //Encodes the special characters
		this.aData = self.oInput.getModel().getData();
		var boolUpdatePath = false;
		this.guid = "";
		var steps = self.oCoreApi.getSteps();
		//Check if path or steps exceeds the limit
		if (this.aData.length > this.getView().maxNumberOfPaths) {
			this.getErrorMessageDialog(self.oCoreApi.getTextNotHtmlEncoded("no-of-paths-exceeded"));
			if (self.saveDialog && self.saveDialog.isOpen()) {
				self.saveDialog.close();
			}
			return false;
		} else if (steps.length > this.getView().maxNumberOfSteps) {
			this.getErrorMessageDialog(self.oCoreApi.getTextNotHtmlEncoded("no-of-steps-exceeded"));
			if (self.saveDialog && self.saveDialog.isOpen()) {
				self.saveDialog.close();
			}
			return false;
		}
		for( var i = 0; i < this.aData.length; i++) {
			var decodePathName = this.aData[i].AnalysisPathName;
			if (this.analysisPathName === decodePathName) {
				boolUpdatePath = true;
				this.guid = this.aData[i].AnalysisPath;
				break;
			}
		}
		if (!boolUpdatePath) {
			self.oSerializationMediator.savePath(self.analysisPathName, function(respObj, metaData, msgObj) {
				if (msgObj === undefined && (typeof respObj === "object")) {
					self.oUiApi.getAnalysisPath().oSavedPathName.setTitle(self.analysisPathName);
					self.oUiApi.getAnalysisPath().getController().bIsDirtyState = false;
					if (self.saveDialog && self.saveDialog.isOpen()) {
						self.saveDialog.close();
					}
					var message = self.oCoreApi.getTextNotHtmlEncoded("path-saved-successfully", [ "'" + self.analysisPathName + "'" ]);
					self.getSuccessToast(self.analysisPathName, message);
					if (typeof self.saveCallback === "function") {
						self.saveCallback();
					}
				} else {
					var oMessageObject = self.oCoreApi.createMessageObject({
						code : "6006",
						aParameters : [ self.analysisPathName ]
					});
					oMessageObject.setPrevious(msgObj);
					self.oCoreApi.putMessage(oMessageObject);
				}
			});
		} else {
			if (self.saveDialog && self.saveDialog.isOpen()) {
				self.saveDialog.close();
			}
			var pathName;
			if (self.oUiApi.getAnalysisPath().oSavedPathName.getTitle().charAt(0) === "*" && this.oCoreApi.getSteps().length !== 0) {
				pathName = self.oUiApi.getAnalysisPath().oSavedPathName.getTitle().slice(1, self.oUiApi.getAnalysisPath().oSavedPathName.getTitle().length);
			} else {
				pathName = self.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
			}
			if (!bSaveAs && pathName === self.analysisPathName) {
				self.overWriteAnalysisPath();
			} else {
				this.getConfirmDialog({
					msg : self.oCoreApi.getTextNotHtmlEncoded("path-exists", [ "'" + self.analysisPathName + "'" ])
				});
			}
			boolUpdatePath = false;
		}
	},
	getSuccessToast : function(pathName, message) {
		var self = this;
		var msg = message;
		sap.m.MessageToast.show(msg, {
			width : "20em"
		});
		if (self.isOpen && self.bIsPathGalleryWithDelete) {
			self.openPathGalleryWithDelete();
		} else if (self.isOpen) {
			self.openPathGallery();
		}
	},
	overWriteAnalysisPath : function() {
		var self = this;
		var pathNameVal = this.analysisPathName;
		var guidVal = this.guid;
		self.oSerializationMediator.savePath(guidVal, pathNameVal, function(oResponse, metaData, msgObj) {
			if (msgObj === undefined && (typeof oResponse === "object")) {
				self.oUiApi.getAnalysisPath().oSavedPathName.setTitle(pathNameVal);
				var message = self.oCoreApi.getTextNotHtmlEncoded("path-updated-successfully", [ "'" + pathNameVal + "'" ]);
				self.oUiApi.getAnalysisPath().getController().bIsDirtyState = false;
				if (self.saveDialog && self.saveDialog.isOpen()) {
					self.saveDialog.close();
				}
				self.getSuccessToast(pathNameVal, message);
				if (typeof self.saveCallback === "function") {
					self.saveCallback();
				}
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "6007",
					aParameters : [ pathNameVal ]
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
	},
	getDialogForNoPathAdded : function() {
		var self = this;
		var msg = self.oCoreApi.getTextNotHtmlEncoded("noStepInPath");
		var dialog = new sap.m.Dialog({
			title : self.oCoreApi.getTextNotHtmlEncoded("alert"),
			type : sap.m.DialogType.Message,
			contentWidth : jQuery(window).height() * 0.2 + "px", // height and width for the dialog relative to the window
			contentHeight : jQuery(window).height() * 0.2 + "px",
			content : new sap.m.Text({
				text : msg
			}).addStyleClass("textStyle"),
			beginButton : new sap.m.Button({
				text : self.oCoreApi.getTextNotHtmlEncoded("ok"),
				press : function() {
					dialog.close();
				}
			}),
			afterClose : function() {
				self.oUiApi.getLayoutView().setBusy(false);
				this.destroy();
			}
		});
		dialog.open();
	}
/*
*@memberOf sap.apf.ui.reuse.controller.toolbar
*@method onAfterRendering
*@description Keyboard shortcut keys for the toolbar buttons 
 */
/*onAfterRendering : function() {
	var self = this;
	var keys = [];
	var firstKeyPress;
	var secondKeyPress;
	jQuery(document).keydown(function(e) {
		if (e.keyCode === 18) {
			keys.alt = true;
			firstKeyPress = new Date();
			firstKeyPress = firstKeyPress.getTime();
		}
		if (e.keyCode === 78) {
			keys.n = true;
			secondKeyPress = new Date();
			secondKeyPress = secondKeyPress.getTime();
		}
		if (e.keyCode === 79) {
			keys.o = true;
			secondKeyPress = new Date();
			secondKeyPress = secondKeyPress.getTime();
		}
		if (e.keyCode === 83) {
			keys.s = true;
			secondKeyPress = new Date();
			secondKeyPress = secondKeyPress.getTime();
		}
		if (e.keyCode === 80) {
			keys.p = true;
			secondKeyPress = new Date();
			secondKeyPress = secondKeyPress.getTime();
		}
		if (keys.alt === true && keys.n === true) {
			if (((secondKeyPress - firstKeyPress < 1000) && (secondKeyPress - firstKeyPress > 0)) || ((secondKeyPress - firstKeyPress > -1000) && (secondKeyPress - firstKeyPress < 0))) {
				self.getNewAnalysisPathDialog(); //new analysis path
			}
		}
		if (keys.alt === true && keys.o === true) {
			if (((secondKeyPress - firstKeyPress < 1000) && (secondKeyPress - firstKeyPress > 0)) || ((secondKeyPress - firstKeyPress > -1000) && (secondKeyPress - firstKeyPress < 0))) {
				self.onOpenAnalysisPath(); //open analysis path
			}
		}
		if (keys.alt === true && keys.s === true) {
			if (((secondKeyPress - firstKeyPress < 1000) && (secondKeyPress - firstKeyPress > 0)) || ((secondKeyPress - firstKeyPress > -1000) && (secondKeyPress - firstKeyPress < 0))) {
				self.getSaveDialog(); // save analysis path
			}
		}
		if (keys.alt === true && keys.p === true) {
			if (((secondKeyPress - firstKeyPress < 1000) && (secondKeyPress - firstKeyPress > 0)) || ((secondKeyPress - firstKeyPress > -1000) && (secondKeyPress - firstKeyPress < 0))) {
				self.doPrint(); // print analysis path
			}
		}
	});
	jQuery(document).keyup(function(e) {
		if (e.keyCode === 18)
			keys.alt = false;
		if (e.keyCode === 78)
			keys.n = false;
		if (e.keyCode === 79)
			keys.o = false;
		if (e.keyCode === 83)
			keys.s = false;
		if (e.keyCode === 80)
			keys.p = false;
	});
} */
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class pathGallery
 *@name  pathGallery Fragment
 *@description Holds the saved paths and displays them in a dialog using js fragment
 *@memberOf sap.apf.ui.reuse.fragment
 * 
 */
sap.ui.jsfragment("sap.apf.ui.reuse.fragment.pathGallery", {
	createContent : function(oController) {
		this.oController = oController;
		this.contentWidth = jQuery(window).height()* 0.6+"px"; // height and width for the dialog relative to the window
		this.contentHeight = jQuery(window).height()* 0.6+"px";
		var self = this;
		this.oCoreApi = oController.oCoreApi;
		this.oUiApi = oController.oUiApi;
		this.pathGalleryHierarchicalDialog = new sap.ca.ui.HierarchicalSelectDialog({ // path gallery
			title : self.oCoreApi.getTextNotHtmlEncoded("select-analysis-path"),
			contentWidth : self.contentWidth,
			contentHeight : self.contentHeight,
			select : function(evt) {
				self.oUiApi.getLayoutView().setBusy(true);
				var eventBindingContext = evt.getParameters().selectedItem.oBindingContexts.json.sPath.split('/');
				var pathName = this.getModel("json").getData().GalleryElements[eventBindingContext[2]].AnalysisPathName;
				var analysisPath = this.getModel("json").getData().GalleryElements[eventBindingContext[2]].AnalysisPath;
				var activeStepindex = eventBindingContext[5];
				oController.openPath(pathName, analysisPath, activeStepindex);
				self.oUiApi.getLayoutView().setBusy(false);
			},
			cancel : function() {
				var oSelf = this;
				self.oUiApi.getLayoutView().setBusy(false);
				oSelf.close();
				oSelf.destroy();
			}
		});
		this.pathName = new sap.ca.ui.HierarchicalSelectDialogItem({ // Dialog Item to hold  list of paths
			title : self.oCoreApi.getTextNotHtmlEncoded("select-analysis-path"),
			entityName : "json>/GalleryElements",
			visible : true
		});
		this.pathTemplate = new sap.m.StandardListItem({
			title : '{json>AnalysisPathName}',
			description : '{json>description}',
			tooltip : '{json>AnalysisPathName}'
		});
		this.stepTitle = new sap.ca.ui.HierarchicalSelectDialogItem({ // Dialog Item to hold  list of steps
			entityName : "json>StructuredAnalysisPath/steps"
		});
		this.stepTemplate = new sap.m.StandardListItem({
			title : '{json>title}',
			icon : '{json>imgSrc}',
			tooltip : '{json>title}'
		});
		this.pathName.setListItemTemplate(this.pathTemplate); //binding list of paths,steps to the dialog item
		this.stepTitle.setListItemTemplate(this.stepTemplate);
		this.pathGalleryHierarchicalDialog.addItem(this.pathName); //Path Names list
		this.pathGalleryHierarchicalDialog.addItem(this.stepTitle);// Steps in a path*/
		return this.pathGalleryHierarchicalDialog;
	}
});
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 *@class selectionDisplay
 *@name  selectionDisplay Fragment
 *@description Holds the selections on the active step and displays them in a dialog using js fragment
 *@memberOf sap.apf.ui.reuse.view
 * 
 */
sap.ui.jsfragment("sap.apf.ui.reuse.fragment.selectionDisplay", {
	createContent : function(oController){
		this.oController = oController;
		this.contentWidth = jQuery(window).height()* 0.6+"px"; // height and width for the dialog relative to the window
		this.contentHeight = jQuery(window).height()* 0.6+"px";
		var self = this;
		this.oCoreApi = oController.oCoreApi;
		this.oUiApi = oController.oUiApi;
		var closeButton = new sap.m.Button({
			text : self.oCoreApi.getTextNotHtmlEncoded("close"),
			press : function() {
				self.selectionDisplayDialog.close();
				self.selectionDisplayDialog.destroy();
			}
		});
		var oActiveStep = this.oCoreApi.getActiveStep();
		var selectedRepresentation = oActiveStep.getSelectedRepresentation();
		var selectionData =  typeof(selectedRepresentation.getSelections) === "function" ? selectedRepresentation.getSelections() : undefined; //Returns the filter selections
        var selectedDimension =selectedRepresentation.getMetaData().getPropertyMetadata(selectedRepresentation.getParameter().requiredFilters[0]).label;
		var oModel = new sap.ui.model.json.JSONModel();
		//Preparing the data list in the dialog
		if(selectionData !== undefined){
			var oData = {
					selectionData : selectionData
			};
			var selectionList = new sap.m.List({
				items : {
					path : "/selectionData",
					template: new sap.m.StandardListItem({
					   title : "{text}"
					})
				}
			});
			oModel.setData(oData);
			selectionList.setModel(oModel);
			this.selectionDisplayDialog = new sap.m.Dialog({
				title : this.oCoreApi.getTextNotHtmlEncoded("selected-required-filter", [selectedDimension]) + " (" + selectionData.length + ")",
				contentWidth : self.contentWidth,
				contentHeight : self.contentHeight,	
				buttons : [closeButton],
				content : [selectionList]
			});
			return this.selectionDisplayDialog;
		}
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class stepGallery
 *@name  stepGallery Fragment
 *@description Holds the available steps of configuration and displays them in a dialog using js fragment
 *@memberOf sap.apf.ui.reuse.view
 * 
 */
sap.ui.jsfragment("sap.apf.ui.reuse.fragment.stepGallery", {
	createContent : function(oController) {
		this.oController = oController;
		this.contentWidth = jQuery(window).height() * 0.6 + "px"; // height and width for the dialog relative to the window
		this.contentHeight = jQuery(window).height() * 0.6 + "px";
		var self = this;
		this.oCoreApi = oController.oCoreApi;
		this.oUiApi = oController.oUiApi;
		this.hierarchicalDialog = new sap.ca.ui.HierarchicalSelectDialog({ // step gallery
			title : self.oCoreApi.getTextNotHtmlEncoded("stepGallery"),
			contentWidth : self.contentWidth,
			contentHeight : self.contentHeight,
			select : function(evt) {
				self.oUiApi.getLayoutView().setBusy(true);
				var eventBindingContext = evt.getParameters().selectedItem.oBindingContexts.json.sPath.split('/');
				var categoryIndex = eventBindingContext[2];
				var stepIndex = eventBindingContext[4];
				var representationIndex = eventBindingContext[6];
				var stepDetails = oController.getStepDetails(categoryIndex, stepIndex); //TODO Is there any alternate way of getting step details from list binding???
				oController.onStepPress(stepDetails.id, stepDetails.representationtypes[representationIndex].representationId);
			},
			cancel : function() {
				var oSelf = this;
				oSelf.close();
				oSelf.destroy();
			}
		});
		this.categoryTitle = new sap.ca.ui.HierarchicalSelectDialogItem({ // Dialog Item to hold  list of categories
			title : self.oCoreApi.getTextNotHtmlEncoded("category"),
			entityName : "json>/GalleryElements",
			visible : true
		});
		this.categoryTemplate = new sap.m.StandardListItem({
			title : '{json>categoryDetails/title}',
			tooltip : '{json>categoryDetails/title}'
		});
		this.stepTitle = new sap.ca.ui.HierarchicalSelectDialogItem({ // Dialog Item to hold  list of steps
			entityName : "json>stepTemplates"
		});
		this.stepTemplate = new sap.m.StandardListItem({
			title : '{json>maintitle}',
			tooltip : '{json>maintitle}'
		});
		this.representationTitle = new sap.ca.ui.HierarchicalSelectDialogItem({ // Dialog Item to hold  list of representations
			entityName : "json>representationtypes"
		});
		this.representationTemplate = new sap.m.StandardListItem({
			icon : '{json>picture}',
			title : '{json>title}',
			tooltip : '{json>title}'
		});
		this.representationTemplate.bindProperty("description", "json>sortDescription", function(value) {
			if (value === undefined || value === null) {
				return null;
			}
			return self.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + value;
		});
		this.categoryTitle.setListItemTemplate(this.categoryTemplate); //binding list of categories,steps and representations to the dialog item
		this.stepTitle.setListItemTemplate(this.stepTemplate);
		this.representationTitle.setListItemTemplate(this.representationTemplate);
		this.hierarchicalDialog.addItem(this.categoryTitle); //Category list
		this.hierarchicalDialog.addItem(this.stepTitle);// Steps in a category
		this.hierarchicalDialog.addItem(this.representationTitle);//Representations in a step
		return this.hierarchicalDialog;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class analysisPath 
 *@name analysisPath
 *@memberOf sap.apf.ui.reuse.view 
 *@description Layout holds title of Analysis Path, saved path name, Toolbar and Carousel
 *@returns  {AnalysisPath}  
 */
sap.ui.jsview("sap.apf.ui.reuse.view.analysisPath", {
	/**
	 *@this {sap.apf.ui.reuse.view.analysisPath}
	 *@description anlaysisPath view
	 */
	/**
	 *@method getCarousel
	 *@memberOf sap.apf.ui.reuse.view.analysisPath
	 *@see sap.apf.ui.reuse.view.carousel
	 */
	getCarousel : function() {
		return this.oCarousel;
	},
	/**
	 *@method getToolbar
	 *@see sap.apf.ui.reuse.view.analysisPath
	 *@memberOf sap.apf.ui.reuse.view.analysisPath
	 */
	getToolbar : function() {
		return this.oActionListItem;
	},
	/**
	 *@method getPathGallery
	 *@memberOf sap.apf.ui.reuse.view.analysisPath
	 */
	getPathGallery : function() {
		return this.pathGallery;
	},
	/**
	 *@method getPathGalleryWithDeleteMode
	 *@memberOf sap.apf.ui.reuse.view.analysisPath
	 */
	getPathGalleryWithDeleteMode : function() {
		return this.deleteAnalysisPath;
	},
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.analysisPath";
	},
	createContent : function(oController) {
		var self = this;
		this.oController = oController;
		this.oActionListPopover = new sap.m.Popover({
			showHeader : false,
			placement : sap.m.PlacementType.Bottom,
			contentWidth : "150px"
		});
		var oViewData = this.getViewData();
		self.oCoreApi = oViewData.oCoreApi;
		self.oUiApi = oViewData.uiApi;
		this.oActionListItem = sap.ui.view({
			viewName : "sap.apf.ui.reuse.view.toolbar",
			type : sap.ui.core.mvc.ViewType.JS,
			viewData : oViewData
		}).addStyleClass("toolbarView");
		this.oActionListPopover.addContent(this.oActionListItem);
		this.oSavedPathName = new sap.m.ObjectHeader({
					title : this.oCoreApi.getTextNotHtmlEncoded("unsaved"),
					showTitleSelector : true,
					condensed : true,
					titleSelectorPress : function(oEvent){
						self.oActionListPopover.openBy(oEvent.getParameter("domRef"));
					}
		}).addStyleClass("sapApfObjectHeader");
		this.oCarousel = new sap.ui.view({
			type : sap.ui.core.mvc.ViewType.JS,
			viewName : "sap.apf.ui.reuse.view.carousel",
			viewData : {
				analysisPath : self,
				oInject : oViewData
			}
		});
		this.pathGallery = new sap.ui.view({
			type : sap.ui.core.mvc.ViewType.JS,
			viewName : "sap.apf.ui.reuse.view.pathGallery",
			viewData : {
				oInject : oViewData
			}
		});
		this.deleteAnalysisPath = new sap.ui.view({
			type : sap.ui.core.mvc.ViewType.JS,
			viewName : "sap.apf.ui.reuse.view.deleteAnalysisPath",
			viewData : {
				oInject : oViewData
			}
		});
		this.oAnalysisPath = new sap.ui.layout.VerticalLayout({
			content : [ self.oContentTitle , self.oSavedPathName , self.oCarousel ],
			width : '100%'
		});
		return this.oAnalysisPath;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class carousel
 *@name carousel
 *@memberOf sap.apf.ui.reuse.view
 *@description Layout holds Analysis Steps
 *@returns {Carousel}  
 */
sap.ui.jsview("sap.apf.ui.reuse.view.carousel", {
	/**
	 *@memberOf sap.apf.ui.reuse.view.carousel
	 *@method getStepGallery
	 *@see sap.apf.ui.reuse.view.stepGallery
	 *@return {sap.apf.ui.reuse.view.stepGallery}
	 */
	getStepGallery : function() {
		var stepGallery = this.oController.stepGalleryView;
		return stepGallery;
	},
	getChartToolbar : function() {
		return this.oController.oStepToolbar;
	},
	carouselContent : function (oController) {
		jQuery.sap.require('sap.apf.ui.controls.draggableCarousel.DraggableCarousel');
		var self = this;
		this.oController = oController;
		this.stepViews = [];
		var oViewData = this.getViewData().oInject;
		self.oCoreApi = oViewData.oCoreApi;
		self.oUiApi = oViewData.uiApi;
		var separator = new sap.ui.core.Icon({
			src : "sap-icon://arrow-bottom"
		}).addStyleClass('downArrow');
		var separatorEle = document.createElement('div');
		separatorEle.innerHTML = sap.ui.getCore().getRenderManager().getHTML(separator);
		var removeIcon = new sap.ui.core.Icon({
			src : "sap-icon://sys-cancel-2",
			size : "20px"
		}).addStyleClass('removeIcon');
		var removeIconEle = document.createElement('div');
		removeIconEle.innerHTML = sap.ui.getCore().getRenderManager().getHTML(removeIcon);
		var height = jQuery(window).height() - sap.apf.ui.utils.CONSTANTS.carousel.SCROLLCONTAINER + "px";
		var width = "320px"; // S2 View Content Width.
		window.onresize = function() {
			var height = jQuery(window).height() - sap.apf.ui.utils.CONSTANTS.carousel.SCROLLCONTAINER + "px";
			jQuery('.DnD-container').css({"height" : jQuery(window).height() - sap.apf.ui.utils.CONSTANTS.carousel.DNDBOX + "px"});
			jQuery(".scrollContainerEle").css("height", height);
		};
		this.dndBox = new sap.apf.ui.controls.draggableCarousel.DraggableCarousel({
			containerHeight : jQuery(window).height() - sap.apf.ui.utils.CONSTANTS.carousel.DNDBOX + "px",
			containerWidth : width,
			blockHeight : sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.STEP_HEIGHT,
			blockWidth : sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.STEP_WIDTH,
			blockMargin : sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.STEP_MARGIN,
			separatorHeight : sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.SEPARATOR_HEIGHT,
			removeIconHeight : sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.REMOVE_ICON_HEIGHT,
			separator : separatorEle,
			removeIcon : removeIconEle,
			onBeforeDrag : function(dragIndex) {
			},
			onAfterDrop : oController.moveStep.bind(oController),
			onAfterRemove : oController.removeStep.bind(oController),
			onAfterSelect : function (index) {
				//Based on drag-state setActiveStep or Add Analysis Step
				if (jQuery(this).attr("drag-state") === "true") {
					self.getStepView(index).oController.setActiveStep(index);
				} else {
					oController.showStepGallery();
				}
			}
		});
		window.dndBox = this.dndBox;
		var uniqueId = this.createId("dnd-Holder");
		this.oHtml = new sap.ui.core.HTML({
			content : "<div id = '" + uniqueId + "'></div>", //TODO Check whether DOM is getting destroyed properly
			afterRendering : function() {
				self.dndBox.placeAt(uniqueId);
				jQuery(self.dndBox.eleRefs.blocks[0]).height("80px");
			}
		});
		var sampleDiv;
		this.addButton = new sap.m.Button({
			text : self.oCoreApi.getTextNotHtmlEncoded("add-step"),
			width : "100%",
			icon : "sap-icon://add",
			press : function(evt) {
				oController.showStepGallery();
			}
		});
		sampleDiv = document.createElement('div');
		sampleDiv.setAttribute('class', 'addStepBtnHolder');
		jQuery(sampleDiv).html(jQuery(sap.ui.getCore().getRenderManager().getHTML(this.addButton)).attr("tabindex", -1));
		
		dndBox.addBlock({
			blockElement : sampleDiv,
			dragState : false,
			dropState : false,
			removable : false
		});
		this.up = new sap.m.Button({
			icon : "sap-icon://arrow-top",
			press : function() {
				var activeStepIndex = self.oCoreApi.getSteps().indexOf(self.oCoreApi.getActiveStep());
				if (activeStepIndex !== 0) {
					var newPos = activeStepIndex - 1;
					var success = self.oUiApi.getAnalysisPath().getCarousel().dndBox.swapBlocks(activeStepIndex, newPos);
					if (success) {
						self.oUiApi.getAnalysisPath().getCarousel().getController().moveStep(activeStepIndex, newPos);
					}
				}
			}
		});
		this.down = new sap.m.Button({
			icon : "sap-icon://arrow-bottom",
			press : function() {
				var activeStepIndex = self.oCoreApi.getSteps().indexOf(self.oCoreApi.getActiveStep());
				if (activeStepIndex !== (self.oCoreApi.getSteps().length - 1)) {
					var newPos = activeStepIndex + 1;
					var success = self.oUiApi.getAnalysisPath().getCarousel().dndBox.swapBlocks(activeStepIndex, newPos);
					if (success) {
						self.oUiApi.getAnalysisPath().getCarousel().getController().moveStep(activeStepIndex, newPos);
					}
				}
			}
		});
		this.oCarousel = new sap.m.ScrollContainer({
			content : this.oHtml,
			height : height,
			horizontal : false,
			vertical : true
		}).addStyleClass("scrollContainerEle");
		return this.oCarousel;
	},
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.carousel";
	},
	createContent : function(oController) {
		var carouselContent = this.carouselContent(oController);
		return carouselContent;
	},
	getStepView : function(stepIndex) {
		return this.stepViews[stepIndex];
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.jsview("sap.apf.ui.reuse.view.deleteAnalysisPath", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.deleteAnalysisPath";
	},
	createContent : function(oController) {
		this.oController = oController;
		this.viewData = this.getViewData();
		var self = this;
		this.oCoreApi = this.getViewData().oInject.oCoreApi;
		this.oUiApi = this.getViewData().oInject.uiApi;
		this.width = jQuery(window).height()* 0.55+"px"; // height and width for the list relative to the window
        this.height = jQuery(window).height()* 0.55+"px";
		var list = new sap.m.List({
			width : self.width,
			height : self.height,
			mode: sap.m.ListMode.Delete,
			items: {
				path: "/GalleryElements",
				template: new sap.m.StandardListItem({
					title:"{AnalysisPathName}",
					description:"{description}",
					tooltip : "{AnalysisPathName}" 
				})
			},
			"delete": function (evt) {
				var item = evt.getParameter("listItem");
				var sPathName = item.getProperty('title');
				var guid = self.oController.getGuidForPath(sPathName,self.viewData.jsonData.GalleryElements);
				var oListInfo ={};
				oListInfo.item = item;
				oListInfo.list = list;
				oListInfo.guid =guid;
				oListInfo.sPathName= sPathName;
				self.oUiApi.getAnalysisPath().getToolbar().getController().getConfirmDelDialog(oListInfo);
			}

		});
		var pathGalleryModel = new sap.ui.model.json.JSONModel();
		pathGalleryModel.setData(this.viewData.jsonData);
		list.setModel(pathGalleryModel);
		return list;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class new facetFilter
 * @name  newFacetFilter
 * @description Holds the available filters
 * @memberOf sap.apf.ui.reuse.view
 * 
 */
sap.ui.jsview("sap.apf.ui.reuse.view.facetFilter", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.facetFilter";
	},
	createContent : function(oController) {
		var oSelf = this;
		this.aFacetFilterListControls = [];
		this.oCoreApi = this.getViewData().oCoreApi;
		this.oUiApi = this.getViewData().oUiApi;
		this.oPathContextHandler = this.getViewData().oPathContextHandler;
		this.aFacetFilterListData = this.getViewData().aFacetFilterListData;
		this.aFacetFilterListData.forEach(function (oFacetFilterListData) {
			var oFacetFilterList = new sap.m.FacetFilterList({
				title: oSelf.oCoreApi.getTextNotHtmlEncoded(oFacetFilterListData.label),
				multiSelect: oFacetFilterListData.multiSelection === "true",
				key: oFacetFilterListData.property,
				growing: false,
				listClose: oController.onListClose.bind(oController)
			});
			oSelf.aFacetFilterListControls.push(oFacetFilterList);
		});
		
		this.onContextChanged = oController.onContextChanged.bind(oController);
		this.getFormattedFilters = oController.getFormattedFilters.bind(oController);
		
		this.oFacetFilter = new sap.m.FacetFilter({
			type : "Simple",
			showReset : true,
			showPopoverOKButton : true,
			lists : this.aFacetFilterListControls,
			reset: oController.onResetPress.bind(oController)
		});
		return this.oFacetFilter;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class messageHandler
 * @memberOf sap.apf.ui.reuse.view
 * @name messageHandler
 */
sap.ui.jsview("sap.apf.ui.reuse.view.messageHandler", {
	/**
	 * @this {sap.apf.ui.reuse.view.messageHandler}
	 * @description messageHandler view
	 */
	/**
	 * @memberOf sap.apf.ui.reuse.view.messageHandler
	 * @method initializeHandler
	 * @param oMessageObject
	 * @description UI handle for error messages to be shown on notification bar
	 */
	initializeHandler : function(oMessageObject) {
		this.getController().showMessage(oMessageObject);
	},
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.messageHandler";
	},
	createContent : function(oController) {
		jQuery.sap.require("sap.m.MessageToast");
		jQuery.sap.require("sap.ca.ui.message.message");
		
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 *@class navigationTarget 
 *@name navigationTarget
 *@memberOf sap.apf.ui.reuse.view 
 *@description Contains the list of navigation targets possible for the APF Application
 *@returns  {Open in - Navigation Target buttons}  
 */
sap.ui.jsview("sap.apf.ui.reuse.view.navigationTarget", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.navigationTarget";
	},
	createContent : function(oController) {
		var oViewData = this.getViewData();
		this.oNavListPopover = oViewData.oNavListPopover;
		this.oOpenInButtonEventSource = oViewData.oOpenInButtonEventSource;
		this.oNavigationHandler = oViewData.oNavigationHandler;
		this.oUiApi = oViewData.oUiApi;
		this.oController = oController;
		//Call to getNavigationTargetsWithText returns a promise
		this.oUiApi.getLayoutView().byId("applicationPage").setBusy(true);//Set busy indicator to true once open in is pressed
		var oNavTargetsPromise = this.oNavigationHandler.getNavigationTargetsWithText();
		// Call to _prepareActionListModel after promise is done
		oNavTargetsPromise.then(this._prepareActionListModel.bind(this), function(){
			this.oUiApi.getLayoutView().byId("applicationPage").setBusy(false);//Set busy indicator to false once open in is pressed
		});
	},
	/**
	 *@description Prepares Action list model and adds it the openIn button pop over
	 *@param {Array} Array of objects contains the navigation targets with semantic object, action, action's text, id from when the promise is done
	 */
	_prepareActionListModel : function(navTargets) {
		var oActionListItem, navTargets;
		var self = this;
		var oModel = new sap.ui.model.json.JSONModel();
		var oData = {
			navTargets : navTargets
		};
		//Preparing the list of navigation target actions in the list
		oActionListItem = new sap.m.List({
			items : {
				path : "/navTargets",
				template : new sap.m.StandardListItem({
					title : "{text}",
					type : sap.m.ListType.Navigation,
					press : function(oEvent) {
						var selectedNavTarget = oEvent.getSource().getBindingContext().getObject().id;
						self.oController.handleNavigation(selectedNavTarget);//Navigate to app once an action is clicked
					},
				})
			}
		});
		oModel.setData(oData);
		oActionListItem.setModel(oModel);
		this.oNavListPopover.removeAllContent();
		this.oNavListPopover.addContent(oActionListItem);
		this.oUiApi.getLayoutView().byId("applicationPage").setBusy(false);//Set busy indicator to true once open in list is populated
		this.oNavListPopover.openBy(this.oOpenInButtonEventSource);
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
sap.ui.jsview("sap.apf.ui.reuse.view.pathGallery", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.pathGallery";
	},
	createContent : function(oController) {
			this.viewData = this.getViewData();
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 *@class step
 *@name step
 *@memberOf sap.apf.ui.reuse.view
 *@description Layout to hold stepThumbnail
 */
sap.ui.jsview("sap.apf.ui.reuse.view.step", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.step";
	},
	stepContent : function() {
		this.oCoreApi = this.getViewData().oCoreApi;
		this.oUiApi = this.getViewData().uiApi;
		this.oTopLayout = new sap.m.FlexBox({
			items : [ new sap.m.Text({
				text : '{/thumbnail/leftUpper}',
				tooltip : '{/thumbnail/leftUpper}',
				wrapping : true,
				maxLines : 2,
				textAlign : sap.ui.core.TextAlign.Left
			}).addStyleClass("thumbanilText"), new sap.m.Text({
				text : '{/thumbnail/rightUpper}',
				tooltip : '{/thumbnail/rightUpper}',
				wrapping : true,
				maxLines : 2,
				textAlign : sap.ui.core.TextAlign.Right
			}).addStyleClass("thumbanilText") ],
			alignItems : sap.m.FlexAlignItems.Start,
			justifyContent : sap.m.FlexJustifyContent.SpaceBetween
		}).addStyleClass("topLayout");
		this.oThumbnailChartLayout = new sap.m.VBox({
			height : "80px"
		}).addStyleClass('ChartArea');
		this.oThumbnailChartLayout.setBusy(true);
		this.oBottomLayout = new sap.m.FlexBox({
			items : [ new sap.m.Text({
				text : '{/thumbnail/leftLower}',
				tooltip : '{/thumbnail/leftLower}',
				wrapping : true,
				maxLines : 2,
				textAlign : sap.ui.core.TextAlign.Left
			}).addStyleClass("thumbanilText"), new sap.m.Text({
				text : '{/thumbnail/rightLower}',
				tooltip : '{/thumbnail/rightLower}',
				wrapping : true,
				maxLines : 2,
				textAlign : sap.ui.core.TextAlign.Right
			}).addStyleClass("thumbanilText") ],
			alignItems : sap.m.FlexAlignItems.Start,
			justifyContent : sap.m.FlexJustifyContent.SpaceBetween
		}).addStyleClass("bottomLayout");
		this.oThumbnailVLayout = new sap.m.VBox({
			items : [ this.oTopLayout, this.oThumbnailChartLayout, this.oBottomLayout ],
			height : "130px"
		}).addStyleClass('stepThumbnail');
		this.oStepTitle = new sap.m.Text({
			text : '{/title}',
			textAlign : sap.ui.core.TextAlign.Center,
			wrapping : true,
			width : "200px"
		});
		this.oVChartLayout = new sap.m.VBox({
			items : [ this.oThumbnailVLayout, this.oStepTitle ],
			width : "200px"
		}).addStyleClass("sapApfStepLayout");
		var htmlWrapper = new sap.m.VBox({
			items : []
		}).addStyleClass("block-overlay-container");
		var self = this;
		htmlWrapper.addEventDelegate({
			onAfterRendering : function() {
				//Show Master Button to be displayed on detail footer bottom for mobile device
				var showMasterButton = new sap.m.Button({
					text : self.oCoreApi.getTextNotHtmlEncoded("showAnalyticalPath"),
					press : function() {
						self.oUiApi.getLayoutView().byId("detailFooter").removeAllContentLeft();
						self.oUiApi.getLayoutView().byId("applicationView").backToTopMaster();
					},
					lite : true,
					type : "Transparent"
				});
				//Events for hover and touch on step
				jQuery(htmlWrapper.getDomRef()).on("mouseenter", function() {
					jQuery(this).addClass("sapThemeBarBG");
					jQuery(this).css({
						"opacity" : "0.3"
					});
				});
				//On touch start show overlay with opacity 0.3
				//Mobile Device Bug Fix - on touch start prevent the default zoom 
				//which appears on double tap or hold on step
				jQuery(htmlWrapper.getDomRef()).on("touchstart", function() {
					//On Double Tap disable Zoom text focus and application 
					var t2 = e.timeStamp, t1 = $(this).data('lastTouch') || t2, dt = t2 - t1, fingers = e.originalEvent.touches.length;
					$(this).data('lastTouch', t2);
					if (!dt || dt > 500 || fingers > 1)
						return; // not double-tap
					e.preventDefault(); // double tap - prevent the zoom
					// also synthesize click events we just swallowed up
					$(this).trigger('click').trigger('click');
					jQuery(this).addClass("sapThemeBarBG");
					jQuery(this).css({
						"opacity" : "0"
					});
				});
				jQuery(htmlWrapper.getDomRef()).on("mouseleave", function() {
					jQuery(this).removeClass("sapThemeBarBG");
					jQuery(this).css({
						"opacity" : "1"
					});
				});
				jQuery(htmlWrapper.getDomRef()).on("touchend touchmove", function() {
					jQuery(this).removeClass("sapThemeBarBG");
					jQuery(this).css({
						"opacity" : "0"
					});
				});
				//Device Phone: Hide/Show the Master/Detail Page 
				//On click of step go to the detail page
				//Add the text on bottom of footer and tap of text
				//go back to the master view 
				if (sap.ui.Device.system.phone) {
					jQuery(htmlWrapper.getDomRef()).on("tap", function() {
						self.oUiApi.getLayoutView().getController().hideMaster();
						self.oUiApi.getLayoutView().byId("detailFooter").removeContentLeft(showMasterButton);
						self.oUiApi.getLayoutView().getController().addDetailFooterContentLeft(showMasterButton);
						self.oUiApi.getStepContainer().getController().drawStepContent();
					});
				}
			}
		});
		this.oVChartTiltleLayout = new sap.m.VBox({
			items : [ htmlWrapper, this.oVChartLayout ],
			width : "200px",
		}).addStyleClass("sapUiTableCCnt");
		return this.oVChartTiltleLayout;
	},
	createContent : function(oController) {
		var stepContent = this.stepContent();
		return stepContent;
	},
	toggleActiveStep : function() {
		var allSteps = this.oUiApi.getAnalysisPath().getCarousel().stepViews;
		for( var i in allSteps) {
			if (allSteps[i].oThumbnailVLayout.hasStyleClass('sapThemeBaseBG-asBackgroundColor')) {
				allSteps[i].oThumbnailVLayout.removeStyleClass('sapThemeBaseBG-asBackgroundColor');
				allSteps[i].oStepTitle.removeStyleClass('activeStepTitle');
				break;
			}
		}
		this.oThumbnailVLayout.addStyleClass('sapThemeBaseBG-asBackgroundColor');
		this.oStepTitle.addStyleClass('activeStepTitle');
	},
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class stepContainer
 * @name stepContainer
 * @memberOf sap.apf.ui.reuse.view
 * @description Holds the step in main area. Includes the step toolbar view and step representation view
 * @returns {stepContainerLayout}
 */
sap.ui.jsview("sap.apf.ui.reuse.view.stepContainer", {
	/**
	 * @this {sap.apf.ui.reuse.view.stepContainer}
	 *
	 */
	/**
	 * @memberOf sap.apf.ui.reuse.view.stepContainer
	 * @method getStepToolbar
	 * @see sap.apf.ui.reuse.view.stepToolbar
	 * @description Getter for step toolbar container 
	 * @returns stepToolbar view 
	 */
	getStepToolbar : function() {
		return this.oStepToolbar;
	},
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.stepContainer";
	},

	createContent : function(oController) {
		var oViewData = this.getViewData();
		this.oStepToolbar = sap.ui.view({viewName:"sap.apf.ui.reuse.view.stepToolbar", type:sap.ui.core.mvc.ViewType.JS,viewData :oViewData});
		this.stepLayout = new sap.ui.layout.VerticalLayout({
			content : [ this.oStepToolbar],
			width : "100%"
		});
		this.vLayout = new sap.ui.layout.VerticalLayout({
			content : this.stepLayout,
			width : "100%"
		});
		this.vLayout.setBusy(true);
		return this.vLayout; //holds chart and toolbar
	},

});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class stepGallery
 * @name  stepGallery
 * @description Holds the available steps of configuration and displays them on overlay container
 * @memberOf sap.apf.ui.reuse.view
 * 
 */
sap.ui.jsview("sap.apf.ui.reuse.view.stepGallery", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.stepGallery";
	},
	createContent : function(oController) {
		this.oController = oController;
}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class  stepToolbar
 * @name  stepToolbar
 * @description toolbar for a step shown in main area
 * @memberOf sap.apf.ui.reuse.view
 */
sap.ui.jsview("sap.apf.ui.reuse.view.stepToolbar", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.stepToolbar";
	},
	createContent : function(oController) {
		this.chartToolbar = new sap.ca.ui.charts.ChartToolBar({
			showLegend: true,
			showFullScreen: true
		});
		return this.chartToolbar;
	}
});
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/**
 * @class toolbar
 * @memberOf sap.apf.ui.reuse.view
 * @name toolbar
 * @description layout holds the Toolbar buttons: new , save, open, print
 */
sap.ui.jsview("sap.apf.ui.reuse.view.toolbar", {
	getControllerName : function() {
		return "sap.apf.ui.reuse.controller.toolbar";
	},
	createContent : function(oController) {
		// when metadata is not available, default values are set
		this.maxNumberOfSteps = 32;
		this.maxNumberOfPaths = 255;
		var self = this;
		var oViewData = this.getViewData();
		self.oCoreApi = oViewData.oCoreApi;
		self.oUiApi = oViewData.uiApi;
		var oTemplateNew = new sap.m.StandardListItem({
			icon : 'sap-icon://add-product',
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("new"),
			press : function() {
				self.getParent().close();
				self.oUiApi.getLayoutView().setBusy(true);
				oController.getNewAnalysisPathDialog();
				self.oUiApi.getLayoutView().setBusy(false);
			},
		});
		var oTemplateOpen = new sap.m.StandardListItem({
			icon : "sap-icon://open-folder",
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("open"),
			press : function() {
				self.oUiApi.getLayoutView().setBusy(true);
				self.getParent().close();
				oController.onOpenPathGallery();
			},
		});
		var oTemplateSave = new sap.m.StandardListItem({
			icon : "sap-icon://save",
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("save"),
			press : function() {
				self.getParent().close();
				if (self.oCoreApi.getSteps().length !== 0) {
					self.oUiApi.getLayoutView().setBusy(true);
					self.oCoreApi.readPaths(function(respObj, metaData, msgObj) {
						var bSaveAs = false;
						var paths = respObj.paths;
						if (metaData !== undefined) {
							self.maxNumberOfSteps = metaData.getEntityTypeMetadata().maximumNumberOfSteps;
							self.maxNumberOfPaths = metaData.getEntityTypeMetadata().maxOccurs;
						}
						if (msgObj === undefined && (typeof respObj === "object")) {
							oController.getSaveDialog(bSaveAs, function() {
							}, paths);
						} else {
							oMessageObject = self.oCoreApi.createMessageObject({
								code : "6005",
								aParameters : []
							});
							oMessageObject.setPrevious(msgObj);
							self.oCoreApi.putMessage(oMessageObject);
						}
						self.oUiApi.getLayoutView().setBusy(false);
					});
				} else
					oController.getDialogForNoPathAdded();
			},
		});
		var oTemplateSaveAs = new sap.m.StandardListItem({
			icon : "sap-icon://save",
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("saveAs"),
			press : function() {
				self.getParent().close();
				if (self.oCoreApi.getSteps().length !== 0) {
					self.oUiApi.getLayoutView().setBusy(true);
					self.oCoreApi.readPaths(function(respObj, metaData, msgObj) {
						var bSaveAs = true;
						var paths = respObj.paths;
						if (metaData !== undefined) {
							self.maxNumberOfSteps = metaData.getEntityTypeMetadata().maximumNumberOfSteps;
							self.maxNumberOfPaths = metaData.getEntityTypeMetadata().maxOccurs;
						}
						if (msgObj === undefined && (typeof respObj === "object")) {
							oController.getSaveDialog(bSaveAs, function() {
							}, paths);
						} else {
							oMessageObject = self.oCoreApi.createMessageObject({
								code : "6005",
								aParameters : []
							});
							oMessageObject.setPrevious(msgObj);
							self.oCoreApi.putMessage(oMessageObject);
						}
						self.oUiApi.getLayoutView().setBusy(false);
					});
				} else
					oController.getDialogForNoPathAdded();
			},
		});
		var oTemplateDelete = new sap.m.StandardListItem({
			icon : "sap-icon://delete",
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("delete"),
			press : function() {
				self.getParent().close();
				self.oUiApi.getLayoutView().setBusy(true);
				oController.onOpenPathGalleryWithDelete();
			},
		});
		var oTemplatePrint = new sap.m.StandardListItem({
			icon : "sap-icon://print",
			type : sap.m.ListType.Active,
			title : self.oCoreApi.getTextNotHtmlEncoded("print"),
			press : function() {
				self.getParent().close();
				oController.doPrint();
			},
		});
		this.oActionListItem = new sap.m.List({
			items : [ oTemplateNew, oTemplateOpen, oTemplateSave, oTemplateSaveAs, oTemplateDelete, oTemplatePrint ]
		});
		return this.oActionListItem;
	}
});
jQuery.sap.declare('sap.apf.library-all');
jQuery.sap.declare('sap.apf.modeler.ui.controller.configurationListNew.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.modeler.ui.controller.navigationTarget.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.modeler.ui.controller.titleBreadCrumb.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.modeler.ui.controller.toolbar.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.analysisPath.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.carousel.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.deleteAnalysisPath.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.layout.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.messageHandler.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.navigationTarget.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.pathGallery.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.step.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.stepContainer.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.controller.toolbar.controller'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.fragment.pathGallery.fragment'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.fragment.selectionDisplay.fragment'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.fragment.stepGallery.fragment'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.analysisPath.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.carousel.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.deleteAnalysisPath.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.facetFilter.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.messageHandler.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.navigationTarget.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.pathGallery.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.step.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.stepContainer.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.stepGallery.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.stepToolbar.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
jQuery.sap.declare('sap.apf.ui.reuse.view.toolbar.view'); // raw module, declared by SAPUI5 'AllInOne' Builder
if ( !jQuery.sap.isDeclared('sap.apf.core.constants') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.core.constants');
jQuery.sap.require('sap.ui.model.FilterOperator'); // unlisted dependency retained


(function () {
    'use strict';
    /**
     * Constants of the core
     * @class sap.apf.core.constants
     */
    sap.apf.core.constants = sap.apf.core.constants || {};
    /**
     * The constants shall be returned from a representation with method getFilterMethodTypes.
     * @class filterMethodTypes
     * @memberOf sap.apf.core.constants
     */
    sap.apf.core.constants.filterMethodTypes = {
        /**
         * @public
         * @description selectionAsArray
         */
        selectionAsArray: 'saa',
        /**
         * @public
         * @description filter
         */
        filter: 'f'
    };
    /**
     * @class Enumeration for filter operators, that are supported in odata $filter part. See{@link sap.ui.model.FilterOperator}
     */
    sap.apf.core.constants.FilterOperators = sap.ui.model.FilterOperator;
    sap.apf.core.constants.BooleFilterOperators = {
        AND: "and",
        OR: "or",
        NOT: "not"
    };
    /**
     * @constant sap.apf.core.constants.aSelectOpt operators for filter terms.
     * @description All allowed constants, that can be used in filter terms.
     *              These constants correspond to the terms, that can be handled by
     *              the OData protocol.
     */
    sap.apf.core.constants.aSelectOpt = [sap.apf.core.constants.FilterOperators.EQ, sap.apf.core.constants.FilterOperators.NE, sap.apf.core.constants.FilterOperators.GT, sap.apf.core.constants.FilterOperators.LT,
        sap.apf.core.constants.FilterOperators.GE, sap.apf.core.constants.FilterOperators.LE, sap.apf.core.constants.FilterOperators.BT, sap.apf.core.constants.FilterOperators.StartsWith, sap.apf.core.constants.FilterOperators.Contains,
        sap.apf.core.constants.FilterOperators.EndsWith];
    /**
     * @class Constants for the resource location
     * @descriptions Properties in the configuration file for the resource locations
     */
    sap.apf.core.constants.resourceLocation = {
        /**
         * @public
         * @description webAppMessageConfiguration
         */
        applicationMessageDefinitionLocation: "applicationMessageDefinitionLocation",
        /**
         * @public
         * @description webAppMessageTextBundle
         */
        applicationMessageTextBundle: "applicationMessageTextBundle",
        /**
         * @public
         * @description apfUiTextBundle
         */
        apfUiTextBundle: "apfUiTextBundle",
        /**
         * @public
         * @description webAppTextBundle
         */
        applicationUiTextBundle: "applicationUiTextBundle",
        /**
         * @public
         * @description analyticalConfigurationLocation
         */
        analyticalConfigurationLocation: "analyticalConfigurationLocation"
    };
    /**
     * @namespace Constants for the message handling.
     */
    sap.apf.core.constants.message = {};
    /**
     * @class Message severity constants
     * @description Constants for the severity of a message object.
     * @memberOf sap.apf.core.constants.message.code
     */
    sap.apf.core.constants.message.severity = {
        /**
         * @public
         * @description fatal
         */
        fatal: "fatal",
        /**
         * @public
         * @description warning
         */
        warning: "warning",
        /**
         * @public
         * @description error
         */
        error: "error",
        /**
         * @public
         * @description technical error
         */
        technError: "technError"
    };
    /**
     * @description Unique text to identify an exception, that should be ignored by the message handler during
     * processing the window.onerror. This allows to stop the execution by throwing an error.
     */
    sap.apf.core.constants.message.code = {
        suppressFurtherException: "APFapf1972",
        errorCheck: "5100",
        errorCheckWarning: "5101",
        errorCheckConfiguration: "5102",
        errorCheckConfigurationWarning: "5103",
        errorExitTriggered: "5300",
        // messages, that exist without configuration, because they are used, before message configuration is loaded
        errorUnknown: "9000",
        //fatal messages, that occur during loading
        errorLoadConfig: "9001",
        errorStopProcessing: "9002",
        errorStartUp: "9003",
        errorLoadingRessource: "9007",
        wrongRessourcePath: "9008",
        missingAnalyticalConfig: "9009",
        errorLoadingAnalyticalConfig: "9010",
        errorInAnalyticalConfig: "9011"
    };
    /**
     * @class Event callback constants
     * @description Constants for the events triggered from apf
     * @memberOf sap.apf.core.constants
     */
    sap.apf.core.constants.eventTypes = {
        /**
         * @public
         * @description fired when the sap.apf.setContext is invoked.
         *            Callback function on this event will be executed under the context of API instance.
         *                The arguments can be an {object} or empty based on opening a path scenario and triggering a new path respectively.
         *                The {object} passed on opening a path is described below :
         *              {
	 *              	id - filterId,
	 *              	type - filterType,
	 *              	expressions - filterTopAnd expressions,
	 *              	terms - filterOr expressions
	 *              }
         */
        contextChanged: "contextChanged",
        printTriggered: "printTriggered",
        format: "format"
    };
    /**
     * @class Configuration object types
     * @description Object types supported by configuration factory
     * @memberOf sap.apf.core.constants
     */
    sap.apf.core.constants.configurationObjectTypes = {
        facetFilter: "facetFilter"
    };
    /**
     * @description Names for the services used internally to determine applications, configurations and text elements
     */
    sap.apf.core.constants.entitySets = {
        application: 'ApplicationQueryResults',
        configuration: 'AnalyticalConfigurationQueryResults',
        texts: 'TextElementQueryResults',
        logicalSystem: "SAPClientQuery",
        analysisPath: "AnalysisPathQueryResults",
        smartBusiness: "EVALUATIONS"
    };
    /**
     * @description Development language of property text files
     *
     */
    sap.apf.core.constants.developmentLanguage = "";
    /**
     * initial key for empty text
     */
    sap.apf.core.constants.textKeyForInitialText = "00000000000000000000000000000000";
    /**
     * @description Representation metadata supported types names
     *
     */
    sap.apf.core.constants.representationMetadata = {
        kind: {
            XAXIS: "xAxis",
            YAXIS: "yAxis",
            BUBBLEWIDTH: "bubbleWidth",
            BUBBLEHEIGHT: "bubbleHeight",
            SECTORSIZE: "sectorSize",
            LEGEND: "legend",
            SECTORCOLOR: "sectorColor",
            REGIONCOLOR: "regionColor",
            REGIONSHAPE: "regionShape",
            COLUMN: "column"
        }
    };
    /**
     * @description feedIetm id for vizFrame charts
     *
     */
    sap.apf.core.constants.vizFrame = {
        feedItemTypes: {
            CATEGORYAXIS: "categoryAxis",
            COLOR: "color",
            VALUEAXIS: "valueAxis",
            VALUEAXIS2: "valueAxis2",
            BUBBLEHEIGHT: "bubbleHeight",
            BUBBLEWIDTH: "bubbleWidth",
            SIZE: "size",
            SHAPE: "shape"
        }
    };


    /**
     * @class
     * @description Defaults for the application configuration.
     * @memberOf sap.apf.core.constants
     */
    sap.apf.core.constants.applicationConfiguration = {
        /**
         * @public
         * @description path of default application configuration file.
         */
        applicationConfigPath: "config/applicationConfiguration.json"
    };


}());

}; // end of sap/apf/core/constants.js
if ( !jQuery.sap.isDeclared('sap.apf.core.entityTypeMetadata') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.entityTypeMetadata");
/** 
 * @class Provides convenience functions for metadata handling.
 * @param {sap.apf.core.MessageHandler} oMessageHandler
 * @param {string} sEntityType 
 * @param {sap.apf.core.Metadata} oMetadata
 * @returns {sap.apf.core.EntityTypeMetadata}
 */
sap.apf.core.EntityTypeMetadata = function (oMessageHandler, sEntityType, oMetadata) {
	/**
	 * @description Contains 'entityTypeMetadata'.
	 * @returns {String}
	 */
	this.type = 'entityTypeMetadata';
	/**
	 * @description Returns all metadata for a property as object. 
	 * Property names of the returned object match the metadata attribute names (e.g. 'Name' or 'Nullable') except for the type information, i.e there is no property 'Type'. 
	 * All type information is enclosed in property 'dataType', which is another object.
	 * This object contains property 'EdmType' and optional additional properties belonging to the respective type.
	 * If no metadata could be determined for the property, the method will return an almost empty object that only contains the 'dataType' property for convenience: 
	 * { dataType : { } }. 
	 * @param {string} sProperty
	 * @returns {object}
	 */
	this.getPropertyMetadata = function (sProperty) {
		var result;
		result = oMetadata.getPropertyMetadata(sEntityType, sProperty);
		if (!result) {
			result = {
				dataType : {}
			};
		}
		return result;
	};
	
	/**
	 * @description Returns metadata which includes extensions for OData 4.0 like "RequiresFilter"
	 * @returns {array}
	 */
	this.getEntityTypeMetadata = function() {
		return oMetadata.getEntityTypeMetadata(sEntityType);
	};
	
	function checkArguments() {
		oMessageHandler.check(sEntityType && typeof sEntityType === 'string', 'sap.apf.core.entityTypeMetadata: incorrect value for parameter sEntityType');
		oMessageHandler.check(oMetadata && oMetadata.type && oMetadata.type === "metadata", 'sap.apf.core.entityTypeMetadata: incorrect value for parameter oMetadata');
	}
	
	checkArguments();
};

}; // end of sap/apf/core/entityTypeMetadata.js
if ( !jQuery.sap.isDeclared('sap.apf.core.messageDefinition') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.messageDefinition");

sap.apf.core.messageDefinition = [
    {
        code: "3001",
        severity: "technError",
        text: "Text is not available for the following key: {0}"
    },
    {
        code: "5001",
        severity: "technError",
        text: "Request {3} to server failed with http status code {0}, http error message {1}, and server response {2}."
    },
    {
        code: "5002",
        severity: "error",
        description: "Error in OData request; update of analysis step {0} failed.",
        key: "5002"
    },
    {
        code: "5004",
        severity: "fatal",
        description: "Request with ID {0} does not exist in the analytical content configuration.",
        key: "5004"
    },
    {
        code: "5005",
        severity: "technError",
        text: "Required property {1} is missing in the filter of the OData request for entity type {0}."
    },
    {
        code: "5006",
        severity: "technError",
        text: "Inconsistency in data model; non-filterable property {1} is set as required filter for entity type {0}."
    },
    {
        code: "5015",
        severity: "fatal",
        description: "Service for request {0} is not defined in the analytical content configuration.",
        key: "5015"
    },
    {
        code: "5016",
        severity: "technError",
        text: "Mandatory parameter key property {0} is missing in filter."
    },
    {
        code: "5017",
        severity: "technError",
        text: "Error during annotation retrieval: {0}"
    },
    {
        code: "5018",
        severity: "fatal",
        description: "Metadata request {0} failed.",
        key: "5018"
    },
    {
        code: "5019",
        severity: "technError",
        text: "System query option $orderby for property {1} removed from OData request for entity type {0}."
    },
    {
        code: "5020",
        severity: "fatal",
        description: "Analytical content configuration is not available.",
        key: "5020"
    },
    {
        code: "5021",
        severity: "error",
        description: "Error during server request; session timeout occurred.",
        key: "5021"
    },
    {
    	code: "5022",
    	severity: "fatal",
    	description: "Analytical configuration with ID {0} is not available.",
    	key: "5022"
    },
    {
    	code: "5023",
    	severity: "fatal",
    	description: "Texts could not be loaded for Analytical configuration with ID {0}.",
    	key: "5023"
    },
    {
        code: "5025",
        severity: "fatal",
        description: "Value for SAP client has not been provided at startup of the application.",
        key: "5025"
    },
    {
        code: "5026",
        severity: "fatal",
        description: "Logical system cannot be determined for SAP client {0}. ",
        key: "5026"
    },
    {
        code: "5027",
        severity: "technError",
        text: "Inconsistent parameters; analysis path cannot be saved. Path ID: {0}, path name: {1}, callback function {2}"
    },
    {
        code: "5028",
        severity: "technError",
        text: "Binding with ID {0} contains a representation without ID."
    },
    {
        code: "5029",
        severity: "technError",
        text: "Binding with ID {0} contains a duplicated representation ID."
    },
    {
        code: "5030",
        severity: "technError",
        text: "Constructor property of representation type ID {0} does not contain a module path to a valid function."
    },
    {
        code: "5031",
        severity: "technError",
        text: "Argument for method 'setApplicationMessageCallback' is not a function."
    },
    {
        code: "5032",
        severity: "technError",
        text: "System query option {1} unknown in request for entity type {0}."
    },
    {
        code: "5033",
        severity: "technError",
        text: "Unsupported type {0} in configuration object provided."
    },
    {
        code: "5034",
        severity: "technError",
        text: "Facet filter configuration attribute 'property' missing."
    },
    {
        code: "5035",
        severity: "technError",
        text: "Function module path contained in property preselectionFuntion of facet filter ID {0} does not contain a valid function."
    },
    {
    	code: "5036",
    	severity: "technError",
    	text: "Start paramater step id {0} is not exisiting."
    },
    {
    	code: "5037",
    	severity: "technError",
    	text: "Start paramater representation id {0} is not exisiting."
    },
    {
    	code: "5038",
    	severity: "technError",
    	text: "Environment for sap.ushell.Container is not existing."
    },
    {
    	code: "5039",
    	severity: "technError",
    	text: "Error while pushing content to the ushell container"
    },
    {
    	code: "5040",
    	severity: "technError",
    	text: "Error while fetching content from the ushell container"
    },
    {
        code: "5100",
        severity: "fatal",
        description: "Unexpected internal error: {0}. Contact SAP.",
        key: "5100"
    },
    {
        code: "5101",
        severity: "technError",
        text: "Unexpected internal error: {0}. Contact SAP."
    },
    {
        code: "5102",
        severity: "fatal",
        description: "Wrong definition in analytical content configuration: {0}",
        key: "5102"
    },
    {
        code: "5103",
        severity: "technError",
        text: "Wrong definition in analytical content configuration."
    },
    {
        code: "5104",
        severity: "technError",
        text: "Wrong filter mapping definition in analytical content configuration"
    },
    {
        code: "5200",
        severity: "technError",
        text: "Server error during processing of path: {0} {1}"
    },
    {
        code: "5201",
        severity: "error",
        description: "Unknown server error.",
        key: "5201"
    },
    {
        code: "5202",
        severity: "technError",
        text: "Persistence service call returned '405 - Method not allowed'."
    },
    {
        code: "5203",
        severity: "technError",
        text: "Bad request; data is structured incorrectly."
    },
    {
        code: "5204",
        severity: "error",
        description: "Error during server request; maximum number of analysis steps exceeded.",
        key: "5204"
    },
    {
        code: "5205",
        severity: "error",
        description: "Error during server request; maximum number of analysis paths exceeded.",
        key: "5205"
    },
    {
        code: "5206",
        severity: "error",
        description: "Access forbidden; insufficient privileges",
        key: "5206"
    },
    {
        code: "5207",
        severity: "error",
        description: "Inserted value too large; probably maximum length of analysis path name exceeded",
        key: "5207"
    },
    {
        code: "5208",
        severity: "error",
        description: "Error during path persistence; request to server can not be proceed due to invalid ID.",
        key: "5208"
    },
    {
        code: "5210",
        severity: "error",
        description: "Error during opening of analysis path; see log.",
        key: "5210"
    },
    {
        code: "5211",
        severity: "error",
        description: "Server response contains undefined path objects.",
        key: "5211"
    },
    {
        code: "5300",
        severity: "fatal",
        description: "You must log out of the application due to a critical error.",
        key: "5300"
    },
    {
        code: "6001",
        severity: "fatal",
        description: "Missing {0} in the configuration; contact your administrator.",
        key: "6001"
    },
    {
        code: "6000",
        severity: "error",
        description: "Data is not available for the {0} step.",
        key: "6000"
    },
    {
        code: "6002",
        severity: "error",
        description: "Missing {0} for {1} in the configuration; contact your administrator.",
        key: "6002"
    },
    {
        code: "6003",
        severity: "error",
        description: "Missing {0} in the configuration; contact your administrator.",
        key: "6001"
    },
    {
        code: "6004",
        severity: "technError",
        text: "Metadata not available for step {0}."
    },
    {
        code: "6005",
        severity: "error",
        description: "Server request failed. Unable to read paths.",
        key: "6005"
    },
    {
        code: "6006",
        severity: "error",
        description: "Server request failed. Unable to save path {0}.",
        key: "6006"
    },
    {
        code: "6007",
        severity: "error",
        description: "Server request failed. Unable to update path {0}.",
        key: "6007"
    },
    {
        code: "6008",
        severity: "error",
        description: "Server request failed. Unable to open path {0}.",
        key: "6008"
    },
    {
        code: "6009",
        severity: "error",
        description: "Server request failed. Unable to delete path {0}.",
        key: "6009"
    },
    {
        code: "6010",
        severity: "error",
        description: "Data is not available for filter {0}",
        key: "6010"
    },
    {
        code: "6011",
        severity: "fatal",
        description: "Smart Business service failed.Please try later",
        key: "6011"
    },
    {
        code: "7000",
        severity: "error",
        description: "Missing {0} in the configuration; contact your administrator.",
        key: "6001"
    }
];

}; // end of sap/apf/core/messageDefinition.js
if ( !jQuery.sap.isDeclared('sap.apf.core.messageObject') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.messageObject");

/**
 * @public
 * @class The message object represents the APF specific message object for detailed evaluation. The message object shall be created by method {@link sap.apf.Api#createMessageObject}.
 * @name sap.apf.core.MessageObject
 * @param {object} oConfig 
 */
sap.apf.core.MessageObject = function (oConfig) {
	// private vars
	var sCode = oConfig.code;
	var aParameters = oConfig.aParameters || [];
	var oCallingObject = oConfig.oCallingObject;
	var sMessage = "";
	var sSeverity = "";
	var oPrevious;
	var dtTimestamp = new Date();
    var rawText = oConfig.rawText;
    /**
	 * @description Contains 'messageObject'
	 * @returns {string}
	 */
	this.type = "messageObject";
	// public function
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getCode
	 * @description Returns the message code.
	 * @returns {string}
	 */
	this.getCode = function () {
		return sCode;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#setCode
	 * @description Sets the code, that classifies the message.
	 * @param {string} code 
	 * @returns undefined
	 */
	this.setCode = function (code) {
		sCode = code;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#hasRawText
	 * @description Returns true, if a raw text is set. 
	 * @returns {boolean}
	 */
	this.hasRawText = function() {
		return (rawText !== undefined);
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getRawText
	 * @description Returns raw text. 
	 * @returns {string}
	 */
	this.getRawText = function() {
		return rawText;
	};

	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getMessage
	 * @description Returns the message text.
	 * @returns {string}
	 */
	this.getMessage = function () {
		return sMessage;
	};

	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#setMessage
	 * @description Sets the message text.
	 * @param {string} sTextMessage 
	 * @returns undefined
	 */
	this.setMessage = function (sTextMessage) {
		sMessage = sTextMessage;
	};

	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#setSeverity
	 * @description Sets the severity , which classifies the message.
     * @param {string} severity Only for to build in error messages. Allowed values are defined in {@link sap.apf.constants.severity}.
	 * @returns undefined
	 */
	this.setSeverity = function (severity) {
		sSeverity = severity;
	};

	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getSeverity
	 * @description Returns the severity.
	 * @returns {string}
	 */
	this.getSeverity = function () {
		return sSeverity;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#setPrevious
	 * @description Sets the previous message object. One can add a message object to this message object, that describes a previous message. 
	 * The message in the previous message object will also be displayed in the log (as previous entry). 
	 * @param {sap.apf.core.MessageObject} oPreviousMessageObject 
	 * @returns undefined
	 */
	this.setPrevious = function (oPreviousMessageObject) {
		oPrevious = oPreviousMessageObject;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getPrevious
	 * @description Gets the previous message object. 
	 * @returns {sap.apf.core.MessageObject} || undefined
	 */
	this.getPrevious = function () {
		return oPrevious;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getCallingObject
	 * @description Returns the calling object
	 * @returns {object}
	 */
	this.getCallingObject = function () {
		return oCallingObject;
	};

	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getParameters
	 * @description Returns the parameter which were passed over
	 * @returns {array}
	 */
	this.getParameters = function () {
		return aParameters;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getStack
	 * @description Returns the stack of the error object to get the line number and source file
	 * @returns {string}
	 */
	this.getStack = function () {
		if (this.stack) {
			return this.stack;
		} 
		return "";
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getTimestamp
	 * @description Returns the time stamp of the message object in seconds after 1970
	 * @returns {number}
	 */
	this.getTimestamp = function () {
		return dtTimestamp.getTime();
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getTimestampAsdateObject
	 * @description Returns the time stamp of the message object as a date
	 * @returns {date}
	 */
	this.getTimestampAsdateObject = function () {
		return dtTimestamp;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getJQueryVersion
	 * @description Returns the version of jQuery
	 * @returns {string}
	 */
	this.getJQueryVersion = function () {
		return jQuery().jquery;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.MessageObject#getSapUi5Version
	 * @description Returns the version of SAP UI5
	 * @returns {string}
	 */
	this.getSapUi5Version = function () {
		return sap.ui.version;
	};
	// private function
};
// set Prototype to get a JavaScript API Message Object
sap.apf.core.MessageObject.prototype = new Error();
sap.apf.core.MessageObject.prototype.constructor = sap.apf.core.MessageObject;

}; // end of sap/apf/core/messageObject.js
if ( !jQuery.sap.isDeclared('sap.apf.core.metadataFactory') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.metadataFactory");

/**
 * @class This class creates and manages metadata and entity type metadata instances. 
 * The class assures that there is a single metadata instance per service root and
 * that there is a single entity type metadata instance per service root and and entity type.
 */
sap.apf.core.MetadataFactory = function (oInject) {
	/**
	 * @description Returns type of metadataFactory.
	 * @returns {String}
	 */
	this.type = "metadataFactory";

    var that = this;
    var oMessageHandler = oInject.messageHandler;
    var oConfigurationFactory = oInject.configurationFactory;
    var fnHashtable = oInject.hashtable;
	var fnMetadata = oInject.metadata;
	var fnEntityTypeMetadata = oInject.entityTypeMetadata;
    var fnMetadataFacade = oInject.metadataFacade;
    var fnMetadataProperty = oInject.metadataProperty;

	//delete properties from oInject, which are not necessary to be transferred to metadata instances 
	delete oInject.metadata;
	delete oInject.entityTypeMetadata;
    delete oInject.metadataFacade;
    delete oInject.metadataProperty;
    delete oInject.configurationFactory;
	
	var oMetadataInstances = new fnHashtable(oMessageHandler);

	// Public functions
	/**
	 * @description Returns metadata object that represents metadata corresponding to the service document.
	 * @param {string} sAbsolutePathToServiceDocument Path to the service document
	 * @returns {sap.apf.core.Metadata}
	 */
	this.getMetadata = function (sAbsolutePathToServiceDocument) {
		var metadataCandidate;
		if (oMetadataInstances.hasItem(sAbsolutePathToServiceDocument) === false) {
			metadataCandidate = new fnMetadata(oInject, sAbsolutePathToServiceDocument);
			if(!metadataCandidate.failed) {
				oMetadataInstances.setItem(sAbsolutePathToServiceDocument, {
					metadata : metadataCandidate
				});
			} else {
				return;
			}
		}
		return oMetadataInstances.getItem(sAbsolutePathToServiceDocument).metadata;
	};
	/**
	 * @description Returns metadata object that represents metadata corresponding to the service document and an entity type that belongs to the service.
	 * @param {string} sAbsolutePathToServiceDocument Absolute path to the service document
	 * @param {string} sEntityType Entity type
	 * @returns {sap.apf.core.EntityTypeMetadata}
	 */
	this.getEntityTypeMetadata = function (sAbsolutePathToServiceDocument, sEntityType) {
		var oEntityTypes;
		var oMetadata = this.getMetadata(sAbsolutePathToServiceDocument);

		oEntityTypes = oMetadataInstances.getItem(sAbsolutePathToServiceDocument).entityTypes;
		if (!oEntityTypes) {
			oEntityTypes = new fnHashtable(oMessageHandler);
			oMetadataInstances.getItem(sAbsolutePathToServiceDocument).entityTypes = oEntityTypes;
		}
		if (!oEntityTypes.getItem(sEntityType)) {
			oEntityTypes.setItem(sEntityType, new fnEntityTypeMetadata(oMessageHandler, sEntityType, oMetadata));
		}
		return oEntityTypes.getItem(sEntityType);
	};
	/**
	 * @description Returns instance of {sap.apf.core.MetadataFacade}
	 * @returns {sap.apf.core.MetadataFacade}
	 */
    this.getMetadataFacade = function (sAbsolutePathToServiceDocument) {
            return new fnMetadataFacade({
                messageHandler : oMessageHandler,
                metadataProperty : sap.apf.core.MetadataProperty,
                metadataFactory : that
            }, sAbsolutePathToServiceDocument);
    };
    /**
	 * @description Returns service documents
	 * @returns {Array}
	 */
    this.getServiceDocuments = function () {
        return oConfigurationFactory.getServiceDocuments();
    };
    
    /**
	 * @description Returns all entity sets of service
	 * @returns {Array}
	 */
    this.getEntitySets = function(sService) {
    	var oMetadata = this.getMetadata(sService);
    	return oMetadata.getEntitySets();
    };
};

}; // end of sap/apf/core/metadataFactory.js
if ( !jQuery.sap.isDeclared('sap.apf.core.metadataProperty') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.metadataProperty");

/** 
 * @class Provides convenience functions for accessing attributes of a metadata property
 * @param {Object} oAttributes - Attributes (key value pairs) of a metadata property
 * @returns {sap.apf.core.MetadataProperty}
 */
sap.apf.core.MetadataProperty = function (oAttributes) {
	// Private vars
	var that = this;
	var bKey = false;
	var bParameterEntitySetKeyProperty = false;
	// Public functions
	/**
	 * @description If this property is a key, then a boolean true is returned. Otherwise, boolean false is returned. 
	 * @returns {Boolean}
	 */
	this.isKey = function (){
		return bKey;
	};
	/**
	 * @description If this property is a parameter key property, then a boolean true is returned. Otherwise, boolean false is returned. 
	 * @returns {boolean}
	 */
	this.isParameterEntitySetKeyProperty = function (){
		return bParameterEntitySetKeyProperty;
	};
	/**
	 * @description Returns the value for a given attribute. 
	 * @param {String} sName - Attribute name
	 * @returns {boolean|string|number} 
	 */
	this.getAttribute = function(sName){
		if(typeof this[sName] !== "function"){
			return this[sName];
		}
	};
	
	// Private functions
	/**
	 * @private
	 * @description Adds an attribute (key value pair) directly to itself. 
	 * If name already exists, the new value will be ignored. It is not possible to add an attribute with a method name of sap.apf.core.MetadataProperty. 
	 * @param {String} sName - Attribute name
	 * @param {String} value - Attribute value, which can be of type string, number or boolean
	 * @returns {sap.apf.core.MetadataProperty}
	 */
	function addAttribute(sName, value) {
		switch(sName){
		case "isKey":
			if(value === true){
				bKey = true;
			}
			break;
		case "isParameterEntitySetKeyProperty":
			if(value === true){
				bParameterEntitySetKeyProperty = true;
			}
			break;
		default: 
			if(typeof that[sName] !== "function"){
				that[sName] = value; 
			}
		}
		return that;
	};
	
	function initialize(){
		for(var name in oAttributes){
			switch (name) {
				case "dataType":
					for(var dataTypeName in oAttributes.dataType){
						addAttribute(dataTypeName, oAttributes.dataType[dataTypeName]);
					}
					break;
				default:
					addAttribute(name, oAttributes[name]);
				}
		}
	}
	initialize();
};
}; // end of sap/apf/core/metadataProperty.js
if ( !jQuery.sap.isDeclared('sap.apf.core.path') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.path");

/**
 * @private
 * @class Holds the order and state of the Step instances within the analysis path. The methods, that change the path or get state of the path
 * shall be called through the APF api (@see sap.apf.Api). The path is automatically created at startup of the APF.
 * @param oInject.messageHandler {sap.apf.core.MessageHandler} MessageHandler
 * @param oInject.coreApi {sap.apf.core.Instance} core API
 * @name sap.apf.core.Path
 */
sap.apf.core.Path = function(oInject) {

	// Public vars
	this.type = "path";

	// Private vars
    var oMessageHandler = oInject.messageHandler;
    var oCoreApi = oInject.coreApi;
	var that = this;
	var aStepInstances = [];
	var aActiveSteps = [];
	var nUpdateCounter = 0;

	// Public functions
	/**
	 * @function
	 * @name sap.apf.core.Path.getSteps
	 * @description Gets the ordered sequence of all steps in an analysis path.
	 * The array is cloned such that the internal state of the path cannot be manipulated directly.
	 * Each step return a referenced to the object in the path. 
	 * Each step shall always be identified by the reference to its step object, 
	 * e.g. in methods like removeStep, moveStepToPosition, setActiveSteps, etc.
	 * @return copied array of steps
	 */
	this.getSteps = function() {
		return jQuery.extend(true, [], aStepInstances);
	};
	/**
	 * @function
	 * @name sap.apf.core.Path.addStep
	 * @description Adds a step to the analysis path. Has to be called by APF api.
	 * @param oStep
	 *            reference of the step which shall be added to the analysis
	 *            path
	 */
	this.addStep = function(oStep, fnStepProcessedCallback) {
		aStepInstances.push(oStep);
		var oStartFilter;
		that.update(fnStepProcessedCallback);
	};

	/**
	 * @description Sets a step as an active step in the path.
	 * @param oStep The step to be set active. The step has to be a member of the path, if not, an error will be thrown. A step may already be active. 
	 */
	this.makeStepActive = function(oStep) {
		var bStepIsInPath = this.stepIsInPath(oStep);
		oMessageHandler.check(bStepIsInPath, "An unknown step can't be an active step.", sap.apf.core.constants.message.code.errorCheckWarning);
		if (bStepIsInPath) {
			if (this.stepIsActive(oStep) === false) {
				aActiveSteps.push(oStep);
			}
		}
	};

	/**
	 * @description removes an active step
	 * @param oStep
	 *            step reference of step which shall become inactive
	 */
	this.makeStepInactive = function(oStep) {
		var bStepIsActive = this.stepIsActive(oStep);
		oMessageHandler.check(bStepIsActive, "Only an active step can be removed from the active steps.", sap.apf.core.constants.message.code.errorCheckWarning);

		if (bStepIsActive) {
			var indexOfStep = jQuery.inArray(oStep, aActiveSteps);
			aActiveSteps.splice(indexOfStep, 1);
		}
	};

	/**
	 * @description Checks whether a step is active
	 * @param oStep Step reference
	 * @returns boolean
	 */
	this.stepIsActive = function(oStep) {
		var indexOfStep = jQuery.inArray(oStep, aActiveSteps);
		if (indexOfStep >= 0) {
			return true;
		} else {
			return false;
		}
	};

	/**
	 * @description checks whether a step is in the path
	 * @param oStep
	 *            step reference
	 * @returns boolean
	 */
	this.stepIsInPath = function(oStep) {
		var indexOfStep = jQuery.inArray(oStep, aStepInstances);
		if (indexOfStep >= 0) {
			return true;
		} else {
			return false;
		}
	};
	/**
	 * @description Gets all active steps in an analysis path. 
	 * @return array of steps
	 */
	this.getActiveSteps = function() {
		return jQuery.extend(true, [], aActiveSteps);
	};
	/**
	 * @description The cumulative filter up to the active step (inclusive) is returned
	 * @returns {sap.apf.core.utils.Filter} cumulativeFilter
	 */
	this.getCumulativeFilterUpToActiveStep = function() {
		var oContextFilter = oCoreApi.getContext();
		var oCumulatedFilter = oContextFilter.getInternalFilter().copy();
		var i, len = aStepInstances.length;
		for (i = 0; i < len; i++) {
			
			oCumulatedFilter = oCumulatedFilter.addAnd(aStepInstances[i].getFilter());
			if (that.stepIsActive(aStepInstances[i])) {
				return oCumulatedFilter;
			}
		}
		return oCumulatedFilter;  
	};
	/**
	 * @description Moves a step in the analysis path to the specified target position. 
	 * @param oStep The step object to be moved
	 * @param nPosition The target position. Must be a valid position in the path, between zero and length-1.
	 * @param fnStepProcessedCallback Callback for update of steps.
	 */
	this.moveStepToPosition = function(oStep, nPosition, fnStepProcessedCallback) {
		var nIndexOfStep = jQuery.inArray(oStep, aStepInstances);
		var targetPosition = nPosition;
		var oMessageObject;
		// the step to be moved must be a step of the path
		oMessageHandler.check(typeof nPosition === "number" && nPosition >= 0 && nPosition < aStepInstances.length, "Path: moveStepToPosition invalid argument for nPosition");
		oMessageHandler.check(nIndexOfStep >= 0 && nIndexOfStep < aStepInstances.length, "Path: moveStepToPosition invalid step");
		if (nIndexOfStep === nPosition) {
			return;
		}

		aStepInstances.splice(nIndexOfStep, 1);
		aStepInstances.splice(targetPosition, 0, oStep);
		this.update(fnStepProcessedCallback);
	};

	/**
	 * @description Removes a step from the analysis path.  
	 * @param oStep The step object to be removed. The reference must be an object contained in the path. Otherwise, an error will be thrown.  
	 * @param fnStepProcessedCallback Callback for update of steps.
	 */
	this.removeStep = function(oStep, fnStepProcessedCallback) {
		var bStepIsInPath = this.stepIsInPath(oStep);
		var bStepIsActive = this.stepIsActive(oStep);
		var nIndexOfStep = jQuery.inArray(oStep, aStepInstances);
		var oMessageObject;

		// the step to be removed must be a step of the path
		oMessageHandler.check(bStepIsInPath, "Path: remove step - invalid step");
		aStepInstances.splice(nIndexOfStep, 1);
		if (bStepIsActive) {
			this.makeStepInactive(oStep);
		}
		this.update(fnStepProcessedCallback);
	};

	/**
	 * @description The steps in the path will be updated. First it is detected,  whether a representation (chart) of a step 
	 * has changed its selection. If yes, then all subsequent steps will get  a new (cumulated) selection for retrieving data. 
	 * If a step has a new cumulated selection for retrieving data, then
	 * an OData request is executed for the particular step and the representation receives new data.
	 * @param {function} fnStepProcessedCallback is a callback function. This callback function is executed for every step in the path.
	 * The first argument of the callback function is the step instance. The second argument is a flag, that indicates, whether there was 
	 * an update or not.
	 * @param {boole} bContextChanged indicates, that the context has been changed
	 */
	this.update = function(fnStepProcessedCallback, bContextChanged) {
		if (!aStepInstances[0]) {
			return;
		}
		var nCurrentUpdateCount;
		var oCurrentStep = aStepInstances[0];
		var oContextFilter = oCoreApi.getContext();
		var oCumulatedFilter = oContextFilter.getInternalFilter().copy();

		if (bContextChanged === true) {
			return;
		}

		nUpdateCounter++;
		nCurrentUpdateCount = nUpdateCounter;
		oCurrentStep.update(oCumulatedFilter, callbackAfterRequest);

		function callbackAfterRequest(oResponse, bStepNotUpdated) {
			var nIndexOfCurrentStep = jQuery.inArray(oCurrentStep, aStepInstances);
			var oMessageObject;

			if (nCurrentUpdateCount === nUpdateCounter) {
				// handle the error
				if (oResponse instanceof Error) {

					var nStepNumberForDisplay = nIndexOfCurrentStep + 1;
					oMessageObject = oMessageHandler.createMessageObject({
						code : "5002",
						aParameters : [ nStepNumberForDisplay ],
						callingObject : oCurrentStep
					});
					oMessageObject.setPrevious(oResponse);

					oMessageHandler.putMessage(oMessageObject);
					oCurrentStep.setData({ data : [], metadata : undefined}, oCumulatedFilter);
					fnStepProcessedCallback(oCurrentStep, true);
					nIndexOfCurrentStep++;
					oCurrentStep = aStepInstances[nIndexOfCurrentStep];
					while (oCurrentStep) {
						oCurrentStep.setData({ data : [], metadata : undefined}, oCumulatedFilter);
						fnStepProcessedCallback(oCurrentStep, true);
						nIndexOfCurrentStep++;
						oCurrentStep = aStepInstances[nIndexOfCurrentStep];
					}
					return;
				}

				if (!bStepNotUpdated) {
					oCurrentStep.setData(oResponse, oCumulatedFilter);
				}
				fnStepProcessedCallback(oCurrentStep, !bStepNotUpdated);
				oCurrentStep.determineFilter(oCumulatedFilter.copy(), callbackFromStepFilterProcessing);
			}
		}
			
		function callbackFromStepFilterProcessing(oFilter)	 {
			var nIndexOfCurrentStep = jQuery.inArray(oCurrentStep, aStepInstances);
			
		    oCumulatedFilter.addAnd(oFilter);
				
			oCurrentStep = aStepInstances[nIndexOfCurrentStep + 1];
			if (oCurrentStep) {
				oCurrentStep.update(oCumulatedFilter, callbackAfterRequest);
			}
		}
	};
	/**
	 * @description Returns the path as serializable object containing the steps,  and the indices of the active steps. 
	 * @returns {object} Serializable path in the following format: { path : { steps: [serializableSteps],  indicesOfActiveStep:[num] }, context:serializableFilter}.
	 */
	this.serialize = function() {
		return {
			path : {
				steps : getSerializedSteps(),
				indicesOfActiveSteps : getIndicesOfActiveSteps()
			}	
		}; 
	};
	/**
	 * @description Restores a path with the information given in a serializable path object. 
	 * @param {object} oSerializablePath Serializable path in the following format: { path : { steps: [serializableSteps],  indicesOfActiveStep:[num] }, context:serializableFilter}.
	 * @returns undefined
	 */
	this.deserialize = function(oSerializablePath) {
		var oContextFilter;
		if(oSerializablePath.context) {
		    oContextFilter = new sap.apf.utils.Filter(oMessageHandler);
		    oContextFilter.deserialize(oSerializablePath.context);
		    oCoreApi.setContext(oContextFilter);
		}
		addStepsToPathAndDeserialize(oSerializablePath.path.steps, this);
		makeStepsActive(oSerializablePath.path.indicesOfActiveSteps, this);
	};

	// private functions
	function getIndicesOfActiveSteps() {
		var aIndicesOfActiveSteps = [];
		for( var i = 0; i < aStepInstances.length; i++) {
			for( var j = 0; j < aActiveSteps.length; j++) {
				if (aStepInstances[i] === aActiveSteps[j]) {
					aIndicesOfActiveSteps.push(i);
				}
			}
		}
		return aIndicesOfActiveSteps;
	}

	function getSerializedSteps() {
		var aSerializedSteps = [];
		for( var i = 0; i < aStepInstances.length; i++) {
			aSerializedSteps.push(aStepInstances[i].serialize());
		}
		return aSerializedSteps;
	}

	function addStepsToPathAndDeserialize(aSerializedSteps, oContext) {
		//deactivate update during deserialization
		var fnSave = oContext.update;
		oContext.update = function() {
		};
		var i = 0;
		for(i = 0; i < aSerializedSteps.length; i++) {
			oCoreApi.createStep(aSerializedSteps[i].stepId);
		}
		for(i = 0; i < aStepInstances.length; i++) {
			aStepInstances[i].deserialize(aSerializedSteps[i]);
		}

		//activate update after deserialization
		oContext.update = fnSave; 
	}
	function makeStepsActive(aIndicesOfActiveSteps, oContext) {
		for( var i = 0; i < aIndicesOfActiveSteps.length; i++) {
			var nIndex = aIndicesOfActiveSteps[i];
			oContext.makeStepActive(aStepInstances[nIndex]);
		}
	}
};

}; // end of sap/apf/core/path.js
if ( !jQuery.sap.isDeclared('sap.apf.core.persistence') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.persistence");
 

/**
 * @class Persistence storing paths on server side
 * @returns {sap.apf.core.Persistence}
 */
sap.apf.core.Persistence = function(oInject) {
	
	/**
	 * @description Creates a data object based on the state of the current path and stores it on the server.
	 * @param {string} sName Name of the path.
	 * @param {function} fnCallback(oResponse, oEntityMetadata, oMessageObject)
     * @param {object} [oExternalObject] Object containing non-core objects to be serialized
     * @param {object} [oExternalObject.pathContextHandler] Serializable PathContextHandler
	 */
	this.createPath = function(sName, fnCallback, oExternalObject) {
		var oSerializablePath = oInject.coreApi.serializePath();
        if(oExternalObject){
            oSerializablePath.pathContextHandler = oExternalObject.pathContextHandler;
        }
		var oStructuredPath = getStructuredAnalysisPath(oSerializablePath);
		
		var oRequest = {
				data : {
					AnalysisPath : "",
					AnalysisPathName : sName,
					LogicalSystem : oInject.coreApi.getLogicalSystem(),
					ApplicationConfigurationURL : oInject.coreApi.getApplicationConfigurationURL(),
					SerializedAnalysisPath : JSON.stringify(oSerializablePath),
					StructuredAnalysisPath : JSON.stringify(oStructuredPath)
				},
				method : "POST"
		};
		if(oInject.coreApi.getStartParameterFacade().getAnalyticalConfigurationId()) {
			oRequest.data.AnalyticalConfiguration = oInject.coreApi.getStartParameterFacade().getAnalyticalConfigurationId();
		}
		sendRequest(oRequest, fnRequestCallback.bind(this));
		
		function fnRequestCallback(oResponse, oEntityTypeMetadata, oMessageObject) {
			if(oMessageObject) {
				fnCallback({ oResponse : oResponse, status: "failed"}, oEntityTypeMetadata, oMessageObject);
			} else {
				oInject.messageHandler.check(oResponse && oResponse.data && oResponse.statusCode === 201 && oResponse.statusText === "Created", "Persistence create Path - proper response");
				fnCallback({ AnalysisPath : oResponse.data.AnalysisPath, status: "successful"}, oEntityTypeMetadata, oMessageObject);				
			}
		}
	};
	
	/**
	 * @description Reads all stored paths from server.
	 * @param {function} fnCallback This callback function is called after function readPaths has been executed.
	 * @param {function} fnCallback(oResponse, oEntitiyMetadata, oMessageObject) 
	 */
	this.readPaths = function(fnCallback) {		
		var oRequest = {
				method : "GET"
		};
		sendRequest(oRequest, fnRequestCallback.bind(this));
		
		function fnRequestCallback(oResponse, oEntityTypeMetadata, oMessageObject) {
			if(!oMessageObject && oResponse && oResponse.data && oResponse.data.results) {
				for( var i in oResponse.data.results) {
					oResponse.data.results[i].StructuredAnalysisPath = JSON.parse(oResponse.data.results[i].StructuredAnalysisPath);
				}
			} else if(!oMessageObject || oResponse.statusCode !== 200 || oResponse.statusText !== "OK" ) {
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5211'
				});	
			}
			if(oMessageObject) {
				fnCallback({ oResponse : oResponse, status: "failed"}, oEntityTypeMetadata, oMessageObject);
			} else {
				fnCallback({ paths : oResponse.data.results, status: "successful" }, oEntityTypeMetadata, oMessageObject);			
			}
		}
	};
	
	/**
	 * @description Deletes a path. 
	 * @param {String} sAnalysisPathId GUID to identify the path
	 * @param {function} fnCallback(oResponse, oEntitiyMetadata, oMessageObject) 
	 */
	this.deletePath = function(sAnalysisPathId, fnCallback) {
		var oRequest = {
				method : "DELETE"
		};
		sendRequest(oRequest, fnRequestCallback.bind(this), sAnalysisPathId);
		
		function fnRequestCallback(oResponse, oEntityTypeMetadata, oMessageObject) {
			if ((oResponse.statusCode !== 204 || oResponse.statusText !== "No Content" ) && (!oMessageObject)) {
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : 5201
				});
				oMessageObject.setPrevious(oInject.messageHandler.createMessageObject({
					code : 5200,
					aParameters : [oResponse.statusCode, oResponse.statusText]
				}));
			}
			if(oMessageObject) {
				fnCallback({ oResponse : oResponse, status: "failed"}, oEntityTypeMetadata, oMessageObject);
			} else {
				fnCallback({ status: "successful" }, oEntityTypeMetadata, oMessageObject);
			}
		}
	};
	
	/**
	 * @description Modifies a data object based on the state of the current path and overwrites the old path on the server. 
	 * @param {String} sAnalysisPathId GUID to identify the path
	 * @param {String} sName name of the path
	 * @param {function} fnCallback(oResponse, oEntitiyMetadata, oMessageObject)
     * @param {object} [oExternalObject] Object containing non-core objects to be serialized
     * @param {object} [oExternalObject.pathContextHandler] Serializable PathContextHandler
	 */
	this.modifyPath = function(sAnalysisPathId, sName, fnCallback, oExternalObject) {
		var oSerializablePath = oInject.coreApi.serializePath();
        if(oExternalObject){
            oSerializablePath.pathContextHandler = oExternalObject.pathContextHandler;
        }
		var oStructuredPath = getStructuredAnalysisPath(oSerializablePath);
		var oRequest = {
				data : {
					AnalysisPathName : sName,
					LogicalSystem : oInject.coreApi.getLogicalSystem(),
					ApplicationConfigurationURL : oInject.coreApi.getApplicationConfigurationURL(),
					SerializedAnalysisPath : JSON.stringify(oSerializablePath),
					StructuredAnalysisPath : JSON.stringify(oStructuredPath)
				},
				method : "PUT"
		};
		sendRequest(oRequest, fnRequestCallback.bind(this), sAnalysisPathId);
		
		function fnRequestCallback(oResponse, oEntityTypeMetadata, oMessageObject) {
			 if ((oResponse.statusCode !== 204 || oResponse.statusText !== "No Content") && (!oMessageObject)) {
					oMessageObject = oInject.messageHandler.createMessageObject({
						code : 5201
					});
					oMessageObject.setPrevious(oInject.messageHandler.createMessageObject({
						code : 5200,
						aParameters : [oResponse.statusCode, oResponse.statusText]
					}));
			 }
			 if(oMessageObject) {
				fnCallback({ oResponse : oResponse, status: "failed"}, oEntityTypeMetadata, oMessageObject);
			 } else {
				fnCallback({ AnalysisPath : sAnalysisPathId,  status: "successful" }, oEntityTypeMetadata, oMessageObject);
			 }
		}
	};
	
	/**
	 * @description Gets the stored path and deserializes it in the runtime environment. As a result, the current path is replaced
	 * by the path, that has been loaded from the server.
	 * @param {String} sAnalysisPathId GUID to identify the path
	 * @param {function} fnCallback(oResponse, oEntitiyMetadata, oMessageObject) 
	 * @param {Number} nActiveStep active step of current path
	 */
	this.openPath = function(sAnalysisPathId, fnCallback, nActiveStep) {
		var oRequest = {
				method : "GET"
		};		
		sendRequest(oRequest, fnRequestCallback.bind(this), sAnalysisPathId);
		
		function fnRequestCallback(oResponse, oEntityTypeMetadata, oMessageObject) {
			var oMessageObjectForUI;
			if(!oMessageObject && oResponse && oResponse.statusCode === 200 && oResponse.data && oResponse.data.SerializedAnalysisPath) {
				oResponse.data.SerializedAnalysisPath = JSON.parse(oResponse.data.SerializedAnalysisPath);
				oMessageObject = createPathFromReceivedData(oResponse.data, nActiveStep);	
			}
			if (oMessageObject) {
				oMessageObjectForUI = oInject.messageHandler.createMessageObject({
					code : '5210'
				});
				oMessageObjectForUI.setPrevious(oMessageObject);
				oInject.messageHandler.putMessage(oMessageObjectForUI);
			}
			if(oMessageObjectForUI) {
				fnCallback({ oResponse : oResponse, status: "failed"}, oEntityTypeMetadata, oMessageObjectForUI);
			} else {
				fnCallback( { path : oResponse.data,  status: "successful" }, oEntityTypeMetadata, oMessageObjectForUI);
			}
		}
	};

	function sendRequest(oRequest, fnLocalCallback, sAnalysisPathId) {
		var sUrl = getPersistenceServiceUrl();
		switch(oRequest.method) {
		case "GET":
			if(!oRequest.data && sAnalysisPathId) {
				oRequest.requestUri = sUrl + "('" + sAnalysisPathId + "')";	
			} else if(!oRequest.data && !sAnalysisPathId) {
				oRequest.requestUri = sUrl + getUrlForReadPaths();	
			}
			break;
		case "POST":
			if(oRequest.data && !sAnalysisPathId) {
				oRequest.requestUri = sUrl;
			}
			break;
		case "DELETE":
			if(!oRequest.data && sAnalysisPathId) {
				oRequest.requestUri = sUrl + "('" + sAnalysisPathId + "')";				
			}
			break;
		case "PUT":
			if(oRequest.data && sAnalysisPathId) {
				oRequest.requestUri = sUrl + "('" + sAnalysisPathId + "')";
			}
			break;
		default:
			break;
		}
		oRequest.headers = {
			"x-csrf-token" : oInject.coreApi.getXsrfToken(getPersistenceServiceUrl())
		};
		var fnSuccess = function(oData, oResponse) {
			fnLocalCallback(oResponse, getMetadata(), undefined);
		};
		var fnError = function(oError) {
			var oMessageObject;
			if(oError.messageObject && oError.messageObject.getCode && oError.messageObject.getCode() === 5021) { // timeout
				fnLocalCallback(oError, getMetadata(), oError.messageObject);
				return;
			}
			var sServerSideCode = checkForErrorCode(oError.response.body); // server side error code check				
			if (sServerSideCode !== undefined){
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : sServerSideCode
				});
			}
			if(oError.response.body.match("274")) { // Inserted value too large; probably maximum length of analysis path name exceeded
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5207'
				});
			}
			if(oError.response.statusCode === 400) { // Bad request; data is structured incorrectly
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5203'
				});
			}
			if(oError.response.statusCode === 403) { // Access forbidden; insufficient privileges
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5206'
				});
			}
			if(oError.response.statusCode === 405) { // Method not allowed; probably incorrect URL parameter.
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5202'
				});
			}
			if (oError.response.statusCode === 404) { // Error during path persistence; request to server can not be proceed due to invalid ID
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5208'
				});
			}
			if(!oMessageObject && oError.response.statusCode === 500) { // Server error during processing a path: {0} {1}
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5200',
					aParameters : [ oError.response.statusCode, oError.response.statusText ]
				});
			}
			if(!oMessageObject) { // Unknown server error
				oMessageObject = oInject.messageHandler.createMessageObject({
					code : '5201'
				});
			}
			oInject.messageHandler.putMessage(oMessageObject);
			// signature: oResponse, oEntityTypeMetadata, oMessageObject
			fnLocalCallback(oError, getMetadata(), oMessageObject);
		};
		oInject.coreApi.odataRequest(oRequest, fnSuccess, fnError);
	}
	
	function getUrlForReadPaths() {
		var analyticalConfigurationInURL = "";
		if(oInject.coreApi.getStartParameterFacade().getAnalyticalConfigurationId()) {
			analyticalConfigurationInURL = "AnalyticalConfiguration%20eq%20'"+oInject.coreApi.getStartParameterFacade().getAnalyticalConfigurationId()+"'%20and%20";
		}
		var urlForReadPaths = "?$select=AnalysisPath,AnalysisPathName,StructuredAnalysisPath,CreationUTCDateTime,LastChangeUTCDateTime&$filter=(" +
		analyticalConfigurationInURL +
		"LogicalSystem%20eq%20'"+oInject.coreApi.getLogicalSystem()+"'%20and%20" +
		"ApplicationConfigurationURL%20eq%20'"+oInject.coreApi.getApplicationConfigurationURL()+"')" +
		"&$orderby=LastChangeUTCDateTime%20desc";
		return urlForReadPaths;
	}

	function checkForErrorCode(oError) {
		var errorCode = oError.match("52[0-9]{2}");
		if(errorCode) {
			return errorCode[0]; 
		} else {
			return undefined;
		}
	}
	function createPathFromReceivedData(oReceivedData, nActiveStep) {
		var fnPutMessageOrig;
		var oMessageObject;
		var oOriginalContext = oInject.coreApi.getContext();

		function restorePutMessage() {
			oInject.messageHandler.putMessage = fnPutMessageOrig;
		}
		function redefinePutMessage() {
			fnPutMessageOrig = oInject.messageHandler.putMessage;
			oInject.messageHandler.putMessage = function(oMessageObject) {
				throw oMessageObject;
			};
		}
		if (nActiveStep !== undefined) {
			oReceivedData.SerializedAnalysisPath.path.indicesOfActiveSteps[0] = nActiveStep;
		}
		oInject.coreApi.resetPath(true);
		redefinePutMessage();
		try {
			oInject.coreApi.deserializePath(oReceivedData.SerializedAnalysisPath);
		} catch (oError) {
			oInject.coreApi.restoreOriginalPath();
			oInject.coreApi.setContext(oOriginalContext);
			oMessageObject = convertErrorToMessageObject(oError);
		} finally {
			restorePutMessage();
		}
		return oMessageObject;
	}
	function convertErrorToMessageObject(oError) {
		var oMessageObject;
		if (oError.type && oError.type === "messageObject") {
			oMessageObject = oError;
		} else {
			oMessageObject = new oInject.coreApi.MessageObject({
				code : sap.apf.core.constants.message.code.errorUnknown
			//configure in message definition
			});
			oMessageObject.setSeverity(sap.apf.core.constants.message.severity.error);
			oMessageObject.setMessage("Unknown exception caught " + oError.message);
		}
		return oMessageObject;
	}
	function getPersistenceServiceUrl() {
		var oPersistencePathConfig = oInject.coreApi.getPersistenceConfiguration().path;
		var sService = oPersistencePathConfig.service + "/" +  oPersistencePathConfig.entitySet;
		return sService;
	}
	function getStructuredAnalysisPath(oSerializablePath) {
		var aStructuredSteps = [];
		var aSteps = oSerializablePath.path.steps;
		var StructuredAnalysisPath;
		for( var i in aSteps) {
			aStructuredSteps.push({
				stepId : aSteps[i].stepId,
				selectedRepresentationId : aSteps[i].binding.selectedRepresentationId
			});
		}
		StructuredAnalysisPath = {
			steps : aStructuredSteps,
			indexOfActiveStep : oSerializablePath.path.indicesOfActiveSteps[0]
		};
		return StructuredAnalysisPath;
	}
	function getMetadata() {
		var oConfig = oInject.coreApi.getPersistenceConfiguration();
		var oEntityTypeMetadata = oInject.coreApi.getEntityTypeMetadata(oConfig.path.service, oConfig.path.entitySet);
		return oEntityTypeMetadata;
	}
};

}; // end of sap/apf/core/persistence.js
if ( !jQuery.sap.isDeclared('sap.apf.core.representationTypes') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.representationTypes");

/**
 * @memberOf sap.apf.core
 * @description Default configuration of representation types. Can be overwritten in the analytical configuration file.
 * @returns {object[]} representation types array with configuration objects for representation types
 */
sap.apf.core.representationTypes = function() {

	return [
			{
				"type" : "representationType",
				"id" : "ColumnChart",
				"constructor" : "sap.apf.ui.representations.columnChart",
				"picture" : "sap-icon://bar-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "ColumnChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.LEGEND,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "*"
						} ]
					}
				}
				
			},
			{
				"type" : "representationType",
				"id" : "LineChart",
				"constructor" : "sap.apf.ui.representations.lineChart",
				"picture" : "sap-icon://line-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "LineChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.LEGEND,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "*"
						} ]
					}
				}
			},
			{
				"type" : "representationType",
				"id" : "StackedColumnChart",
				"constructor" : "sap.apf.ui.representations.stackedColumnChart",
				"picture" : "sap-icon://vertical-stacked-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "StackedColumnChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.LEGEND,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "*"
						} ]
					}
				}
			},
			{
				"type" : "representationType",
				"id" : "PercentageStackedColumnChart",
				"constructor" : "sap.apf.ui.representations.percentageStackedColumnChart",
				"picture" : "sap-icon://full-stacked-column-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "PercentageStackedColumnChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.LEGEND,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "*"
						} ]
					}
				}
			},
			{
				"type" : "representationType",
				"id" : "PieChart",
				"constructor" : "sap.apf.ui.representations.pieChart",
				"picture" : "sap-icon://pie-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "PieChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.SECTORCOLOR,
							"min" : "1",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.SECTORSIZE,
							"min" : "1",
							"max" : "1"
						} ]
					}
				}
			},
			{
				"type" : "representationType",
				"id" : "ScatterPlotChart",
				"constructor" : "sap.apf.ui.representations.scatterPlotChart",
				"picture" : "sap-icon://scatter-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "ScatterPlotChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.REGIONCOLOR,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.REGIONSHAPE,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "1"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "1"
						} ]
					},
					"sortable" : false
				}
			},
			{
				"type" : "representationType",
				"id" : "BubbleChart",
				"constructor" : "sap.apf.ui.representations.bubbleChart",
				"picture" : "sap-icon://bubble-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "BubbleChart"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.REGIONCOLOR,
							"min" : "1",
							"max" : "*"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.REGIONSHAPE,
							"min" : "0",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.XAXIS,
							"min" : "1",
							"max" : "1"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.YAXIS,
							"min" : "1",
							"max" : "1"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.BUBBLEWIDTH,
							"min" : "1",
							"max" : "1"
						}, {
							"kind" : sap.apf.core.constants.representationMetadata.kind.BUBBLEHEIGHT,
							"min" : "0",
							"max" : "1"
						} ]
					},
					"sortable" : false
				}
			},
			{
				"type" : "representationType",
				"id" : "TableRepresentation",
				"constructor" : "sap.apf.ui.representations.table",
				"picture" : "sap-icon://table-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "TableRepresentation"
				},
				"metadata" : {
					"dimensions" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.COLUMN,
							"min" : "1",
							"max" : "*"
						} ]
					},
					"measures" : {
						"supportedKinds" : [ {
							"kind" : sap.apf.core.constants.representationMetadata.kind.COLUMN,
							"min" : "1",
							"max" : "*"
						} ]
					}
				}
			},
			{
				"type" : "representationType",
				"id" : "ColumnChartSorted",
				"constructor" : "sap.apf.ui.representations.columnChart",
				"picture" : "sap-icon://vertical-bar-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "ColumnChartSorted"
				}
			},
			{
				"type" : "representationType",
				"id" : "ColumnChartClustered",
				"constructor" : "sap.apf.ui.representations.columnChart",
				"picture" : "sap-icon://bar-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "ColumnChartClustered"
				}
			},
			{
				"type" : "representationType",
				"id" : "ColumnChartClusteredSorted",
				"constructor" : "sap.apf.ui.representations.columnChart",
				"picture" : "sap-icon://vertical-bar-chart-2",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "ColumnChartClusteredSorted"
				}
			},	
			{
				"type" : "representationType",
				"id" : "StackedColumnSorted",
				"constructor" : "sap.apf.ui.representations.stackedColumnChart",
				"picture" : "sap-icon://upstacked-chart",
				"label" : {
					"type" : "label",
					"kind" : "text",
					"key" : "StackedColumnSorted"
				}
			}];

};

}; // end of sap/apf/core/representationTypes.js
if ( !jQuery.sap.isDeclared('sap.apf.core.utils.checkForTimeout') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */


jQuery.sap.declare('sap.apf.core.utils.checkForTimeout');


/**
 * @description tests, whether the server response is time out. Returns a message object in case of time out.
 * @param {object} oServerResponse
 * @returns {sap.apf.core.MessageObject|undefined}
 */
sap.apf.core.utils.checkForTimeout = function(oServerResponse) {
	var status;
	var oMessage;
	var redirect = false;
	//OData timeout redirect xse
	if(oServerResponse && oServerResponse.headers && oServerResponse.headers['x-sap-login-page']){
		redirect = true;
	}
	//ajax timeout redirect xse
	if(oServerResponse && oServerResponse.getResponseHeader && oServerResponse.getResponseHeader('x-sap-login-page') !== null) {
		redirect = true;
	}
	//set status code from OData Response
	if (oServerResponse && oServerResponse.status) {
		status = oServerResponse.status;
	}
	//set status code from Ajax Response
	if (oServerResponse && oServerResponse.response && oServerResponse.response.statusCode) {
		status = oServerResponse.response.statusCode;
	}
	if (status === 303 || status === 401 || status === 403 || redirect) {
		oMessage = new sap.apf.core.MessageObject({
			code : "5021"
		});
	}
	return oMessage;
};


}; // end of sap/apf/core/utils/checkForTimeout.js
if ( !jQuery.sap.isDeclared('sap.apf.core.utils.fileExists') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap */

jQuery.sap.declare('sap.apf.core.utils.fileExists');

/**
 * @description Checks, whether a file with given fully specified path exists on server. Address must be valid URL.
 * @param {string} sUrl path to file on server 
 * @returns {boole}
 */
sap.apf.core.utils.fileExists = function(sUrl) {
	var bFileExists = false;
	jQuery.ajax({
		url : sUrl,
		type : "HEAD",
		success : function(oData, sStatus, oJqXHR) {
			var oMessage = sap.apf.core.utils.checkForTimeout(oJqXHR);
			bFileExists = !oMessage;
		},
		error : function() {
			bFileExists = false;
		},
		async : false
	});
	return bFileExists;
};

}; // end of sap/apf/core/utils/fileExists.js
if ( !jQuery.sap.isDeclared('sap.apf.core.utils.uriGenerator') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.utils.uriGenerator");

/**
 * @descriptions Module for uri generation and location helper functions for the resource location
 */
sap.apf.core.utils.uriGenerator = {};

/**
 * @memberOf sap.apf.core.utils.uriGenerator
 * @description Returns the absolute URL path of the service root. The slash as last character is fixed, if not existing.
 * @param {String} sPathToRoot Absolute Path to the service root like /sap/hba/apps/wca/s/odata/wca.xsodata/ .
 * @returns {String}
 */
sap.apf.core.utils.uriGenerator.getAbsolutePath = function(sPathToRoot) {
	if (sPathToRoot.slice(-1) === '/') {
		return sPathToRoot;
	} else {
		return sPathToRoot + "/";
	}
};

/**
 * @memberOf sap.apf.core.utils.uriGenerator
 * @param {string} sPathToServiceDocument 
 * @description Returns the relative url path of the oadata service.
 * @returns {String}
 */
sap.apf.core.utils.uriGenerator.getODataPath = function(sPathToServiceDocument) {
	var aSplitt = sPathToServiceDocument.split('/');
	var i;
	var aSplittContent = [];
	for(i = 0; i < aSplitt.length; i++) {
		if (aSplitt[i] !== "") {
			aSplittContent.push(aSplitt[i]);
		}
	}
	var sReturn = '';
	var len = aSplittContent.length - 1;
	for(i = 0; i < len; i++) {
		sReturn = sReturn + '/' + aSplittContent[i];
	}
	return sReturn + '/';
};
/**
 * @memberOf sap.apf.core.utils.uriGenerator
 * @description gets the location of the apf libary. sap.apf.core.utils.uriGenerator is required for loading texts, images and so on.
 * @returns {String}
 */
sap.apf.core.utils.uriGenerator.getApfLocation = function() {
	return jQuery.sap.getModulePath("sap.apf") + '/';
};
/**
 * @memberOf sap.apf.core.utils.uriGenerator
 * @description builds a URI based on parameters
 * @param {sap.apf.core.MessageHandler} oMsgHandler
 * @param {string} sEntityType
 * @param [aSelectProperties]
 * @param {object} oFilter
 * @param {object} oParameter - HANA XSE parameter entity set parameters
 * @param {object} [sortingFields]
 * @param {object} oPaging - values of properties 'top','skip' and 'inlineCount' are evaluated and added to '$top','$skip' and '$inlinecount' URI string parameters if available 
 * @param {string} sFormat of HTTP response,e.g. 'json' or 'xml'. If omitted 'json' is taken as default.
 * @param {function} [fnFormatValue] callback method to format the values 
 * @param {sParameterSuffix} Suffix after the parameter - old default is "Results"
 * @returns {string} complete URI
 */
sap.apf.core.utils.uriGenerator.buildUri = function(oMsgHandler, sEntityType, aSelectProperties, oFilter, oParameter, sortingFields, oPaging, sFormat, fnFormatValue, sUriSuffix) {
	var sReturn = "";
	sReturn += sEntityType;
	sReturn += addParamsToUri(oParameter,sUriSuffix);
	sReturn = sReturn + "?";
	sReturn += addSelectPropertiesToUri(aSelectProperties);
	sReturn += addFilterToUri(oFilter, fnFormatValue);
	sReturn += addSorting(sortingFields, aSelectProperties);
	sReturn += addPaging(oPaging);
	sReturn += addFormatToUri(sFormat);
	return sReturn;
	function addParamsToUri(oParameter,sUriSuffix) {
		var sReturn = '';
		var bParametersExist = false;
		var sParameter;
		for(sParameter in oParameter) {
			if (!bParametersExist) {
				sReturn += '(';
				bParametersExist = true;
			}
			else {
				sReturn += ',';
			}
			sReturn += sParameter.toString() + '=' + oParameter[sParameter];
		}
		if (bParametersExist) {
			sReturn += ')/';
		}
		sReturn += sUriSuffix || '';	
		return sReturn;
	}
	function addSelectPropertiesToUri(aSelectProperties) {
		if (!aSelectProperties[0]) {
			return '';
		}
		var sResult = "$select=";
		for( var field in aSelectProperties) {
			sResult += jQuery.sap.encodeURL(sap.apf.utils.escapeOdata(aSelectProperties[field]));
			if (field < aSelectProperties.length - 1) {
				sResult += ",";
			}
		}
		return sResult;
	}
	function addFilterToUri(oFilter, fnFormatValue) {
		if (!(oFilter && oFilter instanceof sap.apf.core.utils.Filter)) {
			return '';
		}
		var sFilterValues = oFilter.toUrlParam( { formatValue : fnFormatValue });
		if (sFilterValues === "" || sFilterValues === '()' ) {
			return '';
		}	
		return '&$filter=' + sFilterValues;	
	}
	function addSorting(sortingFields, aSelectProperties) {
		var sOrderByValues = '';
		var sSingleValue = '';
		if (!sortingFields) {
			return '';
		}
		switch (true) {
			case jQuery.isArray(sortingFields):
				for( var i = 0; i < sortingFields.length; i++) {
					sSingleValue = makeOrderByValue(sortingFields[i], aSelectProperties);
					if (sOrderByValues.length > 0 && sSingleValue.length > 0) {
						sOrderByValues += ',';
					}
					sOrderByValues += sSingleValue;
				}
				break;
			case jQuery.isPlainObject(sortingFields):
				sOrderByValues += makeOrderByValue(sortingFields, aSelectProperties);
				break;
			case typeof sortingFields === 'string':
				sOrderByValues += makeOrderByValue({
					property : sortingFields
				}, aSelectProperties);
				break;
		}
		if (sOrderByValues.length > 0) {
			return "&$orderby=" + sOrderByValues;
		} else {
			return '';
		}
		function makeOrderByValue(oOrderBy, aSelectProperties) {
			var sValue = '';
			if (jQuery.inArray(oOrderBy.property, aSelectProperties) > -1) {
				sValue += oOrderBy.property;
				if (oOrderBy.descending === true) {
					sValue += ' desc';
				} else {
					sValue += ' asc';
				}
			} else {
				oMsgHandler.putMessage(oMsgHandler.createMessageObject({
					code : '5019',
					aParameters : [ sEntityType, oOrderBy.property ]
				}));
			}
			return jQuery.sap.encodeURL(sValue);
		}
	}
	function addPaging(oPaging) {
		
		function checkPropertyOptionsConsistency(oPaging) {
			var aPropertyNames, i;
			aPropertyNames = Object.getOwnPropertyNames(oPaging);
			for (i = 0; i < aPropertyNames.length;i++) {
				if (aPropertyNames[i] !== 'top' && aPropertyNames[i] !== 'skip' && aPropertyNames[i] !== 'inlineCount') {
					oMsgHandler.putMessage(oMsgHandler.createMessageObject({
						code : '5032',
						aParameters : [ sEntityType, aPropertyNames[i] ]
					}));
				}
			}
		}
		
		var sReturn = '';
		
		if (!oPaging) {
			return sReturn;
		} else {
			
			checkPropertyOptionsConsistency(oPaging);
					
			if (oPaging.top) {
				sReturn += '&$top=' + oPaging.top;
			}
			if (oPaging.skip) {
				sReturn += '&$skip=' + oPaging.skip;
			}
			if (oPaging.inlineCount === true) {
				sReturn += '&$inlinecount=allpages';
			}
			return sReturn;
		}
	}
	function addFormatToUri(sFormat) {
		if (!sFormat) {
			sFormat = 'json';
		}
		return '&$format=' + sFormat;
	}
};

}; // end of sap/apf/core/utils/uriGenerator.js
if ( !jQuery.sap.isDeclared('sap.apf.library') ) {
/* -----------------------------------------------------------------------------------
 * Hint: This is a derived (generated) file. Changes should be done in the underlying
 * source files only (*.type, *.js) or they will be lost after the next generation.
 * ----------------------------------------------------------------------------------- */

/**
 * Initialization Code and shared classes of library sap.apf (1.28.1)
 */
jQuery.sap.declare("sap.apf.library");
jQuery.sap.require('sap.ui.core.Core'); // unlisted dependency retained

/**
 * Analysis Path Framework (by SAP)
 *
 * @namespace
 * @name sap.apf
 * @public
 */


// library dependencies
jQuery.sap.require('sap.ui.core.library'); // unlisted dependency retained


// delegate further initialization of this library to the Core
sap.ui.getCore().initLibrary({
	name : "sap.apf",
	dependencies : ["sap.ui.core"],
	types: [],
	interfaces: [],
	controls: [],
	elements: [],
	noLibraryCSS: true,
	version: "1.28.1"
});


}; // end of sap/apf/library.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.configurationObjects') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, core, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.configurationObjects");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.ConfigurationObjects
     * @class Defines the schema of configuration objects, their validation, their serialization in the modeler.
     * De-serialization is in a different class which share the deserialize method with the run-time.
     * @param {Object} inject - Injection of required APF object references, constructors and functions.
     * @param {sap.apf.core.utils.MessageHandler} inject.instance.messageHandler MessageHandler instance
     * @param {sap.apf.modeler.core.TextPool} inject.instance.textPool- TextPool instance
     * @param {Object} inject.constructor Injected constructors
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable Hashtable constructor
     * @param {sap.apf.core.utils.TextPool} inject.instance.textPool textPool instance
     * @param {sap.apf.core.utils.OdataProxy} inject.instance.persistenceProxy persistenceProxy instance 
     * @param {sap.apf.core.messageHandler} inject.instance.messageHandler messageHandler instance  
     * @constructor
     */
    sap.apf.modeler.core.ConfigurationObjects = function (inject) {
        /* @type {sap.apf.modeler.core.ConfigurationObjects} */
        var that = this;
        var Hashtable,
            textPool,
            persistenceProxy,
            messageHandler;
        if(inject.constructor.hashtable){
        	Hashtable = inject.constructor.hashtable;
          }
        if(inject.instance.textPool){
          textPool = inject.instance.textPool;
        }
        if(inject.instance.persistenceProxy){
        	persistenceProxy = inject.instance.persistenceProxy;
        }
        if(inject.instance.messageHandler){
        	messageHandler = inject.instance.messageHandler;
        }

        function complain(messageNumber, parameter) {
        	var aParams = [];
        	if (parameter) {
        		aParams.push(parameter);
        	}
        	messageHandler.putMessage(messageHandler.createMessageObject({ code : messageNumber, aParameters : aParams}));
        }
        function isValidLabel(label) {
            var result =
                label &&
                label.type && label.type === "label" &&
                label.kind && label.kind === "text" &&
                label.key && typeof label.key === "string";
            if (!result) {
                complain(11030, label.key);
            }
            return result;
        }


        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeLabel
         * @param {string} textKey
         * @returns {object}
         */
        this.serializeLabelKey = function (textKey) {
            return {
                type: "label",
                kind: "text",
                key: textPool.getPersistentKey(textKey)
            };
        };

        /**
         * @private
         * @function
         * @description Parameter configObject will be enhanced by a thumbnail attribute with the following structure
         *              {type: string, leftUpper: Object, leftLower: Object, rightUpper: Object, rightLower: Object}}
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeAndAddThumbnail
         * @param {sap.apf.modeler.core.Step|sap.apf.modeler.core.Representation} modelerObject
         * @param {Object} configObject Will be enhanced by a new attribute "thumbnail"
         */
        this.serializeAndAddThumbnail = function (modelerObject, configObject) {
            var leftLower = modelerObject.getLeftLowerCornerTextKey();
            var leftUpper = modelerObject.getLeftUpperCornerTextKey();
            var rightUpper = modelerObject.getRightUpperCornerTextKey();
            var rightLower = modelerObject.getRightLowerCornerTextKey();
            var thumbnail = {
                type: "thumbnail"
            };
            if (leftUpper) {
            	thumbnail.leftUpper = this.serializeLabelKey(leftUpper);
            }
            if (leftLower) {
            	thumbnail.leftLower = this.serializeLabelKey(leftLower);
            }
            if (rightUpper) {
            	thumbnail.rightUpper = this.serializeLabelKey(rightUpper);
            }
            if (rightLower) {
            	thumbnail.rightLower = this.serializeLabelKey(rightLower);
            }
           
            if (thumbnail.leftLower || thumbnail.leftUpper || thumbnail.rightLower || thumbnail.rightUpper) { // fixme: optional thumbnail???
            	configObject.thumbnail = thumbnail;
            }
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeCategory
         * @param {object} category
         * @param {array} steps
         * @returns {object}
         */
        this.serializeCategory = function (category, steps) {
        	var TextElement = textPool.get(category.labelKey);
        	var stepObjects = [];
        	if(steps){
        		steps.forEach(function(stepId){
        			stepObjects.push({type : "step", id: stepId});
        		});
        	}
        	var description = (TextElement && TextElement.TextElementDescription) || "";
            return {
                type: "category",
                description: description,
                id: category.getId(),
                label: that.serializeLabelKey(category.labelKey),
                steps: stepObjects
            };
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateCategory
         * @description Return true if the category configuration object is valid.
         * @param {object} category
         * @returns {boolean}
         */
        this.validateCategory = function (category) {
            var result = category &&
                category.type && category.type === "category" &&
                category.id &&
                category.steps &&
                isValidLabel(category.label);
            if(result){
                category.steps.forEach(function (object) {
              	  if (!object.type || object.type !== "step" || !object.id) {
              	         result = false;
              	                }
              });	
            }
            if (!result) {
            	complain(11031,  category.id);
            	 
            }
            return result;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateRequest
         * @description Return true if the request configuration object is valid.
         * @param {object} request
         * @returns {boolean}
         */
        this.validateRequest = function (request) {
            var result = request &&
                request.id && // id
                request.type === "request" &&
                request.service && typeof request.service === "string" &&
                ((request.entityType && typeof request.entityType === "string") || (request.entitySet && typeof request.entitySet === "string")) &&
                request.selectProperties && // id
                request.selectProperties && request.selectProperties instanceof Array && request.selectProperties.length >= 0;
            if (!result) {
            	 complain(11032, request.id);
            }
            return result;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateBinding
         * @description Return true if the binding configuration object is valid.
         * @param {object} binding
         * @returns {boolean}
         */
        this.validateBinding = function (binding) {
            var result = binding &&
                binding.id &&
                binding.type === "binding" &&
                binding.requiredFilters && binding.requiredFilters instanceof Array && binding.requiredFilters.length >= 0 &&
                binding.representations && binding.representations instanceof Array;
            if (!result) {
           	 complain(11033, binding.id);
            }
            return result;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateFacetFilter
         * @description Return true if the facetFilter configuration object is valid.
         *      Note, the validated object structurally corresponds to the result of serializing an object of type sap.apf.modeler.core.FacetFilter.
         * @param {object} facetFilter
         * @returns {boolean}
         */
        this.validateFacetFilter = function (facetFilter) {
            var result = facetFilter &&
                facetFilter.id && // id
                facetFilter.property &&
                facetFilter.type === "facetFilter";
            if (!result) {
            	complain(11034, facetFilter.id);
            }
            return result;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateNavigationTarget
         * @description Return true if the navigationTarget configuration object is valid.
         *      Note, the validated object structurally corresponds to the result of serializing an object of type sap.apf.modeler.core.NavigationTarget.
         * @param {object} navigationTarget
         * @returns {boolean}
         */
        this.validateNavigationTarget = function (navigationTarget) {
            var result = navigationTarget &&
                navigationTarget.id && // id
                navigationTarget.semanticObject &&
                navigationTarget.action &&
                navigationTarget.type === "navigationTarget";
            if (!result) {
            	complain(11040, navigationTarget.id);
            }
            return result;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateStep
         * @description Return true if the step configuration object is valid.
         *      Note, the validated object structurally corresponds to the result of serializing an object of type sap.apf.modeler.core.Step.
         * @param {object} step
         * @returns {boolean}
         */
        this.validateStep = function (step) {
            var result = step &&
                step.id && // id
                step.type === "step" &&
                isValidLabel(step.title) &&
                isValidLabel(step.longTitle);
            if (!result) {
            	 complain(11035, step.id);
            }
            return result;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#validateConfiguration
         * @description Return true if the configuration object is valid.
         * @param {object} configuration
         * @returns {boolean}
         */
        this.validateConfiguration = function (configuration) {
            var result = configuration && 
            	configuration.applicationTitle && configuration.applicationTitle.key && typeof configuration.applicationTitle.key === 'string' &&
                configuration.steps && configuration.steps instanceof Array && configuration.steps.length >= 0 &&
                configuration.requests && configuration.requests instanceof Array && configuration.requests.length >= 0 &&
                configuration.bindings && configuration.bindings instanceof Array && configuration.bindings.length >= 0 &&
                configuration.representationTypes && configuration.representationTypes instanceof Array && configuration.representationTypes.length >= 0 &&
                configuration.facetFilters && configuration.facetFilters instanceof Array && configuration.facetFilters.length >= 0 &&
                configuration.categories && configuration.categories instanceof Array && configuration.categories.length >= 0;
            if (!result) {
            	 complain(11036);
            }
            return result;
        };

        function serializeRepresentations(step) {
            var representationValues = [];
            var dimensionValues,
                dimensions;
            var measureValues,
                measures;
            var orderbyValues;
            var configurationObject;

            var representations = step.getRepresentations();
            representations.forEach(function (representation) {
                dimensionValues = [];
                dimensions = representation.getDimensions();
                dimensions.forEach(function (dimension) {
                    var dimensionValue = {
                        fieldName: dimension
                    };
                    if (representation.getDimensionKind(dimension)) {
                        dimensionValue.kind = representation.getDimensionKind(dimension);
                    }
                    if (representation.getDimensionTextLabelKey(dimension)) {
                        dimensionValue.fieldDesc = {
                            type: 'label',
                            kind: 'text',
                            key: representation.getDimensionTextLabelKey(dimension)
                        };
                    }
                    dimensionValues.push(dimensionValue);
                });
                measureValues = [];
                measures = representation.getMeasures();
                measures.forEach(function (measure) {
                    var measureValue = {
                        fieldName: measure
                    };
                    if (representation.getMeasureKind(measure)) {
                        measureValue.kind = representation.getMeasureKind(measure);
                    }
                    if (representation.getMeasureTextLabelKey(measure)) {
                        measureValue.fieldDesc = {
                            type: 'label',
                            kind: 'text',
                            key: representation.getMeasureTextLabelKey(measure)
                        };
                    }
                    measureValues.push(measureValue);
                });
                orderbyValues = [];
                representation.getOrderbySpecifications().forEach(function (spec) {
                    orderbyValues.push({
                        property: spec.property,
                        ascending: spec.ascending
                    });
                });

                configurationObject = {
                    id: representation.getId(),
                    representationTypeId: representation.getRepresentationType(),
                    parameter: {
                        dimensions: dimensionValues,
                        measures: measureValues,
                        alternateRepresentationTypeId: representation.getAlternateRepresentationType()
                    }
                };
                if (representation.getWidthProperties()) { // optional
                    configurationObject.parameter.width = representation.getWidthProperties();
                }
                if (orderbyValues.length > 0) {
                    configurationObject.parameter.orderby = orderbyValues;
                }
 
                that.serializeAndAddThumbnail(representation, configurationObject);

                representationValues.push(configurationObject);
            });
            return representationValues;
        }

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeBinding
         * @param {sap.apf.modeler.core.Step} step
         * @param {object} containers - Hashes for generated objects like request, binding, etc.
         * @param {sap.apf.modeler.core.ElementContainer} containers.bindingIdHash - Generator for Id's of type binding.
         * @param {object[]} containers.bindings - binding list of configuration
         * @returns {String} - The Id.
         */
        this.serializeBinding = function (step, containers) {
            var bindingId = "binding-for-" + step.getId();
            var TextElement = textPool.get(step.getTitleId());	
        	var stepDescription = (TextElement && TextElement.TextElementDescription) || "";
            containers.bindings.push({
                type: "binding",
                id: bindingId,
                stepDescription : stepDescription,
                requiredFilters: step.getFilterProperties(),
                representations: serializeRepresentations(step)
            });
            return bindingId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeRequest
         * @param {sap.apf.modeler.core.Step} step
         * @param {object} containers - Hashes for generated objects like request, binding, etc.
         * @param {sap.apf.modeler.core.ElementContainer} containers.requestIdHash - Generator for Id's of type request.
         * @param {object[]} containers.requests - request list of configuration
         * @returns {String} - Id
         */
        this.serializeRequest = function (step, containers) {
            var request;
            var requestId = "request-for-" + step.getId();
            request = {
                type: "request",
                id: requestId,
                service: step.getService(),
                entitySet: step.getEntitySet(),
                selectProperties: step.getSelectProperties()
            };
            containers.requests.push(request);
            return requestId;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeFilterMappingRequest
         * @param {sap.apf.modeler.core.Step} step
         * @param {object} containers - Hashes for generated objects like request, binding, etc.
         * @param {sap.apf.modeler.core.ElementContainer} containers.requestIdHash - Generator for Id's of type request.
         * @param {object[]} containers.requests - request list of configuration
         * @returns {String} - Id
         */
        this.serializeFilterMappingRequest = function (step, containers) {
            var requestId = "request-for-FilterMapping" + step.getId();
            var request = {
                type: "request",
                id: requestId,
                service: step.getFilterMappingService(),
                entitySet: step.getFilterMappingEntitySet(),
                selectProperties: step.getFilterMappingTargetProperties()
            };
            containers.requests.push(request);
            return requestId;
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeStep
         * @param {sap.apf.modeler.core.Step} step
         * @param {object} containers - Hashes for generated objects like request, binding, etc.
         * @param {sap.apf.modeler.core.ElementContainer} containers.requestIdHash - Generator for Id's of type request.
         * @param {sap.apf.modeler.core.ElementContainer} containers.bindingIdHash - Generator for Id's of type binding.
         * @returns {object}
         */
        this.serializeStep = function (step, containers) {
            var requestId = that.serializeRequest(step, containers);
            var bindingId = that.serializeBinding(step, containers);
            var TextElement = textPool.get(step.getTitleId());	
        	var description = (TextElement && TextElement.TextElementDescription) || "";
            var longTitleId = step.getLongTitleId();
            
            var result = {
                type: "step",
                description : description,
                request: requestId,
                binding: bindingId,
                id: step.getId(),
                title: that.serializeLabelKey(step.getTitleId())       
            };
            
            if(step.getFilterMappingService()){
            	result.filterMapping = {
					requestForMappedFilter : that.serializeFilterMappingRequest(step, containers),
					target : step.getFilterMappingTargetProperties(),
					keepSource : step.getFilterMappingKeepSource() ? "true" : "false"
				};
            }
            
            if (longTitleId !== "" && longTitleId !== undefined ) {
            	result.longTitle =  that.serializeLabelKey(step.getLongTitleId());
            }
            this.serializeAndAddThumbnail(step,result);
            return result;
        };

        this.serializeFacetFilter = function (facetFilter, containers) {
            /**
             * @private
             * @function
             * @name sap.apf.modeler.core.ConfigurationObjects#serializeFacetFilter
             * @param {sap.apf.modeler.core.FacetFilter} facetFilter
             * @param {object} containers - Hashes for generated objects like request, binding, etc.
             * @param {sap.apf.modeler.core.ElementContainer} containers.requestIdHash - Generator for Id's of type request.
             * @returns {object}
             */
            var requestForFilterResolutionId,
                requestForValueHelpId;
            if(facetFilter.getServiceOfFilterResolution()) {
                requestForFilterResolutionId = serializeFacetFilterRequest("FilterResolution", facetFilter, containers);
            }
            if(facetFilter.getServiceOfValueHelp()) {
                requestForValueHelpId = serializeFacetFilterRequest("ValueHelp", facetFilter, containers);
            }
        	var TextElement = textPool.get(facetFilter.getLabelKey());
        	var description = (TextElement && TextElement.TextElementDescription) || "";
            return {
                type: "facetFilter",
                description : description,
                id: facetFilter.getId(),
                alias: facetFilter.getAlias(),
                property: facetFilter.getProperty(),
                multiSelection: facetFilter.isMultiSelection() + "",
                preselectionFunction: facetFilter.getPreselectionFunction(),
                preselectionDefaults: facetFilter.getPreselectionDefaults(),
                label: that.serializeLabelKey(facetFilter.getLabelKey()),
                filterResolutionRequest: requestForFilterResolutionId,
                valueHelpRequest: requestForValueHelpId
            };

        	function serializeFacetFilterRequest(requestType, facetFilter, containers) {
                var request;
                var service;
                var entitySet;
                var selectProperties;
                
                switch(requestType) {
	                case "ValueHelp":
	                	service = facetFilter.getServiceOfValueHelp();
	                	entitySet = facetFilter.getEntitySetOfValueHelp();
	                	selectProperties = facetFilter.getSelectPropertiesOfValueHelp();
	                    break;
	                case "FilterResolution":
	                	service = facetFilter.getServiceOfFilterResolution();
	                	entitySet = facetFilter.getEntitySetOfFilterResolution();
	                	selectProperties = facetFilter.getSelectPropertiesOfFilterResolution();
	                    break;
                }
                var requestId = requestType + "-request-for-" + facetFilter.getId();
                request = {
                        type: "request",
                        id: requestId,
                        service: service,
                        entitySet: entitySet,
                        selectProperties: selectProperties
                };
                containers.requests.push(request);
                return requestId;
        	}
        };


        this.serializeNavigationTarget = function (navigationTarget) {
            /**
             * @private
             * @function
             * @name sap.apf.modeler.core.ConfigurationObjects#serializeNavigationTarget
             * @param {sap.apf.modeler.core.NavigationTarget} navigationTarget
             * @param {object} containers - Hashes for generated objects like request, binding, etc.
             * @returns {object}
             */
        	 return {
                 type: "navigationTarget",
                 id: navigationTarget.getId(),
                 semanticObject: navigationTarget.getSemanticObject(),
        	     action: navigationTarget.getAction()
        	 };
        };	
        	
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serializeConfiguration
         * @description Return a serializable configuration.
         *      It recursively serializes all referenced objects, e.g. steps, representations, categories.
         * @param {sap.apf.modeler.core.ConfigurationEditor} editor
         * @returns{Object}
         */
        this.serializeConfiguration = function (editor) {
            var serializableConfiguration = {
	            	applicationTitle : that.serializeLabelKey(editor.getApplicationTitle()),
	                steps: [],
	                requests: [],
	                bindings: [],
	                representationTypes: [],
	                categories: [],
	                facetFilters: [],
	                navigationTargets: []
            };
            
            // add navigation configuration hard coded. Configuration editor must learn this format
            var containers = {
                requests: serializableConfiguration.requests,
                bindings: serializableConfiguration.bindings
            };

            editor.getCategories().forEach(function (category) {
            	var steps = editor.getCategoryStepAssignments(category.getId());
                serializableConfiguration.categories.push(that.serializeCategory(category,steps));
            });
            editor.getSteps().forEach(function (step) {
                var configStep = that.serializeStep(step, containers);
                serializableConfiguration.steps.push(configStep);
            });
            editor.getFacetFilters().forEach(function (facetFilter) {
                var configFacetFilter = that.serializeFacetFilter(facetFilter, containers);
                serializableConfiguration.facetFilters.push(configFacetFilter);
            });
            editor.getNavigationTargets().forEach(function (navigationTarget) {
                var configNavigationTarget = that.serializeNavigationTarget(navigationTarget);
                serializableConfiguration.navigationTargets.push(configNavigationTarget);
            });
            return serializableConfiguration;
        };

        function mapOptionalThumbnail(configObject, modelObject) {
            var thumbnail = configObject.thumbnail;
            if (!thumbnail) {
                return;
            }
            if (thumbnail.leftLower) {
                modelObject.setLeftLowerCornerTextKey(thumbnail.leftLower.key);
            }
            if (thumbnail.leftUpper) {
                modelObject.setLeftUpperCornerTextKey(thumbnail.leftUpper.key);
            }
            if (thumbnail.rightLower) {
                modelObject.setRightLowerCornerTextKey(thumbnail.rightLower.key);
            }
            if (thumbnail.rightUpper) {
                modelObject.setRightUpperCornerTextKey(thumbnail.rightUpper.key);
            }
        }

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#mapStepToDesignTime
         * @param {object} configStep - configuration object
         * @param {sap.apf.modeler.core.ConfigurationEditor} configurationEditor
         * @param {sap.apf.modeler.core.RegistryWrapper} registry
         */
        function mapStepToDesignTime(configStep, registry, configurationEditor) {
            var stepId = configurationEditor.createStepWithId(configStep.id);
            var modelStep = configurationEditor.getStep(stepId);
            var request = registry.getItem(configStep.request);
            
        	if(request.entityType) { // TODO: remove workaround earliest 5th November
        		request.entitySet = request.entityType;
        		delete request.entityType;
        	}
        	if(request.service){
        		configurationEditor.registerService(request.service);	
        	}
            modelStep.setService(request.service);
            modelStep.setEntitySet(request.entitySet);
            modelStep.setTitleId(configStep.title.key);
            if (configStep.longTitle && configStep.longTitle.key) {
            	modelStep.setLongTitleId(configStep.longTitle.key);
            }
            
            mapOptionalThumbnail(configStep, modelStep);
            request.selectProperties.forEach(function (property) {
                modelStep.addSelectProperty(property);
            });
            var binding = registry.getItem(configStep.binding);
            binding.requiredFilters.forEach(function (property) {
                modelStep.addFilterProperty(property);
            });
            binding.representations.forEach(function (configRepresentation) {
                var member;
                var modelRepresentation = modelStep.getRepresentation(modelStep.createRepresentation().getId());
               
                modelRepresentation.setRepresentationType(configRepresentation.representationTypeId);
                modelRepresentation.setAlternateRepresentationType(configRepresentation.parameter.alternateRepresentationTypeId);
                configRepresentation.parameter.dimensions.forEach(function (dimensionConfig) {
                        modelRepresentation.addDimension(dimensionConfig.fieldName);
                        if (dimensionConfig.fieldDesc) {
                            modelRepresentation.setDimensionTextLabelKey(dimensionConfig.fieldName, dimensionConfig.fieldDesc.key);
                        }
                        if (dimensionConfig.kind) {
                            modelRepresentation.setDimensionKind(dimensionConfig.fieldName, dimensionConfig.kind);
                        }
                    }
                );
                configRepresentation.parameter.measures.forEach(function (measureConfig) {
                        modelRepresentation.addMeasure(measureConfig.fieldName);
                        if (measureConfig.fieldDesc) {
                            modelRepresentation.setMeasureTextLabelKey(measureConfig.fieldName, measureConfig.fieldDesc.key);
                        }
                        if (measureConfig.kind) {
                            modelRepresentation.setMeasureKind(measureConfig.fieldName, measureConfig.kind);
                        }
                    }
                );
                if (configRepresentation.parameter.width) {
                    for (member in configRepresentation.parameter.width) {
                        if (configRepresentation.parameter.width.hasOwnProperty(member)) {
                            modelRepresentation.setWidthProperty(member, configRepresentation.parameter.width[member]);
                        }
                    }
                }
                if (configRepresentation.parameter.orderby) { // optional
                    configRepresentation.parameter.orderby.forEach(function (obj) {
                        modelRepresentation.addOrderbySpec(obj.property, obj.ascending);
                    });
                }
                mapOptionalThumbnail(configRepresentation, modelRepresentation);
            });
            
            if(configStep.filterMapping){
            	var requestForFilterMapping = registry.getItem(configStep.filterMapping.requestForMappedFilter);
                if(requestForFilterMapping.entityType) { 
                    requestForFilterMapping.entitySet = requestForFilterMapping.entityType;
                    delete requestForFilterMapping.entityType;
                }
            	 modelStep.setFilterMappingService(requestForFilterMapping.service);
            	 modelStep.setFilterMappingEntitySet(requestForFilterMapping.entitySet);
            	 
            	 configStep.filterMapping.target.forEach(function (property) {
            		 modelStep.addFilterMappingTargetProperty(property);
            	 });
            	 
            	 if(configStep.filterMapping.keepSource === "true"){
            		 modelStep.setFilterMappingKeepSource(true);
            	 }else{
            		 modelStep.setFilterMappingKeepSource(false);
            	 }
            }
        }

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#mapFacetFilterToDesignTime
         * @param {object} configFacetFilter - configuration object
         * @param {sap.apf.modeler.core.ConfigurationEditor} configurationEditor
         * @param {sap.apf.modeler.core.RegistryWrapper} registry
         */
        function mapFacetFilterToDesignTime(configFacetFilter, registry, configurationEditor) {
            var id = configurationEditor.createFacetFilterWithId(configFacetFilter.id);
            var modelFacetFilter = configurationEditor.getFacetFilter(id);
            
            modelFacetFilter.setLabelKey(configFacetFilter.label.key);
            modelFacetFilter.setAlias(configFacetFilter.alias);
            modelFacetFilter.setProperty(configFacetFilter.property);
            modelFacetFilter.setPreselectionFunction(configFacetFilter.preselectionFunction);
            modelFacetFilter.setPreselectionDefaults(configFacetFilter.preselectionDefaults);
            if (configFacetFilter.multiSelection === "true") {
            	modelFacetFilter.setMultiSelection(true); 
            } 
            
            if(configFacetFilter.valueHelpRequest){
            	var configRequestForValueHelp = registry.getItem(configFacetFilter.valueHelpRequest);
            	if(configRequestForValueHelp.entityType) {
            		configRequestForValueHelp.entitySet = configRequestForValueHelp.entityType;
            		delete configRequestForValueHelp.entityType;
            	}
            	
            	if (configRequestForValueHelp.service) {
            		configurationEditor.registerService(configRequestForValueHelp.service);
            		modelFacetFilter.setServiceOfValueHelp(configRequestForValueHelp.service);
            	}
            	if (configRequestForValueHelp.entitySet) {
            		modelFacetFilter.setEntitySetOfValueHelp(configRequestForValueHelp.entitySet);
            	}
            	
            	configRequestForValueHelp.selectProperties.forEach(function(property) {
            		modelFacetFilter.addSelectPropertyOfValueHelp(property);
            	});
            }
            
            if(configFacetFilter.filterResolutionRequest){
            	var configRequestForFilterResolution = registry.getItem(configFacetFilter.filterResolutionRequest);
            	if(configRequestForFilterResolution.entityType) {
            		configRequestForFilterResolution.entitySet = configRequestForFilterResolution.entityType;
            		delete configRequestForFilterResolution.entityType;
            	}
            	
            	if (configRequestForFilterResolution.service) {
            		configurationEditor.registerService(configRequestForFilterResolution.service);
            		modelFacetFilter.setServiceOfFilterResolution(configRequestForFilterResolution.service);
            	}
            	if (configRequestForFilterResolution.entitySet) {
            		modelFacetFilter.setEntitySetOfFilterResolution(configRequestForFilterResolution.entitySet);
            	}
            	configRequestForFilterResolution.selectProperties.forEach(function(property) {
            		modelFacetFilter.addSelectPropertyOfFilterResolution(property);
            	});
            }
        }

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#mapNavigationTargetToDesignTime
         * @param {object} configNavigationTarget - configuration object
         * @param {sap.apf.modeler.core.ConfigurationEditor} configurationEditor
         */
        function mapNavigationTargetToDesignTime(configNavigationTarget, configurationEditor) {
            var id = configurationEditor.createNavigationTargetWithId(configNavigationTarget.id);
            var modelNavigationTarget = configurationEditor.getNavigationTarget(id);
            modelNavigationTarget.setSemanticObject(configNavigationTarget.semanticObject);
            modelNavigationTarget.setAction(configNavigationTarget.action);
        }
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#mapToDesignTime
         * @description Retrieve all first class citizens (e.g. steps and categories) from the hashtable and transfer them to the containers in the configurationEditor.
         *      Assumption: all input entities have identifier.
         * @param {sap.apf.modeler.core.RegistryWrapper} registry
         * @param {sap.apf.modeler.core.ConfigurationEditor} configurationEditor
         */
        this.mapToDesignTime = function (registry, configurationEditor) {
        	configurationEditor.setApplicationTitle(registry.getItem('applicationTitle').key);
        	registry.getSteps().forEach(function (step) {
        		mapStepToDesignTime(step, registry, configurationEditor);
        	});
            registry.getCategories().forEach(function (category) {
                configurationEditor.createCategoryWithId({labelKey: category.label.key}, category.id);
                category.steps.forEach(function(step){
                	configurationEditor.addCategoryStepAssignment(category.id, step.id);
                });
            });
            registry.getFacetFilters().forEach(function (facetFilter) {
                mapFacetFilterToDesignTime(facetFilter, registry, configurationEditor);
            });
            registry.getNavigationTargets().forEach(function (navigationTarget) {
                mapNavigationTargetToDesignTime(navigationTarget, configurationEditor);
            });
        }; 
         /**
          * @private
          * @function
          * @name sap.apf.modeler.core.ConfigurationObjects#loadAllConfigurations
          * @description Load all configuration objects for a given application from server
          * @param {String} applicationId - Id of the application
          * @param {Function} callbackAfterLoad - callback with signature callbackAfterLoad(result, metadata, messageObject)
          */
         this.loadAllConfigurations = function (applicationId, callbackAfterLoad) {
         	var filterApplication = new sap.apf.core.utils.Filter(messageHandler, 'Application', 'eq', applicationId);
         	persistenceProxy.readCollection(
         			"configuration",
         			function(result, metadata, messageObject){
         				callbackAfterLoad(result, metadata, messageObject); //needed: for debugging purposes
         			},
         			undefined,
         			undefined,
         			filterApplication,
         			true );
         };
         /**
          * @private
          * @function
          * @name sap.apf.modeler.core.ConfigurationObjects#loadAllConfigurations
          * @description Load thext keys for all configuration objects of a given application
          * @param {String} applicationId - Id of the application
          * @param {Function} callbackAfterGet - callback with signature callbackAfterGet(textKeys, messageObject)
          * @param {sap.apf.core.utils.Hashtable} callbackAfterGet.textKeys - Hashtable with textKeys from all configurations
          */
         this.getTextKeysFromAllConfigurations = function (applicationId, callbackAfterGet) {
        
        	 this.loadAllConfigurations(applicationId, function(configurations, metadata, messageObject){
        		 var textKeys = new Hashtable(messageHandler);
        		 if(messageObject){
        			 callbackAfterGet(undefined, messageObject);
        			 return;
        		 }
        		 configurations.forEach(function(configuration){
        			var config = JSON.parse(configuration.SerializedAnalyticalConfiguration);
        			var textKeysForConfig = sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(config);
        			textKeysForConfig.forEach(function(textKey){
        				textKeys.setItem(textKey, textKey);
        			});
        		 });
        		 callbackAfterGet(textKeys, undefined);
        	 }); 
         };

    };//ctor
    
    /**
     * @private
     * @function
     * @name sap.apf.modeler.core.ConfigurationObjects.deepDataCopy
     * @description Build a deep copy of the input Data considering explicit copy methods.
     * @param {Object} inputData input  object 
     * @returns {Object} Deep copy of the context object
     */
    sap.apf.modeler.core.ConfigurationObjects.deepDataCopy = function deepDataCopy(inputData) {
    	var resultData;
	    if(!inputData){
	      resultData = inputData; //shallow copy for falsy values
	    }
	    else if( inputData.copy && typeof inputData.copy === "function" ) {
		   resultData = inputData.copy();  //Priority for explicit copy methods
  		} else if( inputData && typeof inputData === "object") 
  	    {
  		  if( inputData instanceof Array) {
  			 resultData = [];
  			 inputData.forEach(function(item){
  				resultData.push(deepDataCopy(item)); //Deep copy for all array elements
  			 });
  		  } else {
  			 resultData = {};
  			 for( var item in inputData){
  				if(!inputData.hasOwnProperty(item)){
  				 continue;
  				}
  	  			resultData[item] = deepDataCopy(inputData[item]); //Deep copy for all object attributes
  	  		  }
  		  }
  	    } else
  	    {
  	      resultData = inputData; //Shallow copy for everything else	
  	    }
    	return resultData;
    };
    
    /**
     * @private
     * @function
     * @name sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration
     * @description deeply get all text keys for a stringifiable configuration object and its references
     * @param {Object} configuration - Stringifiable configuration object
     * @return {Array} Text keys
     */
    sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration = function getTextKeysFromConfiguration (configuration) {
    	 var resultValue = [];
    	 if(!configuration){
    		 return;
    	 }
    	 if(configuration.type && configuration.type === "label" &&
    	    configuration.kind && configuration.kind === "text" &&
    	    configuration.key){
    		return [configuration.key];
    	 } else {
    		for( var item in configuration ){
    			if(typeof configuration[item] !== "object" || !configuration.hasOwnProperty(item)){
    			  continue;
    			}
    			Array.prototype.push.apply(resultValue, getTextKeysFromConfiguration(configuration[item]));
    		} 
    		return resultValue;
    	 }
     };   

}());

}; // end of sap/apf/modeler/core/configurationObjects.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.elementContainer') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, core, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.elementContainer");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.ElementContainer
     * @description Managed object on top of some hashtable, simplifies code.
     * @param {String} name
     * @param {Function|undefined|{}} ElementConstructor - When a constructor function is provided then a new instance is created in method createElement.
     *  When undefined or an empty object are given then an empty object instance is created.
     * @param {Object} inject
     * @param {Object} inject.instance.messageHandler
     * @param {Object} dataFromCopy                optional parameter to set the internal state of the new instance during a copy operation
     * @param {Object} dataFromCopy.elements
     * @param {Object} dataFromCopy.elementCounter
     * @constructor
     */
    sap.apf.modeler.core.ElementContainer = function (name, ElementConstructor, inject, dataFromCopy) {
        var elements,
            elementCounter,
            regexp = new RegExp( "^" + name + "-([123456789]\\d*)$"),
            regexp2 = new RegExp( "^" + name);

        /** @type sap.apf.modeler.core.ElementContainer
         * @description NOTE: due to the way of binding functions used in classes ConfigurationEditor and Step
         * "this" in many functions is bound to the calling object, not to this of type sap.apf.modeler.core.ElementContainer.
         * Thus, always use that inside functions!
         */
        var that = this;

        inject.instance.messageHandler.check(name !== undefined, "ElementContainer: Element has been created without name");
        if(!dataFromCopy){
        	elements = new inject.constructor.hashtable(inject.instance.messageHandler);
        	elementCounter = 0;
        }
        else{
        	elements = dataFromCopy.elements;
        	elementCounter = dataFromCopy.elementCounter;
        }

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#generateId
         * @description Create a unique Id, unique in this container.
         * @returns {string} - Id
         */
        this.generateId = function() {
			return name + "-" + (++elementCounter);
		};

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#createElement
         * @description Create an empty element.
         * @param {Object} [element] - Optional object whose members are merged into the created element.
         * @returns {{getId:string}}
         */
        this.createElement = function (element) {
            var elementId;

            elementId = that.generateId();
            return createElementWithId(element, elementId);
           
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#createElementWithProposedId
         * @description Create an empty element with an proposed id. Use the proposed id, if not yet used.
         * @param {Object} [element] - Optional object whose members are merged into the created element.
		 * @param {String} proposedId Id, that should be used, if not already another object has this id
         */
        this.createElementWithProposedId = function(element, proposedId) {
        	
        	function adaptElementCounter(newId) {
    			/* If the newId obeys to the naming conventions for internal IDs, we might need
    			 to update the elementCounter with the number extracted from newId,
    			 so that still new element Ids are created by the internal numbering algorithm
    			 in method createElement. */
    			var match = regexp.exec(newId);
    			if (match) {
    				var number = parseInt(match[1], 10);
    				if (number > elementCounter) {
    					elementCounter = number;
    				}
    			}
    		}
        	
        	var created;       	
        	var existingElementWithSameId = elements.getItem(proposedId);
        	
        	if (existingElementWithSameId) {
        		return that.createElement(element);
        	}
        	created = createElementWithId(element, proposedId);
        	adaptElementCounter(proposedId);
        	return created;   	
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#removeElement
         * @description Remove an existing element.
         * @param {String} id
         */
        this.removeElement = function (id) {
            return elements.removeItem(id);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#getElement
         * @description Get an identified existing element.
         * @param {Object} elementId
         * @returns {{getId:string}}
         */
        this.getElement = function (elementId) {
            return elements.getItem(elementId);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#updateElement
         * @description Update an existing element.
         * @param {String} elementId
         * @param {Object} element
         * @returns {String} The elementId
         */
        this.updateElement = function (elementId, element) {
        	inject.instance.messageHandler.check(elementId !== undefined, "ElementContainer: Element has been updated with undefined elementId");
            if ((!element.getId) || element.getId() !== elementId) {
                element.getId = function () {
                    return elementId;
                };
            }
            elements.setItem(elementId, element);
            return elementId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#setElement
         * @description Create a new element or update an existing element. An element gets assigned a member "getId()" that returns the generated elementId.
         * See {@link sap.apf.modeler.core.ElementContainer#createElement} and {@link sap.apf.modeler.core.ElementContainer#updateElement}.
         * Trying to set an element with a given elementId when the element is not yet existing will result in an error. Thus, elementIds cannot be determined externally.
         * @param {object} element
         * @param {String} [elementId] element identifier. If parameter is omitted, then the function has the meaning of create, otherwise update.
         * @returns{String|undefined} Returns the id of a newly created or updated element
         */
        this.setElement = function (element, elementId) {
            var createdItem;
            if (elementId) {
                if (!(elements.getItem(elementId))) {
                    inject.instance.messageHandler.putMessage(inject.instance.messageHandler.createMessageObject({
                        code: '11006',
                        aParameters: [ elementId ]
                    }));
                    return undefined;
                }
                that.updateElement(elementId, element);
                return elementId;
            }
            createdItem = that.createElement(element);
            return createdItem.getId();
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#getElements
         * @description Get all existing elements.
         * @returns {Object[]}
         */
        this.getElements = function () {
            var list = [];
            elements.forEachOrdered(function (id, element) {
                list.push(element);
            });
            return list;
        };

        /**
         * Change the ordering by moving one key some positions.
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#moveUpOrDown
         * @param {string} elementId
         * @param {number} distance
         * @returns {number|null} WHEN either elementId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of moved elementId, after the move.
         */
        this.moveUpOrDown = function(elementId, distance) {
        	return elements.moveUpOrDown(elementId, distance);
        };
        
        /**
         * Change the ordering by moving one key in the ordering before another key.
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#moveBefore
         * @param {string} beforeElementId
         * @param {string} movedElementId
         * @returns {number|null} WHEN either elementId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedElementId, after the move.
         */
        this.moveBefore = function(beforeElementId, movedElementId) {
        	return elements.moveBefore(beforeElementId, movedElementId);
        };
        
        
        /**
         * Change the ordering by moving one element in the ordering to the end.
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#moveToEnd
         * @param {string} elementId
         * @returns {number|null} WHEN the key elementId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of moveKey, after the move.
         */
        this.moveToEnd = function(elementId) {
        	return elements.moveToEnd(elementId);
        };
        
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#copyElement
         * @description Copy an element (deep).
         * @param {String} id - Id to be copied
         * @returns {string} - Id of the result of the copy
         */
        this.copyElement = function(id){
        	var element, 
        	    copiedElement, 
        	    newId;
        	
        	element = elements.getItem(id);
        	if(!element){
        		return; 
        		}
        	
        	newId = that.generateId();
        	if( element.copy && typeof element.copy === "function" ) {
        	  copiedElement = element.copy(newId); 
        	} else {
        	  copiedElement = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(element); 
        	}
        	
        	copiedElement.getId = function () {return newId;}; 
        	elements.setItem(newId, copiedElement); 
        	
        	return newId;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ElementContainer#copy
         * @description Execute a deep copy of the element container and the contained objects
         * @param {String} newName - optional new name for the copied element container
         * @returns {Object} sap.apf.modeler.core.ElementContainer# New element container object being a copy of this
         */
        this.copy = function(newName){
        	var copiedData = {
        			elements : new inject.constructor.hashtable(inject.instance.messageHandler),
        			elementCounter : elementCounter 
        		};
        	var element;
        	var copiedElement;
 
        	elements.getKeysOrdered().forEach(function(id){
        		
        		element = elements.getItem(id);	
        		copiedElement = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(element);
        		
        	    if(newName && id.indexOf(name) === 0){
        	        id = id.replace(regexp2, newName);
        		}
        	    inject.instance.messageHandler.check(id !== undefined, "ElementContainer: Element has been created without name in copy - 1");
            	
        	    
	        	if(typeof copiedElement === "object" && copiedElement.getId && typeof copiedElement.getId === "function"){
	        		  copiedElement.getId = function(){return id;};
	        	}
        		
	        	copiedData.elements.setItem(id, copiedElement);
        	});
        	inject.instance.messageHandler.check(name !== undefined || newName !== undefined, "ElementContainer: Element has been created without name in copy 2");
        	
        	return new sap.apf.modeler.core.ElementContainer((newName||name), ElementConstructor, inject, copiedData);
        };
        
        /**
         * private functions
         */
        
        function createElementWithId(element, elementId) {
			var created;

			inject.instance.messageHandler.check(elementId !== undefined, "ElementContainer: Element has been created with undefined id");
			if (typeof ElementConstructor === 'function') {
				if(ElementConstructor !== sap.apf.modeler.core.ElementContainer){
					created = new ElementConstructor(elementId, inject);
				}else{
					created = new ElementConstructor(elementId, undefined, inject);
				}
			} else {
				created = {};
			}
			created.getId = function() {
				return elementId;
			};
			
			if (element) {
				created = jQuery.extend(created, element);
			}
			elements.setItem(elementId, created);
			return created;
		}
    };

}());

}; // end of sap/apf/modeler/core/elementContainer.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.facetFilter') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.facetFilter");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.FacetFilter
     * @class A facet filter proxy object providing editor methods on configuration objects.
     * @param {String} facetFilterId - unique Id within configuration.
     * @param {Object} inject - Injection of required APF object references, constructors and functions.
     * @param {sap.apf.core.utils.MessageHandler} inject.instance.messageHandler - MessageHandler instance
     * @param {Object} inject.constructor - Injected constructors
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable - Hashtable constructor
     * @param {Object} dataFromCopy - Optional parameter to set the internal state of the new instance during a copy operation 
     * @constructor
     */
	
    sap.apf.modeler.core.FacetFilter = function (facetFilterId, inject, dataFromCopy) {
            var request,
            selectPropertyForValueHelp,
            selectPropertyForFilterResolution,
            metadata,
            label,
            preselectionDefaults,
            property,
            alias,
            labelKey,
            preselectionFunction,
            isMultiSelectionActive;
            
         if(!dataFromCopy){
        	 request = {
                 	forValueHelp : {
                 		service : undefined,
                 		entitySet : undefined
                 	},
                 	forFilterResolution : {
                 		service : undefined,
                 		entitySet : undefined
                 	}
                 };
        	 selectPropertyForValueHelp = new inject.constructor.elementContainer("SelectPropertyValueHelp", undefined, inject);
             selectPropertyForFilterResolution = new inject.constructor.elementContainer("SelectPropertyFilterResolution", undefined, inject);
             metadata = {};
             label = {};
             preselectionDefaults = [];
             isMultiSelectionActive = false;
         }else{
        	 request = dataFromCopy.request;
             selectPropertyForValueHelp = dataFromCopy.selectPropertyForValueHelp;
             selectPropertyForFilterResolution = dataFromCopy.selectPropertyForFilterResolution;
             metadata = dataFromCopy.metadata;
             label = dataFromCopy.label;
             preselectionDefaults = dataFromCopy.preselectionDefaults;
             property = dataFromCopy.property;
             alias = dataFromCopy.alias;
             labelKey = dataFromCopy.labelKey;
             preselectionFunction = dataFromCopy.preselectionFunction;
             isMultiSelectionActive= dataFromCopy.isMultiSelectionActive;
         }   

        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getId
         * @function
         * @description The immutable id of the facet filter
         * @returns {String} id
         */
        this.getId = function () {
            return facetFilterId;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setMultiSelection
         * @function
         * @description Set property multiselection
         * @param {boolean} bool isMultiSelectionActive
         */
        this.setMultiSelection = function(bool) {
        	isMultiSelectionActive = bool;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#isMultiSelection
         * @function
         * @description Get property multi selection
         * @returns {boolean} isMultiSelectionActive
         */
        this.isMultiSelection = function() {
        	return isMultiSelectionActive;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setAlias
         * @function
         * @description Sets alias to facet filter
         * @param {string} aliasString
         */
        this.setAlias = function(aliasString) {
        	alias = aliasString;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getAlias
         * @function
         * @returns {String} alias
         */
        this.getAlias = function() {
        	return alias;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setPreselectionFunction
         * @function
         * @description Sets preselectionFunction to facet filter
         * @param {string} value preselectionFunction
         */
        this.setPreselectionFunction = function(value) {
        	preselectionFunction = value;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getPreselectionFunction
         * @function
         * @returns {String} preselectionFunction
         */
        this.getPreselectionFunction = function() {
        	return preselectionFunction;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#removePreselectionFunction
         * @description Removes preselectionFunction from facet filter
         * @function
         */
        this.removePreselectionFunction = function() {
        	preselectionFunction = undefined;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setPreselectionDefaults
         * @function
         * @description Sets preselectionDefaults to facet filter
         * @param {String[]} array preselectionDefaults
         */
        this.setPreselectionDefaults = function(array) {
        	preselectionDefaults = array;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getPreselectionDefaults
         * @function
         * @returns {String[]} preselectionDefaults
         */
        this.getPreselectionDefaults = function() {
        	return preselectionDefaults;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#removePreselectionDefaults
         * @description Removes preselectionDefaults from facet filter
         * @function
         */
        this.removePreselectionDefaults = function() {
        	preselectionDefaults = [];
        };

        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setLabelKey
         * @function
         * @description Sets labelKey to facet filter
         * @param {string} labelKey_
         */
        this.setLabelKey = function(labelKey_) {
        	labelKey = labelKey_;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getLabelKey
         * @function
         * @returns {String} labelKey
         */
        this.getLabelKey = function() {
        	return labelKey;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setProperty
         * @function
         * @description Sets property to facet filter
         * @param {string} prop property
         */
        this.setProperty = function(prop) {
        	property = prop;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getProperty
         * @function
         * @returns {String} property
         */
        this.getProperty = function() {
        	return property;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setServiceOfValueHelp
         * @function
         * @description Set service of request for value help
         * @param {string} servicePath
         */
        this.setServiceOfValueHelp = function(servicePath) {
        	request.forValueHelp.service = servicePath;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getServiceOfValueHelp
         * @function
         * @description Returns service of value help
         * @returns {String} serviceForValueHelp
         */
        this.getServiceOfValueHelp = function() {
        	return request.forValueHelp.service;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setEntitySetOfValueHelp
         * @function
         * @description Set entity set to request for value help
         * @param {String} entitySetName
         */
        this.setEntitySetOfValueHelp = function(entitySetName) {
        	request.forValueHelp.entitySet = entitySetName;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getEntitySetOfValueHelp
         * @function
         * @description Returns entity set of value help
         * @returns {String} entityForValueHelp
         */
        this.getEntitySetOfValueHelp = function() {
        	return request.forValueHelp.entitySet;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getSelectPropertiesOfValueHelp
         * @function
         * @description Returns select properties of value help request
         * @returns {String[]} selectProperties
         */
        this.getSelectPropertiesOfValueHelp = function() {
            var selectProperties = [];
            var elementList;
        	elementList = selectPropertyForValueHelp.getElements();
        	elementList.forEach(function (element) {
        		selectProperties.push(element.getId());
            });
            return selectProperties;
        };
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#removeSelectPropertyOfValueHelp
         * @function
         * @description Removes select property from request for value help
         * @param {String} selectProperty
         */
        this.removeSelectPropertyOfValueHelp = function(selectProperty) {
        	selectPropertyForValueHelp.removeElement(selectProperty);
        };
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#addSelectPropertyOfValueHelp
         * @function
         * @description Add select property to request for value help
         * @param {String} selectProperty
         */
        this.addSelectPropertyOfValueHelp = function(selectProperty) {
        	selectPropertyForValueHelp.createElementWithProposedId(undefined, selectProperty);
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setServiceOfFilterResolution
         * @function
         * @description Set service of request for filter resolution
         * @param {String} servicePath
         */
        this.setServiceOfFilterResolution = function(servicePath) {
        	request.forFilterResolution.service = servicePath;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getServiceOfFilterResolution
         * @function
         * @description Returns service of filter resolution
         * @returns {String} serviceOfFilterResolution
         */
        this.getServiceOfFilterResolution = function() {
        	return request.forFilterResolution.service;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#setEntitySetOfFilterResolution
         * @function
         * @description Set entity set to request for filter resolution
         * @param {String} entitySetName
         */
        this.setEntitySetOfFilterResolution = function(entitySetName) {
        	request.forFilterResolution.entitySet = entitySetName;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getEntitySetOfFilterResolution
         * @function
         * @description Returns entity set of filter resolution
         * @returns {String} entitySetOfFilterResolution
         */
        this.getEntitySetOfFilterResolution = function() {
        	return request.forFilterResolution.entitySet;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#getSelectPropertiesOfFilterResolution
         * @function
         * @description Returns select properties of filter resolution
         * @returns {String[]} selectProperties
         */
        this.getSelectPropertiesOfFilterResolution = function() {
            var selectProperties = [];
            var elementList;
        	elementList = selectPropertyForFilterResolution.getElements();
        	elementList.forEach(function (element) {
        		selectProperties.push(element.getId());
            });
            return selectProperties;
        };
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#removeSelectPropertyOfFilterResolution
         * @function
         * @description Removes select property from request for filter resolution
         * @param {String} selectProperty
         */
        this.removeSelectPropertyOfFilterResolution = function(selectProperty) {
        	selectPropertyForFilterResolution.removeElement(selectProperty);
        };
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#addSelectPropertyOfFilterResolution
         * @function
         * @description Add select property to request for filter resolution
         * @param {String} selectProperty
         */
        this.addSelectPropertyOfFilterResolution = function(selectProperty) {
        	selectPropertyForFilterResolution.createElementWithProposedId(undefined, selectProperty);
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.FacetFilter#copy
         * @function
         * @description Execute a deep copy of the facet filter and its referenced objects
         * @param {String} newIdForCopy - New Id for the copied instance
         * @returns {Object} sap.apf.modeler.core.FacetFilter# - New facet filter object being a copy of this object
         */
        this.copy = function( newIdForCopy ){
        	var dataForCopy = {
		        	request : request,
		            selectPropertyForValueHelp : selectPropertyForValueHelp,
		            selectPropertyForFilterResolution : selectPropertyForFilterResolution,
		            metadata : metadata,
		            label : label,
		            preselectionDefaults : preselectionDefaults,
		            property : property,
		            alias : alias,
		            labelKey : labelKey,
		            preselectionFunction : preselectionFunction,
		            isMultiSelectionActive : isMultiSelectionActive };
        	var dataFromCopy = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy( dataForCopy );
        	return new sap.apf.modeler.core.FacetFilter( (newIdForCopy || this.getId()), inject, dataFromCopy);
        };
    };
}()); 
}; // end of sap/apf/modeler/core/facetFilter.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.lazyLoader') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.lazyLoader");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.lazyLoader
     * @class A lazy load manager providing the logic for loading objects asynchronously
     * @param {Object} inject - Injection of required APF object references, constructors and functions
     * @param {sap.apf.core.utils.messageHandler} inject.instance.MessageHandler - messageHandler instance
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable - Hashtable constructor
     * @param {Function} callbackForLoad - A function that executes the asynchronous load with the following signature: callbackForLoad(id, callbackAfterLoad(id, instance, messageObject), oldInstance)
     * @param {Object} dataForInstantiation - Optional data that can be used for the instantiation
     * @param {String} dataForInstantiation.id Id used for instantiation
     * @param {Object} dataForInstantiation.instance Instance used for instantiation                                   
     * @constructor
     */
    sap.apf.modeler.core.LazyLoader = function (inject, callbackForLoad, dataForInstantiation) {
    	
		var object = {
			id              : null,
			instance        : null,
			isInitializing  : false,
			callbacksAfterAsyncGet : new inject.constructor.hashtable(inject.instance.messageHandler)	
		},
		oldInstance = null;
	    
		if(dataForInstantiation){
			object.id       = dataForInstantiation.id;
			object.instance = dataForInstantiation.instance;
		}
		
		this.type = "lazyLoader";
		
		 /**
         * @private
         * @name sap.apf.modeler.core.lazyLoader#getId
         * @function
         * @description Return the id that is currently loaded
         * @returns {String|Null}                    
         */    	
    	this.getId = function(){
    		return object.id;
    		};
		/**
         * @private
         * @name sap.apf.modeler.core.lazyLoader#getInstance
         * @function
         * @description Return the instance that is currently loaded
         * @returns {Object|Null}                    
         */    	
    	this.getInstance = function(){
    		return object.instance;
    	};
    	/**
         * @private
         * @name sap.apf.modeler.core.lazyLoader#isInitializing
         * @function
         * @description Returns whether the loader is initializing
         * @returns {Boolean}                    
         */    	
    	this.isInitializing = function(){
    		return object.isInitializing;
    	};
        /**
         * @private
         * @name sap.apf.modeler.core.lazyLoader#reset
         * @function
         * @description Reset the internal state of the lazyLoad object                    
         */    	
    	this.reset = function(){
    		oldInstance = object.instance; // !!!: to be able to reload the data for the new Id into the old instance
    		object = {
    				id              : null,
    				isInitializing  : false,
    				callbacksAfterAsyncGet : new inject.constructor.hashtable(inject.instance.messageHandler),
    				instance        : null
    			};
    	};

        function callbackAfterLoad(id, instance, messageObject){
            if(id !== object.id){
                return;
            }
            object.isInitializing = false;
            if(!messageObject){
                object.instance = instance;
            }
            object.callbacksAfterAsyncGet.each(function(key, callbackArray){
                callbackArray.forEach(function(callbackAfterAsyncGet){
                    callbackAfterAsyncGet( object.instance, messageObject, object.id);
                });
            });
            object.callbacksAfterAsyncGet = null;
        }
        function memorizeCallback(callbackAfterAsyncGet){
            var i;
            var found,
                callbackArray;
            callbackArray = object.callbacksAfterAsyncGet.getItem(callbackAfterAsyncGet);
            if(!callbackArray){
                object.callbacksAfterAsyncGet.setItem(callbackAfterAsyncGet, [callbackAfterAsyncGet]);
                return;
            }
            found = false;
            for(i = 0; i < callbackArray.length; i++){
                if(callbackArray[i]===callbackAfterAsyncGet){
                    found = true;
                    break;
                }
            }
            if(!found){
                callbackArray.push(callbackAfterAsyncGet);
            }
        }

        /**
         * @private
         * @name sap.apf.modeler.core.lazyLoader#asyncGetInstance
         * @function
         * @description Execute an asynchronous get for a certain object id
         * @param {String} id - Id of the object
         * @param {function(id, instance, messageObject)} callbackAfterAsyncGet Callback return either the object instance or a message object
         * @param {string} callbackAfterAsyncGet.id
         * @param {object} callbackAfterAsyncGet.instance
         * @param {sap.apf.core.MessageObject} callbackAfterAsyncGet.messageObject
         */
    	this.asyncGetInstance = function(id, callbackAfterAsyncGet){
    		
    		if(object.id && id !== object.id){ 
    			this.reset();
    		}
    		if(object.id && object.instance){
    			callbackAfterAsyncGet(object.instance, undefined, object.id);
    			return;  
    		} 
    		
    		memorizeCallback(callbackAfterAsyncGet);
    		
    		if(!object.isInitializing){
    			object.isInitializing = true;    			
    			object.id = id;
    		    object.instance = null;
    		    callbackForLoad(id, callbackAfterLoad, oldInstance);
    		   }
    	};
    	
    };
}());

}; // end of sap/apf/modeler/core/lazyLoader.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.messageDefinition') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.modeler.core.messageDefinition");

sap.apf.modeler.core.messageDefinition = [ {
	code : "11005",
	severity : "technError",
	text : "Bad HTTP request returned status code {0} with status text {1}."
}, {
	code : "11006",
	severity : "technError",
	text : "Unknown identifier: {0}"
}, {
	code : "11007",
	severity : "technError",
	text : "Cannot export unsaved configuration. Configuration ID: {0}"
}, {
	code : "11008",
	severity : "error",
	description : "Format information is missing at least for text element {0} - please edit the exported text property file manually",
	key : "11008"
}, {
	code : "11009",
	severity : "error",
	description : "Application id {0} cannot be used as translation uuid in text property file - please edit the exported text property file manually",
	key : "11009"
}, {
	code : "11010",
	severity : "error",
	description : "Imported text property file does not contain the APF application id - expected an entry like #ApfApplicationId=543EC63F05550175E10000000A445B6D.",
	key : "11010"
}, {
	code : "11011",
	severity : "error",
	description : "Expected a valid text entry <key>=<value> in line {0}, but could not find - key must be in valid guid format.",
	key : 11011
}, {
	code : "11012",
	severity : "error",
	description : "No valid text entry <key>=<value> in line {0}, key is not in valid guid format like 543EC63F05550175E10000000A445B6D.",
	key : 11012
}, {
	code : "11013",
	severity : "technError",
	text : "Metadata request {3} to server failed with http status code {0}, http error message {1}, and server response {2}",
	key : "11013"
}, {
	code : "11014",
	severity : "error",
	description : "ApfApplicationId in line {0} has invalid format - a valid application id looks like 543EC63F05550175E10000000A445B6D.",
	key : "11014"
}, {
	code : "11015",
	severity : "error",
	description : "Date in line {0} has invalid format.",
	key : "11015"
}, {
	code : "11020",
	severity : "error",
	description : "Text property has invalid format and cannot be imported - see previous messages for details",
	key : "11020"
}, {
	code : "11021",
	severity : "error",
	description : "ApfApplicationId {0} referenced in the text property is not yet existing - please load one configuration of the application before importing the texts.",
	key : "11021"
},
{
	code : "11030",
	severity : "error",
	description : "Label {0} is not valid",
	key : "11030"
},
{
	code : "11031",
	severity : "error",
	description : "Category {0} is not valid",
	key : "11031"
},
{
	code : "11032",
	severity : "error",
	description : "Request {0} is not valid",
	key : "11032"
},
{
	code : "11033",
	severity : "error",
	description : "Binding {0} is not valid",
	key : "11033"
},
{
	code : "11034",
	severity : "error",
	description : "Facet filter {0} is not valid",
	key : "11034"
},
{
	code : "11035",
	severity : "error",
	description : "Step {0} is not valid",
	key : "11035"
},
{
	code : "11036",
	severity : "error",
	description : "Configuration is not valid",
	key : "11036"
},
{
	code : "11037",
	severity : "error",
	description : "Invalid application guid {0}",
	key : "11037"
},
{
	code : "11038",
	severity : "error",
	description : "Invalid configuration guid {0}",
	key : "11038"
},
{
	code : "11039",
	severity : "error",
	description : "Invalid text guid {0}",
	key : "11039"
},
{
	code : "11040",
	severity : "error",
	description : "Navigation target {0} is not valid",
	key : "11040"
},{
	code : "11041",
	severity : "technError",
	text : "Network service for retrieving semantic objects failed - see console."
},{
	code : "11042",
	severity : "technError",
	text : "Error occurred when retrieving actions for semantic object - see console."
}
];
}; // end of sap/apf/modeler/core/messageDefinition.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.navigationTarget') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2015 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.navigationTarget");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.navigationTarget
     * @class A navigation target proxy object providing editor methods on configuration objects.
     * @param {Object} [dataFromCopy] - Optional parameter to set the internal state of the new instance during a copy operation 
     * @constructor
     */
    sap.apf.modeler.core.NavigationTarget = function (navigationTargetId, dataFromCopy) {
    	var semObject,
    	    actn;
    	
    	if(dataFromCopy){
    		semObject = dataFromCopy.semObject;
    		actn = dataFromCopy.actn;
    	}
    	
    	 /**
         * @private
         * @name sap.apf.modeler.core.NavigationTarget#getId
         * @function
         * @description The immutable id of the navigation target
         * @returns {String} id
         */
        this.getId = function () {
            return navigationTargetId;
        };
    	/**
         * @private
         * @name sap.apf.modeler.core.NavigationTarget#setSemanticObject
         * @function
         * @description Set the semantic object of the navigation target
         * @param {string} semanticObject
         */
        this.setSemanticObject = function(semanticObject) {
        	semObject = semanticObject;
        };
      	/**
         * @private
         * @name sap.apf.modeler.core.NavigationTarget#getSemanticObject
         * @function
         * @description Get the semantic object of the navigation target
         * @returns {String} semantic object 
         */
        this.getSemanticObject = function() {
        	return semObject;
        };
     	/**
         * @private
         * @name sap.apf.modeler.core.NavigationTarget#setAction
         * @function
         * @description Set the action of the navigation target
         * @param {string} action
         */
        this.setAction = function(action) {
        	actn = action;
        };
      	/**
         * @private
         * @name sap.apf.modeler.core.NavigationTarget#getAction
         * @function
         * @description Get the action of the navigation target
         * @returns {String} action 
         */
        this.getAction = function() {
        	return actn;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.NavigationTargetr#copy
         * @function
         * @description Execute a deep copy of the navigation target
         * @param {String} [newIdForCopy] - Optional new Id for the copied instance
         * @returns {Object} sap.apf.modeler.core.NavigationTarget# - New navigation target object being a copy of this object
         */
        this.copy = function( newIdForCopy ){
        	var dataForCopy = {
        			semObject : semObject,
		            actn      : actn };
        	var dataFromCopy = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy( dataForCopy );
        	return new sap.apf.modeler.core.NavigationTarget( (newIdForCopy || this.getId()), dataFromCopy);
        };
    };

}()); 
}; // end of sap/apf/modeler/core/navigationTarget.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.parseTextPropertyFile') ) {
jQuery.sap.declare("sap.apf.modeler.core.parseTextPropertyFile");
jQuery.sap.require('sap.ui.core.format.DateFormat'); // unlisted dependency retained



(function() {
	'use strict';

	/**
	 * @private
	 * @function
	 * @description parses a text property file and returns the text elements and the application id
	 *  plus messages
	 *  @param {string} textFileString property file as string
	 *  @param {object} inject injected instances 
	 * @returns {object} result with properties Application, TextElements, Messages
	 */
	sap.apf.modeler.core.parseTextPropertyFile = function(textFileString, inject) {

		function complain(messageNumber, lineNumber) {
			var message = messageHandler.createMessageObject({
				code : messageNumber,
				aParameters : [ lineNumber ]
			});
			
			parseResult.Messages.push(message);
		}
		function complainWrongFormatApplicationId(lineNumber) {
			complain(11013, lineNumber);
		}

		function complainMissingTextEntry(lineNumber) {
			complain(11011, lineNumber);
		}

		function isValidGuidFormatForTextElement(textElement, lineNumber) {
			var isValid = sap.apf.utils.isValidGuid(textElement);

			if (!isValid) {
				complain(11012, lineNumber);
				return false;
			} else {
				return true;
			}
		}
		
		function complainWrongDateFormat(lineNumber){
			complain(11015, lineNumber);
		}

		function complainInvalidTextEntryGuid(lineNumber) {
			complain(11012, lineNumber);
		}
		
		var messageHandler = inject.instance.messageHandler;
		var oDateFormat = sap.ui.core.format.DateFormat.getDateTimeInstance({
			pattern : "yyyy/MM/dd HH:mm:ss"
		});
		var oDate;
		var aLines = textFileString.split(/\r?\n/);
		var len = aLines.length;
		var i;
		var indexOfExpectedEntry = -1;
		var indexOfLastChangeDate = -1;
		var textElementEntry;
		var formatWithHint, formatWithoutHint, entry;
		var bApplicationIdFound = false;
		var parseResult = {
			Application : undefined,
			TextElements : [],
			Messages : []
		};

		for(i = 0; i < len; i++) {

			if (!bApplicationIdFound) {

				var applicationId = /^\#\s*ApfApplicationId=[0-9A-F]+\s*$/.exec(aLines[i]);
				if (applicationId !== null) {
					parseResult.Application = aLines[i].split('=')[1];
					if (!sap.apf.utils.isValidGuid(parseResult.Application)) {
						parseResult.Application = "";
						complainWrongFormatApplicationId(i);
					}
					bApplicationIdFound = true;

					continue;
				}
			}

			if (aLines[i] === "") {
				continue;
			}
			
			if (indexOfLastChangeDate === i && /^\#\s*LastChangeDate/.exec(aLines[i])) {
				//# LastChangeDate=2014/10/07 16:30:29
				entry = aLines[i].split('=');
				if (entry.length === 2) {
					oDate = oDateFormat.parse(entry[1]);
					if (!oDate) {
						complainWrongDateFormat(i);
						textElementEntry.LastChangeUTCDateTime = "";
					} else {
						textElementEntry.LastChangeUTCDateTime = '/Date(' + oDate.getTime() + ')/';
					}	
					parseResult.TextElements.push(textElementEntry);
				} else {
					complainWrongDateFormat(i);
				}
				textElementEntry = null;
				continue;
			}

			if (indexOfExpectedEntry === i) {
				entry = aLines[i].split('=');
				if (entry.length === 2) {

					// take over only proper entries
					if (isValidGuidFormatForTextElement(entry[0], i)) {
						textElementEntry.TextElement = entry[0];
						textElementEntry.TextElementDescription = entry[1];
					} else {
						complainInvalidTextEntryGuid(i);
					}

				} else {
					complainMissingTextEntry(i);
				}
				continue;
			}

			formatWithHint = /^\#(X|Y)[A-Z]{3},[0-9]+:/.exec(aLines[i]);
			if (formatWithHint) {
				if (indexOfExpectedEntry === i) {
					complainMissingTextEntry(i);
				}
				textElementEntry = {};
				textElementEntry.Language = sap.apf.core.constants.developmentLanguage;  //Default development language
				textElementEntry.Application = parseResult.Application;
				textElementEntry.TextElementType = aLines[i].match(/(X|Y)[A-Z]{3}/)[0];
				textElementEntry.MaximumLength = aLines[i].match(/,[0-9]+/);
				textElementEntry.MaximumLength = parseInt(textElementEntry.MaximumLength[0].substring(1), 10);
				textElementEntry.TranslationHint = aLines[i].match(/:\s*[0-9a-zA-Z\s]+$/);
				textElementEntry.TranslationHint = textElementEntry.TranslationHint[0].substring(1);

				indexOfExpectedEntry = i + 1;
				indexOfLastChangeDate = i + 2;
			} else {

				formatWithoutHint = /^\#(X|Y)[A-Z]{3},[0-9]+/.exec(aLines[i]);
				if (formatWithoutHint) {
					if (indexOfExpectedEntry === i) {
						complainMissingTextEntry(i);
					}
					textElementEntry = {};
					textElementEntry.Language = sap.apf.core.constants.developmentLanguage;  //Default development language
					textElementEntry.Application = parseResult.Application;
					textElementEntry.TextElementType = aLines[i].match(/(X|Y)[A-Z]{3}/)[0];
					textElementEntry.MaximumLength = aLines[i].match(/,[0-9]+/);
					textElementEntry.MaximumLength = parseInt(textElementEntry.MaximumLength[0].substring(1), 10);
					textElementEntry.TranslationHint = "";
					indexOfExpectedEntry = i + 1;
					indexOfLastChangeDate = i + 2;
				} 
			}
		}
		if (!bApplicationIdFound) {
			complain(11010, 0);
		}
		return parseResult;
	}; 
}()); 
}; // end of sap/apf/modeler/core/parseTextPropertyFile.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.registryWrapper') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, core, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.registryWrapper");

(function () {
    'use strict';

    /**
     * @private
     * @memberOf sap.apf.modeler.core
     * @name sap.apf.modeler.core.RegistryWrapper
     * @class Defines a wrapper around the registry received by injection from the ConfigurationFactory.
     *  This class defines access methods to first class citizen configuration objects after loading them from file or service.
     * @param {sap.apf.core.utils.Hashtable} hashtable - Registry that will be wrapped.
     * @constructor
     */
    sap.apf.modeler.core.RegistryWrapper = function (hashtable) {

        /**
         * @private
         * @function
         * @name getItemsByType
         * @description Retrieve all configuration objects (after loading) from a registry.
         * @param {String} type - value domain: "step", "request", "binding", "category", "facetFilter", "representationType"
         * @returns {Object[]}
         */
        function getItemsByType(type) {
            var aResults = [];
            if (hashtable.getNumberOfItems() !== 0) {
                hashtable.each(function (index, element) {
                    if (element.type === type) {
                        aResults.push(element);
                    }
                });
            }
            return aResults;
        }
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.RegistryWrapper#getItem
         * @description Retrieve any item by its key (after loading) from a registry.
         * @returns {Object}
         */
        this.getItem = function(key) {
            return hashtable.getItem(key);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.RegistryWrapper#getSteps
         * @description Retrieve all steps (after loading) from a registry.
         * @returns {Object[]}
         */
        this.getSteps = function() {
            return getItemsByType("step");
        };

        /**
         * Retrieve all categories (after loading) from a registry.
         * @private
         * @function
         * @name sap.apf.modeler.core.RegistryWrapper#getCategories
         * @returns {Object[]}
         */
        this.getCategories = function() {
            return getItemsByType("category");
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.RegistryWrapper#getFacetFilters
         * @description Retrieve all facet filters from a registry.
         * @returns {Object[]}
         */
        this.getFacetFilters = function() {
            return getItemsByType("facetFilter");
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.RegistryWrapper#getNavigationTargets
         * @description Retrieve all facet filters from a registry.
         * @returns {Object[]}
         */
        this.getNavigationTargets = function() {
            return getItemsByType("navigationTarget");
        };

    };
}());

}; // end of sap/apf/modeler/core/registryWrapper.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.representation') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, core, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.representation");

(function () {
    'use strict';

    /**
     * @private
     * @memberOf sap.apf.modeler.core
     * @name sap.apf.modeler.core.Representation
     * @class A proxy object for representations providing editor methods on configuration objects.
     * @param {String} representationId - identifier.
     * @param {Object} inject - Injection of required APF object references, constructors and functions.
     * @param {sap.apf.core.utils.MessageHandler} inject.instance.messageHandler - MessageHandler instance
     * @param {Object} inject.constructor - Injected constructors
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable - Hashtable constructor
     * @param {Object} dataFromCopy - Optional parameter to set the internal state of the new instance during a copy operation 
     * @constructor
     */
    sap.apf.modeler.core.Representation = function (representationId, inject, dataFromCopy) {
        var representationTypeId,
            alternateRepresentationTypeId,
            width,
            dimensions,
            measures,
            leftUpperCornerTextKey,
            rightUpperCornerTextKey,
            leftLowerCornerTextKey,
            rightLowerCornerTextKey,
            orderByProperties;

        if(!dataFromCopy){
            width = {};	
            dimensions = new inject.constructor.elementContainer("dimension", undefined, inject);
            measures = new inject.constructor.elementContainer("measure", undefined, inject);
            orderByProperties = new inject.constructor.elementContainer("orderBy", undefined, inject);
        }else{
	    	representationTypeId = dataFromCopy.representationTypeId;
	        alternateRepresentationTypeId = dataFromCopy.alternateRepresentationTypeId;
	        width = dataFromCopy.width;
	        dimensions = dataFromCopy.dimensions;
	        measures = dataFromCopy.measures;
	        leftUpperCornerTextKey = dataFromCopy.leftUpperCornerTextKey;
	        rightUpperCornerTextKey = dataFromCopy.rightUpperCornerTextKey;
	        leftLowerCornerTextKey = dataFromCopy.leftLowerCornerTextKey;
	        rightLowerCornerTextKey = dataFromCopy.rightLowerCornerTextKey;
	        orderByProperties = dataFromCopy.orderByProperties;	
        }

        /**
         * @private
         * @name sap.apf.modeler.core.Representation#getId
         * @function
         * @description Return the immutable id.
         * @returns {String}
         */
        this.getId = function () {
            return representationId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setRepresentationType
         * @description Mandatory member representationType
         * @param {String} - Representation type Id
         */
        this.setRepresentationType = function (typeId) {
            representationTypeId = typeId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getRepresentationType
         * @description Mandatory member representationType
         * @returns {String} typeId
         */
        this.getRepresentationType = function () {
            return representationTypeId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setAlternateRepresentationType
         * @description Optional property of a representation.
         * @param {String} typeId
         */
        this.setAlternateRepresentationType = function (typeId) {
            alternateRepresentationTypeId = typeId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getAlternateRepresentationType
         * @returns {String} typeId
         */
        this.getAlternateRepresentationType = function () {
            return alternateRepresentationTypeId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getDimensions
         * @description Return a list ID's of parameter objects describing dimensions of a representation.
         *      Each parameter object has a method getId() which returns the propertyName.
         * @returns {String[]} - an array of ID's
         */
        this.getDimensions = function () {
            var list = [];
            dimensions.getElements().forEach(function (obj) {
                list.push(obj.propertyName);
            });
            return list;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#addDimension
         * @description Create and add a parameter object describing a dimension.
         *      Each stored parameter object has a method getId() which returns the given propertyName.
         *      WHEN calling twice on the same propertyName (without removing it) THEN the second call will be ignored and null returned.
         * @param {String} propertyName - OData property name
         * @param {String} [textLabelKey] - Optional property of the identified dimension parameter.
         * @returns {String} - An id which is the given propertyName
         */
        this.addDimension = function (propertyName, textLabelKey) {
            var obj;
            if (dimensions.getElement(propertyName)) { // when exists
                return null;
            }
            obj = {
                propertyName: propertyName,
                textLabelKey: textLabelKey
            };
            return dimensions.createElementWithProposedId(obj, propertyName).getId();
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#removeDimension
         * @description Remove the parameter object that is identified by the given OData property name.
         * @param {String} propertyName
         */
        this.removeDimension = function (propertyName) {
            dimensions.removeElement(propertyName);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setDimensionKind
         * @description Set the kind of the dimension for a given representationType. The representationType defines the supported kinds.
         * @param {String} propertyName - OData property name
         * @param {String} kind - A kind of dimension.
         */
        this.setDimensionKind = function (propertyName, kind) {
            var object = dimensions.getElement(propertyName);
            if (object) {
                object.kind = kind;
            }
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getDimensionKind
         * @description Return the kind of dimension.
         *      The property is optional, and the default value undefined.
         * @param {String} propertyName - OData property name
         * @returns {String|undefined} - A kind of dimension.
         */
        this.getDimensionKind = function (propertyName) {
            var object = dimensions.getElement(propertyName);
            if (object) {
                return object.kind;
            }
            return undefined;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setDimensionTextLabelKey
         * @description Set the text key of the parameter object identified by the propertyName. This property of the parameter object is optional.
         * @param {String} propertyName - OData property name
         * @param {String} textLabelKey - A text id/key (GUID).
         */
        this.setDimensionTextLabelKey = function (propertyName, textLabelKey) {
            var object = dimensions.getElement(propertyName);
            if (object) {
                object.textLabelKey = textLabelKey;
            }
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getDimensionTextLabelKey
         * @description Return the text key of the identified parameter object.
         *      Return undefined if there is no object defined for the given propertyName.
         * @param {String} propertyName - OData property name
         * @returns {String|undefined} - A text id/key (GUID).
         */
        this.getDimensionTextLabelKey = function (propertyName) {
            var object = dimensions.getElement(propertyName);
            if (object) {
                return object.textLabelKey;
            }
            return undefined;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getMeasures
         * @description Return a list of parameter objects describing measures of a representation.
         *      Each parameter object has a method getId() which returns the propertyName.
         * @returns {String[]} - list of ids which are propertyNames
         */
        this.getMeasures = function () {
            var list = [];
            measures.getElements().forEach(function (obj) {
                list.push(obj.propertyName);
            });
            return list;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#addMeasure
         * @description Add a parameter object describing a measure.
         *      WHEN calling twice on the same propertyName (without removing it) THEN the second call will be ignored and nul returned.
         * @param {String} propertyName
         */
        this.addMeasure = function (propertyName) {
            var obj;
            if (measures.getElement(propertyName)) {
                return null;
            }
            obj = {
                propertyName: propertyName
            };
            return measures.createElementWithProposedId(obj, propertyName).getId();
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#removeMeasure
         * @description Remove the measure which is identified by its OData property name.
         * @param {String} propertyName
         */
        this.removeMeasure = measures.removeElement;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setMeasureTextLabelKey
         * @description Set the text key of the parameter object. This part of the parameter object is optional.
         * @param {String} propertyName - OData property name
         * @param {String} textLabelKey - A text id/key (GUID).
         */
        this.setMeasureTextLabelKey = function (propertyName, textLabelKey) {
            var object = measures.getElement(propertyName);
            if (object) {
                object.textLabelKey = textLabelKey;
            }
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getMeasureTextLabelKey
         * @description Return the text key of the parameter object.
         *      Return undefined if there is no object defined for the given propertyName.
         * @param {String} propertyName - OData property name
         * @returns {String|undefined} - A text id/key (GUID).
         */
        this.getMeasureTextLabelKey = function (propertyName) {
            var object = measures.getElement(propertyName);
            if (object) {
                return object.textLabelKey;
            }
            return undefined;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setMeasureKind
         * @description Set the kind of the measure for a given representationType. The representationType defines the supported kinds.
         * @param {String} propertyName - OData property name
         * @param {String} kind - A kind of measure.
         */
        this.setMeasureKind = function (propertyName, kind) {
            var object = measures.getElement(propertyName);
            if (object) {
                object.kind = kind;
            }
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getMeasureKind
         * @description Return the kind of measure.
         *      The property is optional, and the default value undefined.
         * @param {String} propertyName - OData property name
         * @returns {String|undefined} - A kind of measure.
         */
        this.getMeasureKind = function (propertyName) {
            var object = measures.getElement(propertyName);
            if (object) {
                return object.kind;
            }
            return undefined;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setWidthProperty
         * @description Add a width property to the representation.
         *      The width is optional and used for table representations specifying the width of table columns.
         * @param {String} propertyName
         * @param {Object} propertyValue
         */
        this.setWidthProperty = function (propertyName, propertyValue) {
            width[propertyName] = propertyValue;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getWidthProperties
         * @description Return a width object literal containing all width properties of a representation.
         *      The width object is optional and used for table representations specifying the width of table columns.
         * @return {Object|undefined}
         */
        this.getWidthProperties = function () {
            return width;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setLeftUpperCornerTextKey
         * @description Optional member.
         *          When the value is null or undefined the corner text will be omitted from the serialized configuration object.
         *          The initial value is set to undefined.
         * @param {String|null} textKey
         */
        this.setLeftUpperCornerTextKey = function (textKey) {
            leftUpperCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getLeftUpperCornerTextKey
         * @description Get optional member.
         * @returns {String|undefined|null} Return a textKey (GUID). Returns undefined when initial, null or undefined when set to null or undefined.
         */
        this.getLeftUpperCornerTextKey = function () {
            return leftUpperCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setRightUpperCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setRightUpperCornerTextKey = function (textKey) {
            rightUpperCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getRightUpperCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getRightUpperCornerTextKey = function () {
            return rightUpperCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setLeftLowerCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setLeftLowerCornerTextKey = function (textKey) {
            leftLowerCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getLeftLowerCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getLeftLowerCornerTextKey = function () {
            return leftLowerCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#setRightLowerCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setRightLowerCornerTextKey = function (textKey) {
            rightLowerCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getRightLowerCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getRightLowerCornerTextKey = function () {
            return rightLowerCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#addOrderbySpec
         * @description Add a specification describing the ordering of a property in OData.
         *      Can be used to update an existing specification identified by the property name.
         *      The specification is optional.
         * @param {String} propertyName
         * @param {boolean} propertyName - when ascending == true then the "asc" will be omitted in the OData URI.
         *      Otherwise "desc" will be rendering in the URI.
         */
        this.addOrderbySpec = function (propertyName, ascending) {
            var obj;
            obj = orderByProperties.getElement(propertyName);
            if (obj) {
                obj.ascending = ascending;
                return obj;
            }
            obj = {
                property: propertyName,
                ascending: ascending
            };
            return orderByProperties.createElementWithProposedId(obj, propertyName).getId();
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#removeOrderbySpec
         * @description Remove the order specification that is identified by the given OData property name.
         * @param {String} propertyName
         */
        this.removeOrderbySpec = function (propertyName) {
            orderByProperties.removeElement(propertyName);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Representation#getMeasures
         * @description Return a list of parameter objects describing measures of a representation.
         *      Each parameter object has a method getId() which returns the propertyName.
         * @returns {String[]} - list of ids which are propertyNames
         */
        this.getOrderbySpecifications = function () {
            var list = [];
            orderByProperties.getElements().forEach(function (obj) {
                list.push({
                    property: obj.property,
                    ascending: obj.ascending
                });
            });//forEach
            return list;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Representation#copy
         * @function
         * @description Execute a deep copy of the representation and its referenced objects
         * @param {String} newIdForCopy - New Id for the copied instance
         * @returns {Object} sap.apf.modeler.core.Representation# - New representation object being a copy of this object
         */
        this.copy = function( newIdForCopy ){
        	var dataForCopy = {
        			representationTypeId : representationTypeId,
                    alternateRepresentationTypeId : alternateRepresentationTypeId,
                    width : width,
                    dimensions : dimensions,
                    measures : measures,
                    leftUpperCornerTextKey : leftUpperCornerTextKey,
                    rightUpperCornerTextKey : rightUpperCornerTextKey,
                    leftLowerCornerTextKey : leftLowerCornerTextKey,
                    rightLowerCornerTextKey : rightLowerCornerTextKey,
                    orderByProperties : orderByProperties };
        	
        	var dataFromCopy = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy( dataForCopy );
        	return new sap.apf.modeler.core.Representation( (newIdForCopy || this.getId()), inject, dataFromCopy);
        };
    };
}());
}; // end of sap/apf/modeler/core/representation.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.step') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.step");

(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.Step
     * @class A step proxy object providing editor methods on configuration objects.
     * @param {String} stepId - unique Id within configuration.
     * @param {Object} inject - Injection of required APF object references, constructors and functions.
     * @param {sap.apf.core.utils.MessageHandler} inject.instance.messageHandler - MessageHandler instance
     * @param {Object} inject.constructor - Injected constructors
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable - Hashtable constructor
     * @param {Object} dataFromCopy - Optional parameter to set the internal state of the new instance during a copy operation
     * @constructor
     */
    sap.apf.modeler.core.Step = function (stepId, inject, dataFromCopy) {
        var representationContainer,
            request,
            selectProperties,
            filterProperties,
            requestForFilterMapping, 
            selectPropertiesForFilterMapping,
            targetPropertiesForFilterMapping,
            keepSourceForFilterMapping,
            titleId,
            longTitleId,
            leftUpperCornerTextKey,
            rightUpperCornerTextKey,
            leftLowerCornerTextKey,
            rightLowerCornerTextKey;

        if(!dataFromCopy){
        	representationContainer = new inject.constructor.elementContainer(stepId + "-Representation", inject.constructor.representation, inject);
            request = {};
            selectProperties = new inject.constructor.elementContainer("SelectProperty", undefined, inject);
            filterProperties = new inject.constructor.elementContainer("FilterProperty", undefined, inject);
            requestForFilterMapping = {}; 
            selectPropertiesForFilterMapping = new inject.constructor.elementContainer("SelectPropertyForFilterMapping", undefined, inject);
            targetPropertiesForFilterMapping = new inject.constructor.elementContainer("TargetPropertyForFilterMapping", undefined, inject);
            keepSourceForFilterMapping = false;
        }else{
        	representationContainer = dataFromCopy.representationContainer;
            request = dataFromCopy.request;
            selectProperties = dataFromCopy.selectProperties;
            filterProperties = dataFromCopy.filterProperties;
            requestForFilterMapping = dataFromCopy.requestForFilterMapping;
            selectPropertiesForFilterMapping = dataFromCopy.selectPropertiesForFilterMapping;
            targetPropertiesForFilterMapping = dataFromCopy.targetPropertiesForFilterMapping;
            keepSourceForFilterMapping = dataFromCopy.keepSourceForFilterMapping;
            titleId = dataFromCopy.titleId;
            longTitleId = dataFromCopy.longTitleId;
            leftUpperCornerTextKey = dataFromCopy.leftUpperCornerTextKey;
            rightUpperCornerTextKey = dataFromCopy.rightUpperCornerTextKey;
            leftLowerCornerTextKey = dataFromCopy.leftLowerCornerTextKey;
            rightLowerCornerTextKey = dataFromCopy.rightLowerCornerTextKey;
        }

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getId
         * @function
         * @description The immutable id of the step
         * @returns {String}
         */
        this.getId = function () {
            return stepId;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getService
         * @function
         * @returns {string} - service root
         */
        this.getService = function () {
            return request.service;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#setService
         * @function
         * @description Set the service root.
         * @param {string} serviceRoot - serviceRoot URI
         */
        this.setService = function (serviceRoot) {
            request.service = serviceRoot;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getEntitySet
         * @function
         * @returns {string} - entitySetName
         */
        this.getEntitySet = function () {
            return request.entitySet;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#setEntitySet
         * @function
         * @description Set the entitySet.
         * @param {string} entitySet - entitySet name
         */
        this.setEntitySet = function (entitySet) {
            request.entitySet = entitySet;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#setTitleId
         * @function
         * @description Set the title id.
         * @param {String} id Title id
         */
        this.setTitleId = function (id) {
            titleId = id;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getTitleId
         * @function
         * @description Returns the title id.
         * @returns {String}
         */
        this.getTitleId = function () {
            return titleId;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#setLongTitleId
         * @function
         * @description Set the longTitle id.
         * @param {String} id LongTitle id
         */
        this.setLongTitleId = function (id) {
            longTitleId = id;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getLongTitleId
         * @function
         * @description Returns the longTitle id.
         * @returns {String}
         */
        this.getLongTitleId = function () {
            return longTitleId;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#getSelectProperties
         * @function
         * @description Return an array of the mutable OData properties of the step and its request.
         * @returns {String[]}
         */
        this.getSelectProperties = function () {
            var list = [];
            var lll = selectProperties.getElements();
            lll.forEach(function (item) {
                list.push(item.getId());
            });
            return list;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#addSelectProperty
         * @function
         * @description Add an OData properties.
         * @param {string} property - property name
         */
        this.addSelectProperty = function (property) {
            selectProperties.createElementWithProposedId(undefined, property);
        };
        /**
         * @private
         * @name sap.apf.modeler.core.Step#removeSelectProperty
         * @function
         * @description Remove an OData properties.
         * @param {string} property - property name
         */
        this.removeSelectProperty = function (property) {
            selectProperties.removeElement(property);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getFilterProperties
         * @description The mutable filter properties.
         * @returns {String[]}
         */
        this.getFilterProperties = function () {
            var list = [];
            var lll = filterProperties.getElements();
            lll.forEach(function (item) {
                list.push(item.getId());
            });
            return list;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#addFilterProperty
         * @description Add an OData properties.
         * @param {string} property - property name
         */
        this.addFilterProperty = function (property) {
            return filterProperties.createElementWithProposedId(undefined, property).getId();
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#removeFilterProperty
         * @description Remove an OData properties.
         * @param {string} property - property name
         */
        this.removeFilterProperty = function (property) {
            filterProperties.removeElement(property);
        };

        /**
         * @private
         * @name sap.apf.modeler.core.Step#setFilterMappingService
         * @function
         * @description Sets the service root for filter mapping. 
         * @param {string} serviceRoot - service root for filter mapping
         */
        this.setFilterMappingService = function(serviceRoot){
        	requestForFilterMapping.service = serviceRoot;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#getFilterMappingService
         * @function
         * @description Returns the service root for filter mapping. 
         * @returns {string} - Service root for filter mapping
         */
        this.getFilterMappingService = function () {
            return requestForFilterMapping.service;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#setFilterMappingEntitySet
         * @function
         * @description Sets the entity set for filter mapping. 
         * @param {string} entitySet - Entity set for filter mapping
         */
        this.setFilterMappingEntitySet = function(entitySet){
        	requestForFilterMapping.entitySet = entitySet;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#getFilterMappingEntitySet
         * @function
         * @description Returns the entity set for filter mapping. 
         * @returns {string} - Entity set for filter mapping
         */
        this.getFilterMappingEntitySet = function () {
            return requestForFilterMapping.entitySet;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#addFilterMappingSelectProperty
         * @function
         * @description Adds a select property for filter mapping.
         * @param {string} property - Property name
         */
        this.addFilterMappingSelectProperty = function (property) {
            return;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#getFilterMappingSelectProperty
         * @function
         * @description Returns an array of select properties for filter mapping.
         * @returns {String[]}
         */
        this.getFilterMappingSelectProperties = function () {            
            return [];
        };
        
        /**
         * @deprecated
         * @private
         * @name sap.apf.modeler.core.Step#removeFilterMappingSelectProperty
         * @function
         * @description Removes a select property for filter mapping
         * @param {string} property - Property name
         */
        this.removeFilterMappingSelectProperty = function (property) {
        	return;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#addFilterMappingTargetProperty
         * @function
         * @description Adds a target property for filter mapping.
         * @param {string} property - Property name
         */
        this.addFilterMappingTargetProperty = function (property) {
            targetPropertiesForFilterMapping.createElementWithProposedId(undefined, property);
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#getFilterMappingTargetProperties
         * @function
         * @description Returns an array of target properties for filter mapping.
         * @returns {String[]}
         */
        this.getFilterMappingTargetProperties = function () {
            var propertylist = [];
            var propertyElementList = targetPropertiesForFilterMapping.getElements();
            propertyElementList.forEach(function (item) {
            	propertylist.push(item.getId());
            });
            return propertylist;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#removeFilterMappingTargetProperty
         * @function
         * @description Removes a filter mapping target property
         * @param {string} property - Property name
         */
        this.removeFilterMappingTargetProperty = function (property) {
        	targetPropertiesForFilterMapping.removeElement(property);
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.Step#setFilterMappingKeepSource
         * @function
         * @description Sets the keepSource property for filter mapping. 
         * @param {boolean} keepSource 
         */
        this.setFilterMappingKeepSource = function(keepSource){
        	keepSourceForFilterMapping = keepSource;
        };
        /**
         * @private
         * @name sap.apf.modeler.core.Step#getFilterMappingKeepSource
         * @function
         * @description Returns the keepSource property for filter mapping.
         * @returns {boolean}
         */
        this.getFilterMappingKeepSource = function () {
            return keepSourceForFilterMapping;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getRepresentations
         * @description A list of representation objects, see {@link sap.apf.modeler.core.Representation}.
         * @returns {sap.apf.modeler.core.Representation[]}
         */
        this.getRepresentations = representationContainer.getElements;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getRepresentation
         * @description Return an element if existing, see {@link sap.apf.modeler.core.Representation}.
         * @param {string} representationId
         * @returns {sap.apf.modeler.core.Representation}
         */
        this.getRepresentation = representationContainer.getElement;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#createRepresentation
         * @param {Object} [element] - Fields of optional object will be merged into created object.
         * @returns {sap.apf.modeler.core.Representation}
         */
        this.createRepresentation = representationContainer.createElement;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#removeRepresentation
         * @param {string} representationId
         */
        this.removeRepresentation = representationContainer.removeElement;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#copyRepresentation
         * @param {string} representationId
         * @returns {string} Id for new representation
         */
        this.copyRepresentation = representationContainer.copyElement;
        
        /**
         * Change the ordering by moving one representation in the ordering before another representation.
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#moveRepresentationBefore
         * @param {string} beforeRepresentationId
         * @param {string} movedRepresentationId
         * @returns {number|null} WHEN either Id is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedRepresentationId, after the move.
         */
        this.moveRepresentationBefore = function(beforeRepresentationId, movedRepresentationId) {
        	return representationContainer.moveBefore(beforeRepresentationId, movedRepresentationId);
        };
        
        /**
         * Move a representation up or down some places specified by distance
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#moveRepresentationUpOrDown
         * @param {string} representationId id of the representation, that shall be moved
         * @param {string} distance number of places
         */
        this.moveRepresentationUpOrDown = function(representationId, distance) {
        	return representationContainer.moveUpOrDown(representationId, distance);
        };
        /**
         * Change the ordering of representations by moving one representation in the ordering to the end.
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#moveRepresentationToEnd
         * @param {string} representationId
         * @returns {number|null} WHEN the key representationId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of representation(Id), after the move.
         */
        this.moveRepresentationToEnd = function(representationId) {
        	return representationContainer.moveToEnd(representationId);
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#setLeftUpperCornerTextKey
         * @description Optional member.
         *          When the value is null or undefined the corner text will be omitted from the serialized configuration object.
         *          The initial value is set to undefined.
         * @param {String|null} textKey
         */
        this.setLeftUpperCornerTextKey = function (textKey) {
            leftUpperCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getLeftUpperCornerTextKey
         * @description Get optional member.
         * @returns {String|undefined|null} Return a textKey (GUID). Returns undefined when initial, null or undefined when set to null or undefined.
         */
        this.getLeftUpperCornerTextKey = function () {
            return leftUpperCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#setRightUpperCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setRightUpperCornerTextKey = function (textKey) {
            rightUpperCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getRightUpperCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getRightUpperCornerTextKey = function () {
            return rightUpperCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#setLeftLowerCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setLeftLowerCornerTextKey = function (textKey) {
            leftLowerCornerTextKey = textKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getLeftLowerCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getLeftLowerCornerTextKey = function () {
            return leftLowerCornerTextKey;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#setRightLowerCornerTextKey
         * @description Optional member
         * @param {String|null} textKey
         */
        this.setRightLowerCornerTextKey = function (textKey) {
            rightLowerCornerTextKey = textKey;
        };


        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.Step#getRightLowerCornerTextKey
         * @description Optional member
         * @returns {String} typeId
         */
        this.getRightLowerCornerTextKey = function () {
            return rightLowerCornerTextKey;
        };

        /**
         * @private
         * @name sap.apf.modeler.core.step#copy
         * @function
         * @description Execute a deep copy of the step and its referenced objects
         * @param {String} newStepIdForCopy - New step id for the copied instance
         * @returns {Object} sap.apf.modeler.core.step# - New step object being a copy of this object
         */
        this.copy = function( newStepIdForCopy ){
        	var dataForCopy = {
				request : request,
				selectProperties : selectProperties,
				filterProperties : filterProperties,
				requestForFilterMapping : requestForFilterMapping,
				selectPropertiesForFilterMapping : selectPropertiesForFilterMapping,
				targetPropertiesForFilterMapping : targetPropertiesForFilterMapping,
				keepSourceForFilterMapping : keepSourceForFilterMapping,
				titleId : titleId,
				longTitleId : longTitleId,
				leftUpperCornerTextKey : leftUpperCornerTextKey,
				rightUpperCornerTextKey : rightUpperCornerTextKey,
				leftLowerCornerTextKey : leftLowerCornerTextKey,
				rightLowerCornerTextKey : rightLowerCornerTextKey
			};
        	
        	var dataFromCopy = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy( dataForCopy );
        	dataFromCopy.representationContainer = representationContainer.copy(newStepIdForCopy + "-Representation");
        	
        	return new sap.apf.modeler.core.Step( (newStepIdForCopy || this.getId()), inject, dataFromCopy);
        };    
    };
}());

}; // end of sap/apf/modeler/core/step.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.textHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.textHandler");

(function () {
    'use strict';

    /**
     * @private
     * @class Provides access to message texts and ui texts for the modeler
     */
    sap.apf.modeler.core.TextHandler = function () {
    	
    	var oBundleApf, oBundleModelerSpecificTexts;
    	/**
    	 * @description returns a message text for message handling
    	 * @param {string} sRessourceKey - Key of the message in the Ressourcefile
    	 * @param {string[]} [aParameters] - Parameter for placeholder replacement in the message bundle
    	 * @returns {string}
    	 */
    	this.getMessageText = function(sRessourceKey, aParameters) {
    		return this.getText(sRessourceKey, aParameters);
    	};
    	
    	/**
    	 * @description returns text
    	 * @param {string} sRessourceKey - Key of the message in the Ressourcefile
    	 * @param {string[]} [aParameters] - Parameter for placeholder replacement in the message bundle
    	 * @returns {string}
    	 */
    	this.getText = function(sRessourceKey, aParameters) {
    		var sText;
    		
    		sText = oBundleModelerSpecificTexts.getText(sRessourceKey, aParameters);
    		if (sText !== sRessourceKey) {
				return sText;
			}
    		return oBundleApf.getText(sRessourceKey, aParameters);
    	};
    	
    	function initBundles() {
    		var sUrl;
    		var sIncludeInfo = sap.ui.getCore().getConfiguration().getOriginInfo();
    		var sModulePath = jQuery.sap.getModulePath("sap.apf");
    		
    		sUrl = sModulePath + '/modeler/resources/i18n/texts.properties';
    		oBundleModelerSpecificTexts = jQuery.sap.resources({
					url : sUrl,
					includeInfo : sIncludeInfo
				});
    		sUrl = sModulePath + '/resources/i18n/apfUi.properties';
    		oBundleApf = jQuery.sap.resources({
					url : sUrl,
					includeInfo : sIncludeInfo
			});
    		 
    	}
    	
    	 initBundles();
    };
}());
}; // end of sap/apf/modeler/core/textHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.APFRouter') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
  * Router Helper Functions
**/
jQuery.sap.declare('sap.apf.modeler.ui.utils.APFRouter');
sap.apf.modeler.ui.utils.APFRouter = {
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFRouter#patternMatch
	 * @param {sap.apf.modeler.ui.controller.configurationList} context - Configuration List Context.
	 * @description Handles the startup sequence operations as well as bookmarking.Populate the respective view with the route pattern match and retains selection on the tree.
	 * */
	patternMatch : function(context) {
		this.params = {};
		var oSelf = this;
		sap.ui.core.UIComponent.getRouterFor(context).attachRoutePatternMatched(function(oEvent) {
			var configDetailView = {};
			oSelf.params = {
				name : oEvent.getParameter("name"),
				arguments : oEvent.getParameter("arguments")
			};
			if (oSelf.params.name !== "applicationList") {
				var oCoreApi = context.oCoreApi;
				context.appId = oSelf.params.arguments.appId;
				context.configId = oSelf.params.arguments.configId;
				oCoreApi.getApplicationHandler(function(oApplicationHandler) {
					context.applicationHandler = oApplicationHandler;
					context.appName = oApplicationHandler.getApplication(context.appId).ApplicationName;
					var titleText = context.byId("idConfigTitleMaster").getText();
					if (titleText === "" || oSelf.params.name === "configurationList") {
						context.setConfigListMasterTitle(context.appName);
					}
					oCoreApi.getConfigurationHandler(context.appId, function(configurationHandler) {
						context.configurationHandler = configurationHandler;
						context.oTextPool = context.configurationHandler.getTextPool();
						//Startup sequence
						if (context.configurationHandler.getList().length > context.getView().getModel().getData().aConfigDetails.length) {
							context.createConfigList(); //creates list of only configurations
							if (oSelf.params.name === "configurationList") {
								context.updateConfigListView(); //Handles what has to be shown in detail area in case of single or multiple configurations
							}
						}
						//If the configuration list length is empty then insert a new configuration
						if (context.configurationHandler.getList().length === 0 && (context.configId === undefined)) {
							context.oTreeInstance.addNodeInTree(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION);
							var aConfigurationArray = context.oTreeInstance.getNodes(); //total number of configurations
							var newAddedTreeNode = aConfigurationArray[aConfigurationArray.length - 1];
							context.oTreeInstance.setSelectedNode(newAddedTreeNode);
						}
						//Loads the current editor of selected configuration and loads the detail view
						if (context.configId !== undefined) {
							var oExistingConfig = configurationHandler.getConfiguration(context.configId);
							if (oExistingConfig) {
								configurationHandler.loadConfiguration(context.configId, function(configurationEditor) {
									context.configEditor = configurationEditor;
									var sPathForConfig = context.getSPathForConfig(context.configId);
									if (context.oModel.getData().aConfigDetails[sPathForConfig.split('/')[2]].bIsLoaded === false) {//checks whether structure has been got already
										context.updateTree();
										if(oSelf.params.name !== "navigationTarget"){
											oSelf.setCurrentSelectionState(oSelf.params, context);
										}
									}
									else{
										oSelf.setCurrentSelectionState(oSelf.params, context);
									}
								});
							} else {
								oSelf.setCurrentSelectionState(oSelf.params, context);
							}
						}
					});
				});
			}
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFRouter#setCurrentSelectionState
	 * @param URL Context.
	 * @param {sap.apf.modeler.ui.controller.configurationList} context - Configuration List Context.
	 * @description Sets selection on the tree,Populates the respective detail view based on URL context,updates the title and breadcrumb
	 * */
	setCurrentSelectionState : function(params, context) {
		var oValidURLContext = context.getSPathFromURL(params);
		if (params.name !== "configurationList") {
			if (oValidURLContext && oValidURLContext.objectType) {
				//Update the valid subview,set selection on the tree and update breadcrumb
				context.updateSubView(params);
				if (oValidURLContext.sPath) {
					context.setSelectionOnTree(oValidURLContext.sPath);
				}
				context.updateTitleAndBreadCrumb();
			} else {
				context.showNoConfigSelectedText();
				context.removeSelectionOnTree();
			}
		}
	}
};
}; // end of sap/apf/modeler/ui/utils/APFRouter.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.constants') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.modeler.ui.utils.constants');
sap.apf.modeler.ui.utils.CONSTANTS = {
	configurationObjectTypes : {
		CONFIGURATION : "configuration",
		FACETFILTER : "facetFilter",
		CATEGORY : "category",
		STEP : "step",
		REPRESENTATION : "representation",
		NAVIGATIONTARGET : "navigationTarget",
		ISNEWCONFIG : "apf1972-"
	}
};
}; // end of sap/apf/modeler/ui/utils/constants.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.helper') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
  * Static helper functions
  */
jQuery.sap.declare('sap.apf.modeler.ui.utils.helper');
sap.apf.modeler.ui.utils.helper = {
	/**
	 * @description callback on resize of the window
	 */
	onResize : function(callback) {
		jQuery(window).resize(function() {
			callback();
		});
	},
	/**
	 * @description applies height and width to child element from respective parent or values passed
	 */
	applySize : function(wParent, hParent, child, options) {
		var width, height;
		if (hParent !== undefined) {
			height = ((hParent.getDomRef !== undefined) ? jQuery(hParent.getDomRef()).height() : (jQuery.isNumeric(hParent) ? hParent : jQuery(hParent).height()));
		}
		if (wParent !== undefined) {
			width = ((wParent.getDomRef !== undefined) ? jQuery(wParent.getDomRef()).width() : (jQuery.isNumeric(wParent) ? wParent : jQuery(wParent).width()));
		}
		var childEle = (child.getDomRef !== undefined) ? jQuery(child.getDomRef()) : jQuery(child);
		var offsetHeight = (options === undefined) ? 0 : (options.offsetHeight || 0);
		var offsetWidth = (options === undefined) ? 0 : (options.offsetWidth || 0);
		//Apply Height & Width to Child
		childEle.css({
			height : (hParent === undefined) ? "100%" : height + offsetHeight + "px",
			width : (wParent === undefined) ? "100%" : width + offsetWidth + "px"
		});
	}
};

}; // end of sap/apf/modeler/ui/utils/helper.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.navigationHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
  * Navigation Handler Class
**/
jQuery.sap.declare('sap.apf.modeler.ui.utils.navigationHandler');
sap.apf.modeler.ui.utils.navigationHandler = (function() {
	//Global Variables
	var instance, dialogInstance = {};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#onConfigurationSwitch
	 * @param {Boolean} isSaved - Whether configuration is saved or not before navigation 
	 * @param {Boolean} isDifferentConfig - Whether configuration is different or same 
	 * @param {Object} configListInstance - Pass the configuration list instance 
	 * @description On switch of one configuration to another handle scenarios below
	 * Yes : The unsaved changes are saved and the user navigates to the new configuration 
	 * No : The user navigates without saving the changes (this reverts back to the last saved state or the last in memory state depending on whether this object was saved before or not).
	 * Cancel : The pop up closes and user remains in the current configuration.
	 * */
	var throwLossOfDataPopup = function(configListInstance, callback) {
		_openMessageDialogForSwitchState(configListInstance, {
			isSwitchConfiguration : true
		}, callback);
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#onCheckValidationState
	 * @param {Boolean} isSaved - Whether configuration is saved or not before navigation 
	 * @param {Object} configListInstance - Pass the configuration list instance 
	 * @description On switch of one configuration to another handle scenarios below
	 * Yes : -> if this is saved object, restore the value to the previously saved value,
			-> if not saved, then change the value to the previously saved in memory value                 
			-> if the user has just created this object and is trying to navigate to the another node or action, the object is lost.
	 * No : -> He remains on the current form with the mandatory fields.
	 * */
	var throwMandatoryPopup = function(configListInstance, callback) {
		_openMessageDialogForValidationState(configListInstance, {
			isValidationCheck : true
		}, callback);
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_openMessageDialogForSwitchState
	 * @param {Object} configListInstance  - configurationList Instance 
	 * @param {Object} switchState - Current Switch state property isTraverseBack, isSwitchConfiguration etc
	 * @description On switch of sub view to another open pop up dialog
	 * */
	var _openMessageDialogForValidationState = function(configListInstance, switchState, callback) {
		var oCoreApi = configListInstance.oCoreApi;
		var dialogMessage = oCoreApi.getText("mandatoryField");
		var currSwitchStateKey = Object.keys(switchState)[0];
		var handlerContext = {
			_handleValidationNavigation : _handleValidationNavigation,
			_handlePreventNavigation : _handlePreventNavigation,
			configListInstance : configListInstance,
			callback : callback
		};
		handlerContext[currSwitchStateKey] = switchState[currSwitchStateKey];
		//Create New Instance of dialog
		dialogInstance.oConfirmValidationDialog = sap.ui.xmlfragment("idMandatoryValidationDialogFragement", "sap.apf.modeler.ui.fragment.mandatoryDialog", handlerContext);
		configListInstance.getView().addDependent(dialogInstance.oConfirmValidationDialog);
		_setMessageDialogText(oCoreApi, "validationDialog");
		var oValidationMessageLabel = new sap.m.Label();
		oValidationMessageLabel.addStyleClass("dialogText");
		oValidationMessageLabel.setText(dialogMessage);
		dialogInstance.oConfirmValidationDialog.removeAllContent();
		dialogInstance.oConfirmValidationDialog.addContent(oValidationMessageLabel); // add the confirmation message to the dialog
		dialogInstance.oConfirmValidationDialog.open();
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_openMessageDialogForSwitchState
	 * @param {Object} configListInstance  - configurationList Instance 
	 * @param {Object} switchState - Current Switch state property isTraverseBack, isSwitchConfiguration etc
	 * @description On switch of one configuration to another open pop up dialog
	 * */
	var _openMessageDialogForSwitchState = function(configListInstance, switchState, callback) {
		var oCoreApi = configListInstance.oCoreApi;
		var dialogMessage = oCoreApi.getText("unsavedConfiguration");
		var currSwitchStateKey = Object.keys(switchState)[0];
		var handlerContext = {
			_handleNavigationWithSave : _handleNavigationWithSave,
			_handleNavigateWithoutSave : _handleNavigateWithoutSave,
			_handlePreventNavigation : _handlePreventNavigation,
			configListInstance : configListInstance,
			callback : callback
		};
		handlerContext[currSwitchStateKey] = switchState[currSwitchStateKey];
		//Create New Instance of dialog
		dialogInstance.oConfirmNavigationDialog = sap.ui.xmlfragment("idMessageDialogFragment", "sap.apf.modeler.ui.fragment.messageDialog", handlerContext);
		configListInstance.getView().addDependent(dialogInstance.oConfirmNavigationDialog);
		_setMessageDialogText(oCoreApi, "naviagtionDialog");
		var oConfirmationMessageLabel = new sap.m.Label();
		oConfirmationMessageLabel.addStyleClass("dialogText");
		oConfirmationMessageLabel.setText(dialogMessage);
		dialogInstance.oConfirmNavigationDialog.removeAllContent();
		dialogInstance.oConfirmNavigationDialog.addContent(oConfirmationMessageLabel); // add the confirmation message to the dialog
		dialogInstance.oConfirmNavigationDialog.open();
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_closeDialog
	 * @param {dialogInstance}  - DialogInstance to be destroyed
	 * @description Destroys the passed dialog instance
	 * */
	var _closeDialog = function(dialogInstance) {
		dialogInstance.close();
		dialogInstance.destroy();
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_setMessageDialogText
	 * @param {Object} oCoreApi - Core API instance
	 * @description Sets the text for dialog pop up
	 * */
	var _setMessageDialogText = function(oCoreApi, dialogType) {
		if (dialogType === "naviagtionDialog") {
			sap.ui.core.Fragment.byId("idMessageDialogFragment", "idMessageDialog").setTitle(oCoreApi.getText("warning"));
			sap.ui.core.Fragment.byId("idMessageDialogFragment", "idYesButton").setText(oCoreApi.getText("yes"));
			sap.ui.core.Fragment.byId("idMessageDialogFragment", "idNoButton").setText(oCoreApi.getText("no"));
			sap.ui.core.Fragment.byId("idMessageDialogFragment", "idCancelButton").setText(oCoreApi.getText("cancel"));
		} else if (dialogType === "validationDialog") {
			sap.ui.core.Fragment.byId("idMandatoryValidationDialogFragement", "idMandatoryValidationDialog").setTitle(oCoreApi.getText("warning"));
			sap.ui.core.Fragment.byId("idMandatoryValidationDialogFragement", "idYesButton").setText(oCoreApi.getText("yes"));
			sap.ui.core.Fragment.byId("idMandatoryValidationDialogFragement", "idNoButton").setText(oCoreApi.getText("no"));
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_handleValidationNavigation
	 * @description Handles Navigation Back to sub views
	 * */
	var _handleValidationNavigation = function() {
		var configListInstance = this.configListInstance;
		var callback = this.callback;
		_closeDialog(dialogInstance.oConfirmValidationDialog);
		if (typeof callback.yes === "function") {
			callback.yes();
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_handleNavigationWithSave
	 * @description Handles Navigation Scenario With Save 
	 * */
	var _handleNavigationWithSave = function() {
		var configListInstance = this.configListInstance;
		var callback = this.callback;
		var saveEditor = function(callback) {
			//Save Editor Instance
			configListInstance.configEditor.save(function(id, metadata, messageObject) {
				configListInstance.configId = id;
				if (messageObject === undefined) {
					if (typeof callback === "function") {
						callback();
					}
					var successMessageOnSave = configListInstance.oCoreApi.getText("successOnSave");
					sap.m.MessageToast.show(successMessageOnSave, {
						width : "20em"
					});
				} else {
					var oMessageObject = configListInstance.oCoreApi.createMessageObject({
						code : "12000"
					});
					oMessageObject.setPrevious(messageObject);
					configListInstance.oCoreApi.putMessage(oMessageObject);
					var errorMessageOnSave = configListInstance.oCoreApi.getText("errorOnSave");
					sap.m.MessageToast.show(errorMessageOnSave, {
						width : "20em"
					});
				}
			});
		};
		_closeDialog(dialogInstance.oConfirmNavigationDialog);
		if (typeof callback.yes === "function") {
			callback.yes(saveEditor);
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_handleNavigateWithoutSave
	 * @description Handles Navigation Scenario Without Save 
	 * */
	var _handleNavigateWithoutSave = function() {
		var configListInstance = this.configListInstance;
		var callback = this.callback;
		_closeDialog(dialogInstance.oConfirmNavigationDialog);
		configListInstance.configurationHandler.resetConfiguration(configListInstance.configId);
		if (typeof callback.no === "function") {
			callback.no();
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.navigationHandler#_handlePreventNavigation
	 * @description Prevents the navigation retains in the same state 
	 * */
	var _handlePreventNavigation = function() {
		var isTraverseBack = this.isTraverseBack;
		var isSwitchConfiguration = this.isSwitchConfiguration;
		var isValidationCheck = this.isValidationCheck;
		var configListInstance = this.configListInstance;
		var callback = this.callback;
		if (!isValidationCheck) {
			_closeDialog(dialogInstance.oConfirmNavigationDialog);
		} else {
			_closeDialog(dialogInstance.oConfirmValidationDialog);
		}
		if (typeof callback.cancel === "function") {
			callback.cancel();
		} else if (typeof callback.no === "function" && isValidationCheck) {
			callback.no();
		}
	};
	//Create Navigation Handler Instance
	var createInstance = function() {
		return {
			throwLossOfDataPopup : throwLossOfDataPopup,
			throwMandatoryPopup : throwMandatoryPopup
		};
	};
	return {
		getInstance : function() {
			return instance || (instance = createInstance());
		}
	};
}());
}; // end of sap/apf/modeler/ui/utils/navigationHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.textPoolHelper') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.modeler.ui.utils.textPoolHelper');
/**
 * @private
 * @class Text Pool Helper
 * @description Helps UI Controllers in handling Text Pool related operations (AutoFill, setText etc.).
 * @param {sap.apf.modeler.core.TextPool} oTextPool - Text Pool instance used in the controller context.
 * @name sap.apf.modeler.ui.utils.TextPoolHelper
 */
sap.apf.modeler.ui.utils.TextPoolHelper = function(oTextPool) {
	this.oTextPool = oTextPool;
};
sap.apf.modeler.ui.utils.TextPoolHelper.prototype = {
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.TextPoolHelper#setAutoCompleteOn
	 * @param {sap.m.Input} oInputControl - Input Control on which suggestions has to be shown.
	 * @param {sap.apf.modeler.ui.utils.TranslationFormatMap} oTranslationFormat - Translation format of the input control.
	 * @description Sets 'Auto Complete Feature' on the given input control with relevant suggestion items based on translation format.
	 * */
	setAutoCompleteOn : function(oInputControl, oDependencies) {
		// Set showSuggestion to true.
		oInputControl.setShowSuggestion(true);
		var aSuggestionItems = [];
		// Fetch all Suggestion Items according to translation format.
		if (oDependencies.type === "text") {
			var aExistingItems = this._getSuggestionItems(oDependencies.oTranslationFormat);
			aExistingItems.forEach(function(oText) {
				var object = {};
				object.suggetionText = oText.TextElementDescription;
				aSuggestionItems.push(object);
			});
		} else if (oDependencies.type === "service") {
			var aExistingSerices = oDependencies.oConfigurationEditor.getAllServices();
			aExistingSerices.forEach(function(service) {
				var object = {};
				object.suggetionText = service;
				aSuggestionItems.push(object);
			});
		}
		// Prepare and set the JSONModel.
		var oInputControlModel = oInputControl.getModel();
		var oModel = oInputControlModel || new sap.ui.model.json.JSONModel({});
		if (!oModel.getData().suggestions) {
			oModel.getData().suggestions = aSuggestionItems;
		}
		if (!oInputControlModel) {
			oInputControl.setModel(oModel);
		}
		/*
		var oSuggestionModel = new sap.ui.model.json.JSONModel({
			suggestions : aSuggestionItems
		});
		oInputControl.setModel(oSuggestionModel);*/
		// Bind 'suggestionItems' aggregation.
		oInputControl.bindAggregation("suggestionItems", {
			path : "/suggestions",
			template : new sap.ui.core.Item({
				text : "{suggetionText}"
			})
		});
		// Attach Listener to 'suggest' event.
		oInputControl.attachSuggest(this._handleSuggestion);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.TextPoolHelper#_handleSuggestion
	 * @param {oControlEvent} oEvent - Suggest Event.
	 * @description Handler for 'suggest' event triggered on input control.
	 * */
	_handleSuggestion : function(oEvent) {
		var sValue = oEvent.getParameter("suggestValue");
		var oFilter = new sap.ui.model.Filter("suggetionText", sap.ui.model.FilterOperator.Contains, sValue);
		oEvent.getSource().getBinding("suggestionItems").filter([ oFilter ]);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.TextPoolHelper#_getSuggestionItems
	 * @param {sap.apf.modeler.ui.utils.TranslationFormatMap} oTranslationFormat - Translation format of the input control.
	 * @description Handler for 'suggest' event triggered on input control.
	 * @returns {object[]} Array of Translation Text Objects
	 * */
	_getSuggestionItems : function(oTranslationFormat) {
		return this.oTextPool.getTextsByTypeAndLength(oTranslationFormat.TextElementType, oTranslationFormat.MaximumLength);
	}
};
/**
 * @private
 * @name sap.apf.modeler.ui.utils.TranslationFormatMap
 * @description Look up map for Translation Format from Input Type
 */
sap.apf.modeler.ui.utils.TranslationFormatMap = {
	APPLICATION_TITLE : {
		TextElementType : "XTIT",
		MaximumLength : 250
	},
	CATEGORY_TITLE : {
		TextElementType : "XTIT",
		MaximumLength : 60
	},
	FACETFILTER_LABEL : {
		TextElementType : "XFLD",
		MaximumLength : 50
	},
	STEP_TITLE : {
		TextElementType : "XTIT",
		MaximumLength : 100
	},
	STEP_LONG_TITLE : {
		TextElementType : "XTIT",
		MaximumLength : 200
	},
	STEP_CORNER_TEXT : {
		TextElementType : "XFLD",
		MaximumLength : 25
	},
	REPRESENTATION_LABEL : {
		TextElementType : "XTIT",
		MaximumLength : 80
	},
	REPRESENTATION_CORNER_TEXT : {
		TextElementType : "XFLD",
		MaximumLength : 25
	}
};
}; // end of sap/apf/modeler/ui/utils/textPoolHelper.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.controls.draggableCarousel.DraggableCarousel') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.controls.draggableCarousel.DraggableCarousel");
(function(un) {
	"use strict";
	var isTouchDevice;
	var deviceDetect = (function() {
		isTouchDevice = window.hasOwnProperty('ontouchstart') || window.hasOwnProperty('onmsgesturechange'); //first one works on most browsers, second one works on ie10 
	}());
	sap.apf.ui.controls.draggableCarousel.DraggableCarousel = function(opts) {
		var options = opts || {};
		this.eleRefs = {
			blocks : [],
			containerEle : opts.containerEle
		};
		this._editState = options.editable === un ? true : options.editable;
		this._dragState = this._editState;
		this._removeState = this._editState;
		this.styles = {
			containerHeight : options.containerHeight,
			containerWidth : options.containerWidth,
			blockHeight : options.blockHeight,
			blockWidth : options.blockWidth,
			blockMargin : options.blockMargin,
			separatorHeight : options.separatorHeight,
			removeIconHeight : options.removeIconHeight
		};
		this.elems = {
			separator : options.separator,
			removeIcon : options.removeIcon
		};
		this.callbacks = {
			onBeforeDrag : options.onBeforeDrag,
			onAfterDrop : options.onAfterDrop,
			onAfterRemove : options.onAfterRemove,
			onAfterSelect : options.onAfterSelect
		};
		this.eleRefs.containerEle = this._drawSkeleton();
		this._initDimensions();
		this._isMouseDown = false;
	};
	sap.apf.ui.controls.draggableCarousel.DraggableCarousel.prototype = {
		_initDimensions : function() {
			var sMargin = this.styles.blockMargin;
			this._blockMargin = parseInt(sMargin.replace("px"), 10);
			var sBlockHeight = this.styles.blockHeight;
			this._blockHeight = parseInt(sBlockHeight.replace("px"), 10);
			this._blockTotalHeight = this._blockHeight + (2 * this._blockMargin);
			this._separatorHeight = 0;
			if (this.elems.separator !== un) {
				var sSeparatorHeight = this.styles.separatorHeight;
				this._separatorHeight = parseInt(sSeparatorHeight.replace("px"), 10);
			}
			this._mFactor = this._blockTotalHeight + this._separatorHeight;
		},
		_drawSkeleton : function() {
			var containerEle;
			if (this.eleRefs.containerEle === un) {
				containerEle = document.createElement('div');
			} else {
				containerEle = this.eleRefs.containerEle;
			}
			containerEle.style.cssText += this._getContainerStyles();
			containerEle.classList.add('DnD-container');
			var self = this;
			var tapEndEvent = isTouchDevice ? "touchend" : "mouseup";
			document.addEventListener(tapEndEvent, function(e) {
				self._onMouseUp(e, self);
			});
			return containerEle;
		},
		_getBlockWrapper : function(blockObj) {
			var block = blockObj.blockElement;
			var blocks = this.eleRefs.blocks;
			var dragState = blockObj.dragState === un ? true : blockObj.dragState;
			var dropState = blockObj.dropState === un ? true : blockObj.dropState;
			var removable = blockObj.removable === un ? true : blockObj.removable;
			var blockWrapper = document.createElement('div');
			blockWrapper.style.cssText += this._getBlockStyles();
			blockWrapper.setAttribute('class', 'DnD-block');
			blockWrapper.setAttribute('drag-state', dragState);
			blockWrapper.setAttribute('drop-state', dropState);
			if (removable) {
				var removeIconEle = this._getRemoveIconEle();
				blockWrapper.appendChild(removeIconEle);
			}
			var self = this;
			var tapEvent = isTouchDevice ? "touchstart" : "mousedown";
			blockWrapper.addEventListener(tapEvent, function(e) {
				self._onMouseDown(e, self, this);
			});
			var tapMoveEvent = isTouchDevice ? "touchmove" : "mousemove";
			blockWrapper.addEventListener(tapMoveEvent, function(e) {
				window.clearTimeout(self._TIMEOUTID);
			});
			
			//Select the block using space + enter key
			this._keypress(blockWrapper, 13, function (ele, e) {
				var selectIndex = blocks.indexOf(ele);
				self.callbacks.onAfterSelect.apply(ele, [selectIndex]);
			});
			
			this._keypress(blockWrapper, 32, function (ele, e) {
				var selectIndex = blocks.indexOf(ele);
				self.callbacks.onAfterSelect.apply(ele, [selectIndex]);
			});
			
			//Home + End Key - focus first and last block
			this._keypress(blockWrapper, 36, function (ele, e) {
				jQuery(blocks).removeAttr("tabindex");
				jQuery(blocks).attr("tabindex", -1);
				jQuery(blocks[0]).attr("tabindex", 0);
				jQuery(blocks[0]).focus();
			});
			
			this._keypress(blockWrapper, 35, function (ele, e) {
				jQuery(blocks).removeAttr("tabindex");
				jQuery(blocks).attr("tabindex", -1);
				jQuery(blocks[blocks.length - 1]).attr("tabindex", 0);
				jQuery(blocks[blocks.length - 1]).focus();
			});
			
			//Check the removable state 
			if(removable === true){
				//Delete Event on press of the block
				this._keypress(blockWrapper, 46, function (ele, e) {
					var removeIndex = blocks.indexOf(ele);
					self.removeBlock(removeIndex, self.callbacks.onAfterRemove);
					
					//Tab Index Grouping
					self._grouping(blocks);
					
					//Set focus to tab-index active
					jQuery(blocks).parent().wrap("<div>").find("[tabindex='0']").focus();
				});
			}
			
			blockWrapper.appendChild(block);
			return blockWrapper;
		},
		_getSeparatorEle : function() {
			var separator = document.createElement('div');
			separator.style.cssText += this._getSeparatorStyles();
			separator.setAttribute('class', 'DnD-separator');
			separator.innerHTML = this.elems.separator.outerHTML;
			return separator;
		},
		_getRemoveIconEle : function() {
			var removeIcon = this.elems.removeIcon;
			var removeIconWrapper = document.createElement('div');
			removeIconWrapper.style.cssText += this._getRemoveIconStyles();
			removeIconWrapper.setAttribute('class', 'DnD-removeIconWrapper');
			removeIconWrapper.innerHTML = removeIcon.outerHTML;
			var self = this;
			var tapEvent = isTouchDevice ? "touchstart" : "mousedown";
			removeIconWrapper.addEventListener(tapEvent, function(e) {
				self._onRemoveBlock(e, self, this);
			});
			return removeIconWrapper;
		},
		addBlock : function(blockObj) {
			if (blockObj instanceof Array) {
				var i;
				for(i = 0; i < blockObj.length; i++) {
					this.addBlock(blockObj[i]);
				}
				return;
			}
			var blockWrapper = this._getBlockWrapper(blockObj);
			var blockIndex = this.eleRefs.blocks.length;
			var blocks = this.eleRefs.blocks;
			var self = this;
			var y = blockIndex * this._mFactor;
			blockWrapper.style.cssText = blockWrapper.style.cssText + this._getTransformCss(y);
			this.eleRefs.blocks.push(blockWrapper);
			var container = this.eleRefs.containerEle;
			container.appendChild(blockWrapper);
			this._setHorizontalBlockMargin();
			if (this.elems.separator !== un) {
				var separator = this._getSeparatorEle();
				var separatorYValue = y + this._blockHeight + 2 * this._blockMargin;
				separator.style.cssText = separator.style.cssText + this._getTransformCss(separatorYValue);
				container.appendChild(separator);
			}
	
			//Tab Index Grouping
			this._grouping(blocks);
		},
		swapBlocks : function(fromIndex, toIndex) {
			var fromBlock = this.eleRefs.blocks[fromIndex];
			var toBlock = this.eleRefs.blocks[toIndex];
			if ((fromBlock.getAttribute('drag-state') !== "true" && fromBlock.getAttribute('drop-state') !== "true") || (toBlock.getAttribute('drag-state') !== "true" && toBlock.getAttribute('drop-state') !== "true")) {
				return false;
			}
			var fromBlockYValue = fromIndex * this._mFactor;
			var fromBlockTopValue = fromBlockYValue;
			var fromBlockBottomValue = fromBlockTopValue + this._blockHeight + (2 * this._blockMargin);
			var toBlockYValue = toIndex * this._mFactor;
			var toBlockTopValue = toBlockYValue;
			var toBlockBottomValue = toBlockTopValue + this._blockHeight + (2 * this._blockMargin);
			var containerEle = document.getElementsByClassName('scrollContainerEle')[0] ? document.getElementsByClassName('scrollContainerEle')[0] : this.eleRefs.containerEle; // Scroll Container Hack
			var scrollValue = containerEle.scrollTop;
			if ((fromIndex > toIndex) && toBlockTopValue < containerEle.scrollTop) {
				scrollValue = toBlockTopValue;
			}
			if ((fromIndex < toIndex) && toBlockBottomValue - containerEle.offsetHeight > containerEle.scrollTop) {
				scrollValue = toBlockBottomValue - containerEle.offsetHeight;
			}
			var prevScrollTop;
			var damping = 40;
			var easeOutLoop = window.setInterval(function() {
				containerEle.scrollTop += (scrollValue - containerEle.scrollTop) / damping;
				if (containerEle.scrollTop === prevScrollTop) {
					window.clearInterval(easeOutLoop);
				}
				prevScrollTop = containerEle.scrollTop;
			}, 1000 / 60);
			this._setTransformYValue(fromBlock, toBlockYValue);
			this._setTransformYValue(toBlock, fromBlockYValue);
			this._swapArray(this.eleRefs.blocks, fromIndex, toIndex);
			return true;
		},
		insertBlock : function(blockObj, index) {
			var blocks = this.eleRefs.blocks;
			blocks.push({});
			var i;
			for(i = blocks.length - 1; i > index; i--) {
				blocks[i] = blocks[i - 1];
				var yValue = i * this._mFactor;
				this._setTransformYValue(blocks[i], yValue);
			}
			var blockWrapper = this._getBlockWrapper(blockObj);
			blocks[i] = blockWrapper;
			var y = index * this._mFactor;
			blockWrapper.style.cssText = blockWrapper.style.cssText + this._getTransformCss(y);
			var container = this.eleRefs.containerEle;
			container.appendChild(blockWrapper);
			this._setHorizontalBlockMargin();
			if (this.elems.separator !== un) {
				var separator = this._getSeparatorEle();
				var separatorYValue = y + this._blockHeight + 2 * this._blockMargin;
				separator.style.cssText = separator.style.cssText + this._getTransformCss(separatorYValue);
				container.appendChild(separator);
			}
			
			//Tab Index Grouping
			this._grouping(blocks);
		},
		removeBlock : function(index, callback) {
			var blocks = this.eleRefs.blocks;
			var containerEle = this.eleRefs.containerEle;
			var i;
			var removeBlock = blocks[index];
			containerEle.removeChild(removeBlock);
			for(i = index; i < blocks.length - 1; i++) {
				blocks[i] = blocks[i + 1];
				var yValue = i * this._mFactor;
				this._setTransformYValue(blocks[i], yValue);
			}
			blocks.pop();
			if (this.elems.separator !== un) {
				var separators = containerEle.querySelectorAll('.DnD-separator');
				var lastSeparator = separators[separators.length - 1];
				containerEle.removeChild(lastSeparator);
			}
			callback.apply(containerEle, [ index ]);
			
			//Tab Index Grouping
			this._grouping(blocks);
		},
		placeAt : function(id) {
			var ele = document.getElementById(id);
			ele.appendChild(this.eleRefs.containerEle);
			this._setHorizontalBlockMargin();
		},
		getEditable : function() {
			return this._editState;
		},
		setEditable : function(editState) {
			this._editState = editState;
			this._setDragState(editState);
			this._setRemoveState(editState);
		},
		_setDragState : function(dragState) {
			this._dragState = dragState;
		},
		_setRemoveState : function(removeState) {
			this._removeState = removeState;
			var removeIcons = this.eleRefs.containerEle.querySelectorAll('.DnD-removeIconWrapper');
			var displayCss;
			if (removeState) {
				displayCss = "display : block";
			} else {
				displayCss = "display : none";
			}
			var i;
			for(i = 0; i < removeIcons.length; i++) {
				removeIcons[i].style.cssText += displayCss;
			}
		},
		_getContainerStyles : function() {
			var sStyle = [ "height : ", this.styles.containerHeight, ";width : ", this.styles.containerWidth, "overflow : auto; position : relative" ].join("");
			return sStyle;
		},
		_getBlockStyles : function() {
			if (this.styles.horizontalBlockMargin === un) {
				var containerWidth = this.eleRefs.containerEle.clientWidth;
				var blockWidth = this.eleRefs.blocks[0] === un ? 0 : this.eleRefs.blocks[0].clientWidth;
				this.styles.horizontalBlockMargin = ((containerWidth - blockWidth) / 2) + "px";
			}
			var sStyle = [ "height : ", this.styles.blockHeight, ";width : ", this.styles.blockWidth, ";margin : ", this.styles.blockMargin, " ", this.styles.horizontalBlockMargin, ";position : absolute" ].join("");
			return sStyle;
		},
		_getSeparatorStyles : function() {
			var sStyle = [ "height : ", this.styles.separatorHeight, ";width : 100%", ";position : absolute" ].join("");
			return sStyle;
		},
		_getRemoveIconStyles : function() {
			var sStyle = [ "height : ", this.styles.removeIconHeight, ";width : ", this.styles.removeIconHeight, ";float : right", ";margin : -10px -13px -10px 0", ";z-index : 2", ";position : relative", ";cursor : pointer" ].join("");
			if (this._removeState) {
				sStyle += ";display : block";
			} else {
				sStyle += ";display : none";
			}
			return sStyle;
		},
		_getTransformCss : function(yValue) {
			var sYValue = yValue + "px";
			var transformPropertyStrings = [ "transform", "-webkit-transform", "-moz-transform", "-ms-transform", "-o-transform" ];
			var cssString = "";
			var i;
			for(i = 0; i < transformPropertyStrings.length; i++) {
				cssString += transformPropertyStrings[i] + ": translate3d(0px," + sYValue + ", 0px); ";
			}
			return cssString;
		},
		_setTransformYValue : function(ele, yValue) {
			var vendorProperty = [ {
				"WebkitTransform" : "-webkit-transform"
			}, {
				"MozTransform" : "-moz-transform"
			}, {
				"MsTransform" : "-ms-transform"
			}, {
				"OTransform" : "-o-transform"
			} ];
			var transformPropertyString = "transform";
			var i;
			for(i = 0; i < vendorProperty.length; i++) {
				if (ele.style.hasOwnProperty(Object.keys(vendorProperty[i])[0])) {
					transformPropertyString = vendorProperty[i][Object.keys(vendorProperty[i])[0]];
				}
			}
			var sYValue = yValue + 'px';
			ele.style.cssText = ele.style.cssText + " " + transformPropertyString + ": translate3d(0px," + sYValue + ", 0px);";
		},
		_setHorizontalBlockMargin : function() {
			var blocks = this.eleRefs.blocks;
			var container = this.eleRefs.containerEle;
			var blockWidth = blocks[0] === un ? 0 : blocks[0].clientWidth;
			var containerWidth = container.clientWidth;
			this.styles.horizontalBlockMargin = ((containerWidth - blockWidth) / 2) + "px";
			var marginHorizontal = this.styles.horizontalBlockMargin;
			[].forEach.call(blocks, function(block) {
				block.style.cssText += "margin-right : " + marginHorizontal + ";margin-left : " + marginHorizontal;
			});
		},
		_onMouseDown : function(e, ctx, blockWrapper) {
			ctx._isMouseDown = true;
			ctx._TIMEOUTID = window.setTimeout(function() {
				if (ctx._isMouseDown) {
					ctx._onDragStart(e, ctx, blockWrapper);
				}
			}, 500);
		},
		_onMouseUp : function(e, ctx) {
			ctx._isMouseDown = false;
			if (ctx._dragEle !== un && ctx._dragEle.ele !== un) {
				ctx._onDrop(e, ctx);
			}
		},
		_onDragStart : function(e, ctx, blockWrapper) {
			if (!ctx._dragState || blockWrapper.getAttribute('drag-state') !== 'true') {
				return;
			}
			ctx._dragIndex = ctx.eleRefs.blocks.indexOf(blockWrapper);
			var yValue = ctx._dragIndex * ctx._mFactor;
			var containerEle = document.getElementsByClassName('scrollContainerEle')[0] ? document.getElementsByClassName('scrollContainerEle')[0] : ctx.eleRefs.containerEle; // Scroll Container Hack			
			ctx._containerEleOffsetHeight = containerEle.offsetHeight;
			ctx._containerEleScrollHeight = containerEle.scrollHeight;
			ctx._blockEleOffsetHeight = blockWrapper.offsetHeight;
			ctx._containerEleScrollTop = containerEle.scrollTop;
			var eleTopValue = yValue + ctx._blockMargin;
			var eleBottomValue = eleTopValue + ctx._blockHeight;
			if (eleTopValue < ctx._containerEleScrollTop) {
				containerEle.scrollTop = eleTopValue;
				ctx._containerEleScrollTop = Math.max(0, eleTopValue);
			}
			if (eleBottomValue - ctx._containerEleOffsetHeight > containerEle.scrollTop) {
				containerEle.scrollTop = eleBottomValue - ctx._containerEleOffsetHeight;
				ctx._containerEleScrollTop = Math.min(ctx._containerEleScrollHeight - ctx._containerEleOffsetHeight, eleBottomValue - ctx._containerEleOffsetHeight);
			}
			ctx._diffTop = e.pageY - yValue + ctx._containerEleScrollTop;
			ctx._dragEle = {
				ele : blockWrapper,
				pos : {
					y : yValue
				}
			};
			ctx.callbacks.onBeforeDrag.apply(blockWrapper, [ ctx._dragIndex ]);
			ctx._dragEle.ele.className = ctx._dragEle.ele.className + " " + "DnD-drag";
			var tapMoveEvent = isTouchDevice ? "touchmove" : "mousemove";
			document.addEventListener(tapMoveEvent, function(e) {
				if (ctx._dragEle.ele !== un) {
					e.preventDefault();
					ctx._onDrag(e, ctx);
					e.stopPropagation();
				}
			});
		},
		_onDrag : function(e, ctx) {
			var containerEle = document.getElementsByClassName('scrollContainerEle')[0] ? document.getElementsByClassName('scrollContainerEle')[0] : ctx.eleRefs.containerEle; // Scroll Container Hack
			var yValue = e.pageY - ctx._diffTop + ctx._containerEleScrollTop;
			var eleTopValue = yValue + ctx._blockMargin;
			var eleBottomValue = eleTopValue + ctx._blockHeight;
			var isDraggingDown = ((e.pageY - ctx._diffTop) > ctx._prevPageY);
			var isDraggingUp = ((e.pageY - ctx._diffTop) < ctx._prevPageY);
			ctx._prevPageY = (e.pageY - ctx._diffTop);
			if (isDraggingUp && (eleTopValue < ctx._containerEleScrollTop)) {
				containerEle.scrollTop = eleTopValue;
				ctx._containerEleScrollTop = Math.max(0, eleTopValue);
				yValue = e.pageY - ctx._diffTop + ctx._containerEleScrollTop;
			}
			if (isDraggingDown && ((eleBottomValue - ctx._containerEleOffsetHeight) > ctx._containerEleScrollTop)) {
				containerEle.scrollTop = eleBottomValue - ctx._containerEleOffsetHeight;
				ctx._containerEleScrollTop = Math.min(ctx._containerEleScrollHeight - ctx._containerEleOffsetHeight, eleBottomValue - ctx._containerEleOffsetHeight);
				yValue = e.pageY - ctx._diffTop + ctx._containerEleScrollTop;
			}
			ctx._setTransformYValue(ctx._dragEle.ele, yValue);
			var sMargin = ctx.styles.blockMargin; // margin-top and bottom.
			var margin = parseInt(sMargin.replace("px"), 10);
			var currentTopValue = yValue;
			var currentBottomValue = yValue + ctx._blockEleOffsetHeight;
			var minTopValue = ctx._dragEle.pos.y - (ctx._mFactor - (ctx._blockHeight / 2));
			var maxBottomValue = (ctx._dragEle.pos.y + ctx._blockEleOffsetHeight) + (ctx._mFactor - (ctx._blockHeight / 2));
			var eleYValue = ctx._dragEle.pos.y;
			var currentIndex = eleYValue / (ctx._mFactor);
			var blocks = ctx.eleRefs.blocks;
			var aboveSwappableIndex = -1, belowSwappableIndex = blocks.length;
			var i, blockEle;
			for(i = currentIndex - 1; i >= 0; i--) {
				blockEle = blocks[i];
				if (blockEle.getAttribute('drop-state') === 'true') {
					aboveSwappableIndex = i;
					break;
				}
			}
			for(i = currentIndex + 1; i < blocks.length; i++) {
				blockEle = blocks[i];
				if (blockEle.getAttribute('drop-state') === 'true') {
					belowSwappableIndex = i;
					break;
				}
			}
			minTopValue = ctx._dragEle.pos.y - ((currentIndex - aboveSwappableIndex) * ctx._mFactor - (ctx._blockHeight / 2));
			maxBottomValue = (ctx._dragEle.pos.y + ctx._blockEleOffsetHeight) + ((belowSwappableIndex - currentIndex) * ctx._mFactor - (ctx._blockHeight / 2));
			var swapIndex;
			var bSwapNeeded = false;
			if (currentTopValue < minTopValue) {
				bSwapNeeded = true;
				swapIndex = aboveSwappableIndex;
			} else if (currentBottomValue > maxBottomValue) {
				bSwapNeeded = true;
				swapIndex = belowSwappableIndex;
			}
			if (bSwapNeeded && (swapIndex >= 0) && (swapIndex <= blocks.length - 1)) {
				ctx._dragEle.pos.y = swapIndex * (ctx._mFactor);
				var moveEle = blocks[swapIndex];
				if (moveEle !== un) {
					ctx._setTransformYValue(moveEle, eleYValue);
					ctx._swapArray(blocks, currentIndex, swapIndex);
				}
			}
		},
		_onDrop : function(e, ctx) {
			ctx._dragEle.ele.className = ctx._dragEle.ele.className.replace(" DnD-drag", "");
			var blocks = ctx.eleRefs.containerEle.querySelectorAll('.DnD-drag');
			var i;
			for(i = 0; i < blocks.length; i++) {
				blocks[i].className = blocks[i].className.replace(" DnD-drag", "");
			}
			var eleYValue = ctx._dragEle.pos.y;
			ctx._dropIndex = eleYValue / (ctx._mFactor);
			ctx._setTransformYValue(ctx._dragEle.ele, eleYValue);
			ctx.callbacks.onAfterDrop.apply(ctx._dragEle.ele, [ ctx._dragIndex, ctx._dropIndex ]);
			ctx._dragEle = {};
		},
		_onRemoveBlock : function(e, ctx, removeIconWrapper) {
			e.stopPropagation();
			var removeBlock = removeIconWrapper.parentElement;
			var removeIndex = ctx.eleRefs.blocks.indexOf(removeBlock);
			ctx.removeBlock(removeIndex, ctx.callbacks.onAfterRemove);
		},
		_swapArray : function(array, from, to) {
			var temp = array[from];
			array[from] = array[to];
			array[to] = temp;
			return array;
		},
		_grouping : function (arrEle) {
			
			var childNode = arrEle;
			var activeIndex = (arrEle.length > 2) ? arrEle.length - 2 : 0;
			
			//Set first child or last child as tabindex active and other inactive
			jQuery(childNode).removeAttr("tabindex");
			jQuery(childNode).attr("tabindex", -1);
			jQuery(childNode[activeIndex]).attr("tabindex", 0);

			//Up arrow key hit
			this._keypress(childNode, 38, function (ele, e) {
				var index = childNode.indexOf(ele);
				if (index === 0) {
					return;
				}
				jQuery(childNode).removeAttr("tabindex");
				jQuery(childNode).attr("tabindex", -1);
				jQuery(childNode[index - 1]).attr("tabindex", 0);
				jQuery(childNode[index - 1]).focus();
				
			});
			
			//Down arrow key hit
			this._keypress(childNode, 40, function (ele, e) {
				var index = childNode.indexOf(ele);
				if (index === childNode.length - 1) {
					return;
				}
				jQuery(childNode).removeAttr("tabindex");
				jQuery(childNode).attr("tabindex", -1);
				jQuery(childNode[index + 1]).attr("tabindex", 0);
				jQuery(childNode[index + 1]).focus();
			});
			
		},
		_keypress : function (ele, keyCode, callback) {
			
			jQuery(ele).keydown(function (e) {
				//e.which is set by jQuery for those browsers that do not normally support e.keyCode.
				var keyCodePress = e.keyCode || e.which;
				
				if (keyCodePress === keyCode) {
					callback(this, e);
					return false;
				}
			});

		}
	};
}(undefined));

}; // end of sap/apf/ui/controls/draggableCarousel/DraggableCarousel.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.representationInterface') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

jQuery.sap.declare('sap.apf.ui.representations.representationInterface');

(function () {
    'use strict';

    /**
     * @public
     * @experimental The complete interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
     * @class The interface proxy passed to a representation which provides access to required APF methods. This constructor is used by apf.api.
     * It can be also used to build unit tests that need an interface proxy between APF and representations.
     * @name sap.apf.ui.representations.RepresentationInterfaceProxy
     * @param {sap.apf.core.Instance} oCoreApi
     * @param {sap.apf.ui.Instance} oUiApi
     */
    sap.apf.ui.representations.RepresentationInterfaceProxy = function (oCoreApi, oUiApi) {
        this.type = 'RepresentationInterfaceProxy';

        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#putMessage
         * @description see {@link sap.apf.Api#putMessage}
         */
        this.putMessage = function (oMessage) {
            return oCoreApi.putMessage(oMessage);
        };

        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#createMessageObject
         * @description see {@link sap.apf.Api#createMessageObject}
         */
        this.createMessageObject = function (oConfig) {
            return oCoreApi.createMessageObject(oConfig);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#getActiveStep
         * @description see {@link sap.apf.Api#getActiveStep}
         */
        this.getActiveStep = function () {
            return oCoreApi.getActiveStep();
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#setActiveStep
         * @description see {@link sap.apf.Api#setActiveStep}
         */
        this.setActiveStep = function (oStep) {
            return oCoreApi.setActiveStep(oStep);
        };

        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#getTextNotHtmlEncoded
         * @description see {@link sap.apf.Api#getTextNotHtmlEncoded}
         */
        this.getTextNotHtmlEncoded = function (oLabel, aParameters) {
            return oCoreApi.getTextNotHtmlEncoded(oLabel, aParameters);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1. Instead use the method {@link sap.apf.ui.representations.RepresentationInterfaceProxy#selectionChanged}.
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#updatePath
         * @description see {@link sap.apf.Api#updatePath}
         */
        this.updatePath = function (fnStepProcessedCallback) {
            return oCoreApi.updatePath(fnStepProcessedCallback); // fixme planned change in Wave 7 to call update on uiApi so that UI gets notified on changes.
        };

        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#createFilter
         * @description see {@link sap.apf.Api#createFilter}
         */
        this.createFilter = function () {
            return oCoreApi.createFilter();
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#selectionChanged
         * @description see {@link sap.apf.Api#selectionChanged}
         */
        this.selectionChanged = function (bRefreshAllSteps) {
            return oUiApi.selectionChanged(bRefreshAllSteps);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.ui.representations.RepresentationInterfaceProxy#getEventCallback
         * @description see {@link sap.apf.Api#getEventCallback}
         */
        this.getEventCallback = function (sEventType) { // fixme to be removed in Wave 7, part of formatter, not representation!
            return oUiApi.getEventCallback(sEventType);
        };
    }; // InterfaceProxy


    /**
     * @public
     * @experimental The complete interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
     * @class This is not a runtime class, but it describes the interface that a representation (chart) has to implement for to interact with the APF.
     * @name sap.apf.ui.representations.representationInterface
     * @param {sap.apf.ui.representations.RepresentationInterfaceProxy} dependencies - specific interface proxy for communication between the representation and APF.<br>
     * @param {object} configuration - Configuration object that allows to define representation specific configuration values.<br>
     * Fixed interface property names:
     * <ul><li><b>alternateRepresentationTypeId</b>: A reference to a representation type in analytical configuration
     * <li><b>alternateRepresentationType</b>: A property dynamically added to the parameter object by APF core based on reference in alternateRepresentationTypeId and containing
     * configuration values of the representation type ID referenced by alternateRepresentationTypeId.
     * </ul>
     */
    sap.apf.ui.representations.representationInterface = function (dependencies, configuration) {
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#setData
         * @description The binding sets the data (received from the request) that has to be visualized. The array aDataResponse is shared between all representations
         * of a step and the binding. When lines are moved, deleted or changed, you modify the visualization of the original data! When displaying the data, one can determine which record
         * is selected by aSelectedIndices.
         * @param {sap.apf.core.Metadata} oMetadata oMetadata holds meta information about the received data.
         * @param {array} aDataResponse Data response from the request.
         */
        this.setData = function (oMetadata, aDataResponse) {
            // remember aDataResponse and transform it, so that the chart can display the data
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getSelectionAsArray
         * @description This is the basic method with which the step can detect data selected in the chart.
         * @returns {number[]} An array with indices is returned.<br>E.g. if the first and the third line of the array aDataResponse have been selected,
         * then aIndices = [0, 2]. Counting of indices start from 0.
         * If all data has been selected, and aDataResponse.length == 4, then the array [0,1,2,3] is returned. In general [ 0 .. aDataResponse.length - 1]
         * If no data has been selected at all, then [] is returned.
         * In case of an empty selection, the value undefined has to be returned. An empty selection may occur, when selections in the previous step has been changed,
         * so that the visual selection on the chart is now empty (empty rectangle).
         */
        this.getSelectionAsArray = function () {
            return [ 0, 2 ]; // just an example. Here data points/series, that correspond to  aDataResponse[0] and aDataResponse[2] have been selected
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#adoptSelection
         * @description Called on representation by binding when a representation type is set.
         * Intention is to trigger transfer of selections that might exist on a representation (source) that is replaced by the "new" representation (target) to be set.
         * Therefore the target representation receives a reference pointing to the source representation.
         * In order to check whether selection transfer is possible the target representation initiates a negotiation process with the source representations (3-way-handshake).
         * If a common method can be determined between target and source representation the selection will be exchanged.
         * @param {object} oSourceRepresentation Source representation implementing the representationInterface.
         */
        this.adoptSelection = function (oSourceRepresentation) {
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getFilterMethodType
         * @description This method has to be implemented so that binding can determine which method has to be used for the filter retrieval from a representations.
         * @returns {sap.apf.constants.filterMethodTypes} The filter method type the representation supports
         */
        this.getFilterMethodType = function () {
            return sap.apf.constants.filterMethodTypes.selectionAsArray; // returns the filter method type the representation supports
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getRequestOptions
         * @description Additionally to parameters being set in the request configuration and filter values that are derived from the path logic,
         * a request can be enriched with additional options such as <b>$top</b>, <b>$skip</b> and <b>$orderby</b>.<p>
         * Dependent on the actual options a representation may require for a request, an object containing the correspondent properties may be returned by this method.
         * <br>In case no additional options are required an empty object should be returned.<p>
         *
         * The supported optional properties of the return object are:
         * <ul><li><b>paging</b>: An object containing optional properties<ul><li><b>top</b> for OData system query option $top <br>A numeric value is expected<li><b>skip</b> for query string option $skip<br> A numeric value is expected
         * <li><b>inlineCount</b> for OData system query option $inlineCount<br>A boolean value 'true' is expected if inline count is requested</ul>
         * <li><b>orderby</b> for OData system query option $orderby: Values could be of type<ul>
         *    <li><b>string</b> that holds a property name (in this case the default sort order 'ascending' is applied)
         *  <li><b>object</b> with properties:<ul>
         *    <li>'property' A string containing the property name is expected.
         *    <li>'descending' A boolean value 'true' is expected, if descending sort order is required for the property. If omitted default sort order 'ascending' is applied.
         *  </ul>
         *  <li><b>array</b> holding objects with properties 'property' and 'descending' as described above.</ul>
         * @returns {object}
         *Example:
         *<pre class="javascript">
         *{ paging : {
	 *		top : 10,
	 *		skip : 30,
	 *		inlineCount : true
	 *  },
	 *  orderby : [ 
	 *		{ property : "nameProperty1",
	 *		}, {
	 *		property : "nameProperty2",
	 *		descending : true
	 *		}
	 *  ]
	 *}
         *</pre>
         * See also <a href="http://www.odata.org/documentation/odata-version-2-0/uri-conventions/">http://www.odata.org/documentation/odata-version-2-0/uri-conventions/</a>
         */
        this.getRequestOptions = function () {
            return {}; // Default
            // return { paging : { top : 10, skip : 30, inlineCount : true }, orderby : [ { property : "propertyName", descending : true }] };
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getParameter
         * @description The method returns the constructor arguments which will be used to create toggle representation.
         * @returns {object} oParameters
         */
        this.getParameter = function () {
            var oParameters = {dimensions: [], measures: []};
            return oParameters;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getMainContent
         * @description This method holds the logic to draw the content to be shown on main representation area.
         * @returns {object} oUiObject The UI object that has to be shown in main representation area. Example: Line chart instance for a line chart representation.
         */
        this.getMainContent = function () {
            var oUiObject = {};
            return oUiObject;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getThumbnailContent
         * @description This method holds the logic to draw the content to be shown on thumbnail area.
         * @returns {object} oUiObject The UI object that has to be shown in thumbnail area. Example: Line chart instance for a line chart representation.
         */
        this.getThumbnailContent = function () {
            var oUiObject = {};
            return oUiObject;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getPrintContent
         * @description This method holds the logic to draw the content to be printed.
         * @returns {object} oUiObject The UI object that has to be printed. Example: Line chart instance for a line chart representation.
         */
        this.getPrintContent = function () {
            var oUiObject = {};
            return oUiObject;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getTooltipContent
         * @description This method holds the logic to draw the content to be shown as tooltip for a thumbnail.
         * It will be shown inside a tooltip Popup when the thumbnail content overflows the thumbnail container area with a gradient effect to indicate that it is overflowing.
         * @returns {object} oUiObject The UI object that has to be shown as tooltip for a thumbnail. Example: Detailed content of a form representation.
         */
        this.getTooltipContent = function () {
            var oUiObject = {};
            return oUiObject;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#removeAllSelection
         * @description This method holds the logic to remove all selection from the chart. It also updates the step.
         */
        this.removeAllSelection = function () {
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#serialize
         * @description This method returns the selection for serialization. This is required for the Persisting selection of current representation.
         * It includes selection mode and selections.
         * @returns {object} oSerializationInformation
         */
        this.serialize = function () {
            var oSerializationInformation = {};
            return oSerializationInformation;
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#deserialize
         * @description This method uses the serialization information from serialized data and sets the selection to representation based on mode and selection string returned.
         * @param {object} oSerializationInformation
         */
        this.deserialize = function (oSerializationInformation) {
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getAlternateRepresentation
         * @description Returns the alternate representation of current step (i.e. list representation for the charts)
         * @returns {object} oAlternateRepresentation
         */
        this.getAlternateRepresentation = function () {
            return this.oAlternateRepresentation;  //fixme: undefined
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getMetaData
         * @description Returns meta data for representation type
         * @returns {sap.apf.core.EntityTypeMetadata} metadata
         */
        this.getMetaData = function () {
            return this.metadata;  //fixme: undefined
        };
        /**
         * @public
         * @function
         * @name sap.apf.ui.representations.representationInterface#getData
         * @description Returns data for representation type
         * @returns {array} aDataResponse
         */
        this.getData = function () {
            return this.aDataResponse; //fixme: undefined
        };
    };
}());

}; // end of sap/apf/ui/representations/representationInterface.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.utils.UI5ChartHelper') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 * @class utils
 * @name utils
 * @memberOf sap.apf.ui.representations
 * @description holds utility functions used by viz representations 
 */
jQuery.sap.declare("sap.apf.ui.representations.utils.UI5ChartHelper");
/**
 * @class UI5ChartHelper
 * @name UI5ChartHelper
 * @memberOf sap.apf.ui.representations.utils
 * @description holds utility functions used by viz representations 
 */
sap.apf.ui.representations.utils.UI5ChartHelper = function(oApi, oParameters) {
	var self = this;
	this.parameter = oParameters;
	this.classifiedData = [];
	this.extendedDataSet = [];
	this.fieldKeysLookup = {};
	this.displayNameLookup = {};
	this.fieldNameLookup = {};
	this.filterLookup = {};
	this.datasetObj = {};
	this.cachedSelection = [];
	this.filterValues = [];
	this.dataAlreadySorted = false;
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method init
	 * @description Initialize hash maps, extended data response and dataset.
	 */
	this.init = function(aDataResponse, metadata, bIsGroupTypeChart, oDataSetHelper) {
		this.metadata = metadata;
		this.formatter = new sap.apf.ui.representations.utils.formatter(oApi, metadata, aDataResponse);
		initFieldsKeyLookup.bind(this)(metadata, aDataResponse);
		initExtendedDataResponse.bind(this)(aDataResponse);
		initDataset.bind(this)(bIsGroupTypeChart, oDataSetHelper);
		if (this.parameter.requiredFilters !== undefined && this.parameter.requiredFilters.length !== 0) {
			validateSelections();
		}
	};
	var validateSelections = function() {
		self.filterValues = self.filterValues.filter(function(filterTerm) {
			for( var i = 0; i < self.extendedDataResponse.length; i++) {
				var counter = 0;
				for( var j = 0; j < self.parameter.requiredFilters.length; j++) {
					if (filterTerm[j] === self.extendedDataResponse[i][self.parameter.requiredFilters[j]]) {
						counter = counter + 1;
					}
				}
				if (counter === self.parameter.requiredFilters.length) {
					return true;
				} else if (i === self.extendedDataResponse.length - 1) {
					return false;
				}
			}
		});
		self.cachedSelection = getHighlightPoints();
	};
	var initFieldsKeyLookup = function(metadata, aDataResponse) {
		var fieldObjects = this.parameter.dimensions.concat(this.parameter.measures);
		var aRequiredFilters = [];
		var checkRequiredFilterPresent = function(requiredFilter) {//Function to determine whether the required filter is one of the dimensions or measures
			var counter = 0;
			for( var i = 0; i < fieldObjects.length; i++) {
				if (fieldObjects[i].fieldName === requiredFilter) {
					counter++;
				}
			}
			return (counter === 0 ? false : true);
		};
		if (this.parameter.requiredFilters) {
			this.parameter.requiredFilters.forEach(function(requiredFilter) {
				if (!checkRequiredFilterPresent(requiredFilter)) {//If required filter not present in dimension or measure then it is pushed to field object
					var requiredFilterObject = {
						fieldName : requiredFilter
					};
					aRequiredFilters.push(requiredFilterObject);
				}
			});
		}
		if (aRequiredFilters.length !== 0) {
			fieldObjects = fieldObjects.concat(aRequiredFilters);
		}
		for( var i = 0; i < fieldObjects.length; i++) {
			var fieldObject = fieldObjects[i];
			var fieldName = fieldObject.fieldName;
			this.displayNameLookup[fieldName] = {};
			if (metadata !== undefined) {
				if (metadata.getPropertyMetadata(fieldName).hasOwnProperty('text') && (metadata.getPropertyMetadata(fieldName)["aggregation-role"] !== "measure")) {
					var textField = metadata.getPropertyMetadata(fieldName).text;
					var textFieldName = metadata.getPropertyMetadata(textField).label;
					this.displayNameLookup[fieldName].DISPLAY_NAME = textFieldName;
					this.displayNameLookup[fieldName].VALUE = "formatted_" + fieldName;
				} else if (metadata.getPropertyMetadata(fieldName)["aggregation-role"] === "dimension") {
					this.displayNameLookup[fieldName].DISPLAY_NAME = metadata.getPropertyMetadata(fieldName).label;
					this.displayNameLookup[fieldName].VALUE = "formatted_" + fieldName;
				} else {
					this.displayNameLookup[fieldName].DISPLAY_NAME = metadata.getPropertyMetadata(fieldName).label;
					this.displayNameLookup[fieldName].VALUE = fieldName;
				}
				if (fieldObject.fieldDesc !== undefined && oApi.getTextNotHtmlEncoded(fieldObject.fieldDesc).length) {
					this.displayNameLookup[fieldName].DISPLAY_NAME = oApi.getTextNotHtmlEncoded(fieldObject.fieldDesc);
				}
				if (metadata.getPropertyMetadata(fieldName).unit !== undefined) {
					var sUnitReference = metadata.getPropertyMetadata(fieldName).unit;
					var sUnitValue;
					if (aDataResponse !== undefined && aDataResponse.length !== 0) {
						sUnitValue = aDataResponse[0][sUnitReference];
						this.displayNameLookup[fieldName].DISPLAY_NAME = this.displayNameLookup[fieldName].DISPLAY_NAME + ' (' + sUnitValue + ')';
					}
				}
			}
			this.fieldNameLookup[this.displayNameLookup[fieldName].DISPLAY_NAME] = {};
			this.fieldNameLookup[this.displayNameLookup[fieldName].DISPLAY_NAME].FIELD_NAME = fieldName;
			this.fieldNameLookup[this.displayNameLookup[fieldName].DISPLAY_NAME].VALUE = this.displayNameLookup[fieldName].VALUE;
		}
	};
	var initExtendedDataResponse = function(aDataResponse) {
		this.extendedDataResponse = jQuery.extend([], true, aDataResponse);
		var i, j, k;
		//Extend the aDataResponse
		if (this.extendedDataResponse.length !== 0) {
			for(i = 0; i < this.extendedDataResponse.length; i++) {
				for(k = 0; k < this.parameter.measures.length; k++) {
					if (this.extendedDataResponse[i][this.parameter.measures[k].fieldName] !== null) {
						this.extendedDataResponse[i][this.parameter.measures[k].fieldName] = parseFloat(this.extendedDataResponse[i][this.parameter.measures[k].fieldName]);
					}
				}
				for(j = 0; j < Object.keys(this.displayNameLookup).length; j++) {
					var fieldName = Object.keys(this.displayNameLookup)[j];
					var formattedFieldExists = (this.displayNameLookup[fieldName].VALUE.search('formatted_') !== -1); // To check whether property exists or not
					if (formattedFieldExists) {
						var textExists = this.metadata.getPropertyMetadata(fieldName).hasOwnProperty('text'); // To check whether property exists or not
						if (!textExists) {
							this.extendedDataResponse[i][this.displayNameLookup[fieldName].VALUE] = this.formatter.getFormattedValue(fieldName, this.extendedDataResponse[i][fieldName]);
						} else {
							var textField = this.metadata.getPropertyMetadata(fieldName).text;
							var oTextToBeFormatted = {
								text : this.extendedDataResponse[i][textField],
								key : this.extendedDataResponse[i][fieldName]
							};
							this.extendedDataResponse[i][this.displayNameLookup[fieldName].VALUE] = this.formatter.getFormattedValueForTextProperty(fieldName, oTextToBeFormatted);
						}
					}
				}
				var filterKeyText = "";
				for(j = 0; j < this.parameter.dimensions.length; j++) {
					var dimensionValueField = this.displayNameLookup[this.parameter.dimensions[j].fieldName].VALUE;
					this.extendedDataResponse[i][dimensionValueField] = this.extendedDataResponse[i][dimensionValueField] === null ? this.extendedDataResponse[i][dimensionValueField] : this.extendedDataResponse[i][dimensionValueField].toString();
					filterKeyText = filterKeyText + this.extendedDataResponse[i][dimensionValueField];
					this.filterLookup[filterKeyText] = [];
					if (this.parameter.requiredFilters) {
						for(k = 0; k < this.parameter.requiredFilters.length; k++) {
							var filterValue = {};
							filterValue.id = this.extendedDataResponse[i][this.parameter.requiredFilters[k]];
							filterValue.text = this.extendedDataResponse[i][this.displayNameLookup[this.parameter.requiredFilters[k]].VALUE];
							this.filterLookup[filterKeyText].push(filterValue);
						}
					}
				}
			}
		} else {
			var obj = {};
			for(k = 0; k < this.parameter.measures.length; k++) {
				obj[self.displayNameLookup[this.parameter.measures[k].fieldName].VALUE] = undefined;
			}
			for(j = 0; j < this.parameter.dimensions.length; j++) {
				obj[self.displayNameLookup[this.parameter.dimensions[j].fieldName].VALUE] = undefined;
			}
			this.extendedDataResponse.push(obj);
		}
	};
	var initDataset = function(bIsGroupTypeChart, oDataSetHelper) {
		var obj = this.extendedDataResponse;
		var oModel = new sap.ui.model.json.JSONModel();
		oModel.setData({
			data : obj
		});
		var aDimensions = [];
		var aMeasures = [];
		var i = 0;
		for(i = 0; i < this.parameter.dimensions.length; i++) {
			aDimensions[i] = {
				name : this.displayNameLookup[this.parameter.dimensions[i].fieldName].DISPLAY_NAME,
				value : this.displayNameLookup[this.parameter.dimensions[i].fieldName].VALUE,
				kind : this.parameter.dimensions[i].kind ? this.parameter.dimensions[i].kind : undefined,
				axisfeedItemId : this.parameter.dimensions[i].axisfeedItemId ? this.parameter.dimensions[i].axisfeedItemId : undefined
			};
		}
		self.measureAxisType = bIsGroupTypeChart;
		for(i = 0; i < this.parameter.measures.length; i++) {
			aMeasures[i] = {
				name : this.displayNameLookup[this.parameter.measures[i].fieldName].DISPLAY_NAME,
				value : this.displayNameLookup[this.parameter.measures[i].fieldName].VALUE,
				kind : this.parameter.measures[i].kind ? this.parameter.measures[i].kind : undefined,
				axisfeedItemId : this.parameter.measures[i].axisfeedItemId ? this.parameter.measures[i].axisfeedItemId : undefined
			};
		}
		var oParameter = {
			dimensions : aDimensions,
			measures : aMeasures
		};
		var flattendeDataSetObj = oDataSetHelper.getDataset(oParameter);
		if (this.metadata !== undefined) {
			for(i = 0; i < this.parameter.dimensions.length; i++) {
				var oMetaData = this.metadata.getPropertyMetadata(this.parameter.dimensions[i].fieldName);
				if (oMetaData.isCalendarYearMonth === "true") {
					if (this.parameter.dimensions.length > 1) {
						flattendeDataSetObj.data.sorter = new sap.ui.model.Sorter(this.parameter.dimensions[0].fieldName, false);
					}
				}
			}
		}
		this.datasetObj = flattendeDataSetObj;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getDataset
	 * @description returns new flattended data set.
	 */
	this.getDataset = function() {
		return new sap.viz.ui5.data.FlattenedDataset(this.datasetObj);
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getModel
	 * @description returns json model with data set.
	 */
	this.getModel = function() {
		var obj = this.extendedDataResponse;
		var oModel = new sap.ui.model.json.JSONModel();
		oModel.setData({
			data : obj
		});
		return oModel;
	};
	/**
	 * @deprecated since version 1.27.0 and using getFilters API instead
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getFilterCount
	 * @description returns the number of filters.
	 */
	this.getFilterCount = function() {
		return this.filterValues.length;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getFilters
	 * @description returns the filter object id and text
	 */
	this.getFilters = function() {
		var filterLookupKeys = Object.keys(this.filterLookup);
		var aFilterValueObjects = [];
		var self = this;
		var filterLookup = function(filterId) {//Function to match filterValue id and filter lookup to get the text for the id
			for( var i = 0; i < filterLookupKeys.length; i++) {
				var filterValueObject = {};
				var key = filterLookupKeys[i];
				for( var j = 0; j < self.filterLookup[key].length; j++) {
					if (filterId === self.filterLookup[key][j].id) {
						filterValueObject.id = filterId;
						filterValueObject.text = self.filterLookup[key][j].text;
						aFilterValueObjects.push(filterValueObject);
						return;// Exit loops when a match is found
					}
				}
			}
		};
		for( var i = 0; i < this.filterValues.length; i++) {
			filterLookup(this.filterValues[i][0]);
		}
		return aFilterValueObjects;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getSelectionFromFilter
	 * @description returns highlight points from currently selected filters.
	 */
	this.getSelectionFromFilter = function() {
		if (this.parameter.requiredFilters === undefined || this.parameter.requiredFilters.length === 0) {
			return [];
		}
		var highlightPoints = getHighlightPoints();
		return highlightPoints;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getHighlightPointsFromSelectionEvent
	 * @description manage filters and returns highlight points from currently selected filters.
	 */
	this.getHighlightPointsFromSelectionEvent = function(allSelections) {
		var selections = [];
		var newSelections = [];
		selections = getExclusiveSelections(allSelections, this.cachedSelection);
		for( var i = 0; i < selections.length; i++) {
			var selObj = selections[i];
			if (this.parameter.measures.length === 1) {
				var measureDisplayName = this.displayNameLookup[this.parameter.measures[0].fieldName].DISPLAY_NAME;
				if (selObj.data[measureDisplayName] === undefined || selObj.data[measureDisplayName] === null) {
					continue; // null selection scenario encountered when a series has missing data. (StackedColumn, % StackedColumn etc.)
				}
			}
			var filterKeyText = "";
			for( var j = 0; j < this.parameter.dimensions.length; j++) {
				var dimensionDisplayName = this.displayNameLookup[this.parameter.dimensions[j].fieldName].DISPLAY_NAME;
				filterKeyText = filterKeyText + selObj.data[dimensionDisplayName];
			}
			var filterTermArray = this.filterLookup[filterKeyText];
			var resultArray = this.filterValues.filter(function(existingTerm) {
				var counter = 0;
				for( var i = 0; i < self.parameter.requiredFilters.length; i++) {
					if (existingTerm[i] === filterTermArray[i].id) {
						counter = counter + 1;
					} else {
						break;
					}
				}
				if (counter === self.parameter.requiredFilters.length) {
					return true;
				} else if (i === self.parameter.requiredFilters.length) {
					return false;
				}
			});
			if (resultArray.length === 0) {
				var aModifiedFilterTermArray = filterTermArray.map(function(oTerm) {
					return oTerm.id;
				});
				this.filterValues.push(aModifiedFilterTermArray);
			}
		}
		newSelections = getHighlightPoints();
		this.cachedSelection = newSelections;
		return newSelections;
	};
	var getExclusiveSelections = function(allSelections, newSelection) {
		var exclusiveSelections = allSelections.filter(function(selObj) {
			for( var i = 0; i < newSelection.length; i++) {
				var counter = 0;
				for( var j = 0; j < Object.keys(selObj.data).length; j++) {
					if (newSelection[i].data[Object.keys(selObj.data)[j]] === selObj.data[Object.keys(selObj.data)[j]]) {
						counter = counter + 1;
					} else {
						break;
					}
				}
				if (counter === Object.keys(selObj.data).length) {
					return false;
				} else if (j === Object.keys(selObj.data).length) {
					return true;
				}
			}
			return true;
		});
		return exclusiveSelections;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getFilterFromSelection
	 * @description returns filter objects from current selections.
	 */
	this.getFilterFromSelection = function() {
		var reqFilterValues = [];
		var i;
		for(i = 0; i < self.filterValues.length; i++) {
			reqFilterValues.push(self.filterValues[i][0]);
		}
		var oFilter = oApi.createFilter();
		var EQ = oFilter.getOperators().EQ;
		var oFilterExpression;
		var oAddedOrCondition = oFilter.getTopAnd().addOr('exprssionOr');
		for(i = 0; i < reqFilterValues.length; i++) {
			var dataType = this.metadata.getPropertyMetadata(self.parameter.requiredFilters[0]).dataType.type;
			if (dataType === "Edm.Int32") {
				reqFilterValues[i] = reqFilterValues[i] === null ? reqFilterValues[i] : parseFloat(reqFilterValues[i]);
			}
			oFilterExpression = {
				id : reqFilterValues[i],
				name : self.parameter.requiredFilters[0],
				operator : EQ,
				value : reqFilterValues[i]
			};
			oAddedOrCondition.addExpression(oFilterExpression);
		}
		return oFilter;
	};
	var getHighlightPoints = function() {
		var reqFilterValues = [];
		reqFilterValues[0] = [];
		var i, j, k, l;
		for(i = 0; i < self.filterValues.length; i++) {
			reqFilterValues[0].push(self.filterValues[i][0]);
		}
		var newSelections = [];
		for(i = 0; i < self.extendedDataResponse.length; i++) {
			var dataRow = self.extendedDataResponse[i];
			for(j = 0; j < reqFilterValues[0].length; j++) {
				var counter = 0;
				for(k = 0; k < reqFilterValues.length; k++) {
					if (dataRow[self.parameter.requiredFilters[k]] === reqFilterValues[k][j]) {
						counter = counter + 1;
					}
				}
				if (counter === reqFilterValues.length) {
					var newSelObject = {
						data : {}
					};
					var displayFieldName;
					var valueFieldName;
					for(k = 0; k < self.getDataset().getDimensions().length; k++) {
						var dimensionDisplayFieldName = self.getDataset().getDimensions()[k].getName();
						var dimensionValueFieldName = self.fieldNameLookup[dimensionDisplayFieldName].VALUE;
						newSelObject.data[dimensionDisplayFieldName] = dataRow[dimensionValueFieldName];
					}
					if (!self.measureAxisType) {
						var measureDisplayFieldName;
						var measureValueFieldName;
						for(l = 0; l < self.getDataset().getMeasures().length; l++) {
							var newSelObjClone = jQuery.extend(true, {}, newSelObject);
							measureDisplayFieldName = self.getDataset().getMeasures()[l].getName();
							measureValueFieldName = self.fieldNameLookup[measureDisplayFieldName].VALUE;
							newSelObjClone.data[measureDisplayFieldName] = dataRow[measureValueFieldName] === null ? dataRow[measureValueFieldName] : parseFloat(dataRow[measureValueFieldName]);
							newSelections.push(newSelObjClone);
						}
					} else {
						for(k = 0; k < self.getDataset().getMeasures().length; k++) {
							displayFieldName = self.getDataset().getMeasures()[k].getName();
							valueFieldName = self.fieldNameLookup[displayFieldName].VALUE;
							newSelObject.data[displayFieldName] = dataRow[valueFieldName] === null ? dataRow[valueFieldName] : parseFloat(dataRow[valueFieldName]);
						}
						newSelections.push(newSelObject);
					}
				}
			}
		}
		return newSelections;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.UI5ChartHelper
	 * @method getHighlightPointsFromDeselectionEvent
	 * @description manage filters and returns highlight points from current selection.
	 */
	this.getHighlightPointsFromDeselectionEvent = function(currentSelection) {
		var i, j;
		var deselectedObjs = getExclusiveSelections(this.cachedSelection, currentSelection);
		for(i = 0; i < deselectedObjs.length; i++) {
			var deselObj = deselectedObjs[i];
			var filterKeyText = "";
			for(j = 0; j < this.parameter.dimensions.length; j++) {
				var dimensionDisplayName = this.displayNameLookup[this.parameter.dimensions[j].fieldName].DISPLAY_NAME;
				filterKeyText = filterKeyText + deselObj.data[dimensionDisplayName];
			}
			var filterTermArray = this.filterLookup[filterKeyText];
			this.filterValues = this.filterValues.filter(function(currentFilter, index) {
				var counter = 0;
				for( var i = 0; i < filterTermArray.length; i++) {
					if (filterTermArray[i].id === currentFilter[i]) {
						counter = counter + 1;
					}
				}
				if (counter === filterTermArray.length) {
					return false;
				} else {
					return true;
				}
			});
		}
		var newSelections = getHighlightPoints();
		this.cachedSelection = newSelections;
		return newSelections;
	};
};
}; // end of sap/apf/ui/representations/utils/UI5ChartHelper.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.utils.formatter') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 * @class utils
 * @name utils
 * @memberOf sap.apf.ui.representations
 * @description holds utility functions used by UI5ChartHelper and representations 
 */
jQuery.sap.declare("sap.apf.ui.representations.utils.formatter");
/**
 * @class formatter
 * @name formatter
 * @memberOf sap.apf.ui.representations.utils
 * @param {sap.apf.ui.representations.RepresentationInterfaceProxy} oApi - apfInstance, metadata and dataResponse
 * @param {sap.apf.core.Metadata} metadata
 * @param {array} dataResponse
 * @description holds utility functions used by UI5ChartHelper and  representations 
 */
sap.apf.ui.representations.utils.formatter = function(oApi, metadata, dataResponse) {
	var self = this;
	this.metadata = metadata;
	this.dataResponse = dataResponse;
	/**
	 * @memberOf sap.apf.ui.representations.utils.formatter
	 * @method getFormattedValue
	 * @description formats the given value
	 * @returns formatted value according to the type
	 */
	this.getFormattedValue = function(fieldName, originalFieldValue) {
		var formattedFieldValue, yearMetadata, quarterMetadata, dateFromMetadata, yearInfoFromDate, weekMetadata, dateFormat;
		var oMetadata = this.metadata.getPropertyMetadata(fieldName);
		if (oMetadata.isCalendarYearMonth) { //calenderYearMonth
			if (originalFieldValue !== null) {
				formattedFieldValue = this.doYearMonthFormat(originalFieldValue);
			} else {
				formattedFieldValue = "";
			}
		} else if (oMetadata.dataType.type === "Edm.DateTime") { //dateTime
			if (originalFieldValue !== null) {
				dateFormat = new Date(parseInt(originalFieldValue.slice(6, originalFieldValue.length - 2), 10));
				dateFormat = dateFormat.toLocaleDateString();
				if (dateFormat === "Invalid Date") {
					formattedFieldValue = "-";
				} else {
					formattedFieldValue = dateFormat;
				}
			} else {
				formattedFieldValue = "-";
			}
		} else if (oMetadata.unit) { //unit for currency
			if (originalFieldValue !== null) {
				var currencyMetadata = self.metadata.getPropertyMetadata(oMetadata.unit);
				if (currencyMetadata.semantics === "currency-code") {
					var precision = this.dataResponse[0][oMetadata.scale];
					originalFieldValue = parseFloat(originalFieldValue).toFixed(precision).toString();
					var store = originalFieldValue.split(".");
					var amountValue = parseFloat(store[0]).toLocaleString();
					var sample = 0.1;
					sample = sample.toLocaleString();
					if (amountValue.split(sample.substring(1, 2)).length > 1) {
						amountValue = amountValue.split(sample.substring(1, 2))[0];
					}
					amountValue = amountValue.concat(sample.substring(1, 2), store[1]);
					formattedFieldValue = amountValue;
				} else {
					formattedFieldValue = originalFieldValue;
				}
			} else {
				formattedFieldValue = "-";
			}
		} else if (oMetadata.isCalendarDate) {
			if (originalFieldValue !== null) {
				yearMetadata = originalFieldValue.substr(0, 4);
				var monthMetadata = parseInt(originalFieldValue.substr(4, 2), 10) - 1;
				var dateMetadata = originalFieldValue.substr(6, 2);
				dateFormat = new Date(yearMetadata, monthMetadata, dateMetadata);
				dateFormat = dateFormat.toLocaleDateString();
				if (dateFormat === "Invalid Date") {
					formattedFieldValue = "-";
				} else {
					formattedFieldValue = dateFormat;
				}
			} else {
				formattedFieldValue = "-";
			}
		} else if (oMetadata.isCalendarYearQuarter) {
			if (originalFieldValue !== null) {
				yearMetadata = originalFieldValue.substr(0, 4);
				quarterMetadata = originalFieldValue.substr(4, 1);
				dateFromMetadata = new Date(yearMetadata);
				yearInfoFromDate = dateFromMetadata.getFullYear();
				var quarterInfo;
				quarterInfo = "Q" + quarterMetadata;
				var formattedYearQuarter = quarterInfo + " " + yearInfoFromDate;
				formattedFieldValue = formattedYearQuarter;
			} else {
				formattedFieldValue = "";
			}
		} else if (oMetadata.isCalendarYearWeek) {
			if (originalFieldValue !== null) {
				yearMetadata = originalFieldValue.substr(0, 4);
				weekMetadata = originalFieldValue.substr(4, 2);
				dateFromMetadata = new Date(yearMetadata);
				yearInfoFromDate = dateFromMetadata.getFullYear();
				var weekInfo;
				weekInfo = "CW" + weekMetadata;
				var formattedYearWeek = weekInfo + " " + yearInfoFromDate;
				formattedFieldValue = formattedYearWeek;
			} else {
				formattedFieldValue = "";
			}
		} else { //default value
			if (originalFieldValue === null) {
				formattedFieldValue = "null";
			} else {
				formattedFieldValue = originalFieldValue;
			}
		}
		// application formatter callback
		var metadataObject = jQuery.extend({}, this.metadata.getPropertyMetadata(fieldName));
		formattedFieldValue = this._applyCustomFormatting(metadataObject, fieldName, originalFieldValue, formattedFieldValue);
		return formattedFieldValue;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.formatter
	 * @method doYearMonthFormat
	 * @param fieldValue
	 * @description yearMonth formatting 
	 */
	this.doYearMonthFormat = function(fieldValue) {
		var jan = oApi.getTextNotHtmlEncoded("month-1-shortName");
		var feb = oApi.getTextNotHtmlEncoded("month-2-shortName");
		var mar = oApi.getTextNotHtmlEncoded("month-3-shortName");
		var apr = oApi.getTextNotHtmlEncoded("month-4-shortName");
		var may = oApi.getTextNotHtmlEncoded("month-5-shortName");
		var jun = oApi.getTextNotHtmlEncoded("month-6-shortName");
		var jul = oApi.getTextNotHtmlEncoded("month-7-shortName");
		var aug = oApi.getTextNotHtmlEncoded("month-8-shortName");
		var sep = oApi.getTextNotHtmlEncoded("month-9-shortName");
		var oct = oApi.getTextNotHtmlEncoded("month-10-shortName");
		var nov = oApi.getTextNotHtmlEncoded("month-11-shortName");
		var dec = oApi.getTextNotHtmlEncoded("month-12-shortName");
		var monthsArray = [ jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec ];
		var year = fieldValue.substr(0, 4);
		var month = monthsArray[fieldValue.substr(4, 6) - 1];
		return month + " " + year;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.formatter
	 * @method isAmountField
	 * @param fieldName
	 * @description checks if the field is amount field 
	 */
	this.isAmountField = function(fieldName) {
		var isAmntField = false;
		if (this.metadata && this.dataResponse) {
			var oMetadata = this.metadata.getPropertyMetadata(fieldName);
			if (oMetadata !== undefined && oMetadata.unit) {
				var currencyMetadata = this.metadata.getPropertyMetadata(oMetadata.unit);
				if (currencyMetadata !== undefined && currencyMetadata.semantics === "currency-code") {
					isAmntField = true;
				}
			}
		}
		return isAmntField;
	};
	/**
	 * @method getPrecision
	 * @param fieldName
	 * @description gets the precision for a given fieldName 
	 */
	this.getPrecision = function(fieldName) {
		var oMetadata = this.metadata.getPropertyMetadata(fieldName);
		if (oMetadata !== undefined && this.dataResponse !== undefined && this.dataResponse[0] !== undefined) {
			return this.dataResponse[0][oMetadata.scale];
		}
	};
	/**
	 * @method getFormatString
	 * @param measures- measures of chart
	 * @description returns the stringFormat 
	 */
	this.getFormatString = function(measure) {
		var zeroStr = "";
		var sFormatString;
		var fieldName = measure.fieldName;
		var isAmountField = this.isAmountField(fieldName);
		if (isAmountField === true) {
			//check for precision point
			var precision = this.getPrecision(fieldName);
			if (precision !== undefined) {
				for( var i = 0; i < precision; i++) {
					zeroStr = zeroStr + "0";
				}
				sFormatString = "#,#0" + "." + zeroStr;
			} else {
				sFormatString = "";
			}
		} else {
			sFormatString = "";
		}
		return sFormatString;
	};
	/**
	 * @method getFormattedValueForTextProperty
	 * @param {oTextToBeFormatted} - the texts which has to be concatenated 
	 *    oTextToBeFormatted ={
	 *                         text:textField,
	 *                        key:fieldName
	 *                        }
	 * @description returns the concatenated string (e.g. Customer Name(Customer Id) for a text field 
	 */
	this.getFormattedValueForTextProperty = function(fieldName, oTextToBeFormatted) {
		var sFormattedText;
		if (oTextToBeFormatted.key) {
			sFormattedText = oTextToBeFormatted.text + "(" + oTextToBeFormatted.key + ")";
		} else {
			sFormattedText = oTextToBeFormatted.text;
		}
		var metadataObject = jQuery.extend({}, this.metadata.getPropertyMetadata(fieldName));
		sFormattedText = this._applyCustomFormatting(metadataObject, fieldName, oTextToBeFormatted.text, sFormattedText);// application formatter callback
		return sFormattedText;
	};
	/**
	 * @private
	 * @method _applyCustomFormatting
	 * @description calls the application specific formatting if it is available
	 */
	this._applyCustomFormatting = function(metadataObject, fieldName, originalFieldValue, formattedFieldValue) {
		var callback = oApi.getEventCallback(sap.apf.core.constants.eventTypes.format);
		if (typeof callback === "function") {
			var appFormattedFieldValue = callback.apply(oApi, [ metadataObject, fieldName, originalFieldValue, formattedFieldValue ]);
			if (appFormattedFieldValue !== undefined) {
				formattedFieldValue = appFormattedFieldValue;
			}
			if (appFormattedFieldValue === null) {
				formattedFieldValue = "";
			}
		}
		return formattedFieldValue;
	};
};
}; // end of sap/apf/ui/representations/utils/formatter.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.utils.vizDatasetHelper') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 * @class utils
 * @name utils
 * @memberOf sap.apf.ui.representations
 * @description holds utility functions used by viz representations
 */
jQuery.sap.declare("sap.apf.ui.representations.utils.vizDatasetHelper");

/**
 * @class vizDatasetHelper
 * @name vizdatasetHelper
 * @memberOf sap.apf.ui.representations.utils
 * @param bIsGroupTypeChart- boolean to indicate if the chart is of type group (bubble,scatter)
 * @description holds utility functions used by viz representations
 */
sap.apf.ui.representations.utils.VizDatasetHelper = function(bIsGroupTypeChart) {
	// axisType for viz charts is either axis(Eg: Column, Bar, Pie, Line, Stacked Column, Percentage Stacked Column, Clustered Column) or group(Bubble, Scatter)
	/*
	 * If kind(supportedKind) is defined for dimensions 
	 * Dimensions for axis type charts are : xAxis(axis : 1), legend(axis: 2) and sectorColor(axis: 1)
	 * Dimensions for group type charts are : regionColor(axis : 1) and regionShape(axis: 2)
	 */
	/**
	 * @memberOf sap.apf.ui.representations.utils.vizDatasetHelper
	 * @method getAxis
	 * @description Returns the axis (1 or 2) based on kind attribute
	 * */
	var getAxis = function(sKind) {
		var nAxis;
		var oSupportedKinds = sap.apf.core.constants.representationMetadata.kind;
		if (!bIsGroupTypeChart) {
			if (sKind === oSupportedKinds.LEGEND) {
				nAxis = 2;
			} else if (sKind === oSupportedKinds.XAXIS || sKind === oSupportedKinds.SECTORCOLOR) {
				nAxis = 1;
			}
		} else {
			if (sKind === oSupportedKinds.REGIONCOLOR) {
				nAxis = 1;
			} else if (sKind === oSupportedKinds.REGIONSHAPE) {
				nAxis = 2;
			}
		}
		return nAxis;
	};
	/**
	 * @memberOf sap.apf.ui.representations.utils.vizDatasetHelper
	 * @method getDataset
	 * @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
	 * @description Prepares and returns the data set for viz charts
	 * */
	this.getDataset = function(oParameters) {
		this.parameter = oParameters;
		var aDimensions = [];
		var aMeasures = [];
		this.parameter.dimensions.forEach(function(dimension, index) {
			if (dimension.kind !== undefined) {// If kind(supportedKind) is defined for dimensions in parameter
				aDimensions[index] = {
					name : dimension.name,
					value : '{' + dimension.value + '}',
					axis : getAxis(dimension.kind)
				};
			} else {// If kind(supportedKind) is not defined for dimensions in parameter, first dimension is set to axis = 1 and rest to 2
				aDimensions[index] = {
					name : dimension.name,
					value : '{' + dimension.value + '}',
					axis : index === 0 ? 1 : 2
				};
			}
		});
		/*
		 * If kind(supportedKind) is defined for measures in parameter 
		 * Measures for axis type charts are : yAxis(axis :1) and sectorSize(axis: 1) 
		 * Measures for group type charts are : xAxis(axis : 1), yAxis(axis: 2), bubbleWidth(axis:3) and bubbleWidth(axis: 4)
		 */
		this.parameter.measures.forEach(function(measures, index) {
			var sAxisType;
			if (bIsGroupTypeChart) {
				sAxisType = sap.apf.ui.utils.CONSTANTS.axisTypes.GROUP;
			} else {
				sAxisType = sap.apf.ui.utils.CONSTANTS.axisTypes.AXIS;
			}
			if (measures.kind !== undefined) {
				aMeasures[index] = {
					name : measures.name,
					value : '{' + measures.value + '}'
				};
				var oSupportedKinds = sap.apf.core.constants.representationMetadata.kind;
				switch (measures.kind) {
					case oSupportedKinds.XAXIS:
						aMeasures[index][sAxisType] = 1;
						break;
					case oSupportedKinds.YAXIS:
						if (!bIsGroupTypeChart) {
							aMeasures[index][sAxisType] = 1;
						} else {
							aMeasures[index][sAxisType] = 2;
						}
						break;
					case oSupportedKinds.SECTORSIZE:
						aMeasures[index][sAxisType] = 1;
						break;
					case oSupportedKinds.BUBBLEWIDTH:
						aMeasures[index][sAxisType] = 3;
						break;
					case oSupportedKinds.BUBBLEHEIGHT:
						aMeasures[index][sAxisType] = 4;
						break;
				}
			} else {// If kind(supportedKind) is not defined for measures in parameter
				aMeasures[index] = {
					name : measures.name,
					value : '{' + measures.value + '}'
				};
				aMeasures[index][sAxisType] = index + 1;
			}
		});
		var flattendeDataSetObj = {
			dimensions : aDimensions,
			measures : aMeasures,
			data : {
				path : "/data"
			}
		};
		return flattendeDataSetObj;
	};
};
}; // end of sap/apf/ui/representations/utils/vizDatasetHelper.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.utils.vizFrameDatasetHelper') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/**
 * @class utils
 * @name utils
 * @memberOf sap.apf.ui.representations
 * @description holds utility functions used by viz representations
 */

jQuery.sap.declare("sap.apf.ui.representations.utils.vizFrameDatasetHelper");
/**
 * @class vizFrameDatasetHelper
 * @name vizFrameDatasetHelper
 * @memberOf sap.apf.ui.representations.utils
 * @description holds utility functions to determine the feedItem type id for dimensions and measures for each vizFrame chart
 * 
 */
sap.apf.ui.representations.utils.vizFrameDatasetHelper = function(bIsGroupTypeChart) {
	var getAxisFeedItemId = function(sKind) {
		var oSupportedTypes = sap.apf.core.constants.representationMetadata.kind;
		var aFeedItemTypes = sap.apf.core.constants.vizFrame.feedItemTypes;
		//TODO add more feedItem ids when the document is provided by vizFrame
		var axisfeedItemId;
		switch (sKind) {
			case oSupportedTypes.XAXIS:
				if (!bIsGroupTypeChart) {
					axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS;
				} else {
					axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
				}
				break;
			case oSupportedTypes.YAXIS:
				if (!bIsGroupTypeChart) {
					axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
				} else {
					axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS2;
				}
				break;
			case oSupportedTypes.SECTORCOLOR:
			case oSupportedTypes.LEGEND:
			case oSupportedTypes.REGIONCOLOR:
				axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
				break;
			case oSupportedTypes.SECTORSIZE:
				axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.SIZE;
				break;
			case oSupportedTypes.REGIONSHAPE:
				axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.SHAPE;
				break;
			case oSupportedTypes.BUBBLEWIDTH:
				axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEWIDTH;
				break;
			case oSupportedTypes.BUBBLEHEIGHT:
				axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEHEIGHT;
				break;
		}
		return axisfeedItemId;
	};
	this.getDataset = function(oParameters) {
		this.parameter = oParameters;
		var aDimensions = [];
		var aMeasures = [];
		this.parameter.dimensions.forEach(function(dimension, index) {
			if (dimension.kind !== undefined) {
				aDimensions[index] = {
					name : dimension.name,
					value : '{' + dimension.value + '}',
					axisfeedItemId : getAxisFeedItemId(dimension.kind)
				};
			} else {
				aDimensions[index] = {
					name : dimension.name,
					value : '{' + dimension.value + '}',
					axisfeedItemId : dimension.axisfeedItemId
				};
			}
		});
		this.parameter.measures.forEach(function(measure, index) {
			if (measure.kind !== undefined) {
				aMeasures[index] = {
					name : measure.name,
					value : '{' + measure.value + '}',
					axisfeedItemId : getAxisFeedItemId(measure.kind)
				};
			} else {
				aMeasures[index] = {
					name : measure.name,
					value : '{' + measure.value + '}',
					axisfeedItemId : measure.axisfeedItemId
				};
			}
		});
		var flattendeDataSetObj = {
			dimensions : aDimensions,
			measures : aMeasures,
			data : {
				path : "/data"
			}
		};
		return flattendeDataSetObj;
	};
};
}; // end of sap/apf/ui/representations/utils/vizFrameDatasetHelper.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.constants') ) {
/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
jQuery.sap.declare("sap.apf.ui.utils.constants");
/**
* @class CONSTANTS
* @name CONSTANTS
* @memberOf sap.apf.ui.utils
* @description defines application constants for UI classes
*/
sap.apf.ui.utils.CONSTANTS = {
	step : {
		OPEN_OVERLAY_IMAGE_HEIGHT : 15,
		DROP_MARKER_HEIGHT : 1
	},
	representationTypes : {
		FORM_REPRESENTATION : "FormRepresentation",
		TABLE_REPRESENTATION : "TableRepresentation",
		COLUMN_CHART : "ColumnChart",
		LINE_CHART : "LineChart",
		PIE_CHART : "PieChart",
		GEO_MAP : "GeoMap",
		STACKED_COLUMN_CHART : "StackedColumnChart",
		SCATTERPLOT_CHART : "ScatterPlotChart",
		PERCENTAGE_STACKED_COLUMN_CHART : "PercentageStackedColumnChart",
		BUBBLE_CHART : "BubbleChart"
	},
	vizChartTypes : {
		COLUMN : "Column",
		LINE : "Line",
		PIE : "Pie",
		STACKED_COLUMN : "StackedColumn",
		PERCENTAGE_STACKED_COLUMN : "StackedColumn100",
		SCATTERPLOT : "Scatter",
		BUBBLE : "Bubble"
	},
	vizFrameChartTypes : {
		COLUMN : "column",
		LINE : "line",
		PIE : "pie",
		STACKED_COLUMN : "stacked_column",
		PERCENTAGE_STACKED_COLUMN : "100_stacked_column",
		SCATTERPLOT : "scatter",
		BUBBLE : "bubble"
	},
	axisTypes : {
		AXIS: "axis",
		GROUP:"group"
	},
	thumbnailDimensions : {
		HEIGHT : "75px",
		WIDTH : "180px",
		STEP_WIDTH : "202px",
		STEP_HEIGHT : "170px",
		STEP_MARGIN : "20px",
		SEPARATOR_HEIGHT : "25px",
		REMOVE_ICON_HEIGHT : "20px",
		TOTAL_STEP_HEIGHT : 215
	// Step height + margin + separator.
	},
	printChartDimensions : {
		WIDTH : "0.89",
		POTRAITWIDTH : "793.700787402",
		LANDSCAPEWIDTH : "1122.519685039"
	},
	analysisPathArea : {
		HEADERHEIGHT : 140
	},
	chartArea : {
		CHARTHEADERHEIGHT : 120
	},
	carousel : {
		SCROLLCONTAINER : 275,
		DNDBOX : 280
	},
	landingPage : "landingPage"
};

}; // end of sap/apf/ui/utils/constants.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.facetFilterHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.ui.utils.facetFilterHandler');
jQuery.sap.require('sap.ui.thirdparty.d3'); // unlisted dependency retained

/**
 * @private
 * @experimental The complete class interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
 * @class Facet filter handler
 * @description Manages the Path context creation and handles facet filter creation.
 * @param {Object} oInject - Dependencies for Facet Filter Handler.
 * @name sap.apf.ui.utils.FacetFilterHandler
 * @returns {sap.apf.ui.utils.FacetFilterHandler}
 */
sap.apf.ui.utils.FacetFilterHandler = function(oInject) {
	"use strict";
	var oCoreApi = oInject.oCoreApi;
	var oSBHandler = oInject.oSBHandler;
	var oPathContextHandler = oInject.oPathContextHandler;
	var oUiApi = oInject.oUiApi;
	var aFacetFiltersFromConfiguration = [];
	var mode = oInject.mode;
	var aSbFilters = [];
	var aFacetFilters = [];
	var aConsolidatedFilters = [];
	var oContextFilterMap = {};
	var oFacetFilterView;
	var oSBFilterPromise;
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.utils.FacetFilterHandler#initialize
	 * @description Initializes the oSBHandler, fetches the facetfilter configuration and trigger context creation.
	 * */
	this.initialize = function() {
		aFacetFiltersFromConfiguration = oCoreApi.getFacetFilterConfigurations();
		if (oSBHandler) {
			oSBHandler.initialize();
			oSBFilterPromise = oSBHandler.getAllFilters();
			oSBFilterPromise.then(this._prepareContext.bind(this));
		} else {
			this._prepareContext([]);
		}
	};
	this._prepareContext = function(sbFilters) {
		if (mode !== "backward") { //Prevents updating context as PCH already has the updated context 
			this._setSBFilters(sbFilters);
			this._setFacetFiltersFromConfiguration();
			this._setConsolidatedFilters();
			this._setContextFilterMap();
			this._updatePathContextHandler();
		} else {
			oUiApi.contextChanged();
		}
	};
	this._setSBFilters = function(sbFilters) {
		aSbFilters = sbFilters;
	};
	this._setFacetFiltersFromConfiguration = function() {
		var self = this;
		aFacetFiltersFromConfiguration.forEach(function(oFacetFilter) {
			if (self._isPresentInSbFilters(oFacetFilter.property)) {
				return;
			}
			if (oFacetFilter.preselectionDefaults || oFacetFilter.preselectionFunction) {
				var aValuesFromPreselectionDefaults = oFacetFilter.preselectionDefaults && oFacetFilter.preselectionDefaults.length && oFacetFilter.preselectionDefaults;
				var aValuesFromPreselectionFunction;
				if (!aValuesFromPreselectionDefaults) {
					aValuesFromPreselectionFunction = oFacetFilter.preselectionFunction && oFacetFilter.preselectionFunction.call();
				}
				var aValues = aValuesFromPreselectionDefaults || aValuesFromPreselectionFunction || [];
				aValues.forEach(function(value) {
					var filterObj = {
						NAME : oFacetFilter.property,
						OPERATOR : "EQ",
						VALUE_1 : value,
						VALUE_2 : null
					};
					aFacetFilters.push(filterObj);
				});
			}
		});
	};
	this._setConsolidatedFilters = function() {
		aConsolidatedFilters = [].concat(aSbFilters, aFacetFilters);
	};
	this._setContextFilterMap = function() {
		aConsolidatedFilters.forEach(function(oFilter) {
			if (!oContextFilterMap[oFilter.NAME]) {
				oContextFilterMap[oFilter.NAME] = [];
			}
			oContextFilterMap[oFilter.NAME].push({
				OPERATOR : oFilter.OPERATOR,
				VALUE_1 : oFilter.VALUE_1,
				VALUE_2 : oFilter.VALUE_2
			});
		});
		oContextFilterMap = d3.map(oContextFilterMap);
	};
	this._updatePathContextHandler = function() {
		oContextFilterMap.forEach(function(sFilterName, aExpressions) {
			var oFilter = oCoreApi.createFilter();
			var oFilterOr = oFilter.getTopAnd().addOr(sFilterName);
			aExpressions.forEach(function(oExpression) {
				var oFilterExpression = {
					name : sFilterName,
					operator : oExpression.OPERATOR,
					value : oExpression.VALUE_1
				};
				if (oExpression.OPERATOR === "BT") {
					oFilterExpression.high = oExpression.VALUE_2;
				}
				oFilterOr.addExpression(oFilterExpression);
			});
			oPathContextHandler.update(sFilterName, oFilter);
		});
		oPathContextHandler.saveInitialContext();
		oUiApi.contextChanged();
	};
	this._isPresentInSbFilters = function(sFilterName) {
		var aSbFilterNames = aSbFilters.map(function(oFilter) {
			return oFilter.NAME;
		});
		var index = aSbFilterNames.indexOf(sFilterName);
		return index !== -1;
	};
	this._drawFacetFilter = function(subHeaderInstance) {
		if (aFacetFiltersFromConfiguration && aFacetFiltersFromConfiguration.length) {
			oFacetFilterView = sap.ui.view({
				viewName : "sap.apf.ui.reuse.view.facetFilter",
				type : sap.ui.core.mvc.ViewType.JS,
				viewData : {
					oCoreApi : oCoreApi,
					oUiApi : oUiApi,
					oPathContextHandler : oPathContextHandler,
					aFacetFilterListData : aFacetFiltersFromConfiguration
				}
			});
			subHeaderInstance.addItem(oFacetFilterView);
		}
	};
	/**
	 * @private
	 * @experimental Refactoring trigerred by the Mozilla bug
	 * @name sap.apf.ui.utils.FacetFilterHandler#drawFacetFilter
	 * @param {Object} subHeaderInstance - Pass the sub header instance to add the facet filter view item
	 * @description draws facet filter on layout subHeader when smart business filters are resolved.
	 */
	this.drawFacetFilter = function(subHeaderInstance) {
		var self = this;
		if (aFacetFiltersFromConfiguration.length) {
			if (oSBHandler) {
				oSBFilterPromise.then(function() {
					self._drawFacetFilter(subHeaderInstance);
				});
			} else {
				self._drawFacetFilter(subHeaderInstance);
			}
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.utils.FacetFilterHandler#contextChanged
	 * @description Invokes contextChanged on facet filter view.
	 * */
	this.contextChanged = function() {
		if (oFacetFilterView) {
			oFacetFilterView.onContextChanged.call();
		}
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.utils.FacetFilterHandler#getFormattedFilters
	 * @param {string} sProperty - Property name of filter.
	 * @description Invokes getFormattedFilters on facet filter controller.
	 * @returns return content of facet filter controller getFormattedFilters. 
	 * */
	this.getFormattedFilters = function(sProperty) {
		if (oFacetFilterView) {
			return oFacetFilterView.getFormattedFilters(sProperty);
		}
	};
};

}; // end of sap/apf/ui/utils/facetFilterHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.helper') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.apf.ui.utils.helper');
sap.apf.ui.utils.Helper = function(oCoreApi) {
	"use strict";
	this.oCoreApi = oCoreApi;
	/**
	*@memberOf sap.apf.ui.utils.helper
	*@method getRepresentationSortInfo
	*@param {object} Representation
	*@description reads the orderBy field (array of values) from the parameters of representation.
	*                           
	*                            i.e "orderby": [{
	*                               property	:	OverdueDebitAmtInDisplayCrcy_E
	*                            ascending	:	false
	*                             }]
	*                             
	* Reads the label from dimensions/measures if the orderby property matches the consolidated list of dimension and measures of the representation
	* 
	* Otherwise reads the value from metaDataFacade for the orderby properties.
	* @return {string} comma separated value of all the orderBy properties as sort description
	*/
	this.getRepresentationSortInfo = function(oRepresentation) {
		var self = this;
		var aConsolidatedProperty = oRepresentation.parameter.dimensions.concat(oRepresentation.parameter.measures); //Consolidated array of dimension and measures
		var aSortField = oRepresentation.parameter.orderby; // orderby fields
		var aSortDescription = aSortField.map(function(oSortField) { //sort field descrptions for all the sort fields
			var sSortDescription;
			aConsolidatedProperty.forEach(function(oConsolidatedproperty) { //check if the property label exists in dimensions or measures
				if (oSortField.property === oConsolidatedproperty.fieldName && self.oCoreApi.getTextNotHtmlEncoded(oConsolidatedproperty.fieldDesc)) { //if label for property is available in dimension/measures
					sSortDescription = self.oCoreApi.getTextNotHtmlEncoded(oConsolidatedproperty.fieldDesc); //read sort description for properties from dimensions/measures
					return;
				}
			});
			if (!sSortDescription) { //read sort description for properties from metadata
				self.oCoreApi.getMetadataFacade().getProperty(oSortField.property, function(metadata) {
					if (metadata.label) { // metadata can have label or name
						sSortDescription = metadata.label ? metadata.label : (metadata.name ? metadata.name : "");
					}
				});
			}
			return sSortDescription;
		});
		return aSortDescription.join(","); //comma separated value of all the sort fields
	};
};
}; // end of sap/apf/ui/utils/helper.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.print') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.utils.print");
/** 
 *@class PrintHelper
 *@memberOf sap.apf.ui.utils
 *@description has functions to perform printing of Analysis Path
 *  
 */
sap.apf.ui.utils.PrintHelper = function(oInject) {
	"use strict";
	this.oCoreApi = oInject.oCoreApi;
	this.oUiApi = oInject.uiApi;
	this.oPathContextHandler = oInject.oPathContextHandler;
	/**
	 *@method printLayout defines layout used by each step when being printed
	 *@usage printLayout has to be used to get the layout for individual steps in analysis path.
	 *@param step = Used to get the step information
	 *@param index = index of the step being printed
	 *@param stepsLength = total number of steps in an Analysis Path
	 *@returns the oPrintLayout for a Step in an Analysis Path.
	 */
	this.printLayout = function(oStep, index, stepsLength) {
		var oMessageObject;
		var date = new Date();
		var appName = this.oCoreApi.getApplicationConfigProperties().appName;
		if (!appName) {
			oMessageObject = this.oCoreApi.createMessageObject({
				code : "6003",
				aParameters : [ "appName" ]
			});
			this.oCoreApi.putMessage(oMessageObject);
		}
		var analysisPathTitle = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		var header = new sap.ui.core.HTML({
			content : [ '<div class="subHeaderPrintWrapper"><p class="printHeaderTitle"> ' + this.oCoreApi.getTextHtmlEncoded(appName) + ' : ' + jQuery.sap.encodeHTML(analysisPathTitle) + '</p>',
					'<p class="printHeaderDate"> ' + date.toTimeString() + ' </p></div><div class="clear"></div>', '<div class="printChipName"><p>' + this.oCoreApi.getTextHtmlEncoded("print-step-number", [ index, stepsLength ]) + '</p></div>' ]
					.join("")
		});
		var chartLayout = new sap.ui.layout.VerticalLayout();
		var oStepTitle = this.oCoreApi.getTextNotHtmlEncoded(oStep.title);
		var selectedRepresentation = oStep.getSelectedRepresentation();
		var stepRepresentation = selectedRepresentation.bIsAlternateView ? selectedRepresentation.toggleInstance : selectedRepresentation;
		if (selectedRepresentation.bIsAlternateView) {
			var data = oStep.getSelectedRepresentation().getData();
			var metadata = oStep.getSelectedRepresentation().getMetaData();
			stepRepresentation.setData(data, metadata);
		}
		var representation = {};
		if (stepRepresentation.type === "TableRepresentation") {
			representation = stepRepresentation.getPrintContent(oStepTitle);
			representation.setWidth("1000px");
		} else {
			representation = stepRepresentation.getPrintContent(oStepTitle);
		}
		//Show/Hide Legend for print content
		if (stepRepresentation.bIsLegendVisible === false) {
			if (representation.setLegend !== undefined) {
				representation.setLegend(new sap.viz.ui5.types.legend.Common({
					visible : false
				}));
			}
			if (representation.setSizeLegend !== undefined) {
				representation.setSizeLegend(new sap.viz.ui5.types.legend.Common({
					visible : false
				}));
			}
		} else {
			if (representation.setLegend !== undefined) {
				representation.setLegend(new sap.viz.ui5.types.legend.Common({
					visible : true
				}));
			}
			if (representation.setSizeLegend !== undefined) {
				representation.setSizeLegend(new sap.viz.ui5.types.legend.Common({
					visible : true
				}));
			}
		}
		chartLayout.addContent(representation);
		var oPrintLayout = new sap.ui.layout.VerticalLayout({
			content : [ header, chartLayout ]
		}).addStyleClass("representationContent"); // @comment : apfPrintLayout class not provided in css
		return oPrintLayout;
	};
	/**
	 *@method Format the values with respect to data type
	 *@usage format the values 
	 */
	this.formatter = function(metadata, value) {
		/**
		 * @memberOf sap.apf.ui.utils.PrintHelper
		 * @method doYearMonthFormat
		 * @param fieldValue
		 * @description yearMonth formatting 
		 */
		var doYearMonthFormat = function(fieldValue) {
			var jan = this.oCoreApi.getTextNotHtmlEncoded("month-1-shortName");
			var feb = this.oCoreApi.getTextNotHtmlEncoded("month-2-shortName");
			var mar = this.oCoreApi.getTextNotHtmlEncoded("month-3-shortName");
			var apr = this.oCoreApi.getTextNotHtmlEncoded("month-4-shortName");
			var may = this.oCoreApi.getTextNotHtmlEncoded("month-5-shortName");
			var jun = this.oCoreApi.getTextNotHtmlEncoded("month-6-shortName");
			var jul = this.oCoreApi.getTextNotHtmlEncoded("month-7-shortName");
			var aug = this.oCoreApi.getTextNotHtmlEncoded("month-8-shortName");
			var sep = this.oCoreApi.getTextNotHtmlEncoded("month-9-shortName");
			var oct = this.oCoreApi.getTextNotHtmlEncoded("month-10-shortName");
			var nov = this.oCoreApi.getTextNotHtmlEncoded("month-11-shortName");
			var dec = this.oCoreApi.getTextNotHtmlEncoded("month-12-shortName");
			var monthsArray = [ jan, feb, mar, apr, may, jun, jul, aug, sep, oct, nov, dec ];
			var year = fieldValue.substr(0, 4);
			var month = monthsArray[fieldValue.substr(4, 6) - 1];
			return month + " " + year;
		};
		var formattedFieldValue, yearMetadata, quarterMetadata, dateFromMetadata, yearInfoFromDate, weekMetadata, dateFormat;
		if (metadata.getAttribute("isCalendarYearMonth")) { //calenderYearMonth
			if (originalFieldValue === null) {
				return "";
			}
			formattedFieldValue = doYearMonthFormat(value);
		} else if (metadata.type === "Edm.DateTime") { //dateTime
			if (value === null) {
				return "-";
			}
			dateFormat = new Date(parseInt(value.slice(6, value.length - 2), 10));
			dateFormat = dateFormat.toLocaleDateString();
			if (dateFormat === "Invalid Date") {
				return "-";
			}
			formattedFieldValue = dateFormat;
		} else if (metadata.getAttribute("isCalendarDate")) {
			if (value === null) {
				return "-";
			}
			yearMetadata = value.substr(0, 4);
			var monthMetadata = (parseInt((value.substr(4, 2)),10)-1).toString();
			var dateMetadata = value.substr(6, 2);
			dateFormat = new Date(yearMetadata, monthMetadata, dateMetadata);
			dateFormat = dateFormat.toLocaleDateString();
			if (dateFormat === "Invalid Date") {
				return "-";
			}
			formattedFieldValue = dateFormat;
		} else if (metadata.getAttribute("isCalendarYearQuarter")) {
			if (value === null) {
				return "";
			}
			yearMetadata = value.substr(0, 4);
			quarterMetadata = value.substr(4, 1);
			dateFromMetadata = new Date(yearMetadata);
			yearInfoFromDate = dateFromMetadata.getFullYear();
			var quarterInfo;
			quarterInfo = "Q" + quarterMetadata;
			var formattedYearQuarter = quarterInfo + " " + yearInfoFromDate;
			formattedFieldValue = formattedYearQuarter;
		} else if (metadata.getAttribute("isCalendarYearWeek")) {
			if (value === null) {
				return "";
			}
			yearMetadata = value.substr(0, 4);
			weekMetadata = value.substr(4, 2);
			dateFromMetadata = new Date(yearMetadata);
			yearInfoFromDate = dateFromMetadata.getFullYear();
			var weekInfo;
			weekInfo = "CW" + weekMetadata;
			var formattedYearWeek = weekInfo + " " + yearInfoFromDate;
			formattedFieldValue = formattedYearWeek;
		} else { //default value
			if (value === null) {
				return "null";
			}
			formattedFieldValue = value;
		}
		// application formatter callback
		var callback = this.oUiApi.getEventCallback(sap.apf.core.constants.eventTypes.format);
		if (typeof callback === "function") {
			var appFormattedFieldValue = callback.apply(this.oUiApi, [ metadata, metadata.name, value, formattedFieldValue ]);
			if (appFormattedFieldValue !== undefined) {
				formattedFieldValue = appFormattedFieldValue;
			}
			if (appFormattedFieldValue === null) {
				formattedFieldValue = "";
			}
		}
		return formattedFieldValue;
	};
	/**
	 *@method Print used to print all the steps in Analysis Path.
	 *@usage PrintHelper().doPrint has to be used for printing Analysis Path
	 */
	this.doPrint = function() {
		this.oUiApi.createApplicationLayout(false).setBusy(true);//sets the Local Busy Indicator for the print
		var allSteps = this.oCoreApi.getSteps();
		var stepLayout = new sap.ui.layout.VerticalLayout();
		var domContent = "";
		var pTimer = 2000;
		var that = this;
		var date = new Date();
		var appName = this.oCoreApi.getApplicationConfigProperties().appName;
		var analysisPathTitle = this.oUiApi.getAnalysisPath().oSavedPathName.getTitle();
		jQuery('#apfPrintArea').remove(); // removing the div which holds the printable content
		jQuery("body").append('<div id="apfPrintArea"></div>'); //div which holds the printable content
		//Facet Filter Printing as the initial page 
		//Print the filter expression provided by getContext() API 
		var facetFilterExpr;
		var callback = this.oUiApi.getEventCallback(sap.apf.core.constants.eventTypes.printTriggered);
		var getAllIds = this.oPathContextHandler ? this.oPathContextHandler.getAllIds() : [];
		var filterExpr = [];
		//Check if pathContextHandler returns values else fallback to getContext API
		if (getAllIds.length > 0) {
			for( var i = 0; i < getAllIds.length; i++) {
				var aFilter = [ this.oUiApi.getFormattedFilters(getAllIds[i]) ]; // TODO Refactor the code to avoid unnecessary wrapping into array.
				if (!aFilter[0]) {
					aFilter = this.oPathContextHandler.get(getAllIds[i]).getExpressions();
				}
				filterExpr.push(aFilter[0]);
			}
		} else {
			filterExpr = this.oCoreApi.getContext().getExpressions();
		}
		//Formatted Filter Values from APF
		var formattedFilters = function(context) {
			var filterValues = [];
			var filterArr = [];
			for( var i = 0; i < filterExpr.length; i++) {
				for( var j = 0; j < filterExpr[i].length; j++) {
					var filterObj = filterExpr[i][j];
					if (!filterObj.formatted) {
						var filterName = "";
						var filterVal = "";
						context.oCoreApi.getMetadataFacade().getProperty(filterExpr[i][j].name, function(o) {
							filterName = o.label;
							filterVal = context.formatter(o, filterExpr[i][j].value);
						});
						filterObj["name"] = filterName;
						filterObj["value"] = filterVal;
					}
					filterValues.push(filterObj);
				}
				filterArr.push(filterValues);
				filterValues = [];
			}
			return filterArr;
		};
		var callbackContext = {
			getTextNotHtmlEncoded : that.oCoreApi.getTextNotHtmlEncoded
		};
		if (callback !== undefined) {
			var facetFilterArr = callback.apply(callbackContext, [ filterExpr ]) || [];
			facetFilterExpr = (facetFilterArr.length > 0) ? facetFilterArr : formattedFilters(this);
		} else {
			facetFilterExpr = formattedFilters(this);
		}
		var header = new sap.ui.core.HTML({
			content : [ '<div class="subHeaderPrintWrapper"><p class="printHeaderTitle"> ' + this.oCoreApi.getTextHtmlEncoded(appName) + ' : ' + jQuery.sap.encodeHTML(analysisPathTitle) + '</p>',
					'<p class="printHeaderDate"> ' + date.toTimeString() + ' </p></div><div class="clear"></div>' ].join("")
		});
		var facetLayout = new sap.ui.layout.VerticalLayout();
		var filterValue = "";
		var filterName = "";
		var i, j;
		//Formatting the facet filter array
		for(i = 0; i < facetFilterExpr.length; i++) {
			for(j = 0; j < facetFilterExpr[i].length; j++) {
				filterName = facetFilterExpr[i][j].name;
				if (j !== facetFilterExpr[i].length - 1) {
					filterValue += facetFilterExpr[i][j].value + ", ";
				} else {
					filterValue += facetFilterExpr[i][j].value;
				}
			}
			var mFilterName = new sap.m.Text({
				text : filterName
			}).addStyleClass("printFilterName");
			var mFilterValue = new sap.m.Text({
				text : filterValue
			}).addStyleClass("printFilterValue");
			facetLayout.addContent(mFilterName);
			facetLayout.addContent(mFilterValue);
			//Reset the filter value
			filterValue = "";
		}
		//Facet UI Layout
		var oPrintFacetLayout = new sap.ui.layout.VerticalLayout({
			content : [ header, facetLayout ]
		}).addStyleClass("representationContent");
		stepLayout.addContent(oPrintFacetLayout);
		var k;
		for(k = 0; k < allSteps.length; k++) {
			var index = parseInt(k, 10) + 1;
			stepLayout.addContent(this.printLayout(allSteps[k], index, allSteps.length));
		}
		stepLayout.placeAt("apfPrintArea");
		if (jQuery(".v-geo-container").length) {//set the timer if geomap exists
			pTimer = 4000;
		}
		window.setTimeout(function() {
			that.oUiApi.createApplicationLayout(false).setBusy(false); //Removes the Local Busy Indicator after the print
		}, pTimer - 150);
		window.setTimeout(function() { //Set Timeout to load the content on to dom
			jQuery("#" + stepLayout.sId + " > div").after("<div class='page-break'> </div>");
			domContent = stepLayout.getDomRef(); // Get the DOM Reference
			var table = jQuery('#apfPrintArea .sapUiTable');
			if (table.length) {
				var colCount = jQuery('#apfPrintArea .printTable .sapMListTblHeader .sapMListTblCell').length;
				if (colCount > 11) {
					jQuery("#setPrintMode").remove();
					jQuery("<style id='setPrintMode' > @media print and (min-resolution: 300dpi) { @page {size : landscape;}}</style>").appendTo("head");
				} else {
					jQuery("#setPrintMode").remove();
					jQuery("<style id='setPrintMode'>@media print and (min-resolution: 300dpi) { @page {size : portrait;}}</style>").appendTo("head");
				}
			}
			jQuery("#apfPrintArea").empty(); //Clear the apfPrintArea
			jQuery("#sap-ui-static > div").hide(); // Hide popup
			jQuery("#apfPrintArea").append(jQuery(domContent).html()); //Push it to apfPrintArea
			var i;
			for(i = 0; i < jQuery("#apfPrintArea").siblings().length; i++) {
				//TODO alternate way of hiding the content and printing only the representations?????     
				jQuery("#apfPrintArea").siblings()[i].hidden = true; // hiding the content apart from apfPrintArea div
			}
			window.print(); //print the content
			//Workaround to get the width of the column cell
			window.setTimeout(function() {
				for(i = 0; i < jQuery("#apfPrintArea").siblings().length; i++) {
					jQuery("#apfPrintArea").siblings()[i].hidden = false;
				}
				stepLayout.destroy(); //Destroy the reference & remove from dom
			}, 10);
		}, pTimer);
	};
};
}; // end of sap/apf/ui/utils/print.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.promiseBasedCreateReadRequest') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.ui.utils.promiseBasedCreateReadRequest');
/**
 * @private
 * @experimental The complete class interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
 * @class Promise Based CreateReadRequest
 * @description Wraps sap.apf.core.CreateReadRequest inside a jquery promise and provides the interface.
 * @param {sap.apf.core.instance} oCoreApi - oCore Api
 * @param {string} sRequestId - Request Id
 * @param {sap.apf.core.Filter} oFilter - Filter Object
 * @name sap.apf.ui.utils.PromiseBasedCreateReadRequest
 * @returns {jQuery.Deferred.promise} which will be resolved with an object :
 *	{
 *  	aData: []  - oData Response
 *		oMetadata: sap.apf.core.EntityTypeMetadata Instance.
 *	}
 */
sap.apf.ui.utils.PromiseBasedCreateReadRequest = function (oCoreApi, sRequestId, oFilter) {
    var oDeferred = new jQuery.Deferred();
    var oReadRequest = oCoreApi.createReadRequestByRequiredFilter(sRequestId);
    var fnCallback = function (aData, oMetadata) {
        var oArg = {
            aData: aData,
            oMetadata: oMetadata
        };
        if (aData && oMetadata) {
            oDeferred.resolveWith(this, [oArg]);
        } else {
            oDeferred.rejectWith(this, [oArg]);
        }
    };
    if (!oFilter) {
        oFilter = oCoreApi.createFilter();
    }
    oReadRequest.send(oFilter, fnCallback);
    return oDeferred.promise();
};

}; // end of sap/apf/ui/utils/promiseBasedCreateReadRequest.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.hashtable') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, utild, jQuery*/


jQuery.sap.declare('sap.apf.utils.hashtable');

(function () {
    'use strict';
    /**
     * @name sap.apf.utils.Hashtable
     * @class hash table
     * @description Stores and returns objects under unique key. Keys are provided by the caller, not generated.
     * @param {sap.apf.core.MessageHandler} oMessageHandler - A handler for error messages.
     */
    sap.apf.utils.Hashtable = function (oMessageHandler) {
        var nNumberOfItems = 0;
        var oItemHolder = {};
        var orderList = []; // ordered by arrival (create)

        /**
         * @description type information
         */
        this.type = "hashTable";

        /**
         * @description Add or update an object to the hash table with key and value.
         * @param {string} key - Unique key.
         *      WHEN the key is new to the hashtable THEN a new entry is created and undefined returned.
         *      Otherwise WHEN the key already exists THEN the associated value is updated and the previous value returned.
         *      WHEN the key equals to undefined or null THEN an error message is put and undefined returned.
         * @param {*} value - Item, can be anything like javascript object, string, function or number
         * @returns {*|undefined} Previous object or undefined.
         */
        this.setItem = function (key, value) {
            var oPreviousValue;
            oMessageHandler.check((key !== undefined && key !== null), "sap.apf.utils.HashTable.setItem: key undefined");
            oMessageHandler.check((value !== undefined && value !== null), "sap.apf.utils.HashTable.setItem: value undefined");
            if (this.hasItem(key)) {
                oPreviousValue = oItemHolder[key];
            } else {
                nNumberOfItems++;
                orderList.push(key);
            }
            oItemHolder[key] = value;
            return oPreviousValue;
        };

        /**
         * @descriptions Returns the number of items in the hash table
         * @returns {number} Number of items in hash table
         */
        this.getNumberOfItems = function () {
            return nNumberOfItems;
        };

        /**
         * @description Get the value by the key.
         * @param {string} key
         * @returns {*|undefined} Hashed item or undefined
         */
        this.getItem = function (key) {
            oMessageHandler.check((key !== undefined && key !== null), "sap.apf.utils.HashTable.getItem key undefined");
            return this.hasItem(key) ? oItemHolder[key] : undefined;
        };

        /**
         * @description Tests whether an item with key exists in the hash table.
         * @param {*} key - WHEN undefined or null THEN put error message.
         * @returns {boolean} True if key exists, false otherwise.
         */
        this.hasItem = function (key) {
            oMessageHandler.check((key !== undefined && key !== null), "sap.apf.utils.HashTable.hasItem key undefined");
            return oItemHolder.hasOwnProperty(key);
        };

        /**
         * @description Removes a key and its associated item from the hash table.
         * @param {*} key - WHEN undefined or null THEN put error message.
         * @returns {*|undefined} Removed item or undefined when ke was not existing.
         */
        this.removeItem = function (key) {
            oMessageHandler.check((key !== undefined && key !== null), "sap.apf.utils.HashTable.removeItem key undefined");
            var oItemRemoved;
            if (this.hasItem(key)) {
                oItemRemoved = oItemHolder[key];
                nNumberOfItems--;
                orderList.splice(orderList.indexOf(key), 1);
                delete oItemHolder[key];
                return oItemRemoved;
            }
            return undefined;
        };

        /**
         * @description Returns all keys of the hash table.
         * @returns {object[]} Array with keys.
         */
        this.getKeys = function () {
            var aKeys = [];
            var k;
            //noinspection JSLint
            for (k in oItemHolder) {
                //noinspection JSUnfilteredForInLoop
                if (this.hasItem(k)) {
                    //noinspection JSUnfilteredForInLoop
                    aKeys.push(k);
                }
            }
            return aKeys;
        };

        /**
         * @description Applies a function on each item in the hash table.
         * @param {function} fn - A function to be applied with k and item as parameters.
         * @param {string} fn.key - The key.
         * @param {*} fn.item - The item associated to that key.
         */
        this.each = function (fn) {
            var k;
            //noinspection JSLint
            for (k in oItemHolder) {
                //noinspection JSUnfilteredForInLoop
                if (this.hasItem(k)) {
                    //noinspection JSUnfilteredForInLoop
                    fn(k, oItemHolder[k]);
                }
            }
        };

        /**
         * @description Applies a function on each item in the hash table.
         *      It applies the function corresponding to the associated ordering of all items in the hash table.
         *      The ordering is determined by the order of creation by setItem() and by methods that change the ordering.
         * @param {Function} fn
         * @param {string} fn.key - The key.
         * @param {*} fn.item - The item associated to that key.
         */
        this.forEachOrdered = function (fn) {
            var that = this;
            orderList.forEach(function (key) {
                if (!that.hasItem(key)) {
                    oMessageHandler.check(false, "sap.apf.utils.HashTable.forEachOrdered: key not contained");
                } else {
                    fn(key, oItemHolder[key]);
                }
            });
        };

        /**
         * @description Return an ordered array of keys. The order is determined by the order of creation and order changing methods.
         * @returns {String[]} - An array of keys.
         */
        this.getKeysOrdered = function() {
            var list = [];
            this.forEachOrdered(function(key) {
               list.push(key);
            });
            return list;
        };

        /**
         * Move the item with key movedKey up or down in the order by distance. If distance is negative, then move it up distance places
         * in the order. If distance is positive, then move it down by distance in the order. The maximum move is to the array boundaries!
         * @param {object} movedKey key to move
         * @param {number} distance
         * @returns {number|null} when movedKey is not contained then return null. Otherwise the position, where it has been moved to.
         * 
         */
        this.moveUpOrDown = function(movedKey, distance) {
        	   oMessageHandler.check((movedKey !== undefined && movedKey !== null), "sap.apf.utils.HashTable.moveItemUpOrDown movedKey undefined");
        	   var index = orderList.indexOf(movedKey);
        	   
        	   var newPosition = index + distance;
        	   
        	   if (index < 0) {
        		   return null;
        	   }
        	   if (distance < 0) {
        		   orderList.splice( index, 1); //remove
        		   
        		   if (newPosition < 0) {
        			   orderList.splice(0, 0, movedKey); 
        			   return 0;
        		   } else {
        			   orderList.splice(index + distance, 0, movedKey); 
        			   return index + distance;
        		   }		   
        	   } else if (distance === 0) {
        		   return index;
        	   } else if (distance > 0) {
        		   orderList.splice( index, 1); //remove
        		   if (newPosition >=  orderList.length) {
        			   orderList.splice(orderList.length, 0, movedKey); 
        			   return orderList.length;
        		   } else {
        			   orderList.splice(newPosition, 0, movedKey);
        			   return newPosition;
        		   }
        	   }
        };
        /**
         * Change the ordering by moving one key in the ordering before another key.
         * @param beforeKey
         * @param movedKey
         * @returns {number|null} WHEN either key is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of moveKey, after the move.
         */
        this.moveBefore = function (beforeKey, movedKey) {
            if ( orderList.indexOf(beforeKey) <0 || orderList.indexOf(movedKey) <0) {
                return null;
            }
            if ( beforeKey === movedKey ) {
                return orderList.indexOf(movedKey);
            }
            orderList.splice( orderList.indexOf(movedKey), 1); // remove
            orderList.splice(orderList.indexOf(beforeKey), 0, movedKey); // insert
            return orderList.indexOf(movedKey);
        };

        /**
         * Change the ordering by moving one key in the ordering to the end.
         * @param beforeKey
         * @returns {number|null} WHEN the key is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of moveKey, after the move.
         */
        this.moveToEnd = function (movedKey) {
            if ( orderList.indexOf(movedKey) <0 ) {
                return null;
            }
            orderList.splice( orderList.indexOf(movedKey), 1); // remove
            orderList.push(movedKey); // insert
            return orderList.indexOf(movedKey);
        };

        /**
         * @description Deletes all key/value pairs of the hash table.
         */
        this.reset = function () {
            oItemHolder = {};
            orderList = [];
            nNumberOfItems = 0;
        };
    };
}());

}; // end of sap/apf/utils/hashtable.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.navContainer') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

(function () {
	'use strict';

	jQuery.sap.declare('sap.apf.utils.navContainer');
	
	sap.apf.utils.navContainer = sap.apf.utils.navContainer || {};
	
    /**
     * @private
     * @function
     * @name sap.apf.utils.navContainer#pushContent
     * @description Pushes content to the ushell container.
     * @param {(string|object|string[]|object[])} content Content which shall be pushed to the ushell container.
     * @param {sap.apf.core.MessageHandler} messageHandler Instance of the MessageHandler.
     
     * @param {function(containerId, messageObject)} callback Callback returns after content has been pushed to the ushell container.
     * @param {string} callback.containerId ID of the filled container
     * @param {sap.apf.core.MessageObject} callback.messageObject Identifier of corrupt process flow
     */
	sap.apf.utils.navContainer.pushContent = function(content, containerName, messageHandler, callback) {
		if(ushellContainerExists()) {
			var contentId = jQuery.sap.uid();
			sap.ushell.Container.getService("Personalization").getContainer(containerName, { validity : 0})
			.done(function(container) {
				container.setItemValue(contentId, content);
				container.save();
				callback(contentId, null);
			})
			.fail(function() {
				putMessage("5039", messageHandler, callback);
			});
		} else {
			putMessage("5038", messageHandler, callback);
		}
	};
	
    /**
     * @private
     * @function
     * @name sap.apf.utils.navContainer#fetchContent
     * @description Fetches content from the ushell container.
     * @param {string} containerId Container id of the desired ushell container.
     * @param {sap.apf.core.MessageHandler} messageHandler Instance of the MessageHandler.
     
     * @param {function(content, messageObject)} callback Callback returns after content has been pushed to the ushell container.
     * @param {(string|object|string[]|object[])} callback.content content Content which has been stored to the ushell container.
     * @param {sap.apf.core.MessageObject} callback.messageObject Identifier of corrupt process flow
     */
	sap.apf.utils.navContainer.fetchContent = function(contentId, containerName, messageHandler, callback) {
		if(ushellContainerExists()) {
			sap.ushell.Container.getService("Personalization").getContainer(containerName)
			.done(function(container) {
				var content = container.getItemValue(contentId);
				if(content) {
					callback(content, null);
				} else {
					putMessage("5040", messageHandler, callback);
				}
			})
			.fail(function() {
				putMessage("5040", messageHandler, callback);
			});
		} else {
			putMessage("5038", messageHandler, callback);
		}
	};
	
	function ushellContainerExists() {
		if(sap.ushell && sap.ushell.Container && sap.ushell.Container.getService) {
			return true;
		} else {
			return false;
		}
	}
	function putMessage(messageCode, messageHandler, callback) {
		var messageObject = messageHandler.createMessageObject({
			code : messageCode
		});
		messageHandler.putMessage(messageObject);
		callback(null, messageObject);
	}
}());

}; // end of sap/apf/utils/navContainer.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.navigationHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

(function() {
	'use strict';

	jQuery.sap.declare("sap.apf.utils.navigationHandler");
	
	jQuery.sap.require('sap.ui.core.routing.HashChanger'); // unlisted dependency retained
 //FIXME Necessary due to lazy loading bug in UI5 library.js in 1.28.0. Can be deleted after 1.28.1 fix is tested
	
	/**
	 * @class This class manages the navigation to a target and the navigation from another target into this class;
	 * @param {sap.apf.core.MessageHandler} oInject.instances.messageHandler
	 * @param {function} oInject.functions.getCumulativeFilterUpToActiveStep 
	 */
	sap.apf.utils.NavigationHandler = function(oInject) {

		var navTargets, navTargetsWithText;
		var messageHandler = oInject.instances.messageHandler;

		/**
		 * returns the filter from a selection variant in callback
		 * @param {string} selectionVariantId id of the selection variant
		 * @param {function} callback with parameters {sap.apf.utils.Filter} and {sap.apf.core.MessageObject}. The message object is undefined, if no errors occurred
		 */
		this.getFilterFromSelectionVariant = function(selectionVariantId, callback) {
			
			function extractFilterAndReturn(selectionVariant, messageObject) {
				var filter;
				if (messageObject) {
					callback(undefined, messageObject);
				} else {
					filter = sap.apf.utils.Filter.createFilterFromSapUi5FilterJSON(messageHandler, selectionVariant.Filter);
					callback(filter);
				}
			}
			sap.apf.utils.navContainer.fetchContent(selectionVariantId, 'sap.apf.selectionVariant', messageHandler, extractFilterAndReturn);
		};
		/**
		 * returns all possible navigation targets
		 * @returns [object] array of navigation targets with properties id, semanticObject, action. The id is
		 * used in the navigateToApp function
		 */
		this.getNavigationTargets = function() {
			if (!navTargets) {
				initNavigationTargets();
			}
			return jQuery.extend(true, [], navTargets);
		};

		/**
		 * returns all possible navigation targets with text (from intent
		 * @returns promise with [object] array of navigation targets with properties id, semanticObject, action and text. The id is
		 * used in the navigateToApp function
		 */
		this.getNavigationTargetsWithText = function() {
			var deferred;
			var navigationService = sap.ushell && sap.ushell.Container && sap.ushell.Container.getService("CrossApplicationNavigation");
    		var semanticObjects = [];
    		
			function addText(semanticObject, action, text ) {
				navTargetsWithText.forEach(function(navTarget) {
					if (semanticObject === navTarget.semanticObject && action === navTarget.action) {
						navTarget.text = text;
					}
				});
			}
			
		    function collectIntentTexts(semanticObjectCounter) {
		    	 var deferred = jQuery.Deferred();
		    	
		    	 var finalNavTargets = [];
		    	 if (semanticObjectCounter === semanticObjects.length) {
		    		 deferred = jQuery.Deferred();
		    		 navTargetsWithText.forEach(function(navTargetWithText) {
		    			 if (navTargetWithText.text !== "") {
		    				 finalNavTargets.push(navTargetWithText);
		    			 }
		    		 })
		    		 navTargetsWithText = finalNavTargets;
		    		 deferred.resolve(navTargetsWithText);
		    		 return deferred.promise();
		    	 } 
		    	 var semanticObject = semanticObjects[semanticObjectCounter];
		    	 
		    	 navigationService.getSemanticObjectLinks(semanticObject, undefined, false, oInject.instances.component, undefined)
	     		 	.done(	function(aIntents) { 
	     		 		aIntents.forEach(function(intentDefinition){
	     		 					var actionWithParameters = intentDefinition.intent.split("-");
	     		 					var action = actionWithParameters[1].split("?");
	     		 					action = action[0].split("~");
	     		 					addText(semanticObject, action[0], intentDefinition.text);
	     		 					
	     		 				});
	     		 		collectIntentTexts(semanticObjectCounter + 1).done(function() {
	     		 			deferred.resolve(navTargetsWithText);
	     		 		});
	     		 	}).fail(function() { 
	     		 		return collectIntentTexts(semanticObjectCounter + 1);
	     		 	});
		    	 
		    	 return deferred.promise();
		     }
			
			
		    if (navTargetsWithText) {
				deferred = jQuery.Deferred();
				deferred.resolve(navTargetsWithText);
				return deferred.promise();
			}
		    
			if (!navTargets) {
				initNavigationTargets();
			}

			navTargetsWithText = jQuery.extend(true, [], navTargets);
			
			//set default
			navTargetsWithText.forEach(function(navTarget) {
					navTarget.text = "";
			});
			 
			navTargets.forEach(function(navTarget) {
			   if ($.inArray(navTarget.semanticObject, semanticObjects) === -1) {
				   semanticObjects.push(navTarget.semanticObject);
				}
			});
					   
			deferred = jQuery.Deferred();
			collectIntentTexts(0).done(function() {
				deferred.resolve(navTargetsWithText);
			}).fail(function() {
				deferred.resolve(navTargetsWithText);
			});
			
			return deferred.promise();
			
		};
		/**
		 * receives an id of a navigation target and starts the navigation
		 * @param {string} navigationId navigation target id
		 * @returns undefined
		 */
		this.navigateToApp = function(navigationId) {
			
			if (!navTargets) {
				initNavigationTargets();
			}
			var i;
			var len = navTargets.length;
			var selectionVariant, parameters, appState, serializableState;
			var hashChanger = sap.ui.core.routing.HashChanger && sap.ui.core.routing.HashChanger.getInstance();

			serializableState = {
			        sapApfState : oInject.functions.serializePath()
			};
			serializableState.sapApfState.pathContextHandler = oInject.functions.serializeContext();
			serializableState.sapApfCumulativeFilter = oInject.functions.getCumulativeFilterUpToActiveStep().mapToSapUI5FilterExpression();

			for(i = 0; i < len; i++) {
				if (navTargets[i].id === navigationId) {

					selectionVariant = buildSelectionVariant(navigationId);
					sap.apf.utils.navContainer.pushContent(JSON.stringify(selectionVariant), 'sap.apf.selectionVariant', messageHandler, function(containerId, messageObject) {

						if (messageObject) {
							messageHandler.putMessage(messageObject);
						} else {
							jQuery.sap.log.info("navigation with containerId " + containerId);
						}

						var oCrossAppNavigator = sap.ushell && sap.ushell.Container && sap.ushell.Container.getService("CrossApplicationNavigation");
						
						if (oCrossAppNavigator) {
							parameters = {
									'sap-apf-selection-variant-id' : containerId
							};
		                    
				            appState = oCrossAppNavigator.createEmptyAppState(oInject.instances.component);
				            appState.setData(serializableState);
				            appState.save();
							if(hashChanger) {
							    hashChanger.replaceHash("sap-iapp-state=" + appState.getKey());
							}
							
							oCrossAppNavigator.toExternal({
								target : {
									semanticObject : navTargets[i].semanticObject,
									action : navTargets[i].action
								},
								params : parameters,
								appStateKey : appState.getKey()
							});
						}

					});
					return;
				}
			}
		};
        this.checkMode = function() {
        	var deferred = jQuery.Deferred();
        	
        	var hashChanger = sap.ui.core.routing.HashChanger && sap.ui.core.routing.HashChanger.getInstance && sap.ui.core.routing.HashChanger.getInstance();
        	var iappStateKeyMatcher = /(?:sap-iapp-state=)([^&=]+)/;
        	var xappStateKeyMatcher = /(?:sap-xapp-state=)([^&=]+)/;
        	var innerAppStateKey, crossAppStateKey, iappMatch, xappMatch, containerData;
        	
        	if(hashChanger){
        		iappMatch = iappStateKeyMatcher.exec(hashChanger.getHash());
        		if(iappMatch){
        			innerAppStateKey = iappMatch[1];
        		}
        	}
        	//TODO: Find proper way to read hash for xapp state, UI5 HashChanger cannot be used. 
        	xappMatch = xappStateKeyMatcher.exec(window.location.hash);
    		if(xappMatch){
    			crossAppStateKey = xappMatch[1];
    		}
        	
        	if(innerAppStateKey){
	        	sap.ushell.Container.getService("CrossApplicationNavigation").getAppState(oInject.instances.component, innerAppStateKey).done(function (appContainer) {
        			containerData = appContainer.getData();
	        		if(containerData.sapApfState){
	        			oInject.functions.deserializeContext(containerData.sapApfState.pathContextHandler);
	        			oInject.functions.deserializePath(containerData.sapApfState);
	        			deferred.resolve({navigationMode : "backward"});
	        		}
	            });
        	}else if(crossAppStateKey){
        		sap.ushell.Container.getService("CrossApplicationNavigation").getAppState(oInject.instances.component, crossAppStateKey).done(function (appContainer) {
        			containerData = appContainer.getData();
	        		if(containerData && containerData.sapApfCumulativeFilter){
	        			deferred.resolve({navigationMode : "forward", sapApfCumulativeFilter : containerData.sapApfCumulativeFilter});
	        		}else{
	        			deferred.resolve({navigationMode : "forward"});
	        		}
	            });
        	}else{
        		deferred.resolve({navigationMode : "forward"});
        	}
        	return deferred.promise();
        };
		// proper format see \\dwdf213\CFP\70_FND\20_Product_Teams\10_Analytics\New Analytics\Architecture\AnalysisPathFramework\APF-Cloud
		function buildSelectionVariant(selectionVariantId) {
			var date = new Date();
			var filter = oInject.functions.getCumulativeFilterUpToActiveStep();
			var filterExpr = filter.mapToSapUI5FilterExpression();
			return {
				"SelectionVariantID" : selectionVariantId,
				"Text" : "Temporary Selection Variant Producer = APF, " + date.toUTCString(),
				"Filter" : filterExpr
			};
		}
		function initNavigationTargets() {
			navTargets = oInject.functions.getNavigationTargets();
		}

	};

}());

}; // end of sap/apf/utils/navigationHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.pathContextHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare('sap.apf.utils.pathContextHandler');


/**
 * @private
 * @class Path context handler
 * @description Provides methods that allow to manage the context that is used
 *              for each path update. The context consists of logical filter
 *              expressions that need to be applied for all OData server
 *              requests during update of an analysis path. Methods of this
 *              class allow partial updates of the overall context by components
 *              being responsible for partial concerns of the overall context.
 * @param {Object} functions Object containing functions to be used by path context
 *            handler.
 * @param {sap.apf.core.MessageHandler} msgHandler Message handler instance.
 * @name sap.apf.utils.PathContextHandler
 * @returns {sap.apf.utils.PathContextHandler}
 */
sap.apf.utils.PathContextHandler = function(functions, msgHandler) {
	var uniqueConsumerId = 1;
	var contextFragments = {};
    var initialContext;
	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#add
	 * @description Adds a context fragment for a path context. Creates a unique
	 *              fragment and a corresponding identifier. Subsequent changes
	 *              need to be done by the update method providing the
	 *              identifier.
	 * @param {sap.apf.utils.Filter} filter
	 *            filter Requires a filter instance
	 * @returns {number} Unique numeric ID to be provided for later updates of the same
	 *          fragment. Consecutive numbers for the different unique IDs are not guaranteed.
	 */
	this.add = function(filter) {
		contextFragments[uniqueConsumerId] = filter;
		functions.setContext(combineFragments());
		return uniqueConsumerId++;
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#update
	 * @description Updates a context fragment for the given identifier by fully
	 *              replacing the existing one.
	 * @param {id} id Either requires numeric identifier of the context fragment that was returned by
	 *            add method or requires an external identifier of type string that has to be determined by the consumer.
	 *            When using identifiers of type string the add method must not be used. Update is sufficient.
	 *            It either overwrites an existing context fragment for the identifier or creates a new one. 
	 * @param {sap.apf.utils.Filter} filter Requires a filter instance
	 */
	this.update = function(id, filter) {
		if(id && typeof id == 'number') {
		    msgHandler.check((id > 0 && id < uniqueConsumerId),'Passed unknown numeric identifier during update of path context handler');
            if(!(id > 0 && id < uniqueConsumerId)) {
                return;
            }
		} else if(!id || typeof id != 'string') {
		    msgHandler.check(id,'Passed false identifier during update of path context handler');
		    return;
		}
		contextFragments[id] = filter;
		functions.setContext(combineFragments());
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#get
	 * @description Returns a context fragment for the given identifier
	 * @param {number|string} id Requires identifier of the context fragment. The id was returned by
	 *            the add method. 
	 * @returns {sap.apf.utils.Filter} Context assigned to identifier
	 */
	this.get = function(id) {
	    switch (typeof id) {
	    case 'number':
	        msgHandler.check((id > 0 && id < uniqueConsumerId),'Passed unknown numeric identifier during get from path context handler');
	        break;
	    case 'string':
	        msgHandler.check(contextFragments[id],'Passed unknown string identifier during get from path context handler');
            break;
	    }
		return contextFragments[id];
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#getAllIds
	 * @description Returns the ids for all context fragments
	 * @returns [number|string] Ids for all context fragments
	 */
	this.getAllIds = function() {
		var aResultIds = [];
        var property;
		for(property in contextFragments) {
		    if(contextFragments.hasOwnProperty(property)) {
                aResultIds.push(ifPossibleConvertToNumber(property));
            }
		}
		return aResultIds;
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#serialize
	 * @description Serializes the content of the pathContextHandler.
	 * @returns {object} Serialized data as deep JS object
	 */
	this.serialize = function() {
		var serializableData = {};
        var property;
		for(property in contextFragments) {
		    if(contextFragments.hasOwnProperty(property)) {
		        serializableData[property] = contextFragments[property].serialize();
		    }
		}
		return serializableData;
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.PathContextHandler#deserialize
	 * @description Re-initializes path context context handler from serialized data.
	 * @param deserializableData
	 *            Serialized data used to re-initialize path context handler
	 * @returns {object} Re-initialize instance of sap.apf.utils.pathContextHandler
	 */
	this.deserialize = function(deserializableData) {
        var property;
	    uniqueConsumerId = 1;
		contextFragments = {};
	      for(property in deserializableData) {
	            if(deserializableData.hasOwnProperty(property)) {
	                contextFragments[property] = new sap.apf.utils.Filter(msgHandler).deserialize(deserializableData[property]);
	                uniqueConsumerId++;
	            }
	      }
	    if(uniqueConsumerId > 1) {
	        functions.setContext(combineFragments());
	    }
		return this;
	};
    /**
     * @private
     * @function
     * @name sap.apf.utils.PathContextHandler#saveInitialContext
     * @description Internally saves the current state of the filter fragments
     * @param {array} [ids]
     * If provided initial state will be selectively saved.
     * Only the filter fragments for the provided IDs are saved or updated as initial state.
     * If omitted, all filter current fragments are saved or updated as initial state.
     */
    this.saveInitialContext = function(ids) {
        var property,
            i,
            len;
        var initialContextBeforeSaveOrUpdate = {};
        var initialContextAfterSaveOrUpdate = {};
        if(ids) {
            for(property in initialContext) {
                if(initialContext.hasOwnProperty(property)) {
                    initialContextBeforeSaveOrUpdate[property] = new sap.apf.utils.Filter(msgHandler).deserialize(initialContext[property]);
                }
            }
            for(i = 0, len = ids.length; i < len; i++) {
                initialContextBeforeSaveOrUpdate[ids[i]] = contextFragments[ids[i]];
            }
            for(property in initialContextBeforeSaveOrUpdate){
                initialContextAfterSaveOrUpdate[property] = initialContextBeforeSaveOrUpdate[property].serialize();
            }
            initialContext = initialContextAfterSaveOrUpdate;
        } else {
            initialContext = this.serialize();
        }
    };
    /**
     * @private
     * @function
     * @name sap.apf.utils.PathContextHandler#restoreInitialContext
     * @description Internally restores a previously saved state of filter fragments.
     * If no initial state has been saved before the current filter fragments remain unchanged.
     * @param {array} [ids]
     * If provided initial state will be selectively restored.
     * Only the filter fragments for the provided IDs are restored.
     * If omitted, all filter fragments are restored to the state that has been saved as initial state.
     */
    this.restoreInitialContext = function(ids) {
        var fragmentsToBeKept = {};
        var property;
        if(initialContext) {
            if(ids) {
                for(property in contextFragments) {
                    if(ids.indexOf(ifPossibleConvertToNumber(property)) == -1) {
                        fragmentsToBeKept[property] = contextFragments[property];
                    }
                }
            }
            this.deserialize(initialContext);
            for(property in fragmentsToBeKept) {
                contextFragments[property] = fragmentsToBeKept[property];
            }
            functions.setContext(combineFragments());
        }
    };
	function combineFragments() {
	    var filterArray = [];
	    for(var filter in contextFragments) {
	        if(contextFragments.hasOwnProperty(filter)) {
	            filterArray.push(contextFragments[filter]);
	        }
	    }
	 return  new sap.apf.utils.Filter(msgHandler).intersectWith(filterArray);
	}
    function ifPossibleConvertToNumber(property) {
        if(isNaN(Number(property))) {
            return property;
        } else {
            return Number(property);
        }
    }
};
}; // end of sap/apf/utils/pathContextHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.serializationMediator') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.utils.serializationMediator");
/**
 * @private
 * @class Serialization Mediator gets, collects and distributes non-core objects for persistence operations (save, open and delete).
 * @param {object} oInject Object containing an instance of {@link sap.apf.utils.PathContextHandler} and {@link sap.apf.core.Instance}
 * @param {object} oInject.pathContextHandler Instance of {@link sap.apf.utils.PathContextHandler} 
 * @param {object} oInject.coreApi Instance of {@link sap.apf.core.Instance}
 * @returns {sap.apf.utils.SerializationMediator}
 */
sap.apf.utils.SerializationMediator = function(oInject){

    /**
     * @private
     * @function
     * @name sap.apf.utils.SerializationMediator#savePath
     * @description Saves or modifies the current path on server side under the provided name.
     * @param {string} [sPathId] If provided the path identified by the ID is modified with the current path.
     * If omitted the current path will be created as new saved path with a new ID.
     * @param {string} sName Name of the path to be saved
     * @param {function} fnCallback The first argument of the callback function is an object with property AnalysisPath and status.
     * The second argument is {sap.apf.core.EntityTypeMetadata}.
     * The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
     * @returns undefined
     */
	this.savePath = function(arg1, arg2, arg3){
		var oExternalObjects = {
                pathContextHandler: oInject.pathContextHandler.serialize()
		};
		
		if (typeof arg1 === 'string' && typeof arg2 === 'function') {
			//case for create path
			oInject.coreApi.savePath(arg1, arg2, oExternalObjects);
		}else if (typeof arg1 === 'string' && typeof arg2 === 'string' && typeof arg3 === 'function'){
			//case for update path
			oInject.coreApi.savePath(arg1, arg2, arg3, oExternalObjects);
		}
	};

    /**
     * @private
     * @function
     * @name sap.apf.utils.SerializationMediator#openPath
     * @description Opens a path, that has been stored on server side and replaces the current path.
     * @param {string} sPathId Identifies the analysis path to be opened
     * @param {function} fnCallback The first argument of the callback function is a JS object with property path, that holds the stored path and status. The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
     * @param {number} [nActiveStep] Sets the active step.
     * @returns undefined
     */
	this.openPath = function(sPathId, fnCallback, nActiveStep){
		var fnCallbackFromCoreApi = function(oResponse, oEntityTypeMetadata, oMessageObjectForUI){
            if(oResponse && oResponse.path && oResponse.path.SerializedAnalysisPath && oResponse.path.SerializedAnalysisPath.pathContextHandler){
                oInject.pathContextHandler.deserialize(oResponse.path.SerializedAnalysisPath.pathContextHandler);
                delete oResponse.path.SerializedAnalysisPath.pathContextHandler;
            }
            fnCallback(oResponse, oEntityTypeMetadata, oMessageObjectForUI);
        };

        oInject.coreApi.openPath(sPathId, fnCallbackFromCoreApi, nActiveStep);
	};
    /**
     * @private
     * @function
     * @name sap.apf.utils.SerializationMediator#deletePath
     * @description Deletes the path with the given ID on server
     * @param {string} sPathId Identifies the analysis path to be deleted
     * @param {function} fnCallback The first argument of the callback function is a JS object, that holds the property status. The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
     * @returns undefined
     */
	this.deletePath = function(sPathId, fnCallback){
		oInject.coreApi.deletePath(sPathId, fnCallback);
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.utils.SerializationMediator#readPaths
	 * @description Reads all stored paths from server
	 * @param {function} fnCallback This callback function is called after function readPaths has been executed.
	 * @param {function} fnCallback(oResponse, oEntitiyMetadata, oMessageObject)
	 * @returns undefined
	 */
	this.readPaths = function(fnCallback){
		oInject.coreApi.readPaths(fnCallback);
	};
};
}; // end of sap/apf/utils/serializationMediator.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.smartBusinessHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare('sap.apf.utils.smartBusinessHandler');

/**
 * @private
 * @experimental The complete class interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
 * @class Smart business handler
 * @description Manages smart business context.
 * @param {object} oInject - Dependency Injection
 * @name sap.apf.utils.SmartBusinessHandler
 */
sap.apf.utils.SmartBusinessHandler = function(oInject) {
	"use strict";
	var self = this;
	var oCoreApi = {
		getApplicationConfigProperties : oInject.getApplicationConfigProperties,
		createReadRequestByRequiredFilter : oInject.createReadRequestByRequiredFilter,
		getTextNotHtmlEncoded : oInject.getTextNotHtmlEncoded
	};
	var oMessageHandler = oInject.oMessageHandler;
	var oStartParameter = oInject.startParameter;
	var deferredObj = new jQuery.Deferred();
	var oPromise = deferredObj.promise();
	var aFilters = [];
	var aParameterEntitySetKeyProperties = [];
	var aConsolidatedFilters = [];
	var constants = {
		FILTER_TYPE : "FI",
		PARAMETER_TYPE : "PA"
	};
	var getKPIEvaluationId = function() {		
		// Use the start parameter module to get the evaluation id
		return oStartParameter.getEvaluationId();
	};
	
	var sEvaluationId = getKPIEvaluationId();
	/**
	 * @public
	 * @function
	 * @name sap.apf.utils.SmartBusinessHandler#initialize
	 * @description Triggers fetching the smart business filters.
	 * */
	this.initialize = function() {
		oPromise = this._fetchSBData().then(this._pushAllSBFilters);
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.utils.SmartBusinessHandler#getEvaluationId
	 * @description Getter for KPI Evaluation Id.
	 * @returns {string}
	 * */
	this.getEvaluationId = function() {
		return sEvaluationId;
	};
	this._fetchSBData = function() {
		if (sEvaluationId) {
			var sbConfiguration = oCoreApi.getApplicationConfigProperties().smartBusiness || oCoreApi.getApplicationConfigProperties().smartBusinessService; // TODO CHANGE THIS WHEN APPLICATIONS ADOPT THE NEW TERMINOLOGY
			var sbRuntime = sbConfiguration.runtime || sbConfiguration.evaluation; // TODO CHANGE THIS WHEN APPLICATIONS ADOPT THE NEW TERMINOLOGY
			var sEntitySet = sap.apf.core.constants.entitySets.smartBusiness;
			var sbUrl = [ sbRuntime.service, "/", sEntitySet, "('", sEvaluationId, "')/FILTERS?$format=json" ].join("");
			if (deferredObj.state() === "pending") {
				jQuery.ajax({ // TODO Use createReadRequestByRequiredFilter.
					url : sbUrl,
					success : function(data) {
						deferredObj.resolveWith(self, [ data ]);
					},
					error : function(jqXHR, textStatus, errorThrown) {
						var oMessageObject = oMessageHandler.createMessageObject({
							code : "6011"
						});
						oMessageHandler.putMessage(oMessageObject);
					}
				});
			}
		} else {
			deferredObj.resolveWith(self, [ {
				// TODO Change this when we move to oData v4
				d : {
					results : []
				}
			} ]);
		}
		return deferredObj.promise();
	};
	this._pushAllSBFilters = function(sbData) {
		var aProperties = sbData.d.results; // TODO Change this when we move to oData v4
		aProperties.forEach(function(property) {
			if (property.TYPE === constants.FILTER_TYPE) {
				aFilters.push(property);
			} else if (property.TYPE === constants.PARAMETER_TYPE) {
				aParameterEntitySetKeyProperties.push(property);
			}
			aConsolidatedFilters.push(property);
		});
		return aConsolidatedFilters;
	};
	/**
	 * @public
	 * @function
	 * @name sap.apf.utils.SmartBusinessHandler#getAllFilters
	 * @description Getter for all smart business filters.
	 * Returns a jQuery Promise which will be resolved with Array of filters.
	 * @returns {jQuery.Promise}
	 * */
	this.getAllFilters = function() {
		return oPromise;
	};
};

}; // end of sap/apf/utils/smartBusinessHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.startParameter') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

(function () {
	'use strict';

	jQuery.sap.declare('sap.apf.utils.startParameter');
	
	/**
	 * @private 
	 * @class Provides convenience functions to receive parameter set through component`s startup parameter or basic URL parameter.
	 * 		  When both parameter are set then the component`s startup parameter wins.
	 * @param {object} component 
	 */
	sap.apf.utils.StartParameter = function(component){
		var analyticalConfigurationId = null;
		var stepId = null;
		var representationId = null;
		var selectionVariantId = null;
		var appConfigPath;
		var evaluationId;
		var startParameters;
		
		if(component && component.getComponentData && component.getComponentData() && component.getComponentData().startupParameters) {
			startParameters = component.getComponentData().startupParameters;
			if(startParameters['sap-apf-configuration-id']) {
				analyticalConfigurationId = startParameters['sap-apf-configuration-id'][0];
			}
			if(startParameters['sap-apf-step-id']) {
				stepId = startParameters['sap-apf-step-id'][0];
			}
			if(startParameters['sap-apf-representation-id']) {
				representationId = startParameters['sap-apf-representation-id'][0];
			}
			if(startParameters['sap-apf-selection-variant-id']) { //TODO: replace parameter name with official selection variant convention
				selectionVariantId = startParameters['sap-apf-selection-variant-id'][0];
			}
			if(startParameters['sap-apf-app-config-path']) {
				appConfigPath = startParameters['sap-apf-app-config-path'][0];
			}
			if(startParameters['evaluationId']) {
				evaluationId = startParameters['evaluationId'][0];
			}
		}
		
        /**
         * @private
         * @function
         * @name sap.apf.utils.StartParameter#getSteps
         * @description Returns analytical configuration ID.
         * @returns {string} analyticalConfigurationId
         */
		this.getAnalyticalConfigurationId = function() {
			if(!analyticalConfigurationId) {
				analyticalConfigurationId = jQuery.sap.getUriParameters().get('sap-apf-configuration-id');
			}
			return analyticalConfigurationId;
		};

        /**
         * @private
         * @function
         * @name sap.apf.utils.StartParameter#getAnalyticalConfigurationId
         * @description Returns step IDs and representation IDs.
         * @returns {Array} steps Step contains step ID and optional representation ID
         */
		this.getSteps = function() {
			if(!stepId) {
				stepId = jQuery.sap.getUriParameters().get('sap-apf-step-id');
			}
			if(!representationId) {
				representationId = jQuery.sap.getUriParameters().get('sap-apf-representation-id');
			}
			if(!stepId) {
				return null;
			} else {
				return [{
					stepId : stepId,
					representationId : representationId
				}];
			}
		};

        /**
         * @private
         * @function
         * @name sap.apf.utils.StartParameter#getSelectionVariantId
         * @description Returns selection variant ID.
         * @returns {string} selectionVariantId
         */
		this.getSelectionVariantId = function() {
			if(!selectionVariantId) {
				selectionVariantId = jQuery.sap.getUriParameters().get('sap-apf-selection-variant-id'); //TODO: replace parameter name with official selection variant convention
			}
			return selectionVariantId;
		};
		
		this.getApplicationConfigurationPath = function() {
			return appConfigPath;
		};
		
		this.getEvaluationId = function() {
			return evaluationId;
		};
		
		this.getStartUpMode = function() {
			//TODO: Define startup mode CONSTANTS (forward and backward navigation)
			//TODO: Compute startup mode and return correct CONSTANT
		};
	};
}());
}; // end of sap/apf/utils/startParameter.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.utils') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/* globals window */
 
 /**
   * Static helper functions
   */
jQuery.sap.declare('sap.apf.utils.utils');
jQuery.sap.require('sap.ui.core.format.DateFormat'); // unlisted dependency retained


/**
 * @description Returns the URL parameters. Is a wrapper function for the jQuery.sap.getUriParameters function. For more details, please see SAPUI5 documentation 
 * @returns {object}
 */
sap.apf.utils.getUriParameters = function() {
	return jQuery.sap.getUriParameters().mParams;
};
/**
 * @description Eliminates duplicate values in an array
 * @param {Object[]} aWithDuplicates
 * @returns {Object[]}
 */
sap.apf.utils.eliminateDuplicatesInArray = function(oMsgHandler, aWithDuplicates) {
	oMsgHandler.check((aWithDuplicates !== undefined && typeof aWithDuplicates === 'object' && aWithDuplicates.hasOwnProperty('length') === true), 'Error - aArray is undefined');
	var aReturn = [];
	for( var i = 0; i < aWithDuplicates.length; i++) {
		for( var j = i + 1; j < aWithDuplicates.length; j++) {
			// If this[i] is found later in the array
			if (aWithDuplicates[i] === aWithDuplicates[j]) {
				j = ++i;
			}
		}
		aReturn.push(aWithDuplicates[i]);
	}
	return aReturn;
};
/**
 * @description Returns a hash code of a string
 * @param {string} sValue
 * @returns {number}
 */
sap.apf.utils.hashCode = function(sValue) {
	var nHash = 0;
	var i = 0;
	var nCharCode = 0;
	sValue = sValue + ''; // convert to string
	var len = sValue.length;
	for(i = 0; i < len; i++) {
		nCharCode = sValue.charCodeAt(i);
		nHash = (17 * nHash + nCharCode) << 0;
	}
	return nHash;
};
/**
 * @description Escapes data according to the SAP XSE OData specification, that is doubling the single quote
 * @param {string} sValue
 * @returns {string} || {object}
 */
sap.apf.utils.escapeOdata = function(sValue) {
	if (typeof sValue === "string") {
		return sValue.replace("'", "''");
	} else {
		return sValue;
	}
};
/**
 * @description Formats a value in json format in the javascript object.  
 * @param {object} value some value
 * @param {string} sType edm type name
 * @returns {object} javascriptValue
 */
sap.apf.utils.json2javascriptFormat = function(value, sType) {
	var intermediateValue;
	
	switch(sType) {
		case "Edm.Boolean":
			if (typeof value === "boolean") {
				return value;
			}
			if (typeof value === "string") {
				return value.toLowerCase() === "true";
			}
			return false;		 
		case "Edm.Decimal":
		case "Edm.Guid" :
		case "Edm.Int64" :
		case "Edm.String" :
			return value;
		case "Edm.Int16":
		case "Edm.Int32":
			return parseInt(value, 10);
		case "Edm.Single":
		case "Edm.Float" :
			return parseFloat(value);
		case "Edm.Time":
			return value;
		case "Edm.DateTime":
			intermediateValue = value.replace('/Date(', '').replace(')/', '');
			intermediateValue = parseFloat(intermediateValue);
			return new Date(intermediateValue);
		case "Edm.DateTimeOffset":
			intermediateValue = value.replace('/Date(', '');
			intermediateValue = intermediateValue.replace(')/', '');
			intermediateValue = parseFloat(intermediateValue);
			return new Date(intermediateValue);
			
	}
	return value; //default
};

/**
  * @description Formats a value for usage in odata conformant url as filter or parameter with given Edm type
  * @param {object} value some value
  * @param {string} sType edm type name
  * @returns {string} sFormatedValue
  */
sap.apf.utils.formatValue = function(value, sType) {
	
	function convertValueToDate (v) {
		var val;
		
		if (v instanceof Date) {
			return v;
		} else if (typeof v === 'string') {
			if (v.substring(0, 6) === '/Date(') {
				val = v.replace('/Date(', '');
				val = val.replace(')/', '');
				val = parseInt(val, 10);
				return new Date(val);
			} else {
				return new Date(v);
			}	
		}	
	}
	
	var oDate;
	var sFormatedValue = "";
	// null values should return the null literal
	if (value === null || value === undefined) {
		return "null";
	}
	
	
	switch(sType) {
		case "Edm.String":
			// quote
			sFormatedValue = "'" + String(value).replace(/'/g, "''") + "'";
			break;
		case "Edm.Time":
			if (typeof value === 'number') {
				oDate = new Date();
				oDate.setTime(value);
				var hours = oDate.getUTCHours();
				if (hours < 10) {
					hours = '0' + hours;
				}
				var minutes = oDate.getUTCMinutes();
				if (minutes < 	10) {
					minutes = '0' + minutes;
				}
				var seconds = oDate.getUTCSeconds();
				if (seconds < 10) {
					seconds = '0' + seconds;
				}
				sFormatedValue =  "time'" + hours + ':' + minutes + ':' + seconds + "'";
			} else {
				sFormatedValue = "time'" + value + "'";
				
			}
			
			break;
		case "Edm.DateTime":
			if (!sap.apf.utils.formatValue.oDateTimeFormat) {
				sap.apf.utils.formatValue.oDateTimeFormat = sap.ui.core.format.DateFormat.getDateInstance({
					pattern: "'datetime'''yyyy-MM-dd'T'HH:mm:ss''"
				});
			}

			oDate = convertValueToDate(value);
			sFormatedValue = sap.apf.utils.formatValue.oDateTimeFormat.format(oDate, true);
			break;
		case "Edm.DateTimeOffset":
			
			if (!sap.apf.utils.formatValue.oDateTimeOffsetFormat) {
				sap.apf.utils.formatValue.oDateTimeOffsetFormat = sap.ui.core.format.DateFormat.getDateInstance({
					pattern: "'datetimeoffset'''yyyy-MM-dd'T'HH:mm:ss'Z'''"
				});
			}
			oDate = convertValueToDate(value); //
			sFormatedValue = sap.apf.utils.formatValue.oDateTimeOffsetFormat.format(oDate, true);
			break;
		case "Edm.Guid":
			sFormatedValue = "guid'" + value + "'";
			break;
		case "Edm.Decimal":
			sFormatedValue = value + "M";
			break;
		case "Edm.Int64":
			sFormatedValue = String(value)+ "L";
			break;
		case "Edm.Single":
			sFormatedValue = value + "f";
			break;
		case "Edm.Binary":
			sFormatedValue = "binary'" + value + "'";
			break;
		default:
			sFormatedValue = value;
			break;
	}
	return sFormatedValue;	
			
};

/**
 * @description Transforms a string into a callable function. Method should only be called internally by APF.
 * @param {string} sFunctionPath
 * @returns {function}
 */	
sap.apf.utils.extractFunctionFromModulePathString = function(sFunctionPath) {

    if (jQuery.isFunction(sFunctionPath)) {
        return sFunctionPath;
    }
    var oDeepestNameSpaceLevel, aNameSpaceParts, sFunction;
    aNameSpaceParts = sFunctionPath.split('.');
    oDeepestNameSpaceLevel = window;
    for( var i = 0; i < aNameSpaceParts.length - 1; i++) {
        oDeepestNameSpaceLevel = oDeepestNameSpaceLevel[aNameSpaceParts[i]] ? oDeepestNameSpaceLevel[aNameSpaceParts[i]] : undefined;
        if(!oDeepestNameSpaceLevel) {
            return;
        }
    }
    sFunction = aNameSpaceParts[aNameSpaceParts.length - 1];
    return oDeepestNameSpaceLevel[sFunction];
}; 

/**
* @description Checks whether a give string is a valid server guid: exactly 32 digits long and characters only from 0-9 or A-F
* @param {string} guid
* @returns {boolean}
*/	
sap.apf.utils.isValidGuid = function(guid){
	return /^[0-9A-F]{32}$/.test(guid);
};

/**
 *description In old analytical configurations categories were assigned to step objects. To enable an individual sorting of steps beneath categories category objects have now step assignments
 * @param {object} analyticalConfiguration- configuration to migrate, if needed
 * @param {object} inject - inject logic 
 * @param {object} inject.instance.messageHandler - constructor for messageHandler 
 * @param {object} inject.constructor.hashTable - constructor for hashTable
 */
sap.apf.utils.migrateConfigToCategoryStepAssignment = function(analyticalConfiguration, inject){
	var categoryStepAssignments = new inject.constructor.hashtable(inject.instance.messageHandler);
	if(analyticalConfiguration.steps){
		analyticalConfiguration.steps.forEach(function(step){
			if(step.categories){
				step.categories.forEach(function(category){
					var categoryStepAssignment = categoryStepAssignments.getItem(category.id);
					if(!categoryStepAssignment){
						categoryStepAssignment = { category : category.id, steps : [ {type: "step", id : step.id} ] };
						categoryStepAssignments.setItem(category.id, categoryStepAssignment);
					} else {
						categoryStepAssignment.steps.push({type : "step", id : step.id});
					}
				});
				delete step.categories;
			}
		});
	}
	if(analyticalConfiguration.categories){
		analyticalConfiguration.categories.forEach(function(category){
			if(!category.steps){
				var categoryStepAssignment = categoryStepAssignments.getItem(category.id);
				if(categoryStepAssignment){
					category.steps = categoryStepAssignment.steps;
				} else{
					category.steps = [];
				}	
			}
		});
	}

};
}; // end of sap/apf/utils/utils.js
if ( !jQuery.sap.isDeclared('sap.apf.core.ajax') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.ajax");



/**
 * @memberOf sap.apf.core
 * @description Wraps a jQuery (jQuery.ajax) request in order to handle a server time-out.
 * @param {object} oSettings Configuration of the jQuery.ajax request.
 * @returns {object} jqXHR
 */
sap.apf.core.ajax = function(oSettings) {
	var oAjaxSettings = jQuery.extend(true, {}, oSettings);
	var fnBeforeSend = oAjaxSettings.beforeSend;
	var fnSuccess = oAjaxSettings.success;
	var fnError = oAjaxSettings.error;

	oAjaxSettings.beforeSend = function(jqXHR, settings) {
		if (fnBeforeSend) {
			fnBeforeSend(jqXHR, settings);
		}
	};
	oAjaxSettings.success = function(data, textStatus, jqXHR) {
		var oMessage = sap.apf.core.utils.checkForTimeout(jqXHR);
		
		if(oMessage) {
			fnError(data, "error", undefined, oMessage);
		} else {
			fnSuccess(data, textStatus, jqXHR);
		}
		
	};
	oAjaxSettings.error = function(jqXHR, textStatus, errorThrown) {
		var oMessage = sap.apf.core.utils.checkForTimeout(jqXHR);
		if (oMessage) {
			fnError(jqXHR, textStatus, errorThrown, oMessage);
		} else {
			fnError(jqXHR, textStatus, errorThrown);
		}
		
	};
	return jQuery.ajax(oAjaxSettings);
};
}; // end of sap/apf/core/ajax.js
if ( !jQuery.sap.isDeclared('sap.apf.core.messageHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.core.messageHandler");




/** 
 * @class MessageHandler of APF
 */
sap.apf.core.MessageHandler = function(bLogOnCreate) {	

	// Private Vars
	var that = this;
	var oTextResourceHandler;
	var aLogMessages = [];
	var nCurrentLogMessageNumber = 0;
	var idRegistry;
	var fnMessageCallback;
	var fnApplicationMessageCallback = function() {};
	var bOnErrorHandling = false;
	var bDoNotFurtherProcessException = false;
	var bDuringLogWriting = false;
	var bHintForFirefoxErrorIsThrown = false;
	var sUniqueErrorId = "";

	var oDefaultMessageConfiguration = {
		code : sap.apf.core.constants.message.code.errorUnknown,
		severity : sap.apf.core.constants.message.severity.error,
		rawText : "Unknown Error occurred"
	};

	// Public Func
	/**
	 * @description Creates a message object. The message processing is started with sap.api.putMessage, which expects as argument a message object 
	 * of type sap.apf.core.MessageObject. So first create the message object and afterwards call sap.apf.api.putMessage with the message object as argument.
	 * @param {object} oConfig Configuration of the message.
	 * @param {string} oConfig.code The message is classified by its code. The code identifies an entry in the message configuration.
	 * @param {string[]} oConfig.aParameters Additional parameters for the message. The parameters are filled into the message text, when the message
	 * will be processed by the message handler. 
	 * @param {object} oConfig.oCallingObject Reference of the calling object. This can be used later to visualize on the user interface, 
	 * where the error happened, e.g. path or step.
	 * @returns {sap.apf.core.MessageObject}
	 */
	this.createMessageObject = function(oConfig) {
		if(bLogOnCreate){
			var oMessageObject = new sap.apf.core.MessageObject(oConfig);
			if (oMessageObject.getCode() === undefined) {
				oMessageObject.setCode(sap.apf.core.constants.message.code.errorUnknown);
			}
			enrichInfoInMessageObject.bind(this)(oMessageObject);	
			logMessage(oMessageObject, 1);
		}
		return new sap.apf.core.MessageObject(oConfig);
	};

	/**
	 * @description The handling of the window.onerror by the message handler is either switched on or off.
	 * @param {boolean} bOnOff
	 * @returns {undefined}
	 */
	this.activateOnErrorHandling = function(bOnOff) {
		/*global window: false */
		bOnErrorHandling = bOnOff;
		if (bOnErrorHandling === true) {
			jQuery(window).on("error", handleOwnErrors);
			
		} else {
			jQuery(window).off("error");
		}
	};

	/**
	 * @description Injection setter. Injection is optional. If not injected, putMessage doesn't retrieve the text but instead reacts with some generic message. 
	 * @param {object} textResourceHandler
	 */
	this.setTextResourceHandler = function(textResourceHandler) {
		oTextResourceHandler = textResourceHandler;
	};

	/**
	 * @description Loads all message from the  configuration. This method is called from the resource path handler.
	 * @param {object[]} aMessages Array with message configuration objects.
	 * @param {boolean} bResetRegistry  Flag to reset registry.
	 * @returns {undefined}
	 */
	this.loadConfig = function(aMessages, bResetRegistry) {
		if (idRegistry === undefined || bResetRegistry) {
			idRegistry = new sap.apf.utils.Hashtable(that);
		}
		for(var i = 0; i < aMessages.length; i++) {
			loadMessage(aMessages[i]);
		}
	};

	/**
	 * @description Sets a callback function, so that a message can be further processed. This includes the display of the message on the user interface 
	 * and throwing an error to stop processing in case of errors.
	 * @param {function} fnCallback Either a function or undefined. The callback function will be called  with the messageObject of type 
	 * sap.apf.core.MessageObject as only parameter.
	 * @returns {undefined}
	 */
	this.setMessageCallback = function(fnCallback) {
		if (fnCallback !== undefined && typeof fnCallback === "function") {
			fnMessageCallback = fnCallback;
		} else {
			fnMessageCallback = undefined;
			// log technical error - putMessage with technical error
		}
	};

	/**
	 * @description Sets an application callback function, which allows applications to register a message callback.
	 * @param {function} fnCallback Either a function or undefined. The callback function will be called  with the messageObject of type 
	 * sap.apf.core.MessageObject as only parameter.
	 * @returns {undefined}
	 */
	this.setApplicationMessageCallback = function(fnCallback) {
		if (fnCallback !== undefined && typeof fnCallback === "function") {
			fnApplicationMessageCallback = fnCallback;
		} else {
			fnApplicationMessageCallback = function() {};
			this.putMessage(this.createMessageObject({
				code : "5031"
			}));
		}
	};

	/**
	 * @description A message is passed to the message handler for further processing. This can be an information, warning or error. 
	 * @param {sap.apf.core.MessageObject} oMessageObject The message object shall be created by method sap.apf.api.createMessageObject.
	 * @returns {undefined}
	 */
	this.putMessage = function(oMessageObject) {
		var oPreviousMessageObject;
		var nMaxPreviousObjects = 0;
		var oMessageObjectFatal;
		
		if (oMessageObject.getCode() === undefined) {
			oMessageObject.setCode(sap.apf.core.constants.message.code.errorUnknown);
		}
		
		enrichInfoInMessageObject.bind(this)(oMessageObject);
		
		if (oMessageObject.getSeverity() === sap.apf.core.constants.message.severity.fatal) {
			
			oMessageObjectFatal = that.createMessageObject({ code : sap.apf.core.constants.message.code.errorExitTriggered });
			enrichInfoInMessageObject.bind(this)(oMessageObjectFatal);
			oMessageObjectFatal.setSeverity(sap.apf.core.constants.message.severity.fatal);
			if (oMessageObjectFatal.getMessage() === "") {
				oMessageObjectFatal.setMessage("You must log out of the application due to a critical error");
			}
		}
		

		oPreviousMessageObject = oMessageObject.getPrevious();
		while (oPreviousMessageObject !== undefined && oPreviousMessageObject.type && oPreviousMessageObject.type === "messageObject" && nMaxPreviousObjects < 10) {
			if (oPreviousMessageObject.getCode() === undefined) {
				oPreviousMessageObject.setCode(sap.apf.core.constants.message.code.errorUnknown);
			}
			enrichInfoInMessageObject.bind(this)(oPreviousMessageObject);
			oPreviousMessageObject = oPreviousMessageObject.getPrevious();
			nMaxPreviousObjects++;
		}
		
		if (oMessageObjectFatal !== undefined) {
			oMessageObjectFatal.setPrevious(oMessageObject);
			oMessageObject = oMessageObjectFatal;
		}
		
		if(!bLogOnCreate){
			logMessage(oMessageObject, 10);	
		}

		if (bDoNotFurtherProcessException) { // no cycles from ui
			return;
		}
		
		if (fnMessageCallback !== undefined) {
			//noinspection JSUnusedAssignment
            bDoNotFurtherProcessException = true; // exception could be raised
			fnMessageCallback(oMessageObject, fnApplicationMessageCallback);
			bDoNotFurtherProcessException = false;
		} 
		//leave current execution control flow
		if (oMessageObject.getSeverity() === sap.apf.core.constants.message.severity.fatal) {
			if (sap.ui.Device.browser.firefox) {
				bHintForFirefoxErrorIsThrown = true;
			}
			
			throw new Error(sUniqueErrorId);
		}
	};

	/**
	 * @description Test whether condition is violated and puts a corresponding message.
	 * @param {boolean} booleExpression Boolean expression, that is evaluated.
	 * @param {string} sMessage A text, that is included in the message text
	 * @param {string} [sCode] Error code 5100 is default, 5101 for warning. Other codes can be used, if the default message text is not specific enough.
	 * @returns {undefined}
	 */
	this.check = function(booleExpression, sMessage, sCode) {
		var sErrorCode = sCode || sap.apf.core.constants.message.code.errorCheck;

		if (!booleExpression) {
			var oMessageObject = this.createMessageObject({
				code : sErrorCode,
				aParameters : [ sMessage ]
			});
			that.putMessage(oMessageObject);
		}
	};

	/**
	 * @description Returns a reference of a message configuration object. Not a copy.
	 * @param {string} sErrorCode
	 * @returns {object} oConfiguration
	 */
	this.getConfigurationByCode = function(sErrorCode) {
		if (idRegistry === undefined) { //before loading the configuration
			return undefined;
		}
		return idRegistry.getItem(sErrorCode);
	};

	/**
	 * @description Returns a copy of APF log messages. The last message put is on first position in array.
	 * @returns {string[]}
	 */
	this.getLogMessages = function() {
		return jQuery.extend(true, [], aLogMessages);
	};

	/**
	 * @description Resets the message handler: Unset the message callback function, loads default message configuration and cleans message log. 
	 * @returns {undefined}
	 */
	this.reset = function() {
		idRegistry = undefined;
		fnMessageCallback = undefined;
		fnApplicationMessageCallback = undefined;
		aLogMessages = [];
	};

	// Private Functions
	function isOwnErrorEvent(oEvent) {

		if (sap.ui.Device.browser.firefox) {
			return bHintForFirefoxErrorIsThrown;
		} 
		return (oEvent.originalEvent && oEvent.originalEvent.message && oEvent.originalEvent.message.search(sUniqueErrorId) > -1);
	}
    function isErrorEventFromOtherApfInstance(oEvent) {
    	return (oEvent.originalEvent && oEvent.originalEvent.message && oEvent.originalEvent.message.search(sUniqueErrorId) === -1 
    			&& oEvent.originalEvent.message.search(sap.apf.core.constants.message.code.suppressFurtherException) > -1);
    }
    function getUniqueErrorId() {
    	var date = new Date();
	    var uniqueInteger = Math.random( ) * date.getTime();
		return sap.apf.core.constants.message.code.suppressFurtherException + uniqueInteger;
    }
	function isKnownCodeWithoutConfiguration(sCode) {
		var sNumber = parseInt(sCode, 10);
		
		if (sNumber == sap.apf.core.constants.message.code.errorExitTriggered ) {
			return true;
		} else if (sNumber >= sap.apf.core.constants.message.code.errorUnknown && sNumber <= sap.apf.core.constants.message.code.errorInAnalyticalConfig) {
			return true;
		} 
		return false;
	}

	function isFatalMessageWithoutConfiguration(sCode) {
		var sNumber = parseInt(sCode, 10);
		if (sNumber > sap.apf.core.constants.message.code.errorUnknown && sNumber <= sap.apf.core.constants.message.code.errorInAnalyticalConfig) {
			return true;
		}
		return false;
	}

	// Determine and set message text according to configuration
	function enrichInfoInMessageObject(oMessageObject) {
		var sCode = oMessageObject.getCode();

		var oMessageConfiguration = that.getConfigurationByCode(sCode);
		if (oMessageConfiguration === undefined) {
			oMessageConfiguration = jQuery.extend(true, {}, oDefaultMessageConfiguration);
			if (isKnownCodeWithoutConfiguration(sCode)) {
				if (oMessageObject.hasRawText()) {
					oMessageConfiguration.rawText = oMessageObject.getRawText();
				}
				oMessageConfiguration.rawText += ' ' + oMessageObject.getParameters();
				if (isFatalMessageWithoutConfiguration(sCode)) {
					oMessageConfiguration.severity = sap.apf.core.constants.message.severity.fatal;
				}
			} else {
				oMessageConfiguration.rawText = "Message " + sCode + "  " + oMessageObject.getParameters() + " (Message Code has no Configuration)";
			}
			if (!isKnownCodeWithoutConfiguration(sCode)) {
				oMessageObject.setCode(oMessageConfiguration.code);
			}
		}
		if (oMessageConfiguration.severity !== undefined) {
			oMessageObject.setSeverity(oMessageConfiguration.severity);
		} else {
			oMessageObject.setSeverity(sap.apf.core.constants.message.severity.technError);
		}
		if (oMessageConfiguration.rawText) {
			oMessageObject.setMessage(oMessageConfiguration.rawText);
		} else {
			var aParameters = oMessageObject.getParameters();

			if (oMessageObject.getSeverity() === sap.apf.core.constants.message.severity.technError) {
				var sTechnText = that.getConfigurationByCode(oMessageConfiguration.code).text;
				if(!sTechnText){
					sTechnText = that.getConfigurationByCode(oMessageConfiguration.code).description;
				}
				var nParamIndex = 0;
				while (sTechnText.indexOf("{" + nParamIndex + "}") > -1) {
					if (typeof aParameters[nParamIndex] === "string") {
						sTechnText = sTechnText.replace("{" + nParamIndex + "}", aParameters[nParamIndex]);
					} else {
						sTechnText = sTechnText.replace("{" + nParamIndex + "}", "undefined");
					}
					nParamIndex++;
				}

				oMessageObject.setMessage(sTechnText);
			} else {
				try {
					if (oTextResourceHandler) {
						oMessageObject.setMessage(oTextResourceHandler.getMessageText(oMessageConfiguration.key, oMessageObject.getParameters()));
					} else {
						oMessageObject.setMessage("Message Code: " + sCode + " " + aParameters.toString());
					}
				} catch (oError) {
					oMessageObject.setMessage("Message Code: " + sCode + " " + aParameters.toString());
				}
			}
		}
	}
	function logMessage(oMessage, nMaxPreviousObjects) {
		var sLogPrefix = "APF message ";
		var sPreviousTxt = "";
		var nMaxPreviousObjectsInNextLog = nMaxPreviousObjects - 1;

		if (nMaxPreviousObjects === 0) {
			return;
		}
		// logging of previous message(s) first!
		var oPrevious = oMessage.getPrevious();
		if (oPrevious !== undefined) {
			logMessage(oPrevious, nMaxPreviousObjectsInNextLog);
			sPreviousTxt = " - (see previous message for more information)";
		}
		nCurrentLogMessageNumber++;
		var sLog = sLogPrefix + '(' + nCurrentLogMessageNumber + '): ' + oMessage.getCode() + " - " + oMessage.getMessage() + sPreviousTxt;
		if (bDuringLogWriting) {
			alert("Fatal Error during Log Writing " + sLog);
			return;
		}
		bDuringLogWriting = true;

		//adds fatal log message on first position in array
		if (oMessage.getSeverity() === sap.apf.core.constants.message.severity.fatal) {
			if (aLogMessages.length < 2) { // do not show to many fatal messages!
				aLogMessages.unshift(sLog); 
			}
		}

		switch (oMessage.getSeverity()) {
			case sap.apf.core.constants.message.severity.warning:
				jQuery.sap.log.warning(sLog);
				break;
			case sap.apf.core.constants.message.severity.error:
				jQuery.sap.log.error(sLog);
				break;
			case sap.apf.core.constants.message.severity.fatal:
				jQuery.sap.log.error(sLog);
				break;
			case sap.apf.core.constants.message.severity.technError:
				jQuery.sap.log.error(sLog);
				break;
			default:
				jQuery.sap.log.info(sLog);
		}
		bDuringLogWriting = false;
	}
	function setItem(oItem) {
		that.check(oItem !== undefined && oItem.hasOwnProperty("code") !== false, "MessageHandler setItem: oItem is undefined or property 'code' is missing", sap.apf.core.constants.message.code.errorStartUp);
		var result = idRegistry.setItem(oItem.code, oItem);
		that.check((result === undefined), "MessageHandler setItem: Configuration includes duplicated codes", sap.apf.core.constants.message.code.errorStartUp);
	}
	function loadMessage(oMessage) {
		if (oMessage.type === undefined) {
			oMessage.type = "message";
		}
		setItem(oMessage);
	}
	// handle on error will be activated after initialization of the message
	// handler.
	function handleOwnErrors(oEvent) {
	
		var oMessage;
		var sMessage = "";
		var lineNumber = "";
		var sUrl = "";
		var sText = "";
		var bBrowserSupportErrorEvent = true;
		
		if (sap.ui.Device.browser.firefox) {
			bBrowserSupportErrorEvent = false;
		}
		
		if (bBrowserSupportErrorEvent && oEvent && oEvent.originalEvent) {
			sMessage = oEvent.originalEvent.message;
			sUrl = oEvent.originalEvent.filename;
			lineNumber = oEvent.originalEvent.lineno;
		}
		
		if (isOwnErrorEvent(oEvent)) {
			
			oEvent.stopImmediatePropagation();
			oEvent.preventDefault();
		} else if (isErrorEventFromOtherApfInstance(oEvent)) {
			return;
		} else if (bDoNotFurtherProcessException) {
			oMessage = new sap.apf.core.MessageObject({
				code : sap.apf.core.constants.message.code.errorStopProcessing
			});
			oMessage.setSeverity(sap.apf.core.constants.message.severity.error);
			sText = "Unknown exception happened during processing of error by callback function ";
			if (bBrowserSupportErrorEvent) {
				sText = sText + sMessage + " (source: " + sUrl + ":" + lineNumber + ")";
			}
			
			oMessage.setMessage(sText);
			logMessage(oMessage, 1);
		} else {
			oMessage = new sap.apf.core.MessageObject({
				code : sap.apf.core.constants.message.code.errorUnknown
			});
			oMessage.setSeverity(sap.apf.core.constants.message.severity.error);
			sText = "Unknown exception ";
			if (bBrowserSupportErrorEvent) {
				sText = sText + sMessage + " (source: " + sUrl + ":" + lineNumber + ")";
			}
			oMessage.setMessage(sText);
			logMessage(oMessage, 1);
		}
	}
	
	function initialize() {
		sUniqueErrorId = getUniqueErrorId(); 
	}
	
	initialize();
};
}; // end of sap/apf/core/messageHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.core.metadata') ) {
/*global sap */
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.metadata");



/**
 * @class This class initializes the metadata and the annotations and merges them together. The class provides methods to access metadata information like parameters of an entity type and their
 *        data types.
 * @param {Object} oInject Injection of dependencies, which are Hashtable, MessageHandler, coreAi.
 * @param {string} sAbsolutePathToServiceDocument Absolute Path to service document like "/sap/hba/apps/wca/s/odata/wca.xsodata"
 */
sap.apf.core.Metadata = function (oInject, sAbsolutePathToServiceDocument) {
    'use strict';

    /**
     * @description Contains 'metadata'
     * @returns {String}
     */
    this.type = "metadata";
    // Private vars
    var that = this;
    var bInitFailed = false;
    var oCoreApi = oInject.coreApi;
    var oMetadata;
    var oAnnotation;
    var aEntityTypes;
    var oHtPropertyMetadata = new oInject.hashtable(oInject.messageHandler);
    var oHtFilterableProperties = new oInject.hashtable(oInject.messageHandler);
    var oHtAllProperties = new oInject.hashtable(oInject.messageHandler);
    var oHtParameterEntitySetKeyProperties = new oInject.hashtable(oInject.messageHandler);
    var oHtEntityTypeMetadata = new oInject.hashtable(oInject.messageHandler);
    var oHtEntityTypeOfEntitySet = new oInject.hashtable(oInject.messageHandler);
    var ODataModel = oInject.ODataModel || sap.ui.model.odata.ODataModel;
    var bDeactivateFatalError = false;
    if (oInject.deactivateFatalError) {
        bDeactivateFatalError = true;
    }

    // Private functions
    /**
     * @description Returns all entity types of service documents
     * @returns {Array} - EntityTypes Returns entity types
     */
    function getEntityTypes() {
        if (!aEntityTypes) {
            aEntityTypes = [];
            oMetadata.dataServices.schema.forEach(function (schemaElement) {
                schemaElement.entityType.forEach(function (element) {
                    aEntityTypes.push(element.name);
                });
            });
        }
        return aEntityTypes;
    }

    function checkInternalObjectStructure() {
        oInject.messageHandler.check(oMetadata !== undefined, 'sap.apf.metadata - oMetadata is undefined');
        oInject.messageHandler.check(oMetadata.dataServices, 'sap.apf.metadata - oMetadata.dataServices is undefined');
        oInject.messageHandler.check(oMetadata.dataServices.schema !== undefined, 'sap.apf.metadata - oMetadata.dataServices.schema is undefined');
        oInject.messageHandler.check(oAnnotation !== undefined, 'sap.apf.metadata - oAnnotation is undefined');
    }

    function getEntityTypeFromMetadata(sEntityType, bAggregate) {
        var done = false,
            result;
        oMetadata.dataServices.schema.forEach(function (aSchema) {
            aSchema.entityType.forEach(function (eType) {
                var aAttribute = eType.extensions;
                if (aAttribute && eType.name.indexOf(sEntityType) > -1) {
                    aAttribute.forEach(function (attribute) {
                        if (done) {
                            return;
                        }
                        if ((attribute.name === "semantics") &&
                            ( ( bAggregate && attribute.value === "aggregate") ||
                            ( !bAggregate && attribute.value === "parameters")
                            )) {
                            done = true;
                            result = eType;
                        }
                    });
                }
            });
        });
        if (done) {
            return result;
        }
        return {
            property: []
        };
    }

    function getEntityTypeFromPropertyAnnotations(sEntityType, bAggregate) {
        var result = {}, done = false, splitted;
        if (!sEntityType || (! oAnnotation.propertyAnnotations))  {
            return {};
        }
        var resultsSuffix = 'Results';
        if (sEntityType.indexOf(resultsSuffix, sEntityType.length - resultsSuffix.length) !== -1) {
            sEntityType = sEntityType.substring(0, sEntityType.length - resultsSuffix.length);
        }
        jQuery.each(oAnnotation.propertyAnnotations, function (oEntityTypeAnnotations, value) {
            if (done) {
                return;
            }
            splitted = oEntityTypeAnnotations.split(".").pop().toString();
            if (splitted === sEntityType || splitted.indexOf((sEntityType + (bAggregate ? "ResultsType" : "Type") )) > -1) {
                done = true;
                result = oAnnotation.propertyAnnotations[oEntityTypeAnnotations];
                return;
            }
        }.bind(that));
        return result;
    }

    function defineApiResult(object) {
        function moveToDataType(property) {
            if (!object.dataType) {
                object.dataType = {};
            }
            object.dataType[property] = object[property];
            delete object[property];
        }

        function map(sAlternativeName, property) {
            if (jQuery.isArray(object[property]) === true) {
                (object[property]).forEach(function(obj){
                    object[obj.name] = obj.value;
                });
                delete object[property];
            } else if (property !== "dataType" && typeof (object[property]) === "object") { // dataType is explicit set by the APF has not to be modified
                if (Object.keys(object[property]).length === 0) {
                    object[sAlternativeName] = "true";
                }
                jQuery.each(object[property], function(objProperty, itsValue){
                    object[sAlternativeName] = itsValue;
                });
                delete object[property];
            } else {
                object[sAlternativeName] = object[property];
            }
        }
        jQuery.each(object, function( sProperty){
            switch (sProperty) {
                case 'type':
                    moveToDataType(sProperty);
                    break;
                case 'maxLength':
                    moveToDataType(sProperty);
                    break;
                case 'precision':
                    moveToDataType(sProperty);
                    break;
                default:
                    var sPropertyName = sProperty.split(".").pop();
                    if (sPropertyName.search("ISO") === 0) {
                        map(sPropertyName, sProperty);
                    } else {
                        map(sPropertyName.replace(/^./, sPropertyName[0].toLowerCase()), sProperty);
                    }
                    break;
            }
        });
        return object;
    }

    function getParameterPropertiesFromEntityType(sEntityType, bOnlyKeyProperties) {
        if (oHtParameterEntitySetKeyProperties.hasItem(sEntityType) !== true) {
            checkInternalObjectStructure();
            var oEntityTypeFromMetadata = getEntityTypeFromMetadata(sEntityType, false);
            var oEntityTypeFromAnnotation = getEntityTypeFromPropertyAnnotations(sEntityType, false);
            var oKeyProperties = {};
            if (oEntityTypeFromMetadata.key && oEntityTypeFromMetadata.key.propertyRef) {
                oEntityTypeFromMetadata.key.propertyRef.forEach(function (oPropRef) {
                    oKeyProperties[oPropRef.name] = null;
                });
            }
            var oMerged = {};
            var oResult = {allParameters: [], keyParameters: []};
            var i, oProperty, oPropertyAnnotation;
            for (i = 0; i < oEntityTypeFromMetadata.property.length; i++) {
                oProperty = oEntityTypeFromMetadata.property[i];
                oProperty.isKey = oKeyProperties.hasOwnProperty(oProperty.name);
                oPropertyAnnotation = oEntityTypeFromAnnotation[oProperty.name];
                if (oPropertyAnnotation !== undefined) {
                    oProperty = jQuery.extend(oProperty, oPropertyAnnotation);
                }
                oMerged[oProperty.name] = oProperty;
            }
            var oProp, oParameter;
            for (oProp in oMerged) { // jshint ignore:line
                oParameter = defineApiResult(oMerged[oProp]);
                oResult.allParameters.push(oParameter);
                if (oParameter.isKey) {
                    oResult.keyParameters.push(oParameter);
                }
            }
            oHtParameterEntitySetKeyProperties.setItem(sEntityType, oResult);
        }
        if (!bOnlyKeyProperties) {
            return oHtParameterEntitySetKeyProperties.getItem(sEntityType).allParameters;
        }
        return oHtParameterEntitySetKeyProperties.getItem(sEntityType).keyParameters;
    }

    function getAllAggregatePropertiesOfEntityType(sEntityType) {
        var aPropertyNames = [];
        var bIsParameterEntityType = isParameterEntityType(sEntityType);
        if (bIsParameterEntityType) {
            sEntityType = getEntityTypeFromAggregateEntitySet(sEntityType);
        }

        var entityType = getEntityTypeFromMetadata(sEntityType, true);
        entityType.property.forEach(function (property) {
            aPropertyNames.push(property.name);
        });
        return aPropertyNames;
    }

    function getAllPropertiesOfExtendedEntityType(sEntityType) {
        var i;
        if (oHtAllProperties.hasItem(sEntityType) === true) {
            return oHtAllProperties.getItem(sEntityType);
        }
        var aAllProperties = [];
        var aPropertyNames = [];
        var aParameterNames = [];


        var sAggregateEntityType = getEntityTypeFromAggregateEntitySet(sEntityType);
        var oEntityTypeFromMetadata = getEntityTypeFromMetadata(sAggregateEntityType, true);
        for (i = 0; i < oEntityTypeFromMetadata.property.length; i++) {
            aPropertyNames.push(oEntityTypeFromMetadata.property[i].name);
        }

        var aParameters = getParameterPropertiesFromEntityType(sEntityType, false);
        for (i = 0; i < aParameters.length; i++) {
            aParameterNames.push(aParameters[i].name);
        }

        aAllProperties = aPropertyNames.concat(aParameterNames);

        oHtAllProperties.setItem(sEntityType, aAllProperties);
        return oHtAllProperties.getItem(sEntityType);
    }

    function determineEntityTypeName(sEntityTypeOrSetName) {

        var sEntityType;
        if (isEntityType(sEntityTypeOrSetName)) {
            sEntityType = sEntityTypeOrSetName;
        } else {
            sEntityType = oHtEntityTypeOfEntitySet.getItem(sEntityTypeOrSetName);
            sEntityType = sEntityType || oHtEntityTypeOfEntitySet.getItem(sEntityTypeOrSetName + "Results"); // compability!!!
        }
        return sEntityType;
    }

    function getFilterablePropertiesFromEntityType(sEntityType) {
        if (oHtFilterableProperties.hasItem(sEntityType) === true) {
            return oHtFilterableProperties.getItem(sEntityType);
        }
        checkInternalObjectStructure();
        var aResult = [];
        var oEntityTypeFromMetadata = getEntityTypeFromMetadata(sEntityType, true);
        var oEntityTypeFromAnnotation = getEntityTypeFromPropertyAnnotations(sEntityType, true);
        for (var i = 0; i < oEntityTypeFromMetadata.property.length; i++) {
            var oPropertyFromMetadata = oEntityTypeFromMetadata.property[i];
            if (oPropertyFromMetadata.extensions && oPropertyFromMetadata.extensions) {
                var bFilterable = true;
                for (var j = 0; j < oPropertyFromMetadata.extensions.length; j++) {
                    var oExtension = oPropertyFromMetadata.extensions[j];
                    if (oExtension.name === "filterable" && oExtension.value === "false") {
                        bFilterable = false;
                        break;
                    }
                }
                if (bFilterable) {
                    aResult.push(oPropertyFromMetadata.name);
                }
            }
        }
        for (var oProperty in oEntityTypeFromAnnotation) {
            if (oEntityTypeFromAnnotation[oProperty] && oEntityTypeFromAnnotation[oProperty].filterable && oEntityTypeFromAnnotation[oProperty].filterable === "true") {
                aResult.push(oProperty);
            }
        }
        oHtFilterableProperties.setItem(sEntityType, aResult);
        return oHtFilterableProperties.getItem(sEntityType);
    }

    function isEntityType(entityType) {
        var aEntityTypes = getEntityTypes();
        return (jQuery.inArray(entityType, aEntityTypes) > -1);
    }

    function isParameterEntityType(sEntityType) {
        var entityTypeName;
        var aAttributes;
        for (var i = 0; i < oMetadata.dataServices.schema.length; i++) {
            for (var j = 0; j < oMetadata.dataServices.schema[i].entityType.length; j++) {
                entityTypeName = oMetadata.dataServices.schema[i].entityType[j].name.split(".").pop();
                if (entityTypeName === sEntityType) {
                    aAttributes = oMetadata.dataServices.schema[i].entityType[j].extensions;
                    if (!aAttributes) {
                        return false;
                    }
                    for (var k = 0; k < aAttributes.length; k++) {
                        if (aAttributes[k].name === "semantics") {
                            return (aAttributes[k].value === "parameters");
                        }
                    }
                }
            }
        }
    }

    function getEntityTypeFromAnnotation(sEntityType) {
        for (var oEntityTypeAnnotations in oAnnotation) {
            if (oEntityTypeAnnotations.split(".").pop().toString().indexOf(sEntityType) > -1) {
                return oAnnotation[oEntityTypeAnnotations];
            }
        }
        return {};
    }

    function getPropertyMetadataFromEntityType(sEntityType, sPropertyName) {
        var sAggregateEntityType;
        var bIsParameterEntityType = isParameterEntityType(sEntityType);
        if (bIsParameterEntityType) {
            sAggregateEntityType = getEntityTypeFromAggregateEntitySet(sEntityType);
        }

        if (oHtPropertyMetadata.hasItem(sEntityType + sPropertyName) === true) {
            return oHtPropertyMetadata.getItem(sEntityType + sPropertyName);
        } else {
            checkInternalObjectStructure();
            var oEntityTypeFromMetadata = getEntityTypeFromMetadata(sEntityType, !bIsParameterEntityType);
            var oEntityTypeFromAnnotation = getEntityTypeFromPropertyAnnotations(sEntityType, !bIsParameterEntityType);

            var oPropertyFromAnnotation;
            var oPropertyFromMetadata = getPropertyFromEntityTypeFromMetadata(oEntityTypeFromMetadata, sPropertyName);
            if (oPropertyFromMetadata && oPropertyFromMetadata.name) {
                oPropertyFromAnnotation = getPropertyFromEntityTypeFromAnnotation(oEntityTypeFromAnnotation, sPropertyName);
            } else {
                oEntityTypeFromMetadata = getEntityTypeFromMetadata(sAggregateEntityType, true);
                oPropertyFromMetadata = getPropertyFromEntityTypeFromMetadata(oEntityTypeFromMetadata, sPropertyName);
                oEntityTypeFromAnnotation = getEntityTypeFromPropertyAnnotations(sAggregateEntityType, true);
                oPropertyFromAnnotation = getPropertyFromEntityTypeFromAnnotation(oEntityTypeFromAnnotation, sPropertyName);
            }

            var oMerged = mergeAnnotationWithMetadata(oPropertyFromAnnotation, oPropertyFromMetadata);
            oHtPropertyMetadata.setItem(sEntityType + sPropertyName, defineApiResult(oMerged));
            return oHtPropertyMetadata.getItem(sEntityType + sPropertyName);
        }
    }

    //KS sEntityType either from parameter entity set or aggregate entity set
    function getEntityTypeFromAggregateEntitySet(sEntityType) {
        var entityType;
        for (var i = 0; i < oMetadata.dataServices.schema.length; i++) {
            for (var j = 0; j < oMetadata.dataServices.schema[i].entityType.length; j++) {
                entityType = oMetadata.dataServices.schema[i].entityType[j];
                if (entityType.name === sEntityType) {
                    if (entityType.navigationProperty && entityType.navigationProperty.length > 0) {
                        return findEntityTypeFromAssocation(entityType.navigationProperty[0].relationship, entityType.navigationProperty[0].toRole);
                    } else {
                        return sEntityType;
                    }
                }
            }
        }
        return sEntityType;
    }

    function findEntityTypeFromAssocation(relationship, toRole) {
        var association;
        var rel = relationship.split(".").pop();
        for (var i = 0; i < oMetadata.dataServices.schema.length; i++) {
            for (var j = 0; j < oMetadata.dataServices.schema[i].association.length; j++) {
                association = oMetadata.dataServices.schema[i].association[j];
                if (association.name === rel) {
                    for (var k = 0; k < association.end.length; k++) {
                        if (association.end[k].role === toRole) {
                            return association.end[k].type.split(".").pop();
                        }
                    }
                }
            }
        }
    }

    function getPropertyFromEntityTypeFromMetadata(oEntityTypeFromMetadata, sPropertyName) {
        for (var i = 0; i < oEntityTypeFromMetadata.property.length; i++) {
            if (oEntityTypeFromMetadata.property[i].name === sPropertyName) {
                return oEntityTypeFromMetadata.property[i];
            }
        }
        return {};
    }

    function getPropertyFromEntityTypeFromAnnotation(oEntityTypeFromAnnotation, sPropertyName) {
        for (var oProperty in oEntityTypeFromAnnotation) {
            if (oProperty === sPropertyName) {
                return oEntityTypeFromAnnotation[oProperty];
            }
        }
        return {};
    }

    function mergeAnnotationWithMetadata(oFirst, oSecond) {
        for (var i in oSecond) { // jshint ignore:line
            oFirst[i] = oSecond[i];
        }
        return oFirst;
    }


    function initMetadata() {

        var entitySet, entityType;
        var sAnnotationUri = oCoreApi.getUriGenerator().getODataPath(sAbsolutePathToServiceDocument) + "annotation.xml";
        var parameterSet = {loadMetadataAsync: false, annotationURI: sAnnotationUri, json: true};
        var oTmpMetadata, oTmpAnnotation;
        var sMessageCode;

        var odataModel = new ODataModel(sAbsolutePathToServiceDocument, parameterSet);

        oTmpMetadata = odataModel.getServiceMetadata();
        if (!oTmpMetadata) {
            sMessageCode = "5018";
            if (bDeactivateFatalError) {
                sMessageCode = "11013";
            }
            oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                code: sMessageCode,
                aParameters: [sAbsolutePathToServiceDocument],
                oCallingObject: that
            }));
            bInitFailed = true;
            return;
        }

        oTmpAnnotation = odataModel.getServiceAnnotations();
        if (!oTmpAnnotation) {
            oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                code: "5017",
                aParameters: [sAbsolutePathToServiceDocument],
                oCallingObject: that
            }));
        }

        oMetadata = jQuery.extend(true, {}, oTmpMetadata);
        oAnnotation = jQuery.extend(true, {}, oTmpAnnotation);

        oMetadata.dataServices.schema.forEach(function (schema) {
            schema.entityContainer.forEach(function (entityContainer) {
                if (entityContainer.entitySet) {
                    entityContainer.entitySet.forEach(function (entitySet) {
                        entityType = entitySet.entityType.split(/[. ]+/).pop();
                        oHtEntityTypeOfEntitySet.setItem(entitySet.name, entityType);
                    });
                }
            });
        });
    }

    // Public functions
    /**
     * @description Returns all metadata for the property of the provided entity type
     * @param {String} sEntitySet - identifier of the used OData entity set
     * @param {String} sPropertyName - identifier of the used OData property
     * @returns {Object} - metadata of the property
     */
    this.getPropertyMetadata = function (sEntitySet, sPropertyName) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getPropertyMetadata incorrect EntityType name or type");
        oInject.messageHandler.check(sPropertyName !== undefined && typeof sPropertyName === "string", "sap.apf.core.Metadata:getPropertyMetadata incorrect sPropertyName name or type");

        //noinspection JSLint
        var sEntityType = determineEntityTypeName(sEntitySet);
        if (!sEntityType) {
            return {};
        }

        //noinspection JSLint
        return getPropertyMetadataFromEntityType(sEntityType, sPropertyName);
    };

    this.patchEntitySetName = function (sEntitySet) {
        if (oHtEntityTypeOfEntitySet.hasItem(sEntitySet)) {
            return sEntitySet;

        }
        if (oHtEntityTypeOfEntitySet.hasItem(sEntitySet + "Results")) {
            return sEntitySet + "Results";
        }
        return undefined;
    };
    /**
     * @description Returns names of all filterable properties of the provided entity type.
     * @param {String} sEntitySet - identifier of the used OData entity type
     * @returns {Array} aResult - names of the filterable properties
     */
    this.getFilterableProperties = function (sEntitySet) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getFilterableProperties incorrect EntityType name or type");

        var sEntityType = determineEntityTypeName(sEntitySet);
        if (!sEntityType) {
            return [];
        }

        sEntityType = getEntityTypeFromAggregateEntitySet(sEntityType);
        return getFilterablePropertiesFromEntityType(sEntityType);

    };

    /**
     * @description Returns all properties (incl. parameters) for a given entity set provided the entitySet has an "extension".
     *      Extension means an annotation in the entityType of metadata.xml which is equal to "sap:semantics"="aggregate" or "sap:semantics"="parameter".
     *      When the entityType does not have this annotation then the result array is empty.
     * @param {String} sEntitySet - identifier of the used OData entity set
     * @returns {Array} aResult - property names
     */
    this.getAllPropertiesOfExtendedEntityType = function (sEntitySet) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getAllProperties incorrect EntityType name or type");

        var sEntityType = determineEntityTypeName(sEntitySet);
        if (!sEntityType) {
            return [];
        }
        return getAllPropertiesOfExtendedEntityType(sEntityType);
    };
    /**
     * @description Returns all aggregate properties for a given entity set.
     * @param {String} sEntitySet - identifier of the used OData entity set
     * @returns {String[]} array of aggregate property names
     */
    this.getAllAggregatePropertiesOfEntitySet = function (sEntitySet) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getAllProperties incorrect EntityType name or type");

        var sEntityType = determineEntityTypeName(sEntitySet);

        return getAllAggregatePropertiesOfEntityType(sEntityType);
    };


    /**
     * @description Returns names of all aggregate properties of all entity types.
     *            Return empty when the entity type does not contain an annotation "sap:semantics".
     * @returns {String[]} array of all aggregate property names
     */
    this.getAllAggregateProperties = function () {
        var aAllAggregateProperties = [];
        var aEntityTypes = getEntityTypes();

        aEntityTypes.forEach(function (entityType) {
            aAllAggregateProperties = aAllAggregateProperties.concat(getAllAggregatePropertiesOfEntityType(entityType));
        });
        aAllAggregateProperties = sap.apf.utils.eliminateDuplicatesInArray(oInject.messageHandler, aAllAggregateProperties);
        return aAllAggregateProperties;
    };

    /**
     * @description Returns names of all properties (incl. parameters) of all entity types.
     *            Return empty when the entity type does not contain an annotation "sap:semantics".
     * @returns {String[]} array of all property names
     */
    this.getAllProperties = function () {
        var aAllProperties = [];

        getEntityTypes().forEach(function (entityType) {
            aAllProperties = aAllProperties.concat(getAllPropertiesOfExtendedEntityType(entityType));
        });
        aAllProperties = sap.apf.utils.eliminateDuplicatesInArray(oInject.messageHandler, aAllProperties);

        return aAllProperties;
    };

    /**
     * @description Returns names of all parameter entity set key properties of all entity types.
     * @returns {Array} aResult - parameter names
     */
    this.getParameterEntitySetKeyPropertiesForService = function () {
        var aAllParameters = [];
        var aParameterEntitySetKeyProperties = [];

        getEntityTypes().forEach(function (entityType) {
            getParameterPropertiesFromEntityType(entityType, true).forEach(function (parameter) {
                aAllParameters.push(parameter.name);
            });
        });
        aAllParameters = sap.apf.utils.eliminateDuplicatesInArray(oInject.messageHandler, aAllParameters);

        return aAllParameters;
    };

    /**
     * @description Returns names of all key properties of all entity types.
     * @returns {Array} aResult - key names
     */
    this.getAllKeys = function () {
        var aAllKeys = [];
        var aKeys = [];

        getEntityTypes().forEach(function (entityType) {
            var oEntityType = getEntityTypeFromMetadata(entityType, true);
            if (!oEntityType.name) {
                oEntityType = getEntityTypeFromMetadata(entityType, false);
            }
            aKeys = [];
            if (oEntityType.key && oEntityType.key.propertyRef) {
            	oEntityType.key.propertyRef.forEach(function (propertyRef) {
                    aKeys.push(propertyRef.name);
                });
            }
            
            aAllKeys = aAllKeys.concat(aKeys);
        });
        aAllKeys = sap.apf.utils.eliminateDuplicatesInArray(oInject.messageHandler, aAllKeys);
        return aAllKeys;
    };


    /**
     * @description Returns all metadata attributes for a given property. It
     *              will be searched over all entity types for this property
     *              and the first match will be returned.
     * @param {String} sPropertyName
     *            sPropertyName - identifier of the used OData property
     * @returns {Object} - Object with attributes of the property
     */
    this.getAttributes = function (sPropertyName) {
        var aEntityTypes = getEntityTypes();
        var done = false;
        var oPropertyAttributes;
        getEntityTypes().forEach(function (entityType) {
            if (done) {
                return;
            }
            oPropertyAttributes = getPropertyMetadataFromEntityType(entityType, sPropertyName);
            if (oPropertyAttributes.name) {
                done = true;
            }
        });
        return oPropertyAttributes;
    };
    /**
     * @description Returns metadata which includes parameter entity set key properties and their attributes (data type, default value, ...) for the provided entity type.
     * @param {String} sEntitySet - identifier of the used OData entity type
     * @returns {Array} or {undefined} - parameters of the entity type
     */
    this.getParameterEntitySetKeyProperties = function (sEntitySet) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getParameterEntitySetKeyProperties incorrect EntityType name or type");
        var sEntityType = determineEntityTypeName(sEntitySet);

        if (!sEntityType) {
            return [];
        }
        return getParameterPropertiesFromEntityType(sEntityType, true);

    };


    /**
     * @description Returns metadata which includes extensions for OData 4.0 like "RequiresFilter"
     * @param {String} sEntitySet - identifier of the used OData entity type
     * @returns {Array} - metadata (including annotations) of the entity type
     */
    this.getEntityTypeMetadata = function (sEntitySet) {
        oInject.messageHandler.check(sEntitySet !== undefined && typeof sEntitySet === "string", "sap.apf.core.Metadata:getEntityTypeMetadata incorrect EntityType name or type");

        var sEntityType = determineEntityTypeName(sEntitySet);

        if (oHtEntityTypeMetadata.hasItem(sEntityType) === true) {
            return oHtEntityTypeMetadata.getItem(sEntityType);
        } else {
            checkInternalObjectStructure();
            var oEntityType = getEntityTypeFromAnnotation(sEntityType);


            var object = {};
            for (var oAnnotation in oEntityType) { // jshint ignore:line
                var sAnnotationName = oAnnotation.split(".").pop();
                sAnnotationName = sAnnotationName.replace(/^./, sAnnotationName[0].toLowerCase()); //!!!
                for (var shape in oEntityType[oAnnotation]) { // jshint ignore:line
                    object[sAnnotationName] = oEntityType[oAnnotation][shape];
                }
            }
            var sAggregatedEntityType = getEntityTypeFromAggregateEntitySet(sEntityType);
            if (sAggregatedEntityType !== sEntityType) {
                var oAggregatedEntityType = getEntityTypeFromAnnotation(sEntityType);
                for (var oAnnotation2 in oAggregatedEntityType) { // jshint ignore:line
                    var sAnnotationName2 = oAnnotation2.split(".").pop();
                    sAnnotationName2 = sAnnotationName2.replace(/^./, sAnnotationName2[0]);
                    for (var shape2 in oEntityType[oAnnotation2]) { // jshint ignore:line
                        object[sAnnotationName2] = oEntityType[oAnnotation2][shape2];
                    }
                }
            }

            oHtEntityTypeMetadata.setItem(sEntityType, object);
            return oHtEntityTypeMetadata.getItem(sEntityType);
        }
    };
    /**
     * @description Returns the suffix after the parameter position in the URI generation
     * @param {String} sEntitySet - entity set from analytical configuration
     * @returns {String} - parameter suffix for URI
     */
    this.getUriSuffix = function (sEntitySet) {
        var sEntityType = determineEntityTypeName(sEntitySet);
        var entityType;
        if (isParameterEntityType(sEntityType)) {
            for (var i = 0; i < oMetadata.dataServices.schema.length; i++) {
                for (var j = 0; j < oMetadata.dataServices.schema[i].entityType.length; j++) {
                    entityType = oMetadata.dataServices.schema[i].entityType[j];
                    if (entityType.name === sEntityType) {
                        if (entityType.navigationProperty && entityType.navigationProperty.length > 0) {
                            return entityType.navigationProperty[0].name;
                        } else {
                            return "";
                        }
                    }
                }
            }

        } else {
            return "";
        }
    };
    /**
     * @description Returns all entity sets of service documents
     * @returns {Array} - EntitySets Returns entity sets
     */
    this.getEntitySets = function () {
        var dependencies = {};
        var validEntitySets = [];
        oMetadata.dataServices.schema.forEach(function (schema) {
            schema.entityContainer.forEach(function (container) {
                if (container.associationSet) {
                    container.associationSet.forEach(function (association) {
                        dependencies[association.end[1].entitySet] = true;
                    });
                }
                if (container.entitySet) {
                    container.entitySet.forEach(function (entitySet) {
                        if (!dependencies[entitySet.name]) {
                            validEntitySets.push(entitySet.name);
                        }
                    });
                }
            });

        });

        return validEntitySets;
    };

    initMetadata();

    if (bInitFailed) {
        this.failed = true;
    }
}; 

}; // end of sap/apf/core/metadata.js
if ( !jQuery.sap.isDeclared('sap.apf.core.metadataFacade') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.metadataFacade");


/** 
 * @class Provides convenience functions for accessing metadata 
 * @param {Object} oInject - tbd
 * @param {String} sAbsolutePathToServiceDocument Absolute Path to service document
 * @returns {sap.apf.core.MetadataProperty}
 */
sap.apf.core.MetadataFacade = function(oInject, sAbsolutePathToServiceDocument) {
	/**
	 * @description Contains 'metadataFacade'
	 * @returns {String}
	 */
	this.type = "metadataFacade";
	// Private vars
	var fnMetadataProperty = oInject.metadataProperty;
	var oMessageHandler = oInject.messageHandler;
	var oMetadataFactory = oInject.metadataFactory;
	var aPropertyNames;
	var aParameterNames;
	var oProperties = {};
	
	// Public functions
	/**
	 * @description Returns all property names
	 * @param {Function} callback - callback function providing array of properties as strings
	 */
	this.getAllProperties = function(callback){
		if(aPropertyNames){
            callback(aPropertyNames);
        }else{
            var aMetadataServiceDocuments = getServiceDocuments();
            var oMetadata;
            aPropertyNames = [];
            for(var i = 0; i < aMetadataServiceDocuments.length; i++){
                oMetadata = oMetadataFactory.getMetadata(aMetadataServiceDocuments[i]);
                aPropertyNames = aPropertyNames.concat(oMetadata.getAllProperties());
            }
            aPropertyNames = sap.apf.utils.eliminateDuplicatesInArray(oMessageHandler, aPropertyNames);
            callback(aPropertyNames);
		}
	};
	/**
	 * @description Returns all properties which are paramenter key properties
	 * @param {Function} callback - callback function providing array of properties which are parameter entity set key properties as strings
	 */
	this.getAllParameterEntitySetKeyProperties = function(callback){
		if(aParameterNames){
            callback(aParameterNames);
        }else{
            var aMetadataServiceDocuments = getServiceDocuments();
            var oMetadata;
            aParameterNames = [];
            for(var i = 0; i < aMetadataServiceDocuments.length; i++){
                oMetadata = oMetadataFactory.getMetadata(aMetadataServiceDocuments[i]);
                aParameterNames = aParameterNames.concat(oMetadata.getParameterEntitySetKeyPropertiesForService());
            }
            aParameterNames = sap.apf.utils.eliminateDuplicatesInArray(oMessageHandler, aParameterNames);
            callback(aParameterNames);
		}
	};
	/**
	 * @description Returns a object of type {sap.apf.core.MetadataProperty} for
	 *              accessing attributes of a metadata property
	 * @param {String} sName - property name
	 * @param {Function} callback - callback function providing {sap.apf.core.MetadataProperty} object
	 */
	this.getProperty = function(sName, callback){
		if(oProperties[sName]){
            callback(oProperties[sName]);
        }else{
            var aMetadataServiceDocuments = getServiceDocuments();
            var oPropertyAttributes;
            var oMetadata;
            for(var i = 0; i < aMetadataServiceDocuments.length; i++){
                oMetadata = oMetadataFactory.getMetadata(aMetadataServiceDocuments[i]);
                oPropertyAttributes = oMetadata.getAttributes(sName);
                if(oPropertyAttributes.name){
                    //add attribute isHanaViewParameter
                    if(oMetadata.getParameterEntitySetKeyPropertiesForService().indexOf(sName) > -1){
                        //add attribute isKey
                        oPropertyAttributes.isParameterEntitySetKeyProperty = true;
                    }
                    if(oMetadata.getAllKeys().indexOf(sName) > -1){
                        //resolution of dataType
                        oPropertyAttributes.isKey = true;
                    }
                    break;
                }
            }

            for(var name in oPropertyAttributes){
                if(name === "dataType") {
                    for(var dataTypeName in oPropertyAttributes.dataType){
                        oPropertyAttributes[dataTypeName] = oPropertyAttributes.dataType[dataTypeName];
                    }
                }
            }

			var oMetadataProperty = new fnMetadataProperty(oPropertyAttributes);
            oProperties[sName] = oMetadataProperty;
            callback(oProperties[sName]);
		}
	};

    // Private functions
    function getServiceDocuments(){
        if(typeof sAbsolutePathToServiceDocument === "string"){
            return [sAbsolutePathToServiceDocument];
        }else{
            return oMetadataFactory.getServiceDocuments();
        }
    }
};
}; // end of sap/apf/core/metadataFacade.js
if ( !jQuery.sap.isDeclared('sap.apf.core.odataProxy') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.core.odataProxy");

jQuery.sap.require('sap.ui.thirdparty.datajs'); // unlisted dependency retained



(function() {
	'use strict';

	/**
	 * simplified interface to odata
	 * @private
	 * @constructor
	 * @param {object} serviceConfiguration Describes the service root  
	 * @param {object} inject Injected constructors, instances and functions
	 * @param {object} inject.instance Instances
	 * @param {object} inject.instance.messageHandler Message handler instance
	 * @param {object} inject.instance.coreApi CoreAPI instance
	 */
	sap.apf.core.OdataProxy = function(serviceConfiguration, inject) {
		/** @type sap.apf.core.Instance */
		var coreApi = inject.instance.coreApi;
		var messageHandler = inject.instance.messageHandler;
		var serviceRoot = serviceConfiguration.serviceRoot;
		var entitySet = "";

		function getMetadata(serviceRoot, entitySet) {
			return coreApi.getEntityTypeMetadata(serviceRoot, entitySet);
		}

		function formatValue(sProperty, value) {
			var strDelimiter = "'";

			var oEntityMetadata = getMetadata(serviceRoot, entitySet).getPropertyMetadata(sProperty);
			if (oEntityMetadata && oEntityMetadata.dataType) {
				return sap.apf.utils.formatValue(value, oEntityMetadata.dataType.type);
			}
			if (typeof value === 'number') {
				return value;
			}
			return strDelimiter + sap.apf.utils.escapeOdata(value) + strDelimiter;
		}
		;

		function addInputParametersToUrl(inputParameters) {
			var i, len, str;
			if (!inputParameters) {
				return "";
			}
			len = inputParameters.length;
			if (len === 1) {
				return "('" + inputParameters[0].value + "')";
			}
			str = "(";
			for(i = 0; i < len; i++) {
				if (i > 0) {
					str = str + ",";
				}
				str = str + inputParameters[i].name + "='" + inputParameters[i].value + "'";
			}
			return str + ")";
		}

		function createMessageObjectFromErrorResponse(oError) {
			var messageObject;

			if (oError.messageObject && oError.messageObject.getCode) {
				messageObject = oError.messageObject;
			} else if (oError.response && oError.response.statusCode && oError.response.statusCode >= 400) { //Bad HTTP request returned status code {0} with status text {1}
				messageObject = messageHandler.createMessageObject({
					code : '11005',
					aParameters : [ oError.response.statusCode.toString(), oError.response.statusText ]
				});
			} else {
				messageObject = messageHandler.createMessageObject({ //Unknown server error.
					code : '5201'
				});
			}
			messageHandler.putMessage(messageObject);
			return messageObject;
		}

		function errorOnRead(oError, callback) {
			var messageObject = createMessageObjectFromErrorResponse(oError);
			callback(undefined, undefined, messageObject);
		}

		function successOnRead(oData, serviceRoot, entitySet, callback) {
			var result;
			var messageObject;

			if (oData && oData.results) {
				result = oData.results;
			} else if (oData) {
				result = oData;
			} else {
				messageObject = messageHandler.createMessageObject({
					code : '5201'
				});
			}
			callback(result, getMetadata(serviceRoot, entitySet), messageObject);
		}

		/**
		 * odata get operation for specific single entity (application or configuration)
		 * @param {string} entitySet value from sap.apf.core.constants.entitySets
		 * @param {function} callback function of form fn(entityData, metadata, messageObject)
		 * @param {object[]} [inputParameters]
		 * @param {string[]} [selectList] holds all properties, that shall be in the select list
		 * @param {boolean} [async] Boolean value has to be set to false, if request should be send synchronously. Default value is true. 
		 */
		this.readEntity = function(entitySetName, callback, inputParameters, selectList, async) {
			var bAsync;
			var entitySet = sap.apf.core.constants.entitySets[entitySetName];

			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var url = serviceRoot + '/' + entitySet;

			url = url + addInputParametersToUrl(inputParameters);

			if (selectList && selectList.length > 0) {
				url = url + "?$select=" + selectList.join();
			}

			if (async === undefined) {
				bAsync = true;
			} else {
				bAsync = async;
			}

			var request = {
				requestUri : url,
				async : bAsync,
				method : "GET",
				headers : {
					"x-csrf-token" : xsrfToken
				}
			};

			coreApi.odataRequest(request, function(oData) {
				successOnRead(oData, serviceRoot, entitySet, callback);
			}, function(oError) {
				errorOnRead(oError, callback);
			});
		};

		function buildBatchRequests(requestConfigurations) {

			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var batchRequests = [];
			var i, len = requestConfigurations.length;
			var url, bSelectListSet, method, request;

			for(i = 0; i < len; i++) {
				bSelectListSet = false;
				entitySet = sap.apf.core.constants.entitySets[requestConfigurations[i].entitySetName];
				url = entitySet;
				url = url + addInputParametersToUrl(requestConfigurations[i].inputParameters);

				if (requestConfigurations[i].selectList && requestConfigurations[i].selectList.length > 0) {
					url = url + "?$select=" + requestConfigurations[i].selectList.join();
					bSelectListSet = true;
				}
				if (requestConfigurations[i].filter) {
					if (bSelectListSet) {
						url = url + '&';
					} else {
						url = url + '?';
					}
					url = url + '$filter=' + requestConfigurations[i].filter.toUrlParam({
						formatValue : formatValue
					});
				}

				method = requestConfigurations[i].method || 'GET';
				request = {
					requestUri : url,
					method : method,
					headers : {
						"Accept-Language" : sap.ui.getCore().getConfiguration().getLanguage(),
						"x-csrf-token" : xsrfToken
					}
				};
				if (method !== "GET") {
					request.data = requestConfigurations[i].data;
				}
				batchRequests.push(request);
			}
			return batchRequests;
		}
		;

		/**
		 * multiple change operations in batch
		 * @param {object[]} requestConfigurations with properties entitySetName, filter, selectList, inputParameters, method
		 * @param {function} callback with parameters undefined or messageObject in case of Error
		 */
		this.doChangeOperationsInBatch = function(requestConfigurations, callback) {
			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var batchRequests = buildBatchRequests(requestConfigurations);

			var batchRequest = {
				requestUri : serviceRoot + '/' + '$batch',
				method : "POST",
				headers : {
					"x-csrf-token" : xsrfToken
				},
				data : {
					__batchRequests : [ {
						__changeRequests : batchRequests
					} ]
				}
			};
			var fnSuccess = function(data, response) {

				var messageObject;
				var changeResponse;
				var url = "";
				var i, j;
				if (data && data.__batchResponses) {

					for(i = 0; i < data.__batchResponses.length; i++) {
						
						if (data.__batchResponses[i].message) {

							var message = data.__batchResponses[i].message;
							
							var httpStatusCode = "";
							url = response.requestUri;
							messageObject = messageHandler.createMessageObject({
								code : "5001",
								aParameters : [ httpStatusCode, message, "", url ]
							});
							break;
						}
						
						for(j = 0; j < data.__batchResponses[i].__changeResponses.length; j++) {

							changeResponse = data.__batchResponses[i].__changeResponses[j];

							if (changeResponse.message) {

								var message = changeResponse.message;
								var errorDetails = changeResponse.data;
								var httpStatusCode = changeResponse.statusCode;
								url = response.requestUri;
								messageObject = messageHandler.createMessageObject({
									code : "5001",
									aParameters : [ httpStatusCode, message, errorDetails, url ]
								});
								break;
							}

						}
					}
					callback(messageObject);
				}
			};
			var fnError = function(error) {
				var message = "unknown error";
				var errorDetails = "unknown error";
				var url = "";

				if (error.message !== undefined) {
					message = error.message;
				}
				var httpStatusCode = "unknown";
				if (error.response && error.response.statusCode) {
					httpStatusCode = error.response.statusCode;
					errorDetails = error.response.statusText || "";
					url = error.response.requestUri;
				}

				if (error.messageObject && error.messageObject.type === "messageObject") {
					callback(error.messageObject);
				} else {
					callback(messageHandler.createMessageObject({
						code : "5001",
						aParameters : [ httpStatusCode, message, errorDetails, url ]
					}));
				}

			};
			coreApi.odataRequest(batchRequest, fnSuccess, fnError, OData.batchHandler);
		};
		/**
		 * multiple reads in a batch operation
		 * @param {object[]} requestConfigurations with properties entitySetName, filter, selectList, inputParameters, method
		 * @param {function} callback with parameters data - array with results and messageObject
		 * @param {boolean} [async] Boolean value has to be set to false, if request should be send synchronously. Default value is true. 
		 */
		this.readCollectionsInBatch = function(requestConfigurations, callback, async) {
			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var batchRequests = buildBatchRequests(requestConfigurations);
			var bAsync;

			if (async === undefined) {
				bAsync = true;
			} else {
				bAsync = async;
			}

			var batchRequest = {
				requestUri : serviceRoot + '/' + '$batch',
				async : bAsync,
				method : "POST",
				headers : {
					"x-csrf-token" : xsrfToken
				},
				data : {
					__batchRequests : batchRequests
				}
			};

			var fnSuccess = function(data, response) {
				var response = [];
				var messageObject;
				var url = "";
				var i;
				if (data && data.__batchResponses) {

					for(i = 0; i < data.__batchResponses.length; i++) {
						if (data.__batchResponses[i].data && data.__batchResponses[i].data.results) {
							response.push(data.__batchResponses[i].data.results)
						} else if (data.__batchResponses[i].message) {
							var message = data.__batchResponses[i].message;
							var errorDetails = data.__batchResponses[i].response.body;
							var httpStatusCode = data.__batchResponses[i].response.statusCode;
							url = response.requestUri;
							messageObject = messageHandler.createMessageObject({
								code : "5001",
								aParameters : [ httpStatusCode, message, errorDetails, url ]
							});
							break;
						} else {
							url = response.requestUri;
							messageObject = messageHandler.createMessageObject({
								code : "5001",
								aParameters : [ "unknown", "unknown error", "unknown error", url ]
							});
							break;
						}
					}
					callback(response, messageObject);
				}
			};
			var fnError = function(error) {
				var message = "unknown error";
				var errorDetails = "unknown error";
				var url = "";

				if (error.message !== undefined) {
					message = error.message;
				}
				var httpStatusCode = "unknown";
				if (error.response && error.response.statusCode) {
					httpStatusCode = error.response.statusCode;
					errorDetails = error.response.statusText || "";
					url = error.response.requestUri;
				}

				if (error.messageObject && error.messageObject.type === "messageObject") {
					callback([], error.messageObject);
				} else {
					callback([], messageHandler.createMessageObject({
						code : "5001",
						aParameters : [ httpStatusCode, message, errorDetails, url ]
					}));
				}

			};
			coreApi.odataRequest(batchRequest, fnSuccess, fnError, OData.batchHandler);

		};
		/**
		 * odata get operation for specific type (application or configuration)
		 * @param {string} entitySetName value from sap.apf.core.constants.entitySets
		 * @param {function} callback function of form fn(result, metadata, messageObject)
		 * @param {object[]|undefined} [inputParameters]
		 * @param {string[]|undefined} [selectList] holds all properties, that shall be in the select list
		 * @param {sap.apf.core.utils.Filter} [filter] additional filter expressions
		 * @param {boolean} [async] Boolean value has to be set to false, if request should be send synchronously. Default value is true. 
		 */
		this.readCollection = function(entitySetName, callback, inputParameters, selectList, filter, async) {
			var bAsync;
			entitySet = sap.apf.core.constants.entitySets[entitySetName];
			var sQueryString = '';

			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var url = serviceRoot + '/' + entitySet;

			url = url + addInputParametersToUrl(inputParameters);

			if (selectList && selectList.length > 0) {
				sQueryString = "$select=" + selectList.join();
			}
			if (filter) {
			    if(sQueryString) {
			        sQueryString = sQueryString + '&';
			    }
			    sQueryString = sQueryString + '$filter=' + filter.toUrlParam({
					formatValue : formatValue
				});
			}
			if(entitySet === sap.apf.core.constants.entitySets.application) {
	             if(sQueryString) {
	                    sQueryString = sQueryString + '&';
                 }
	             sQueryString = sQueryString + '$orderby=ApplicationName';
			}
			if(sQueryString) {
			    url = url + '?' + sQueryString;
			}
			if (async === undefined) {
				bAsync = true;
			} else {
				bAsync = async;
			}
			var request = {
				requestUri : url,
				async : bAsync,
				method : "GET",
				headers : {
					"x-csrf-token" : xsrfToken
				}
			};
			coreApi.odataRequest(request, function(oData) {
				successOnRead(oData, serviceRoot, entitySet, callback);
			}, function(oError) {
				errorOnRead(oError, callback);
			});

		};
		/**
		 * odata post operation for specific type (application or configuration)
		 * @param {string} entitySetName value from sap.apf.core.constants.entitySets
		 * @param {object} applicationData object with properties of object, that shall be posted
		 * @param {function} callback function of form fn(result, metadata, messageObject)
		 */
		this.create = function(entitySetName, applicationData, callback, async) {
			var bAsync;
			entitySet = sap.apf.core.constants.entitySets[entitySetName];
			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var url = serviceRoot + '/' + entitySet;

			if (async === undefined) {
				bAsync = true;
			} else {
				bAsync = async;
			}
			var request = {
				requestUri : url,
				async : bAsync,
				method : "POST",
				headers : {
					"x-csrf-token" : xsrfToken
				},
				data : applicationData
			};

			function successOnCreate(oData, oResponse) {
				var result;
				var messageObject;

				if (oData && oResponse.statusText === "Created") {
					result = oData;
				} else {
					messageObject = messageHandler.createMessageObject({
						code : '5201'
					});
				}
				callback(result, getMetadata(serviceRoot, entitySet), messageObject);
			}

			function errorOnCreate(oError) {
				var messageObject = createMessageObjectFromErrorResponse(oError);
				callback(undefined, undefined, messageObject);
			}

			coreApi.odataRequest(request, successOnCreate, errorOnCreate);

		};

		/**
		 * odata put operation for specific type (application or configuration)
		 * @param {string} entitySetName value from sap.apf.core.constants.entitySets
		 * @param {object} applicationData object with properties of object, that shall be posted
		 * @param {function} callback function of form fn( metadata, messageObject)
		 * @param {object[]} [inputParameters]
		 */
		this.update = function(entitySetName, applicationData, callback, inputParameters) {
			entitySet = sap.apf.core.constants.entitySets[entitySetName];
			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var url = serviceRoot + '/' + entitySet + addInputParametersToUrl(inputParameters);
			var request = {
				requestUri : url,
				method : "PUT",
				headers : {
					"x-csrf-token" : xsrfToken
				},
				data : applicationData
			};

			//noinspection JSUnusedLocalSymbols
			function successOnUpdate(oData, oResponse) {
				var messageObject;

				if (oResponse.statusCode !== 204) {
					messageObject = messageHandler.createMessageObject({
						code : '5201'
					});
				}
				callback(getMetadata(serviceRoot, entitySet), messageObject);
			}

			function errorOnUpdate(oError) {
				var messageObject = createMessageObjectFromErrorResponse(oError);
				callback(undefined, messageObject);
			}

			coreApi.odataRequest(request, successOnUpdate, errorOnUpdate);

		};

		/**
		 * odata delete operation for specific type (application or configuration)
		 * @param {string} entitySetName value from sap.apf.core.constants.entitySets
		 * @param {object[]} [inputParameters]
		 * @param {function} callback function of form fn(metadata, messageObject)
		 * @param {sap.apf.core.utils.Filter} [filter] 
		 */
		this.remove = function(entitySetName, inputParameters, callback, filter) {
			entitySet = sap.apf.core.constants.entitySets[entitySetName];
			var xsrfToken = coreApi.getXsrfToken(serviceRoot);
			var url = serviceRoot + '/' + entitySet + addInputParametersToUrl(inputParameters);

			if (filter) {
				url = url + '$filter=' + filter.toUrlParam({
					formatValue : formatValue
				});
			}
			var request = {
				requestUri : url,
				method : "DELETE",
				headers : {
					"x-csrf-token" : xsrfToken
				}
			};

			//noinspection JSUnusedLocalSymbols
			function successOnDelete(oData, oResponse) {
				var messageObject;
				var metadata;

				if (oResponse.statusText === "No Content") {
					metadata = getMetadata(serviceRoot, entitySet);
				} else {
					messageObject = messageHandler.createMessageObject({
						code : '5201'
					});
				}
				callback(metadata, messageObject);
			}

			function errorOnDelete(oError) {
				var messageObject = createMessageObjectFromErrorResponse(oError);
				callback(undefined, messageObject);
			}

			coreApi.odataRequest(request, successOnDelete, errorOnDelete);

		};

	};
}());

}; // end of sap/apf/core/odataProxy.js
if ( !jQuery.sap.isDeclared('sap.apf.core.odataRequest') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/*global OData */

jQuery.sap.declare("sap.apf.core.odataRequest");
jQuery.sap.require('sap.ui.thirdparty.datajs'); // unlisted dependency retained



/**
 * @memberOf sap.apf.core
 * @description Wraps a OData request in order to handle a server time-out. It uses a POST $batch operation wrapping the GET.
 * @param {sap.apf.core.MessageHandler} oMessageHandler for error handling
 * @param {object} oRequest An Object that represents the HTTP request to be sent.
 * @param {function} fnSuccess A callback function called after the response was successfully received and parsed.
 * @param {function} fnError A callback function that is executed if the request fails. In case of time out the error object has property messageObject, that holds sap.apf.core.MessageObject.
 * @param {object} oBatchHandler A handler object for the request data.
 */
sap.apf.core.odataRequestWrapper = function(oMessageHandler, oRequest, fnSuccess, fnError, oBatchHandler) {
	function success(data, response) {
		var oMessage = sap.apf.core.utils.checkForTimeout(response);
		var oError = {};
		
		if(oMessage) {
			oError.messageObject = oMessage;
			fnError(oError);
		} else {
			fnSuccess(data, response);
		}
	}
	function error(oError) {
		var oMessage = sap.apf.core.utils.checkForTimeout(oError);

		if (oMessage) {
			oError.messageObject = oMessage;
		}
		fnError(oError);
	}
	OData.request(oRequest, success, error, oBatchHandler);
};

}; // end of sap/apf/core/odataRequest.js
if ( !jQuery.sap.isDeclared('sap.apf.core.textResourceHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap, OData */
jQuery.sap.declare("sap.apf.core.textResourceHandler");

jQuery.sap.require('jquery.sap.resources'); // unlisted dependency retained

(function() {
    'use strict';
/**
 * @class The text resource handler retrieves the texts from text bundles or
 *        property files. Text bundles which are not default loaded via apf, will
 *        be loaded on demand by the resource path handler.
 */
sap.apf.core.TextResourceHandler = function(oInject) {
	var that = this;
	var oMessageHandler = oInject.messageHandler;
	var oCoreApi = oInject.coreApi;
	var oHTBundles = new sap.apf.utils.Hashtable(oMessageHandler);
	var oHashedTextElements = new sap.apf.utils.Hashtable(oMessageHandler);
	/**
	 * @description retrieves the not encoded text by label object
	 * @param {object} oLabel - label object from configuration
	 * @param {string[]} [aParameters] - array with parameters to replace place holders in text bundle
	 * @returns {string}
	 */
	this.getTextNotHtmlEncoded = function(oLabel, aParameters) {
		if (typeof oLabel === "string") {
			return handleKeyOnlyKind(oLabel, aParameters);
		}
		oMessageHandler.check((oLabel !== undefined && oLabel.kind !== undefined), "Error - oLabel is not compatible");
		if (oLabel.kind === "text") {
			oMessageHandler.check((oLabel.key !== undefined), "Error - oLabel is not compatible");
			return handleTextKind(oLabel, aParameters);
		} 	
		// unknown type
		return "";
	};
	/**
	 * @description retrieves the encoded text by label object
	 * @param {object} oLabel - label object from configuration
     * @param {string[]} [aParameters] - Parameter for placeholder replacement in the message bundle
	 * @returns {string}
	 */
	this.getTextHtmlEncoded = function(oLabel, aParameters) {
		return jQuery.sap.encodeHTML(this.getTextNotHtmlEncoded(oLabel, aParameters));
	};
	/**
	 * @description returns a message text for message handling
	 * @param {string} sRessourceKey - Key of the message in the Ressourcefile
	 * @param {string[]} [aParameters] - Parameter for placeholder replacement in the message bundle
	 * @returns {string}
	 */
	this.getMessageText = function(sRessourceKey, aParameters) {
		var sText;
		loadTextBundles(sap.apf.core.constants.resourceLocation.apfUiTextBundle, sap.apf.core.constants.resourceLocation.applicationMessageTextBundle);
		if (oHTBundles.hasItem(sap.apf.core.constants.resourceLocation.applicationMessageTextBundle)) {
			sText = oHTBundles.getItem(sap.apf.core.constants.resourceLocation.applicationMessageTextBundle).getText(sRessourceKey, aParameters);
			if (sText !== sRessourceKey) {
				return sText;
			}
		}
		return oHTBundles.getItem(sap.apf.core.constants.resourceLocation.apfUiTextBundle).getText(sRessourceKey, aParameters);
	};
	
	/**
	 * @description called from ressource path handler to load the application texts, that come from the data base
	 * @param {textElements[]} array with text elements
	 */
	this.loadTextElements = function(textElements) {
		var i, len;
		
		len = textElements.length;
		for (i = 0; i < len; i++) {
			oHashedTextElements.setItem(textElements[i].TextElement, textElements[i].TextElementDescription);
		}
	};
	// Private Functions 
	function loadTextBundles(oApfBundle, oApplicationBundle) {
		var sUrl;
		if (oHTBundles.hasItem(oApfBundle) === false) {
			sUrl = oCoreApi.getResourceLocation(oApfBundle);
			addCustomTextResource(oApfBundle, sUrl);
		}
		sUrl = oCoreApi.getResourceLocation(oApplicationBundle);
		if (sUrl !== "" && oHTBundles.hasItem(oApplicationBundle) === false) {
			addCustomTextResource(oApplicationBundle, sUrl);
		}
	}
	function handleTextKind(oLabel, aParameters) {

		if (oLabel.key === sap.apf.core.constants.textKeyForInitialText) {
			return "";
		}
		loadTextBundles(sap.apf.core.constants.resourceLocation.apfUiTextBundle, sap.apf.core.constants.resourceLocation.applicationUiTextBundle);
		// first look in textbundle from application (applicationUiTextBundle), otherwise fallback is used (apfUiTextBundle)
		if (bKeyInTextBundle(oLabel.key, sap.apf.core.constants.resourceLocation.applicationUiTextBundle)) {
			return oHTBundles.getItem(sap.apf.core.constants.resourceLocation.applicationUiTextBundle).getText(oLabel.key, aParameters);
		} else if (bKeyInTextBundle(oLabel.key, sap.apf.core.constants.resourceLocation.apfUiTextBundle)) {
			return oHTBundles.getItem(sap.apf.core.constants.resourceLocation.apfUiTextBundle).getText(oLabel.key, aParameters);
		} else if (oHashedTextElements.hasItem(oLabel.key)) {
			return oHashedTextElements.getItem(oLabel.key);
		}
		oMessageHandler.putMessage(oMessageHandler.createMessageObject({
			code : "3001",
			aParameters : [ oLabel.key ],
			oCallingObject : that
		}));
		return "# text not available: " + oLabel.key;
	}
	function handleKeyOnlyKind(key, aParameters) {
		
		if (key === sap.apf.core.constants.textKeyForInitialText) {
			return "";
		}
		loadTextBundles(sap.apf.core.constants.resourceLocation.apfUiTextBundle, sap.apf.core.constants.resourceLocation.applicationUiTextBundle);
		// first look in textbundle from application (applicationUiTextBundle), otherwise fallback is used (apfUiTextBundle)
		if (bKeyInTextBundle(key, sap.apf.core.constants.resourceLocation.applicationUiTextBundle)) {
			return oHTBundles.getItem(sap.apf.core.constants.resourceLocation.applicationUiTextBundle).getText(key, aParameters);
		} else if (bKeyInTextBundle(key, sap.apf.core.constants.resourceLocation.apfUiTextBundle)) {
			return oHTBundles.getItem(sap.apf.core.constants.resourceLocation.apfUiTextBundle).getText(key, aParameters);
		} else if (oHashedTextElements.hasItem(key)) {
			return oHashedTextElements.getItem(key);
		}
		oMessageHandler.putMessage(oMessageHandler.createMessageObject({
			code : "3001",
			aParameters : [ key ],
			oCallingObject : this
		}));
		return "# text not available: " + key;
	}
		  
	function bKeyInTextBundle(key, sTextBundle) {
		var oTextBundle = oHTBundles.getItem(sTextBundle);
		var i;
		var text;
		
		if (oTextBundle) {
		  text = oTextBundle.getText(key); // start reload next text bundle if necessary
		}
		if (oTextBundle && oTextBundle.aPropertyFiles && oTextBundle.aPropertyFiles.length > 0 && oTextBundle.aPropertyFiles[0].aKeys instanceof Array) {
			for(i = 0; i < oTextBundle.aPropertyFiles.length; i++) {

				if (jQuery.inArray(key, oTextBundle.aPropertyFiles[i].aKeys) >= 0) {
					return true;
				} 
			}
		}
		return false;
	}
	function addCustomTextResource(sKey, sUrl) {
		var oBundle = jQuery.sap.resources({
			url : sUrl,
			includeInfo : sap.ui.getCore().getConfiguration().getOriginInfo()
		});
		// remember the bundle under the given Key
		oHTBundles.setItem(sKey, oBundle);
	}
};
}());

}; // end of sap/apf/core/textResourceHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.core.utils.filterTerm') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare('sap.apf.core.utils.filterTerm');


/**
 * @private
 * @class This class implements a simple term in a filter in the form (property,
 *        operator, value). It is used by sap.apf.core.utils.Filter.
 * @param {sap.apf.core.MessageHandler} oMsgHandler
 * @param {string} sProperty This is the property of the term. Property is property
 *            in wording of oData and corresponds to a field name of an xs odata
 *            view, if apf runs against hana or gateway
 * @param {string} sOperator is the operator. Operator must be a value of
 *            {sap.apf.core.constants.FilterOperators}.
 * @param {string|number|boolean|Date} value Some constant value like 1000 or 'Jan'.
 * @param {string|number|boolean|Date} highvalue required, if operator is BT.
 * @returns {sap.apf.core.utils.FilterTerm}
 */
sap.apf.core.utils.FilterTerm = function (oMsgHandler, sProperty, sOperator, value, highvalue) {
    this.type = "filterTerm";
    var op = sOperator;
    var val = value; // value can be string or number

    if (op.length == 2) {
        op = op.toUpperCase();
    }
    // do some checks
    oMsgHandler.check((op !== undefined),
        "sap.apf.utils.FilterTerm.constructor op undefined");

    oMsgHandler.check(
        (jQuery.inArray(op, sap.apf.core.constants.aSelectOpt) > -1),
            "sap.apf.core.utils.FilterTerm op " + op + " not supported");
    oMsgHandler.check((sProperty !== undefined),
        "sap.apf.utils.core.FilterTerm sProperty undefined");
    oMsgHandler.check((val !== undefined),
        "sap.apf.utils.FilterTerm value undefined");

    /**
     * @description Boolean test, whether parameter val is contained in the
     *              filter term for property. This is a helper function of the
     *              contains method.
     * @param {string} property The property of the value.
     * @param {string|number|boolean|Date} val Value, that shall be contained.
     * @returns {boolean} bContained Returns true, if the value is contained,
     *          otherwise false. If the property differs, then true is returned,
     *          because the filter term holds no restriction on the property.
     */
    var containsSingleValue = function (property, val) {
        var v, len;

        if (property !== sProperty) {
            return true;
        }
        if (op === sap.apf.core.constants.FilterOperators.EQ) {
            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() === val.valueOf()); 
            }
            return (value === val);
        } else if (op === sap.apf.core.constants.FilterOperators.LT) {
           
            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() > val.valueOf()); 
            }
            return (value > val);
        } else if (op === sap.apf.core.constants.FilterOperators.LE) {
            
            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() >= val.valueOf()); 
            }
            return (value >= val);
        } else if (op === sap.apf.core.constants.FilterOperators.GT) {

            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() < val.valueOf()); 
            }
            return (value < val);
        } else if (op === sap.apf.core.constants.FilterOperators.BT) {
            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() <= val.valueOf() && val.valueOf() <= highvalue.valueOf());
            }
            return (value <= val && val <= highvalue);
            
        } else if (op === sap.apf.core.constants.FilterOperators.GE) {
            if (value instanceof Date && val instanceof Date) {
                return (value.valueOf() <= val.valueOf());
            }
            return (value <= val);
        } else if (op === sap.apf.core.constants.FilterOperators.NE) {
            if (value instanceof Date && val instanceof Date) {
                return !(value.valueOf() === val.valueOf());
            }
            return !(value === val);
        } else if (op === sap.apf.core.constants.FilterOperators.StartsWith) {
            len = value.length;
            if (len > val.length) {
                return false;
            }
            v = val.slice(0, len);
            return (v === value);
            
        } else if (op === sap.apf.core.constants.FilterOperators.EndsWith) {
            len = value.length;
            if (len > val.length) {
                return false;
            }
            v = val.slice(-len);
            return (v === value);

        } else if (op === sap.apf.core.constants.FilterOperators.Contains) {
            var index = val.indexOf(value);
            return (index > -1);
        }
    };
    /**
     * @description The method checks, whether value is contained in the logical
     *              expression for given property.
     * @param {string|string[]} property The property is either a single property or an array
     *            of properties.
     * @param {string|number|boolean|Date} val The value is either a single value or an array in json
     *            format with property : value pairs.
     */
    this.contains = function (property, val) {
        var i = 0;
        if (property instanceof Array) {
            for (i = 0; i < property.length; i++) {
                if (property[i] === sProperty) {
                    return containsSingleValue(property[i], val[property[i]]);
                }
            }
            return true; // not restricted to property
        } else {
            return containsSingleValue(property, val);
        }
    };

    /**
     * @description Transforms the object into a string, that can be used in the
     *              filter part of an odata request.
     * @param {object} conf Configuration for returning the result.
     * @param {boolean} [conf.asFilterArray] If an array with single lines for each
     *            property has to be returned.
     * @param conf.formatValue callback function for correct rendering of the value. The callback function is called with
     * property and value.
     */
    this.toUrlParam = function (conf) {
        var strDelimiter = "'";
        var spaceCharacter = " ";
        var param = "";
        var aParam = [];
        var value, hvalue;


        if (conf && conf.formatValue) {
            value = conf.formatValue(sProperty, val);
            if (highvalue) {
                hvalue = conf.formatValue(sProperty, highvalue);
            }
        } else {

            if (typeof val === 'number') {
                value = val;
            } else {
                value = strDelimiter + sap.apf.utils.escapeOdata(val) + strDelimiter;
            }
            if (highvalue) {
                if (typeof val === 'number') {
                    hvalue = highvalue;
                } else {
                    hvalue = strDelimiter + sap.apf.utils.escapeOdata(highvalue) + strDelimiter;
                }
            }
        }
        if (op === sap.apf.core.constants.FilterOperators.StartsWith) {
            param = 'startswith(' + sap.apf.utils.escapeOdata(sProperty) + ',' + value + ')';
            param = jQuery.sap.encodeURL(param);
        } else if (op === sap.apf.core.constants.FilterOperators.EndsWith) {
            param = 'endswith(' + sap.apf.utils.escapeOdata(sProperty) + ',' + value + ')';
            param = jQuery.sap.encodeURL(param);
        } else if (op === sap.apf.core.constants.FilterOperators.Contains) {
            // substringof is odata 2.0, and contains will be odata 4.0
            param = 'substringof(' + value + ','
                + sap.apf.utils.escapeOdata(sProperty) + ')';
            param = jQuery.sap.encodeURL(param);
        } else if (op === sap.apf.core.constants.FilterOperators.BT) {
            param = '(('
                + jQuery.sap.encodeURL(sap.apf.utils.escapeOdata(sProperty)
                    + spaceCharacter + "ge" + spaceCharacter + value)
                + ')'
                + jQuery.sap.encodeURL(spaceCharacter + 'and'
                    + spaceCharacter)
                + '('
                + jQuery.sap.encodeURL(sap.apf.utils.escapeOdata(sProperty)
                    + spaceCharacter + "le" + spaceCharacter + hvalue)
                + '))';
        } else {
            param = '('
                + jQuery.sap.encodeURL(sap.apf.utils.escapeOdata(sProperty)
                    + spaceCharacter + op.toLowerCase()
                    + spaceCharacter + value) + ')';
        }
        if (conf && conf.asFilterArray === true) {
            aParam.push(param);
            return aParam;
        } 
        return param;
        
    };
    /**
     * @description Returns the property.
     * @returns {string} property
     */
    this.getProperty = function () {
        return sProperty;
    };
    /**
     * @description Returns the operator.
     * @returns {string} op
     */
    this.getOp = function () {
        return op;
    };

    /**
     * @description Returns the value.
     * @returns {string|number|boolean} value
     */
    this.getValue = function () {
        return val;
    };

    /**
     * @description Returns the high value (.
     * @returns {string|number|boolean} value
     */
    this.getHighValue = function () {
        return highvalue;
    };
    /**
     * @description Returns the hash value of the filter term. The hash value is
     *              needed for simple comparison. The hash uniquely identifies a
     *              filter term.
     * @returns {number} hash value - Hash as int32
     */
    this.getHash = function () {
        var sString = sProperty + op + val;
        return sap.apf.utils.hashCode(sString);
    };

    /**
     * @description Copy constructor.
     * @returns {sap.apf.core.utils.FilterTerm} Fiterterm
     */
    this.copy = function () {
        return new sap.apf.core.utils.FilterTerm(oMsgHandler, sProperty, op,
            val, highvalue);
    };

    /**
     * @description This function either returns undefined, if the filter term
     *              is defined for the property or a copy of itself, if not.
     * @param {string|string[]} property This is either a property or an array of properties.
     *            If it is an array, then the test is done against each of the
     *            properties.
     * @returns {undefined|sap.apf.core.utils.FilterTerm} oFilterTerm Returns
     *          filter term or undefined, if the property equals the property of
     *          the filter term.
     */
    this.removeTermsByProperty = function (property) {
        var i = 0;
        var len = 0;
        if (property instanceof Array) {
            len = property.length;
            for (i = 0; i < len; i++) {
                if (sProperty === property[i]) {
                    return undefined;
                }
            }
            // not found - return copy
            return this.copy();
        } else {
            if (sProperty === property) {
                return undefined;
            } 
            return this.copy();
        }
    };

    /**
     * @description This function either returns undefined, if the filter term
     *              is defined for the property or a copy of itself, if not.
     * @param {string|string[]} property This is either a property or an array of properties.
     *            If it is an array, then the test is done against each of the
     *            properties.
     * @param {string} option option
     * @param {boolean|number|string} value Value of the expression.
     * @returns {sap.apf.core.utils.FilterTerm|undefined} oFilterTerm The filter
     *          term or undefined is returned, if the property equals the
     *          property of the filter term.
     */
    this.removeTerms = function (property, option, value) {
        var i = 0;
        var len = 0;
        if (property instanceof Array) {
            len = property.length;
            for (i = 0; i < len; i++) {
                if (sProperty === property[i] && op === option && val === value) {
                    return undefined;
                }
            }
            // not found - return copy
            return this.copy();
        } else {

            if (sProperty === property && op === option && val === value) {
                return undefined;
            }
            return this.copy();
        }
    };

    /**
     * @description changes the property name to target property name, if
     *              property name = source property,
     * @param {object} aMapping the mapping directive has the form { source :
	 *            'sourceProp', target : 'targetProp' }
     * @returns undefined
     */
    this.mapProperties = function (aMapping) {

        var i;
        for (i = 0; i < aMapping.length; i++) {
            if (sProperty === aMapping[i].source) {
                sProperty = aMapping[i].target;
                return undefined;
            }
        }
        return undefined;
    };
    
    /**
     * @description map the filter term to a JSON like selection object for OpenIn
     * @returns {object}
     */
    this.mapToSelectionVariant = function() {
    	if(op === sap.apf.core.constants.FilterOperators.BT) {
    		return { option : op, low : val, high : highvalue };	
    	}
    	return { option : op, low : val, high : null };
    };
    /*
     * returns an object, that is similar to constructor for sap ui5 filter
     */
    this.mapToSapUI5FilterExpression = function() {
    	if(op === sap.apf.core.constants.FilterOperators.BT) {
    	return { path : sProperty, operator : op, value1 : val, value2: highvalue};
    	}
    	return { path : sProperty, operator : op, value1 : val};
    };
};

}; // end of sap/apf/core/utils/filterTerm.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.applicationHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.applicationHandler");


(function () {
    'use strict';

    /**
     * @private
     * @class Application Handler manages the applications of the APF Configuration Modeler  
     * @param {object} inject Injection of required APF objects
     * @param {object} inject.instance Injection of required instances
     * @param {object} inject.instance.persistenceProxy Instance of the persistenceProxy - provides necessary CRUD functionality
     * @param {object} inject.instance.messageHandler Instance of the MessageHandler
     * @param {object} inject.constructor Injection of required constructors
     * @param {object} inject.constructor.hashtable  Injection of hashtable constructor      * 
     * @param {function} initCallback Function is called after initialization 
     */
    sap.apf.modeler.core.ApplicationHandler = function (inject, initCallback) {
    	
    	var that = this;
    	var persistenceProxy = inject.instance.persistenceProxy;
    	var messageHandler = inject.instance.messageHandler;
    	var Hashtable = inject.constructor.hashtable;
    	var applicationList;
    	
    	this.type = "application";
    	
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.applicationHandler#setAndSave
         * @description Saves or modifies an application on database
         * 
         * @param {object} appObject Application to be saved/modified
         * @param {string} appObject.ApplicationName Name of application
         * @param {string} appObject.SemanticObject Semantic object of application
         * 
         * @param {function(response, metadata, messageObject)} callback Callback returns after create/update operation has been executed
         * @param {string} callback.response ID of the saved/modified application
         * @param {string} callback.metadata Metadata
         * @param {sap.apf.core.MessageObject} callback.messageObject Identifier of corrupt process flow
         * 
         * @param {string} [id] Modifies the application identified by the ID with the committed application
         * @param {boolean} [isImport] If true, id is used for creating a new application with an external id
         */
    	this.setAndSave = function(appObject, callback, id, isImport){
    		if(typeof appObject === "object" && typeof callback === "function" && typeof id === "string" && !isImport){ //update
    			var callbackUpdate = function(metadata, messageObject) {
    				if(messageObject) {
    					callback(undefined, metadata, messageObject);
    				} else {
    					applicationList.setItem(appObject.Application, appObject);
    					callback(appObject.Application, metadata, messageObject);
    				}
    			};
    			if(!appObject.SemanticObject) {
    				appObject.SemanticObject = "";
    			}
    			appObject.Application = id;
                persistenceProxy.update(this.type, appObject, callbackUpdate, [ {name : "Application", value : id }]);
            }else if(typeof appObject === "object" && typeof callback === "function"){ //create
    			var callbackCreate = function(response, metadata, messageObject) {
    				if(messageObject) {
    					callback(response, metadata, messageObject);
    				} else {
    					applicationList.setItem(response.Application, {
                			Application : response.Application,
                			ApplicationName : response.ApplicationName,
                			SemanticObject : response.SemanticObject
        				});
    					callback(response.Application, metadata, messageObject);
    				}
    			};
    			if(!appObject.SemanticObject) {
    				appObject.SemanticObject = "";
    			}
                if(isImport && id){
                    appObject.Application = id;
                }else{
                    appObject.Application = "";
                }
            	persistenceProxy.create(this.type, appObject, callbackCreate);
    		}
    	};
    	
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.applicationHandler#removeApplication
         * @description Removes an application from the database
         * 
         * @param {function(response, metadata, messageObject)} callback Callback returns after remove operation has been executed
         * @param {string} id applicationId
         * @param {string} callback.response ID of application to be removed
         * @param {string} callback.metadata Metadata
         * @param {sap.apf.core.MessageObject} callback.messageObject Identifier of corrupt process flow
         */
    	this.removeApplication = function(id, callback) {
    		var callbackRemove = function(metadata, messageObject) {
    			if(!messageObject) {
    				applicationList.removeItem(id);
    			}
    			inject.functions.resetConfigurationHandler(id);
    			callback(id, metadata, messageObject);
    		};
    		persistenceProxy.remove(this.type, [ {name : "Application", value : id }], callbackRemove);
    	};
    	
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.applicationHandler#getList
         * @description Returns list of all applications
         * @returns {Array.<Object>} Array of all applications
         */
        this.getList = function() {
        	var applicationArray = [];
        	var addAppsToArray = function(key, item) {
        		applicationArray.push(item);
        	};
        	applicationList.forEachOrdered(addAppsToArray);
        	
        	return applicationArray;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.applicationHandler#getApplication
         * @description Returns the requested application based on the ID
         * @param {string} [id] ID of application
         * @returns {object} Application
         */
        this.getApplication = function(id) {
        	return applicationList.getItem(id);
        };
        
        function initialize() {
        	applicationList = new Hashtable(messageHandler);
        	var callbackRead = function(response, metadata, messageObject) {
        		if(response instanceof Array && messageObject === undefined) {
        			response.forEach( function(object) {
        				applicationList.setItem(object.Application,{
                			Application : object.Application,
                			ApplicationName : object.ApplicationName,
                			SemanticObject : object.SemanticObject
        				});
        			});
        		}
        		initCallback(that, messageObject);
        	};
        	persistenceProxy.readCollection(that.type, callbackRead);
        }
        
        initialize();
        
    };
}());
}; // end of sap/apf/modeler/core/applicationHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.configurationEditor') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.configurationEditor");


(function () {
    'use strict';

    /**
     * @private
     * @name sap.apf.modeler.core.ConfigurationEditor
     * @class Configuration Editor manages the different configuration objects like categories, steps etc.
     * @param {String} configuration - ConfigurationEditor configuration guid
     * @param {Object} inject - Injection of required APF objects
     * @param {Object} inject.instance - Injected instances
     * @param {sap.apf.core.utils.MessageHandler} inject.instance.messageHandler - MessageHandler instance
     * @param {sap.apf.modeler.core.OdataProxy} inject.instance.persistenceProxy - PersistenceProxy instance
     * @param {sap.apf.modeler.core.ConfigurationHandler} inject.instance.configurationHandler - ConfigurationHandler instance
     * @param {sap.apf.modeler.core.TextPool} inject.instance.textPool - TextPool instance
     * @param {sap.apf.modeler.core.Instance} inject.instance.coreApi - Modeler core instance
     * @param {sap.ui.thirdparty.datajs} inject.instance.datajs
     * @param {Object} inject.constructor - Injected constructors
     * @param {sap.apf.core.utils.Hashtable} inject.constructor.hashtable - Hashtable constructor
     * @param {sap.apf.modeler.core.ConfigurationObjects} inject.constructor.configurationObjects
     * @param {sap.apf.modeler.core.Step} inject.constructor.step
     * @param {sap.apf.modeler.core.Representation} inject.constructor.representation
     * @param {sap.apf.modeler.core.ElementContainer} inject.constructor.elementContainer
     * @param {sap.apf.modeler.core.RegistryWrapper} inject.constructor.registryProbe
     * @param {sap.apf.core.ConfigurationFactory} inject.constructor.configurationFactory
     * @param {sap.apf.core.Metadata} inject.constructor.metadata
     * @param {sap.apf.core.EntityTypeMetadata} inject.constructor.entityTypeMetadata
     * @param {sap.apf.core.MetadataFacade} inject.constructor.metadataFacade
     * @param {sap.apf.core.MetadataProperty} inject.constructor.metadataProperty
     * @param {sap.apf.core.MetadataFactory} inject.constructor.configurationFactory
     * @param {Function} callbackAfterLoad - Callback called after load from server with signature callbackAfterLoad(instance, messageObject)
     * @param {Object} dataFromCopy - Optional parameter to set the internal state of the new instance during a copy operation
     * @constructor
     */
    sap.apf.modeler.core.ConfigurationEditor = function (configuration, inject, callbackAfterLoad, dataFromCopy) {
        var that = this;
        var applicationTitle;
        var configurationName;
        var configurationHandler = inject.instance.configurationHandler;
        var persistenceProxy = inject.instance.persistenceProxy;
        var messageHandler = inject.instance.messageHandler;
        var metadataFactory = inject.instance.metadataFactory;
        var isSaved = true;
        var stepContainer,
            categoryContainer,
            facetFilterContainer,
            navigationTargetContainer,
            categoryStepAssignmentContainer,
            serviceList;
        var configurationObjects = new inject.constructor.configurationObjects(inject);
    
        var configurationFactory = new inject.constructor.configurationFactory({
        	messageHandler : messageHandler,
        	constructor : {
        		registryProbe : inject.constructor.registryProbe
        	}
        });
        if(!dataFromCopy){
        	stepContainer        = new inject.constructor.elementContainer("Step", inject.constructor.step, inject);
            categoryContainer    = new inject.constructor.elementContainer("Category", undefined, inject);
            facetFilterContainer = new inject.constructor.elementContainer("FacetFilter", inject.constructor.facetFilter, inject);
            navigationTargetContainer = new inject.constructor.elementContainer("NavigationTarget", inject.constructor.navigationTarget, inject);
            categoryStepAssignmentContainer = new inject.constructor.elementContainer("CategoryStepAssignment", inject.constructor.elementContainer, inject);
            serviceList          = [];
        }else{
        	stepContainer        			= dataFromCopy.stepContainer;
            categoryContainer    			= dataFromCopy.categoryContainer;
            facetFilterContainer 			= dataFromCopy.facetFilterContainer;
            navigationTargetContainer       = dataFromCopy.navigationTargetContainer;
            categoryStepAssignmentContainer = dataFromCopy.categoryStepAssignmentContainer;
            serviceList          			= dataFromCopy.serviceList;	
        }
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#registerService
         * @description Registers service for value help collection. Message will be thrown in case of invalid service.
         * @param {String} serviceRoot
         * @returns {Boolean} isServiceRegistered - Returns true if service is registered successfully
         */
        this.registerService = function(serviceRoot) {
        	var isServiceRegistered = false;
        	if(serviceList.indexOf(serviceRoot) === -1) {
        		if(metadataFactory.getMetadata(serviceRoot)) {
        			serviceList.push(serviceRoot);
        			isServiceRegistered = true;
        		}
        	} else {
        		isServiceRegistered = true;
        	}
        	return isServiceRegistered;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getAllServices
         * @description Returns all successfully registered services.
         * @returns {Object[]} serviceList
         */
        this.getAllServices = function() {
        	return serviceList;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getAllEntitySetsOfService
         * @description Returns all entity sets of service.
         * @param {String} serviceRoot 
         * @returns {Object[]} entitySets
         */
        this.getAllEntitySetsOfService = function(serviceRoot) {
        	var entitySets = [];
        	if(serviceList.indexOf(serviceRoot) > -1) {
        		entitySets = metadataFactory.getEntitySets(serviceRoot);
        	}
        	return entitySets;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getAllEntitySetsOfServiceWithGivenProperties
         * @description Returns all entity sets of service that have the given set of properties as filterable properties.
         * @param {String} serviceRoot 
         * @param {Array} properties
         * @returns {Object[]} entitySets
         */
        this.getAllEntitySetsOfServiceWithGivenProperties = function(serviceRoot, properties) {
        	var result = [],
        	    metadata;
        	
        	var entitySets = this.getAllEntitySetsOfService(serviceRoot);
        	if(!properties || properties.length === 0){
        		return entitySets;
        	}
        	
        	metadata = metadataFactory.getMetadata(serviceRoot);
        	
        	entitySets.forEach(function(entitySet){
        		var filterableProperties = metadata.getFilterableProperties(entitySet);
        		var hasAllProperties = true;
        		for(var i = 0; i < properties.length; i++){
        			if( filterableProperties.indexOf( properties[i]) <= -1 ){
        				hasAllProperties = false;
        				break;
        			}
        		}
        		if(hasAllProperties){
        			result.push(entitySet);
        		}
        	});
      
        	return result;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getAllPropertiesOfEntitySet
         * @description Returns all properties of an entity set provided the entitySet has an "extension".
         *      Extension means an annotation in the entityType of metadata.xml equak to "sap:semantics"="aggregate" or "sap:semantics"="parameter".
         *      When the entityType does not have this annotation then the result array is empty.
         * @param {String} serviceRoot 
         * @param {String} entitySet 
         * @returns {Object[]} entitySetProperties
         */
        this.getAllPropertiesOfEntitySet = function(serviceRoot, entitySet) {
        	var entitySetProperties = [];
        	if(serviceList.indexOf(serviceRoot) > -1) {
        		entitySetProperties = metadataFactory.getMetadata(serviceRoot).getAllAggregatePropertiesOfEntitySet(entitySet);
        	}
        	return entitySetProperties;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getAllKnownProperties
         * @description Returns all known properties of registered services including parameter entity set key properties. 
         * @returns {Object[]} allKnownProperties
         */
        this.getAllKnownProperties = function() {
        	var allKnownProperties = [];
        	var metadata;
        	serviceList.forEach(function(serviceRoots) {
        		metadata = metadataFactory.getMetadata(serviceRoots);
        		allKnownProperties = allKnownProperties.concat(metadata.getAllProperties());
			});
        	allKnownProperties = sap.apf.utils.eliminateDuplicatesInArray(messageHandler, allKnownProperties);
        	return allKnownProperties;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#setApplicationTitle
         * @description Set application title of analytical configuration.
         * @param {String} textKey Text key for application title
         */
        this.setApplicationTitle = function(textKey) {
            isSaved = false;
        	applicationTitle = textKey;
        };
        /**
         * @private
         * @function
         * @description Get application title of analytical configuration.
         * @name sap.apf.modeler.core.ConfigurationEditor#getApplicationTitle
         * @returns {String} textKey Text key of application title
         */
        this.getApplicationTitle = function() {
        	return applicationTitle;
        };
        /**
         * @private
         * @function
         * @description Get configuration name of analytical configuration.
         * Only needed modeler core internally in order to synchronize the configuration list of configuration handler during reset.
         * @name sap.apf.modeler.core.ConfigurationEditor#getConfigurationName
         * @returns {String} name Configuration name
         */
        this.getConfigurationName = function() {
            return configurationName;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getCategoryStepAssignments
         * @description Get the assignments of steps for a given category
         * @param {String} id Category identifier
         * @returns {array|boolean} Returns the step assignments or false for a not existing category
         */
        this.getCategoryStepAssignments = function(categoryId){
        	var result = [];
        	if(!this.getCategory(categoryId)){
        		return false;
        	}
        	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(categoryStepAssignment){
            	categoryStepAssignment.getElements().forEach(function(step){
            		result.push(step.stepId);
            	});	
        	}
        	return result;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#addCategoryStepAssignment
         * @description Create a new category step assignment
         * @param {string} categoryId
         * @param {string} stepId
         * @returns {boolean} Returns true if a new category step assignment has been created
         */
        this.addCategoryStepAssignment = function (categoryId, stepId) {
        	if(!this.getCategory(categoryId) || !this.getStep(stepId)){
        		return false;
        	}
        	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(!categoryStepAssignment){
        		categoryStepAssignmentContainer.createElementWithProposedId({}, categoryId);
        		categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	}
        	if(!categoryStepAssignment.getElement(stepId)){
        		categoryStepAssignment.createElementWithProposedId({stepId: stepId}, stepId);
        		return true;
        	};
        	return false;
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#removeCategoryStepAssignment
         * @description Remove an existing category step assignment. 
         * @description If the last category assignment for a step is removed, the step is removed as well.
         * @description  - If the assignment changes please use first(!) addCategoryStepAssignment for the new assignments
         * @description  - Afterwards(!) remove the not needed assignments with removeCategoryStepAssignment 
         * @description  - Otherwise(!) you might loose the step object in between 
         * @param {string} categoryId - category
         * @param {string} [stepId] - optional parameter for step
         * @returns {boolean} Returns true if a category step assignment was removed
         */
        this.removeCategoryStepAssignment = function (categoryId, stepId) {
        	var removedItem;
        	
        	if(!stepId){
        		var steps = this.getCategoryStepAssignments(categoryId);
        		removedItem = categoryStepAssignmentContainer.removeElement(categoryId);
        		
        		if(removedItem){
        			_removeDanglingSteps(steps);	
        		}
        		
        		return !!removedItem;
        	}
        	
        	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(!categoryStepAssignment){
        		return false;
        	}
        	removedItem = categoryStepAssignment.removeElement(stepId);
        	if(categoryStepAssignment.getElements().length === 0){
        		categoryStepAssignmentContainer.removeElement(categoryId);
        	}
        	
        	if(removedItem){
    			_removeDanglingSteps([stepId]);	
    		}
        	
        	return !!removedItem;
        };
        
        function _removeDanglingSteps(steps) {
        	if(!steps){
        		return;
        	}
        	steps.forEach(function(stepId){
        		if(that.getCategoriesForStep(stepId).length === 0){
        			_removeStep(stepId);
        		}
        	});
        }
        
        /**
         * Change the ordering by moving one category step assignment in the ordering before another category step assignments.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveCategoryStepAssignmentBefore
         * @param {string} beforeNavigationTargetId
         * @param {string} movedNavigationTargetId
         * @returns {number|null} WHEN either Id is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedNavigationTargetId, after the move.
         */
        this.moveCategoryStepAssignmentBefore = function(categoryId, beforeStepId, movedStepId) {
          	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(!categoryStepAssignment){
        		return null;
        	}
        	return categoryStepAssignment.moveBefore(beforeStepId, movedStepId);
        };
        
        /**
         * Change the ordering of category step assignments by moving one category step assignment in the ordering to the end.
         * The move only happens within the steps for a given category
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveCategoryStepAssignmentToEnd
         * @param {string} categoryId
         * @param {string} stepId
         * @returns {number|null} WHEN the category step assignment is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of the stepId for the given categoryId, after the move.
         */
        this.moveCategoryStepAssignmentToEnd = function(categoryId, stepId) {
          	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(!categoryStepAssignment){
        		return null;
        	}
        	return categoryStepAssignment.moveToEnd(stepId);
        };
        
        /**
         * Move a category step assignment up or down some places specified by distance
         * The move only happens within the steps for a given category
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#moveCategoryStepAssignmentUpOrDown
        * @param {string} categoryId
         * @param {string} stepId
         * @param {number} distance number of places
         */
        this.moveCategoryStepAssignmentUpOrDown = function(categoryId, stepId, distance) {
          	var categoryStepAssignment = categoryStepAssignmentContainer.getElement(categoryId);
        	if(!categoryStepAssignment){
        		return null;
        	}
        	return categoryStepAssignment.moveUpOrDown(stepId, distance);
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getCategory
         * @description Get an existing category
         * @param {String} id Category identifier
         * @returns {object|undefined} Returns the category object for the ID or undefined for a not existing category
         */
        this.getCategory = categoryContainer.getElement;

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#setCategory
         * @description Create a new or update an existing category. A new category object assigns a member "id" with its id.
         * @param {object} category
         * @param {string} [category.labelKey] Text key for the category
         * @param {String} [categoryId] Category identifier. If parameter is omitted, then the function has the meaning of create, otherwise update.
         * @returns{String} Returns the id of a newly created or updated category
         */
        this.setCategory = function (category, categoryId) {
            isSaved = false;
            return categoryContainer.setElement( category, categoryId);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createCategoryWithId
         * @description Create a new category and set its given Id.
         * @param {object} category
         * @param {string} category.labelKey Text key for the category
         * @param {String} categoryId Category identifier.
         * @returns{String} Returns the given id.
         */
        this.createCategoryWithId = function (category, categoryId) {
            isSaved = false;
            return categoryContainer.createElementWithProposedId( category, categoryId).getId();  
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#removeCategory
         * @description Remove an existing category and its corresponding steps which are not assigned to other categories.
         * @param {String} categoryId - Category identifier.
         */
        this.removeCategory = function(categoryId){
            
        	var steps = that.getCategoryStepAssignments(categoryId);
            if(steps){
            	steps.forEach(function(stepId){
            		var categories = that.getCategoriesForStep(stepId);
            		if(!categories || categories.length < 2){
            			_removeStep(stepId);
            		}
            	});
            }
            categoryContainer.removeElement(categoryId);
            
        };


        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#getCategories
         * @description Get all existing categories.
         * @returns {Object[]}
         */
        this.getCategories = categoryContainer.getElements;

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#copyCategory
         * @function
         * @param {String} categoryId - Category identifier
         * @description Copy a category.
         * @returns {String} - New category id or undefined for not existing category
         */
        this.copyCategory = function(categoryId) {
        	var newCategoryId = categoryContainer.copyElement(categoryId),
        	    newStepId;
        	if(!newCategoryId){
        		return;
        		}
        	that.getCategoryStepAssignments(categoryId).forEach(function(stepId){
        		newStepId = _copyStep(stepId, newCategoryId);
        	});
        	return newCategoryId;
        };
        
        /**
         * Change the ordering by moving one category in the ordering before another category.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveCategoryBefore
         * @param {string} beforeCategoryId
         * @param {string} movedCategoryId
         * @returns {number|null} WHEN either Id is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedCategoryId, after the move.
         */
        this.moveCategoryBefore = function(beforeCategoryId, movedCategoryId) {
        	return categoryContainer.moveBefore(beforeCategoryId, movedCategoryId);
        };
        
        
        /**
         * Change the ordering of categories by moving one category in the ordering to the end.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveCategoryToEnd
         * @param {string} categoryId
         * @returns {number|null} WHEN the key categoryId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of category(Id), after the move.
         */
        this.moveCategoryToEnd = function(categoryId) {
        	return categoryContainer.moveToEnd(categoryId);
        };
        
        /**
         * Move a category up or down some places specified by distance
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#moveCategoryUpOrDown
         * @param {string} categoryId id of the category, that shall be moved
         * @param {number} distance number of places
         */
        this.moveCategoryUpOrDown = function(categoryId, distance) {
        	return categoryContainer.moveUpOrDown(categoryId, distance);
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#serialize
         * @description Get a serializable object for the configuration
         * @returns{Object}
         */
        this.serialize = function () {
            return configurationObjects.serializeConfiguration(that);
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#isSaved
         * @description Returns "false" if the configuration has unsaved changes, else "true"
         * @returns{Boolean}
         */
        this.isSaved = function () {
            return isSaved;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#setIsUnsaved
         * @description Sets the ConfigurationEditor to an unsaved state, such that isSaved()===false.
         * This method shall be called by the UI whenever it edited some configuration sub-entity, e.g. the entitySet of a request.
         */
        this.setIsUnsaved = function () {
            isSaved = false;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#save
         * @description Saves or modifies a configuration on database and replaces the temporary configuration id with a server generated one
         * @param {function(response, metadata, messageObject)} callback Callback returns after create/update operation has been executed
         * @param {string} callback.response ID of the saved/modified configuration
         * @param {string} callback.metadata Metadata
         * @param {sap.apf.core.MessageObject} callback.messageObject Identifier of corrupt process flow
         *
         */
        this.save = function (callback) {
            function callbackCreate(response, metadata, messageObject) {
                if (!messageObject) {
                    isSaved = true;
                    configurationName = config.AnalyticalConfigurationName;
                    configurationHandler.replaceConfigurationId(configuration.id || configuration, response.AnalyticalConfiguration);
                    configuration = response.AnalyticalConfiguration;
                }
                callback(configuration, metadata, messageObject);
            }

            function callbackUpdate(metadata, messageObject) {
                if (!messageObject) {
                    isSaved = true;
                    configurationName = config.AnalyticalConfigurationName;
                }
                callback(configuration.id || configuration, metadata, messageObject);
            }

            var config = {
                AnalyticalConfiguration: "",
                AnalyticalConfigurationName: configurationHandler.getConfiguration(configuration.id || configuration).AnalyticalConfigurationName,
                Application: configurationHandler.getApplicationId(),
                SerializedAnalyticalConfiguration: JSON.stringify(this.serialize()),
               
                //TODO: Workaround for MockServer: the following properties needs to be added at least as an empty string for every configuration. 
                //If not, these properties are not available in the result data set of the MockServer and OData requests containing one of the 
                //these select properties ($select) below will fail. 
                //Assumption: these properties are set on server side in "exits". Holds for PUT and POST. 
                CreatedByUser: "", 
                CreationUTCDateTime: null,
                LastChangeUTCDateTime: null,
                LastChangedByUser: ""
            };
            if(typeof configuration === 'string') {
                if (configuration.indexOf("apf1972-") === 0) {
                    //noinspection JSCheckFunctionSignatures
                    persistenceProxy.create("configuration", config, callbackCreate);
                } else {
                    config.AnalyticalConfiguration = configuration;
                    persistenceProxy.update("configuration", config, callbackUpdate, [{name: "AnalyticalConfiguration", value: configuration }]);
                }
            } else {
            	if (configuration.id.indexOf("apf1972-") === 0) {
            		config.AnalyticalConfiguration = "";
                    config.CreationUTCDateTime = null;
                    config.LastChangeUTCDateTime = null;
            	}else{
            		config.AnalyticalConfiguration = configuration.id;
                    config.CreationUTCDateTime = configuration.creationDate;
                    config.LastChangeUTCDateTime = configuration.lastChangeDate;
            	}
                if(configuration.updateExisting){
                    persistenceProxy.update("configuration", config, callbackUpdate,[{name: "AnalyticalConfiguration", value: configuration.id}]);
                } else {
                    
                    persistenceProxy.create("configuration", config, callbackCreate);
                }
            }
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createFacetFilterWithId
         * @description Create an empty facet filter managed by this editor.
         * @param {string} facetFilterId - Given Id used to identify the facet filter.
         * @returns {String} - facetFilterId
         */
        this.createFacetFilterWithId = function(facetFilterId) {
           return facetFilterContainer.createElementWithProposedId(undefined, facetFilterId).getId();
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createFacetFilter
         * @description Create an empty facet filter managed by this editor.
         * @returns {String} - facetFilterId
         */
        this.createFacetFilter = function() {
            return facetFilterContainer.createElement().getId();
        };

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#removeFacetFilter
         * @function
         * @description Remove an existing facet filter.
         * @param {String} id
         */
        this.removeFacetFilter = facetFilterContainer.removeElement;

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getFacetFilter
         * @function
         * @param {String} facetFilterId
         * @returns {sap.apf.modeler.core.FacetFilter}
         */
        this.getFacetFilter = facetFilterContainer.getElement;

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getFacetFilters
         * @function
         * @description Get all existing facet filter.
         * @returns {sap.apf.modeler.core.FacetFilter[]} {@link sap.apf.modeler.core.FacetFilter}
         */
        this.getFacetFilters = facetFilterContainer.getElements;
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#copyFacetFilter
         * @function
         * @param {String} facetFilterId
         * @description Copy a facet filter.
         * @returns {String} - New facet filter id or undefined for not existing facet filter
         */
        this.copyFacetFilter = facetFilterContainer.copyElement;      
        
        /**
         * Change the ordering by moving one facet filter in the ordering before another facet filter.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveFacetFilterBefore
         * @param {string} beforeFacetFilterId
         * @param {string} movedFacetFilterId
         * @returns {number|null} WHEN either Id is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedFacetFilterId, after the move.
         */
        this.moveFacetFilterBefore = function(beforeFacetFilterId, movedFacetFilterId) {
        	return facetFilterContainer.moveBefore(beforeFacetFilterId, movedFacetFilterId);
        };
        
        /**
         * Change the ordering of facet filters by moving one facet filter in the ordering to the end.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveFacetFilterToEnd
         * @param {string} facetFilterId
         * @returns {number|null} WHEN the key facetFilterId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of facetFilter(Id), after the move.
         */
        this.moveFacetFilterToEnd = function(facetFilterId) {
        	return facetFilterContainer.moveToEnd(facetFilterId);
        };
        
        /**
         * Move a facet filter up or down some places specified by distance
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#moveFacetFilterUpOrDown
         * @param {string} facetFilterId id of the facetFilter, that shall be moved
         * @param {number} distance number of places
         */
        this.moveFacetFilterUpOrDown = function(facetFilterId, distance) {
        	return facetFilterContainer.moveUpOrDown(facetFilterId, distance);
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createNavigationTargetWithId
         * @description Create an empty navigation target managed by this editor.
         * @param {string} navigationTargetId - Given Id used to identify the navigation target.
         * @returns {String} - navigationTargetId
         */
        this.createNavigationTargetWithId = function(navigationTargetId) {
            return navigationTargetContainer.createElementWithProposedId(undefined, navigationTargetId).getId();
           
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createNavigationTarget
         * @description Create an empty navigation target managed by this editor.
         * @returns {String} - navigationTargetId
         */
        this.createNavigationTarget = function() {
            return navigationTargetContainer.createElement().getId();
        };

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#removeNavigationTarget
         * @function
         * @description Remove an existing navigation target.
         * @param {String} id
         */
        this.removeNavigationTarget = navigationTargetContainer.removeElement;

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getNavigationTarget
         * @function
         * @param {String} navigationTargetId
         * @returns {sap.apf.modeler.core.NavigationTarget}
         */
        this.getNavigationTarget = navigationTargetContainer.getElement;

        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getNavigationTargets
         * @function
         * @description Get all existing navigation targets
         * @returns {sap.apf.modeler.core.NavigationTarget[]} {@link sap.apf.modeler.core.NavigationTarget}
         */
        this.getNavigationTargets = navigationTargetContainer.getElements;
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#copyNavigationTarget
         * @function
         * @param {String} navigationTargetId
         * @description Copy a navigation target.
         * @returns {String} - New navigation target id or undefined for not existing navigation target
         */
        this.copyNavigationTarget = navigationTargetContainer.copyElement;  
        
        /**
         * Change the ordering by moving one navigation target in the ordering before another navigation target.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveNavigationTargetBefore
         * @param {string} beforeNavigationTargetId
         * @param {string} movedNavigationTargetId
         * @returns {number|null} WHEN either Id is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of movedNavigationTargetId, after the move.
         */
        this.moveNavigationTargetBefore = function(beforeNavigationTargetId, movedNavigationTargetId) {
        	return navigationTargetContainer.moveBefore(beforeNavigationTargetId, movedNavigationTargetId);
        };
        
        /**
         * Change the ordering of navigation targets by moving one navigation target in the ordering to the end.
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationObjects#moveNavigationTargetToEnd
         * @param {string} navigationTargetId
         * @returns {number|null} WHEN the key navigationTargetId is not contained or undefined THEN return null.
         *      Otherwise return the index of the index position of navigationTarget(Id), after the move.
         */
        this.moveNavigationTargetToEnd = function(navigationTargetId) {
        	return navigationTargetContainer.moveToEnd(navigationTargetId);
        };
        
        /**
         * Move a navigation target up or down some places specified by distance
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#moveNavigationTargetUpOrDown
         * @param {string} navigationTargetId id of the navigationTarget, that shall be moved
         * @param {number} distance number of places
         */
        this.moveNavigationTargetUpOrDown = function(navigationTargetId, distance) {
        	return navigationTargetContainer.moveUpOrDown(navigationTargetId, distance);
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createStepWithId
         * @description Create an empty step managed by this editor.
         * @param {string} stepId - Given Id used to identify the step.
         * @returns {String} - stepId 
         */
        this.createStepWithId = function(stepId) {   
        	return stepContainer.createElementWithProposedId(undefined, stepId).getId(); 
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationEditor#createStep
         * @description Create an empty step managed by this editor.
         * @param {string} categoryId - Given categoryId the step shall be assigned to
         * @returns {String|undefined} - stepId or undefined if the category does not exist
         */
        this.createStep = function(categoryId) {
         	if(!this.getCategory(categoryId)){
        		return;
        	}
        	var stepId = stepContainer.createElement().getId();
        	this.addCategoryStepAssignment(categoryId, stepId);
            return stepId;
        };
        
        
        var _removeStep = stepContainer.removeElement; // private now. If called from external use removeCategoryStepAssignment instead
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getStep
         * @function
         * @param {String} stepId
         * @returns {sap.apf.modeler.core.Step}
         */
        this.getStep = stepContainer.getElement;
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getSteps
         * @function
         * @description Get all existing steps.
         * @returns {sap.apf.modeler.core.Step[]} {@link sap.apf.modeler.core.Step}
         */
        this.getSteps = stepContainer.getElements;
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getStepsNotAssignedToCategory
         * @function
         * @description Returns all step ids which are not assigned to the given category ID.
         * @param {String} categoryId
         * @returns {String[]} - Step IDs
         */
        this.getStepsNotAssignedToCategory = function(categoryId) {
        	var assignedSteps = this.getCategoryStepAssignments(categoryId);
        	var unassignedSteps = [];
        	
        	that.getSteps().forEach(function(step){
        		var stepId = step.getId();
	        	if(assignedSteps.indexOf(stepId) === -1){
	        		unassignedSteps.push(stepId);
	        	}
            });
        	return unassignedSteps;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#copyStep
         * @function
         * @param {String} stepId - Step identifier
         * @description Copy a step.
         * @returns {String} - New step id or false in case of error
         */
        this.copyStep = function(stepId){
        	var newStepId = _copyStep(stepId);
        	if(!newStepId){
        	 return false;
        	}
        	var categories = this.getCategoriesForStep(stepId);
        	if(categories){
             	categories.forEach(function(categoryId){
            	    that.addCategoryStepAssignment(categoryId, newStepId);
            	});	
        	}
        	return newStepId;
        };
        
        function _copyStep(stepId, categoryIdForNewStep) {
        	if(categoryIdForNewStep && !that.getCategory(categoryIdForNewStep)){
        		return false;
        	}
        	var newStepId = stepContainer.copyElement(stepId);
        	if(!newStepId){
        		return false;
        	}
        	if(categoryIdForNewStep){
        	 that.addCategoryStepAssignment(categoryIdForNewStep, newStepId);
        	}
        	return newStepId;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#getCategoriesForStep
         * @function
         * @param {String} stepId - Step identifier
         * @description Get all categories the step is assigned to
         * @returns {array} - Array of category Ids 
         */
        this.getCategoriesForStep = function getCategoriesForStep(stepId){
        	var result = [];
        	var categories = that.getCategories();
        	if(categories){
             	categories.forEach(function(category){
             		var categoryId = category.getId();
            		var steps = that.getCategoryStepAssignments(categoryId);
            		if(steps && steps.indexOf(stepId) > -1){
            			result.push(categoryId);
            		}
            	});	
        	}
        	return result;
        };
        
        /**
         * @private
         * @name sap.apf.modeler.core.ConfigurationEditor#copy
         * @function
         * @description Execute a deep copy of the configuration editor and its referenced objects
         * @param {String} newConfigurationId - New configuration id for the copied instance
         * @returns {Object} sap.apf.modeler.core.ConfigurationEditor# - New configuration editor being a copy of this object
         */
        this.copy = function( newConfigurationId){
        	var dataForCopy = {
        			stepContainer        			: stepContainer,
                    categoryContainer    			: categoryContainer,
                    facetFilterContainer 			: facetFilterContainer,
                    navigationTargetContainer 		: navigationTargetContainer,
                    categoryStepAssignmentContainer : categoryStepAssignmentContainer,
                    serviceList          			: serviceList };
        	
        	var dataFromCopy = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy( dataForCopy );
        	return new sap.apf.modeler.core.ConfigurationEditor(newConfigurationId, inject, undefined, dataFromCopy);
        };  
        
        if(typeof configuration === 'string') {
            if (configuration.indexOf("apf1972-") === 0) { // temporary id means new unsaved config
            	isSaved = false;
            	if(callbackAfterLoad){
            	  callbackAfterLoad(that, undefined); 
            	}
            } else {
            	if(!dataFromCopy){
	            	loadConfigurationFromServer(configuration, persistenceProxy, function(result, messageObject){
	            	   if(!messageObject){
	            		   var serializedAnalyticalConfiguration = JSON.parse(result.SerializedAnalyticalConfiguration);
	            		   that.setApplicationTitle(serializedAnalyticalConfiguration.applicationTitle);
	            		   configurationFactory.loadConfig(serializedAnalyticalConfiguration);	
	                       configurationObjects.mapToDesignTime(configurationFactory.getRegistry(), that);
	                       isSaved = true;
	                       configurationName = result.AnalyticalConfigurationName;
	                       callbackAfterLoad(that, undefined);   
	            	   } else {
	            		   callbackAfterLoad(undefined, messageObject);  
	            	   }	  
	            	});
            	}
            }
        } else {
            configurationFactory.loadConfig(configuration.content);
            configurationObjects.mapToDesignTime(configurationFactory.getRegistry(), this);
        	if(callbackAfterLoad){
          	  callbackAfterLoad(that, undefined); 
          	}
        }
        
        function loadConfigurationFromServer(configId, persistProxy, callbackAfterLoad) {
            persistProxy.readEntity(
                "configuration",
                function(result, metadata, messageObject) {
                    callbackAfterLoad(result, messageObject);
                },
                [{
                    name : "AnalyticalConfiguration",
                    value: configId
                }],
                undefined,
                true
            );
        }
    };
}());

}; // end of sap/apf/modeler/core/configurationEditor.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.configurationHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.configurationHandler");




(function () {
    'use strict';

    /**
     * @private
     * @class Configuration Handler manages the different configurations for an application
     * @param {Object} inject Injection of required APF objects
     * @param {Object} inject.instance Injected instances
     * @param {Object} inject.instance.messageHandler messageHandler instance
     * @param {Object} inject.instance.persistenceProxy persistenceProxy instance
     * @param {Object} inject.constructor Injected constructors
     * @param {Object} inject.constructor.configurationEditor ConfigurationEditor constructor
     * @param {Object} inject.constructor.hashtable Hashtable constructor
     * @param {Object} inject.constructor.lazyLoader LazyLoader constructor
     * @param {Function} inject.functions.getApplication Function for getting application data for a given id
     */
    sap.apf.modeler.core.ConfigurationHandler = function (inject) {

    	var that = this;
        var messageHandler = inject.instance.messageHandler;
        var persistenceProxy = inject.instance.persistenceProxy;

        var ConfigurationEditor = inject.constructor.configurationEditor;
        var Hashtable = inject.constructor.hashtable;
        var LazyLoader = inject.constructor.lazyLoader;
        
        var configList = new Hashtable(messageHandler);
        var lazyLoadersForConfigEditor =  new Hashtable(messageHandler);
        var memorizedConfigurationEditorInstances =  new Hashtable(messageHandler);

        var applicationId, textPool;
        
     	 var injectLazyLoader = {
          		constructor : { hashtable      : Hashtable },
          		instance    : { messageHandler : messageHandler}
          };
     	 
        /**
         * @private
         * @see sap.apf.modeler.core.TextPool#exportTexts
         */
        this.exportTexts = function() {
        	return textPool.exportTexts();
        };

        this.getTextPool = function() {
        	return textPool;
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#setApplicationId
         * @description Sets the application id
         * @param {String} id Application identifier
         * @param {Array} existingAnalyticalConfigurations (fetched from DB)
         * @param {sap.apf.core.modeler.TextPool} oTextPool existing text pool
         */
        this.setApplicationIdAndContext = function(id, existingAnalyticalConfigurations, oTextPool){
        	textPool = oTextPool || textPool;
        	configList = new Hashtable(messageHandler);
        	var  i, len = existingAnalyticalConfigurations.length;
        	
        	for (i = 0; i < len; i++) {
        		configList.setItem(existingAnalyticalConfigurations[i].AnalyticalConfiguration, existingAnalyticalConfigurations[i]);
        	}
        	applicationId = id;
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#getApplicationId
         * @description Returns the application ID
         * @returns {string} Application ID
         */
        this.getApplicationId = function(){
        	return applicationId;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#setConfiguration
         * @description Creates or updates the configuration header information.
         * @param {Object} configObject Configuration object
         * @param {String} configObject.AnalyticalConfigurationName Configuration name
         * @param {String} [id] Configuration identifier
         */
        this.setConfiguration = function(configObject, id){
            configObject.AnalyticalConfiguration = id || getTempId();
            configObject.Application = applicationId;
            configList.setItem(configObject.AnalyticalConfiguration, configObject);
            return configObject.AnalyticalConfiguration;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#getList
         * @description Returns a list of configurations as array
         * @returns {Array.<Object>} Array of configurations
         */
        this.getList = function(){
            var configurationArray = [];
            var addConfigToArray = function(key, item) {
                configurationArray.push(item);
            };
            configList.each(addConfigToArray);
            return configurationArray;
        };

        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#getConfiguration
         * @description Returns a configuration object for a given id
         * @param {String} id Configuration identifier
         * @returns {Object} Configuration object
         */
        this.getConfiguration = function(id){
            return configList.getItem(id);
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#loadConfiguration
         * @description Returns a configuration editor for a given configuration that is specified by its id
         * @param {String|object} configuration If string, value is configuration id. If object, configuration id is contained in property "id" 
         * @param {function(configurationEditor)} callback Callback returns after configuration editor has been instantiated
         * @param {sap.apf.modeler.core.ConfigurationEditor} callback.configurationEditor Configuration editor instance
         */
        this.loadConfiguration = function(configuration, callback){
        	function loadConfigurationEditor(configId, callbackAfterLoad, oldInstance){
               	var newInject = {
            			instance: {
            				 coreApi : inject.instance.coreApi,
            			   	 messageHandler : messageHandler,
            			   	 datajs : inject.instance.datajs,
            	        	 configurationHandler : that,
            	        	 persistenceProxy : persistenceProxy, 
            	        	 textPool : textPool, 
            	        	 metadataFactory : inject.instance.metadataFactory
            			},
    		        	 constructor : {
    		            	 hashtable : Hashtable,
    		            	 step : inject.constructor.step,
                             facetFilter: inject.constructor.facetFilter,
                             navigationTarget: inject.constructor.navigationTarget,
                             representation: inject.constructor.representation,
                             configurationObjects: inject.constructor.configurationObjects,
                             elementContainer: inject.constructor.elementContainer,
                             configurationFactory: inject.constructor.configurationFactory,
                             registryProbe : inject.constructor.registryProbe 
    		        	 }          	 		
            	};       
               new ConfigurationEditor(configuration, newInject, function(instance, messageObject){
                	  callbackAfterLoad(configId, instance, messageObject);
                }); // this object will bind itself to the callback --> what does this mean? TODO clarify
            }
        	var lazyLoaderForConfigEditor,
        	    configId = configuration.id || configuration;
        	
        	if(!configuration.updateExisting){
        	 lazyLoaderForConfigEditor = lazyLoadersForConfigEditor.getItem(configId);
        	}
        	
        	if(!lazyLoaderForConfigEditor){
        		lazyLoaderForConfigEditor = new LazyLoader(injectLazyLoader, loadConfigurationEditor);
        		lazyLoadersForConfigEditor.setItem(configId, lazyLoaderForConfigEditor);
        	}
        	
        	lazyLoaderForConfigEditor.asyncGetInstance(configId, callbackAfterAsyncGet);
  			function callbackAfterAsyncGet(instance, messageObject, configurationId){
  				callback(instance, messageObject);
  			}
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#resetConfiguration
         * @description Resets the buffered configuration state for a certain Id to the previously saved state
         * @param {String} configurationId - Configuration id 
         * @return {String} Returns the removed configuration id on success, else undefined
         */
        this.resetConfiguration = function(configurationId){
            var currentConfig;
        	if(lazyLoadersForConfigEditor.hasItem(configurationId)){
        	    currentConfig = configList.getItem(configurationId);
        	    currentConfig.AnalyticalConfigurationName = lazyLoadersForConfigEditor.getItem(configurationId).getInstance().getConfigurationName();
        	    lazyLoadersForConfigEditor.removeItem(configurationId);
        		return configurationId;	
        	}      
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#copyConfiguration
         * @description Returns a new configuration editor for a copied configuration
         * @param {String} id - Configuration identifier for the configuration that shall be copied
         * @param {function(newConfigurationId)} callback - Callback returns after the editor with the copied configuration has been instantiated
         * @param {string} callback.newConfigurationId - New (temporary) configuration Id of the copy result (use loadConfiguration to access it)
         */
        this.copyConfiguration = function(id, callback){
        	var configObject = this.getConfiguration(id);
        	if(!configObject){
    			callback(null); //Error exit: Source configuration does not exist
    			return;
    		}
        	that.loadConfiguration(id, callbackAfterLoad);
        	
        	function callbackAfterLoad(configEditor){
        		var newId,
        		    newConfigEditor,
        		    newLazyLoader,
        		    newConfigObject;
        		    
        		    newConfigObject = sap.apf.modeler.core.ConfigurationObjects.deepDataCopy(configObject);
        			newId = getTempId();

        			newConfigObject.AnalyticalConfiguration = newId;
        		    that.setConfiguration(newConfigObject, newId);
        		    
        			newConfigEditor = configEditor.copy(newId);
        			newLazyLoader = new LazyLoader(injectLazyLoader, undefined, {id : newId, instance : newConfigEditor});
        			lazyLoadersForConfigEditor.setItem(newId, newLazyLoader);
        			
        			callback(newId); //Return Id of deeply copied configuration
        	}
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#replaceConfigurationId
         * @description Replaces temporary configuration id with server generated id
         * @param {String} tempId Temporary id
         * @param {String} serverGeneratedId Server generated id
         */
        this.replaceConfigurationId = function(tempId, serverGeneratedId){
        	if(tempId.indexOf("apf1972-") === 0){
        		var tempConfigListItem = configList.getItem(tempId);
        		var tempConfigEditor = lazyLoadersForConfigEditor.getItem(tempId).getInstance();
        		var newLazyLoader = new LazyLoader(injectLazyLoader, undefined, {id : serverGeneratedId, instance : tempConfigEditor});
        		
        		tempConfigListItem.AnalyticalConfiguration = serverGeneratedId;
        		configList.setItem(serverGeneratedId, tempConfigListItem);
        		configList.removeItem(tempId);
        		
        		lazyLoadersForConfigEditor.setItem(serverGeneratedId, newLazyLoader);
        		lazyLoadersForConfigEditor.removeItem(tempId);
        	}
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#exportConfiguration
         * @description Exports a configuration for a given id
         * @param {String} configId Configuration id
         * @param {function(String|Null)} callback Callback returns the configuration string after configuration export is complete or Null in case of error
         */
        this.exportConfiguration = function(configId, callback){
        	var objectForExport;
        	this.loadConfiguration(configId, callbackAfterLoadConfiguration);
        	function callbackAfterLoadConfiguration(configEditor){
        		if(!configEditor.isSaved()){
        			 messageHandler.putMessage(messageHandler.createMessageObject({
                         code: "11007",
                         aParameters : [configId]
                     }));
        			 callback(null);
        		}else{
        			var appInformation = inject.functions.getApplication(applicationId);
                    	 
        			objectForExport = configEditor.serialize();
        			objectForExport.configHeader = {
    	  					Application : applicationId, 
    	  					ApplicationName : appInformation.ApplicationName,
    	  	                SemanticObject : appInformation.SemanticObject, 
    	  	                AnalyticalConfiguration : configId, 
    	  	                AnalyticalConfigurationName : that.getConfiguration(configId).AnalyticalConfigurationName,
    	  	                UI5Version : sap.ui.version
    	  			};
        			
        			persistenceProxy.readEntity(
        	                "configuration",
        	                function(result, metadata, messageObject) {
        	                    if(messageObject) {
        	                        messageHandler.putMessage(messageHandler.createMessageObject({
        	                            code: "5022",
        	                            aParameters : [configId]
        	                        }));
        	                        callback(null);
        	                    } else {
        	                    	objectForExport.configHeader.CreationUTCDateTime = result.CreationUTCDateTime;
        	                    	objectForExport.configHeader.LastChangeUTCDateTime = result.LastChangeUTCDateTime;
        	                    	callback(JSON.stringify(objectForExport));
        	                    }
        	                },
        	                [{
        	                    name : "AnalyticalConfiguration",
        	                    value: configId
        	                }],
        	                ["CreationUTCDateTime", "LastChangeUTCDateTime"],
        	                false
        	            );        			
        		}
        	}
        };
        /**
        * @private
        * @function
        * @name sap.apf.modeler.core.ConfigurationHandler#memorizeConfiguration
        * @description Memorizes a configuration for a given id
        * @param {String} configId Configuration id
        * @returns {String|Null} Returns the memorized configuration id or null if the id does not exist
        */
       this.memorizeConfiguration = function(configId){
    	   var configEditor,
    	       lazyLoaderForConfigEditor;
    	   
    	   lazyLoaderForConfigEditor = lazyLoadersForConfigEditor.getItem(configId);
    	   if(!lazyLoaderForConfigEditor){
    		  return null; 
    	   }
    	   
    	   configEditor = lazyLoaderForConfigEditor.getInstance();
    	   if(configEditor) {
    		   memorizedConfigurationEditorInstances.setItem(configId, configEditor.copy(configId)); 
    		   return configId;
    	   }
    	   return null;
        };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#restoreMemorizedConfiguration
         * @description Restore a memorized configuration for a given id
         * @param {String} configId Configuration id
         * @returns {sap.apf.modeler.core.ConfigurationEditor|Null} Returns the instance of the restored configuration editor or null if nothing was memorized for this id
         */
        this.restoreMemorizedConfiguration = function(configId){
           var newLazyLoader,
               configEditor;
           
           configEditor = memorizedConfigurationEditorInstances.removeItem(configId);
     	   if(configEditor) {
     		  newLazyLoader = new LazyLoader(injectLazyLoader, undefined, {id : configId, instance : configEditor});
  			  lazyLoadersForConfigEditor.setItem(configId, newLazyLoader);
     		  return configEditor;
     	   }
     	   
     	   return null;
         };
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#removeConfiguration
         * @description Removes configuration from hashtable and server
         * @param {String} configurationId Configuration ID
         * @param {function(configurationId, metadata, messageObject)} removeCallback Callback returns after remove operation has been executed 
         * @param {String} removeCallback.configurationId ID of removed configuration
         * @param {sap.apf.core.EntityTypeMetadata} removeCallback.metadata Metadata
         * @param {sap.apf.core.MessageObject} removeCallback.messageObject MessageObject
         */
        this.removeConfiguration = function(configurationId, removeCallback) {
        	function callbackRemove(metadata, messageObject) {
        		if(!messageObject) {
        			configList.removeItem(configurationId);
        			lazyLoadersForConfigEditor.removeItem(configurationId);
        		}
        		removeCallback(configurationId, metadata, messageObject);
        	}
        	if (configurationId.indexOf("apf1972-") !== 0) {
        		persistenceProxy.remove("configuration", [ {name : "AnalyticalConfiguration", value : configurationId }], callbackRemove);
            } else {
            	configList.removeItem(configurationId);
            	lazyLoadersForConfigEditor.removeItem(configurationId);
            	removeCallback(configurationId, undefined, undefined);
            }
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.modeler.core.ConfigurationHandler#removeAllConfigurations
         * @description Remove all configurations (after delete of corresponding application)
         */
        this.removeAllConfigurations = function(){
        	configList = new Hashtable(messageHandler);
        };
        
       function getTempId() {
            return  "apf1972-" + (Math.random( ) * new Date().getTime());
        }
    };
}());

}; // end of sap/apf/modeler/core/configurationHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.applicationList.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.applicationList.controller');
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

sap.ui.controller("sap.apf.modeler.ui.controller.applicationList", {
	onInit : function() {
		var viewInstance = this.getView();
		viewInstance.addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this._addApplicationStyleClass(); //add the style class
		var oComponent = this.getOwnerComponent();
		if (oComponent !== undefined) {
			this.oCoreApi = oComponent.oCoreApi;
			this._setDisplayText();
			var self = this;
			this.oCoreApi.getApplicationHandler(function(oApplicationHandler) {
				self.applicationHandler = oApplicationHandler;
				self._updateAppList();
			});
		}
		this.oModel = new sap.ui.model.json.JSONModel({});
		this.oModel.setSizeLimit(1000);
		this.bIsEditMode = false;
		this.byId("idAppDescription").attachBrowserEvent("click", this.navToConfigList().fn);
		this.byId("idSemanticObject").attachBrowserEvent("click", this.navToConfigList().fn);
		//Set the height of scroll container initial load and on resize
		var appLayout = viewInstance.byId("idApplicationTable");
		var scrollContainer = viewInstance.byId("idAppListScrollContainer");
		scrollContainer.addEventDelegate({
			onAfterRendering : function() { //Set the height and width of scroll container
				var width = jQuery(viewInstance.byId("idAppPage").getDomRef()).width();
				var height = jQuery(window).height();
				var appTitleBar = jQuery(viewInstance.byId("idAppTitle").getDomRef()).height() + 32; //32 : padding value
				var appToolbar = jQuery(viewInstance.byId("idApplicationToolbar").getDomRef()).height();
				var header = jQuery(viewInstance.byId("idAppPage").getDomRef()).find("header").height();
				var footer = jQuery(viewInstance.byId("idAppPage").getDomRef()).find("footer").height();
				var offsetHeight;
				if (appToolbar > 0) { //If onAfterRendering happens before the UI is rendered on the DOM
					offsetHeight = appTitleBar + appToolbar + header + footer + 25;
				} else {//Fall back if rendered DOM element has height defined as 0 or undefined
					offsetHeight = 270; //Setting constant calculated value(230 for header and 40 for footer)
				}
				
				//Set Initial Height and Width				
				scrollContainer.setHeight(height - offsetHeight + "px");
				scrollContainer.setWidth("100%");
				
				sap.apf.modeler.ui.utils.helper.onResize(function() {
					if (jQuery(self.getView().getDomRef()).css("display") === "block") {
						width = jQuery(viewInstance.byId("idAppPage").getDomRef()).width();
						height = jQuery(viewInstance.byId("idAppPage").getDomRef()).height();
						scrollContainer.setHeight(height - offsetHeight + "px");
						scrollContainer.setWidth("100%");
					}
				});
				sap.ui.core.UIComponent.getRouterFor(self).attachRoutePatternMatched(function(oEvent) {
					if (oEvent.getParameter("name") === "applicationList") {
						width = jQuery(viewInstance.getDomRef()).width();
						height = jQuery(viewInstance.getDomRef()).height();
						scrollContainer.setHeight(height - offsetHeight + "px");
						scrollContainer.setWidth("100%");
					}
				});
			}
		});
	},
	_setDisplayText : function() {
		this.byId("idAppPage").setTitle(this.oCoreApi.getText("configModelerTitle"));
		this.byId("idAppTitle").setText(this.oCoreApi.getText("applicationOverview"));
		this.byId("idAppNumberTitle").setText(this.oCoreApi.getText("applications"));
		this.byId("idDescriptionLabel").setText(this.oCoreApi.getText("description"));
		this.byId("idSemanticObjectLabel").setText(this.oCoreApi.getText("semanticObject"));
		this.byId("idEditButton").setText(this.oCoreApi.getText("edit"));
		this.byId("idSaveButton").setText(this.oCoreApi.getText("save"));
		this.byId("idCancelButton").setText(this.oCoreApi.getText("cancel"));
		this.byId("idTextCleanupButton").setText(this.oCoreApi.getText("textCleanUp"));
		this.byId("idImportButton").setText(this.oCoreApi.getText("import"));
		this.byId("idNewButton").setTooltip(this.oCoreApi.getText("newApplication"));
	},
	_addConfigStyleClass : function() {
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idJsonFileLabel").addStyleClass("overwriteConfirmationDialogLabels");
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idTextFileLabel").addStyleClass("overwriteConfirmationDialogLabels");
	},
	_setOverwriteConfirmationDialogText : function() {
		sap.ui.core.Fragment.byId("idOverwriteConfirmationFragment", "idOverwriteConfirmationDialog").setTitle(this.oCoreApi.getText("warning"));
		sap.ui.core.Fragment.byId("idOverwriteConfirmationFragment", "idConfirmationMessage").setText(this.oCoreApi.getText("overwriteConfirmationMsg"));
		sap.ui.core.Fragment.byId("idOverwriteConfirmationFragment", "idConfirmationMessage").addStyleClass("dialogText");
		sap.ui.core.Fragment.byId("idOverwriteConfirmationFragment", "idYesButton").setText(this.oCoreApi.getText("yes"));
		sap.ui.core.Fragment.byId("idOverwriteConfirmationFragment", "idNoButton").setText(this.oCoreApi.getText("no"));
	},
	_setImportConfigDialogText : function() {
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idImportConfigDialog").setTitle(this.oCoreApi.getText("importConfig"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idJsonFileLabel").setText(this.oCoreApi.getText("jsonFile"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idJsonFileUploader").setPlaceholder(this.oCoreApi.getText("jsonFileInputPlaceHolder"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idTextFileLabel").setText(this.oCoreApi.getText("textFile"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idTextFileUploader").setPlaceholder(this.oCoreApi.getText("textFileInputPlaceHolder"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idUploadOfConfig").setText(this.oCoreApi.getText("upload"));
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idCancelImportOfConfig").setText(this.oCoreApi.getText("cancel"));
	},
	_setConfirmationDialogText : function() {
		sap.ui.core.Fragment.byId("idConfirmationDialogFragment", "idDeleteConfirmation").setTitle(this.oCoreApi.getText("confirmation"));
		sap.ui.core.Fragment.byId("idConfirmationDialogFragment", "idDeleteButton").setText(this.oCoreApi.getText("deleteButton"));
		sap.ui.core.Fragment.byId("idConfirmationDialogFragment", "idCancelButtonDialog").setText(this.oCoreApi.getText("cancel"));
	},
	_setNewApplicationText : function() {
		sap.ui.core.Fragment.byId("idAddNewApplicationFragment", "idNewApp").setTitle(this.oCoreApi.getText("newApplication"));
		sap.ui.core.Fragment.byId("idAddNewApplicationFragment", "idDescriptionLabelApp").setText("*" + this.oCoreApi.getText("description"));
		sap.ui.core.Fragment.byId("idAddNewApplicationFragment", "idSemanticObjectLabelApp").setText(this.oCoreApi.getText("semanticObject"));
		sap.ui.core.Fragment.byId("idAddNewApplicationFragment", "idSaveButtonApp").setText(this.oCoreApi.getText("save"));
		sap.ui.core.Fragment.byId("idAddNewApplicationFragment", "idCancelButtonApp").setText(this.oCoreApi.getText("cancel"));
	},
	_addApplicationStyleClass : function() {
		this.byId("idAppNumberTitle").addStyleClass("appCountLabel");
		this.byId("idAppDescription").addStyleClass("cursor");
		this.byId("idSemanticObject").addStyleClass("cursor");
		this.byId("idNewButton").addStyleClass("newButton");
		this.byId("idAppListScrollContainer").addStyleClass("applicationListScroll");
		this.byId("idNoOfConfig").addStyleClass("applicationCount");
		this.byId("idAppTitle").addStyleClass("applicationTitle");
		this.byId("idApplicationToolbar").addStyleClass("applicationTitleLayout");
	},
	_updateAppList : function() {
		var applications = this.applicationHandler.getList();
		var appCount = applications.length;
		var aAppDetails = [];
		applications.forEach(function(application) {
			var oAppDetails = {};
			oAppDetails.id = application.Application;
			oAppDetails.description = application.ApplicationName;
			oAppDetails.semanticObject = application.SemanticObject;
			aAppDetails.push(oAppDetails);
		});
		var jsonData = {
			appCount : "(" + appCount + ")",
			tableData : aAppDetails
		};
		if (this.oModel !== undefined) {
			this.oModel.setSizeLimit(1000);
			this.oModel.setData(jsonData);
			this.getView().setModel(this.oModel);
		}
	},
	_enableDisplayMode : function() {
		this.bIsEditMode = false;
		this.byId("idEditButton").setVisible(true);
		this.byId("idSaveButton").setVisible(false);
		this.byId("idSaveButton").setEnabled(false);
		this.byId("idTextCleanupButton").setEnabled(false);
		this.byId("idCancelButton").setVisible(false);
		this.byId("idTextCleanupButton").setVisible(false);
		this.byId("idApplicationTable").setMode("None");
		var items = this.byId("idApplicationTable").getItems();
		items.forEach(function(item) {
			item.setType("Navigation");
			item.getCells()[0].setEditable(false);
			item.getCells()[1].setEditable(false);
			item.getCells()[2].setVisible(false);
		});
		this._updateAppList();
	},
	enableEditMode : function() {
		this.bIsEditMode = true;
		this.byId("idEditButton").setVisible(false);
		this.byId("idSaveButton").setVisible(true);
		this.byId("idCancelButton").setVisible(true);
		this.byId("idTextCleanupButton").setVisible(true);
		this.byId("idApplicationTable").setMode("SingleSelectMaster");
		var items = this.byId("idApplicationTable").getItems();
		if (items.length !== 0) {
			items.forEach(function(item) {
				item.getCells()[0].setEditable(true);
				item.getCells()[1].setEditable(true);
				item.getCells()[2].setVisible(true);
				item.setType("Inactive");
			});
		}
	},
	handleDeletePress : function(evt) {
		var sPath = evt.getSource().getBindingContext().getPath().split("/")[2];
		var removeId = this.getView().getModel().getData().tableData[sPath].id;
		var customData = new sap.ui.core.CustomData({
			value : {
				removeId : removeId,
				sPath : sPath
			}
		});
		if (!this.confirmationDialog) {
			this.confirmationDialog = sap.ui.xmlfragment("idConfirmationDialogFragment", "sap.apf.modeler.ui.fragment.confirmationDialog", this);
			this.getView().addDependent(this.confirmationDialog);
			this._setConfirmationDialogText();
		}
		var confirmationMessage = new sap.m.Label();
		confirmationMessage.addStyleClass("dialogText");
		confirmationMessage.setText(this.oCoreApi.getText("deleteApp"));
		this.confirmationDialog.removeAllContent();
		this.confirmationDialog.addContent(confirmationMessage);
		this.confirmationDialog.removeAllCustomData();
		this.confirmationDialog.addCustomData(customData);
		jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.confirmationDialog);
		this.confirmationDialog.open();
	},
	handleConfirmDeletion : function() {
		var removeId = this.confirmationDialog.getCustomData()[0].getValue().removeId;
		if (removeId !== undefined) {
			var self = this;
			this.applicationHandler.removeApplication(removeId, function(oResponse, oMetadata, msgObj) {
				if (msgObj === undefined && (typeof oResponse === "string")) {
					self.confirmationDialog.close();
					self._updateAppList();
					self.enableEditMode();
				} else {
					var oMessageObject = self.oCoreApi.createMessageObject({
						code : "12001"
					});
					oMessageObject.setPrevious(msgObj);
					self.oCoreApi.putMessage(oMessageObject);
				}
			});
		}
	},
	closeDialog : function() {
		if (this.confirmationDialog.isOpen()) {
			this.confirmationDialog.close();
		}
	},
	handleSavePress : function() {
		var self = this;
		var j;
		var updateAppArr = [];
		var appList = this.applicationHandler.getList();
		var tableData = this.getView().getModel().getData().tableData;
		for(j = 0; j < appList.length; j++) {
			if (tableData[j].description !== appList[j].ApplicationName || tableData[j].semanticObject !== appList[j].SemanticObject) {
				updateAppArr.push(tableData[j]);
			}
		}
		updateAppArr.forEach(function(app) {
			var updatedAppObject = {
				ApplicationName : app.description,
				SemanticObject : app.semanticObject
			};
			self.applicationHandler.setAndSave(updatedAppObject, function(oResponse, oMetadata, msgObj) {
				if (msgObj === undefined && (typeof oResponse === "string")) {
					self._enableDisplayMode();
				} else {
					var oMessageObject = self.oCoreApi.createMessageObject({
						code : "12000"
					});
					oMessageObject.setPrevious(msgObj);
					self.oCoreApi.putMessage(oMessageObject);
				}
			}, app.id);
		});
	},
	handleCancelPress : function() {
		var j;
		var updateAppArr = [];
		var appList = this.applicationHandler.getList();
		var tableData = this.getView().getModel().getData().tableData;
		for(j = 0; j < appList.length; j++) {
			if (tableData[j].description !== appList[j].ApplicationName || tableData[j].semanticObject !== appList[j].SemanticObject) {
				updateAppArr.push(tableData[j]);
			}
		}
		if (updateAppArr.length !== 0) {
			this.unsavedDataConfirmationDialog = sap.ui.xmlfragment("idMessageDialogFragment", "sap.apf.modeler.ui.fragment.messageDialog", this);
			this.getView().addDependent(this.unsavedDataConfirmationDialog);
			this._setUnsavedDataConfirmationDialogText();
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.unsavedDataConfirmationDialog);
			this.unsavedDataConfirmationDialog.open();
		} else {
			this._enableDisplayMode();
		}
	},
	_handleNavigationWithSave : function() {
		this.handleSavePress();
		if (this.unsavedDataConfirmationDialog.isOpen()) {
			this.unsavedDataConfirmationDialog.close();
			this.unsavedDataConfirmationDialog.destroy();
		}
	},
	_handleNavigateWithoutSave : function() {
		if (this.unsavedDataConfirmationDialog.isOpen()) {
			this.unsavedDataConfirmationDialog.close();
			this.unsavedDataConfirmationDialog.destroy();
		}
		this._enableDisplayMode();
	},
	_handlePreventNavigation : function() {
		if (this.unsavedDataConfirmationDialog.isOpen()) {
			this.unsavedDataConfirmationDialog.close();
			this.unsavedDataConfirmationDialog.destroy();
		}
	},
	_setUnsavedDataConfirmationDialogText : function() {
		sap.ui.core.Fragment.byId("idMessageDialogFragment", "idMessageDialog").setTitle(this.oCoreApi.getText("confirmation"));
		sap.ui.core.Fragment.byId("idMessageDialogFragment", "idYesButton").setText(this.oCoreApi.getText("yes"));
		sap.ui.core.Fragment.byId("idMessageDialogFragment", "idNoButton").setText(this.oCoreApi.getText("no"));
		sap.ui.core.Fragment.byId("idMessageDialogFragment", "idCancelButton").setText(this.oCoreApi.getText("cancel"));
		var confirmationMessage = new sap.m.Label();
		confirmationMessage.addStyleClass("dialogText");
		confirmationMessage.setText(this.oCoreApi.getText("unsavedConfiguration"));
		this.unsavedDataConfirmationDialog.removeAllContent();
		this.unsavedDataConfirmationDialog.addContent(confirmationMessage);
	},
	handleListItemSelect : function(evt) { //handler for selection in application list
		var bindingContext = evt.getParameter("listItem").getBindingContext().getPath().split("/")[2];
		this.appId = this.getView().getModel().getData().tableData[bindingContext].id;
		this.byId("idTextCleanupButton").setEnabled(true);
	},
	handleListItemPress : function(evt) { //handler for navigation in application list
		var bindingContext = evt.getParameter("listItem").getBindingContext().getPath().split("/")[2];
		var appId = this.getView().getModel().getData().tableData[bindingContext].id;
		sap.ui.core.UIComponent.getRouterFor(this).navTo("configurationList", {
			appId : appId
		});
	},
	onLiveChange : function() {
		this.byId("idSaveButton").setEnabled(true);
	},
	addNewApplication : function() {
		if (!this.addNewItemDialog) {
			this.addNewItemDialog = sap.ui.xmlfragment("idAddNewApplicationFragment", "sap.apf.modeler.ui.fragment.newApplication", this);
			this.getView().addDependent(this.addNewItemDialog);
			this._setNewApplicationText();
		}
		this.addNewItemDialog.getContent()[0].getContent()[1].setValue("");
		this.addNewItemDialog.getContent()[0].getContent()[3].setValue("FioriApplication");
		this.addNewItemDialog.getBeginButton().setEnabled(false);
		jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.addNewItemDialog);
		this.addNewItemDialog.open();
	},
	applicationDescChange : function(oEvent) {
		this.isAppDesc = oEvent.getParameters().value !== "" ? true : false;
		if (this.isAppDesc) {
			this.addNewItemDialog.getBeginButton().setEnabled(true);
		} else {
			this.addNewItemDialog.getBeginButton().setEnabled(false);
		}
	},
	closeNewAppDialog : function() {
		if (this.addNewItemDialog.isOpen()) {
			this.addNewItemDialog.close();
		}
	},
	handleSaveDialogPress : function() {
		var self = this;
		var aDependents = this.getView().getDependents();
		var appObject = {};
		aDependents.forEach(function(oDependent) {
			if (oDependent.sId === "idAddNewApplicationFragment--idNewApp") {
				appObject.ApplicationName = oDependent.getContent()[0].getContent()[1].getValue() !== "" ? oDependent.getContent()[0].getContent()[1].getValue() : undefined;
				appObject.SemanticObject = oDependent.getContent()[0].getContent()[3].getValue() !== "" ? oDependent.getContent()[0].getContent()[3].getValue() : undefined;
			}
		});
		this.applicationHandler.setAndSave(appObject, function(oResponse, oMetadata, msgObj) {
			if (msgObj === undefined && (typeof oResponse === "string")) {
				self._enableDisplayMode();
				self.byId('idApplicationTable').rerender();
				var appTableItemDOM = self.byId('idApplicationTable').getItems()[self.byId('idApplicationTable').getItems().length - 1].$();
				if (appTableItemDOM.length !== 0) {
					appTableItemDOM[0].scrollIntoView();
				}
				self.addNewItemDialog.close();
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "12000"
				});
				oMessageObject.setPrevious(msgObj);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
	},
	handleImportButtonPress : function() {
		if (!this.importConfigurationDialog) {
			this.importConfigurationDialog = sap.ui.xmlfragment("idImportConfigurationFragment", "sap.apf.modeler.ui.fragment.importConfiguration", this);
			this.getView().addDependent(this.importConfigurationDialog);
			this._setImportConfigDialogText();
			this._addConfigStyleClass();
		}
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idJsonFileUploader").setValue("");
		sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idTextFileUploader").setValue("");
		jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.importConfigurationDialog);
		this.importConfigurationDialog.open();
	},
	handleUploadOfConfig : function() {
		this.oJSONFileUploader = sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idJsonFileUploader");
		this.oTextPropertyFileUploader = sap.ui.core.Fragment.byId("idImportConfigurationFragment", "idTextFileUploader");
		if ((this.oJSONFileUploader.getValue() && this.oTextPropertyFileUploader.getValue()) || this.oJSONFileUploader.getValue()) {
			this.oJSONFileUploader.upload(); //upload the json file if both the files or only the json file have to be uploaded, properties file will be uploaded after json file
		} else {
			this.oTextPropertyFileUploader.upload(); //upload only the properties file
		}
	},
	addAcceptAttribute : function() {
		var jsonFileInput = jQuery("#idImportConfigurationFragment--idJsonFileUploader-fu");
		var propertyFileInput = jQuery("#idImportConfigurationFragment--idTextFileUploader-fu");
		jsonFileInput.attr('accept', '.json');
		propertyFileInput.attr('accept', '.properties');
	},
	closeImportConfigDialog : function() {
		if (this.importConfigurationDialog.isOpen()) {
			this.importConfigurationDialog.close();
		}
	},
	handleJSONFileUploadComplete : function(oEvent) {
		var self = this;
		var sMsg = this.oCoreApi.getText("errorReadingJSONFile");
		var file = oEvent.getSource().oFileUpload.files[0];
		if (file) {
			var reader = new FileReader();
			reader.readAsText(file, "UTF-8");
			reader.onload = function(evt) {
				self.parsedConfigString = JSON.parse(evt.target.result);
				self.appIdFromConfigFile = self.parsedConfigString.configHeader.Application; //application id in the configuration file
				self._importConfigurationFile(self.parsedConfigString); //only json file has to be imported
			};
			reader.onerror = function() {
				sap.m.MessageToast.show(sMsg);
			};
		}
		this.importConfigurationDialog.close();
	},
	handleTextFileUploadComplete : function(oEvent) {
		var self = this;
		var sMsg = this.oCoreApi.getText("errorReadingPropertiesFile");
		var asyncMsg = this.oCoreApi.getText("asyncMsg");
		var file = oEvent.getSource().oFileUpload.files[0];
		if (file) {
			var reader = new FileReader();
			reader.readAsText(file, "UTF-8");
			reader.onload = function(evt) {
				var aLines = evt.target.result.split(/\r?\n/);
				var len = aLines.length;
				var applicationId, i;
				for(i = 0; i < len; i++) {
					applicationId = /^\#\s*ApfApplicationId=[0-9A-F]+\s*$/.exec(aLines[i]);
					if (applicationId !== null) {
						self.appIdFromTextFile = aLines[i].split('=')[1]; //application id in the properties file
					}
				}
				var bExistingApplication;
				for(i = 0; i < self.applicationHandler.getList().length; i++) { //check if the application exists
					if (self.appIdFromTextFile === self.applicationHandler.getList()[i].Application) {
						bExistingApplication = true;
						break;
					} else {
						bExistingApplication = false;
					}
				}
				if (!bExistingApplication && !self.oJSONFileUploader.getValue()) {
					sap.m.MessageToast.show("chooseJsonFile"); //JSON file has to be selected before properties file if the application does not exist
				} else if (self.oJSONFileUploader.getValue()) {
					if (self.appIdFromConfigFile && self.appIdFromTextFile && self.appIdFromTextFile !== self.appIdFromConfigFile) { //chcek if the id of application is same in both the files
						sap.m.MessageToast.show(asyncMsg);
					} else {
						self._importPropertiesFile(evt.target.result); //only property file has to be imported
					}
				} else if (bExistingApplication && !self.oJSONFileUploader.getValue()) {
					self._importPropertiesFile(evt.target.result);
				}
			};
			reader.onerror = function() {
				sap.m.MessageToast.show(sMsg);
			};
		}
		this.importConfigurationDialog.close();
	},
	_importConfigurationFile : function(parsedConfigString) {
		var self = this;
		var successsMsgForConfigFileImport = this.oCoreApi.getText("successsMsgForConfigFileImport");
		this.oCoreApi.importConfiguration(JSON.stringify(parsedConfigString), function(callbackOverwrite, callbackCreateNew) {
			//Config exists overwrite confirmation popup is shown	
			self.callbackOverwrite = callbackOverwrite;
			self.callbackCreateNew = callbackCreateNew;
			self._openConfirmationDialog();
		}, callbackImport);
		function callbackImport(configuration, metadata, messageObject) {
			if (messageObject === undefined) {
				self._updateAppList();
				sap.m.MessageToast.show(successsMsgForConfigFileImport);
				if (self.oTextPropertyFileUploader.getValue()) {
					self.oTextPropertyFileUploader.upload();
				}
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "12002"
				});
				oMessageObject.setPrevious(messageObject);
				self.oCoreApi.putMessage(oMessageObject);
			}
		}
	},
	_importPropertiesFile : function(aPropertyTexts) {
		var self = this;
		var successsMsgForPropertyFileImport = this.oCoreApi.getText("successsMsgForPropertyFileImport");
		this.oCoreApi.importTexts(aPropertyTexts, function(messageObject) { //import the texts from the property file
			if (messageObject === undefined) {
				sap.m.MessageToast.show(successsMsgForPropertyFileImport);
			} else {
				var oMessageObject = self.oCoreApi.createMessageObject({
					code : "12003"
				});
				oMessageObject.setPrevious(messageObject);
				self.oCoreApi.putMessage(oMessageObject);
			}
		});
	},
	handleTypeMissmatchForJSONFile : function() {
		var sMsg = this.oCoreApi.getText("jsonFileMissmatch");
		sap.m.MessageToast.show(sMsg);
	},
	handleTypeMissmatchForPropertiesFile : function() {
		var sMsg = this.oCoreApi.getText("propertiesFileMissmatch");
		sap.m.MessageToast.show(sMsg);
	},
	_openConfirmationDialog : function() {
		if (!this.overwriteConfirmationDialog) {
			this.overwriteConfirmationDialog = sap.ui.xmlfragment("idOverwriteConfirmationFragment", "sap.apf.modeler.ui.fragment.overwriteConfirmation", this);
			this.getView().addDependent(self.overwriteConfirmationDialog);
			this._setOverwriteConfirmationDialogText();
		}
		jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.overwriteConfirmationDialog);
		this.overwriteConfirmationDialog.open();
	},
	handleConfirmOverwriting : function() {
		this.callbackOverwrite();
		this.overwriteConfirmationDialog.close();
	},
	handleNoButtonPress : function() {
		this.callbackCreateNew();
		this.overwriteConfirmationDialog.close();
	},
	handleTextCleanUpPress : function() {
		var self = this;
		this.oCoreApi.getConfigurationHandler(this.appId, function(configurationHandler) {
			self.oTextPool = configurationHandler.getTextPool();
			self.oCoreApi.getUnusedTextKeys(self.appId, function(aUnusedTexts, msgObj) {
				if (msgObj === undefined) {
					self.oTextPool.removeTexts(aUnusedTexts, function(msgObj) {
						if (msgObj === undefined) {
							var successMessageOnTextCleanUp = self.oCoreApi.getText("successtextCleanup");
							sap.m.MessageToast.show(successMessageOnTextCleanUp, {
								width : "20em"
							});
						}
					});
				} else {
					var oMessageObject = self.oCoreApi.createMessageObject({
						code : "12000"
					});
					oMessageObject.setPrevious(msgObj);
					self.oCoreApi.putMessage(oMessageObject);
				}
			});
		});
	},
	navToConfigList : function() {
		var oSelf = this;
		return {
			fn : function() {
				if (!oSelf.bIsEditMode) {
					var bindingContext = this.getBindingContext().getPath().split("/")[2];
					var appId = oSelf.getView().getModel().getData().tableData[bindingContext].id;
					sap.ui.core.UIComponent.getRouterFor(oSelf).navTo("configurationList", {
						appId : appId
					});
				}
			}
		};
	}
});
}; // end of sap/apf/modeler/ui/controller/applicationList.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.category.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.category.controller');
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

/**
* @class category
* @memberOf sap.apf.modeler.ui.controller
* @name category
* @description controller for view.category
*/
sap.ui.controller("sap.apf.modeler.ui.controller.category", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#onInit
	* @description Called on initialization of the view.
	* 			Sets the static texts for all controls in UI.
	* 			Adds style classes to all UI controls.
	* 			Prepares dependecies.
	*  			Sets dynamic text for input controls
	* */
	onInit : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		this.getText = this.oViewData.getText;
		this.params = this.oViewData.oParams;
		var self = this;
		if (!this.oConfigurationEditor) {
			this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId, function(configurationEditor) {
				self.oConfigurationEditor = configurationEditor;
			});
		}
		this._setDisplayText();
		this.setDetailData();
		//Set Mandatory Fields
		var mandatoryFields = [];
		mandatoryFields.push(this.byId("idCategoryTitle"));
		this._setMandatoryFields(mandatoryFields);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#_setDisplayText
	* @description Sets static texts in UI
	* */
	_setDisplayText : function() {
		this.byId("idCategoryTitleLabel").setText("*" + this.getText("category") + ": ");
		this.byId("idCategoryTitle").setPlaceholder(this.getText("newCategory"));
		this.byId("idTotalStepsLabel").setText(this.getText("totalSteps") + ": ");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_addAutoCompleteFeatureOnInputs
	 * @description Adds 'Auto Complete Feature' to the input fields in the view
	 * 		using sap.apf.modeler.ui.utils.TextPoolHelper.
	 * */
	_addAutoCompleteFeatureOnInputs : function() {
		if (this.oConfigurationHandler) {
			var oInputControl = this.byId("idCategoryTitle");
			var oTextPoolHelper = new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);
			var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;
			var oDependenciesForText = {
				oTranslationFormat : oTranslationFormat,
				type : "text"
			};
			oTextPoolHelper.setAutoCompleteOn(oInputControl, oDependenciesForText);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#setDetailData
	* @description Sets dynamic texts for controls
	* */
	setDetailData : function() {
		var self = this;
		if (this.params && this.params.arguments && this.params.arguments.categoryId) {
			this.oCategory = this.oConfigurationEditor.getCategory(this.params.arguments.categoryId);
		}
		if (this.oCategory) {
			var nSteps = this.oConfigurationEditor.getCategoryStepAssignments(this.oCategory.getId()).length;
			if (this.oTextPool.get(this.oCategory.labelKey) !== undefined) {
				this.byId("idCategoryTitle").setValue(this.oTextPool.get(this.oCategory.labelKey).TextElementDescription);
			} else {
				this.byId("idCategoryTitle").setValue(this.oCategory.labelKey);
			}
			this.byId("idTotalSteps").setValue(nSteps);
			//TODO set the value of the  representations when available, for now placeholder is given
		} else {//create a new category
			var newCategoryId = this.oConfigurationEditor.setCategory();
			this.oCategory = this.oConfigurationEditor.getCategory(newCategoryId);
			var oCategoryInfo = {
				id : newCategoryId
			};
			this.oViewData.updateSelectedNode(oCategoryInfo);
		}
		this._addAutoCompleteFeatureOnInputs();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#handleChangeDetailValue
	* @description Handler for change event on chartTypes dropdwn
	* */
	handleChangeDetailValue : function(oEvent) { //event handler to check if any value is changed in the category form
		this.oConfigurationEditor.setIsUnsaved();
		var sCategoryTitle = this.byId("idCategoryTitle").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.CATEGORY_TITLE;
		var sCategoryTitleId = this.oTextPool.setText(sCategoryTitle, oTranslationFormat);
		this.categoryObj = {
			labelKey : sCategoryTitleId
		};
		var oCategoryInfo = {};
		if (sCategoryTitle) {
			this.oConfigurationEditor.setCategory(this.categoryObj, this.oCategory.getId());
			oCategoryInfo.name = sCategoryTitle;
			if (sCategoryTitle) {
				this.oViewData.updateSelectedNode(oCategoryInfo);
			}
		}
		var sTitle = this.getText("category") + ": " + sCategoryTitle;
		this.oViewData.updateTitleAndBreadCrumb(sTitle);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_setMandatoryFields
	 * @param {Array} fields - Array of form fields
	 * @description Set mandatory fields on the instance level  
	 * */
	_setMandatoryFields : function(fields) {
		this.mandatoryFields = this.mandatoryFields || [];
		for( var i = 0; i < fields.length; i++) {
			fields[i].isMandatory = true;
			this.mandatoryFields.push(fields[i]);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_getMandatoryFields
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description getter for mandatory fields
	 * */
	_getMandatoryFields : function() {
		return this.mandatoryFields;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_setValidationState
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description Set validation state of sub view
	 * */
	_setValidationState : function() {
		var mandatoryFields = this._getMandatoryFields();
		for( var i = 0; i < mandatoryFields.length; i++) {
			if (mandatoryFields[i].isMandatory === true) {
				this.isValidState = (mandatoryFields[i].getValue() !== "") ? true : false;
				if (this.isValidState === false) {
					break;
				}
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#getValidationState
	 * @description Getter for getting the current validation state of sub view
	 * */
	getValidationState : function() {
		this._setValidationState(); //Set the validation state of view
		var isValidState = (this.isValidState !== undefined) ? this.isValidState : true;
		return isValidState;
	}
});

}; // end of sap/apf/modeler/ui/controller/category.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.configuration.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.configuration.controller');
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

/**
* @class configuration
* @memberOf sap.apf.modeler.ui.controller
* @name configuration
* @description controller for view.configuration
*/
sap.ui.controller("sap.apf.modeler.ui.controller.configuration", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.configuration#onInit
	* @description Called on initialization of the view.
	* 			Sets the static texts for all controls in UI.
	* 			Adds style classes to all UI controls.
	* 			Prepares dependecies.
	*  			Sets dynamic text for input controls
	* */
	onInit : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.oApplicationHandler = this.oViewData.oApplicationHandler;
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		this.getText = this.oViewData.getText;
		this.params = this.oViewData.oParams;
		this._setDisplayText();
		this.setDetailData();
		//Set Mandatory Fields
		var mandatoryFields = [];
		mandatoryFields.push(this.byId("idConfigTitle"));
		this._setMandatoryFields(mandatoryFields);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.configuration#_setDisplayText
	* @description Sets static texts in UI
	* */
	_setDisplayText : function() {
		this.byId("idConfigTitleLabel").setText("*" + this.getText("configTitle") + ": ");
		this.byId("idConfigTitle").setPlaceholder(this.getText("newConfiguration"));
		this.byId("idConfigurationIdLabel").setText(this.getText("configurationId") + ": ");
		this.byId("idSemanticObjectLabel").setText(this.getText("semanticObject") + ": ");
		//this.byId("idOriginOfConfigLabel").setText(this.getText("originOfConfig"));
		this.byId("idNoOfCategoriesLabel").setText(this.getText("noOfCategories") + ": ");
		this.byId("idNoOfStepsLabel").setText(this.getText("noOfSteps") + ": ");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.configuration#setDetailData
	* @description Sets dynamic texts for controls
	* */
	setDetailData : function() {
		if (this.params && this.params.arguments && this.params.arguments.configId) {
			var oExistingConfig = this.oConfigurationHandler.getConfiguration(this.params.arguments.configId);
		}
		if (oExistingConfig) {
			this.byId("idConfigTitle").setValue(oExistingConfig.AnalyticalConfigurationName);
			if (oExistingConfig.AnalyticalConfiguration.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === -1) { // set the id of the configuration only when it is saved configuration
				this.byId("idConfigurationId").setValue(oExistingConfig.AnalyticalConfiguration);
			}
			var nCategories = this.oConfigurationEditor.getCategories().length;
			var nSteps = this.oConfigurationEditor.getSteps().length;
			this.byId("idNoOfCategories").setValue(nCategories);
			this.byId("idNoOfSteps").setValue(nSteps);
			var appObject = this.oApplicationHandler.getApplication(this.params.arguments.appId);
			if (appObject !== undefined) {
				//self.getView().byId("idOriginOfConfig").setValue(appObject.ApplicationName);
				this.byId("idSemanticObject").setValue(appObject.SemanticObject);
				//TODO set the value of the number of categories, steps and representations when available, for now placeholder is given
			}
		} else {
			var applicationObject = this.oApplicationHandler.getApplication(this.params.arguments.appId);
			if (applicationObject) {
				this.byId("idSemanticObject").setValue(applicationObject.SemanticObject);
			}
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.configuration#handleChangeDetailValue
	* @description Handler for change event on configuration Title input control
	* */
	handleChangeDetailValue : function() { //event handler to check if any value is changed in the configuration form
		var self = this;
		var configInfo = {};
		var sConfigTitle = this.byId("idConfigTitle").getValue().trim();
		var configObj = {
			AnalyticalConfigurationName : sConfigTitle
		};
		if (this.oConfigurationEditor) {
			this.oConfigurationEditor.setIsUnsaved();
		}
		var tempConfigId;
		var oConfigExist = this.oConfigurationHandler.getConfiguration(this.params.arguments.configId);
		if (sConfigTitle !== "" && sConfigTitle !== undefined) {
			if (oConfigExist !== undefined) { //updates a configuration
				this.oConfigurationHandler.setConfiguration(configObj, this.params.arguments.configId);
				//sets the application title
				this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId, function(configurationEditor) {
					var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;
					var sApplicationTitleId = self.oTextPool.setText(sConfigTitle, oTranslationFormat);
					configurationEditor.setApplicationTitle(sApplicationTitleId);
					configInfo.name = sConfigTitle;
					var sTitle = self.getText("configuration") + ": " + sConfigTitle;
					if (sConfigTitle) {
						self.oViewData.updateSelectedNode(configInfo);
						self.oViewData.updateTitleAndBreadCrumb(sTitle);
					}
				});
			} else { //saves a configuration
				tempConfigId = this.oConfigurationHandler.setConfiguration(configObj);
				//sets the application title
				this.oConfigurationHandler.loadConfiguration(tempConfigId, function(configurationEditor) {
					var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.APPLICATION_TITLE;
					var sApplicationTitleId = self.oTextPool.setText(sConfigTitle, oTranslationFormat);
					configurationEditor.setApplicationTitle(sApplicationTitleId);
					var context = {
						appId : self.params.arguments.appId,
						configId : tempConfigId
					};
					configInfo.name = sConfigTitle;
					var sTitle = self.getText("configuration") + ": " + sConfigTitle;
					configInfo.id = oConfigExist === undefined ? configObj.AnalyticalConfiguration : undefined;
					if (sConfigTitle) {
						self.oViewData.updateSelectedNode(configInfo, context);
						self.oViewData.updateTitleAndBreadCrumb(sTitle);
					}
				});
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_setMandatoryFields
	 * @param {Array} fields - Array of form fields
	 * @description Set mandatory fields on the instance level  
	 * */
	_setMandatoryFields : function(fields) {
		this.mandatoryFields = this.mandatoryFields || [];
		for( var i = 0; i < fields.length; i++) {
			fields[i].isMandatory = true;
			this.mandatoryFields.push(fields[i]);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_getMandatoryFields
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description getter for mandatory fields
	 * */
	_getMandatoryFields : function() {
		return this.mandatoryFields;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#_setValidationState
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description Set validation state of sub view
	 * */
	_setValidationState : function() {
		var mandatoryFields = this._getMandatoryFields();
		for( var i = 0; i < mandatoryFields.length; i++) {
			if (mandatoryFields[i].isMandatory === true) {
				this.isValidState = (mandatoryFields[i].getValue() !== "") ? true : false;
				if (this.isValidState === false) {
					break;
				}
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.category#getValidationState
	 * @description Getter for getting the current validation state of sub view
	 * */
	getValidationState : function() {
		this._setValidationState(); //Set the validation state of view
		var isValidState = (this.isValidState !== undefined) ? this.isValidState : true;
		return isValidState;
	}
});

}; // end of sap/apf/modeler/ui/controller/configuration.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.facetFilter.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.facetFilter.controller');
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/

/**
* @class facetFilter
* @memberOf sap.apf.modeler.ui.controller
* @name facetFilter
* @description controller for view.facetFilter
*/
sap.ui.controller("sap.apf.modeler.ui.controller.facetFilter", {
	/**
	* @public
	* @function
	* @name sap.apf.modeler.ui.controller.facetFilter#onInit
	* @description Called on initialization of the view.
	* Sets the static texts for all controls in UI.
	* Sets the scroll height for the container.
	* Adds style classes to all UI controls.
	* Prepares dependecies.
	* Sets dynamic text for input controls
	* */
	onInit : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.getText = this.oViewData.getText;
		this.params = this.oViewData.oParams;
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		var self = this;
		if (!this.oConfigurationEditor) {
			this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId, function(configurationEditor) {
				self.oConfigurationEditor = configurationEditor;
			});
		}
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		//this._getDependencies(); //get dependencies from router
		this._addConfigStyleClass();
		this._setDisplayText();
		this.setDetailData();
		//Set Mandatory Fields
		var mandatoryFields = [];
		mandatoryFields.push(this.byId("idffProperty"));
		mandatoryFields.push(this.byId("idLabel"));
		mandatoryFields.push(this.byId("idVHDefaultValues"));
		mandatoryFields.push(this.byId("idVHfunction"));
		mandatoryFields.push(this.byId("idVHEntity"));
		mandatoryFields.push(this.byId("idVHSelectProperties"));
		mandatoryFields.push(this.byId("idFREntity"));
		mandatoryFields.push(this.byId("idFRSelectProperties"));
		this._setMandatoryFields(mandatoryFields);
	},
	onAfterRendering : function() {
		this._setMandatoryFieldsVHD();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.facetFilter#_addConfigStyleClass
	* @description Adds style classes to the UI controls
	* */
	_addConfigStyleClass : function() {
		this.byId("idValueHelpTitle").addStyleClass("formTextTitle");
		this.byId("idFilterResolutionTitle").addStyleClass("formTextTitle");
		this.byId("idScrollContent").addStyleClass("scrollContentLayout");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.facetFilter#_addAutoCompleteFeatureOnInputs
	* @description Adds 'Auto Complete Feature' to the input fields in the view
	* using sap.apf.modeler.ui.utils.TextPoolHelper.
	* */
	_addAutoCompleteFeatureOnInputs : function() {
		if (this.oConfigurationHandler) {
			var oTextPoolHelper = new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);
			var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;
			var oDependenciesForText = {
				oTranslationFormat : oTranslationFormat,
				type : "text"
			};
			var oFacetFilterLabel = this.byId("idLabel");
			oTextPoolHelper.setAutoCompleteOn(oFacetFilterLabel, oDependenciesForText);
			//autocomplete for source
			var oDependenciesForService = {
				oConfigurationEditor : this.oConfigurationEditor,
				type : "service"
			};
			var oFacetFilterValueHelpSource = this.byId("idVHSource");
			oTextPoolHelper.setAutoCompleteOn(oFacetFilterValueHelpSource, oDependenciesForService);
			var oFacetFilterFilterResolutionSource = this.byId("idFRSource");
			oTextPoolHelper.setAutoCompleteOn(oFacetFilterFilterResolutionSource, oDependenciesForService);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.facetFilte#_setDisplayText
	* @description Sets static texts in UI
	* */
	_setDisplayText : function() {
		this.byId("idLabel").setPlaceholder(this.getText("facetFilterName"));
		this.byId("idValueHelpTitle").setText(this.getText("valueHelp"));
		this.byId("idFilterResolutionTitle").setText(this.getText("filterResolution"));
		//this.byId("idFacetFilterLabel").setText(this.getText("facetFilter"));
		this.byId("idFfPropertyLabel").setText("*" + this.getText("ffProperty") + ": ");
		this.byId("idFfLabel").setText("*" + this.getText("ffLabel") + ": ");
		this.byId("idFfAliasLabel").setText(this.getText("ffAlias") + ": ");
		this.byId("idSelectionModeLabel").setText(this.getText("ffSelectionMode") + ": ");
		this.byId("idVhSourceLabel").setText(this.getText("vhSource") + ": ");
		this.byId("idVhEntityLabel").setText(this.getText("vhEntity") + ": ");
		this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties") + ": ");
		this.byId("idVhDefaultValueModeLabel").setText(this.getText("vhDefaultValueMode") + ": ");
		this.byId("idVhDefaultValuesLabel").setText(this.getText("vhDefaultValues") + ": ");
		this.byId("idVhFunctionLabel").setText(this.getText("function") + ": ");//Default Function
		this.byId("idVhSourceLabel1").setText(this.getText("vhSource") + ": ");
		this.byId("idVhEntityLabel1").setText(this.getText("vhEntity") + ": ");
		this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties") + ": ");
		this.byId("single").setText(this.getText("singleSelection"));
		this.byId("multi").setText(this.getText("multipleSelection"));
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.facetFilte#setDetailData
	* @description Sets dynamic texts for controls
	* */
	setDetailData : function() {
		var aPropertiesForControl = [];
		this._addAutoCompleteFeatureOnInputs();
		var aAllKnowProperties = this.oConfigurationEditor.getAllKnownProperties();
		aAllKnowProperties.forEach(function(property) {
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aPropertiesForControl.push(oProp);
		});
		var oDataForProperties = {
			Properties : aPropertiesForControl
		};
		var oModelForFFProp = new sap.ui.model.json.JSONModel();
		oModelForFFProp.setSizeLimit(500);
		oModelForFFProp.setData(oDataForProperties);
		this.byId("idffProperty").setModel(oModelForFFProp);
		var oModelForFFAlias = new sap.ui.model.json.JSONModel();
		oModelForFFAlias.setSizeLimit(500);
		oModelForFFAlias.setData(oDataForProperties);
		this.byId("idAlias").setModel(oModelForFFAlias);
		var DVModes = [ {
			dvKey : this.getText("fixedValues"),
			dvName : this.getText("fixedValues")
		}, {
			dvKey : this.getText("function"),
			dvName : this.getText("function")
		} ];
		var oDataForDVMode = {
			DVModes : DVModes
		};
		var oModelForDVMode = new sap.ui.model.json.JSONModel();
		oModelForDVMode.setSizeLimit(500);
		oModelForDVMode.setData(oDataForDVMode);
		this.byId("idVHDefaultValueMode").setModel(oModelForDVMode);
		if (this.params && this.params.arguments && this.params.arguments.facetFilterId) {
			this.facetFilter = this.oConfigurationEditor.getFacetFilter(this.params.arguments.facetFilterId);
		}
		if (this.facetFilter) {
			if (this.params && this.params.arguments && this.params.arguments.facetFilterId) {
				this.facetFilter = this.oConfigurationEditor.getFacetFilter(this.params.arguments.facetFilterId);
			}
			if (this.facetFilter.getProperty() !== undefined && this.facetFilter.getProperty() !== null) {
				this.byId("idffProperty").setValue(this.facetFilter.getProperty());
			}
			if (this.facetFilter.getLabelKey() !== undefined && this.facetFilter.getLabelKey() !== null && this.oTextPool.get(this.facetFilter.getLabelKey())) {
				this.byId("idLabel").setValue(this.oTextPool.get(this.facetFilter.getLabelKey()).TextElementDescription);
			} else {
				this.byId("idLabel").setValue(this.params.arguments.facetFilterId);
			}
			if (this.facetFilter.getAlias() !== undefined) {
				this.byId("idAlias").setValue(this.facetFilter.getAlias());
			}
			if (this.facetFilter.isMultiSelection() !== undefined) {
				this.byId("multi").setSelected(this.facetFilter.isMultiSelection());
				this.byId("single").setSelected(!this.facetFilter.isMultiSelection());
			}
			if (this.facetFilter.getServiceOfValueHelp() !== undefined) {
				this.byId("idVHSource").setValue(this.facetFilter.getServiceOfValueHelp());
				var sSource = this.facetFilter.getServiceOfValueHelp();
				var aAllEntitySets = [];
				var aAllEntitySetsForControll = [];
				aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
				aAllEntitySets.forEach(function(entiset) {
					var oEntitySet = {};
					oEntitySet.entityKey = entiset;
					oEntitySet.entityName = entiset;
					aAllEntitySetsForControll.push(oEntitySet);
				});
				var oDataForEntitySets = {
					Entities : aAllEntitySetsForControll
				};
				var oModel = new sap.ui.model.json.JSONModel();
				oModel.setSizeLimit(500);
				oModel.setData(oDataForEntitySets);
				this.byId("idVHEntity").setModel(oModel);
				this.byId("idVhEntityLabel").setText("*" + this.getText("vhEntity") + ": ");
				this.byId("idVhSelectPropertiesLabel").setText("*" + this.getText("vhSelectProperties") + ": ");
			}
			if (this.facetFilter.getEntitySetOfValueHelp() !== undefined) {
				this.byId("idVHEntity").setSelectedKey(this.facetFilter.getEntitySetOfValueHelp());
				var sEntity = this.facetFilter.getEntitySetOfValueHelp();
				var sServiceRoot = this.facetFilter.getServiceOfValueHelp();
				var aProperties = [];
				aPropertiesForControl = [];
				aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sServiceRoot, sEntity);
				var sDefaltSelectedProperty = aProperties[0];
				aProperties.forEach(function(property) {
					var oProp = {};
					oProp.propertyKey = property;
					oProp.propertyName = property;
					aPropertiesForControl.push(oProp);
				});
				var oDataForSelProperties = {
					Properties : aPropertiesForControl
				};
				var oModelForSelProp = new sap.ui.model.json.JSONModel();
				oModelForSelProp.setSizeLimit(500);
				oModelForSelProp.setData(oDataForSelProperties);
				this.byId("idVHSelectProperties").setModel(oModelForSelProp);
			}
			if (this.facetFilter.getSelectPropertiesOfValueHelp() && this.facetFilter.getSelectPropertiesOfValueHelp().length > 0) {
				this.byId("idVHSelectProperties").setSelectedKeys(this.facetFilter.getSelectPropertiesOfValueHelp());
			}
			if (!this.facetFilter.isMultiSelection()) {
				this.byId("idVhDefaultValuesLabel").setText("*" + this.getText("vhDefaultValues") + ": ");
				this.byId("idVhFunctionLabel").setText("*" + this.getText("function") + ": ");//Default Function
			}
			if (this.facetFilter.getPreselectionFunction()) {
				this.byId("idVhDefaultValuesLabelLayout").setVisible(false);
				this.byId("idVhFunctionLabelLayout").setVisible(true);
				this.byId("idVHDefaultValueMode").setSelectedKey(this.getText("function"));
				this.byId("idVHfunction").setValue(this.facetFilter.getPreselectionFunction());
				if (!this.facetFilter.isMultiSelection()) {
					this.byId("idVHfunction").isMandatory = true;
				}
			} else {
				this.byId("idVhDefaultValuesLabelLayout").setVisible(true);
				this.byId("idVhFunctionLabelLayout").setVisible(false);
				this.byId("idVHDefaultValueMode").setSelectedKey(this.getText("fixedValues"));
				if (this.facetFilter.getPreselectionDefaults().length > 0) {
					var sPreselectionDefaults;
					if (this.facetFilter.isMultiSelection()) {
						sPreselectionDefaults = this.facetFilter.getPreselectionDefaults().join(',');
					} else {
						sPreselectionDefaults = this.facetFilter.getPreselectionDefaults()[0];
						this.byId("idVHDefaultValueMode").isMandatory = true;
					}
					this.byId("idVHDefaultValues").setValue(sPreselectionDefaults);
				}
			}
			if (this.facetFilter.getServiceOfFilterResolution() !== undefined && this.facetFilter.getServiceOfFilterResolution() !== "" && this.facetFilter.getServiceOfFilterResolution() !== null) {
				sSource = this.facetFilter.getServiceOfFilterResolution();
				this.byId("idFRSource").setValue(sSource);
				aAllEntitySets = [];
				aAllEntitySetsForControll = [];
				aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
				aAllEntitySets.forEach(function(entiset) {
					var oEntitySet = {};
					oEntitySet.entityKey = entiset;
					oEntitySet.entityName = entiset;
					aAllEntitySetsForControll.push(oEntitySet);
				});
				var oDataForEntityFRSets = {
					Entities : aAllEntitySetsForControll
				};
				var oModelForFREntity = new sap.ui.model.json.JSONModel();
				oModelForFREntity.setSizeLimit(500);
				oModelForFREntity.setData(oDataForEntityFRSets);
				this.byId("idFREntity").setModel(oModelForFREntity);
				this.byId("idVhEntityLabel1").setText("*" + this.getText("vhEntity") + ": ");
				this.byId("idVhSelectPropertiesLabel1").setText("*" + this.getText("vhSelectProperties") + ": ");
			}
			if (this.facetFilter.getEntitySetOfFilterResolution() !== undefined && this.facetFilter.getEntitySetOfFilterResolution() !== null && this.facetFilter.getEntitySetOfFilterResolution() !== "") {
				sEntity = this.facetFilter.getEntitySetOfFilterResolution();
				sServiceRoot = this.facetFilter.getServiceOfFilterResolution();
				this.byId("idFREntity").setSelectedKey(this.facetFilter.getEntitySetOfFilterResolution());
				aProperties = [];
				aPropertiesForControl = [];
				aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sServiceRoot, sEntity);
				sDefaltSelectedProperty = aProperties[0];
				aProperties.forEach(function(property) {
					var oProp = {};
					oProp.propertyKey = property;
					oProp.propertyName = property;
					aPropertiesForControl.push(oProp);
				});
				var oDataForFRSelProperties = {
					Properties : aPropertiesForControl
				};
				var oModelForFRSelProp = new sap.ui.model.json.JSONModel();
				oModelForFRSelProp.setSizeLimit(500);
				oModelForFRSelProp.setData(oDataForFRSelProperties);
				this.byId("idFRSelectProperties").setModel(oModelForFRSelProp);
			}
			if (this.facetFilter.getSelectPropertiesOfFilterResolution() !== undefined && this.facetFilter.getSelectPropertiesOfFilterResolution().length > 0) {
				this.byId("idFRSelectProperties").setSelectedKeys(this.facetFilter.getSelectPropertiesOfFilterResolution());
			}
		} else {
			var sFacetFilterId = this.oConfigurationEditor.createFacetFilter();
			this.facetFilter = this.oConfigurationEditor.getFacetFilter(sFacetFilterId);
			this.facetFilter.setMultiSelection(true);
			this.byId("multi").setSelected(true);
			var facetFilterInfo = {
				id : sFacetFilterId
			};
			this.oViewData.updateSelectedNode(facetFilterInfo);
		}
	},
	handleChangeForProperty : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var sProperty = this.byId("idffProperty").getValue().trim();
		if (sProperty !== "" && sProperty !== null) {
			this.facetFilter.setProperty(sProperty);
		}
	},
	handleChangeForLabel : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var self = this;
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.FACETFILTER_LABEL;
		var sFacetFilterLabel = this.byId("idLabel").getValue().trim();
		var sFacetFilterLabelId = self.oTextPool.setText(sFacetFilterLabel, oTranslationFormat);
		if (sFacetFilterLabel !== "" && sFacetFilterLabel !== null) {
			this.facetFilter.setLabelKey(sFacetFilterLabelId);
		}
		var facetFilterInfo = {};
		facetFilterInfo.name = sFacetFilterLabel;
		facetFilterInfo.id = this.facetFilter.getId();
		if (sFacetFilterLabel !== "" && sFacetFilterLabel !== null) {
			this.oViewData.updateSelectedNode(facetFilterInfo, this.bIsNew);
		}
		var sTitle = this.getText("facetFilter") + ": " + sFacetFilterLabel;
		this.oViewData.updateTitleAndBreadCrumb(sTitle);
	},
	handleChangeForAlias : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sAlias = this.byId("idAlias").getValue().trim();
		this.facetFilter.setAlias(sAlias);
	},
	_changeInSelectionMode : function() {
		if (!this.facetFilter.isMultiSelection()) {
			var aPSDafaults = this.facetFilter.getPreselectionDefaults();
			if (aPSDafaults && aPSDafaults.length > 0) {
				this.facetFilter.setPreselectionDefaults([ aPSDafaults[0] ]);
				if (this.byId("idVHDefaultValues")) {
					this.byId("idVHDefaultValues").setValue(aPSDafaults[0]);
				}
			}
		}
	},
	handleChangeForSelectionModeSingle : function() {
		this.byId("idVhDefaultValuesLabel").setText("*" + this.getText("vhDefaultValues") + ": ");
		this.byId("idVhFunctionLabel").setText("*" + this.getText("function") + ": ");//Default Function
		this.oConfigurationEditor.setIsUnsaved();
		this.facetFilter.setMultiSelection(false);
		if (jQuery(this.byId("idVHfunction").getDomRef()).length >= 1) {
			this.byId("idVHfunction").isMandatory = true;
			this.byId("idVHDefaultValues").isMandatory = false;
		} else {
			this.byId("idVHfunction").isMandatory = false;
			this.byId("idVHDefaultValues").isMandatory = true;
		}
		this._changeInSelectionMode();
	},
	handleChangeForSelectionModeMulti : function() {
		this.byId("idVhDefaultValuesLabel").setText(this.getText("vhDefaultValues") + ": ");
		this.byId("idVhFunctionLabel").setText(this.getText("function") + ": ");//Default Function
		this.oConfigurationEditor.setIsUnsaved();
		this.facetFilter.setMultiSelection(true);
		if (jQuery(this.byId("idVHfunction").getDomRef()).length >= 1) {
			this.byId("idVHfunction").isMandatory = false;
		} else {
			this.byId("idVHDefaultValues").isMandatory = false;
		}
	},
	_checkValidationStateForService : function(bVHService, param) {
		var self = this;
		var sSource, aOldSelProp, oValidVHService = {
			source : undefined,
			entitySet : undefined,
			selectProperty : undefined
		};
		if (bVHService) {
			sSource = this.byId("idVHSource").getValue().trim();
		} else {
			sSource = this.byId("idFRSource").getValue().trim();
		}
		var bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
		var aAllEntitySets = [];
		var aAllEntitySetsForControll = [];
		if (bServiceRegistered) {
			oValidVHService.source = sSource;
			aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
			var sSelectedEntity;
			if (param === "entitySet" || param === "selectProperties") {
				if (bVHService) {
					sSelectedEntity = this.byId("idVHEntity").getSelectedKey();
				} else {
					sSelectedEntity = this.byId("idFREntity").getSelectedKey();
				}
			} else {
				if (bVHService) {
					sSelectedEntity = this.facetFilter.getEntitySetOfValueHelp();
				} else {
					sSelectedEntity = this.facetFilter.getEntitySetOfFilterResolution();
				}
			}
			if (sSelectedEntity) {
				aAllEntitySets.forEach(function(entitySet) {
					if (sSelectedEntity === entitySet) {
						oValidVHService.entitySet = sSelectedEntity;
						if (param === "source") {
							if (bVHService) {
								self.byId("idVHEntity").setSelectedKey(sSelectedEntity);
							} else {
								self.byId("idFREntity").setSelectedKey(sSelectedEntity);
							}
						}
					}
				});
				var aSelectProperties, aCommonProperty = [];
				if (param === "selectProperties") {
					if (bVHService) {
						aSelectProperties = this.byId("idVHSelectProperties").getSelectedKeys();
					} else {
						aSelectProperties = this.byId("idFRSelectProperties").getSelectedKeys();
					}
				} else {
					if (bVHService) {
						aSelectProperties = this.facetFilter.getSelectPropertiesOfValueHelp();
					} else {
						aSelectProperties = this.facetFilter.getSelectPropertiesOfFilterResolution();
					}
				}
				var aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, sSelectedEntity);
				aProperties.forEach(function(propertyFromEntity) {
					aSelectProperties.forEach(function(propertyFromControl) {
						if (propertyFromControl === propertyFromEntity) {
							aCommonProperty.push(propertyFromControl);
						}
					});
				});
				if (aCommonProperty.length > 0) {
					oValidVHService.selectProperty = aCommonProperty;
					if (param !== "selectProperties") {
						if (bVHService) {
							this.byId("idVHSelectProperties").setSelectedKeys(aCommonProperty);
						} else {
							this.byId("idFRSelectProperties").setSelectedKeys(aCommonProperty);
						}
					}
				}
			}
		}
		if (oValidVHService.selectProperty && oValidVHService.entitySet && oValidVHService.source) {
			if (bVHService) {
				this.facetFilter.setServiceOfValueHelp(oValidVHService.source);
				this.facetFilter.setEntitySetOfValueHelp(oValidVHService.entitySet);
				aOldSelProp = this.facetFilter.getSelectPropertiesOfValueHelp();
				aOldSelProp.forEach(function(property) {
					self.facetFilter.removeSelectPropertyOfValueHelp(property);
				});
				oValidVHService.selectProperty.forEach(function(property) {
					self.facetFilter.addSelectPropertyOfValueHelp(property);
				});
			} else {
				this.facetFilter.setServiceOfFilterResolution(oValidVHService.source);
				this.facetFilter.setEntitySetOfFilterResolution(oValidVHService.entitySet);
				aOldSelProp = this.facetFilter.getSelectPropertiesOfFilterResolution();
				aOldSelProp.forEach(function(property) {
					self.facetFilter.removeSelectPropertyOfFilterResolution(property);
				});
				oValidVHService.selectProperty.forEach(function(property) {
					self.facetFilter.addSelectPropertyOfFilterResolution(property);
				});
			}
		}
	},
	handleChangeForVHSource : function() {
		var self = this;
		this.oConfigurationEditor.setIsUnsaved();
		var sSource = this.byId("idVHSource").getValue().trim();
		var bServiceRegistered;
		if (sSource) {
			bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			if (bServiceRegistered) {
				this.byId("idVhEntityLabel").setText("*" + this.getText("vhEntity") + ": ");
				this.byId("idVhSelectPropertiesLabel").setText("*" + this.getText("vhSelectProperties") + ": ");
			}
		} else {
			this.facetFilter.setServiceOfValueHelp(sSource);
			this.facetFilter.setEntitySetOfValueHelp(undefined);
			var aOldSelProp = this.facetFilter.getSelectPropertiesOfValueHelp();
			aOldSelProp.forEach(function(property) {
				self.facetFilter.removeSelectPropertyOfValueHelp(property);
			});
			this.byId("idVhEntityLabel").setText(this.getText("vhEntity") + ": ");
			this.byId("idVhSelectPropertiesLabel").setText(this.getText("vhSelectProperties") + ": ");
		}
		var sDefaultEntitySetKey, aAllEntitySets = [], aAllEntitySetsForControll = [];
		aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
		aAllEntitySets.forEach(function(entiset) {
			var oEntitySet = {};
			oEntitySet.entityKey = entiset;
			oEntitySet.entityName = entiset;
			aAllEntitySetsForControll.push(oEntitySet);
		});
		var oDataForEntitySets = {
			Entities : aAllEntitySetsForControll
		};
		var oModel = new sap.ui.model.json.JSONModel();
		oModel.setSizeLimit(500);
		oModel.setData(oDataForEntitySets);
		this.byId("idVHEntity").setModel(oModel);
		var aProperties = [], aPropertiesForControl = [];
		if (aAllEntitySets.length >= 1) {
			this.byId("idVHEntity").setSelectedKey(aAllEntitySets[0]);
			this.facetFilter.setEntitySetOfValueHelp(aAllEntitySets[0]);
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, aAllEntitySets[0]);
			aProperties.forEach(function(property) {
				var oProp = {};
				oProp.propertyKey = property;
				oProp.propertyName = property;
				aPropertiesForControl.push(oProp);
			});
		}
		//set model for select properties
		var oDataForProperties = {
			Properties : aPropertiesForControl
		};
		var oModelForSelProp = new sap.ui.model.json.JSONModel();
		oModelForSelProp.setSizeLimit(500);
		oModelForSelProp.setData(oDataForProperties);
		this.byId("idVHSelectProperties").setModel(oModelForSelProp);
		this._checkValidationStateForService(true, "source");
	},
	handleChangeForVHEntity : function() {
		var self = this;
		this.oConfigurationEditor.setIsUnsaved();
		var sEntity = this.byId("idVHEntity").getSelectedKey();
		var sServiceRoot = this.byId("idVHSource").getValue().trim();
		var aProperties = [], aPropertiesForControl = [];
		if (sServiceRoot && sServiceRoot !== null && sServiceRoot !== "") {
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sServiceRoot, sEntity);
			aProperties.forEach(function(property) {
				var oProp = {};
				oProp.propertyKey = property;
				oProp.propertyName = property;
				aPropertiesForControl.push(oProp);
			});
			var oDataForProperties = {
				Properties : aPropertiesForControl
			};
			var oModelForSelProp = new sap.ui.model.json.JSONModel();
			oModelForSelProp.setSizeLimit(500);
			oModelForSelProp.setData(oDataForProperties);
			this.byId("idVHSelectProperties").setModel(oModelForSelProp);
			this._checkValidationStateForService(true, "entitySet");
		}
	},
	handleChangeForVHSelectProperties : function() {
		this.oConfigurationEditor.setIsUnsaved();
		this._checkValidationStateForService(true, "selectProperties");
	},
	_setMandatoryFieldsVHD : function() {
		if (!this.facetFilter.isMultiSelection()) {
			if (jQuery(this.byId("idVHfunction").getDomRef()).length >= 1) {
				this.byId("idVHfunction").isMandatory = true;
				this.byId("idVHDefaultValues").isMandatory = false;
			} else {
				this.byId("idVHfunction").isMandatory = false;
				this.byId("idVHDefaultValues").isMandatory = true;
			}
		} else {
			this.byId("idVHfunction").isMandatory = false;
			this.byId("idVHDefaultValues").isMandatory = false;
		}
	},
	handleChangeForDVMode : function() {
		var sDVMode = this.byId("idVHDefaultValueMode").getSelectedKey();
		if (sDVMode === this.getText("fixedValues")) {
			this.byId("idVhDefaultValuesLabelLayout").setVisible(true);
			this.byId("idVhFunctionLabelLayout").setVisible(false);
			this.facetFilter.removePreselectionFunction();
			this.byId("idVHfunction").setValue("");
		} else {
			this.byId("idVhDefaultValuesLabelLayout").setVisible(false);
			this.byId("idVhFunctionLabelLayout").setVisible(true);
			this.facetFilter.removePreselectionDefaults();
			this.byId("idVHDefaultValues").setValue("");
		}
		this._setMandatoryFieldsVHD();
	},
	handleChangeForVHdefaultValues : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var sPreselectionDefaults = this.byId("idVHDefaultValues").getValue().trim();
		var aPreselectionDefaults = sPreselectionDefaults.split(',');
		var aValidPreselectionDefaults = [];
		aPreselectionDefaults.forEach(function(defaultValue) {
			var sValidString = defaultValue.trim();
			if (sValidString) {
				aValidPreselectionDefaults.push(sValidString);
			}
		});
		if (this.facetFilter.isMultiSelection()) {
			this.byId("idVHDefaultValues").isMandatory = false;
			this.facetFilter.setPreselectionDefaults(aValidPreselectionDefaults);
		} else {
			this.byId("idVHDefaultValues").isMandatory = true;
			if (aValidPreselectionDefaults.length > 0) {
				this.facetFilter.setPreselectionDefaults([ aValidPreselectionDefaults[0] ]);//for single selection only first value is sent
			}
		}
	},
	handleChangeForPreselectionFunction : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var sPreselectionFunction = this.byId("idVHfunction").getValue().trim();
		if (this.facetFilter.isMultiSelection()) {
			this.byId("idVHfunction").isMandatory = false;
			if (sPreselectionFunction) {
				this.facetFilter.setPreselectionFunction(sPreselectionFunction);
			}
		} else {
			this.byId("idVHfunction").isMandatory = true;
			if (sPreselectionFunction) {
				this.facetFilter.setPreselectionFunction(sPreselectionFunction);
			}
		}
	},
	handleChangeForFRSource : function() {
		var self = this;
		this.oConfigurationEditor.setIsUnsaved();
		var sSource = this.byId("idFRSource").getValue().trim();
		var bServiceRegistered;
		var aAllEntitySets = [];
		var aAllEntitySetsForControll = [];
		if (sSource) {
			bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			if (bServiceRegistered) {
				this.byId("idVhEntityLabel1").setText("*" + this.getText("vhEntity") + ": ");
				this.byId("idVhSelectPropertiesLabel1").setText("*" + this.getText("vhSelectProperties") + ": ");
			}
		} else {
			this.facetFilter.setServiceOfFilterResolution(sSource);
			this.facetFilter.setEntitySetOfFilterResolution(undefined);
			var aOldSelProp = this.facetFilter.getSelectPropertiesOfFilterResolution();
			aOldSelProp.forEach(function(property) {
				self.facetFilter.removeSelectPropertyOfFilterResolution(property);
			});
			this.byId("idVhEntityLabel1").setText(this.getText("vhEntity") + ": ");
			this.byId("idVhSelectPropertiesLabel1").setText(this.getText("vhSelectProperties") + ": ");
		}
		aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
		aAllEntitySets.forEach(function(entiset) {
			var oEntitySet = {};
			oEntitySet.entityKey = entiset;
			oEntitySet.entityName = entiset;
			aAllEntitySetsForControll.push(oEntitySet);
		});
		var oDataForEntitySets = {
			Entities : aAllEntitySetsForControll
		};
		var oModel = new sap.ui.model.json.JSONModel();
		oModel.setSizeLimit(500);
		oModel.setData(oDataForEntitySets);
		this.byId("idFREntity").setModel(oModel);
		var aProperties = [], aPropertiesForControl = [];
		if (aAllEntitySets.length >= 1) {
			this.byId("idFREntity").setSelectedKey(aAllEntitySets[0]);
			this.facetFilter.setEntitySetOfFilterResolution(aAllEntitySets[0]);
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, aAllEntitySets[0]);
			aProperties.forEach(function(property) {
				var oProp = {};
				oProp.propertyKey = property;
				oProp.propertyName = property;
				aPropertiesForControl.push(oProp);
			});
		}
		var oDataForProperties = {
			Properties : aPropertiesForControl
		};
		var oModelForSelProp = new sap.ui.model.json.JSONModel();
		oModelForSelProp.setSizeLimit(500);
		oModelForSelProp.setData(oDataForProperties);
		this.byId("idFRSelectProperties").setModel(oModelForSelProp);
		this._checkValidationStateForService(false, "source");
	},
	handleChangeForFREntity : function() {
		var self = this;
		this.oConfigurationEditor.setIsUnsaved();
		var sEntity = this.byId("idFREntity").getSelectedKey();
		var sServiceRoot = this.byId("idFRSource").getValue().trim();
		var aProperties = [], aPropertiesForControl = [];
		if (sServiceRoot && sServiceRoot !== null && sServiceRoot !== "") {
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sServiceRoot, sEntity);
			var sDefaltSelectedProperty = aProperties[0];
			aProperties.forEach(function(property) {
				var oProp = {};
				oProp.propertyKey = property;
				oProp.propertyName = property;
				aPropertiesForControl.push(oProp);
			});
			var oDataForProperties = {
				Properties : aPropertiesForControl
			};
			var oModelForSelProp = new sap.ui.model.json.JSONModel();
			oModelForSelProp.setSizeLimit(500);
			oModelForSelProp.setData(oDataForProperties);
			this.byId("idFRSelectProperties").setModel(oModelForSelProp);
			this._checkValidationStateForService(false, "entitySet");
		}
	},
	handleChangeForFRSelectProperties : function() {
		this.oConfigurationEditor.setIsUnsaved();
		this._checkValidationStateForService(false, "selectProperties");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#_setSourceValidationState
	* @description set mandatory fields boolean for source
	* */
	_setSourceValidationState : function() {
		var sSource = this.byId("idVHSource").getValue().trim();
		var sFRSource = this.byId("idFRSource").getValue().trim();
		var bServiceRegistered;
		var bFRServiceRegistered;
		if (sSource !== "") {
			bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			if (bServiceRegistered) {
				this.byId("idVHEntity").isMandatory = true;
				this.byId("idVHSelectProperties").isMandatory = true;
			} else {
				this.byId("idVHEntity").isMandatory = false;
				this.byId("idVHSelectProperties").isMandatory = false;
			}
		} else {
			this.byId("idVHEntity").isMandatory = false;
			this.byId("idVHSelectProperties").isMandatory = false;
		}
		if (sFRSource) {
			bFRServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			if (bFRServiceRegistered) {
				this.byId("idFREntity").isMandatory = true;
				this.byId("idFRSelectProperties").isMandatory = true;
			} else {
				this.byId("idFREntity").isMandatory = false;
				this.byId("idFRSelectProperties").isMandatory = false;
			}
		} else {
			this.byId("idFREntity").isMandatory = false;
			this.byId("idFRSelectProperties").isMandatory = false;
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#_setMandatoryFieldss
	* @param {Array} fields - Array of form fields
	* @description Set mandatory fields on the instance level  
	 * */
	_setMandatoryFields : function(fields) {
		this.mandatoryFields = this.mandatoryFields || [];
		for( var i = 0; i < fields.length; i++) {
			fields[i].isMandatory = true;
			this.mandatoryFields.push(fields[i]);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#_getMandatoryFields
	* @param {Object} oEvent - Event instance of the form field 
	 * @description getter for mandatory fields
	* */
	_getMandatoryFields : function() {
		return this.mandatoryFields;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#_setValidationState
	* @param {Object} oEvent - Event instance of the form field 
	 * @description Set validation state of sub view
	* */
	_setValidationState : function() {
		var mandatoryFields = this._getMandatoryFields();
		for( var i = 0; i < mandatoryFields.length; i++) {
			if (mandatoryFields[i].isMandatory === true) {
				if (typeof mandatoryFields[i].getSelectedKeys === "function") {
					this.isValidState = (mandatoryFields[i].getSelectedKeys().length >= 1) ? true : false;
				} else if (typeof mandatoryFields[i].getValue === "function") {
					this.isValidState = (mandatoryFields[i].getValue() !== "") ? true : false;
				} else {
					this.isValidState = (mandatoryFields[i].getSelectedKey().length >= 1) ? true : false;
				}
				if (this.isValidState === false) {
					break;
				}
			}
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.category#getValidationState
	* @description Getter for getting the current validation state of sub view
	* */
	getValidationState : function() {
		this._setSourceValidationState(); //Set mandatory state for source
		this._setValidationState(); //Set the validation state of view
		var isValidState = (this.isValidState !== undefined) ? this.isValidState : true;
		return isValidState;
	}
});

}; // end of sap/apf/modeler/ui/controller/facetFilter.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.previewContent.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.previewContent.controller');
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
sap.ui.getCore().loadLibrary("sap.viz");




/**
* @class previewContent
* @memberOf sap.apf.modeler.ui.controller
* @name previewContent
* @description controller for view.previewContent
*/
sap.ui.controller("sap.apf.modeler.ui.controller.previewContent", {
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#onInit
	 * @description Called on initialization of the view.
	 * 		Accepts parameters through view#getViewData in the following format :
	 * {	 
			sChartType - {sap.apf.ui.utils.CONSTANTS.representationTypes}  eg : "PieChart",
			sStepTitle - {string} Title of the step eg: "DSO by Country over Time",
			sStepLongTitle - {string} Long Title of the step eg: "DSO by Country over Time"
			aDimensions - {string[]} Field Names of All dimensions from select properties eg : [ "Country", "YearMonth" ],
			aMeasures - {string[]} Field Names of All measures from select properties eg: [ "DSO", "OverdueDSO", "Revenue" ],
			oChartParameter : { // chart parameter similar to the one passed to runtime representations.
				dimensions : [ {
					fieldDesc - {string} Name to be displayed eg: "Country of Customer",
					fieldName - {string} Property Name  eg: "Country",
					kind - {sap.apf.core.constants.representationMetadata.kind} eg: "sectorColor"
				} ],
				measures : [ {
					name - {string} Name to be displayed eg: "Day Sales Outstanding",
					value - {string} Property Name  eg: "DSO",
					kind - {sap.apf.core.constants.representationMetadata.kind} eg: "yAxis"
				} ]
			},
			aSort : [
				{	// sort object similar to the one passed to runtime representations.
					sSortField - {string} Property Name eg: "DSO",
					bDescending - {boolean} eg: true
				}
			],
			aCornerTexts : {	// corner text values.
				sLeftUpper - {string} eg: "DSO",
				sRightUpper - {string} eg: "",
				sLeftLower - {string} eg: "",
				sRightLower - {string} eg: "COUNTRY"
			}
	 *	}
	 *
	 *  Reads data from view#getViewData.
	 *  Prepares dummy data for charts.
	 *  Draw main chart and thumb nail preview.		
	 * */
	onInit : function() {
		// Views
		this.oView = this.getView();
		this.oView.addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oMainChartHolder = this.oView.byId("idMainChart");
		this.oThumbnailChartHolder = this.oView.byId("idThumbnailChartLayout");
		// Data
		this.mParam = this.oView.getViewData();
		// Actions
		this._prepareRepresentationInstance();
		this._drawContent();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_drawContent
	 * @description Draws main chart and thumb nail content.
	 * 				Adds necessary style classes to view.
	 * */
	_drawContent : function() {
		this._drawMainChart();
		this._drawThumbnailContent();
		this._addStyleClasses();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_drawMainChart
	 * @description Gets the mainContent of representation instance and draws it on mainChartHolder.
	 * */
	_drawMainChart : function() {
		var oMainChart = this.oRepresentationInstance.getMainContent(this.mParam.sStepLongTitle, 480, 330);
		this.oMainChartHolder.addItem(oMainChart);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_drawThumbnailContent
	 * @description Draws thumb nail chart.
	 * 				Set Title to thumb nail content.
	 * 				Draws corner texts.
	 * */
	_drawThumbnailContent : function() {
		this._drawThumbnailChart();
		this.oView.byId("idStepTitleText").setText(this.mParam.sStepTitle);
		this._drawCornerTexts();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_drawThumbnailChart
	 * @description Gets the thumbnailContent of representation instance and draws it on oThumbnailChartHolder.
	 * */
	_drawThumbnailChart : function() {
		var oThumbnailChart = this.oRepresentationInstance.getThumbnailContent();
		this.oThumbnailChartHolder.addItem(oThumbnailChart);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_drawCornerTexts
	 * @description Draws corner texts on four place holders.
	 * */
	_drawCornerTexts : function() {
		this.oView.byId("idLeftUpperCornerText").setText(this.mParam.aCornerTexts.sLeftUpper);
		this.oView.byId("idRightUpperCornerText").setText(this.mParam.aCornerTexts.sRightUpper);
		this.oView.byId("idLeftLowerCornerText").setText(this.mParam.aCornerTexts.sLeftLower);
		this.oView.byId("idRightLowerCornerText").setText(this.mParam.aCornerTexts.sRightLower);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_addStyleClasses
	 * @description Adds style classes to various view controls.
	 * */
	_addStyleClasses : function() {
		this.oView.byId("idChartHolder").addStyleClass("supressDialogPadding");
		this.oView.byId("idMainChart").addStyleClass("previewMainChartHolder");
		this.oView.byId("idThumbnail").addStyleClass("previewThumbnailHolder");
		this.oView.byId("idThumbnailLayout").addStyleClass("previewThumbnailLayout");
		this.oView.byId("idThumbnailChartLayout").addStyleClass("previewThumbnailChartLayout");
		this.oView.byId("idTopLayout").addStyleClass("previewThumbnailTopLayout");
		this.oView.byId("idBottomLayout").addStyleClass("previewThumbnailBottomLayout");
		this.oView.byId("idLeftUpperCornerText").addStyleClass("previewThumbnailText");
		this.oView.byId("idRightUpperCornerText").addStyleClass("previewThumbnailText");
		this.oView.byId("idLeftLowerCornerText").addStyleClass("previewThumbnailText");
		this.oView.byId("idRightLowerCornerText").addStyleClass("previewThumbnailText");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_generateSampleData
	 * @description Generates dynamic data based on the dimensions and measures.
	 * 				Sorts the data if sort object is provided.
	 * 				Data grows exponentially based on the number of dimensions available.
	 * 				Each dimension will have (nSamplesPerDimension) data with random values for measures.
	 * @returns {object[]} aSampleData
	 * */
	_generateSampleData : function() {
		var aSampleData = [];
		var nSamplesPerDimension = 3; // Change this value to control the amount of data.
		var i = 0;
		var aDimensions = this.mParam.aDimensions;
		var aMeasures = this.mParam.aMeasures;
		var aSelectedDimensions = this.mParam.oChartParameter.dimensions;
		var aSelectedMeasures = this.mParam.oChartParameter.measures;
		/**
		 * Function to add 'FieldDesc' fields to sample data with the same value as 'FieldName'.
		 * */
		var fnInsertValueToFieldDesc = function(aSelectedFields, sFieldName, sValue, oRow) {
			var aCurrentSelectedFields = aSelectedFields.filter(function(oSelectedField) {
				return oSelectedField.fieldName === sFieldName;
			});
			aCurrentSelectedFields.forEach(function(oCurrentSelectedField) {
				if (!oCurrentSelectedField.fieldDesc || !oCurrentSelectedField.fieldDesc.length) {
					oCurrentSelectedField.fieldDesc = oCurrentSelectedField.fieldName;
				}
				oRow[oCurrentSelectedField.fieldDesc] = sValue;
			});
		};
		var len = Math.pow(nSamplesPerDimension, this.mParam.aDimensions.length);
		for(i = 0; i < len; i++) {
			var oRow = {};
			aDimensions.forEach(function(sDimension, nIndex) {
				var sDimensionValue = sDimension + " - " + (Math.floor(i / Math.pow(nSamplesPerDimension, nIndex)) % nSamplesPerDimension + 1);
				oRow[sDimension] = sDimensionValue;
				fnInsertValueToFieldDesc(aSelectedDimensions, sDimension, sDimensionValue, oRow);
			});
			aMeasures.forEach(function(sMeasure) {
				var sMeasureValue = Math.round(Math.random() * 500);
				oRow[sMeasure] = sMeasureValue;
				fnInsertValueToFieldDesc(aSelectedMeasures, sMeasure, sMeasureValue, oRow);
			});
			aSampleData.push(oRow);
		}
		if (this.mParam.aSort && this.mParam.aSort.length) {
			aSampleData = this._sortData(aSampleData, this.mParam.aSort);
		}
		return aSampleData;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_sortData
	 * @param {object[]} aData - Source data to be sorted.
	 * @param {array} aProperteis - Array of properties by which the data has to be sorted of the form: 
	 * 		[
	 * 			{
	 * 				sProperty - {string}	Name of the property.
	 * 				bDescending - {boolean} Boolean to indicate the order.
	 * 			}
	 * 		]
	 * @description Uses the Array#sort method to sort data.
	 * @returns {object[]} Sorted Data.
	 * */
	_sortData : function(aData, aProperties) {
		return aData.sort(function(oRow1, oRow2) {
			var nResult, i;
			for(i = 0; i < aProperties.length; i++) {
				nResult = oRow1[aProperties[i].sSortField] < oRow2[aProperties[i].sSortField] ? -1 : oRow1[aProperties[i].sSortField] > oRow2[aProperties[i].sSortField] ? 1 : 0;
				nResult = nResult * [ 1, -1 ][+!!aProperties[i].bDescending];
				if (nResult !== 0) {
					return nResult;
				}
			}
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_getRepresentationConstructor
	 * @description Returns representation constructor given representation id.
	 * @returns {string} sConstructor - Constructor name space of the representation.
	 * */
	_getRepresentationConstructor : function(sChartName) {
		var aRepresentationTypes = sap.apf.core.representationTypes();
		var oRepresentationType = aRepresentationTypes.filter(function(oRepresentationType) {
			return oRepresentationType.id === sChartName;
		})[0];
		var sConstructor = oRepresentationType.constructor;
		return sConstructor;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.previewContent#_prepareRepresentationInstance
	 * @description Prepares the representationInstance from the constructor and host it on 'this.oRepresentationInstance'.
	 * 				Invokes 'setData' on the instance by passing sample data and dummy meta data.
	 * */
	_prepareRepresentationInstance : function() {
		var sRepresentationConstructor = this._getRepresentationConstructor(this.mParam.sChartType);
		jQuery.sap.require(sRepresentationConstructor);
		var FnRepresentationConstructor = sap.apf.utils.extractFunctionFromModulePathString(sRepresentationConstructor);
		var oApiStub = {
			getTextNotHtmlEncoded : function(sText) {
				return sText;
			},
			getTextHtmlEncoded : function(sText) {
				return sText;
			}
		};
		this.oRepresentationInstance = new FnRepresentationConstructor(oApiStub, this.mParam.oChartParameter);
		var oMetadataStub = {
			getPropertyMetadata : function() {
				return {};
			}
		};
		var aSampleData = this._generateSampleData();
		this.oRepresentationInstance.setData(aSampleData, oMetadataStub);
	}
});
}; // end of sap/apf/modeler/ui/controller/previewContent.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.representation.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.representation.controller');
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/



/**
* @class representation
* @memberOf sap.apf.modeler.ui.controller
* @name representation
* @description controller for view.representation
*/
sap.ui.controller("sap.apf.modeler.ui.controller.representation", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#onInit
	* @description Called on initialization of the view.
	* Sets the static texts for all controls in UI.
	* Sets the scroll height for the container.
	* Adds style classes to all UI controls.
	* Prepares dependencies.
	* Sets dynamic text for input controls
	* Set a preview button in footer 
	* */
	onInit : function() {
		// Data
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		this.getText = this.oViewData.getText;
		this.getEntityTypeMetadata = this.oViewData.getEntityTypeMetadata;
		this.getRepresentationTypes = this.oViewData.getRepresentationTypes;
		this.mParam = this.oViewData.oParams;
		var self = this;
		if (!this.oConfigurationEditor) {
			this.oConfigurationHandler.loadConfiguration(this.mParam.arguments.configId, function(configurationEditor) {
				self.oConfigurationEditor = configurationEditor;
			});
		}
		this._addConfigStyleClass();
		this._setDisplayText();
		this.setDetailData();
		// Insert Preview Button into the Footer.
		this._oPreviewButton = new sap.m.Button({
			text : this.getText("preview"),
			press : this._handlePreviewButtonPress.bind(this)
		});
		this._insertPreviewButtonInFooter();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_addConfigStyleClass
	* @description Adds style classes to the UI controls.
	* */
	_addConfigStyleClass : function() {
		this.byId("idDirectionLabel").addStyleClass("repFormRightLabel");
		this.byId("idRadioBtnGroup").addStyleClass("radioBtnGrp");
		this.byId("idChartIcon").addStyleClass("chartIcon");
		this.byId("idBasicData").addStyleClass("formTextTitle");
		this.byId("idSorting").addStyleClass("formTextTitle");
		this.byId("idThumbnailTexts").addStyleClass("formTextTitle");
		this.byId("idCornerTextLayout").addStyleClass("cornerTextHLayout");
		this.byId("idScrollContent").addStyleClass("scrollContentLayout");
		this.byId("idCornerTextLayout").addStyleClass("detailPageDataLayout");
		this.byId("idBasicDataLayout").addStyleClass("detailPageDataLayout");
		this.byId("idChartDataLayout").addStyleClass("detailPageDataLayout");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_setDisplayText
	* @description Sets static texts in UI and place holders.
	* */
	_setDisplayText : function() {
		this.byId("idChartTypeLabel").setText(this.getText("chartType") + ":");
		this.byId("idBasicData").setText(this.getText("basicData"));
		this.byId("idSorting").setText(this.getText("sorting"));
		this.byId("idSortingFieldLabel").setText(this.getText("sortingField") + ":");
		this.byId("idDirectionLabel").setText(this.getText("direction") + ":");
		this.byId("idAscending").setText(this.getText("ascending"));
		this.byId("idDescending").setText(this.getText("descending"));
		this.byId("idThumbnailTexts").setText(this.getText("cornerTextLabel"));
		this.byId("idLeftUpper").setPlaceholder(this.getText("leftTop"));
		this.byId("idRightUpper").setPlaceholder(this.getText("rightTop"));
		this.byId("idLeftLower").setPlaceholder(this.getText("leftBottom"));
		this.byId("idRightLower").setPlaceholder(this.getText("rightBottom"));
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#handleChangeForChartType
	* @param {oEvent} oEvt - Selection Event
	* @description Handler for change event on chartTypes drop down.
	*               Updates the property drop downs according to the new chart type.
	*               Updates the representation object with corresponding data.
	*               Updates the tree node with selected representation type.
	*               Updates the title and bread crumb.                         
	* */
	handleChangeForChartType : function(oEvt) {
		var sNewChartType = oEvt.getParameter("selectedItem").getKey();
		this._updateAndSetDatasetsByChartType(sNewChartType);
		this.sCurrentChartType = sNewChartType;
		this.oRepresentation.setRepresentationType(sNewChartType);
		var sAlternateRepresentation, representationContext;
		if (sNewChartType !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
			sAlternateRepresentation = sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;
		}
		var sSelectedChartIcon = this._getChartPictureDataset().sSelectedChartPicture;
		this.oRepresentation.setAlternateRepresentationType(sAlternateRepresentation);
		// Update Tree Node
		var sRepresentationTypeText = this.getText(this.oRepresentation.getRepresentationType());
		var aStepCategories = this.oConfigurationEditor.getCategoriesForStep(this.oParentStep.getId());
		if (aStepCategories.length === 1) {//In case the step of representation is only assigned to one category
			this.oViewData.updateSelectedNode({
				name : sRepresentationTypeText,
				icon : sSelectedChartIcon
			});
		} else {
			this.oViewData.updateTree();
		}
		var sTitle = this.getText("representation") + ": " + sRepresentationTypeText;
		this.oViewData.updateTitleAndBreadCrumb(sTitle);
		this.oConfigurationEditor.setIsUnsaved();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#handleChangeForCornerText
	* @param {oEvent} oEvt - Selection Event
	* @description Handler for change event on corner text input boxes.
	*          Sets the corresponding corner text on the representation object.                
	* */
	handleChangeForCornerText : function(oEvt) {
		var oCornerTextInput = oEvt.getSource();
		var sCornerTextValue = oCornerTextInput.getValue();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.REPRESENTATION_CORNER_TEXT;
		var sCornerTextId = this.oTextPool.setText(sCornerTextValue, oTranslationFormat);
		var sCornerTextName = oCornerTextInput.getBindingPath('value').replace("/", "");
		var sSetCornerTextMethodName = [ "set", sCornerTextName, "CornerTextKey" ].join("");
		this.oRepresentation[sSetCornerTextMethodName](sCornerTextId);
		this.oConfigurationEditor.setIsUnsaved();
		// Run the fall back logic to update the corner text.
		this.mDataset.oCornerTextsDataset[sCornerTextName] = this._getCornerTextsDataset()[sCornerTextName];
		this.mModel.oCornerTextsModel.updateBindings();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_addAutoCompleteFeatureOnInputs
	* @description Adds auto complete feature on all the four corner texts.         
	* */
	_addAutoCompleteFeatureOnInputs : function() {
		var oSelf = this;
		var oTextPoolHelper = new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);
		// Add Feature on Corner Texts
		var oDependenciesForText = {
			oTranslationFormat : sap.apf.modeler.ui.utils.TranslationFormatMap.REPRESENTATION_CORNER_TEXT,
			type : "text"
		};
		var aCornerTextInputIds = [ "idLeftUpper", "idRightUpper", "idLeftLower", "idRightLower" ];
		aCornerTextInputIds.forEach(function(sId) {
			var oInputControl = oSelf.getView().byId(sId);
			oTextPoolHelper.setAutoCompleteOn(oInputControl, oDependenciesForText);
		});
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_bindBasicRepresentationData
	* @description Binds sap.apf.modeler.ui.controller.representation#mModel.oPropertyModel to Basic Data layout.
	*               Iteratively binds the data to each and every control in Basic Data Layout.
	* */
	_bindBasicRepresentationData : function() {
		var oSelf = this;
		var oBasicDataLayout = this.byId("idBasicDataLayout");
		var oPropertyRowTemplate = new sap.ui.layout.Grid({ // add the labels and input control to the grid
			width : "100%"
		});
		// Label
		var oAggregationKindLabel = new sap.m.Label({
			width : "100%",
			textAlign : "Right",
			layoutData : new sap.ui.layout.GridData({
				span : "L3 M3 S3"
			}),
			text : {
				path : "/",
				formatter : function() {
					var sAggRole = this.getBindingContext().getProperty("sAggregationRole");
					var sKind = this.getBindingContext().getProperty("sKind");
					if (sAggRole && sKind) {
						sAggRole = oSelf.getText(sAggRole);
						sKind = oSelf.getText(sKind);
						var sText = oSelf.getText("dim-measure-label", [ sAggRole, sKind ]);
						return sText + ":";
					}
				}
			}
		});
		oPropertyRowTemplate.addContent(oAggregationKindLabel);
		// Select Box
		var oPropertySelectBox = new sap.m.Select({
			width : "100%",
			layoutData : new sap.ui.layout.GridData({
				span : "L4 M3 S3"
			}),
			items : {
				path : "aAllProperties",
				template : new sap.ui.core.ListItem({
					key : "{sName}",
					text : "{sName}"
				})
			},
			selectedKey : "{sSelectedProperty}",
			change : function() {
				oSelf._setPropertiesFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		});
		oPropertyRowTemplate.addContent(oPropertySelectBox);
		// Label for 'Label'
		var oLabel = new sap.m.Label({
			width : "100%",
			textAlign : "Right",
			layoutData : new sap.ui.layout.GridData({
				span : "L1 M2 S2"
			}),
			text : this.getText("label") + ":"
		}).addStyleClass("repFormRightLabel");
		oPropertyRowTemplate.addContent(oLabel);
		// Input for 'Label'
		var oInputLabel = new sap.m.Input({
			width : "100%",
			layoutData : new sap.ui.layout.GridData({
				span : "L3 M2 S2"
			}),
			value : "{sLabel}",
			visible : {
				path : "sLabel",
				formatter : function() {
					if (!this.mEventRegistry.suggest) {
						var oTextPoolHelper = new sap.apf.modeler.ui.utils.TextPoolHelper(oSelf.oTextPool);
						// Add Auto Complete Feature on Label inputs.
						var oDependenciesForText = {
							oTranslationFormat : sap.apf.modeler.ui.utils.TranslationFormatMap.REPRESENTATION_LABEL,
							type : "text"
						};
						oTextPoolHelper.setAutoCompleteOn(this, oDependenciesForText);
					}
					return true;
				}
			},
			change : function() {
				var sProperty = this.getBindingContext().getProperty("sSelectedProperty");
				if (sProperty !== oSelf.getText("none")) {
					oSelf._setPropertiesFromCurrentDataset();
					oSelf.oConfigurationEditor.setIsUnsaved();
				}
			}
		});
		oPropertyRowTemplate.addContent(oInputLabel);
		// Add Icon
		var oAddIcon = new sap.ui.core.Icon({
			width : "100%",
			src : "sap-icon://add",
			tooltip : oSelf.getText("addButton"),
			visible : {
				path : "nMax",
				formatter : function(nMax) {
					return (nMax === "*");
				}
			},
			press : function() {
				var oBindingContext = this.getBindingContext();
				var oCurrentObjectClone = jQuery.extend(true, {}, oBindingContext.getObject());
				delete oCurrentObjectClone.sSelectedProperty;
				delete oCurrentObjectClone.sLabel;
				var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
				var aPropertyRows = oSelf.mDataset.oPropertyDataset.aPropertyRows;
				aPropertyRows.splice(nCurrentIndex + 1, 0, oCurrentObjectClone);
				oSelf.mModel.oPropertyModel.updateBindings();
				oSelf._setPropertiesFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		}).addStyleClass("addIconRepresentation");
		// Remove Icon
		var oRemoveIcon = new sap.ui.core.Icon({
			width : "100%",
			src : "sap-icon://less",
			tooltip : oSelf.getText("deleteButton"),
			visible : {
				path : "/",
				formatter : function() {
					var bIsFirstOfItsKind = true;
					var oBindingContext = this.getBindingContext();
					var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
					if (nCurrentIndex) {
						var aPropertyRows = oSelf.mDataset.oPropertyDataset.aPropertyRows;
						var sCurrentKind = aPropertyRows[nCurrentIndex].sKind;
						var sCurrentAggRole = aPropertyRows[nCurrentIndex].sAggregationRole;
						var nPreviousIndex = nCurrentIndex - 1;
						var sPreviousKind = aPropertyRows[nPreviousIndex].sKind;
						var sPreviousAggRole = aPropertyRows[nPreviousIndex].sAggregationRole;
						bIsFirstOfItsKind = !(sCurrentKind === sPreviousKind && sCurrentAggRole === sPreviousAggRole);
					}
					return !bIsFirstOfItsKind;
				}
			},
			press : function() {
				var oBindingContext = this.getBindingContext();
				var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
				var aPropertyRows = oSelf.mDataset.oPropertyDataset.aPropertyRows;
				aPropertyRows.splice(nCurrentIndex, 1);
				oSelf.mModel.oPropertyModel.updateBindings();
				oSelf._setPropertiesFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		}).addStyleClass("lessIconRepresentation");
		var oIconLayout = new sap.m.HBox({ //layout to hold the add/less icons
			layoutData : new sap.ui.layout.GridData({
				span : "L1 M2 S2"
			}),
			items : [ oAddIcon, oRemoveIcon ]
		});
		oPropertyRowTemplate.addContent(oIconLayout);
		oBasicDataLayout.bindAggregation("items", "/aPropertyRows", oPropertyRowTemplate);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_bindSortLayoutData
	* @description Binds sap.apf.modeler.ui.controller.representation#mModel.oSortModel to Sort layout.
	*               Iteratively binds the data to both the controls in Sort Data Layout.
	* */
	_bindSortLayoutData : function() {
		var oSelf = this;
		var oSortLayout = this.byId("idSortLayout");
		var oSortRowTemplate = new sap.ui.layout.Grid({ // add the select box controls to the grid.
			width : "100%"
		});
		// "Sort Label" Label
		var oSortFieldLabel = new sap.m.Label({
			width : "100%",
			textAlign : "Right",
			layoutData : new sap.ui.layout.GridData({
				span : "L3 M3 S3"
			}),
			text : this.getText("sortingField") + ":"
		});
		oSortRowTemplate.addContent(oSortFieldLabel);
		// "Sort Fields" Select Box
		var oSortPropertySelectBox = new sap.m.Select({
			width : "100%",
			layoutData : new sap.ui.layout.GridData({
				span : "L4 M3 S3"
			}),
			items : {
				path : "aAllProperties",
				template : new sap.ui.core.ListItem({
					key : "{sName}",
					text : "{sName}"
				})
			},
			selectedKey : "{sSortProperty}",
			change : function() {
				oSelf._setSortFieldsFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		});
		oSortRowTemplate.addContent(oSortPropertySelectBox);
		// "Direction" Label
		var oDirectionLabel = new sap.m.Label({
			width : "100%",
			textAlign : "Right",
			layoutData : new sap.ui.layout.GridData({
				span : "L1 M2 S2"
			}),
			text : this.getText("direction") + ":"
		}).addStyleClass("repFormRightLabel");
		oSortRowTemplate.addContent(oDirectionLabel);
		// "Direction" Select Box
		var oDirectionSelectBox = new sap.m.Select({
			width : "100%",
			layoutData : new sap.ui.layout.GridData({
				span : "L3 M2 S2"
			}),
			items : [ {
				key : this.getText("ascending"),
				text : this.getText("ascending")
			}, {
				key : this.getText("descending"),
				text : this.getText("descending")
			} ],
			selectedKey : "{sDirection}",
			change : function() {
				var sSortProperty = this.getBindingContext().getProperty("sSortProperty");
				if (sSortProperty !== oSelf.getText("none")) {
					oSelf._setSortFieldsFromCurrentDataset();
					oSelf.oConfigurationEditor.setIsUnsaved();
				}
			}
		});
		oSortRowTemplate.addContent(oDirectionSelectBox);
		// Add Icon
		var oAddIcon = new sap.ui.core.Icon({
			width : "100%",
			src : "sap-icon://add",
			tooltip : this.getText("addButton"),
			visible : true,
			press : function() {
				var oBindingContext = this.getBindingContext();
				var oCurrentObjectClone = jQuery.extend(true, {}, oBindingContext.getObject());
				delete oCurrentObjectClone.sSortProperty;
				delete oCurrentObjectClone.sDirection;
				var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
				var aSortRows = oSelf.mDataset.oSortDataset.aSortRows;
				aSortRows.splice(nCurrentIndex + 1, 0, oCurrentObjectClone);
				oSelf.mModel.oSortModel.updateBindings();
				oSelf._setSortFieldsFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		}).addStyleClass("addIconRepresentation");
		// Remove Icon
		var oRemoveIcon = new sap.ui.core.Icon({
			width : "100%",
			src : "sap-icon://less",
			tooltip : this.getText("deleteButton"),
			visible : {
				path : "/",
				formatter : function() {
					var oBindingContext = this.getBindingContext();
					var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
					return !!nCurrentIndex;
				}
			},
			press : function() {
				var oBindingContext = this.getBindingContext();
				var nCurrentIndex = parseInt(oBindingContext.getPath().split("/").pop(), 10);
				var aSortRows = oSelf.mDataset.oSortDataset.aSortRows;
				aSortRows.splice(nCurrentIndex, 1);
				oSelf.mModel.oSortModel.updateBindings();
				oSelf._setSortFieldsFromCurrentDataset();
				oSelf.oConfigurationEditor.setIsUnsaved();
			}
		}).addStyleClass("lessIconRepresentation");
		// Layout to hold the add/less icons
		var oIconLayout = new sap.m.HBox({
			layoutData : new sap.ui.layout.GridData({
				span : "L1 M2 S2"
			}),
			items : [ oAddIcon, oRemoveIcon ]
		});
		oSortRowTemplate.addContent(oIconLayout);
		oSortLayout.bindAggregation("items", "/aSortRows", oSortRowTemplate);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#setDetailData
	* @description Prepares data set and model map to be used within the view.
	* */
	setDetailData : function() {
		var mContextParam = this.mParam.arguments;
		this.oParentStep = this.oConfigurationEditor.getStep(mContextParam.stepId);
		this.aSelectProperties = this._getSelectPropertiesFromParentStep();
		this.oRepresentation = this.oParentStep.getRepresentation(mContextParam.representationId);
		if (!this.oRepresentation) {
			this.oRepresentation = this.oParentStep.createRepresentation();
			// Set Default Chart Type
			this._setDefaultRepresentationType();
			// Set Default Dimensions/Measures
			this._setDefaultProperties();
			this.oConfigurationEditor.setIsUnsaved();
		}
		// Datasets
		var oChartTypeDataset = this._getChartTypeDataset();
		var oPropertyDataset = this._getPropertyDataset();
		var oSortDataset = this._getSortDataset();
		var oCornerTextsDataset = this._getCornerTextsDataset();
		var oChartPictureDataset = this._getChartPictureDataset();
		this.mDataset = {
			oChartTypeDataset : oChartTypeDataset,
			oPropertyDataset : oPropertyDataset,
			oSortDataset : oSortDataset,
			oCornerTextsDataset : oCornerTextsDataset,
			oChartPictureDataset : oChartPictureDataset
		};
		// Models
		var oChartTypeModel = new sap.ui.model.json.JSONModel(this.mDataset.oChartTypeDataset);
		var oPropertyModel = new sap.ui.model.json.JSONModel(this.mDataset.oPropertyDataset);
		var oSortModel = new sap.ui.model.json.JSONModel(this.mDataset.oSortDataset);
		var oCornerTextsModel = new sap.ui.model.json.JSONModel(this.mDataset.oCornerTextsDataset);
		var oChartPictureModel = new sap.ui.model.json.JSONModel(this.mDataset.oChartPictureDataset);
		this.mModel = {
			oChartTypeModel : oChartTypeModel,
			oPropertyModel : oPropertyModel,
			oSortModel : oSortModel,
			oCornerTextsModel : oCornerTextsModel,
			oChartPictureModel : oChartPictureModel
		};
		// Bindings
		this.byId("idChartType").setModel(this.mModel.oChartTypeModel);
		var sChartType = this.sCurrentChartType;
		this._updateAndSetDatasetsByChartType(sChartType);
		this.byId("idBasicDataLayout").setModel(this.mModel.oPropertyModel);
		this._bindBasicRepresentationData();
		this.byId("idSortLayout").setModel(this.mModel.oSortModel);
		this._bindSortLayoutData();
		this.byId("idCornerTextLayout").setModel(this.mModel.oCornerTextsModel);
		this.byId("idChartIcon").setModel(this.mModel.oChartPictureModel);
		// Actions
		this._addAutoCompleteFeatureOnInputs();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_insertPreviewButtonInFooter
	* @description Inserts the preview Button into the footer.
	* */
	_insertPreviewButtonInFooter : function() {
		var oFooter = this.oViewData.oFooter;
		oFooter.addContentRight(this._oPreviewButton);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_removePreviewButtonFromFooter
	* @description Removes the preview Button from the footer.
	* */
	_removePreviewButtonFromFooter : function() {
		var oFooter = this.oViewData.oFooter;
		oFooter.removeContentRight(this._oPreviewButton);
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_handlePreviewButtonPress
	* @description Handler for press event on preview Button.
	*          Opens a dialog and inserts the preview content in it.
	* */
	_handlePreviewButtonPress : function() {
		var oPreviewDetails = this._getPreviewDetails();
		var oPreviewContent = new sap.ui.view({
			type : sap.ui.core.mvc.ViewType.XML,
			viewName : "sap.apf.modeler.ui.view.previewContent",
			viewData : oPreviewDetails
		});
		var oPreviewDialog = new sap.m.Dialog({
			title : this.getText("preview"),
			content : oPreviewContent,
			endButton : new sap.m.Button({
				text : this.getText("close"),
				press : function() {
					oPreviewDialog.close();
				}
			})
		});
		oPreviewDialog.open();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#onExit
	* @description Called when sub-view is destroyed by configuration list controller.
	*               Removes the preview button from footer.
	* */
	onExit : function() {
		this._removePreviewButtonFromFooter();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getPreviewDetails
	* @description Prepares the argument for sap.apf.modeler.ui.controller.PreviewContent.
	*          Iterates through all the models and populates the result object.
	* @returns {Object} Argument for sap.apf.modeler.ui.controller.PreviewContent
	* */
	_getPreviewDetails : function() {
		var oSelf = this;
		var sChartTpype = this.mDataset.oChartTypeDataset.sSelectedChartType;
		var sStepTitle = this._getParentStepTitle();
		var sStepLongTitle = this._getParentStepLongTitle() || sStepTitle;
		var aDimensions = [], aMeasures = [];
		this.aSelectProperties.forEach(function(oSelectProperty) {
			if (oSelectProperty.sAggregationRole === "dimension") {
				aDimensions.push(oSelectProperty.sName);
			} else if (oSelectProperty.sAggregationRole === "measure") {
				aMeasures.push(oSelectProperty.sName);
			}
		});
		var oChartParameter = {
			dimensions : [],
			measures : []
		};
		this.mDataset.oPropertyDataset.aPropertyRows.forEach(function(oPropertyRow) {
			if (oPropertyRow.sSelectedProperty !== oSelf.getText("none")) {
				var sAggregationRole = oPropertyRow.sAggregationRole + "s";
				oChartParameter[sAggregationRole].push({
					fieldDesc : oPropertyRow.sLabel,
					fieldName : oPropertyRow.sSelectedProperty,
					kind : oPropertyRow.sKind
				});
			}
		});
		// Sort Fields
		var aSort = [];
		this.mDataset.oSortDataset.aSortRows.forEach(function(oSortRow) {
			var sSortProperty = oSortRow.sSortProperty || (oSortRow.aAllProperties.length && oSortRow.aAllProperties[0].sName);
			if (sSortProperty && sSortProperty !== oSelf.getText("none")) {
				var bAscending = !oSortRow.sDirection || (oSortRow.sDirection === oSelf.getText("ascending"));
				aSort.push({
					sSortField : sSortProperty,
					bDescending : !bAscending
				});
			}
		});
		var aCornerTexts = {
			sLeftUpper : this.mDataset.oCornerTextsDataset.LeftUpper,
			sRightUpper : this.mDataset.oCornerTextsDataset.RightUpper,
			sLeftLower : this.mDataset.oCornerTextsDataset.LeftLower,
			sRightLower : this.mDataset.oCornerTextsDataset.RightLower
		};
		return {
			sChartType : sChartTpype,
			sStepTitle : sStepTitle,
			sStepLongTitle : sStepLongTitle,
			aDimensions : aDimensions,
			aMeasures : aMeasures,
			oChartParameter : oChartParameter,
			aSort : aSort,
			aCornerTexts : aCornerTexts
		};
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getParentStepLongTitle
	* @description Getter for parent step's long title
	* @returns {String|undefined} Parent Step's Long Title or undefined if not available.
	* */
	_getParentStepLongTitle : function() {
		var sStepLongTitleId = this.oParentStep.getLongTitleId();
		sStepLongTitleId = !this.oTextPool.isInitialTextKey(sStepLongTitleId) ? sStepLongTitleId : undefined;
		var oStepLongTitleText = sStepLongTitleId && this.oTextPool.get(sStepLongTitleId);
		var sStepLongTitle = oStepLongTitleText && oStepLongTitleText.TextElementDescription;
		return sStepLongTitle;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getParentStepTitle
	* @description Getter for parent step's title
	* @returns {String|undefined} Parent Step's Title or undefined if not available.
	* */
	_getParentStepTitle : function() {
		var sStepTitleId = this.oParentStep.getTitleId();
		var oStepTitleText = sStepTitleId && this.oTextPool.get(sStepTitleId);
		var sStepTitle = oStepTitleText && oStepTitleText.TextElementDescription;
		return sStepTitle;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getSelectPropertiesFromParentStep
	* @description Getter for Select Property List from parent step.
	* @returns {Object[]} Array of select properties of the form : 
	*          {
	*               sName - Name of the property.
	*               sAggregationRole - dimension/measure.
	*          }
	* */
	_getSelectPropertiesFromParentStep : function() {
		var sAbsolutePathToServiceDocument = this.oParentStep.getService();
		var sEntitySet = this.oParentStep.getEntitySet();
		var oEntityMetadata = this.getEntityTypeMetadata(sAbsolutePathToServiceDocument, sEntitySet);
		var aSelectProperties = this.oParentStep.getSelectProperties();
		var aResultSet = aSelectProperties.map(function(sProperty) {
			var oMetadataForProperty = oEntityMetadata.getPropertyMetadata(sProperty);
			return {
				sName : sProperty,
				sAggregationRole : oMetadataForProperty["aggregation-role"]
			};
		});
		return aResultSet;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getCornerTextsFromConfigObject
	* @param {sap.apf.modeler.core.Step|sap.apf.modeler.core.Representation} oConfigObject - Instance of a configuration object.
	* @description Getter for corner text map of a configuration object.
	* @returns {Object} Map of corner Text of the form : 
	*          {
	*               LeftUpper - Left Upper corner text.
	*               RightUpper - Right Upper corner text.
	*               LeftLower - Left Lower corner text.
	*               RightLower - Right Lower corner text. 
	*          }
	* */
	_getCornerTextsFromConfigObject : function(oConfigObject) {
		var oSelf = this;
		var aCornerTextNames = [ "LeftUpper", "RightUpper", "LeftLower", "RightLower" ];
		var mDataset = {};
		aCornerTextNames.forEach(function(sCornerTextName) {
			var sMethodName = [ "get", sCornerTextName, "CornerTextKey" ].join("");
			var sCornerTextKey = oConfigObject[sMethodName]();
			sCornerTextKey = !oSelf.oTextPool.isInitialTextKey(sCornerTextKey) ? sCornerTextKey : undefined;
			var oCornerText = sCornerTextKey && oSelf.oTextPool.get(sCornerTextKey);
			var sCornterText = oCornerText && oCornerText.TextElementDescription;
			mDataset[sCornerTextName] = sCornterText;
		});
		return mDataset;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getChartTypeDataset
	* @description Returns the data set to be bound to chart type drop down.
	* @returns {Object} Data set for chart type drop down of the form:
	*          {
	*               aChartTypes : [
	*                    {
	*                          sId - {sap.apf.ui.utils.CONSTANTS.representationTypes} Chart Type.
	*                          sText - {String} Display text for the chart type     
	*                    }
	*               ]
	*               sSelectedChartType - {sap.apf.ui.utils.CONSTANTS.representationTypes} Currently selected Chart Type.
	*          }
	* */
	_getChartTypeDataset : function() {
		var self = this;
		var aKeys = Object.keys(this._getRepresentationMetadata());
		var aChartTypes = aKeys.map(function(sKey) {
			return {
				sId : sKey,
				sText : self.getText(sKey)
			};
		});
		var oDataset = {
			aChartTypes : aChartTypes,
			sSelectedChartType : this.oRepresentation.getRepresentationType()
		};
		this.sCurrentChartType = oDataset.sSelectedChartType;
		return oDataset;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getChartPictureDataset
	* @description Returns the data set to be bound to representation icon
	* @returns {Object} 
	*          {
	*               id : picture
	*          }
	* */
	_getChartPictureDataset : function() {
		var oRepnMetaData = this.getRepresentationTypes();
		var oDataSet = {};
		oRepnMetaData.forEach(function(o) {
			var sId = o.id;
			oDataSet[sId] = o.picture;
		});
		oDataSet.sSelectedChartPicture = oDataSet[this.oRepresentation.getRepresentationType()];
		return oDataSet;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_updatePictureDataset
	* @description Update the picture model data set
	*/
	_updatePictureDataset : function(sChartType) {
		var oDataSet = this.mModel.oChartPictureModel.getData();
		oDataSet.sSelectedChartPicture = oDataSet[sChartType];
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getPropertyDataset
	* @description Returns the data set to be bound to basic data layout.
	* @returns {Object} Data set for basic data layout of the form:
	*          {
	*               aPropertyRows : [
	*                    {
	                           sSelectedProperty - Selected Property of dropdown.
	                           sAggregationRole - dimension/measure.
	                           sLabel - Label of the selected property.
	                           sKind - {sap.apf.core.constants.representationMetadata.kind} kind value of corresponding row.
	                           nMin - Minimum value from representation metadata.
	                           nMax - Maximum value from representation metadata.
	                      }
	*               ]
	*          }
	* */
	_getPropertyDataset : function() {
		var oSelf = this;
		var aPropertyRows = [];
		var fnAddPropertyRowsOfType = function(sType) {
			var sGetterMethodName = [ "get", sType, "s" ].join("");
			var aPropertyList = oSelf.oRepresentation[sGetterMethodName]();
			aPropertyList.forEach(function(sProperty) {
				var sLabelKeyMethodName = [ "get", sType, "TextLabelKey" ].join("");
				var sLabelKey = oSelf.oRepresentation[sLabelKeyMethodName](sProperty);
				var oLabel = sLabelKey && oSelf.oTextPool.get(sLabelKey);
				var sLabel = oLabel && oLabel.TextElementDescription;
				var sKindMethodName = [ "get", sType, "Kind" ].join("");
				var sKind = oSelf.oRepresentation[sKindMethodName](sProperty);
				var sChartName = oSelf.oRepresentation.getRepresentationType();
				var oRepMetadata = oSelf._getRepresentationMetadata()[sChartName];
				var aSupportedKinds = oRepMetadata[sType.toLowerCase() + "s"].supportedKinds;
				var nMin, nMax;
				aSupportedKinds.forEach(function(oSupportedKind) {
					if (oSupportedKind.kind === sKind) {
						nMin = oSupportedKind.min;
						nMax = oSupportedKind.max;
					}
				});
				aPropertyRows.push({
					sSelectedProperty : sProperty,
					sAggregationRole : sType.toLowerCase(),
					sLabel : sLabel,
					sKind : sKind,
					nMin : nMin,
					nMax : nMax
				});
			});
		};
		fnAddPropertyRowsOfType("Dimension");
		fnAddPropertyRowsOfType("Measure");
		return {
			aPropertyRows : aPropertyRows
		};
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getSortDataset
	* @description Returns the data set to be bound to sort data layout.
	* @returns {Object} Data set for sort data layout of the form:
	* {
	       aSortRows : [
	       		{
	       			 aAllProperties : [
	                      {
	                           sName : "None" - "None" value since it is an optional field.
	                      },
	                      {
	                           sName - Name of the property.
	                      }
	                ],
	                sSortProperty - Name of the selected sort property.
	                sDirection - Translated text for 'ascending' and 'descending'.
	       		}
	       ]
	 * }
	* */
	_getSortDataset : function() {
		var oSelf = this;
		var aOrderBySpecs = this.oRepresentation.getOrderbySpecifications();
		var aAllProperties = this.aSelectProperties.slice();
		aAllProperties.unshift({
			sName : this.getText("none")
		});
		if (!aOrderBySpecs.length) {
			aOrderBySpecs.push({});
		}
		var aSortRows = aOrderBySpecs.map(function(oOrderBySpec) {
			var sOrderByProperty = oOrderBySpec.property;
			var sOrderByDirection = oOrderBySpec.ascending !== undefined && !oOrderBySpec.ascending ? oSelf.getText("descending") : oSelf.getText("ascending");
			return {
				sSortProperty : sOrderByProperty,
				sDirection : sOrderByDirection,
				aAllProperties : aAllProperties
			};
		});
		return {
			aSortRows : aSortRows
		};
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getCornerTextsDataset
	* @description Returns the data set to be bound to corner texts data layout.
	* @returns {Object} Data set for corner texts data layout of the form:
	*          {
	*               LeftUpper - Left Upper corner text.
	*               RightUpper - Right Upper corner text.
	*               LeftLower - Left Lower corner text.
	*               RightLower - Right Lower corner text. 
	*          }
	* */
	_getCornerTextsDataset : function() {
		var mRepresentationCornerText = this._getCornerTextsFromConfigObject(this.oRepresentation);
		var mParentStepCornerText = this._getCornerTextsFromConfigObject(this.oParentStep);
		var oDataset = jQuery.extend({}, mParentStepCornerText, mRepresentationCornerText);
		return oDataset;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_setDefaultRepresentationType
	* @description Sets the first key from sap.apf.core.representationTypes() list as the default representation type.
	*               Updates the tree node after setting the representation type on the representation object and passes the id of newly created representation.
	* */
	_setDefaultRepresentationType : function() {
		var sDefaultChartType;
		if (this.getRepresentationTypes()[0].metadata) {
			sDefaultChartType = this.getRepresentationTypes()[0].id;
		}
		this.oRepresentation.setRepresentationType(sDefaultChartType);
		this.oRepresentation.setAlternateRepresentationType(sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION);
		// Update Tree Node.
		var sRepresentationTypeText = this.getText(this.oRepresentation.getRepresentationType());
		var sSelectedChartIcon = this._getChartPictureDataset().sSelectedChartPicture;
		var aStepCategories = this.oConfigurationEditor.getCategoriesForStep(this.oParentStep.getId());
		if (aStepCategories.length === 1) {//In case the step of representation is only assigned to one category
			this.oViewData.updateSelectedNode({
				id : this.oRepresentation.getId(),
				icon : sSelectedChartIcon
			});
		} else {
			var aRepresentationContexts = [];
			var representationContext = jQuery.extend(true, {}, this.mParam);
			var oRepresentationInfo = {
				id : this.oRepresentation.getId(),
				aStepCategories : aStepCategories,
				stepContext : representationContext
			};
			this.oViewData.updateTree();
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_setDefaultProperties
	* @description Adds the first dimension from parent step's select properties to representation object and gives it xAxis.
	*          Also adds the first measure to the representation object and gives it yAxis.
	* */
	_setDefaultProperties : function() {
		var sFirstDimension, sFirstMeasure;
		this.aSelectProperties.forEach(function(oSelectProperty) {
			if (!sFirstDimension) {
				if (oSelectProperty.sAggregationRole === "dimension") {
					sFirstDimension = oSelectProperty.sName;
				}
			}
			if (!sFirstMeasure) {
				if (oSelectProperty.sAggregationRole === "measure") {
					sFirstMeasure = oSelectProperty.sName;
				}
			}
		});
		// Add dimension
		if (sFirstDimension) {
			this.oRepresentation.addDimension(sFirstDimension);
			this.oRepresentation.setDimensionKind(sFirstDimension, sap.apf.core.constants.representationMetadata.kind.XAXIS);
		}
		// Add measure
		if (sFirstMeasure) {
			this.oRepresentation.addMeasure(sFirstMeasure);
			this.oRepresentation.setMeasureKind(sFirstMeasure, sap.apf.core.constants.representationMetadata.kind.YAXIS);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_updateAndSetDatasetsByChartType
	* @param {sap.apf.ui.utils.CONSTANTS.representationTypes} sChartName - Representation Type against which the property dataset has to be updated.
	* @description Updates datasets used in different layouts based on chart type.
	*          This method mutates the sap.apf.modeler.ui.controller.representation#mDataset based on the chart type which is passed.
	*          After the mutation it sets the values on the representation object.
	* */
	_updateAndSetDatasetsByChartType : function(sChartName) {
		this._updatePropertyDatasetByChartType(sChartName);
		this.mModel.oPropertyModel.updateBindings();
		this._setPropertiesFromCurrentDataset();
		this._updateSortDatasetByChartType(sChartName);
		this.mModel.oSortModel.updateBindings();
		this._setSortFieldsFromCurrentDataset();
		this._updatePictureDataset(sChartName);
		this.mModel.oChartPictureModel.updateBindings();
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_updatePropertyDatasetByChartType
	* @param {sap.apf.ui.utils.CONSTANTS.representationTypes} sChartName - Representation Type against which the property dataset has to be updated.
	* @description Property dataset that is used in basic data layout is different for differnt chart types.
	*          This method mutates the sap.apf.modeler.ui.controller.representation#mDataset.oPropertyDataset based on the chart type which is passed.
	*          Contains logic to retain the data rows if old data in row and data row from passed chart type are same.
	* */
	_updatePropertyDatasetByChartType : function(sChartName) {
		var self = this;
		// oDefaultDataset holds the bare-minimum property rows for this particular sChartName.
		var oDefaultDataset = {
			aPropertyRows : []
		};
		var oRepMetadata = this._getRepresentationMetadata()[sChartName];
		var aAggregationRoles = [ "dimensions", "measures" ];
		aAggregationRoles.forEach(function(sAggregationRole) {
			if (oRepMetadata.hasOwnProperty(sAggregationRole)) {
				var aSupportedKinds = oRepMetadata[sAggregationRole].supportedKinds;
				aSupportedKinds.forEach(function(oSupportedKind) {
					var oPropertyRow = {
						sAggregationRole : sAggregationRole.slice(0, -1), // To chop off the letter 's' form 'dimensions' and 'measures'
						sKind : oSupportedKind.kind,
						nMin : oSupportedKind.min,
						nMax : oSupportedKind.max,
						aAllProperties : self.aSelectProperties.filter(function(oProperty) {
							return (oProperty.sAggregationRole === (sAggregationRole.slice(0, -1)));
						})
					};
					if (!parseInt(oSupportedKind.min, 10)) {
						oPropertyRow.aAllProperties.unshift({
							sName : self.getText("none"),
							sAggregationRole : sAggregationRole.slice(0, -1)
						});
					}
					oDefaultDataset.aPropertyRows.push(oPropertyRow);
				});
			}
		});
		// oResultDataset combines the oDefaultDataset with the existing mPropertyDataset to retain the similar data entered by the user if any.
		var oResultDataset = {
			aPropertyRows : []
		};
		oDefaultDataset.aPropertyRows.forEach(function(oDefaultPropertyRow) {
			var bExitingRowOfSameKindExists = false;
			self.mDataset.oPropertyDataset.aPropertyRows.forEach(function(oExistingPropertyRow) {
				var bHasSameAggregationRole = oExistingPropertyRow.sAggregationRole === oDefaultPropertyRow.sAggregationRole;
				var bHasSameKind = oExistingPropertyRow.sKind === oDefaultPropertyRow.sKind;
				var bHasSameMinValue = oExistingPropertyRow.nMin === oDefaultPropertyRow.nMin;
				var bHasSameMaxValue = oExistingPropertyRow.nMax === oDefaultPropertyRow.nMax;
				if (bHasSameAggregationRole && bHasSameKind && bHasSameMinValue && bHasSameMaxValue) {
					bExitingRowOfSameKindExists = true;
					var oCompleteRow = jQuery.extend(oExistingPropertyRow, oDefaultPropertyRow);
					oResultDataset.aPropertyRows.push(oCompleteRow);
				}
			});
			if (!bExitingRowOfSameKindExists) {
				oResultDataset.aPropertyRows.push(oDefaultPropertyRow);
			}
		});
		// Update Dataset
		this.mDataset.oPropertyDataset.aPropertyRows = oResultDataset.aPropertyRows;
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_updateSortDatasetByChartType
	* @param {sap.apf.ui.utils.CONSTANTS.representationTypes} sChartName - Representation Type against which the property dataset has to be updated.
	* @description Sort dataset that is used in sort layout is different for differnt chart types.
	*          This method mutates the sap.apf.modeler.ui.controller.representation#mDataset.oPropertyDataset based on the chart type which is passed.
	*          Removes and hides Sort properties if "sortable" is set to false in the metadata of the chart type.
	* */
	_updateSortDatasetByChartType : function(sChartName) {
		var oRepMetadata = this._getRepresentationMetadata()[sChartName];
		if (oRepMetadata.sortable !== undefined && !oRepMetadata.sortable) {
			var aAllProperties = this.aSelectProperties.slice();
			aAllProperties.unshift({
				sName : this.getText("none")
			});
			this.mDataset.oSortDataset.aSortRows = [ {
				aAllProperties : aAllProperties,
				sDirection : this.getText("ascending")
			} ];
			this.byId("idSortLayout").setVisible(false);
			this.byId("idSorting").setVisible(false);
		} else {
			this.byId("idSortLayout").setVisible(true);
			this.byId("idSorting").setVisible(true);
			// <-- Work around to resolve data binding issue while changing visibility. -->
			this.mModel.oSortModel.updateBindings();
			var oSortLayout = this.byId("idSortLayout");
			jQuery.sap.delayedCall(10, oSortLayout, oSortLayout.rerender);
			// <-- Work around to resolve data binding issue while changing visibility. -->
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_setPropertiesFromCurrentDataset
	* @description This function is called on every change event related to properties to adhere to WYSIWYG principle.
	*          Sets new values on the representation object based on the current property model.
	*          Clears the old values from representation object.
	*          Sets new values by iterating through the current property data set.
	* */
	_setPropertiesFromCurrentDataset : function() {
		var oSelf = this;
		// Clear all properties from representation
		var sDimensions = this.oRepresentation.getDimensions();
		sDimensions.forEach(function(sDimension) {
			oSelf.oRepresentation.removeDimension(sDimension);
		});
		var sMeasures = this.oRepresentation.getMeasures();
		sMeasures.forEach(function(sMeasure) {
			oSelf.oRepresentation.removeMeasure(sMeasure);
		});
		// Loop through current dataset and set properties on representation
		this.mDataset.oPropertyDataset.aPropertyRows.forEach(function(oPropertyRow) {
			var sSelectedProperty = oPropertyRow.sSelectedProperty || (oPropertyRow.aAllProperties.length && oPropertyRow.aAllProperties[0].sName);
			if (sSelectedProperty && sSelectedProperty !== oSelf.getText("none")) {
				var sAggregationRole = oPropertyRow.sAggregationRole;
				var sAggregationRoleCamelCase = [ sAggregationRole.charAt(0).toUpperCase(), sAggregationRole.substring(1) ].join("");
				var sLabelValue = oPropertyRow.sLabel;
				var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.REPRESENTATION_LABEL;
				var sLabelId = oSelf.oTextPool.setText(sLabelValue, oTranslationFormat);
				var sAddMethodName = [ "add", sAggregationRoleCamelCase ].join("");
				var sSetKindMethondName = [ "set", sAggregationRoleCamelCase, "Kind" ].join("");
				var sSetTextLabelKeyMethodName = [ "set", sAggregationRoleCamelCase, "TextLabelKey" ].join("");
				oSelf.oRepresentation[sAddMethodName](sSelectedProperty);
				oSelf.oRepresentation[sSetKindMethondName](sSelectedProperty, oPropertyRow.sKind);
				oSelf.oRepresentation[sSetTextLabelKeyMethodName](sSelectedProperty, sLabelId);
			}
		});
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_setSortFieldsFromCurrentDataset
	* @description This function is called on every change event related to sort layout to adhere to WYSIWYG principle.
	*          Sets new values on the representation object based on the current property model.
	*          Clears the old values from representation object.
	*          Sets new values by iterating through the current sort data set.
	* */
	_setSortFieldsFromCurrentDataset : function() {
		var oSelf = this;
		// Clears current orderBy properties
		this.oRepresentation.getOrderbySpecifications().forEach(function(oOrderBySpec) {
			oSelf.oRepresentation.removeOrderbySpec(oOrderBySpec.property);
		});
		// Loop through current sort model and set orderby properties accordingly.
		this.mDataset.oSortDataset.aSortRows.forEach(function(oSortRow) {
			var sSortProperty = oSortRow.sSortProperty || (oSortRow.aAllProperties.length && oSortRow.aAllProperties[0].sName);
			if (sSortProperty && sSortProperty !== oSelf.getText("none")) {
				var bAscending = !oSortRow.sDirection || (oSortRow.sDirection === oSelf.getText("ascending"));
				oSelf.oRepresentation.addOrderbySpec(sSortProperty, bAscending);
			}
		});
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.representation#_getRepresentationMetadata
	* @description Returns the representation metadata by using the getRepresentationTypes API
	* */
	_getRepresentationMetadata : function() {
		var oRepMetadata = {};
		this.getRepresentationTypes().forEach(function(representationType) {
			if (representationType.metadata) {
				oRepMetadata[representationType.id] = representationType.metadata;
			}
		});
		return oRepMetadata;
	}
});

}; // end of sap/apf/modeler/ui/controller/representation.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.step.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.step.controller');
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/**
* @class step
* @memberOf sap.apf.modeler.ui.controller
* @name step
* @description controller for view.step
*/
sap.ui.controller("sap.apf.modeler.ui.controller.step", {
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.step#onInit
	* @description Called on initialization of the view.
	* Sets the static texts for all controls in UI.
	* Sets the scroll height for the container.
	* Adds style classes to all UI controls.
	* Prepares dependecies.
	* Sets dynamic text for input controls
	* */
	onInit : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.oViewData = this.getView().getViewData();
		this.getText = this.oViewData.getText;
		this.params = this.oViewData.oParams;
		this.oConfigurationHandler = this.oViewData.oConfigurationHandler;
		this.oConfigurationEditor = this.oViewData.oConfigurationEditor;
		var self = this;
		if (!this.oConfigurationEditor) {
			this.oConfigurationHandler.loadConfiguration(this.params.arguments.configId, function(configurationEditor) {
				self.oConfigurationEditor = configurationEditor;
			});
		}
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		//this._getDependencies(); //get dependencies from router
		this._addConfigStyleClass();
		this._setDisplayText();
		this.setDetailData();
		//Set Mandatory Fields
		var mandatoryFields = [];
		mandatoryFields.push(this.byId("idstepTitle"));
		mandatoryFields.push(this.byId("idSourceSelect"));
		mandatoryFields.push(this.byId("idSelectPropCombo"));
		mandatoryFields.push(this.byId("idCategorySelect"));
		mandatoryFields.push(this.byId("idFilterMapEntitySelect")); //filter map entity,select properties and target filter are mandatory when service is selected
		mandatoryFields.push(this.byId("idFilterMapTargetFilterCombo"));
		this._setMandatoryFields(mandatoryFields);
		if (this.step.getFilterMappingService() === undefined || this.step.getFilterMappingService() === "") { // if the filter mapping field is not available
			this._removeMandatoryFromFilterMap(); //initially filter mapping fields should not be mandatory 
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.step#_setDisplayText
	* @description Sets static texts in UI
	* */
	_setDisplayText : function() {
		this.byId("idStepTitleLabel").setText("*" + this.getText("stepTitle") + ": ");
		this.byId("idstepTitle").setPlaceholder(this.getText("newStep"));
		this.byId("idStepLongTitleLabel").setText(this.getText("stepLongTitle") + ": ");
		this.byId("idstepLongTitle").setPlaceholder(this.getText("stepLongTitle"));
		this.byId("idCategoryTitleLabel").setText("*" + this.getText("categoryTitle") + ": ");
		this.byId("idSourceSelectLabel").setText("*" + this.getText("source") + ": ");
		this.byId("idEntitySelectLabel").setText("*" + this.getText("entity") + ": ");
		this.byId("idSelectPropComboLabel").setText("*" + this.getText("selectProperties") + ": ");
		this.byId("idReqFilterSelectLabel").setText(this.getText("requiredFilters") + ": ");
		this.byId("idDataRequest").setText(this.getText("dataRequest"));
		this.byId("idCornerTextLabel").setText(this.getText("cornerTextLabel"));
		this.byId("idLeftTop").setPlaceholder(this.getText("leftTop"));
		this.byId("idRightTop").setPlaceholder(this.getText("rightTop"));
		this.byId("idLeftBottom").setPlaceholder(this.getText("leftBottom"));
		this.byId("idRightBottom").setPlaceholder(this.getText("rightBottom"));
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_addAutoCompleteFeatureOnInputs
	 * @description Adds 'Auto Complete Feature' to the input fields in the view
	 * using sap.apf.modeler.ui.utils.TextPoolHelper.
	 * */
	_addAutoCompleteFeatureOnInputs : function() {
		if (this.oConfigurationHandler) {
			var oTextPoolHelper = new sap.apf.modeler.ui.utils.TextPoolHelper(this.oTextPool);
			var oStepTitleControl = this.byId("idstepTitle");
			var oTranslationFormatForStepTitle = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;
			var oDependenciesForStepTitle = {
				oTranslationFormat : oTranslationFormatForStepTitle,
				type : "text"
			};
			oTextPoolHelper.setAutoCompleteOn(oStepTitleControl, oDependenciesForStepTitle);
			var oStepLongTitleControl = this.byId("idstepLongTitle");
			var oTranslationFormatForStepLongTitle = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_LONG_TITLE;
			var oDependenciesForStepLongTitle = {
				oTranslationFormat : oTranslationFormatForStepLongTitle,
				type : "text"
			};
			oTextPoolHelper.setAutoCompleteOn(oStepLongTitleControl, oDependenciesForStepLongTitle);
			var oStepLeftTop = this.byId("idLeftTop");
			var oStepRightTop = this.byId("idRightTop");
			var oStepLeftBottom = this.byId("idLeftBottom");
			var oStepRightBottom = this.byId("idRightBottom");
			var oTranslationFormatForStepCornerText = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_CORNER_TEXT;
			var oDependenciesForStepCornerText = {
				oTranslationFormat : oTranslationFormatForStepCornerText,
				type : "text"
			};
			oTextPoolHelper.setAutoCompleteOn(oStepLeftTop, oDependenciesForStepCornerText);
			oTextPoolHelper.setAutoCompleteOn(oStepRightTop, oDependenciesForStepCornerText);
			oTextPoolHelper.setAutoCompleteOn(oStepLeftBottom, oDependenciesForStepCornerText);
			oTextPoolHelper.setAutoCompleteOn(oStepRightBottom, oDependenciesForStepCornerText);
			//autocomplete for source
			var oDependenciesForService = {
				oConfigurationEditor : this.oConfigurationEditor,
				type : "service"
			};
			var oSource = this.byId("idSourceSelect");
			oTextPoolHelper.setAutoCompleteOn(oSource, oDependenciesForService);
			var oSourceForFilterMapping = this.byId("idFilterMapSourceSelect");
			oTextPoolHelper.setAutoCompleteOn(oSourceForFilterMapping, oDependenciesForService);
		}
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.step#_addConfigStyleClass
	* @description Adds style classes to the UI controls
	* */
	_addConfigStyleClass : function() {
		this.byId("idChartIcon").addStyleClass("chartIcon");
		this.byId("idDataRequest").addStyleClass("formTextTitle");
		this.byId("idCornerTextLabel").addStyleClass("formTextTitle");
		this.byId("idCornerTextLayout").addStyleClass("cornerTextHLayout");
		this.byId("idScrollContent").addStyleClass("scrollContentLayout");
		this.byId("DataRequestLayout").addStyleClass("detailPageDataLayout");
		this.byId("FilterMapLayout").addStyleClass("detailPageDataLayout");
		this.byId("idCornerTextLayout").addStyleClass("detailPageDataLayout");
	},
	/**
	* @private
	* @function
	* @name sap.apf.modeler.ui.controller.step#setDetailData
	* @description Sets dynamic texts for controls
	* */
	setDetailData : function() {
		var self = this;
		var Categories = [];
		this.oTextPool = this.oConfigurationHandler.getTextPool();
		var aAllCategories = this.oConfigurationEditor.getCategories();
		aAllCategories.forEach(function(oCategory) {
			var oCatOb = {};
			oCatOb.CategoryId = oCategory.getId();
			oCatOb.CategoryTitle = self.oTextPool.get(oCategory.labelKey) ? self.oTextPool.get(oCategory.labelKey).TextElementDescription : oCategory.labelKey;
			Categories.push(oCatOb);
		});
		var oData = {
			Categories : Categories
		};
		var oModel = new sap.ui.model.json.JSONModel();
		oModel.setData(oData);
		this.byId("idCategorySelect").setModel(oModel);
		var oProp = {
			propertyKey : this.getText("none"),
			propertyName : this.getText("none")
		};
		var oDataForPropertiesSel = {
			Properties : [ oProp ]
		};
		var oModelForSelectables = new sap.ui.model.json.JSONModel();
		oModelForSelectables.setSizeLimit(500);
		oModelForSelectables.setData(oDataForPropertiesSel);
		this.byId("idReqFilterSelect").setModel(oModelForSelectables);
		var aSelectPropertiesForTargetFilter = [];
		var oSelectedPropertiesForTargetFilter = this.byId("idFilterMapTargetFilterCombo") ? this.byId("idFilterMapTargetFilterCombo").getSelectedKeys() : [];
		oSelectedPropertiesForTargetFilter.forEach(function(property) { //selected properties from the combo box
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aSelectPropertiesForTargetFilter.push(oProp);
		});
		var oModelForTargetFilter = new sap.ui.model.json.JSONModel();
		oModelForTargetFilter.setSizeLimit(500);
		oModelForTargetFilter.setData(aSelectPropertiesForTargetFilter);
		//all the selected properties will be displayed in the target filter property dropdown, none will not be displayed as one property has to be selected
		this.byId("idFilterMapTargetFilterCombo").setModel(oModelForTargetFilter);
		if (this.params && this.params.arguments && this.params.arguments.stepId) {
			this.step = this.oConfigurationEditor.getStep(this.params.arguments.stepId);
		}
		if (this.step) { //for existing step
			var sNone = this.getText("none");
			var noneProperties = [ sNone ];
			//Setting the value for title for a step
			if (this.step.getTitleId && this.step.getTitleId() !== undefined && this.step.getTitleId() !== null && self.oTextPool.get(this.step.getTitleId())) {
				this.byId("idstepTitle").setValue(self.oTextPool.get(this.step.getTitleId()).TextElementDescription);
			} else {
				this.byId("idstepTitle").setValue(this.params.arguments.stepId);
			}
			//Setting the value for long title for a step
			if (this.step.getLongTitleId && this.step.getLongTitleId() !== undefined && this.step.getLongTitleId() !== null && self.oTextPool.get(this.step.getLongTitleId())) {
				this.byId("idstepLongTitle").setValue(self.oTextPool.get(this.step.getLongTitleId()).TextElementDescription);
			} else {
				this.byId("idstepLongTitle").setValue("");
			}
			//Setting the value for data source for a step
			if (this.step.getService && this.step.getService() !== undefined && this.step.getService() !== null) {
				this.byId("idSourceSelect").setValue(this.step.getService());
				var sSource = this.step.getService();
				var aAllEntitySets = [];
				var aAllEntitySetsForControll = [];
				aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
				aAllEntitySets.forEach(function(entiset) {
					var oEntitySet = {};
					oEntitySet.entityKey = entiset;
					oEntitySet.entityName = entiset;
					aAllEntitySetsForControll.push(oEntitySet);
				});
				var oDataForEntitySets = {
					Entities : aAllEntitySetsForControll
				};
				var oModelForEntitySet = new sap.ui.model.json.JSONModel();
				oModelForEntitySet.setSizeLimit(500);
				oModelForEntitySet.setData(oDataForEntitySets);
				this.byId("idEntitySelect").setModel(oModelForEntitySet);
			}
			//Setting the value for entity sets for a step
			if (this.step.getEntitySet && this.step.getEntitySet() !== undefined && this.step.getEntitySet() !== null) {
				this.byId("idEntitySelect").setSelectedKey(this.step.getEntitySet());
				var sEntity = this.step.getEntitySet();
				var sServiceRoot = this.step.getService();
				var aProperties = [], aPropertiesForControl = [];
				if (sServiceRoot && sServiceRoot !== null && sServiceRoot !== "") {
					aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sServiceRoot, sEntity);
					aProperties.forEach(function(property) {
						var oProp = {};
						oProp.propertyKey = property;
						oProp.propertyName = property;
						aPropertiesForControl.push(oProp);
					});
					var oDataForProperties = {
						Properties : aPropertiesForControl
					};
					var oModelForSelProp = new sap.ui.model.json.JSONModel();
					oModelForSelProp.setSizeLimit(500);
					oModelForSelProp.setData(oDataForProperties);
					this.byId("idSelectPropCombo").setModel(oModelForSelProp);
				}
			}
			//Setting the value for select properties for a step
			if (this.step.getSelectProperties && this.step.getSelectProperties() !== undefined && this.step.getSelectProperties().length !== 0) {
				this.byId("idSelectPropCombo").setSelectedKeys(this.step.getSelectProperties());
				aProperties = noneProperties.concat(this.step.getSelectProperties());
				aPropertiesForControl = [];
				aProperties.forEach(function(property) {
					var oProp = {};
					oProp.propertyKey = property;
					oProp.propertyName = property;
					aPropertiesForControl.push(oProp);
				});
				oDataForPropertiesSel = {
					Properties : aPropertiesForControl
				};
				oModelForSelectables = new sap.ui.model.json.JSONModel();
				oModelForSelectables.setSizeLimit(500);
				oModelForSelectables.setData(oDataForPropertiesSel);
				this.byId("idReqFilterSelect").setModel(oModelForSelectables);
			}
			//Setting the value for required filter for a step
			if (this.step.getFilterProperties && this.step.getFilterProperties() !== undefined && this.step.getFilterProperties().length !== 0) {
				this.byId("idReqFilterSelect").setSelectedKey(this.step.getFilterProperties()[0]);
				this._showFilterMappingField();
			} else {
				this.byId("idReqFilterSelect").setSelectedKey(this.getText("none"));
				this._hideAndResetFilterMapField();
			}
			//Setting the value for data source for filter mapping of a step
			if (this.step.getFilterMappingService && this.step.getFilterMappingService() !== undefined && this.step.getFilterMappingService().length !== 0) {
				this.byId("idFilterMapSourceSelect").setValue(this.step.getFilterMappingService());
				var sFilterMapSource = this.step.getFilterMappingService();
				var aFilterMapAllEntitySets = [];
				var aFilterMapAllEntitySetsForControl = [];
				var aRequiredProperties = this.step.getFilterProperties();
				aFilterMapAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfServiceWithGivenProperties(sFilterMapSource, aRequiredProperties);
				aFilterMapAllEntitySets.forEach(function(entity) {
					var oEntitySetFilterMap = {};
					oEntitySetFilterMap.entityKey = entity;
					oEntitySetFilterMap.entityName = entity;
					aFilterMapAllEntitySetsForControl.push(oEntitySetFilterMap);
				});
				var oDataForFilterMapEntitySets = {
					Entities : aFilterMapAllEntitySetsForControl
				};
				var oModelForFilterMapEntitySet = new sap.ui.model.json.JSONModel();
				oModelForFilterMapEntitySet.setSizeLimit(500);
				oModelForFilterMapEntitySet.setData(oDataForFilterMapEntitySets);
				this.byId("idFilterMapEntitySelect").setModel(oModelForFilterMapEntitySet);
				this._addMandatoryfromFilterMap(); //valid service selected, make other fields in filter mapping mandatory
			} else {// if the service was not saved then reset the filter mapping fields
				this._removeMandatoryFromFilterMap(); // removes the mandatory tag 
				this._resetFilterMappingFields();//reset the values from the filter mapping properties and clears the selected keys in control
			}
			//Setting the value for entity sets for filter mapping of a step
			if (this.step.getFilterMappingEntitySet && this.step.getFilterMappingEntitySet() !== undefined && this.step.getFilterMappingEntitySet().length !== 0) {
				this.byId("idFilterMapEntitySelect").setSelectedKey(this.step.getFilterMappingEntitySet());
				var sFilterMapEntity = this.step.getFilterMappingEntitySet();
				var sFilterMapServiceRoot = this.step.getFilterMappingService();
				var aFilterMapProperties = [], aPropertiesForFilterMapControl = [];
				if (sFilterMapServiceRoot && sFilterMapServiceRoot !== null && sFilterMapServiceRoot !== "") {
					aFilterMapProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sFilterMapServiceRoot, sFilterMapEntity);
					aFilterMapProperties.forEach(function(property) {
						var oProp = {};
						oProp.propertyKey = property;
						oProp.propertyName = property;
						aPropertiesForFilterMapControl.push(oProp);
					});
					var oDataForFilterMapProperties = {
						Properties : aPropertiesForFilterMapControl
					};
					var oModelForFilterMapSelProp = new sap.ui.model.json.JSONModel();
					oModelForFilterMapSelProp.setSizeLimit(500);
					oModelForFilterMapSelProp.setData(oDataForFilterMapProperties);
					this.byId("idFilterMapTargetFilterCombo").setModel(oModelForFilterMapSelProp);
				}
			}
			//Setting the value for target property for filter mapping of a step
			if (this.step.getFilterMappingTargetProperties && this.step.getFilterMappingTargetProperties() !== undefined && this.step.getFilterMappingTargetProperties().length !== 0) {
				this.byId("idFilterMapTargetFilterCombo").setSelectedKeys(this.step.getFilterMappingTargetProperties());
			}
			//Setting the value for keep source checkbox for filter mapping of a step
			if (this.step.getFilterMappingKeepSource && this.step.getFilterMappingKeepSource() !== undefined) {
				this.byId("idFilterKeepSourceCheckBox").setSelected(this.step.getFilterMappingKeepSource());
			}
			//Setting the value of categories of a step
			var aSelectedCategories = self.oConfigurationEditor.getCategoriesForStep(this.step.getId());
			if (aSelectedCategories && aSelectedCategories.length !== 0) {
				this.byId("idCategorySelect").setSelectedKeys(aSelectedCategories);
			}
			//Setting the value of left lower corner text of a step
			if (this.step.getLeftLowerCornerTextKey() && self.oTextPool.get(this.step.getLeftLowerCornerTextKey())) {
				this.byId("idLeftBottom").setValue(self.oTextPool.get(this.step.getLeftLowerCornerTextKey()).TextElementDescription);
			} else {
				this.byId("idLeftBottom").setValue(this.step.getLeftLowerCornerTextKey());
			}
			//Setting the value of left upper corner text of a step
			if (this.step.getLeftUpperCornerTextKey() && self.oTextPool.get(this.step.getLeftUpperCornerTextKey())) {
				this.byId("idLeftTop").setValue(self.oTextPool.get(this.step.getLeftUpperCornerTextKey()).TextElementDescription);
			} else {
				this.byId("idLeftTop").setValue(this.step.getLeftUpperCornerTextKey());
			}
			//Setting the value of right upper corner text of a step
			if (this.step.getRightUpperCornerTextKey() && self.oTextPool.get(this.step.getRightUpperCornerTextKey())) {
				this.byId("idRightTop").setValue(self.oTextPool.get(this.step.getRightUpperCornerTextKey()).TextElementDescription);
			} else {
				this.byId("idRightTop").setValue(this.step.getRightUpperCornerTextKey());
			}
			//Setting the value of right lower corner text of a step
			if (this.step.getRightLowerCornerTextKey() && self.oTextPool.get(this.step.getRightLowerCornerTextKey())) {
				this.byId("idRightBottom").setValue(self.oTextPool.get(this.step.getRightLowerCornerTextKey()).TextElementDescription);
			} else {
				this.byId("idRightBottom").setValue(this.step.getRightLowerCornerTextKey());
			}
		} else { //for new step
			var sCategoryId = this.params.arguments.categoryId;
			var sStepId = self.oConfigurationEditor.createStep(sCategoryId);
			this.step = self.oConfigurationEditor.getStep(sStepId);
			var selectedCategory = [ sCategoryId ];
			this.byId("idCategorySelect").setSelectedKeys(selectedCategory);
			var stepInfo = {
				id : sStepId
			};
			this.oViewData.updateSelectedNode(stepInfo);
		}
		this._addAutoCompleteFeatureOnInputs();
	},
	handleChangeDetailValueForTree : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var self = this;
		var aStepCategories = this.oConfigurationEditor.getCategoriesForStep(this.step.getId());
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_TITLE;
		var sStepTitle = this.byId("idstepTitle").getValue().trim();
		var sStepTitleId = self.oTextPool.setText(sStepTitle, oTranslationFormat);
		if (sStepTitle !== "" && sStepTitle !== null) {
			this.step.setTitleId(sStepTitleId);
		}
		var stepInfo = {};
		stepInfo.name = sStepTitle;
		stepInfo.id = this.step.getId();
		if (sStepTitle !== "" && sStepTitle !== null) {
			if (aStepCategories.length > 1) {//In case the step is only assigned to one category
				this.oViewData.updateTree();
			} else {//In case the step is assigned to multiple categories, context of step and the list of categories is passed
				this.oViewData.updateSelectedNode(stepInfo);
			}
		}
		var sTitle = this.getText("step") + ": " + sStepTitle;
		this.oViewData.updateTitleAndBreadCrumb(sTitle);
	},
	handleChangeForLongTitle : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sStepLongTitle = this.byId("idstepLongTitle").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_LONG_TITLE;
		var sStepLongTitleId = this.oTextPool.setText(sStepLongTitle, oTranslationFormat);
		this.step.setLongTitleId(sStepLongTitleId);
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleChangeForService
	 * @description handler for the "service" property of the step request or filter mapping based on the event
	 * Checks the id of the source control and sets the value for request service or filter mapping service
	 * Reads all the entity set for the given source.
	 * Also , retrieves all the entities based on the required filters from the given source for filter mapping. 
	 * Checks if all the properties (entity, properties etc ) are valid for a given service and empties these properties if the service is invalid.
	 * */
	handleChangeForService : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var sSource, aAllEntitySets = [], aAllEntitySetsForControl = [], aProperties = [], aSelectPropertiesForControl = [], aRequiredProperties;
		var sSelectedRequiredFilter = this.byId("idReqFilterSelect").getSelectedKey();
		if (sSelectedRequiredFilter !== this.getText("none")) {
			aRequiredProperties = [ sSelectedRequiredFilter ]; // required filter from the step
		} else {
			aRequiredProperties = this.step.getFilterProperties();
		}
		var soruceControlId = oEvent ? oEvent.getParameter("id") : "";
		var bIsfilterMapControl = soruceControlId.search("FilterMap") !== -1 ? true : false;
		var bServiceRegistered;
		if (bIsfilterMapControl) {
			sSource = this.byId("idFilterMapSourceSelect").getValue().trim();
			bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			if (bServiceRegistered) {
				this._addMandatoryfromFilterMap(); //valid service selected, make other fields in filter mapping mandatory
				aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfServiceWithGivenProperties(sSource, aRequiredProperties);
			} else {
				this._removeMandatoryFromFilterMap(); //remove mandatory tag from the filter mapping fields
			}
		} else {
			if (sSelectedRequiredFilter === this.getText("none") || sSelectedRequiredFilter === "") {//hide the filter mapping field on change of service when required filter is empty or none
				this._hideAndResetFilterMapField();
			} else { // reset the filter mapping 
				this._removeMandatoryFromFilterMap(); // removes the mandatory tag 
				this._resetFilterMappingFields();//reset the values from the filter mapping properties and clears the selected keys in control
			}
			sSource = this.byId("idSourceSelect").getValue().trim();
			bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
			aAllEntitySets = this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
		}
		aAllEntitySets.forEach(function(entitySet) {
			var oEntitySet = {};
			oEntitySet.entityKey = entitySet;
			oEntitySet.entityName = entitySet;
			aAllEntitySetsForControl.push(oEntitySet);
		});
		var oEntitySetData = {
			Entities : aAllEntitySetsForControl
		};
		var oEntitySetModel = new sap.ui.model.json.JSONModel();
		oEntitySetModel.setSizeLimit(500);
		oEntitySetModel.setData(oEntitySetData);
		var sEntitySet;
		if (aAllEntitySets.length >= 1) { //set default entity set
			if (bIsfilterMapControl) { //for filter mapping entity set
				if (this.step.getFilterMappingEntitySet()) {
					sEntitySet = this.step.getFilterMappingEntitySet();
					aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, sEntitySet);
				} else {
					aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, aAllEntitySets[0]);
				}
				this.step.setFilterMappingEntitySet(aAllEntitySets[0]);
				this.byId("idFilterMapEntitySelect").setSelectedKey(aAllEntitySets[0]);
			} else {
				if (this.step.getEntitySet()) { //for data source entity set
					sEntitySet = this.step.getEntitySet();
					aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, sEntitySet);
				} else {
					aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, aAllEntitySets[0]);
				}
				this.step.setEntitySet(aAllEntitySets[0]);
				this.byId("idEntitySelect").setSelectedKey(aAllEntitySets[0]);
			}
			aProperties.forEach(function(property) {
				var oProp = {};
				oProp.propertyKey = property;
				oProp.propertyName = property;
				aSelectPropertiesForControl.push(oProp);
			});
		}
		var oSelectPropertiesData = {
			Properties : aSelectPropertiesForControl
		};
		var oSelectPropertiesModel = new sap.ui.model.json.JSONModel();
		oSelectPropertiesModel.setSizeLimit(500);
		oSelectPropertiesModel.setData(oSelectPropertiesData);
		var aSelectPropertiesForRequiredFilter = [], aSelectPropertiesForTargetFilter = [];
		var oSelectedPropertiesForRequiredFilter = this.byId("idSelectPropCombo").getSelectedKeys();
		oSelectedPropertiesForRequiredFilter.forEach(function(property) { //selected properties from the combo box
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aSelectPropertiesForRequiredFilter.push(oProp);
		});
		var noneTextobj = {
			propertyKey : this.getText("none"),
			propertyName : this.getText("none")
		};
		var aNoneTextObject = [ noneTextobj ];
		aNoneTextObject = aNoneTextObject.concat(aSelectPropertiesForRequiredFilter);
		var oRequiredFilterMapProertyModel = new sap.ui.model.json.JSONModel();
		oRequiredFilterMapProertyModel.setSizeLimit(500);
		oRequiredFilterMapProertyModel.setData(aNoneTextObject);
		var oSelectedPropertiesForTargetFilter = this.byId("idFilterMapTargetFilterCombo") ? this.byId("idFilterMapTargetFilterCombo").getSelectedKeys() : [];
		oSelectedPropertiesForTargetFilter.forEach(function(property) { //selected properties from the combo box
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aSelectPropertiesForTargetFilter.push(oProp);
		});
		if (bIsfilterMapControl) {
			this.byId("idFilterMapEntitySelect").setModel(oEntitySetModel);
			this.byId("idFilterMapTargetFilterCombo").setModel(oSelectPropertiesModel);
		} else {
			this.byId("idEntitySelect").setModel(oEntitySetModel);
			this.byId("idSelectPropCombo").setModel(oSelectPropertiesModel);
			this.byId("idReqFilterSelect").setModel(oRequiredFilterMapProertyModel);
		}
		this._checkValidationStateForService("source", soruceControlId);
	},
	/**
	 * @function
	 * @private 
	 * @name sap.apf.modeler.ui.controller.step# _addMandatoryfromFilterMap
	 * @description add the mandatory tags to all the fields in the filter mapping if the service is valid
	 * */
	_addMandatoryfromFilterMap : function() {
		this.byId("idFilterMapEntitySelect").isMandatory = true;
		this.byId("idFilterMapTargetFilterCombo").isMandatory = true;
		this.byId("idFilterMapEntityLabel").setText("*" + this.getText("entity") + " : ");
		this.byId("idFilterMapTargetFilterLabel").setText("*" + this.getText("filterMapTarget") + " : ");
		this.byId("idFilterMapKeepSourceLabel").setText("*" + this.getText("filterMapKeepSource") + " : ");
	},
	/**
	 * @function
	 * @private 
	 * @name sap.apf.modeler.ui.controller.step# _removeMandatoryFromFilterMap
	 * @description removes the mandatory tags to all the fields in the filter mapping if the service is invalid
	 * */
	_removeMandatoryFromFilterMap : function() {
		this.byId("idFilterMapEntitySelect").isMandatory = false;
		this.byId("idFilterMapTargetFilterCombo").isMandatory = false;
		this.byId("idFilterMapEntityLabel").setText(this.getText("entity") + " : ");
		this.byId("idFilterMapTargetFilterLabel").setText(this.getText("filterMapTarget") + " : ");
		this.byId("idFilterMapKeepSourceLabel").setText(this.getText("filterMapKeepSource") + " : ");
	},
	/**
	 * @function
	 * @private 
	 * @name sap.apf.modeler.ui.controller.step# _resetFilterMappingFields
	 * Resets all the values for the filter mapping properties (service, entitySet, select properties, target filter and keep source)
	 * and clears all the data and selected values from the controls
	 * */
	_resetFilterMappingFields : function() {
		var self = this;
		this.step.setFilterMappingService("");
		this.step.setFilterMappingEntitySet(undefined);
		this.step.setFilterMappingKeepSource(undefined);
		var aOldFilterMapTargetProperty = this.step.getFilterMappingTargetProperties();
		var aOldFilterMapSelectProperty = this.step.getFilterMappingSelectProperties();
		aOldFilterMapTargetProperty.forEach(function(property) {
			self.step.removeFilterMappingTargetProperty(property);
		});
		aOldFilterMapSelectProperty.forEach(function(property) {
			self.step.removeFilterMappingSelectProperty(property);
		});
		//set an empty model to the controls on the UI
		var oEmptyModelForControlOnReset = new sap.ui.model.json.JSONModel();
		var oEmptyDateSetForControlOnReset = {
			NoData : []
		};
		oEmptyModelForControlOnReset.setData(oEmptyDateSetForControlOnReset);
		this.byId("idFilterMapSourceSelect").setValue("");
		this.byId("idFilterMapEntitySelect").setModel(oEmptyModelForControlOnReset);
		this.byId("idFilterMapEntitySelect").setSelectedKey();
		this.byId("idFilterMapTargetFilterCombo").setModel(oEmptyModelForControlOnReset);
		var aSelectedKeys = this.byId("idFilterMapTargetFilterCombo").getSelectedKeys();
		this.byId("idFilterMapTargetFilterCombo").removeSelectedKeys(aSelectedKeys);
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleChangeForEntity
	 * @description handler for the "entity" property of the step request or filter mapping based on the event
	 * Checks the id of the source control and sets the value for request entity or filter mapping entity
	 * Reads all the properties for the given source and entity and updates the select properties based on entity.
	 * */
	handleChangeForEntity : function(oEvent) {
		this.oConfigurationEditor.setIsUnsaved();
		var sEntity, sService, aProperties = [], aPropertiesForControl = [];
		var soruceControlId = oEvent.getParameter("id");
		var bIsfilterMapControl = soruceControlId.search("FilterMap") !== -1 ? true : false;
		if (bIsfilterMapControl) {
			sEntity = this.byId("idFilterMapEntitySelect").getSelectedKey();
			sService = this.byId("idFilterMapSourceSelect").getValue().trim();
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sService, sEntity);
		} else {
			sEntity = this.byId("idEntitySelect").getSelectedKey();
			sService = this.byId("idSourceSelect").getValue().trim();
			aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sService, sEntity);
		}
		aProperties.forEach(function(property) {
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aPropertiesForControl.push(oProp);
		});
		var oSelectPropertiesData = {
			Properties : aPropertiesForControl
		};
		var oSelectPropertyModel = new sap.ui.model.json.JSONModel();
		oSelectPropertyModel.setSizeLimit(500);
		oSelectPropertyModel.setData(oSelectPropertiesData);
		var noneTextobj = {
			propertyKey : this.getText("none"),
			propertyName : this.getText("none")
		};
		var aRequiredPropertiesControl = [ noneTextobj ];
		aRequiredPropertiesControl = aRequiredPropertiesControl.concat(aPropertiesForControl);
		var oRequiredFilterMapProertyModel = new sap.ui.model.json.JSONModel();
		oRequiredFilterMapProertyModel.setSizeLimit(500);
		oRequiredFilterMapProertyModel.setData(aRequiredPropertiesControl);
		var oTargetFilterMapProertyModel = new sap.ui.model.json.JSONModel();
		oTargetFilterMapProertyModel.setSizeLimit(500);
		oTargetFilterMapProertyModel.setData(aPropertiesForControl);
		if (bIsfilterMapControl) {
			this.byId("idFilterMapTargetFilterCombo").setModel(oSelectPropertyModel);
		} else {
			this.byId("idSelectPropCombo").setModel(oSelectPropertyModel);
			this.byId("idReqFilterSelect").setModel(oRequiredFilterMapProertyModel);
		}
		this._checkValidationStateForService("entitySet", soruceControlId);
		var sRequiredFilter = this.byId("idReqFilterSelect").getSelectedKey();
		if (sRequiredFilter === this.getText("none")) {
			this._hideAndResetFilterMapField();
		}
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleChangeForSelectProperty
	 * @description handler for the "select property" of the step request or filter mapping based on the event
	 * Checks the id of the source control and sets the value for request select property or filter mapping select property 
	 * Also updates the properties in the required filter list
	 * */
	handleChangeForSelectProperty : function(oEvent) {
		var self = this;
		this.oConfigurationEditor.setIsUnsaved();
		var aSelectProperty, aSelectPropertiesForControl = [];
		var soruceControlId = oEvent.getParameter("id");
		aSelectProperty = this.byId("idSelectPropCombo").getSelectedKeys();
		aSelectProperty.forEach(function(property) {
			self.step.addSelectProperty(property);
			var oProp = {};
			oProp.propertyKey = property;
			oProp.propertyName = property;
			aSelectPropertiesForControl.push(oProp);
		});
		var noneTextobj = {
			propertyKey : this.getText("none"),
			propertyName : this.getText("none")
		};
		var aRequiredPropertiesControl = [ noneTextobj ];
		aRequiredPropertiesControl = aRequiredPropertiesControl.concat(aSelectPropertiesForControl);
		var oRequiredFilterMapProertyModel = new sap.ui.model.json.JSONModel();
		oRequiredFilterMapProertyModel.setSizeLimit(500);
		oRequiredFilterMapProertyModel.setData(aRequiredPropertiesControl);
		var oTargetFilterMapProertyModel = new sap.ui.model.json.JSONModel();
		oTargetFilterMapProertyModel.setSizeLimit(500);
		oTargetFilterMapProertyModel.setData(aSelectPropertiesForControl);
		this.byId("idReqFilterSelect").setModel(oRequiredFilterMapProertyModel);
		this._checkValidationStateForService("selectProperties", soruceControlId);
		var sRequiredFilter = this.byId("idReqFilterSelect").getSelectedKey(); //hide the filter mapping fields if required property is none
		if (sRequiredFilter === this.getText("none")) {
			this._hideAndResetFilterMapField();
		}
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleChangeForRequiredFilter
	 * @description handler for the "Required filter" of the step request
	 * Shows and hides the filter mapping field based on required filter availibility in the step
	 * Updates the entity sets present in the filter mapping based on the required filters
	 * */
	handleChangeForRequiredFilter : function(oEvent) {
		var self = this;
		var soruceControlId = oEvent.getParameter("id");
		this.oConfigurationEditor.setIsUnsaved();
		var aOldSelProp = this.step.getFilterProperties();
		aOldSelProp.forEach(function(property) {
			self.step.removeFilterProperty(property);
		});
		var sRequiredFilter = this.byId("idReqFilterSelect").getSelectedKey();
		if (sRequiredFilter !== this.getText("none")) {
			this.step.addFilterProperty(sRequiredFilter);
			this._showFilterMappingField();//show filter mapping field on UI if there is a required filter
		} else {
			this._hideAndResetFilterMapField();//hide filter mapping field from UI if there is no required filter
		}
		this._checkValidationStateForService("requiredFilter", soruceControlId);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# _showFilterMappingField
	 * @description shows the filter mapping field from UI if the required filter is available in the step
	 * */
	_showFilterMappingField : function() {
		this.byId("idFilterMapping").setVisible(true);
		this.byId("FilterMapLayout").setVisible(true);
		this.byId("idFilterMapping").setText(this.getText("filterMap") + " : ");
		this.byId("idFilterMapSourceLabel").setText(this.getText("source") + " : ");
		this.byId("idFilterMapEntityLabel").setText(this.getText("entity") + " : ");
		this.byId("idFilterMapTargetFilterLabel").setText(this.getText("filterMapTarget") + " : ");
		this.byId("idFilterMapKeepSourceLabel").setText(this.getText("filterMapKeepSource") + " : ");
		this.byId("idFilterMapping").addStyleClass("formTextTitle");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# _hideAndResetFilterMapField
	 * @description hides the filter mapping field from UI if the required filter is not available in the step
	 * */
	_hideAndResetFilterMapField : function() {
		this.byId("idFilterMapping").setVisible(false);
		this.byId("FilterMapLayout").setVisible(false);
		this._removeMandatoryFromFilterMap(); // removes the mandatory tag 
		this._resetFilterMappingFields();//reset the values from the filter mapping properties and clears the selected keys in control
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleChangeForTargetFilter
	 * @description handler for the "target property" of the filter mapping  
	 * sets the value of target filter on the step object
	 * */
	handleChangeForTargetFilter : function(oEvent) {
		var self = this;
		var soruceControlId = oEvent.getParameter("id");
		this.oConfigurationEditor.setIsUnsaved();
		var aTargetFilterMapProp = this.byId("idFilterMapTargetFilterCombo").getSelectedKeys();
		if (aTargetFilterMapProp.length > 0) { // if any value is selected then clear the previous value and add the new one , else retain the old values
			var aOldTargetProp = this.step.getFilterMappingTargetProperties();
			aOldTargetProp.forEach(function(property) {
				self.step.removeFilterMappingTargetProperty(property);
			});
			aTargetFilterMapProp.forEach(function(property) {
				self.step.addFilterMappingTargetProperty(property);
			});
		}
		this._checkValidationStateForService("targetProperties", soruceControlId);
	},
	/**
	 * @function
	 * @name sap.apf.modeler.ui.controller.step# handleFilterMapKeepSource
	 * @description handler for the "keep source" property of the filter mapping  
	 * sets the boolean value of the property on the step object
	 * */
	handleFilterMapKeepSource : function() {
		var bIsKeepSourceSelected = this.byId("idFilterKeepSourceCheckBox").getSelected();
		this.oConfigurationEditor.setIsUnsaved();
		this.step.setFilterMappingKeepSource(bIsKeepSourceSelected);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_checkValidationStateForService
	 * @param param - to determine which property has to be to validated ( e.g. source, entitySet etc) and based on it the other properties has to be checked and updated
	 * @param soruceControlId  - id of the control to determine if the property are being read from a request or filter mapping 
	 * @description chceks if the filter mapping of the step has all mandatory fields( i.e. entitySet, service, select properties and target filter are available in the step)  
	 * and sets the values on the step object
	 * */
	_checkValidationStateForService : function(param, soruceControlId) {
		var self = this;
		var oValidStep = {
			source : undefined,
			entitySet : undefined,
			selectProperty : undefined,
			requiredFilter : undefined,
			targetFilter : undefined
		};
		var sSource, aRequiredProperties, aAllEntitySets = [], aAllEntitySetsForControll = [];
		var bIsfilterMapControl = soruceControlId.search("FilterMap") !== -1 ? true : false;
		sSource = bIsfilterMapControl ? this.byId("idFilterMapSourceSelect").getValue().trim() : this.byId("idSourceSelect").getValue().trim();
		var bServiceRegistered = this.oConfigurationEditor.registerService(sSource);
		if (bServiceRegistered) {
			oValidStep.source = sSource;
			var sSelectedRequiredFilter = this.byId("idReqFilterSelect").getSelectedKey();
			if (sSelectedRequiredFilter !== this.getText("none")) {
				aRequiredProperties = [ sSelectedRequiredFilter ]; // required filter from the step
			} else {
				aRequiredProperties = this.step.getFilterProperties();
			}
			aAllEntitySets = bIsfilterMapControl ? this.oConfigurationEditor.getAllEntitySetsOfServiceWithGivenProperties(sSource, aRequiredProperties) : this.oConfigurationEditor.getAllEntitySetsOfService(sSource);
			var sSelectedEntity;
			if (param === "entitySet" || param === "selectProperties" || param === "targetProperties" || param === "requiredFilter") {
				sSelectedEntity = bIsfilterMapControl ? this.byId("idFilterMapEntitySelect").getSelectedKey() : this.byId("idEntitySelect").getSelectedKey();
			} else {
				sSelectedEntity = bIsfilterMapControl ? this.step.getFilterMappingEntitySet() : this.step.getEntitySet();
			}
			if (sSelectedEntity) {
				aAllEntitySets.forEach(function(entitySet) {
					if (sSelectedEntity === entitySet) {
						oValidStep.entitySet = sSelectedEntity;
						if (param === "source") {
							if (bIsfilterMapControl) {
								self.byId("idFilterMapEntitySelect").setSelectedKey(sSelectedEntity);
							} else {
								self.byId("idEntitySelect").setSelectedKey(sSelectedEntity);
							}
						}
					}
				});
				var aSelectProperties, aCommonProperty = [];
				if (param === "selectProperties") {
					aSelectProperties = this.byId("idSelectPropCombo").getSelectedKeys();
				} else {
					aSelectProperties = this.step.getSelectProperties();
				}
				var aProperties = this.oConfigurationEditor.getAllPropertiesOfEntitySet(sSource, sSelectedEntity); //TODO check
				var aPropertiesForControl = [];
				aProperties.forEach(function(propertyFromEntity) {
					var oProp = {};
					oProp.propertyKey = propertyFromEntity;
					oProp.propertyName = propertyFromEntity;
					aPropertiesForControl.push(oProp);
				});
				var oDataForProperties = {
					Properties : aPropertiesForControl
				};
				var oModelForSelProp = new sap.ui.model.json.JSONModel();
				oModelForSelProp.setSizeLimit(500);
				oModelForSelProp.setData(oDataForProperties);
				this.byId("idSelectPropCombo").setModel(oModelForSelProp);
				this.byId("idFilterMapTargetFilterCombo").setModel(oModelForSelProp);
				aProperties.forEach(function(propertyFromEntity) {
					aSelectProperties.forEach(function(propertyFromControl) {
						if (propertyFromControl === propertyFromEntity) {
							aCommonProperty.push(propertyFromControl);
						}
					});
				});
				var aPropertiesMapControl = [];
				var objNoneText = [ {
					propertyKey : this.getText("none"),
					propertyName : this.getText("none")
				} ];
				if (this.step.getFilterMappingTargetProperties().length === 0) {
					this.byId("idFilterMapTargetFilterCombo").setSelectedKeys([]);// if the target filter is not available then clear the selected items from the control
				}
				if (aCommonProperty.length > 0) {
					oValidStep.selectProperty = aCommonProperty;
					if (param !== "selectProperties") {
						this.byId("idSelectPropCombo").setSelectedKeys(aCommonProperty);
					}
					aCommonProperty.forEach(function(property) {
						var oProp = {};
						oProp.propertyKey = property;
						oProp.propertyName = property;
						aPropertiesMapControl.push(oProp);
					});
				} else { //clear the selected keys from the control if there is no common properties
					var selectedProperties;
					if (!bIsfilterMapControl) {
						selectedProperties = this.byId("idSelectPropCombo").getSelectedKeys();
						this.byId("idSelectPropCombo").removeSelectedKeys(selectedProperties);
						this.byId("idReqFilterSelect").setSelectedKey(this.getText("none"));
					}
				}
				objNoneText = objNoneText.concat(aPropertiesMapControl);
				var oRequiredOrFilterProperties = {
					Properties : objNoneText
				};
				var oRequiredOrFilterPropertyModel = new sap.ui.model.json.JSONModel();
				oRequiredOrFilterPropertyModel.setData(oRequiredOrFilterProperties);
				var aTargetProperties = [], aRequiredFilters = [];
				if (param === "targetProperties") {
					aTargetProperties = this.byId("idFilterMapTargetFilterCombo").getSelectedKeys();
				} else {
					aTargetProperties = this.step.getFilterMappingTargetProperties();
				}
				if (aTargetProperties.length > 0) {
					oValidStep.targetFilter = aTargetProperties;
					this.byId("idFilterMapTargetFilterCombo").setSelectedKeys(aTargetProperties);
				}
				if (param === "requiredFilter") {
					aRequiredFilters.push(this.byId("idReqFilterSelect").getSelectedKey());
				} else {
					aRequiredFilters = this.step.getFilterProperties();
				}
				var aRequiredFilterForValidStep = [];
				aRequiredFilters.forEach(function(requiredFilter) {
					if (requiredFilter !== self.getText("none")) {
						aPropertiesMapControl.forEach(function(oProperty) {
							if (oProperty.propertyKey === requiredFilter) {
								aRequiredFilterForValidStep.push(requiredFilter);
							}
						});
					}
				});
				if (aRequiredFilterForValidStep.length !== 0) {
					oValidStep.requiredFilter = aRequiredFilterForValidStep; //required filters from dropdown - not none text
				} else {
					if (!bIsfilterMapControl) {
						this.byId("idReqFilterSelect").setSelectedKey(this.getText("none"));
					}
				}
				//all the selected properties will be displayed in the target filter property dropdown, none will not be displayed as one property has to be selected
				var oTargetFilterProperties = {
					Properties : aPropertiesMapControl
				};
				var oTargetFilterMapProertyModel = new sap.ui.model.json.JSONModel();
				oTargetFilterMapProertyModel.setSizeLimit(500);
				oTargetFilterMapProertyModel.setData(oTargetFilterProperties);
				if (!bIsfilterMapControl) { //set the model for required filter /target filter
					this.byId("idReqFilterSelect").setModel(oRequiredOrFilterPropertyModel);
				}
			}
			if (bIsfilterMapControl) {
				this._validateStepServiceForFilterMapping(oValidStep);
			} else {
				this._validateStepServiceForDataSource(oValidStep);
			}
		} else { // if service is invalid , reset all the request properties
			if (bIsfilterMapControl) {
				this._resetFilterMappingFields(); //resets the filter mapping target property
			} else {
				this._resetStepRequestProperties();
			}
		}
	},
	/**
	 * @function
	 * @private 
	 * @name sap.apf.modeler.ui.controller.step# _resetStepRequestProperties
	 * Resets all the values for the step request properties (service, entitySet, select properties, required filter)
	 * */
	_resetStepRequestProperties : function() {
		var self = this;
		this.step.setEntitySet(undefined);
		var aOldSelectProperty = this.step.getSelectProperties();
		aOldSelectProperty.forEach(function(property) {
			self.step.removeSelectProperty(property);
		});
		var aOldRequiredFilterProperty = this.step.getFilterProperties();
		aOldRequiredFilterProperty.forEach(function(property) {
			self.step.removeFilterProperty(property);
		});
		this.byId("idEntitySelect").setSelectedKey();
		this.byId("idReqFilterSelect").setSelectedKey();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_validateStepServiceForDataSource
	 * @param {Step}  - step object 
	 * @description chceks if the data source of the step is has all mandatory fields (i.e. entitySet, service, select properties are available in the step)  
	 * and sets the values on the step object
	 * */
	_validateStepServiceForDataSource : function(oValidStep) {
		var self = this;
		if (oValidStep.selectProperty && oValidStep.entitySet && oValidStep.source) {
			this.step.setService(oValidStep.source);
			this.step.setEntitySet(oValidStep.entitySet);
			var aOldSelProp = this.step.getSelectProperties();
			aOldSelProp.forEach(function(property) {
				self.step.removeSelectProperty(property);
			});
			oValidStep.selectProperty.forEach(function(property) {
				self.step.addSelectProperty(property);
			});
			var aOldRequiredProp = this.step.getFilterProperties();
			aOldRequiredProp.forEach(function(property) {
				self.step.removeFilterProperty(property);
			});
			if (oValidStep.requiredFilter) {
				oValidStep.requiredFilter.forEach(function(property) {
					self.step.addFilterProperty(property);
				});
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_validateStepServiceForFilterMapping
	 * @param {Step}  - step object 
	 * @description chceks if the filter mapping of the step has all mandatory fields( i.e. entitySet, service, select properties and target filter are available in the step)  
	 * and sets the values on the step object
	 * */
	_validateStepServiceForFilterMapping : function(oValidStep) {
		var self = this;
		if (oValidStep.selectProperty && oValidStep.entitySet && oValidStep.source && oValidStep.targetFilter) {
			this.step.setFilterMappingService(oValidStep.source);
			this.step.setFilterMappingEntitySet(oValidStep.entitySet);
			var aOldFilterMapSelProp = this.step.getFilterMappingSelectProperties();
			aOldFilterMapSelProp.forEach(function(property) {
				self.step.removeFilterMappingSelectProperty(property);
			});
			oValidStep.selectProperty.forEach(function(property) {
				self.step.addFilterMappingSelectProperty(property);
			});
			var aOldFilterMapTargetProp = this.step.getFilterMappingTargetProperties();
			aOldFilterMapTargetProp.forEach(function(property) {
				self.step.removeFilterMappingTargetProperty(property);
			});
			oValidStep.targetFilter.forEach(function(property) {
				self.step.addFilterMappingTargetProperty(property);
			});
		}
	},
	handleChangeForCategory : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var self = this;
		var stepId = self.step.getId();
		var currentCategoryId = this.params.arguments.categoryId;
		var aPreCat = this.oConfigurationEditor.getCategoriesForStep(this.step.getId());
		var sSelCategory = this.byId("idCategorySelect").getSelectedKeys();
		var currentCategoryChange = sSelCategory.indexOf(currentCategoryId);
		var aStepContexts = [];
		var unselectedCategories = [];
		var i, j;
		for(i = 0; i < aPreCat.length; i++) {
			var match = false;
			for(j = 0; j < sSelCategory.length; j++) {
				if (aPreCat[i] === sSelCategory[j]) {
					match = true;
					break;
				}
			}
			if (!match) {
				unselectedCategories.push(aPreCat[i]);
			}
		}
		if (sSelCategory.length !== 0) {
			sSelCategory.forEach(function(category) {
				self.oConfigurationEditor.addCategoryStepAssignment(category, stepId); //Add the step to the categories selected
				var oStepContext = {
					oldContext : {
						name : self.params.name,
						arguments : {
							configId : self.params.arguments.configId,
							categoryId : currentCategoryId,
							stepId : stepId
						}
					},
					newContext : {
						arguments : {
							configId : self.params.arguments.configId,
							categoryId : category
						}
					}
				};
				if (category !== currentCategoryId) {
					aStepContexts.push(oStepContext);
				}
			});
			aPreCat.forEach(function(sCatId) { //Remove the step from all the old categories it was present in
				if (sSelCategory.indexOf(sCatId) === -1) { // ... and that are not selected any more
					self.oConfigurationEditor.removeCategoryStepAssignment(sCatId, self.step.getId());
				}
			});
			if (unselectedCategories.length !== 0) {//Prepare context for unselected categories, to be removed from the model
				var newContext = jQuery.extend(true, {}, self.params);
				unselectedCategories.forEach(function(unselectedCategory) {
					var oStepContext = {
						oldContext : {
							name : self.params.name,
							arguments : {
								configId : self.params.arguments.configId,
								categoryId : currentCategoryId,
								stepId : stepId
							}
						},
						newContext : {
							arguments : {
								configId : self.params.arguments.configId,
								categoryId : unselectedCategory
							}
						},
						removeStep : true
					};
					if (currentCategoryChange === -1 && unselectedCategory === currentCategoryId) {//Prepare context for category change, if the current category is removed from the step
						var categoryChangeContext = {
							arguments : {
								appId : self.params.arguments.appId,
								configId : self.params.arguments.configId,
								categoryId : sSelCategory[0],
								stepId : stepId
							}
						};
						oStepContext.categoryChangeContext = categoryChangeContext;
						oStepContext.changeCategory = true;
					}
					aStepContexts.push(oStepContext);
				});
			}
		}
		if (aStepContexts.length !== 0) {
			this.oViewData.updateConfigTree(aStepContexts);//When the categories in the step is changed
		}
	},
	handleChangeForLeftTop : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sStepLeftTop = this.byId("idLeftTop").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_CORNER_TEXT;
		var sStepLeftTopTextId = this.oTextPool.setText(sStepLeftTop, oTranslationFormat);
		this.step.setLeftUpperCornerTextKey(sStepLeftTopTextId);
	},
	handleChangeForRightTop : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sStepRightTop = this.byId("idRightTop").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_CORNER_TEXT;
		var sStepRightTopTextId = this.oTextPool.setText(sStepRightTop, oTranslationFormat);
		this.step.setRightUpperCornerTextKey(sStepRightTopTextId);
	},
	handleChangeForLeftBottom : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sStepLeftBottom = this.byId("idLeftBottom").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_CORNER_TEXT;
		var sStepLeftBottomTextId = this.oTextPool.setText(sStepLeftBottom, oTranslationFormat);
		this.step.setLeftLowerCornerTextKey(sStepLeftBottomTextId);
	},
	handleChangeForRightBottom : function() {
		this.oConfigurationEditor.setIsUnsaved();
		var sStepRightBottom = this.byId("idRightBottom").getValue().trim();
		var oTranslationFormat = sap.apf.modeler.ui.utils.TranslationFormatMap.STEP_CORNER_TEXT;
		var sStepRightBottomTextId = this.oTextPool.setText(sStepRightBottom, oTranslationFormat);
		this.step.setRightLowerCornerTextKey(sStepRightBottomTextId);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_setMandatoryFields
	 * @param {Array} fields - Array of form fields
	 * @description Set mandatory fields on the instance level  
	 * */
	_setMandatoryFields : function(fields) {
		this.mandatoryFields = this.mandatoryFields || [];
		for( var i = 0; i < fields.length; i++) {
			fields[i].isMandatory = true;
			this.mandatoryFields.push(fields[i]);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_getMandatoryFields
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description getter for mandatory fields
	 * */
	_getMandatoryFields : function() {
		return this.mandatoryFields;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#_setValidationState
	 * @param {Object} oEvent - Event instance of the form field 
	 * @description Set validation state of sub view
	 * */
	_setValidationState : function() {
		var mandatoryFields = this._getMandatoryFields();
		for( var i = 0; i < mandatoryFields.length; i++) {
			if (mandatoryFields[i].isMandatory === true) {
				if (typeof mandatoryFields[i].getSelectedKeys === "function") {
					this.isValidState = (mandatoryFields[i].getSelectedKeys().length >= 1) ? true : false;
				} else if (typeof mandatoryFields[i].getValue === "function") {
					this.isValidState = (mandatoryFields[i].getValue() !== "") ? true : false;
				} else {
					this.isValidState = (mandatoryFields[i].getSelectedKey().length >= 1) ? true : false;
				}
				if (this.isValidState === false) {
					break;
				}
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.step#getValidationState
	 * @description Getter for getting the current validation state of sub view
	 * */
	getValidationState : function() {
		this._setValidationState(); //Set the validation state of view
		var isValidState = (this.isValidState !== undefined) ? this.isValidState : true;
		return isValidState;
	}
});

}; // end of sap/apf/modeler/ui/controller/step.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.utils.APFTree') ) {
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
/**
  * APF Custom Tree Control
  */
jQuery.sap.declare('sap.apf.modeler.ui.utils.APFTree');

sap.ui.getCore().loadLibrary("sap.ui.commons");
/**
 * @private
 * @class APF Custom Tree
 * @description APF Custom Tree which exposes certain API's to perform different operations on the tree
 * @name sap.apf.modeler.ui.utils.APFTree
 */
sap.ui.commons.Tree.extend("sap.apf.modeler.ui.utils.APFTree", {
	metadata : {
		events : {},
		properties : {
			translationFunction : {},
			defaultRepresentationType : {}
		}
	},
	renderer : function(oControl, oRM) {
		sap.ui.commons.TreeRenderer.render(oControl, oRM);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#setTranslationFunction
	 * @param {sap.apf.modeler.core.Instance.getText} Function to get translated texts
	 * @description Setter for TranslationFunction property which is used to get the translated texts
	 * */
	setTranslationFunction : function(fnTranslationFunction) {
		this.fnTranslationFunction = fnTranslationFunction;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#setDefaultRepresentationType
	 * @param {String} Default representation type
	 * @description Setter for DefaultRepresentationType property which is used to set the default representation
	 * */
	setDefaultRepresentationType : function(sDefaultRepresentationType) {
		this.defaultRepresentationType = sDefaultRepresentationType;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#getNodeContext
	 * @param {sap.ui.commons.TreeNode} Tree Node - Tree node whose context has to be derived
	 * @description Gets the context of the node
	 * */
	getNodeContext : function(oNode) {
		if (oNode) {
			var oNodeContext = oNode ? oNode.getBindingContext() : undefined;
			var sObjectType = oNodeContext.getObject() ? oNodeContext.getObject().type : undefined;
			var sObjectId;
			if (oNodeContext.getObject() && oNodeContext.getObject().id) {
				sObjectId = oNodeContext.getObject().id;
			} else if (oNodeContext.getObject() && oNodeContext.getObject().AnalyticalConfiguration) {
				sObjectId = oNodeContext.getObject().AnalyticalConfiguration;
			}
			return {
				oNode : oNode,
				nodeContext : oNodeContext.sPath,
				nodeObjectType : sObjectType,
				nodeTitle : oNode.getText(),
				nodeAPFId : sObjectId
			};
		}
		return null;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#getParentNodeContext
	 * @param {sap.ui.commons.TreeNode} Tree Node - Tree node whose context has to be derived
	 * @description Gets the context of the parent node
	 * */
	getParentNodeContext : function(oSelectedNodeDetails) {
		var oModel = this.getModel();
		if (oSelectedNodeDetails !== null) {
			var configIndexInTree = oSelectedNodeDetails.nodeContext.split('/')[2];
			var configurationId = oModel.getData().aConfigDetails[configIndexInTree] ? oModel.getData().aConfigDetails[configIndexInTree].AnalyticalConfiguration : undefined;
			var oRepresentationNode, oStepNode;
			var categoryIndexInConfig = oSelectedNodeDetails.nodeContext.split('/')[6];
			var facetFilterIndexInConfig = oSelectedNodeDetails.nodeContext.split('/')[6];
			var navTargetIndexInConfig = oSelectedNodeDetails.nodeContext.split('/')[6];
			var stepIndexInCategory = oSelectedNodeDetails.nodeContext.split('/')[8];
			var oSelectedNodeParentDetails = {};
			if (oSelectedNodeDetails !== null) {
				switch (oSelectedNodeDetails.nodeObjectType) { // based on the object type get the parent nodes	
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
						oSelectedNodeParentDetails.facetFilterId = oModel.getData().aConfigDetails[configIndexInTree].configData[0].filters[facetFilterIndexInConfig].id;
						oSelectedNodeParentDetails.configurationId = configurationId;
						oSelectedNodeParentDetails.configurationName = oModel.getData().aConfigDetails[configIndexInTree].name;
						oSelectedNodeParentDetails.facetFilterName = oModel.getData().aConfigDetails[configIndexInTree].configData[0].filters[facetFilterIndexInConfig].name;
						break;
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
						oSelectedNodeParentDetails.categoryId = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].id;
						oSelectedNodeParentDetails.configurationId = configurationId;
						oSelectedNodeParentDetails.configurationName = oModel.getData().aConfigDetails[configIndexInTree].name;
						oSelectedNodeParentDetails.categoryName = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].name;
						break;
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
						oStepNode = oSelectedNodeDetails.oNode;
						oSelectedNodeParentDetails.configurationId = configurationId;
						oSelectedNodeParentDetails.categoryId = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].id;
						oSelectedNodeParentDetails.stepId = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].id;
						oSelectedNodeParentDetails.configurationName = oModel.getData().aConfigDetails[configIndexInTree].name;
						oSelectedNodeParentDetails.categoryName = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].name;
						oSelectedNodeParentDetails.stepName = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].name;
						break;
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
						oRepresentationNode = oSelectedNodeDetails.oNode;
						oSelectedNodeParentDetails.configurationId = configurationId;
						oSelectedNodeParentDetails.categoryId = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].id;
						oSelectedNodeParentDetails.stepId = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].id;
						oSelectedNodeParentDetails.representationId = oRepresentationNode.getBindingContext().getObject().id;
						oSelectedNodeParentDetails.configurationName = oModel.getData().aConfigDetails[configIndexInTree].name;
						oSelectedNodeParentDetails.categoryName = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].name;
						oSelectedNodeParentDetails.stepName = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].name;
						oSelectedNodeParentDetails.representationName = oRepresentationNode.getBindingContext().getObject().name;
						break;
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
						oSelectedNodeParentDetails.configurationId = oSelectedNodeDetails.oNode.getBindingContext().getObject().AnalyticalConfiguration;
						oSelectedNodeParentDetails.configurationName = oSelectedNodeDetails.oNode.getBindingContext().getObject().name;
						break;
					case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
						oSelectedNodeParentDetails.navTargetId = oModel.getData().aConfigDetails[configIndexInTree].configData[2].navTargets[navTargetIndexInConfig].id;
						oSelectedNodeParentDetails.configurationId = configurationId;
						oSelectedNodeParentDetails.configurationName = oModel.getData().aConfigDetails[configIndexInTree].name;
						oSelectedNodeParentDetails.navTargetName = oModel.getData().aConfigDetails[configIndexInTree].configData[2].navTargets[navTargetIndexInConfig].name;
						break;
					case "default":
						break;
				}
			}
			return oSelectedNodeParentDetails;
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#isConfigurationSwitched
	 * @param {sap.ui.commons.TreeNode} Tree Node - Previous selected node on the tree
	 * @param {sap.ui.commons.TreeNode} Tree Node - Current selected node on the tree
	 * @description Checks whether a configuration switch has happened
	 * @returns {Boolean} Returns boolean specifying whether configuration switch has happened
	 * */
	isConfigurationSwitched : function(oPreviousSelectedNode, oCurrentSelectedNode) {
		var bIsDifferntConfig = false;
		var oPreviousSelectedNodeParentDetails = this.getParentNodeContext(this.getNodeContext(oPreviousSelectedNode));
		var oCurrentSelectedNodeParentDetails = this.getParentNodeContext(this.getNodeContext(oCurrentSelectedNode));
		if (oPreviousSelectedNodeParentDetails && !jQuery.isEmptyObject(oPreviousSelectedNodeParentDetails) && (oPreviousSelectedNodeParentDetails.configurationId !== oCurrentSelectedNodeParentDetails.configurationId)) {
			bIsDifferntConfig = true;
		}
		return bIsDifferntConfig;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#removeSelection
	 * @param {sap.ui.commons.TreeNode} Tree Node - Current selection on the tree
	 * @description Removes all the selection from the tree
	 * */
	removeSelectionOnTree : function(oSelectedNode) {
		var oSelectionOnTree = this.getSelection();
		if (oSelectedNode) {
			oSelectedNode.getBindingContext().getObject().isSelected = false;
		} else if (oSelectionOnTree) {
			oSelectionOnTree.getBindingContext().getObject().isSelected = false;
		}
		this.getModel().updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#setSelection
	 * @param {String} Binding context of the node which has to be shown selected on the tree
	 * @description Sets selection on the tree
	 * */
	setSelectionOnTree : function(sBindingContextOfSelectedNode) {
		this.selectedNode = this.getNodeByContext(sBindingContextOfSelectedNode);
		var oSelectionOnTree = this.getSelection();
		if (oSelectionOnTree !== this.selectedNode) {
			if (oSelectionOnTree && oSelectionOnTree.getBindingContext().getObject()) {
				oSelectionOnTree.getBindingContext().getObject().isSelected = false;
				oSelectionOnTree.setIsSelected(false);
			}
			this.selectedNode.setIsSelected(true);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_scrollTreeToNewNode
	 * @param {sap.ui.commons.TreeNode} New added node in the tree
	 * @description Sets the scroll position to the newly added node
	 * */
	_scrollTreeToNewNode : function(oNewAddedTreeNode) {
		if (oNewAddedTreeNode && oNewAddedTreeNode.$().length !== 0) {
			jQuery(oNewAddedTreeNode.$())[0].scrollIntoView();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#setSelectedNode
	 * @param {sap.ui.commons.TreeNode} Tree node which has to be selected
	 * @description Sets node as selected in the tree
	 * */
	setSelectedNode : function(oNode) {
		this.setSelection(this.getNodeByContext(oNode.getBindingContext().sPath));
		this._scrollTreeToNewNode(oNode);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_getObjectNodesArray
	 * @param {String} Selected Object node type
	 * @param {Integer} Selected configuration index in tree
	 * @param {Integer} Selected category index in tree
	 * @param {Integer} Selected step index in tree
	 * @description Get array of nodes of selected object type
	 * @returns {Array} Returns an array of nodes of selected object type
	 * */
	_getObjectNodesArray : function(sObjectType, configIndexInTree, categoryIndexInConfig, stepIndexInCategory) {
		var aObjectArray;
		switch (sObjectType) {
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
				aObjectArray = this.getNodes();
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
				aObjectArray = this.getNodes()[configIndexInTree].getNodes()[0].getNodes();
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
				aObjectArray = this.getNodes()[configIndexInTree].getNodes()[1].getNodes();
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
				aObjectArray = this.getNodes()[configIndexInTree].getNodes()[1].getNodes()[categoryIndexInConfig].getNodes();
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
				aObjectArray = this.getNodes()[configIndexInTree].getNodes()[1].getNodes()[categoryIndexInConfig].getNodes()[stepIndexInCategory].getNodes();
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
				aObjectArray = this.getNodes()[configIndexInTree].getNodes()[2].getNodes();
				break;
		}
		return aObjectArray;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#addNodeInTree
	 * @param {String} Selected Object node type
	 * param {Object} Existing Steps Or Representations in existing steps to be added
	 * @description Adds selected object type node into the tree
	 * */
	addNodeInTree : function(sObjectType, params) {
		var oModel = this.getModel();
		var sMethodName;
		var selectedTreeNodeDetails = this.getNodeContext(this.getSelection());
		var configIndexInTree = selectedTreeNodeDetails ? selectedTreeNodeDetails.nodeContext.split('/')[2] : undefined;
		var categoryIndexInConfig = selectedTreeNodeDetails ? selectedTreeNodeDetails.nodeContext.split('/')[6] : undefined;
		var stepIndexInCategory = selectedTreeNodeDetails ? selectedTreeNodeDetails.nodeContext.split('/')[8] : undefined;
		sMethodName = [ "_add", sObjectType ].join("");
		this[sMethodName](configIndexInTree, categoryIndexInConfig, stepIndexInCategory, params);
		var aObjectArray = this._getObjectNodesArray(sObjectType, configIndexInTree, categoryIndexInConfig, stepIndexInCategory);
		var newAddedTreeNode = aObjectArray[aObjectArray.length - 1];
		if (sObjectType !== sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) {
			if (newAddedTreeNode.getParent()) {
				newAddedTreeNode.getParent().setExpanded(true);
			}
		}
		this.setSelectedNode(newAddedTreeNode);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addconfiguration
	 * @description Adds a configuration node into the tree
	 * */
	_addconfiguration : function() { // adds a new configuration in the tree
		var self = this;
		this.configNewIndex = this.configNewIndex || 1;
		var oModel = this.getModel();
		var idOfConfig;
		//Increment the configuration index each time to traverse to route
		idOfConfig = "I" + this.configNewIndex;
		this.configNewIndex++;
		var allCategoryInConfig = [], aFacetFilter = [], aCategoryWithStepDetails = [], aNavigationTargets = [];
		allCategoryInConfig.push({
			filters : aFacetFilter,
			name : self.fnTranslationFunction("facetFilters"),
			isSelected : false,
			expanded : false,
			selectable : false
		});
		allCategoryInConfig.push({
			categories : aCategoryWithStepDetails,
			name : self.fnTranslationFunction("categories"),
			isSelected : false,
			expanded : false,
			selectable : false
		});
		allCategoryInConfig.push({
			navTargets : aNavigationTargets,
			name : self.fnTranslationFunction("navigationTargets"),
			isSelected : false,
			expanded : false,
			selectable : false
		});
		var oConfigDetails = {};
		oConfigDetails.configData = allCategoryInConfig;
		var newConfigName = this.fnTranslationFunction("newConfiguration");
		var newConfigObject = {
			name : "< " + newConfigName + " >",
			type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION,
			AnalyticalConfiguration : "newConfig" + idOfConfig,
			configData : allCategoryInConfig,
			bIsLoaded : true,
			isSelected : false,
			expanded : false,
			selectable : true
		};
		oModel.getData().aConfigDetails.push(newConfigObject); //push the new configuration at the last index
		oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addfacetFilter
	 * @description Adds a facet filter node into the tree
	 * */
	_addfacetFilter : function(configIndexInTree) { // adds a new facet filter in the selected configuration
		var oModel = this.getModel();
		var newFacetFilterName = this.fnTranslationFunction("newFacetFilter");
		var idOfFacetFilter = oModel.getData().aConfigDetails[configIndexInTree].configData[0].filters.length;
		var newFacetFilterObject = {
			name : "< " + newFacetFilterName + " >",
			type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER,
			id : "newFilter" + idOfFacetFilter,
			isSelected : false,
			selectable : true
		};
		oModel.getData().aConfigDetails[configIndexInTree].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[0].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[0].filters.push(newFacetFilterObject);//push the new facet filter at the last index
		oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addnavigationTarget
	 * @description Adds a navigation Target node into the tree
	 * */
	_addnavigationTarget : function(configIndexInTree) { // adds a new navigation Target in the selected configuration
		var oModel = this.getModel();
		var newNavigationTargetName = this.fnTranslationFunction("newNavigationTarget");
		var idOfNavigationTarget = oModel.getData().aConfigDetails[configIndexInTree].configData[2].navTargets.length;
		var newNavigationTargetObject = {
			name : "< " + newNavigationTargetName + " >",
			type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET,
			id : "newNavTarget" + idOfNavigationTarget,
			isSelected : false,
			selectable : true
		};
		oModel.getData().aConfigDetails[configIndexInTree].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[2].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[2].navTargets.push(newNavigationTargetObject);//push the new navigation Target at the last index
		oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addcategory
	 * @description Adds a category node into the tree
	 * */
	_addcategory : function(configIndexInTree) {// adds a new category in the selected configuration
		var oModel = this.getModel();
		var newCategoryName = this.fnTranslationFunction("newCategory");
		var idOfCategory = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories.length;
		var newCategoryObject = {
			name : "< " + newCategoryName + " >",
			type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY,
			id : "newCategory" + idOfCategory,
			isSelected : false,
			expanded : false,
			selectable : true
		};
		oModel.getData().aConfigDetails[configIndexInTree].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[1].expanded = true;
		oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories.push(newCategoryObject);//push the new category at the last index
		oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addstep
	 * @description Adds a new step or existing step node into the tree
	 * @param Contains the list of existing steps to be added
	 * */
	_addstep : function(configIndexInTree, categoryIndexInConfig, stepIndexInCategory, params) { // adds a new step or existing step with representations in the selected category under a configuration
		var oModel = this.getModel();
		var newStepObject;
		if (oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps === undefined) {
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps = [];
		}
		if (!params) {// Incase of a new step
			var idOfStep = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps.length;
			var newStepName = this.fnTranslationFunction("newStep");
			newStepObject = {
				name : "< " + newStepName + " >",
				type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,
				id : "newStep" + idOfStep,
				isSelected : false,
				expanded : false,
				selectable : true
			};
			oModel.getData().aConfigDetails[configIndexInTree].expanded = true;
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].expanded = true;
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].expanded = true;
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps.push(newStepObject);
		} else {//In case of existing steps(single or multiple)
			var existingStepObject, i, j;
			for(i = 0; i < params.noOfSteps; i++) {
				existingStepObject = {
					name : params.aExistingStepsToBeAdded[i].step.name,
					type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP,
					id : params.aExistingStepsToBeAdded[i].step.id,
					isSelected : false,
					expanded : false,
					selectable : true
				};
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps.push(existingStepObject);
				if (params.aExistingStepsToBeAdded[i].noOfReps !== 0) {
					stepIndexInCategory = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps.length - 1;
					for(j = 0; j < params.aExistingStepsToBeAdded[i].noOfReps; j++) {
						var representationParams = {
							id : params.aExistingStepsToBeAdded[i].representations[j].id,
							name : params.aExistingStepsToBeAdded[i].representations[j].name,
							icon : params.aExistingStepsToBeAdded[i].representations[j].icon
						};
						this._addrepresentation(configIndexInTree, categoryIndexInConfig, stepIndexInCategory, representationParams);//In case the existing step has representations
					}
				}
			}
		}
		oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.utils.APFTree#_addrepresentation
	 * @description Adds a new representation node or existing representations into the tree
	 * @param Contains the representation node to be added under an existing step
	 * */
	_addrepresentation : function(configIndexInTree, categoryIndexInConfig, stepIndexInCategory, params) {// adds a new representation in the selected step in a category under a configuration
		var oModel = this.getModel();
		var self = this;
		var stepId;
		if (params === undefined) {//In case of new representation under a step or existing step
			var selectedTreeNodeDetails = this.getNodeContext(this.getSelection());
			if (selectedTreeNodeDetails.nodeObjectType === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION) {
				stepId = this.getParentNodeContext(selectedTreeNodeDetails, oModel).stepId;
			} else if (selectedTreeNodeDetails.nodeObjectType === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP) {
				stepId = selectedTreeNodeDetails.nodeAPFId;
			}
			var aStepContexts = [];
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories.forEach(function(category, categoryIndex) {
				if (oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndex].steps) {
					oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndex].steps.forEach(function(step, stepIndex) {
						var stepContext = {};
						if (step.id === stepId) {
							stepContext.stepIndex = stepIndex;
							stepContext.categoryIndex = categoryIndex;
							aStepContexts.push(stepContext);
						}
					});
				}
			});
			aStepContexts.forEach(function(stepContext) {
				if (oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].steps[stepContext.stepIndex].representations === undefined) {
					oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].steps[stepContext.stepIndex].representations = [];
				}
				var idOfRep = oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].steps[stepContext.stepIndex].representations.length;
				var newRepresentationObject = {
					name : self.fnTranslationFunction(self.defaultRepresentationType),
					type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,
					id : "newRepresentation" + idOfRep,
					isSelected : false,
					selectable : true
				};
				oModel.getData().aConfigDetails[configIndexInTree].expanded = true;
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].expanded = true;
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].expanded = true;
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].steps[stepContext.stepIndex].expanded = true;
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[stepContext.categoryIndex].steps[stepContext.stepIndex].representations.push(newRepresentationObject);//push the new representation at the last index
			});
		} else {//In case of adding existing step with representations
			if (oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].representations === undefined) {
				oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].representations = [];
			}
			var representationObject = {
				name : params.name,
				type : sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION,
				id : params.id,
				isSelected : false,
				selectable : true,
				icon : params.icon
			};
			oModel.getData().aConfigDetails[configIndexInTree].configData[1].categories[categoryIndexInConfig].steps[stepIndexInCategory].representations.push(representationObject);//push the existing representation at the last index
		}
		oModel.updateBindings();
	}
});

}; // end of sap/apf/modeler/ui/utils/APFTree.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.BaseUI5ChartRepresentation') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */


jQuery.sap.declare("sap.apf.ui.representations.BaseUI5ChartRepresentation");
/** 
 * @class representation base class constructor.
 * @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
 * @returns chart object
 */
sap.apf.ui.representations.BaseUI5ChartRepresentation = function(oApi, oParameters) {
	this.oMessageObject = "";
	this.legendBoolean = true;
	this.aDataResponse = undefined;
	this.dataset = {};
	this.oModel = new sap.ui.model.json.JSONModel();
	this.bDataHasBeenSelected = false;
	this.parameter = oParameters;
	this.orderby = oParameters.orderby;
	this.dimension = oParameters.dimensions;
	this.measure = oParameters.measures;
	this.alternateRepresentation = oParameters.alternateRepresentationType;
	this.requiredFilters = oParameters.requiredFilters;
	this.UI5ChartHelper = new sap.apf.ui.representations.utils.UI5ChartHelper(oApi, this.parameter);
	this.chartInstance = {};
	this.chartParam = "";
	this.thumbnailChartParam = "";
	this.disableSelectEvent = false;
	this.oApi = oApi;
	var self = this;
	this.showXaxisLabel = true;
	this.axisType = sap.apf.ui.utils.CONSTANTS.axisTypes.AXIS;
};
sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype = {
	/**
	 * @method getParameter
	 * @description returns the constructor arguments which will be used to create toggle representation.
	 */
	getParameter : function() {
		return this.parameter;
	},
	/**
	 * @method setData
	 * @param aDataResponse  Response from oData service
	 * @param metadata Metadata of the oData service
	 * @description Fetches the data from oData service and updates the selection if present
	 * Handles data with multiple dimensions .
	 */
	setData : function(aDataResponse, metadata) {
		this.bIsGroupTypeChart = this.getIsGroupTypeChart();
		this.oDataSetHelper = this.getDataSetHelper();
		this.UI5ChartHelper.init(aDataResponse, metadata, this.bIsGroupTypeChart, this.oDataSetHelper);
		this.formatter = new sap.apf.ui.representations.utils.formatter(this.oApi, metadata, aDataResponse);
		this.aDataResponse = aDataResponse || [];
		this.metadata = metadata;
		if (!this.metadata) {
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6004",
				aParameters : [ this.oApi.getTextNotHtmlEncoded("step") ]
			});
			this.oApi.putMessage(this.oMessageObject);
		}
	},
	/**
	 * @method attachSelectionAndFormatValue
	 * @description formats the measure values for the chart and also attaches all the selection events for the chart
	 */
	attachSelectionAndFormatValue : function(oStepTitle) {
		var self = this;
		if (!oStepTitle) {
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6002",
				aParameters : [ "title", this.oApi.getTextNotHtmlEncoded("step") ]
			});
			this.oApi.putMessage(this.oMessageObject);
		}
		if (this.dimension.length === 0) {
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6002",
				aParameters : [ "dimensions", oStepTitle ]
			});
			this.oApi.putMessage(this.oMessageObject);
		}
		if (this.measure.length === 0) {
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6002",
				aParameters : [ "measures", oStepTitle ]
			});
			this.oApi.putMessage(this.oMessageObject);
		}
		if (!this.aDataResponse || this.aDataResponse.length === 0) {
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6000",
				aParameters : [ oStepTitle ]
			});
			this.oApi.putMessage(this.oMessageObject);
		}
		/**
		 * @method attachSelectData
		 * @param event which is triggered on selection of data on chart
		 * @description Adding selection to the chart based on the selected indices provided
		 */
		this.chart.attachSelectData(function(e) {
			self.handleSelection(e);
		});
		/**
		 * @method attachDeselectData
		 * @param event handler on deselect of data
		 * @description For deselect of data from the chart on user event
		 */
		this.chart.attachDeselectData(function(e) {
			self.handleDeselection(e);
		});
	},
	/**
	 * @method getFormatStringForMeasure
	 * @param {measure}- a measure
	 * @description gets the format string for axis label and tooltip
	 * @return sFormatString , has the format string and also a boolean which indicated whether all the measure unit semantic are same or not
	 *             sFormatString ="#,#0.0"
	
	 */
	getFormatStringForMeasure : function(measure) {
		var sFormatString = this.formatter.getFormatString(measure); // get the format string
		return sFormatString;
	},
	/**
	 * @method getIsAllMeasureSameUnit
	 * @description checks if all the measures have same unit semantic and sets a boolean accordingly
	 * @retun bAllMeasuresSameUnit - boolean to indicate if all the measures have same unit semantic. 
	 * This boolean is used to set the formatting to y axis only when all the measures have same unit (e.g. clustered column chart),
	 * otherwise the formatting will not be applied to y axis.
	 */
	getIsAllMeasureSameUnit : function() {
		var bAllMeasuresSameUnit = true;
		var self = this;
		var firstMeasureUnitSemantic = this.metadata.getPropertyMetadata(this.measure[0].fieldName).unit ? this.metadata.getPropertyMetadata(this.metadata.getPropertyMetadata(this.measure[0].fieldName).unit).semantics : undefined;
		var measureUnitSemantic;
		this.measure.forEach(function(measure, index) {
			measureUnitSemantic = self.metadata.getPropertyMetadata(self.measure[index].fieldName).unit ? self.metadata.getPropertyMetadata(self.metadata.getPropertyMetadata(measure.fieldName).unit).semantics : undefined;
			if (bAllMeasuresSameUnit && firstMeasureUnitSemantic !== undefined && measureUnitSemantic && (firstMeasureUnitSemantic !== measureUnitSemantic)) {
				bAllMeasuresSameUnit = false; // bAllMeasuresSameUnit boolean is used to find out if there are measures with different unit semantics
			}
		});
		return bAllMeasuresSameUnit;
	},
	/**
	 *@method createThumbnailLayout
	 *@description creates a layout for Thumbnail for the current chart type and also shows "no data" in the thumbnail if data is not there 
	 */
	createThumbnailLayout : function() {
		var self = this;
		this.thumbnailLayout = new sap.ui.layout.HorizontalLayout().addStyleClass('thumbnailLayout');
		if (this.aDataResponse !== undefined && this.aDataResponse.length !== 0) {
			this.thumbnailChart.setModel(this.oModel);
			this.thumbnailLayout.removeAllContent();
			this.thumbnailLayout.addContent(this.thumbnailChart);
		} else {
			var noDataText = new sap.m.Text({
				text : this.oApi.getTextNotHtmlEncoded("noDataText")
			}).addStyleClass('noDataText');
			this.thumbnailLayout.removeAllContent();
			this.thumbnailLayout.addContent(noDataText);
		}
	},
	/**
	 * @method getAlternateRepresentation
	 * @description returns the alternate representation of current step (i.e. list representation for the charts)
	 */
	getAlternateRepresentation : function() {
		return this.alternateRepresentation;
	},
	/**
	 * @description returns meta data for representation type
	 */
	getMetaData : function() {
		return this.metadata;
	},
	/**
	 * @description returns data for representation type
	 */
	getData : function() {
		return this.aDataResponse;
	},
	/**
	 * @method getRequestOptions
	 * @description provide optional filter properties for odata request URL such as pagging, sorting etc
	 */
	getRequestOptions : function() {
		if (this.orderby && this.orderby.length) {
			var aOrderbyProps = this.orderby.map(function(oOrderby) {
				return {
					property : oOrderby.property,
					descending : !oOrderby.ascending
				};
			});
			return {
				orderby : aOrderbyProps
			};
		} else {
			return {};
		}
	},
	/**
	 * @method createDataset
	 * @description Intantiates the dataset to be consumed by the chart
	 */
	createDataset : function() {
		this.dataset = this.UI5ChartHelper.getDataset();
		this.oModel = this.UI5ChartHelper.getModel();
	},
	/**
	 * @method drawSelectionOnMainChart
	 * @param
	 * @description Draws the selection on main chart when chart is loaded
	 */
	drawSelectionOnMainChart : function() {
		var aSelections = this.UI5ChartHelper.getSelectionFromFilter(this.filter);
		if (aSelections.length > 0) {
			this.disableSelectEvent = true;
			this.setSelectionOnMainChart(aSelections);
		}
	},
	/**
	 * @method drawSelectionOnThumbnailChart
	 * @param
	 * @description Draws the selection on the thumbnail chart  when chart is loaded
	 */
	drawSelectionOnThumbnailChart : function() {
		var aSelections = this.UI5ChartHelper.getSelectionFromFilter(this.filter);
		if (aSelections.length > 0) {
			this.clearSelectionFromThumbnailChart();
			this.setSelectionOnThumbnailChart(aSelections);
		}
	},
	/**
	 * @method handleSelection
	 * @param event
	 * @description  plots the selections made on the chart
	 */
	handleSelection : function(evt) {
		if (!this.disableSelectEvent) {
			var aSelection = this.getSelectionFromChart();
			var ctxArray = this.UI5ChartHelper.getHighlightPointsFromSelectionEvent(aSelection);
			this.setSelectionOnThumbnailChart(ctxArray);
			this.setSelectionOnMainChart(ctxArray);
			this.bDataHasBeenSelected = true;
			this.oApi.selectionChanged();
		} else {
			this.disableSelectEvent = false;
		}
	},
	/**
	 * @method handleDeselection
	 * @param event
	 * @description  de-selects the selected datapoints on the chart
	 */
	handleDeselection : function(evt) {
		if (!this.disableSelectEvent) {
			this.disableSelectEvent = true;
			var aSelection = this.getSelectionFromChart();
			var newSelection = this.UI5ChartHelper.getHighlightPointsFromDeselectionEvent(aSelection);
			this.removeAllSelection();
			this.setSelectionOnThumbnailChart(newSelection);
			this.setSelectionOnMainChart(newSelection);
			if (!newSelection.length) {
				this.disableSelectEvent = false;
			}
			this.bDataHasBeenSelected = true;
			this.oApi.selectionChanged();
		} else {
			this.disableSelectEvent = false;
		}
	},
	/**
	 * @method getSelections
	 * @description This method helps in determining the selection count, text and id of selected data of a representation
	 * @returns the filter selections of the current representation.
	 */
	getSelections : function() {
		return this.UI5ChartHelper.getFilters();
	},
	/**
	 * @deprecated since version 1.27.0 and using getSelections API instead
	 * @method getSelectionCount
	 * @description This method helps in determining the selection count of a representation
	 * @returns the selection count of the current representation.
	 */
	getSelectionCount : function() {
		return this.UI5ChartHelper.getFilterCount();
	},
	/**
	 * @method hasSelection
	 * @description This method helps in determining the selections of a representation
	 * @returns true if the representation holds any selections.
	 */
	hasSelection : function() {
		return this.bDataHasBeenSelected;
	},
	/**
	 * @method removeAllSelection
	 * @description removes all Selection from Chart
	 */
	removeAllSelection : function() {
		this.clearSelectionFromThumbnailChart();
		this.clearSelectionFromMainChart();
	},
	/**
	 * @method getFilterMethodType
	 * @description This method helps in determining which method has to be used for the filter retrieval from a representation.
	 * @returns {sap.apf.constants.filterMethodTypes} The filter method type the representation supports
	 */
	getFilterMethodType : function() {
		return sap.apf.core.constants.filterMethodTypes.filter; // returns the filter method type the representation supports
	},
	getFilter : function() {
		this.filter = this.UI5ChartHelper.getFilterFromSelection();
		return this.filter;
	},
	/**
	 * @method setFilter
	 * @param {sap.apf.utils.Filter} oFilter
	 * @description sets the initial filter to the representation. The filter holds the values of the start filter of the path.
	 */
	setFilter : function(oFilter) {
		this.filter = oFilter;
		this.bDataHasBeenSelected = false;
	},
	/**
	 * @method adoptSelection
	 * @param {object} oSourceRepresentation Source representation implementing the representationInterface.
	 * @description Called on representation by binding when a representation type is set.
	 */
	adoptSelection : function(oSourceRepresentation) {
		if (oSourceRepresentation && oSourceRepresentation.getFilter) {
			this.UI5ChartHelper.filterValues = oSourceRepresentation.getFilter().getInternalFilter().getFilterTerms().map(function(term) {
				return [ term.getValue() ];
			});
		}
	},
	/**
	 * @method serialize
	 * @description Getter for Serialized data for a representation
	 * @returns selectionObject
	 */
	serialize : function() {
		return {
			oFilter : this.UI5ChartHelper.filterValues,
			bIsAlternateView : this.bIsAlternateView
		};
	},
	/**
	 * @method deserialize
	 * @description This method uses selection object from serialized data and sets the selection to representation
	 */
	deserialize : function(oSerializable) {
		this.UI5ChartHelper.filterValues = oSerializable.oFilter;
		this.bIsAlternateView = oSerializable.bIsAlternateView;
	},
	/**
	 * @method getPrintContent
	 * @param oStepTitle title of the step
	 * @description gets the printable content of the representation
	 */
	getPrintContent : function(oStepTitle) {
		var oChart;
		oChart = this.getMainContent(oStepTitle, 1000, 600);
		return oChart;
	}
};
}; // end of sap/apf/ui/representations/BaseUI5ChartRepresentation.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.BaseVizChartRepresentation') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.BaseVizChartRepresentation");


sap.apf.ui.representations.BaseVizChartRepresentation = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseUI5ChartRepresentation.apply(this, [ oApi, oParameters ]);
};
sap.apf.ui.representations.BaseVizChartRepresentation.prototype = Object.create(sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype);
//Set the "constructor" property to refer to BaseUI5ChartRepresentation
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.constructor = sap.apf.ui.representations.BaseVizChartRepresentation;
/**
 * @method getMeasures
 * @return the measures for a chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getMeasures = function() {
	return this.measure;
};
/**
 * @method getMainContent
 * @param oStepTitle title of the main chart
 * @param width width of the main chart
 * @param height height of the main chart
 * @description draws Main chart into the Chart area
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getMainContent = function(oStepTitle, width, height) {
	var self = this;
	var superClass = this;
	var chartHeight = height || 600;
	chartHeight = chartHeight + "px";
	var chartWidth = width || 1000;
	chartWidth = chartWidth + "px";
	this.title = oStepTitle;
	this.createDataset();
	this.chartParam = {
		width : chartWidth,
		height : chartHeight,
		title : {
			visible : true,
			text : this.title
		},
		xAxis : {
			title : {
				visible : true
			},
			label : {
				visible : this.showXaxisLabel
			}
		},
		yAxis : {
			title : {
				visible : true
			}
		},
		legend : {
			visible : this.legendBoolean,
			title : {
				visible : this.legendBoolean
			}
		},
		plotArea : {
			animation : {
				dataLoading : false,
				dataUpdating : false
			}
		},
		dataset : this.dataset
	};
	if (!this.chartType) { // for charts which are coming from application
		this.chartType = this.getChartTypeFromRepresentationType(this.type); // set the value for chart type for thumbnail and main chart
	}
	this.chart = new sap.viz.ui5[this.chartType](this.chartParam);
	this.validateSelectionModes();
	this.chart.setModel(this.oModel);
	if (this.metadata) { //if metadata is available, do the formatting for measures
		var oFormatString = {}, tooltipFormatString = [];
		this.measure.forEach(function(measure) {
			var sFormatString = superClass.getFormatStringForMeasure(measure); // get the format string for each measure
			tooltipFormatString.push([ sFormatString ]); // tooltip expects a two dimensional array for format string
			self.setFormatStringOnChart(sFormatString);
		});
		this.setFormatString("tooltip", tooltipFormatString); // apply the formatting for tooltip , with the array of format strings for multiple measures
		if (this.handleCustomFormattingOnChart) { //call the sub class formatting 
			this.handleCustomFormattingOnChart();
		}
	}
	/**
	 * @method attachInitialized
	 * @param event which is triggered on when the chart is initialized
	 * @description Draws the selection
	 */
	this.chart.attachInitialized(function() {
		self.drawSelectionOnMainChart();
	});
	superClass.attachSelectionAndFormatValue.call(this, oStepTitle); // call the base class attachSelectionAndFormatValue
	return this.chart;
};
/**
 * @method validateSelectionModes
 * @description sets the different selection modes on the charts based on the required filter
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.validateSelectionModes = function() {
	var sel = new sap.viz.ui5.types.controller.Interaction_selectability();
	var inter = new sap.viz.ui5.types.controller.Interaction();
	inter.setSelectability(sel);
	this.chart.setInteraction(inter);
	if (this.parameter.requiredFilters === undefined || this.parameter.requiredFilters.length === 0) {
		sel.setMode("none");
	} else {
		sel.setMode("multiple");
		if (this.parameter.dimensions.length > 1) {
			if (this.parameter.requiredFilters[0] === this.parameter.dimensions[1].fieldName) {
				sel.setAxisLabelSelection(false);
			} else if (this.parameter.requiredFilters[0] === this.parameter.dimensions[0].fieldName) {
				sel.setLegendSelection(false);
			}
		}
	}
};
/**
 *@method getThumbnailContent
 *@description draws Thumbnail for the current chart type and returns to the calling object
 *@returns thumbnail object for the chart type
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getThumbnailContent = function() {
	var self = this;
	var superClass = this;
	var height = sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.HEIGHT;
	var width = sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.WIDTH;
	this.createDataset();
	this.thumbnailChartParam = {
		width : width,
		height : height,
		title : {
			visible : false
		},
		xAxis : {
			visible : false,
			title : {
				visible : false
			}
		},
		yAxis : {
			visible : false,
			title : {
				visible : false
			}
		},
		legend : {
			visible : false,
			title : {
				visible : false
			}
		},
		sizeLegend : {
			visible : false,
			title : {
				visible : false
			}
		},
		toolTip : {
			visible : false
		},
		interaction : {
			selectability : {
				axisLabelSelection : false,
				legendSelection : false,
				plotLassoSelection : false,
				plotStdSelection : false
			},
			enableHover : false
		},
		background : {
			visible : false
		},
		general : {
			layout : {
				padding : 0
			}
		},
		plotArea : {
			animation : {
				dataLoading : false,
				dataUpdating : false
			},
			markerSize : 4,
			marker : {
				visible : true,
				size : 4
			}
		},
		dataset : this.dataset
	};
	if (!this.chartType) { // for charts which are coming from application
		this.chartType = this.getChartTypeFromRepresentationType(this.type); // set the value for chart type for thumbnail and main chart
	}
	this.thumbnailChart = new sap.viz.ui5[this.chartType](this.thumbnailChartParam);
	this.thumbnailChart.attachInitialized(function() {
		self.drawSelectionOnThumbnailChart();
	});
	superClass.createThumbnailLayout.call(this);// call the base class createThumbnailLayout
	return this.thumbnailLayout;
};
/**
 * @method setSelectionOnMainChart
 * @param array of selected objects
 * @description sets the Selection on main Chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.setSelectionOnMainChart = function(aSelection) {
	this.chart.selection(aSelection);
};
/**
 * @method setSelectionOnThumbnailChart
 * @param array of selected objects
 * @description sets the Selection on thumbnail Chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.setSelectionOnThumbnailChart = function(aSelection) {
	this.clearSelectionFromThumbnailChart();
	this.thumbnailChart.selection(aSelection);
};
/**
 * @method clearSelectionFromMainChart
 * @description clears all Selection from main Chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.clearSelectionFromMainChart = function() {
	this.chart.selection([], {
		clearSelection : true
	});
};
/**
 * @method clearSelectionFromThumbnailChart
 * @description clears all Selection from thumbnail Chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.clearSelectionFromThumbnailChart = function() {
	this.thumbnailChart.selection([], {
		clearSelection : true
	});
};
/**
 * @method getSelectionFromChart
 * @description gets the selected datapoints on the chart
 * @return the array of selections from the chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getSelectionFromChart = function() {
	var aSelection = this.chart.selection();
	return aSelection;
};
/**
 * @method setFormatStringOnChart
 * @param sFormatString - format string
 * @description sets the format string for axis label and tooltip
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.setFormatStringOnChart = function(sFormatString) {
	var superClass = this;
	var bAllMeasuresSameUnit = superClass.getIsAllMeasureSameUnit();
	if (this.chart.getYAxis !== undefined && sFormatString !== "" && bAllMeasuresSameUnit) { // all measures has the unit with same semantics 
		this.setFormatString("yAxis", sFormatString);
	}
};
/**
 * @method setFormatString
 * @param formatString , the format string which has to be set for yAxis, xAxis or tooltip 
 * @param sChartPropertyName , chart property on which property has to be applied (e.g. xAxis, yAxis, tooltip)
 * @description sets the format string for axis label and tooltip
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.setFormatString = function(sChartPropertyName, sFormatString) {
	var oChartProperty;
	switch (sChartPropertyName) {
		case "xAxis":
			oChartProperty = this.chart.getYAxis().getLabel();
			break;
		case "yAxis":
			oChartProperty = this.chart.getXAxis().getLabel();
			break;
		case "tooltip":
			oChartProperty = this.chart.getToolTip();
			break;
		case "sizeLegend":
			oChartProperty = this.chart.getSizeLegend().getLabel();
	}
	oChartProperty.setFormatString(sFormatString);
};
/**
 * @method getFormatString
 * @param [measures] , the array of measures
 * @description gets the format string information for all the measures
 * @return oFormatStringInfo.labelFormatString- formatString for labels
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getFormatString = function(aMeasure) {
	var oFormatStringInfo = this.getFormatStringForMeasures(aMeasure);
	return oFormatStringInfo.labelFormatString;
};
/**
 * @method getChartTypeFromRepresentationType
 * @param sRepresentationType- APF representation type which is set in the charts
 * @description maps the APF representationtypes to the viz chart types
 * @return sVizChartType- viz chart type needed by the constructor of viz charts for a given APF representation type
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getChartTypeFromRepresentationType = function(sRepresentationType) {
	var aRepresentationTypes = sap.apf.ui.utils.CONSTANTS.representationTypes;
	var aVizChartTypes = sap.apf.ui.utils.CONSTANTS.vizChartTypes;
	var sVizChartType;
	switch (sRepresentationType) {
		case aRepresentationTypes.COLUMN_CHART:
			sVizChartType = aVizChartTypes.COLUMN;
			break;
		case aRepresentationTypes.LINE_CHART:
			sVizChartType = aVizChartTypes.LINE;
			break;
		case aRepresentationTypes.PIE_CHART:
			sVizChartType = aVizChartTypes.PIE;
			break;
		case aRepresentationTypes.STACKED_COLUMN_CHART:
			sVizChartType = aVizChartTypes.STACKED_COLUMN;
			break;
		case aRepresentationTypes.PERCENTAGE_STACKED_COLUMN_CHART:
			sVizChartType = aVizChartTypes.PERCENTAGE_STACKED_COLUMN;
			break;
		case aRepresentationTypes.SCATTERPLOT_CHART:
			sVizChartType = aVizChartTypes.SCATTERPLOT;
			break;
		case aRepresentationTypes.BUBBLE_CHART:
			sVizChartType = aVizChartTypes.BUBBLE;
			break;
		default:
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6000",
				aParameters : [ sRepresentationType ]
			});
			this.oApi.putMessage(this.oMessageObject);
			break;
	}
	return sVizChartType;
};
/**
 * @method getIsGroupTypeChart
 * @return a boolean to indicate if the chart is of type "group", e.g. scatter,bubble
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getIsGroupTypeChart = function() {
	var bIsGroupTypeChart;
	if (this.axisType === sap.apf.ui.utils.CONSTANTS.axisTypes.AXIS) {
		bIsGroupTypeChart = false;
	} else {
		bIsGroupTypeChart = true;
	}
	return bIsGroupTypeChart;
};
/**
 * @method getDataSetHelper
 * @description a boolean to indicate if the chart is of type "group", e.g. scatter,bubble
 * @return the data set helper for vic chart
 */
sap.apf.ui.representations.BaseVizChartRepresentation.prototype.getDataSetHelper = function() {
	var bIsGroupTypeChart = this.getIsGroupTypeChart();
	var oDataSetHelper = new sap.apf.ui.representations.utils.VizDatasetHelper(bIsGroupTypeChart);
	return oDataSetHelper;
};
}; // end of sap/apf/ui/representations/BaseVizChartRepresentation.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.BaseVizFrameChartRepresentation') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.BaseVizFrameChartRepresentation");



sap.apf.ui.representations.BaseVizFrameChartRepresentation = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseUI5ChartRepresentation.apply(this, [ oApi, oParameters ]);
};
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype = Object.create(sap.apf.ui.representations.BaseUI5ChartRepresentation.prototype);
//Set the "constructor" property to refer to BaseUI5ChartRepresentation
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.constructor = sap.apf.ui.representations.BaseVizFrameChartRepresentation;
/**
 * @method getMeasures
 * @return the measures for a chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getMeasures = function() {
	return this.measure;
};
/**
 * @method getMainContent
 * @param oStepTitle title of the main chart
 * @param width width of the main chart
 * @param height height of the main chart
 * @description draws Main chart into the Chart area
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getMainContent = function(oStepTitle, width, height) {
	var self = this;
	var superClass = this;
	var chartHeight = height || 600;
	chartHeight = chartHeight + "px";
	var chartWidth = width || 1000;
	chartWidth = chartWidth + "px";
	this.title = oStepTitle;
	this.createDataset();
	//vizFrame chart type
	if (!this.chartType) { // for charts which are coming from application
		this.chartType = this.getChartTypeFromRepresentationType(this.type); // set the value for chart type for thumbnail and main chart
	}
	// vizFrame chart constructor
	this.chart = new sap.viz.ui5.controls.VizFrame({
		vizType : this.chartType,
		dataset : this.dataset,
		width : chartWidth,
		height : chartHeight,
		uiConfig : {
			applicationSet : "fiori"
		}
	});
	this.chart.setVizProperties({
		title : {
			visible : true,
			text : this.title
		},
		categoryAxis : {
			title : {
				visible : true
			},
			label : {
				visible : true
			}
		},
		valueAxis : {
			title : {
				visible : true
			},
			label : {
				visible : true
			}
		},
		legend : {
			visible : this.legendBoolean,
			title : {
				visible : this.legendBoolean
			},
			isScrollable : true
		},
		sizeLegend : {
			visible : true
		},
		valueAxis2 : {
			visible : true,
			title : {
				visible : true
			},
			label : {
				visible : true
			}
		},
		plotArea : {
			animation : {
				dataLoading : false,
				dataUpdating : false
			},
			isFixedDataPointSize : false
		},
		tooltip : {
			visible : true,
			label : {
				visible : true
			}
		},
		interaction : {
			behaviorType : null
		}
	});
	this.validateSelectionModes();
	/**
	* @method attachRenderComplete
	* @param event which is triggered on when the chart is initialized
	* @description Draws the selection
	*/
	this.chart.attachRenderComplete(function() {
		self.drawSelectionOnMainChart();
	});
	this.chart.setModel(this.oModel);
	if (this.metadata) { //if metadata is available, do the formatting for measures
		var oMeasureWithFormatString = {}, aMeasureWithFormatString = [];
		var sFormatStringForTooltip;
		this.measure.forEach(function(measure) {
			var sFormatString = superClass.getFormatStringForMeasure(measure); // get the format string for each measure
			sFormatStringForTooltip = sFormatString; //assign one format string for tooltip
			oMeasureWithFormatString.measure = measure;
			oMeasureWithFormatString.formatString = sFormatString; // associate the format string with each measure
			self.setFormatStringOnChart(oMeasureWithFormatString);
		});
		this.setFormatString("tooltip", sFormatStringForTooltip); //tooltip is not a feedItem Id, formatting has to be applied explicitly
		if (this.handleCustomFormattingOnChart) { //call the sub class formatting 
			this.handleCustomFormattingOnChart();
		}
	}
	this._createAndAddFeedItemBasedOnId(this.chart);
	superClass.attachSelectionAndFormatValue.call(this, oStepTitle); // call the base class attachSelectionAndFormatValue
	return this.chart;
};
/**
* @method setFormatStringOnChart
* @param {oMeasureFormatString}- 
*              oMeasureFormatString : {
*              measure : measure1,
*              formatString : formatString
              }
* @description reads the boolean to indicate if all the measures have same unit semantic
* and based on the axisFeedItemId from measures applies the formatting to the xAxis,yAxis,tooltip or sizeLegend
*/
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setFormatStringOnChart = function(oMeasureFormatString) {
	var sFormatString = oMeasureFormatString.formatString;
	var sChartPropertyName = oMeasureFormatString.measure.axisfeedItemId;
	this.setFormatString(sChartPropertyName, sFormatString); //based on the feedItem Id , set the format string on the chart
};
/**
 * @method setFormatString
 * @param sChartPropertyName ,chart property on which property has to be applied (e.g. xAxis, yAxis, tooltip) 
 * @param sFormatString , the format string which has to be set for yAxis, xAxis or tooltip 
 * @description sets the format string for axis label and tooltip
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setFormatString = function(sChartPropertyName, formatString) {
	var superClass = this;
	var bIsAllMeasureSameUnit = superClass.getIsAllMeasureSameUnit();
	switch (sChartPropertyName) {
		case sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS:
			if (bIsAllMeasureSameUnit) { //apply the formatting only when all the measures have same unit semantic
				this.chart.setVizProperties({
					valueAxis : {
						label : {
							formatString : formatString
						}
					}
				});
			}
			break;
		case sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS2:
			if (bIsAllMeasureSameUnit) { //apply the formatting only when all the measures have same unit semantic
				this.chart.setVizProperties({
					valueAxis2 : {
						label : {
							formatString : formatString
						}
					}
				});
			}
			break;
		case sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS:
			this.chart.setVizProperties({
				categoryAxis : {
					label : {
						formatString : formatString
					}
				}
			});
			break;
		case sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEWIDTH:
			this.chart.setVizProperties({
				sizeLegend : {
					formatString : formatString
				}
			});
			break;
		case "tooltip":
			this.chart.setVizProperties({
				tooltip : {//takes one value unlike viz, in case of multiple measures which value should it be?
					formatString : formatString
				}
			});
			break;
	}
};
/**
* @private
* @function
* @method _createAndAddFeedItemBasedOnId
* @param {oChart}- instance of the chart
* @description creates and adds the feedItem for dimensions/measures of a chart	
*/
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._createAndAddFeedItemBasedOnId = function(oChart) {
	var oFlattendeDataSet = this.UI5ChartHelper.datasetObj;
	var sameFeedItemMeasureGroup = this._createFeedItemGroup(oFlattendeDataSet.measures); // create feedItem for all the measures
	this._addFeedItemsToChart(oChart, sameFeedItemMeasureGroup, "Measure"); // add measure feedItem to the chart	
	var sameFeedItemDimensionGroup = this._createFeedItemGroup(oFlattendeDataSet.dimensions); // create feedItem for all the dimensions
	this._addFeedItemsToChart(oChart, sameFeedItemDimensionGroup, "Dimension"); // add dimension feedItem to the chart
};
/**
* @private
* @function
* @method _createFeedItemGroup
* @param {aDataToBeGrouped}- dimensions/measures for a chart, which have to be grouped based on the feedItem id assigned
* @description reads the feedItem id from each dimension/measure
*         
*          e.g. dimensions = [{
*				name : dimension.name,
*				value : '{' + dimension.value + '}',
*				axisfeedItemId : "categoryAxis"
*			}];
*
*and groups the dimensions/measures based on the axisfeedItemId , 
*@return sameFeedItemGroup - associative array for all the feedItems available in the dimensions/measures
*
*          e.g. sameFeedItemGroup = {
*                                valueAxis : [{measure1},{measure2}],
*                                categoryAxis : {{dimension1},{dimension2}]
*                               }	
*/
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._createFeedItemGroup = function(aDataToBeGrouped) {
	var sameFeedItemGroup = {};
	aDataToBeGrouped.forEach(function(data) { // group all the dimensions/measures based on the feedItem id
		var feedItemList = sameFeedItemGroup[data.axisfeedItemId];
		if (feedItemList) { //if the group name exist for one feedItem id, push the data in that group
			var bFieldAlreadyExists = feedItemList.some(function(oData) {
				return oData.name === data.name;
			});
			if (!bFieldAlreadyExists) {
				feedItemList.push(data);
			}
		} else { //else create a new group name for the feedItem id and push the data into it
			sameFeedItemGroup[data.axisfeedItemId] = [ data ];
		}
	});
	return sameFeedItemGroup;
};
/**
* @private
* @function
* @name _addFeedItemsToChart
* @param {oChart}- instance of the chart
* @param {oGroupedData}- associative array which has all the dimensions and measures grouped based on the feedItem Id
* 
*     oGroupedData = {
*                     valueAxis : [{measure1},{measure2}],
*                     categoryAxis : {{dimension1},{dimension2}]
*                    }
*
*@param sFeedItemType- type of the feedItem (dimension/measure)
*
*@description creates an object which has the id and the values required for a feedItem
*           oFeedItem = {
*                         feedItemId : "categoryAxis" or "valueAxis" etc
*                         value : [value1,value2]
*                       }
* 
*creates chart feedItem and adds it to the vizFrame charts
*/
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype._addFeedItemsToChart = function(oChart, oGroupedData, sFeedItemType) {
	for( var key in oGroupedData) { //loop through all the groups
		var oFeedItem = {};
		var aFeedItemValue = [];
		for( var i = 0 in oGroupedData[key]) { //loop through all the measures/dimensions of one group
			aFeedItemValue.push(oGroupedData[key][i].name); //push all the measure/dimension name which has same feedIem id to an array
			oFeedItem.feedItemId = oGroupedData[key][0].axisfeedItemId; //assign one id to each feedItem object (all the id will be same in one group) 
		}
		oFeedItem.value = aFeedItemValue; //assign the values to each feedItem object
		var chartFeedItem = new sap.viz.ui5.controls.common.feeds.FeedItem({
			uid : oFeedItem.feedItemId,
			type : sFeedItemType,
			values : oFeedItem.value
		});
		oChart.addFeed(chartFeedItem);
	}
};
/**
 * @method validateSelectionModes
 * @description sets the different selection modes on the charts based on the required filter
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.validateSelectionModes = function() {
	if (this.parameter.requiredFilters === undefined || this.parameter.requiredFilters.length === 0) {
		this.chart.setVizProperties({
			interaction : {
				selectability : {
					mode : 'none'
				},
				behaviorType : null
			}
		});
	} else {
		this.chart.setVizProperties({
			interaction : {
				selectability : {
					mode : 'multiple'
				},
				behaviorType : null
			}
		});
		if (this.parameter.dimensions.length > 1) {
			if (this.parameter.requiredFilters[0] === this.parameter.dimensions[1].fieldName) {
				this.chart.setVizProperties({
					interaction : {
						selectability : {
							axisLabelSelection : false
						}
					}
				});
			} else if (this.parameter.requiredFilters[0] === this.parameter.dimensions[0].fieldName) {
				this.chart.setVizProperties({
					interaction : {
						selectability : {
							legendSelection : false
						}
					}
				});
			}
		}
	}
};
/**
 *@method getThumbnailContent
 *@description draws Thumbnail for the current chart type and returns to the calling object
 *@returns thumbnail object for the chart type
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getThumbnailContent = function() {
	var self = this;
	var superClass = this;
	var height = sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.HEIGHT;
	var width = sap.apf.ui.utils.CONSTANTS.thumbnailDimensions.WIDTH;
	this.createDataset();
	//vizFrame chart type
	if (!this.chartType) { // for charts which are coming from application
		this.chartType = this.getChartTypeFromRepresentationType(this.type); // set the value for chart type for thumbnail and main chart
	}
	this.thumbnailChart = new sap.viz.ui5.controls.VizFrame({
		vizType : this.chartType,
		width : width,
		height : height,
		dataset : this.dataset
	});
	this.thumbnailChart.setVizProperties({
		title : {
			visible : false
		},
		categoryAxis : {
			visible : false,
			title : {
				visible : false
			}
		},
		valueAxis : {
			visible : false,
			title : {
				visible : false
			}
		},
		valueAxis2 : {
			visible : false,
			title : {
				visible : false
			}
		},
		legend : {
			visible : false,
			title : {
				visible : false
			}
		},
		sizeLegend : {
			visible : false
		},
		tooltip : {
			visible : false
		},
		interaction : {
			selectability : {
				axisLabelSelection : false,
				legendSelection : false,
				plotLassoSelection : false,
				plotStdSelection : false
			},
			enableHover : false
		},
		background : {
			visible : false
		},
		general : {
			layout : {
				padding : 0
			}
		},
		plotArea : {
			markerSize : 4,
			marker : {
				visible : true,
				size : 4
			},
			animation : {
				dataLoading : false,
				dataUpdating : false
			},
			gridline : {
				visible : false
			},
			dataLabel : {
				visible : false
			},
			lineStyle : {
				rules : [ {
					properties : {
						width : 1
					}
				} ]
			}
		}
	});
	this.thumbnailChart.attachRenderComplete(function() {
		self.drawSelectionOnThumbnailChart();
	});
	this._createAndAddFeedItemBasedOnId(this.thumbnailChart);
	superClass.createThumbnailLayout.call(this);// call the base class createThumbnailLayout
	return this.thumbnailLayout;
};
/**
 * @method setSelectionOnMainChart
 * @param array of selected objects
 * @description sets the Selection on main Chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setSelectionOnMainChart = function(aSelection) {
	this.chart.vizSelection(aSelection);
};
/**
 * @method setSelectionOnThumbnailChart
 * @param array of selected objects
 * @description sets the Selection on thumbnail Chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.setSelectionOnThumbnailChart = function(aSelection) {
	this.clearSelectionFromThumbnailChart();
	this.thumbnailChart.vizSelection(aSelection);
};
/**
 * @method clearSelectionFromMainChart
 * @description clears all Selection from main Chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.clearSelectionFromMainChart = function() {
	this.chart.vizSelection([], {
		clearSelection : true
	});
};
/**
 * @method clearSelectionFromThumbnailChart
 * @description clears all Selection from thumbnail Chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.clearSelectionFromThumbnailChart = function() {
	this.thumbnailChart.vizSelection([], {
		clearSelection : true
	});
};
/**
 * @method getSelectionFromChart
 * @description gets the selected datapoints on the chart
 * @return the array of selections from the chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getSelectionFromChart = function() {
	var aSelection = this.chart.vizSelection();
	return aSelection;
};
/**
 * @method getChartTypeFromRepresentationType
 * @param sRepresentationType- APF representation type which is set in the charts
 * @description maps the APF representationtypes to the vizFrame chart types
 * @return sVizFrameChartType- vizFrame chart type needed by the constructor of vizFrame charts for a given APF representation type
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getChartTypeFromRepresentationType = function(sRepresentationType) {
	var aRepresentationTypes = sap.apf.ui.utils.CONSTANTS.representationTypes;
	var vizFrameChartTypes = sap.apf.ui.utils.CONSTANTS.vizFrameChartTypes;
	var sVizFrameChartType;
	switch (sRepresentationType) {
		case aRepresentationTypes.COLUMN_CHART:
			sVizFrameChartType = vizFrameChartTypes.COLUMN;
			break;
		case aRepresentationTypes.LINE_CHART:
			sVizFrameChartType = vizFrameChartTypes.LINE;
			break;
		case aRepresentationTypes.PIE_CHART:
			sVizFrameChartType = vizFrameChartTypes.PIE;
			break;
		case aRepresentationTypes.STACKED_COLUMN_CHART:
			sVizFrameChartType = vizFrameChartTypes.STACKED_COLUMN;
			break;
		case aRepresentationTypes.PERCENTAGE_STACKED_COLUMN_CHART:
			sVizFrameChartType = vizFrameChartTypes.PERCENTAGE_STACKED_COLUMN;
			break;
		case aRepresentationTypes.SCATTERPLOT_CHART:
			sVizFrameChartType = vizFrameChartTypes.SCATTERPLOT;
			break;
		case aRepresentationTypes.BUBBLE_CHART:
			sVizFrameChartType = vizFrameChartTypes.BUBBLE;
			break;
		default:
			this.oMessageObject = this.oApi.createMessageObject({
				code : "6000",
				aParameters : [ sRepresentationType ]
			});
			this.oApi.putMessage(this.oMessageObject);
			break;
	}
	return sVizFrameChartType;
};
/**
 * @method getIsGroupTypeChart
 * @return a boolean to indicate if the chart is of type "group", e.g. scatter,bubble
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getIsGroupTypeChart = function() {
	return this.bIsGroupTypeChart ? this.bIsGroupTypeChart : false;
};
/**
 * @method getDataSetHelper
 * @description a boolean to indicate if the chart is of type "group", e.g. scatter,bubble
 * @return the data set helper for vic chart
 */
sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype.getDataSetHelper = function() {
	var bIsGroupTypeChart = this.getIsGroupTypeChart();
	var oDataSetHelper = new sap.apf.ui.representations.utils.vizFrameDatasetHelper(bIsGroupTypeChart);
	return oDataSetHelper;
};

}; // end of sap/apf/ui/representations/BaseVizFrameChartRepresentation.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.bubbleChart') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.bubbleChart");


/**
 * @class columnChart constructor.
 * @param oParametersdefines parameters required for chart such as Dimension/Measures,tooltip, axis information.
 * @returns chart object
 */
sap.apf.ui.representations.bubbleChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.BUBBLE_CHART;
	this.bIsGroupTypeChart = true;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.bubbleChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to bubbleChart
sap.apf.ui.representations.bubbleChart.prototype.constructor = sap.apf.ui.representations.bubbleChart;
/** 
 * @private
 * @method createDefaultFeedItemId
 * @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
 */
sap.apf.ui.representations.bubbleChart.prototype._createDefaultFeedItemId = function() {
	var self = this;
	this.parameter.measures.forEach(function(measure, index) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = index < 2 ? (index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS2) : (index === 2 ? sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEWIDTH : sap.apf.core.constants.vizFrame.feedItemTypes.BUBBLEHEIGTH);
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.COLOR : sap.apf.core.constants.vizFrame.feedItemTypes.SHAPE;
		}
	});
};
}; // end of sap/apf/ui/representations/bubbleChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.columnChart') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.columnChart");

/**
 * @class columnChart constructor.
 * @param oParametersdefines parameters required for chart such as Dimension/Measures,tooltip, axis information.
 * @returns chart object
 */
sap.apf.ui.representations.columnChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.COLUMN_CHART;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.columnChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to columnChart
sap.apf.ui.representations.columnChart.prototype.constructor = sap.apf.ui.representations.columnChart;
/** 
 * @private
 * @method _createDefaultFeedItemId
 * @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
 */
sap.apf.ui.representations.columnChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
		}
	});
};
}; // end of sap/apf/ui/representations/columnChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.lineChart') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.representations.lineChart");


/** 
 * @class lineChart constructor.
 * @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
 * @returns chart object 
 */
sap.apf.ui.representations.lineChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.LINE_CHART;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.lineChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to lineChart
sap.apf.ui.representations.lineChart.prototype.constructor = sap.apf.ui.representations.lineChart;
/** 
 * @method _createDefaultFeedItemId
 * @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
 */
sap.apf.ui.representations.lineChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
		}
	});
};
}; // end of sap/apf/ui/representations/lineChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.percentageStackedColumnChart') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

jQuery.sap.declare("sap.apf.ui.representations.percentageStackedColumnChart");
/**
 * @class stackColumn constructor.
 * @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
 * @returns chart object 
 */
sap.apf.ui.representations.percentageStackedColumnChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.PERCENTAGE_STACKED_COLUMN_CHART;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.percentageStackedColumnChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to percentageStackedColumnChart
sap.apf.ui.representations.percentageStackedColumnChart.prototype.constructor = sap.apf.ui.representations.percentageStackedColumnChart;
/** 
 * @private
 * @method _createDefaultFeedItemId
 * @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
 */
sap.apf.ui.representations.percentageStackedColumnChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
		}
	});
};
/**
 * @method handleCustomFormattingOnChart
 * @description sets the custom format string
 */
sap.apf.ui.representations.percentageStackedColumnChart.prototype.setFormatString = function() {
	//overriding the base class setFormatString, since percentage chart does not need the formatting for axis and tooltip
	return;
};
}; // end of sap/apf/ui/representations/percentageStackedColumnChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.pieChart') ) {
/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/


jQuery.sap.declare("sap.apf.ui.representations.pieChart");
/** 
 * @class pieChart constructor.
* @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
* @returns chart object 
 */
sap.apf.ui.representations.pieChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.PIE_CHART;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.pieChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to pieChart
sap.apf.ui.representations.pieChart.prototype.constructor = sap.apf.ui.representations.pieChart;
/**
* @private 
 * @method _createDefaultFeedItemId
* @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
*/
sap.apf.ui.representations.pieChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.SIZE;
		}
	});
	this.parameter.dimensions.forEach(function(dimension) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
		}
	});
};

}; // end of sap/apf/ui/representations/pieChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.scatterPlotChart') ) {
/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/


jQuery.sap.declare("sap.apf.ui.representations.scatterPlotChart");
/** 
 * @class scatterPlotChart constructor.
* @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
* @returns chart object 
 */
sap.apf.ui.representations.scatterPlotChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.SCATTERPLOT_CHART;
	this.bIsGroupTypeChart = true;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.scatterPlotChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to scatterPlotChart
sap.apf.ui.representations.scatterPlotChart.prototype.constructor = sap.apf.ui.representations.scatterPlotChart;
/** 
 * @method _createDefaultFeedItemId
* @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
*/
sap.apf.ui.representations.scatterPlotChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure, index) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS2;
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.COLOR : sap.apf.core.constants.vizFrame.feedItemTypes.SHAPE;
		}
	});
};

}; // end of sap/apf/ui/representations/scatterPlotChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.stackedColumnChart') ) {
/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/


jQuery.sap.declare("sap.apf.ui.representations.stackedColumnChart");
/** 
 * @class stackedColumnChart constructor.
* @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
* @returns chart object 
 */
sap.apf.ui.representations.stackedColumnChart = function(oApi, oParameters) {
	sap.apf.ui.representations.BaseVizFrameChartRepresentation.apply(this, [ oApi, oParameters ]);
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.STACKED_COLUMN_CHART;
	this._createDefaultFeedItemId();
};
sap.apf.ui.representations.stackedColumnChart.prototype = Object.create(sap.apf.ui.representations.BaseVizFrameChartRepresentation.prototype);
//Set the "constructor" property to refer to stackedColumnChart
sap.apf.ui.representations.stackedColumnChart.prototype.constructor = sap.apf.ui.representations.stackedColumnChart;
/** 
 * @private
* @method _createDefaultFeedItemId
* @description reads the oParameters for chart and modifies it by including a default feedItem id 
 * in case the "kind" property is not defined in dimension/measures
*/
sap.apf.ui.representations.stackedColumnChart.prototype._createDefaultFeedItemId = function() {
	this.parameter.measures.forEach(function(measure) {
		if (measure.kind === undefined) {//handle the scenario where the kind is not available
			measure.axisfeedItemId = sap.apf.core.constants.vizFrame.feedItemTypes.VALUEAXIS;
		}
	});
	this.parameter.dimensions.forEach(function(dimension, index) {
		if (dimension.kind === undefined) {//handle the scenario where the kind is not available
			dimension.axisfeedItemId = index === 0 ? sap.apf.core.constants.vizFrame.feedItemTypes.CATEGORYAXIS : sap.apf.core.constants.vizFrame.feedItemTypes.COLOR;
		}
	});
};

}; // end of sap/apf/ui/representations/stackedColumnChart.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.representations.table') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */

jQuery.sap.declare("sap.apf.ui.representations.table");
/** 
 * @class tableRepresentation constructor.
 * @param oParameters defines parameters required for chart such as Dimension/Measures, tooltip, axis information.
 * @returns table object 
 */
sap.apf.ui.representations.table = function(oApi, oParameters) {
	var self = this;
	this.parameter = oParameters;
	this.type = sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION;
	this.fields = oParameters.dimensions.concat(oParameters.measures);
	this.columns = {
		name : [],
		value : [],
		width : []
	};
	jQuery.sap.require({
		modName : "sap.ui.thirdparty.d3"
	});
	this.aDataResponse = [];
	this.alternateRepresentation = oParameters.defaultListConfigurationTypeID;
	this.filter = oApi.createFilter();
	var skip = 0;
	var top = 100;
	var sortedColumn;
	var sortProperty;
	var sortOrderIsDescending;
	var triggerBool = false;
	var eventsFired = 0;
	var skipAction = 0;
	var respData = [];
	this.printMode = false;
	this.oModel = new sap.ui.model.json.JSONModel();
	this.oModel.setSizeLimit(10000);
	this.isAlternateRepresentation = oParameters.isAlternateRepresentation;
	/**
	 * @method getParameter
	 * @description returns the constructor arguments which will be used to create toggle representation.
	 */
	this.getParameter = function() {
		return this.parameter;
	};
	/**
	 * @method setData
	 * @param aDataResponse  Response from oData service
	 * @param metadata Metadata of the oData service
	 * @description Public API which Fetches the data from oData service and updates the selection if present 
	 */
	this.setData = function(aDataResponse, metadata) {
		if (skipAction === 0) {
			if (triggerBool) {
				aDataResponse.map(function(obj) {
					self.aDataResponse.push(obj);
				});
				skipAction++;
			} else {
				skip = 0;
				//top = 100;
				self.aDataResponse = [];
				aDataResponse.map(function(obj) {
					self.aDataResponse.push(obj);
				});
			}
		}
		respData = aDataResponse; // To check whether record exists or not		
		this.metadata = metadata;
		triggerBool = false;
		this.formatter = new sap.apf.ui.representations.utils.formatter(oApi, metadata, aDataResponse);
	};
	/**
	 * @method getAlternateRepresentation
	 * @description returns the alternate representation of current step (i.e. list representation for the charts)  
	 */
	this.getAlternateRepresentation = function() {
		return this.alternateRepresentation;
	};
	/**
	 * @description returns meta data for representation type
	 */
	this.getMetaData = function() {
		return this.metadata;
	};
	/**
	 * @description returns data for representation type
	 */
	this.getData = function() {
		return this.aDataResponse;
	};
	/**
	 * @method  getRequestOptions 
	 **/
	this.getRequestOptions = function() {
		if (!triggerBool) {
			top = 100;
			skip = 0;
			skipAction = 0;
		}
		var requestObj = {
			paging : {
				top : top,
				skip : skip,
				inlineCount : true
			}
		};
		var orderByArray;
		if (sortProperty !== undefined) {
			orderByArray = [ {
				property : sortProperty,
				descending : sortOrderIsDescending
			} ];
			requestObj.orderby = orderByArray;
		} else {
			if (this.getParameter().orderby && this.getParameter().orderby.length) {
				var aOrderbyProps = this.getParameter().orderby.map(function(oOrderby) {
					return {
						property : oOrderby.property,
						descending : !oOrderby.ascending
					};
				});
				requestObj.orderby = aOrderbyProps;
			}
		}
		return requestObj;
	};
	this.createDataset = function() {
		if (self.getData().length !== 0) {
			for( var i = 0; i < self.fields.length; i++) {
				self.columns.value[i] = self.fields[i].fieldName;
				var name = "";
				var sUnitValue = "";
				if (self.getMetaData() !== undefined && self.getMetaData().getPropertyMetadata(self.fields[i].fieldName).unit !== undefined) {
					var sUnitReference = self.getMetaData().getPropertyMetadata(self.fields[i].fieldName).unit;
					sUnitValue = self.getData()[0][sUnitReference];// take value of unit from first data set.
					name = self.fields[i].fieldDesc === undefined || !oApi.getTextNotHtmlEncoded(self.fields[i].fieldDesc).length ? self.getMetaData().getPropertyMetadata(self.fields[i].fieldName).label + " (" + sUnitValue + ")" : oApi.getTextNotHtmlEncoded(self.fields[i].fieldDesc) + " (" + sUnitValue + ")";
					self.columns.name[i] = name;
				} else
					self.columns.name[i] = this.fields[i].fieldDesc === undefined || !oApi.getTextNotHtmlEncoded(self.fields[i].fieldDesc).length ? self.getMetaData().getPropertyMetadata(self.fields[i].fieldName).label : oApi.getTextNotHtmlEncoded(self.fields[i].fieldDesc);
				if (self.parameter.width !== undefined) {
					self.columns.width[i] = self.parameter.width[self.columns.value[i]];
				}
			}
		}
	};
	this.drawSelection = function(e) {
		var sRequiredFilterProperty = self.getFilter().getInternalFilter().getProperties()[0], aFilterTerms = self.getFilter().getInternalFilter().getFilterTermsForProperty(sRequiredFilterProperty), aFilterValues = aFilterTerms.map(function(term) {
			return term.getValue();
		}), aListItems = this.getItems(), aSelectedListItems = aListItems.filter(function(item) {
			var reqFilterValue = item.getBindingContext().getProperty(sRequiredFilterProperty);
			return aFilterValues.indexOf(reqFilterValue) !== -1;
		});
		aSelectedListItems.forEach(function(item) {
			item.addStyleClass('sapMLIBSelected');
		});
	};
	/**
	 * @method getMainContent
	 * @param oStepTitle title of the main chart
	 * @param width width of the main chart
	 * @param height height of the main chart
	 * @description draws Main chart into the Chart area
	 */
	this.getMainContent = function(oStepTitle, height, width) {
		self.createDataset();
		var oMessageObject;
		if (!oStepTitle) {
			oMessageObject = oApi.createMessageObject({
				code : "6002",
				aParameters : [ "title", oApi.getTextNotHtmlEncoded("step") ]
			});
			oApi.putMessage(oMessageObject);
		}
		if (this.fields.length === 0) {
			oMessageObject = oApi.createMessageObject({
				code : "6002",
				aParameters : [ "dimensions", oStepTitle ]
			});
			oApi.putMessage(oMessageObject);
		}
		if (!this.aDataResponse || this.aDataResponse.length === 0) {
			oMessageObject = oApi.createMessageObject({
				code : "6000",
				aParameters : [ oStepTitle ]
			});
			oApi.putMessage(oMessageObject);
		}
		//var id = sap.apf.ui.getStepContainer().vLayout.sId;
		var chartHeight = height || 600;// jQuery('#' + id + '').height();
		chartHeight = chartHeight + "px";
		var chartWidth = width || 1000;// jQuery('#' + id + '').width();
		chartWidth = chartWidth + "px";
		self.title = oStepTitle;
		var obj = self.aDataResponse;
		self.oModel.setData({
			tableData : obj
		});
		var columnCells = [];
		var i;
		for(i = 0; i < self.columns.name.length; i++) {
			self.cellValues = new sap.m.Text().bindText(self.columns.value[i], function(index) {
				return function(columnValue) {
					if (self.metadata === undefined) {
						return columnValue;
					} else {
						var formatedColumnValue = self.formatter.getFormattedValue(self.columns.value[index], columnValue);
						if (formatedColumnValue !== undefined) {
							return formatedColumnValue;
						} else {
							return columnValue;
						}
					}
				};
			}(i), sap.ui.model.BindingMode.OneWay);
			columnCells.push(self.cellValues);
		}
		//Setting column widths for table with headers and without headers
		var columnsWithHeaders = [];
		var columnsWithoutHeaders = [];
		var bWidthExists;
		var pixelScale;
		var columnWidth;
		var columnNameWidth;
		for(i = 0; i < self.columns.name.length; i++) {
			bWidthExists = false;
			if (self.columns.width !== undefined && self.columns.width instanceof Array && self.columns.width.length !== 0)
				bWidthExists = true;
			pixelScale = d3.scale.linear().domain([ 0, 8 ]).range([ 0, 72 ]);
			columnWidth = bWidthExists ? self.columns.width[i] : (pixelScale(self.columns.name[i].length)) + "px";
			self.columnName = new sap.m.Column({
				width : columnWidth,
				header : new sap.m.Text({
					text : self.columns.name[i]
				})
			});
			columnsWithHeaders.push(self.columnName);
			self.columnName1 = new sap.m.Column({
				width : columnWidth
			});
			columnsWithoutHeaders.push(self.columnName1);
		}
		//Table with Headers
		var oTableWithHeaders = new sap.m.Table({
			headerText : self.title,
			showNoData : false,
			columns : columnsWithHeaders
		}).addStyleClass("tableWithHeaders");
		//Table without Headers (built to get scroll only on the data part)
		this.oTableWithoutHeaders = new sap.m.Table({
			columns : columnsWithoutHeaders,
			items : {
				path : "/tableData",
				template : new sap.m.ColumnListItem({
					cells : columnCells
				})
			}
		});
		oTableWithHeaders.setModel(self.oModel);
		this.oTableWithoutHeaders.setModel(self.oModel);
		this.oTableWithoutHeaders.attachUpdateFinished(this.drawSelection.bind(this.oTableWithoutHeaders));
		var handleConfirm = function(oEvent) {
			var param = oEvent.getParameters();
			self.oTableWithoutHeaders.setBusy(true);
			skipAction = 0;
			sortProperty = param.sortItem.getKey();
			sortOrderIsDescending = param.sortDescending;
			top = 100;
			skip = 0;
			var sorter = [];
			if (param.sortItem) {
				if (self.isAlternateRepresentation) {
					var oTableBinding = self.oTableWithoutHeaders.getBinding("items");
					sorter.push(new sap.ui.model.Sorter(sortProperty, sortOrderIsDescending));
					oTableBinding.sort(sorter);
					self.oTableWithoutHeaders.setBusy(false);
					return;
				}
				oApi.updatePath(function(oStep, bStepChanged) {
					if (oStep === oApi.getActiveStep()) {
						self.oModel.setData({
							tableData : self.aDataResponse
						});
						self.oTableWithoutHeaders.rerender();
						self.oTableWithoutHeaders.setBusy(false);
					}
				}.bind(this));
			}
		};
		//sort of table using ViewSettingsDialog
		this.viewSettingsDialog = new sap.m.ViewSettingsDialog({
			confirm : handleConfirm
		});
		for(i = 0; i < oTableWithHeaders.getColumns().length; i++) {
			var oItem = new sap.m.ViewSettingsItem({
				text : self.columns.name[i],
				key : self.columns.value[i]
			});
			this.viewSettingsDialog.addSortItem(oItem);
		}
		//Set default values of radio buttons in view settings dialog.If sortfield and sort order is coming from the configuration set those else
		//by default set the first value in sort field and sort order respectively
		if (sortProperty === undefined && sortOrderIsDescending === undefined) {
			if (this.getParameter().orderby && this.getParameter().orderby.length) {
				for(i = 0; i < this.viewSettingsDialog.getSortItems().length; i++) {
					if (this.getParameter().orderby[0].property === this.viewSettingsDialog.getSortItems()[i].getKey()) {
						this.viewSettingsDialog.setSelectedSortItem(this.viewSettingsDialog.getSortItems()[i]);
						this.viewSettingsDialog.setSortDescending(!this.getParameter().orderby[0].ascending);
					}
				}
			} else {
				this.viewSettingsDialog.setSelectedSortItem(this.viewSettingsDialog.getSortItems()[0]);
				this.viewSettingsDialog.setSortDescending(false);
			}
		} else {
			for(i = 0; i < this.viewSettingsDialog.getSortItems().length; i++) {
				if (sortProperty === this.viewSettingsDialog.getSortItems()[i].getKey()) {
					this.viewSettingsDialog.setSelectedSortItem(this.viewSettingsDialog.getSortItems()[i]);
				}
			}
			this.viewSettingsDialog.setSortDescending(sortOrderIsDescending);
			var sorter = [];
			if (this.isAlternateRepresentation) {
				var oTableBinding = self.oTableWithoutHeaders.getBinding("items");
				sorter.push(new sap.ui.model.Sorter(sortProperty, sortOrderIsDescending));
				oTableBinding.sort(sorter);
			}
		}
		//aligning amount fields
		if (self.metadata !== undefined) {
			for(i = 0; i < self.columns.name.length; i++) {
				var oMetadata = self.metadata.getPropertyMetadata(self.columns.value[i]);
				if (oMetadata.unit) {
					var amountCol = self.oTableWithoutHeaders.getColumns()[i];
					amountCol.setHAlign(sap.ui.core.TextAlign.Right);
				}
			}
		}
		//Scroll container for table without headers(to get vertical scroll on data part used for pagination)
		var scrollContainer = new sap.m.ScrollContainer({
			content : self.oTableWithoutHeaders,
			height : "480px",
			horizontal : false,
			vertical : true
		}).addStyleClass("tableWithoutHeaders");
		var loadMoreLink = new sap.m.Link({
			text : "More"
		}).addStyleClass("loadMoreLink");
		//Scroll container to hold table with headers and scroll container containing table without headers)
		var scrollContainer1 = new sap.m.ScrollContainer({
			content : [ oTableWithHeaders, scrollContainer ],
			width : chartWidth,
			horizontal : true,
			vertical : false
		}).addStyleClass("scrollContainer");
		self.oModel.setSizeLimit(10000); // Set the size of data response to 10000 records
		//Event delegate to bind pagination action
		oTableWithHeaders.addEventDelegate({
			onAfterRendering : function() {
				//For IE-Full width for alternate representation 
				jQuery(".scrollContainer > div:first-child").css({
					"display" : "table",
					"width" : "inherit"
				});
				var scrollContainerHeight;
				if (self.offsetTop === undefined) {
					self.offsetTop = jQuery(".tableWithoutHeaders").offset().top;
				}
				if (jQuery(".tableWithoutHeaders").offset().top !== self.offsetTop) {
					//fullscreen
					scrollContainerHeight = ((window.innerHeight - jQuery('.tableWithoutHeaders').offset().top)) + "px";
				} else {
					scrollContainerHeight = ((window.innerHeight - jQuery('.tableWithoutHeaders').offset().top) - (jQuery(".applicationFooter").height()) - 20) + "px";
				}
				document.querySelector('.tableWithoutHeaders').style.cssText += "height : " + scrollContainerHeight;
				var dLoadMoreLink = sap.ui.getCore().getRenderManager().getHTML(loadMoreLink);
				var intervalPaginate;
				//TODO for height issue on orientation change
				sap.ui.Device.orientation.attachHandler(function() {
					scrollContainer1.rerender();
				});
				var oActiveStep = oApi.getActiveStep();
				//Check if alternate representation else don't paginate
				if (oActiveStep.getSelectedRepresentation().bIsAlternateView === undefined || oActiveStep.getSelectedRepresentation().bIsAlternateView === false) {
					if (sap.ui.Device.browser.mobile) {
						//Add More Button for Mobile Device for Pagination
						jQuery(jQuery(".tableWithoutHeaders > div:first-child")).append(dLoadMoreLink);
						loadMoreLink.attachPress(function() {
							if (!jQuery(".openToggleImage").length && (respData.length > 0)) {
								if (eventsFired === 0) {
									triggerPagination();
									skipAction = 0;
									eventsFired++;
									jQuery(".loadMoreLink").remove();
									jQuery(jQuery(".tableWithoutHeaders > div:first-child")).append(dLoadMoreLink);
								}
							} else {
								jQuery(".loadMoreLink").remove();
							}
						});
					} else {
						//Mouse scroll, Mouse Down and Mouse Up Events for Desktop				
						jQuery('.tableWithoutHeaders').on("scroll", function() {
							var self = jQuery(this);
							var scrollTop = self.prop("scrollTop");
							var scrollHeight = self.prop("scrollHeight");
							var offsetHeight = self.prop("offsetHeight");
							var contentHeight = scrollHeight - offsetHeight - 5;
							if ((contentHeight <= scrollTop) && !jQuery(".openToggleImage").length && (respData.length > 0)) {
								if (eventsFired === 0) {
									triggerPagination();
									skipAction = 0;
									eventsFired++;
								}
							}
						});
					}
				}
				var triggerPagination = function() {
					self.oTableWithoutHeaders.setBusy(true);
					sap.ui.getCore().applyChanges();
					var oData = self.oModel.getData();
					skip += obj.length;
					top = 10;
					triggerBool = true;
					oApi.updatePath(function(oStep, bStepChanged) {
						if (oStep === oApi.getActiveStep()) {
							self.oModel.setData(oData);
							self.oTableWithoutHeaders.rerender();
							self.oTableWithoutHeaders.setBusy(false);
							eventsFired = 0;
						}
					}.bind(this));
				};
			}
		});
		return new sap.ui.layout.VerticalLayout({
			content : [ scrollContainer1 ]
		});
	};
	/**
	 *@method getThumbnailContent 
	 *@description draws Thumbnail for the current chart and returns to the calling object
	 *@returns thumbnail object for column
	 */
	this.getThumbnailContent = function() {
		if (this.aDataResponse !== undefined && this.aDataResponse.length !== 0) {
			var image = new sap.ui.core.Icon({
				src : "sap-icon://table-chart",
				size : "70px"
			}).addStyleClass('thumbnailTableImage');
			return image;
		} else {
			var noDataText = new sap.m.Text({
				text : oApi.getTextNotHtmlEncoded("noDataText")
			}).addStyleClass('noDataText');
			return new sap.ui.layout.VerticalLayout({
				content : noDataText
			});
		}
	};
	/**
	 * @method serialize 
	 * @description Getter for Serialized data for a representation
	 * @returns selectionObject
	 */
	this.serialize = function() {
		return {
			oFilter : this.getFilter().serialize()
		};
	};
	/**
	 * @method deserialize
	 * @param selectionObject from the serialized data
	 * @description deserialize data and sets the selection on representation
	 */
	this.deserialize = function(oSerializable) {
		var filter = oApi.createFilter();
		this.setFilter(filter.deserialize(oSerializable.oFilter));
	};
	/**
	 * @method getFilterMethodType
	 * @description This method helps in determining which method has to be used for the filter retrieval from a representation.
	 * @returns {sap.apf.constants.filterMethodTypes} The filter method type the representation supports
	 */
	this.getFilterMethodType = function() {
		return sap.apf.core.constants.filterMethodTypes.filter; // returns the filter method type the representation supports
	};
	/**
	 * @method getSelectionCount
	 * @description This method helps in determining the selection count of a representation
	 * @returns the selection count of the current representation.
	 */
	this.getSelectionCount = function() {
		var sRequiredFilterProperty = self.getFilter().getInternalFilter().getProperties()[0], aFilterTerms = self.getFilter().getInternalFilter().getFilterTermsForProperty(sRequiredFilterProperty);
		return aFilterTerms.length;
	};
	/**
	 * @method getFilter
	 * @description gets the current filter from the representation.
	 */
	this.getFilter = function() {
		return this.filter;
	};
	/**
	 * @method setFilter
	 * @param {sap.apf.utils.Filter} oFilter
	 * @description sets the initial filter to the representation. The filter holds the values of the start filter of the path.
	 */
	this.setFilter = function(oFilter) {
		this.filter = oFilter;
	};
	/**
	 * @method adoptSelection
	 * @param {object} oSourceRepresentation Source representation implementing the representationInterface.
	 * @description Called on representation by binding when a representation type is set.
	 */
	this.adoptSelection = function(oSourceRepresentation) {
		if (oSourceRepresentation && oSourceRepresentation.getFilter) {
			this.setFilter(oSourceRepresentation.getFilter());
		}
	};
	/**
	 * @method removeAllSelection
	 * @description removes all Selection from Chart
	 */
	this.removeAllSelection = function() {
		this.setFilter(oApi.createFilter());
		oApi.selectionChanged();
		self.oTableWithoutHeaders.getItems().forEach(function(item) {
			item.removeStyleClass('sapMLIBSelected');
		});
	};
	/**
	 * @method getPrintContent
	 * @param oStepTitle title of the step
	 * @description gets the printable content of the representation
	 */
	this.getPrintContent = function(oStepTitle) {
		this.createDataset();
		var obj = this.aDataResponse;
		this.oModel.setData({
			tableData : obj
		});
		var i;
		var columns = [];
		for(i = 0; i < self.columns.name.length; i++) {
			self.columnName = new sap.m.Column({
				width : "75px",
				header : new sap.m.Label({
					text : self.columns.name[i]
				})
			});
			columns.push(self.columnName);
		}
		var columnCells = [];
		for(i = 0; i < self.columns.name.length; i++) {
			self.cellValues = new sap.m.Text().bindText(self.columns.value[i], function(index) {
				return function(columnValue) {
					if (self.metadata === undefined) {
						return columnValue;
					} else {
						var oMetadata = self.metadata.getPropertyMetadata(self.columns.value[index]);
						if (oMetadata.dataType.type === "Edm.DateTime") {
							if (columnValue === null) {
								return "-";
							}
							var dateFormat = new Date(parseInt(columnValue.slice(6, columnValue.length - 2), 10));
							dateFormat = dateFormat.toLocaleDateString();
							if (dateFormat === "Invalid Date") {
								return "-";
							}
							return dateFormat;
						}
						if (oMetadata.unit) {
							if (columnValue === null) {
								return "-";
							}
							var currencyMetadata = self.metadata.getPropertyMetadata(oMetadata.unit);
							if (currencyMetadata.semantics === "currency-code") {
								var precision = self.aDataResponse[0][oMetadata.scale];
								columnValue = parseFloat(columnValue, 10).toFixed(precision).toString();
								var store = columnValue.split(".");
								var amountValue = parseFloat(store[0]).toLocaleString();
								var sample = 0.1;
								sample = sample.toLocaleString();
								if (amountValue.split(sample.substring(1, 2)).length > 1) {
									amountValue = amountValue.split(sample.substring(1, 2))[0];
								}
								amountValue = amountValue.concat(sample.substring(1, 2), store[1]);
								return amountValue;
							}
						} else {
							return columnValue;
						}
					}
				};
			}(i), sap.ui.model.BindingMode.OneWay);
			columnCells.push(self.cellValues);
		}
		var oTable = new sap.m.Table({
			headerText : oStepTitle,
			headerDesign : sap.m.ListHeaderDesign.Standard,
			columns : columns,
			items : {
				path : "/tableData",
				template : new sap.m.ColumnListItem({
					cells : columnCells
				})
			}
		}).addStyleClass("printTable");
		//aligning amount fields
		if (self.metadata !== undefined) {
			for(i = 0; i < self.columns.name.length; i++) {
				var oMetadata = self.metadata.getPropertyMetadata(self.columns.value[i]);
				if (oMetadata.unit) {
					var amountCol = oTable.getColumns()[i];
					amountCol.setHAlign(sap.ui.core.TextAlign.Right);
				}
			}
		}
		oTable.setModel(self.oModel);
		oTable.attachUpdateFinished(this.drawSelection.bind(oTable));
		return new sap.ui.layout.VerticalLayout({
			content : [ oTable ]
		});
	};
};

}; // end of sap/apf/ui/representations/table.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.reuse.controller.stepGallery.controller') ) {
  jQuery.sap.declare('sap.apf.ui.reuse.controller.stepGallery.controller');
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/**
 *@class stepGallery
 *@name stepGallery
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller for step Gallery 
 * 
 */
sap.ui.controller("sap.apf.ui.reuse.controller.stepGallery", {
	/**
	 *@this {sap.apf.ui.reuse.controller.stepGallery}
	 */
	/**
	*@memberOf sap.apf.ui.reuse.controller.stepGallery
	*@method getGalleryElementsData 
	*@description Returns array needed to draw step gallery content.
	*@returns   {object} jsonData
	*/
	getGalleryElementsData : function() {
		var self = this;
		var aGalleryElements = [];
		var aCategories = this.oCoreApi.getCategories();
		var label = this.oCoreApi.getTextNotHtmlEncoded("label");
		var steps = this.oCoreApi.getTextNotHtmlEncoded("steps");
		var category = this.oCoreApi.getTextNotHtmlEncoded("category");
		var oMessageObject;
		if (aCategories.length === 0) {
			oMessageObject = this.oCoreApi.createMessageObject({
				code : "6001",
				aParameters : [ "Categories" ]
			});
			this.oCoreApi.putMessage(oMessageObject);
		}
		var i;
		for(i = 0; i < aCategories.length; i++) {
			var oGalleryElement = {};
			var oCategory = aCategories[i];
			var oCategoryDetails = {};
			var categoryName;
			if (!oCategory.label) {
				oMessageObject = this.oCoreApi.createMessageObject({
					code : "6002",
					aParameters : [ label, category + ": " + categoryName ]
				});
				this.oCoreApi.putMessage(oMessageObject);
			} else {
				categoryName = this.oCoreApi.getTextNotHtmlEncoded(oCategory.label);
				oCategoryDetails.title = this.oCoreApi.getTextNotHtmlEncoded(oCategory.label);
			}
			oCategoryDetails.id = oCategory.id;
			oGalleryElement.categoryDetails = oCategoryDetails;
			oGalleryElement.stepTemplates = [];
			oCategory.stepTemplates.forEach(function(oStepTemplate){
				var oStepDetail = {};
				if (!oStepTemplate.title) {
					oMessageObject = self.oCoreApi.createMessageObject({
						code : "6003",
						aParameters : [ "Title" ]
					});
					self.oCoreApi.putMessage(oMessageObject);
				} else {
					oStepDetail.maintitle = self.oCoreApi.getTextNotHtmlEncoded(oStepTemplate.title);
				}
				oStepDetail.id = oStepTemplate.id;
				oStepDetail.representationtypes = oStepTemplate.getRepresentationInfo();
				oStepDetail.representationtypes.forEach(function(oRepresentation) {
					oRepresentation.title = self.oCoreApi.getTextNotHtmlEncoded(oRepresentation.label);
					if (oRepresentation.parameter && oRepresentation.parameter.orderby) { //if orderby has a value then only get the sort description
						var representationSortDetail = new sap.apf.ui.utils.Helper(self.oCoreApi).getRepresentationSortInfo(oRepresentation);
						oRepresentation.sortDescription = representationSortDetail;
					}
				});
				oStepDetail.defaultRepresentationType = oStepDetail.representationtypes[0];
				oGalleryElement.stepTemplates.push(oStepDetail);
			});
			aGalleryElements.push(oGalleryElement);
		}
		var aStepTemplates = this.oCoreApi.getStepTemplates();
		if (aStepTemplates.length === 0) {
			oMessageObject = this.oCoreApi.createMessageObject({
				code : "6002",
				aParameters : [ steps, category ]
			});
			this.oCoreApi.putMessage(oMessageObject);
		}
//		var j, k;
//		for(i = 0; i < aStepTemplates.length; i++) {
//			var oStepTemplate = aStepTemplates[i];
//			aCategories = oStepTemplate.categories;
//			for(j = 0; j < aCategories.length; j++) {
//				var Category = aCategories[j];
//				for(k = 0; k < aGalleryElements.length; k++) {
//					var galleryElement = aGalleryElements[k];
//					if (galleryElement.categoryDetails.id === Category.id) {
// (BEG MOVE UP)		
//						var oStepDetail = {};
//						if (!oStepTemplate.title) {
//							oMessageObject = this.oCoreApi.createMessageObject({
//								code : "6003",
//								aParameters : [ "Title" ]
//							});
//							this.oCoreApi.putMessage(oMessageObject);
//						} else {
//							oStepDetail.maintitle = this.oCoreApi.getTextNotHtmlEncoded(oStepTemplate.title);
//						}
//						oStepDetail.id = oStepTemplate.id;
//						oStepDetail.representationtypes = oStepTemplate.getRepresentationInfo();
//						oStepDetail.representationtypes.forEach(function(oRepresentation) {
//							oRepresentation.title = self.oCoreApi.getTextNotHtmlEncoded(oRepresentation.label);
//							if (oRepresentation.parameter && oRepresentation.parameter.orderby) { //if orderby has a value then only get the sort description
//								var representationSortDetail = new sap.apf.ui.utils.Helper(self.oCoreApi).getRepresentationSortInfo(oRepresentation);
//								oRepresentation.sortDescription = representationSortDetail;
//							}
//						});
//						oStepDetail.defaultRepresentationType = oStepDetail.representationtypes[0];
//						galleryElement.stepTemplates.push(oStepDetail);
// (END MOVE UP)								
//					}
//				}
//			}
//		}
		var jsonData = {
			GalleryElements : aGalleryElements
		};
		return jsonData;
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.stepGallery
	*@method onInit 
	*@description Bind gallery elements data to step gallery view.
	*/
	onInit : function() {
		this.oCoreApi = this.getView().getViewData().oCoreApi;
		this.oUiApi = this.getView().getViewData().uiApi;
		var aGalleryElements = this.getGalleryElementsData().GalleryElements;
		var oModel = new sap.ui.model.json.JSONModel({
			"GalleryElements" : aGalleryElements
		});
		this.getView().setModel(oModel, "json");
	},
	/**
	 *@memberOf sap.apf.ui.reuse.controller.stepGallery
	 *@method getStepDetails
	 *@param {string} index of the category in the binding of step gallery dialog
	 *@param {string} index of the step in the binding of step gallery dialog
	 *@return details of a step i.e. id,representationTypes etc
	 */
	getStepDetails : function(categoryIndex, stepIndex) {
		var aGalleryElements = this.getGalleryElementsData().GalleryElements;
		var stepDetails = aGalleryElements[categoryIndex].stepTemplates[stepIndex];
		return stepDetails;
	},
	openHierarchicalSelectDialog : function() {
		if (this.oHierchicalSelectDialog) {
			this.oHierchicalSelectDialog.destroy();
		}
		this.oHierchicalSelectDialog = new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.stepGallery", this);
		this.oHierchicalSelectDialog.setModel(this.getView().getModel("json"), "json");
		this.oHierchicalSelectDialog.open();
	},
	/**
	*@memberOf sap.apf.ui.reuse.controller.stepGallery
	*@method onStepPress
	*@param {string} sId Id for step being added
	*@param {object} oRepresentationType Representation
	*@description creates new step.
	*/
	onStepPress : function(sId, oRepresentationType) {
		this.oHierchicalSelectDialog.close();
		this.oUiApi.getLayoutView().setBusy(true);
		this.oCoreApi.createStep(sId, this.oUiApi.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(this.oUiApi.getAnalysisPath().getController()), oRepresentationType);
		this.oUiApi.getLayoutView().setBusy(true);
		this.oUiApi.getAnalysisPath().getController().refresh(-1);
	}
});
}; // end of sap/apf/ui/reuse/controller/stepGallery.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.reuse.controller.stepToolbar.controller') ) {
  jQuery.sap.declare('sap.apf.ui.reuse.controller.stepToolbar.controller');
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/**
 *@class stepToolbar
 *@name stepToolbar
 *@memberOf sap.apf.ui.reuse.controller
 *@description controller for view.stepToolbar
 */
sap.ui.controller("sap.apf.ui.reuse.controller.stepToolbar", {
    /**
     *@this {sap.apf.ui.reuse.controller.stepToolbar}
     */
    chartIconInserted: false,
    alternateRepresentationIcon: false,
    alternateRepresentationBool: false,
    selectedRepresentation: null,
    alternateRepresentationBtn: {},
    selectedNumber: null,
    selectedNumberLink: null,
    isSwitchRepresentation: false,
    viewSettingsIcon: null,
    onInit: function() {
        this.oCoreApi = this.getView().getViewData().oCoreApi;
        this.oUiApi = this.getView().getViewData().uiApi;
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawAlternateRepresentation
     *@description Inserts the alternate representation icon to the chart toolbar
     */
    drawAlternateRepresentation: function() {
        var that = this;
        this.alternateRepresentationBtn = new sap.m.Button({
            icon: this.oCoreApi.getActiveStep().getSelectedRepresentation().getAlternateRepresentation().picture,
            tooltip: this.oCoreApi.getTextNotHtmlEncoded("TableRepresentation"),
            press: function() {
                var oStep = that.oCoreApi.getActiveStep();
                var currentRepresentation = oStep.getSelectedRepresentation();
                var activeStepIndex = that.oCoreApi.getSteps().indexOf(oStep);
                that.selectedRepresentation = "table";
                currentRepresentation.bIsAlternateView = true;
                if (currentRepresentation.toggleInstance === undefined) {
                    currentRepresentation.toggleInstance = that.oUiApi.getStepContainer().getController().createAlternateRepresentation(activeStepIndex);
                } else {
                    var data = currentRepresentation.getData(),
                        metadata = currentRepresentation.getMetaData();
                    if (data !== undefined && metadata !== undefined) {
                        currentRepresentation.toggleInstance.setData(data, metadata);
                    }
                    currentRepresentation.toggleInstance.adoptSelection(currentRepresentation);
                }
                that.oUiApi.getAnalysisPath().getController().refresh(-1);
                that.oUiApi.getStepContainer().getController().drawStepContent();
                that.oUiApi.getAnalysisPath().getCarousel().getStepView(activeStepIndex).getController().drawThumbnailContent(true);
            }
        }).addStyleClass("alternateButton");
        this.insertViewSettingsIcon();
        this.getView().chartToolbar.getToolBar().insertContentRight(this.alternateRepresentationBtn);
    },
    /** 
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawMultipleRepresentation
     *@description Method to insert icons for multiple representations
     */
    insertViewSettingsIcon: function() {
        var that = this;
        this.sortButton = new sap.m.Button({
            icon: "sap-icon://drop-down-list",
            tooltip: this.oCoreApi.getTextNotHtmlEncoded("view-Settings"),
            press: function() {
                if (that.oCoreApi.getActiveStep().getSelectedRepresentation().type !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
                    that.oCoreApi.getActiveStep().getSelectedRepresentation().toggleInstance.viewSettingsDialog.open();
                } else {
                    that.oCoreApi.getActiveStep().getSelectedRepresentation().viewSettingsDialog.open();
                }
            }
        }).addStyleClass("sortButton");
        this.getView().chartToolbar.getToolBar().insertContentRight(this.sortButton);
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method showSelectionCount
     *@description Shows the selected count(label) and delete icon of the representation
     */
    showSelectionCount: function() {
        var oActiveStep = this.oCoreApi.getActiveStep();
        var selectedRepresentation = oActiveStep.getSelectedRepresentation();
        var selectionCount = typeof(selectedRepresentation.getSelections) === "function" ? selectedRepresentation.getSelections().length : (typeof(selectedRepresentation.getSelectionCount) === "function" ? selectedRepresentation.getSelectionCount() : 0);
        var bRequirefFilterPresent = selectedRepresentation.getParameter().requiredFilters !== undefined && selectedRepresentation.getParameter().requiredFilters.length !== 0;
        var bMetadataPresent = selectedRepresentation.getMetaData !== undefined && selectedRepresentation.getMetaData() !== undefined && selectedRepresentation.getMetaData().hasOwnProperty("getPropertyMetadata");
        var selectedDimension = bRequirefFilterPresent && bMetadataPresent ? selectedRepresentation.getMetaData().getPropertyMetadata(selectedRepresentation.getParameter().requiredFilters[0]).label : null;
        if (selectedDimension === null || selectionCount === 0) {
            jQuery(".showSelection").hide();
            jQuery(".resetSelection").hide();
        } else if (selectionCount > 0) {
            this.selectedNumber.setText("(" + this.oCoreApi.getTextNotHtmlEncoded("selected-objects", [selectedDimension]));
            this.selectedNumberLink.setText(selectionCount);
            jQuery(".showSelection").show();
            jQuery(".resetSelection").show();
        }
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method insertContentLeft
     *@description Inserts the Selection label,count and delete icon to the step toolbar
     */
    insertContentLeft: function() {
        var that = this;
        // insert left content to the toolbar
        this.currentStepText = new sap.m.Label({
            wrapping: true,
            text: this.oCoreApi.getTextNotHtmlEncoded("currentStep")
        }).addStyleClass("currentStep");
        this.selectedNumber = new sap.m.Label({
            wrapping: true
        }).addStyleClass("showSelection");
        var selectedNumberEndText = new sap.m.Label({
            text: ")"
        }).addStyleClass("showSelection");
        selectedNumberEndText.addStyleClass("selectedNumberEndText");
        this.selectedNumberLink = new sap.m.Link({
            press: function() {
                if (that.selectionDisplayDialog) {
                    that.selectionDisplayDialog.destroy();
                }
                that.selectionDisplayDialog = new sap.ui.jsfragment("sap.apf.ui.reuse.fragment.selectionDisplay", that);
                that.selectionDisplayDialog.open();
            }
        }).addStyleClass("showSelection");
        this.selectedNumberLink.addStyleClass("selectedNumberLink");
        // delete icon for selected items
        this.resetSelection = new sap.m.Link({
            text: this.oCoreApi.getTextNotHtmlEncoded("resetSelection")
        }).attachPress(function() {
            jQuery(".showSelection").hide();
            jQuery(".resetSelection").hide();
            if (that.oCoreApi.getActiveStep().getSelectedRepresentation().bIsAlternateView) {
                that.oCoreApi.getActiveStep().getSelectedRepresentation().toggleInstance.removeAllSelection();
            }
            that.oCoreApi.getActiveStep().getSelectedRepresentation().removeAllSelection();
        }).addStyleClass("resetSelection");
        this.getView().chartToolbar.getToolBar().insertContentRight(this.resetSelection);
        this.getView().chartToolbar.getToolBar().insertContentLeft(selectedNumberEndText);
        this.getView().chartToolbar.getToolBar().insertContentLeft(this.selectedNumberLink);
        this.getView().chartToolbar.getToolBar().insertContentLeft(this.selectedNumber);
        this.getView().chartToolbar.getToolBar().insertContentLeft(this.currentStepText);
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawSingleRepresentation
     *@description Method to insert icon for single representation
     */
    drawSingleRepresentation: function() {
        var that = this;
        var activeStep = this.oCoreApi.getActiveStep();
        activeStep.selectedRepresentaionType = activeStep.getSelectedRepresentationInfo();
        if (activeStep.selectedRepresentaionType.parameter && activeStep.selectedRepresentaionType.parameter.orderby) {
            var representationSortDetail = new sap.apf.ui.utils.Helper(that.oCoreApi).getRepresentationSortInfo(activeStep.selectedRepresentaionType);
            activeStep.selectedRepresentaionType.sortDescription = representationSortDetail;
        }
        var selectedMultipleRepresentationBtn = new sap.m.Button({
            icon: activeStep.selectedRepresentaionType.picture,
            tooltip: this.oCoreApi.getTextNotHtmlEncoded(activeStep.selectedRepresentaionType.label) + "\n" + ((activeStep.selectedRepresentaionType.sortDescription !== undefined) ? this.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + activeStep.selectedRepresentaionType.sortDescription : ""),
            press: function() {
                var oStep = activeStep;
                var currentRepresentation = oStep.getSelectedRepresentation();
                currentRepresentation.bIsAlternateView = false;
                that.oUiApi.getStepContainer().getController().drawStepContent();
                var activeStepIndex = that.oCoreApi.getSteps().indexOf(oStep);
                that.oUiApi.getAnalysisPath().getCarousel().getStepView(activeStepIndex).getController().drawThumbnailContent(true);
            }
        });
        this.getView().chartToolbar.getToolBar().insertContentRight(selectedMultipleRepresentationBtn, 0);
        this.insertContentLeft();
    },
    /** 
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawMultipleRepresentation
     *@description Method to insert icons for multiple representations
     */
    drawMultipleRepresentation: function() {
        var that = this;
        var activeStep = this.oCoreApi.getActiveStep();
        activeStep.representationtypes = activeStep.getRepresentationInfo();
        activeStep.representationtypes.forEach(function(oRepresentation) {
            if (oRepresentation.parameter && oRepresentation.parameter.orderby) { //if orderby has a value then only get the sort description
                var representationSortDetail = new sap.apf.ui.utils.Helper(that.oCoreApi).getRepresentationSortInfo(oRepresentation);
                oRepresentation.sortDescription = representationSortDetail;
            }
        });
        activeStep.selectedRepresentaionType = activeStep.getSelectedRepresentationInfo();
        if (activeStep.selectedRepresentaionType.parameter && activeStep.selectedRepresentaionType.parameter.orderby) {
            var representationSortDetail = new sap.apf.ui.utils.Helper(this.oCoreApi).getRepresentationSortInfo(activeStep.selectedRepresentaionType);
            activeStep.selectedRepresentaionType.sortDescription = representationSortDetail;
        }

        var reperesentationTypesLength = activeStep.representationtypes.length;
        var selectedMultipleRepresentationBtn;
        var drawSelectedRepresentation = function(data) {
            data.oCurrentActiveStep.getSelectedRepresentation().bIsAlternateView = false;
            data.oCurrentActiveStep.setSelectedRepresentation(data.oRepresentationType.representationId);
            that.oUiApi.getAnalysisPath().getController().refresh(data.nActiveStepIndex);
            that.oCoreApi.updatePath(that.oUiApi.getAnalysisPath().getController().callBackForUpdatePath.bind(that.oUiApi.getAnalysisPath().getController()));
        };
        this.openList = function(oEvent) {
            var data = oEvent.getParameter("listItem").getCustomData()[0].getValue();
            drawSelectedRepresentation(data);
            selectedMultipleRepresentationBtn.setIcon(data.icon);
            selectedMultipleRepresentationBtn.setTooltip(that.oCoreApi.getTextNotHtmlEncoded(data.oRepresentationType.label) + "\n" + (data.oRepresentationType.sortDescription !== undefined ? that.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + data.oRepresentationType.sortDescription : ""));
        };
        var oAllChartList = new sap.m.List({
            mode: sap.m.ListMode.SingleSelectMaster,
            showSeparators: sap.m.ListSeparators.None,
            includeItemInSelection: true,
            select: jQuery.proxy(function(oEvent) {
                this.openList(oEvent);
            }, this)
        });
        for (var j = 0; j < reperesentationTypesLength; j++) {
            oAllChartList.addItem(new sap.m.StandardListItem({
                description: activeStep.representationtypes[j].sortDescription && this.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + activeStep.representationtypes[j].sortDescription,
                icon: activeStep.representationtypes[j].picture,
                title: that.oCoreApi.getTextNotHtmlEncoded(activeStep.representationtypes[j].label),
                customData: [new sap.ui.core.CustomData({
                    key: 'data',
                    value: {
                        oCurrentActiveStep: that.oCoreApi.getActiveStep(),
                        oRepresentationType: activeStep.representationtypes[j],
                        nActiveStepIndex: that.oCoreApi.getSteps().indexOf(that.oCoreApi.getActiveStep()),
                        icon: activeStep.representationtypes[j].picture
                    }
                })]
            }));
        }
        var oShowAllChartPopover = new sap.m.Popover({
            placement: sap.m.PlacementType.Bottom,
            showHeader: false,
            content: [oAllChartList]
        }).addStyleClass("sapCaUiChartToolBarShowAllChartListPopover");
        //full-screen buttons
        for (var k = 0; k < reperesentationTypesLength; k++) {
            var button = new sap.m.Button({
                tooltip: that.oCoreApi.getTextNotHtmlEncoded(activeStep.representationtypes[k].label) + "\n" + ((activeStep.representationtypes[k].sortDescription !== undefined) ? this.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + activeStep.representationtypes[k].sortDescription : ""),
                icon: activeStep.representationtypes[k].picture,
                customData: [new sap.ui.core.CustomData({
                    key: 'data',
                    value: {
                        oCurrentActiveStep: that.oCoreApi.getActiveStep(),
                        oRepresentationType: activeStep.representationtypes[k],
                        nActiveStepIndex: that.oCoreApi.getSteps().indexOf(that.oCoreApi.getActiveStep()),
                        icon: activeStep.representationtypes[k].picture
                    }
                })],
                press: function(oEvent) {
                    var data = oEvent.getSource().getCustomData()[0].getValue();
                    drawSelectedRepresentation(data);
                }
            });
            button.addStyleClass("iconLeft");
            this.getView().chartToolbar.getToolBar().insertContentRight(button);
        }
        selectedMultipleRepresentationBtn = new sap.m.Button({
            icon: activeStep.selectedRepresentaionType.picture,
            tooltip: this.oCoreApi.getTextNotHtmlEncoded(activeStep.selectedRepresentaionType.label) + "\n" + ((activeStep.selectedRepresentaionType.sortDescription !== undefined) ? this.oCoreApi.getTextNotHtmlEncoded("sortBy") + " : " + activeStep.selectedRepresentaionType.sortDescription : ""),
            press: function() {
                oShowAllChartPopover.openBy(this);
            }
        }).addStyleClass("iconList");
        this.getView().chartToolbar.getToolBar().insertContentRight(selectedMultipleRepresentationBtn, 0);
        this.insertContentLeft();
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawToolBar
     *@description renders the toolbar specific for single or multiple representations and shows/hide legend icon/alternate representation icon
     */
    drawToolBar: function() {
        var that = this;
        this.showAndHideIcons = function() {
            var that = this;
            that.isSwitchRepresentation = false;
            if (that.getView().chartToolbar.getFullScreen() === true) {
                //full-screen
                jQuery(".iconList").hide();
                jQuery(".iconLeft").show();
            } else {
                //initial
                jQuery(".iconList").show();
                jQuery(".iconLeft").hide();
            }
            //show table sort icon, show only if the representation is table and if the alternate representation is table
            if ((that.oCoreApi.getActiveStep().getSelectedRepresentation().bIsAlternateView && that.oCoreApi.getActiveStep().getSelectedRepresentation().getAlternateRepresentation().id === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) || that.oCoreApi.getActiveStep().getSelectedRepresentation().type === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
                jQuery(".sortButton").show();
            } else {
                jQuery(".sortButton").hide();
            }
            // selection count and label
            if (that.oCoreApi.getSteps().length >= 1) {
                that.showSelectionCount();
            }
            // for iPhone and when screen resizes, the chartToolbar width will be equal to window width
            var toolbarId = that.getView().chartToolbar.getId();
            if (that.oCoreApi.getActiveStep().getSelectedRepresentation().getAlternateRepresentation() !== undefined) {
                if ((!that.oCoreApi.getActiveStep().getSelectedRepresentation().bIsAlternateView && that.oCoreApi.getActiveStep().getSelectedRepresentation().getAlternateRepresentation().id !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) || that.oCoreApi.getActiveStep().getSelectedRepresentation().type !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
                    if ((window.innerWidth === jQuery("#" + toolbarId + " > div:first-child > div:nth-child(2)").width())) {
                        jQuery(that.getView().chartToolbar._oShowLegendButton.getDomRef()).show();
                    }
                }
            }
        };
        this.renderIcons = function() {
            var that = this;
            var oActiveStep = that.oCoreApi.getActiveStep();
            if (oActiveStep !== undefined) {
                //tooltip added for fullscreen
                that.getView().chartToolbar._oFullScreenButton.setTooltip(that.oCoreApi.getTextNotHtmlEncoded("toggle-fullscreen"));
                that.getView().chartToolbar._oFullScreenExitButton.setTooltip(that.oCoreApi.getTextNotHtmlEncoded("toggle-fullscreen"));
                var stepRepresentation = oActiveStep.getSelectedRepresentation().chart || {};
                //draw table
                if (that.alternateRepresentationIcon === false && that.oCoreApi.getActiveStep().getSelectedRepresentation().type !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
                    that.drawAlternateRepresentation();
                    that.alternateRepresentationIcon = true;
                }
                //table sort icon
                if (that.oCoreApi.getActiveStep().getSelectedRepresentation().type === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) {
                    if (that.viewSettingsIcon === false) {
                        that.insertViewSettingsIcon();
                        //that.insertContentLeft();
                    }
                    that.viewSettingsIcon = true;
                }
                //draw representation
                if (that.oCoreApi.getActiveStep().getRepresentationInfo().length > 1) {
                    if (that.chartIconInserted === false) {
                        that.drawMultipleRepresentation();
                    }
                    that.chartIconInserted = true;
                } else if (that.oCoreApi.getActiveStep().getSelectedRepresentation().type !== sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION && that.oCoreApi.getActiveStep().getRepresentationInfo().length === 1) {
                    if (that.chartIconInserted === false) {
                        that.drawSingleRepresentation();
                    }
                    that.chartIconInserted = true;
                }
                //Disable if the representation is table or geomap
                if ((that.oCoreApi.getActiveStep().getSelectedRepresentation().bIsAlternateView && that.oCoreApi.getActiveStep().getSelectedRepresentation().getAlternateRepresentation().id === sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION) || that.oCoreApi.getActiveStep().getSelectedRepresentation().type === (sap.apf.ui.utils.CONSTANTS.representationTypes.TABLE_REPRESENTATION || sap.apf.ui.utils.CONSTANTS.representationTypes.GEO_MAP)) {
                    that.getView().chartToolbar._oShowLegendButton.setVisible(false);
                } else {
                    that.getView().chartToolbar._oShowLegendButton.setVisible(true);
                    that.getView().chartToolbar._oShowLegendButton.setTooltip(that.oCoreApi.getTextNotHtmlEncoded("legend"));
                }
                //If representation is switched then show the legend
                if (that.isSwitchRepresentation === true) {
                    that.getView().chartToolbar.setShowLegend(true);
                }
            }
        };
        this.getView().chartToolbar.addEventDelegate({
            onAfterRendering: function() {
                if (that.oCoreApi.getSteps().length > 0) {
                    that.showAndHideIcons();
                }
                
                var oStep = that.oCoreApi.getActiveStep();
				if (oStep) { //If step exists then toggle the legend 
					var currentRepresentation = oStep.getSelectedRepresentation();
					var formatString;
					var stepRepresentation = oStep.getSelectedRepresentation().chart || {};
					//Show/Hide Legend
					if (currentRepresentation.bIsLegendVisible === true || currentRepresentation.bIsLegendVisible === undefined) {
						if (stepRepresentation.setVizProperties) { //Check if Viz Frame Charts
							stepRepresentation.setVizProperties({
								legend : {
									visible : true
								},
								sizeLegend : {
									visible : true
								}
							});
						} else { //Fallback for Viz Charts
							if (stepRepresentation.setLegend !== undefined) {
								stepRepresentation.setLegend(new sap.viz.ui5.types.legend.Common({
									visible : true,
									title : new sap.viz.ui5.types.legend.Common_title({
										visible : true
									})
								}));
							}
							if (stepRepresentation.setSizeLegend !== undefined) {
								formatString = stepRepresentation.getSizeLegend().getFormatString();
								stepRepresentation.setSizeLegend(new sap.viz.ui5.types.legend.Common({
									visible : true,
									title : new sap.viz.ui5.types.legend.Common_title({
										visible : true
									})
								}));
								if (formatString !== null) {
									stepRepresentation.getSizeLegend().setFormatString(formatString);
								}
							}
						}
					} else {
						if (stepRepresentation.setVizProperties) { //Check if Viz Frame Charts
							stepRepresentation.setVizProperties({
								legend : {
									visible : false
								},
								sizeLegend : {
									visible : false
								}
							});
						} else { //Fallback for Viz Charts
							if (stepRepresentation.setLegend !== undefined) {
								stepRepresentation.setLegend(new sap.viz.ui5.types.legend.Common({
									visible : false,
									title : new sap.viz.ui5.types.legend.Common_title({
										visible : false
									})
								}));
							}
							if (stepRepresentation.setSizeLegend !== undefined) {
								formatString = stepRepresentation.getSizeLegend().getFormatString();
								stepRepresentation.setSizeLegend(new sap.viz.ui5.types.legend.Common({
									visible : false,
									title : new sap.viz.ui5.types.legend.Common_title({
										visible : false
									})
								}));
								if (formatString !== null) {
									stepRepresentation.getSizeLegend().setFormatString(formatString);
								}
							}
						}
					}
				}
            },
            onBeforeRendering: function() {
                if (that.oCoreApi.getSteps().length > 0) {
                    that.renderIcons();
                }
            }
        });
    },
    /**
     *@memberOf sap.apf.ui.reuse.controller.stepToolbar
     *@method drawRepresentation
     *@description This method clears the toolbar content, insert chart and renders toolbar
     */
    drawRepresentation: function(oChart) {
        var that = this;
        this.isSwitchRepresentation = true;
        this.getView().chartToolbar.getToolBar().removeAllContentLeft();
        this.getView().chartToolbar.getToolBar().removeAllContentRight();
        this.chartIconInserted = false;
        this.alternateRepresentationIcon = false;
        this.viewSettingsIcon = false;
        this.getView().chartToolbar.removeAllCharts();
        this.getView().chartToolbar.insertChart(oChart);
        if (this.getView().chartToolbar.getFullScreen() === true) {
            this.getView().chartToolbar.rerender(); //re-render's main chart on fullscreen    
        }
        this.drawToolBar();
        //Handle Legend Show/Hide Mapped to Representations
        this.getView().chartToolbar.onAfterRendering = function() {
            var legendIcon = this._oShowLegendButton.getDomRef();
            //Bind Click Event on legend icon to switch the state of hide/show boolean
            var evtType = sap.ui.Device.browser.mobile ? "tap" : "click";
            $(legendIcon).on(evtType, function() {
                var oStep = that.oCoreApi.getActiveStep();
                var currentRepresentation = oStep.getSelectedRepresentation();
                var oEvt = arguments[0];
                var stepRepresentation = oStep.getSelectedRepresentation().chart || {};
                if (currentRepresentation.bIsLegendVisible === true || currentRepresentation.bIsLegendVisible === undefined) {
                    currentRepresentation.bIsLegendVisible = false;
                } else {
                    currentRepresentation.bIsLegendVisible = true;
                }
            });
        };
    }
});
}; // end of sap/apf/ui/reuse/controller/stepToolbar.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.utils.facetFilterListHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare('sap.apf.ui.utils.facetFilterListHandler');


/**
 * @private
 * @experimental The complete class interface is subject to ongoing work and not yet stable (as of Version 1.24.0).
 * @class Facet filter list handler
 * @description Handler for facet filter list controls
 * @param {sap.apf.core.instance} oCore Api
 * @param (sap.apf.utils.PathContextHandler} Path context handler instance.
 * @param {Array} facet filter configuration of the filter.
 * @name sap.apf.ui.utils.FacetFilterHandler
 * @returns {sap.apf.ui.utils.FacetFilterHandler}
 */
sap.apf.ui.utils.FacetFilterListHandler = function (oCoreApi, oUiApi, oPathContextHandler, oFacetFilterData) {
    "use strict";
    var oFilterTitle = oFacetFilterData.label;
    var sFilterProperty = oFacetFilterData.property;
    var sAlias = oFacetFilterData.alias;
    var sSelectProperty = sAlias || sFilterProperty;
    var sFrr = oFacetFilterData.filterResolutionRequest;
    var sVhr = oFacetFilterData.valueHelpRequest;
    var oMasterDataDeffered;
    var oSelectDataDeffered;
    var bTriedTextResolutionBefore = false; // To make sure that text resolution does not happen again on "open path scenario".
    var bHasServedBefore = false;	// To make sure that the filter value is not saved as initial context during "open path scenario".
    /**
     * @public
     * @function
     * @name sap.apf.ui.utils.FacetFilterListHandler#fetchValueHelpData
     * @description Returns a promise which will be resolved with value help data when the request is successful
     * It will be rejected with error object if the request does not succeed.
     * The promise will get resolved with an empty array if value help request is not available.
     * The promise will get resolved with an {Array} with elements of type {key: skey, text: sText}.
     * @returns {object} jQuery Promise
     * */
    this.fetchValueHelpData = function () {
        oMasterDataDeffered = new jQuery.Deferred();
        if (sVhr) {
            var oVhrPromise = new sap.apf.ui.utils.PromiseBasedCreateReadRequest(oCoreApi, sVhr);
            oVhrPromise.then(this._getFormattedData).then(this._resolveMasterDataPromiseWith, this._handleVhrError);
        } else {
            this._resolveMasterDataPromiseWith([]);
        }
        return oMasterDataDeffered.promise();
    };
    /**
     * @public
     * @function
     * @name sap.apf.ui.utils.FacetFilterListHandler#fetchSelectedFilterData
     * @description Returns a promise which will be resolved with selected filter data.
     * The promise will get resolved with an empty array if filter is not available in path context.
     * The promise will get resolved with an {Array} with elements of type {key: skey, text: sText}.
     * It will be rejected with error object if the request does not succeed.
     * @returns {object} jQuery Promise
     * */
    this.fetchSelectedFilterData = function () {
        oSelectDataDeffered = new jQuery.Deferred();
        var bPropertyPresentInContext = oPathContextHandler.getAllIds().indexOf(sFilterProperty) !== -1;
        if (bPropertyPresentInContext) {
            var oFilter = oPathContextHandler.get(sFilterProperty);
            var aOperators = oFilter.getInternalFilter().getFilterTerms().map(function (term) {
                return term.getOp();
            });
            var bHasRelationalOperators = aOperators.some(function (op) {
                return op !== "EQ";
            });
            if (bHasRelationalOperators || (!sVhr && !bTriedTextResolutionBefore)) {
                bTriedTextResolutionBefore = true;
                if (sFrr) {
                    var oFrrPromise = new sap.apf.ui.utils.PromiseBasedCreateReadRequest(oCoreApi, sFrr, oFilter);
                    oFrrPromise.then(this._resolveRelationalOperatorFromPCH, this._handleFrrError).then(this._getFormattedData).then(this._resolveSelectDataPromiseWith);
                    return oSelectDataDeffered.promise();
                }
                if (bHasRelationalOperators) {
                    this._handleFrrError();
                    return oSelectDataDeffered.promise();
                }
            }
            var aData = oFilter.getInternalFilter().getFilterTerms().map(function (term) {
                return {
                    key: term.getValue(),
                    text: term.getValue()
                };
            });
            this._resolveSelectDataPromiseWith(aData);
        } else {
            this._resolveSelectDataPromiseWith([]);
        }
        return oSelectDataDeffered.promise();
    };
    this._resolveMasterDataPromiseWith = function (aValues, oError) {
        oMasterDataDeffered.resolveWith(this, [ aValues, oError ]);
    };
    this._resolveSelectDataPromiseWith = function (aValues, oError) {
        bHasServedBefore = true;
        oSelectDataDeffered.resolveWith(this, [ aValues, oError ]);
    };
    this._getFormattedData = function (oArg) {
        var aData = oArg.aData;
        var oMetadata = oArg.oMetadata;
        var oFormatter = new sap.apf.ui.representations.utils.formatter({
            getEventCallback: oUiApi.getEventCallback.bind(oUiApi),
            getTextNotHtmlEncoded: oCoreApi.getTextNotHtmlEncoded
        }, oMetadata, aData);
        var sTextProperty = oMetadata.getPropertyMetadata(sSelectProperty).text;
        var aFormattedData = aData.map(function (oData) {
            var sFormattedKeyPropertyValue = oFormatter.getFormattedValue(sSelectProperty, oData[sSelectProperty]);
            var sTextValue;
            if (sTextProperty) {
                var sFormattedTextPropertyValue = oFormatter.getFormattedValue(sTextProperty, oData[sTextProperty]);
                sTextValue = sFormattedKeyPropertyValue + " - " + sFormattedTextPropertyValue;
            } else {
                sTextValue = sFormattedKeyPropertyValue;
            }
            return {
                key: oData[sSelectProperty],
                text: sTextValue
            };
        });
        return aFormattedData;
    };
    this._resolveRelationalOperatorFromPCH = function (oArg) {
        var aData = oArg.aData;
        var oMetadata = oArg.oMetadata;
        var oFilter = oCoreApi.createFilter();
        var oOrTerm = oFilter.getTopAnd().addOr();
        aData.forEach(function (oData) {
            var sValue = oData[sFilterProperty];
            oOrTerm.addExpression({
                name: sFilterProperty,
                operator: "EQ",
                value: sValue
            });
        });
        oPathContextHandler.update(sFilterProperty, oFilter);
        if (!bHasServedBefore) {
            oPathContextHandler.saveInitialContext([sFilterProperty]);
        }
        return {
            aData: aData,
            oMetadata: oMetadata
        }; // TO ALLOW METHOD CHAINING.
    };
    this._handleVhrError = function () {
        var oMessageObject = oCoreApi.createMessageObject({
            code: "6010",
            aParameters: [ oCoreApi.getTextNotHtmlEncoded(oFilterTitle) ]
        });
        oCoreApi.putMessage(oMessageObject);
    };
    this._handleFrrError = function () {
        var oMessageObject = oCoreApi.createMessageObject({
            code: "6010",
            aParameters: [ oCoreApi.getTextNotHtmlEncoded(oFilterTitle) ]
        });
        oCoreApi.putMessage(oMessageObject);
        this._resolveSelectDataPromiseWith([], oMessageObject);
    };
};
}; // end of sap/apf/ui/utils/facetFilterListHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.core.utils.filter') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/**
 * internally used filter object
 */
jQuery.sap.declare('sap.apf.core.utils.filter');


/**
 * @private
 * @class Expression on properties for the filter of an odata request. Filters
 *        represent an expression on properties for the filter of an odata
 *        request. Allowed constructor calls are:
 *        sap.apf.core.utils.Filter(oMsgHandler, property, op, value) or
 *        sap.apf.core.utils.Filter(oMsgHandler, new sap.apf.core.utils.FilterTerm(...)) or
 *        sap.apf.core.utils.Filter(oMsgHandler,new sap.apf.core.utils.Filter(...)).
 * @param {sap.apf.core.MessageHandler} oMsgHandler
 * @param {string|sap.apf.core.utils.Filter|sap.apf.core.utils.FilterTerm} arg1 - First argument is either a Filter or a FilterTerm or a property of a filter term
 * @param {string} arg2 - if param arg2 is supplied, then an operator is expected , a property for arg1 and a value for arg3. Example: 'Country' 'EQ' 'BRA'
 * @param {string} arg3 - value
 * @param {string} arg4 - high-value
 */
sap.apf.core.utils.Filter = function (oMsgHandler, arg1, arg2, arg3, arg4) {
    var cLogicalAndText = "%20and%20";
    var cLogicalOrText = "%20or%20";
    var that = this;
    this.type = "internalFilter"; //sap.utils.filter has type filter
    /**
     * @description either a Filter Term or Filter. This is the first
     *              part (term) of the filter.
     */
    var oLeftExpr;
    if (arg1 && arg1.type && (arg1.type === "filterTerm" || arg1.type === "internalFilter")) {
        oLeftExpr = arg1;
    } else if (arg1 !== undefined && arg2 !== undefined && arg3 !== undefined) {
        oLeftExpr = new sap.apf.core.utils.FilterTerm(oMsgHandler, arg1, arg2, arg3, arg4);
    } else if (arg1 === undefined && arg2 === undefined && arg3 === undefined) {
    } else {
        oMsgHandler.check(false, "wrong arguments in construction of  sap.apf.core.utils.Filter");
    }
    /**
     * @description this array holds the further parts of the filter
     *              expression
     */
    var aRestExpr = [];
    /**
     * @description is either AND or OR and defines, how the sub expressions are
     *              connected.
     */
    var levelOp;
    /**
     * @description Returns the properties of the sub filters
     * @returns {string[]} aProperties Array with property (names), that are used in the filter.
     */
    this.getProperties = function () {
        var i;
        var aProperty = [];
        var aProperty2 = [];
        var property = "";
        if (oLeftExpr === undefined) {
            return aProperty;
        } else if (oLeftExpr instanceof sap.apf.core.utils.FilterTerm) {
            property = oLeftExpr.getProperty();
            aProperty.push(property);
        } else if (oLeftExpr instanceof sap.apf.core.utils.Filter) {
            aProperty = oLeftExpr.getProperties();
        }
        for (i = 0; i < aRestExpr.length; i++) {
            if (aRestExpr[i] instanceof sap.apf.core.utils.FilterTerm) {
                aProperty.push(aRestExpr[i].getProperty());
            } else {
                aProperty2 = aRestExpr[i].getProperties();
                aProperty = aProperty.concat(aProperty2);
            }
        }
        return sap.apf.utils.eliminateDuplicatesInArray(oMsgHandler, aProperty);
    };
    /**
     * @description Copy constructor
     * @returns {sap.apf.core.utils.Filter} Filter New object as deep copy
     */
    this.copy = function () {
        var oFilter;
        var i = 0;
        if (oLeftExpr === undefined) {
            return new sap.apf.core.utils.Filter(oMsgHandler);
        } else {
            oFilter = new sap.apf.core.utils.Filter(oMsgHandler, oLeftExpr);
            if (levelOp === undefined) {
                return oFilter;
            }
            for (i = 0; i < aRestExpr.length; i++) {
                if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
                    oFilter.addAnd(aRestExpr[i].copy());
                } else {
                    oFilter.addOr(aRestExpr[i].copy());
                }
            }
            return oFilter;
        }
    };
    /**
     * @description Determines, whether the filter is restricted to a single value.
     * @returns {boolean}
     */
    this.isRestrictedToSingleValue = function () {
        if (oLeftExpr === undefined || aRestExpr.length > 0) {
            return false;
        }
        if (oLeftExpr instanceof sap.apf.core.utils.FilterTerm && oLeftExpr.getOp() === sap.apf.core.constants.FilterOperators.EQ) {
            return true;
        }
        return false;
    };
    /**
     * @description Returns the number of terms.
     * @returns {number} number of terms
     */
    this.getNumberOfTerms = function () {
        if (oLeftExpr === undefined) {
            return 0;
        } else {
            return 1 + aRestExpr.length;
        }
    };
    /**
     * @description Test on equality of two filters. Two filters are identical, if they have the same filter terms connected with the same operators.
     * Commutative and associative law are considered.
     * @param {sap.apf.core.utils.Filter} oFilter to compare with
     * @returns {boolean} true  if filters are identical.
     */
    this.isEqual = function (oFilter) {
        if (this === oFilter) {
            return true;
        }
        if (oFilter === undefined) {
            return false; // never equal to a undefined
        }
        return (this.getHash() === oFilter.getHash());
    };
    /**
     * @description Compute hash for the filter object. Needed for compare with
     *              other filter
     * @param {number} iLevelOfExpression level in the expression structure.
     * @returns {number} hashvalue Hash as number.
     */
    this.getHash = function (iLevelOfExpression) {
        var nCurrentLevel = iLevelOfExpression || 1;
        var nNextLevel = 0;
        if (aRestExpr.length === 0) {
            nNextLevel = nCurrentLevel;
        } else {
            nNextLevel = nCurrentLevel + 1;
        }
        if (oLeftExpr === undefined) {
            return 0;
        }
        var iHash = oLeftExpr.getHash(nNextLevel);
        var i;
        if (levelOp === undefined) {
            return iHash;
        } else if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
            iHash = iHash + Math.pow(2, nCurrentLevel); // hash for and on this level = 2,4,8
        } else if (levelOp === sap.apf.core.constants.BooleFilterOperators.OR) {
            iHash = iHash + Math.pow(3, nCurrentLevel); // = hash + 3,9,27,,...
        }
        for (i = 0; i < aRestExpr.length; i++) {
            iHash = iHash + aRestExpr[i].getHash(nNextLevel);
        }
        return iHash;
    };
    /**
     * @description Filters the array aData according to the filter condition. It is expected, that aData is array in
     * json format.
     * @param {object[]} aData Array in json format (value : prop).
     * @returns {object[]} aFilteredData Array in json format with filtered values.
     */
    this.filterArray = function (aData) {
        var aFilteredData = [];
        var i;
        var j = 0;
        var len = aData.length;
        if (len === 0) {
            return aFilteredData;
        }
        var bContained = false;
        // determine which properties have to be filtered
        var aFilterProperties = this.getProperties();
        var aDataPropertiesToTest = [];
        for (var oProp in aData[0]) {
            if (jQuery.inArray(oProp, aFilterProperties) > -1) {
                aDataPropertiesToTest.push(oProp);
            }
        }
        // nothing to be filtered
        if (aDataPropertiesToTest.length === 0) {
            return aData;
        }
        // filter against the relevant properties
        for (i = 0; i < len; i++) {
            bContained = true;
            for (j in aDataPropertiesToTest) {
                oProp = aDataPropertiesToTest[j];
                if (this.contains(oProp, aData[i][oProp]) === false) {
                    bContained = false;
                    break;
                }
            }
            if (bContained) {
                aFilteredData.push(aData[i]);
            }
        }
        return aFilteredData;
    };
    /**
     * @description Get all terms for a filter per property.
     * @param {string} property
     *            This is the property, for which the terms are requested
     * @returns {sap.apf.core.utils.FilterTerm[]} filterTerms An array with filter terms.
     */
    this.getFilterTermsForProperty = function (property) {
        var aTerm = [];
        var i;
        if (oLeftExpr === undefined) {
            return aTerm;
        }
        if (oLeftExpr instanceof sap.apf.core.utils.Filter) {
            aTerm = oLeftExpr.getFilterTermsForProperty(property);
        } else if (property === oLeftExpr.getProperty()) {
            aTerm.push(oLeftExpr);
        }
        for (i = 0; i < aRestExpr.length; i++) {
            if (aRestExpr[i] instanceof sap.apf.core.utils.FilterTerm) {
                if (property === aRestExpr[i].getProperty()) {
                    aTerm.push(aRestExpr[i]);
                }
            } else {
                aTerm = aTerm.concat(aRestExpr[i].getFilterTermsForProperty(property));
            }
        }
        return aTerm;
    };
    this.getFilterTerms = function () {
        var aTerm = [];
        var i;
        if (oLeftExpr === undefined) {
            return aTerm;
        }
        if (oLeftExpr instanceof sap.apf.core.utils.Filter) {
            aTerm = oLeftExpr.getFilterTerms();
        } else {
            aTerm.push(oLeftExpr);
        }
        for (i = 0; i < aRestExpr.length; i++) {
            if (aRestExpr[i] instanceof sap.apf.core.utils.FilterTerm) {
                aTerm.push(aRestExpr[i]);
            } else {
                aTerm = aTerm.concat(aRestExpr[i].getFilterTerms());
            }
        }
        return aTerm;
    };
    /**
     * @description This is a test, whether value is contained in the filter
     * @param {string} property
     *            This is either a single property or an array of properties.
     * @param {boolean|string|number} value
     *            This is either a value, if property is a single property or a
     *            json object with pairs property : value, if property is an
     *            array with properties.
     * @returns {boolean}
     */
    this.contains = function (property, value) {
        var bResult = false;
        var i = 0;
        if (oLeftExpr === undefined) {
            return true;
        }
        if (levelOp === undefined) {
            return oLeftExpr.contains(property, value);
        } else if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
            bResult = oLeftExpr.contains(property, value);
            if (bResult === false) {
                return false;
            }
            for (i = 0; i < aRestExpr.length; i++) {
                bResult = aRestExpr[i].contains(property, value);
                if (bResult === false) {
                    return false;
                }
            }
            return true;
        } else if (levelOp === sap.apf.core.constants.BooleFilterOperators.OR) {
            bResult = oLeftExpr.contains(property, value);
            if (bResult === true) {
                return true;
            }
            for (i = 0; i < aRestExpr.length; i++) {
                bResult = aRestExpr[i].contains(property, value);
                if (bResult === true) {
                    return true;
                }
            }
            return false;
        }
    };
    /**
     * @description Eliminates terms of the expression, that are defined for the
     *              property
     * @param {string} property
     *           This  is the property, for which the terms are. If property is an
     *            array, then the terms are removed for all properties.
     * @returns {sap.apf.core.utils.Filter} oFilterExpression This is the filter without
     *          filter terms on property
     */
    this.removeTermsByProperty = function (property) {
        var i, oResultFilter, oReducedRestFilter;
        if (oLeftExpr === undefined) {
            return this.copy();
        }
        oResultFilter = oLeftExpr.removeTermsByProperty(property);
        if (oResultFilter instanceof sap.apf.core.utils.FilterTerm) {
            oResultFilter = new sap.apf.core.utils.Filter(oMsgHandler, oResultFilter.getProperty(), oResultFilter.getOp(), oResultFilter.getValue(), oResultFilter.getHighValue());
        }
        if (levelOp === undefined) {
            return oResultFilter;
        }
        for (i = 0; i < aRestExpr.length; i++) {
            oReducedRestFilter = aRestExpr[i].removeTermsByProperty(property);
            if (oResultFilter === undefined) {
                if (oReducedRestFilter instanceof sap.apf.core.utils.FilterTerm) {
                    oResultFilter = new sap.apf.core.utils.Filter(oMsgHandler, oReducedRestFilter);
                } else {
                    oResultFilter = oReducedRestFilter;
                }
            } else if (oReducedRestFilter !== undefined) {
                if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
                    oResultFilter.addAnd(oReducedRestFilter);
                } else {
                    oResultFilter.addOr(oReducedRestFilter);
                }
            }
        }
        if (oResultFilter) {
            return new sap.apf.core.utils.Filter(oMsgHandler, oResultFilter);
        }
    };
    /**
     * @description Eliminates terms of the expression, that are defined for the
     *              property
     * @param {string} property
     *            This is the property, for which the terms are. If property is an
     *            array, then the terms are removed for all properties.
     * @param {string} option
     * @param {string|boolean|value} value
     * @returns {sap.apf.core.utils.Filter} oFilterExpression This is the filter expression without
     *          filter terms on property.
     */
    this.removeTerms = function (property, option, value) {
        var i;
        if (oLeftExpr === undefined) {
            return this.copy();
        }
        var oFilter = oLeftExpr.removeTerms(property, option, value);
        var oFilter2;
        if (oFilter instanceof sap.apf.core.utils.FilterTerm) {
            oFilter = new sap.apf.core.utils.Filter(oMsgHandler, oFilter.getProperty(), oFilter.getOp(), oFilter.getValue(), oFilter.getHighValue());
        }
        if (levelOp === undefined) {
            return oFilter;
        }
        for (i = 0; i < aRestExpr.length; i++) {
            oFilter2 = aRestExpr[i].removeTerms(property, option, value);
            if (oFilter === undefined) {
                if (oFilter2 instanceof sap.apf.core.utils.FilterTerm) {
                    oFilter = new sap.apf.core.utils.Filter(oMsgHandler, oFilter2);
                } else {
                    oFilter = oFilter2;
                }
            } else if (oFilter2 !== undefined) {
                if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
                    oFilter.addAnd(oFilter2);
                } else {
                    oFilter.addOr(oFilter2);
                }
            }
        }
        return oFilter;
    };
    /**
     * @description add a new filter connected with OR
     * @param {string|sap.apf.core.utils.Filter|sap.apf.core.utils.FilterTerm} arg1 -
     *            Filter or filter term or property.
     * @param {string} [arg2] operator, This makes only sense, if first argument is a property
     * @param {boolean|string|number} [arg3] Value, if first argument is property and second argument is operator
     * @returns {sap.apf.core.utils.Filter} this For method chaining.
     */
    this.addOr = function (arg1, arg2, arg3) {
        var oFilter;
        if (arg1 instanceof sap.apf.core.utils.Filter || arg1 instanceof sap.apf.core.utils.FilterTerm) {
            oFilter = arg1;
        } else if (arg1 !== undefined && arg2 !== undefined && arg3 !== undefined) {
            oFilter = new sap.apf.core.utils.FilterTerm(oMsgHandler, arg1, arg2, arg3);
        } else {
            oMsgHandler.check(false, "sap.apf.core.utils.Filter.addOr: wrong arguments in construction of  Filter");

        }
        if (oLeftExpr === undefined) {
            oLeftExpr = oFilter;
            return that;
        }
        if (levelOp === undefined) {
            levelOp = sap.apf.core.constants.BooleFilterOperators.OR;
        }
        aRestExpr.push(oFilter);
        oMsgHandler.check(levelOp === sap.apf.core.constants.BooleFilterOperators.OR, "sap.apf.core.utils.Filter - addOr wrong operation");
        return that;
    };
    /**
     * @description Add a new filter expression connected with AND
     * @param {string|sap.apf.core.utils.Filter|sap.apf.core.utils.FilterTerm} arg1 - Filter or filter term or property.
     * @param {string} [arg2] operator, This makes only sense, if first argument is a property
     * @param {boolean|string|number} [arg3] Value, if first argument is property and second argument is operator
     * @returns {sap.apf.core.utils.Filter} this For method chaining.
     */
    this.addAnd = function (arg1, arg2, arg3) {
        var oFilter;
        if (arg1 instanceof sap.apf.core.utils.Filter || arg1 instanceof sap.apf.core.utils.FilterTerm) {
            oFilter = arg1;
        } else if (arg1 !== undefined && arg2 !== undefined && arg3 !== undefined) {
            oFilter = new sap.apf.core.utils.FilterTerm(oMsgHandler, arg1, arg2, arg3);
        } else {
            oMsgHandler.check(false, "sap.apf.core.utils.Filter.addAnd: wrong arguments in construction of  Filter");
        }
        if (oLeftExpr === undefined) {
            oLeftExpr = oFilter;
            return that;
        }
        if (levelOp === undefined) {
            levelOp = sap.apf.core.constants.BooleFilterOperators.AND;
        }
        oMsgHandler.check(levelOp === sap.apf.core.constants.BooleFilterOperators.AND, "sap.apf.core.utils.Filter - addAnd wrong operation");
        aRestExpr.push(oFilter);
        return that;
    };
    /**
     * @description Transforms the filter into parameters for the URL in
     *              odata format suitable for xs engine
     * @param conf configuration object.
     * @param conf.asFilterArray then all properties are returned in a single line per property
     * @param conf.formatValue callback function for correct rendering of the value. The callback function is called with
     * property and value.
     * @returns {string|string[]} string or array - dependence on conf
     *
     */
    this.toUrlParam = function (conf) {
        var bAsArray = false;
        var aParam = [];
        var sExpr = "";
        if (conf !== undefined && conf.asFilterArray === true) {
            bAsArray = true;
        }
        if (oLeftExpr === undefined) {
            if (bAsArray === true) {
                return [];
            } else {
                return "";
            }
        }
        if (bAsArray === true) {
            aParam = oLeftExpr.toUrlParam(conf);
        } else {
            sExpr = oLeftExpr.toUrlParam(conf);
        }
        var i = 0;
        var len = aRestExpr.length;
        var sConnector = "";
        if (len === 0) {
            if (bAsArray === true) {
                return aParam;
            } else {
                return sExpr;
            }
        }
        if (levelOp === sap.apf.core.constants.BooleFilterOperators.AND) {
            sConnector = cLogicalAndText;
        } else {
            sConnector = cLogicalOrText;
        }
        var sRest = "";
        if (bAsArray === true) {
            for (i = 0; i < len; i++) {
                aParam = aParam.concat(aRestExpr[i].toUrlParam(conf));
            }
            return aParam;
        }
		for(i = 0; i < len; i++) {
			sRest = aRestExpr[i].toUrlParam(conf);
			if (sExpr === "") {
				sExpr = sRest;
			} else if (sRest !== "") {
				sExpr = sExpr + sConnector + sRest;
			}
		}
		return '(' + sExpr + ')';
        
    };
    /**
     * @description map a filter object to a JSON like selection variant object for OpenIn
     * @returns {object}
     */    
    this.mapToSelectionVariant = function(){
    	
    	oMsgHandler.check(levelOp === sap.apf.core.constants.BooleFilterOperators.AND, "sap.apf.core.utils.Filter.mapToSelectionVariant: filter structure too complex");
    	
    	var result = { operator : sap.apf.core.constants.BooleFilterOperators.AND, terms : [] };
    	this._getAndFilterTermsForSelectionVariant().forEach(function(expression){
    	  result.terms.push(expression._mapOrFilterToSelectionVariant());
    	});
    	return result;
    };
    /**
     * @description map an Or filter to a JSON like selection variant object for OpenIn
     * @returns {object}
     */
    this._mapOrFilterToSelectionVariant = function(){
     
      if(aRestExpr.length > 0){
    	 oMsgHandler.check(levelOp === sap.apf.core.constants.BooleFilterOperators.OR, "sap.apf.core.utils.Filter._mapOrFilterToSelectionVariant: filter structure too complex");  
      }
    	       
      var terms = [];
      getAllExpressions().forEach(function(expression){
     		if(expression.type==="filterTerm"){
    			terms.push(expression);
    		}else{
    			Array.prototype.push.apply(terms, expression._getOrFilterTermsForSelectionVariant(expression));
    		}
      });
      
      if(terms.length > 0){
      var firstProperty = terms[0].getProperty(); 
      }
      terms.forEach(function(term){
    	  oMsgHandler.check(term.getProperty() === firstProperty, "sap.apf.core.utils.Filter._mapOrFilterToSelectionVariant: filter structure too complex");
      });
      
      var result = { property : firstProperty, operator : sap.apf.core.constants.BooleFilterOperators.OR, expressions : []};
      terms.forEach(function(term){
    	  result.expressions.push(term.mapToSelectionVariant());
      });
      
      return result;
      
    };
    /**
     * creates an object, that is similar to the sap.ui5.model.Filter
     */
    this.mapToSapUI5FilterExpression = function() {
    	var i, expression, aFilters = [];
    	if (oLeftExpr === undefined) {
    		return {};
    	}
    	if (aRestExpr.length === 0) {
    		return oLeftExpr.mapToSapUI5FilterExpression();
    	} else {
    		aFilters.push(oLeftExpr.mapToSapUI5FilterExpression());
    		for (i = 0; i < aRestExpr.length; i++) {
    			aFilters.push(aRestExpr[i].mapToSapUI5FilterExpression());
    		}
    		expression = { filters : aFilters, and : (levelOp === sap.apf.core.constants.BooleFilterOperators.AND)}
    	} 
    	return expression;
    }
    /**
     * @description reduce the current filter to a list of filterTerms connected by Or, if possible
     * @returns {object[]}
     */
    this._getOrFilterTermsForSelectionVariant = function(){
    	var result = [];
    	if(aRestExpr.length > 0){
        	 oMsgHandler.check(levelOp === sap.apf.core.constants.BooleFilterOperators.OR, "sap.apf.core.utils.Filter._getOrFilterTermsForSelectionVariant: filter structure too complex");  
        }
    	getAllExpressions().forEach(function(expression){
    		if(expression.type==="filterTerm"){
    			result.push(expression);
    		}else{
    			Array.prototype.push.apply(result, expression._getOrFilterTermsForSelectionVariant());
    		}
    	});
    	return result;
    };
    /**
     * @description reduce the current filter to a list of expressions connected by And, if possible
     * @returns {object[]}
     */
    this._getAndFilterTermsForSelectionVariant = function(){
    	var result = [];
    	if(aRestExpr.length > 0 && levelOp !== sap.apf.core.constants.BooleFilterOperators.AND){
    	 result.push(this);
    	 return result;
    	}  
    	getAllExpressions().forEach(function(expression){
    		if(expression.type==="filterTerm"){
    			result.push(expression);
    		}else{
    			Array.prototype.push.apply(result, expression._getAndFilterTermsForSelectionVariant());
    		}
    	});
    	return result;
    };
    /**
     * @description Overwrites properties and adds new properties if they are not already existing
     *  with new properties or/and properties, which overwrite the current ones.
     * @param {sap.apf.core.utils.Filter} oFilter Filter, that holds the properties for the overwriting.
     * @returns {sap.apf.core.utils.Filter} merged filter object
     */
    this.overwriteWith = function (oFilter) {
        var aPropertyNames = oFilter.getProperties();
        var oResultFilter;
        if (aPropertyNames.length !== 0) {
            oResultFilter = this.removeTermsByProperty(aPropertyNames);
            if (oResultFilter === undefined) {
                return oFilter.copy();
            }
            oResultFilter.addAnd(oFilter);
            return oResultFilter;
        } 
        return this.copy();
    };

    /**
     * @description renames properties in a filter
     * @param {mapping[]} aMapping the mapping directive has the form
     * { source : 'sourceProp', target : 'targetProp' }
     * @returns undefined
     */
    this.mapProperties = function(aMapping) {

		var i = 0;
		if (oLeftExpr === undefined) {
			return undefined;
		}
		oLeftExpr.mapProperties(aMapping);
		if (levelOp === undefined) {
			return;
		}
		for(i = 0; i < aRestExpr.length; i++) {
			aRestExpr[i].mapProperties(aMapping);
		}

	};

    /**
     * @description removes all properties from the filter, that have not been requested
     * @param {} requested properties: Can be a single string for a single property, a list of parameters for single properties or an array of property strings
     * @returns new filter object which has only the requested properties
     */
    this.reduceToProperty = function (/* sProperty | sProperty1, sProperty2, ... | aProperty */) {

        var aProperty = [];
        var oProperty;

        //Handle different call types
        switch (arguments.length) {
            case 1:
                oProperty = arguments[0];
                if (oProperty instanceof Array) {
                    aProperty = oProperty;
                }                              //Call type III
                else {
                    aProperty.push(oProperty);
                }                          //Call type I
                break;
            default:
                aProperty = Array.prototype.slice.call(arguments, 0);  //Call type II
        }

        var aFilterPropertiesToBeRemoved = SetAminusSetB(this.getProperties(), aProperty);
        //in case all terms are removed method 'removeTermsByProperty()' returns 'undefined', so we will need the OR part:
        return this.copy().removeTermsByProperty(aFilterPropertiesToBeRemoved) || new sap.apf.core.utils.Filter(oMsgHandler);

        function SetAminusSetB(aSetA, aSetB) {
            var i;
            var result = [];
            var hashB = {};
            var lengthA = aSetA ? aSetA.length : 0;
            var lengthB = aSetB ? aSetB.length : 0;
            for (i = 0; i < lengthB; i++) {
                hashB[aSetB[i]] = undefined;
            }
            for (i = 0; i < lengthA; i++) {
                if (!(aSetA[i] in hashB)) {
                    result.push(aSetA[i]);
                }
            }
            return result;
        }
    };
    
    function getAllExpressions(){
   	 var expressions = [];
   	 if (oLeftExpr === undefined) {
   	  return expressions;
   	 }
     expressions.push(oLeftExpr);
     aRestExpr.forEach(function(expression){
  	  expressions.push(expression);
     });
     return expressions;
   };
   
};
/**
 * @private
 * @description Static function to create a filter object from array with
 *              objects (in json notation) with given properties. Example:
 *              aProperties = [country, city], data = [ { country: 'a', city:
 *              'a1' }, { country: 'b', city: 'b1' }]. This gives: (country =
 *              'a' and city = 'a1') or (country = 'b' and city = 'b1')
 * @param {sap.apf.core.MessageHandler} oMsgHandler
 * @param {string[]} aProperties
 *            Array with properties
 * @param {object[]} aData
 *            Array with data in json format fieldname : value.
 * @param {number[]} aIndices indices that indicate, which data line is selected
 * @static
 */
sap.apf.core.utils.Filter.createFromArray = function (oMsgHandler, aProperties, aData, aIndices) {
    oMsgHandler.check(aProperties instanceof Array && aProperties.length > 0, "sap.apf.core.utils.Filter.createFromArray incorrect argument aProperties");
    oMsgHandler.check(aData instanceof Array, "sap.apf.core.utils.Filter.createFromArray incorrect argument aData");
    if (aIndices.length > 0) {
        var fLen = aProperties.length;
        var i;
        var nLine;
        var j;
        var oFilterData;
        var oFilterLine;
        var oFilter;
        for (i in aIndices) {
            oFilterLine = undefined;
            nLine = aIndices[i];
            if (!aData[nLine]) {
                continue;
            }
            for (j = 0; j < fLen; j++) {
                oFilter = new sap.apf.core.utils.Filter(oMsgHandler, aProperties[j], sap.apf.core.constants.FilterOperators.EQ, aData[nLine][aProperties[j]]);
                if (oFilterLine === undefined) {
                    oFilterLine = new sap.apf.core.utils.Filter(oMsgHandler, oFilter);
                } else {
                    oFilterLine.addAnd(oFilter);
                }
            }
            if (oFilterData === undefined) {
                oFilterData = new sap.apf.core.utils.Filter(oMsgHandler, oFilterLine);
            } else {
                oFilterData.addOr(oFilterLine);
            }
        }
        return oFilterData;
    } 
    // return an empty filter in case of empty selection
    return new sap.apf.core.utils.Filter(oMsgHandler);
};
/**
 * @private
 * @description Static function to create a filter object that shall express a contradiction
 *   and lead to an empty data response.
 * @param {sap.apf.core.MessageHandler} oMsgHandler
 * @param {string[]} aProperties  property names for the filter.
 * @returns {sap.apf.core.utils.Filter}
 * @static
 */
sap.apf.core.utils.Filter.createEmptyFilter = function (oMsgHandler, aProperties) {
    oMsgHandler.check(jQuery.isArray(aProperties) && aProperties.length > 0, "sap.apf.core.utils.Filter.createEmptyFilter - array with property names expected");
    return new sap.apf.core.utils.Filter(oMsgHandler, aProperties[0], sap.apf.core.constants.FilterOperators.EQ, '').addAnd(aProperties[0], sap.apf.core.constants.FilterOperators.NE, '');
};

}; // end of sap/apf/core/utils/filter.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.textPool') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

jQuery.sap.declare("sap.apf.modeler.core.textPool");


jQuery.sap.require('sap.ui.core.format.DateFormat'); // unlisted dependency retained

(function() {
	'use strict';

	/**
	 * @private 
	 * @description holds all texts of an application, that are used in the analytical configurations
	 * @class TextPool
	 * @param {object} inject Injection of required APF objects
	 * @param {object} inject.instance  Injection of required instances
	 * @param {object} inject.instance.messageHandler Injection of messageHandler instance
	 * @param {object} inject.instance.persistenceProxy Injection of persistenceProxy instance
	 * @param {object} inject.constructor  Injection of required constructors
	 * @param {object} inject.constructor.hashtable  Injection of hashtable constructor 
	 * @param {string} applicationId is the guid of the application
	 * @param {object[]} existingTexts that have been fetched from DB
	 */
	sap.apf.modeler.core.TextPool = function(inject, applicationId, existingTexts) {

		var messageHandler = inject.instance.messageHandler;
		var persistenceProxy = inject.instance.persistenceProxy;

		var Hashtable = inject.constructor.hashtable;

		var hashTableForTexts = new Hashtable(messageHandler);
		var keyMappingTable = new Hashtable(messageHandler);
		var guidMappingTable = new Hashtable(messageHandler);
		var bFormatInformationIsMissing;
		var keyCounter = 0;
		var defaultInitialTextElement = {
				TextElement : sap.apf.core.constants.textKeyForInitialText,
				Language : sap.apf.core.constants.developmentLanguage,
				TextElementType : "XFLD",
				TextElementDescription : "",
				MaximumLength : 10,
				Application : applicationId,
				TranslationHint : ""
		};

		function findExistingTextElement(textElementDescription, format) {
			var keys = hashTableForTexts.getKeys();
			var i, len = keys.length;
			var maximumLength = format.MaximumLength || 10;
			var translationHint = format.TranslationHint || "";
			var textElement;
			
			for (i = 0; i < len; i++) {
				textElement = hashTableForTexts.getItem(keys[i]);
				if ((textElement.TextElementDescription === textElementDescription) &&
					(textElement.MaximumLength === maximumLength) &&
					(textElement.TranslationHint === translationHint)) {
					return keys[i];
				}
			}
			return undefined;
		}
		
		function renderHeaderOfTextPropertyFile() {

			var translationUuid = applicationId.toLowerCase();
			var checkValidFormatRegex = /^[0-9a-f]+$/;
			var isValid = checkValidFormatRegex.test(translationUuid);

			if (!isValid || applicationId.length !== 32) {
				messageHandler.putMessage(messageHandler.createMessageObject({
					code : "11009",
					aParameters : [ applicationId ]
				}));

				translationUuid = "<please enter valid translation uuid, if you want to upload into a SAP translation system>";
			} else {
				translationUuid = translationUuid.substring(0, 8) + '-' + translationUuid.substring(8, 12) + '-' + translationUuid.substring(12, 16) + '-' + translationUuid.substring(16, 20) + '-' + translationUuid.substring(20);
			}

			return "#FIORI: insert Fiori-Id\n" + "# __ldi.translation.uuid=" + translationUuid + "\n" + "#ApfApplicationId=" + applicationId + "\n\n";
		}

		/*
		 * #Kind,length:hint
		 * TextElement=TextElementDescription
		 */
		function renderEntryOfTextPropertyFile(textData) {
			var dateString, oDate;
			
			if (!bFormatInformationIsMissing && (!textData.TextElementType || !textData.MaximumLength)) {
				bFormatInformationIsMissing = true;
				messageHandler.putMessage(messageHandler.createMessageObject({
					code : "11008",
					aParameters : [ textData.TextElement ]
				}));

			}
			var entry = "#" + (textData.TextElementType || "<Add text type>") + "," + ( textData.MaximumLength || "<Add maximum length>");
		
			if (textData.TranslationHint && textData.TranslationHint !== "") {
				entry = entry + ':' + textData.TranslationHint;
			}
			entry = entry + "\n" + textData.TextElement + "=" + textData.TextElementDescription + "\n";
			
			var oDateFormat = sap.ui.core.format.DateFormat.getDateTimeInstance({pattern: "yyyy/MM/dd HH:mm:ss"});
			
			if (textData.LastChangeUTCDateTime && textData.LastChangeUTCDateTime !== "") {
				dateString = textData.LastChangeUTCDateTime.replace(/\/Date\(/,'').replace(/\)\//, '');
				oDate = new Date(parseInt(dateString,10));
				
			} else {
				 oDate = new Date();
			}
			entry = entry + "# LastChangeDate=" +  oDateFormat.format(oDate) + '\n\n';
			
			return entry;
		}
		
		/**
		 * @description delete texts from text pool
		 * @param {string[]} textElementKeys array with TextElements (keys) to be added
		 * @param {function} callback is called, when save is finished. Signature is fn( sap.apf.core.MessageObject )
		 */	
		this.removeTexts = function(textElementKeys, callback) {
			
			var batchRequests = [];
			var i, len;
			
			function callbackRemove(messageObject) {
				var j;
				if (!messageObject) {
					for (j = 0; j < len; j++) {
						hashTableForTexts.removeItem(textElementKeys[j]);
					}
				}
				callback(messageObject);
				
			}
					
			len = textElementKeys.length;	
			if (len === 0) {
				callback(undefined);
				return;
			}
		
			for (i = 0; i < len; i++) {
				if (textElementKeys[i] === sap.apf.core.constants.textKeyForInitialText) {
					continue;
				}
				batchRequests.push( { method : "DELETE", entitySetName : "texts", 
					inputParameters : [ {  name : 'TextElement', value : textElementKeys[i] }, { name : 'Language', value: sap.apf.core.constants.developmentLanguage } ] });
			}
			
			persistenceProxy.doChangeOperationsInBatch( batchRequests, callbackRemove);
		};
		
	    this.isInitialTextKey = function(textKey) {
	        	return (textKey === sap.apf.core.constants.textKeyForInitialText);
	    };
	       
		/**
		 * @description add texts to the text pool and save them
		 * @param {object[]} TextElements array with TextElements to be added
		 * @param {function} callback is called, when save is finished. Signature is fn( sap.apf.core.MessageObject )
		 */		
		this.addTextsAndSave = function(textElements, callback) {
			function areEqualTextElements(text1, text2){
		
				return (text1.TextElement === text2.TextElement && text1.TextElementDescription === text2.TextElementDescription &&
						text1.MaximumLength === text2.MaximumLength && text1.Language === text2.Language && text1.TranslationHint === text2.TranslationHint);
			}
			
		 
			var i;
			var len = textElements.length;
			var existingTextElement;
			var textElementsForUpdate = [];
			var textElementsForCreate = [];
			var changeRequests = [];
			var inputParameters;
			for (i = 0; i < len; i++) {
				if (textElements[i] === sap.apf.core.constants.textKeyForInitialText) {
					continue;
				}
				existingTextElement = hashTableForTexts.getItem(textElements[i].TextElement);
				if (existingTextElement) {
					if (!areEqualTextElements(existingTextElement,textElements[i])) {
						textElementsForUpdate.push(textElements[i]);
						hashTableForTexts.setItem(textElements[i].TextElement, textElements[i]);
					}
				} else {
					textElementsForCreate.push(textElements[i]);
					hashTableForTexts.setItem(textElements[i].TextElement, textElements[i]);
				}
			}
			len = textElementsForUpdate.length;
			for (i = 0; i < len; i++) {
				inputParameters = [ { name : 'TextElement', value : textElementsForUpdate[i].TextElement },
				                    { name : 'Language', value : textElementsForUpdate[i].Language }];
				
				textElementsForUpdate[i].MaximumLength = parseInt(textElementsForUpdate[i].MaximumLength, 10);
				changeRequests.push( { method : "PUT", entitySetName : "texts", data : textElementsForUpdate[i], inputParameters: inputParameters });
			}
			len = textElementsForCreate.length;
			for (i = 0; i < len; i++) {
				textElementsForCreate[i].MaximumLength = parseInt(textElementsForCreate[i].MaximumLength, 10);
				changeRequests.push( { method : "POST", entitySetName : "texts", data : textElementsForCreate[i] });
			}
			
			if (changeRequests.length > 0) {
				persistenceProxy.doChangeOperationsInBatch(changeRequests, callback);
			} else {
				callback(undefined);
			}
			
		};
		
		/**
		 * @description creates a .property file, that suffices the SAP translation format
		 * @returns {string} textPropertyFile
		 */
		this.exportTexts = function() {
			var textPropertyFile = renderHeaderOfTextPropertyFile();
			var i, length;
			
			bFormatInformationIsMissing = false;
			
			var keys = hashTableForTexts.getKeys();

			keys.sort(function(a, b) {
				var valueA = hashTableForTexts.getItem(a);
				var valueB = hashTableForTexts.getItem(b);

				if (valueA.LastChangeUTCDateTime < valueB.LastChangeUTCDateTime) {
					return -1;
				}
				if (valueA.LastChangeUTCDateTime > valueB.LastChangeUTCDateTime) {
					return 1;
				}

				return 0;
			});

			length = keys.length;
			for(i = 0; i < length; i++) {

				textPropertyFile = textPropertyFile + renderEntryOfTextPropertyFile(hashTableForTexts.getItem(keys[i]));
			}
			return textPropertyFile;
		};

		/**
		 * gets the text for a given id
		 * @param {string} id either temporary or persistent id of the key.
		 * @returns {object} text
		 */
		this.get = function(id) {
			var databaseKey, notExistingTextElement;
			
			if (id === sap.apf.core.constants.textKeyForInitialText) {
				return defaultInitialTextElement;
			}
			if (hashTableForTexts.hasItem(id)) {
				return hashTableForTexts.getItem(id);
			}
			if (keyMappingTable.hasItem(id)) {
				databaseKey = keyMappingTable.getItem(id);
				if (databaseKey.TextElementDescription) {
					return databaseKey;
				}
				return hashTableForTexts.getItem(databaseKey);
			}
			notExistingTextElement = jQuery.extend({}, true, defaultInitialTextElement);
			notExistingTextElement.TextElement = id;
			notExistingTextElement.TextElementDescription = id;
			return notExistingTextElement; //finally no text was found
		};

		/**
		 * gets the database key (guid) of a text for a given id
		 * @param {string} id either temporary or persistent id (guid) of the key.
		 * @returns {string} textElement
		 */
		this.getPersistentKey = function(id) {

			return id;
		};
		/**
		 * @param {string} textElementDescription : "TITLE",
		 * @param {Object} format
		 * @param {string} format.TextElementType  example title TITLE",
		 * @param {number} format.MaximumLength
		 * @param {string} format.TranslationHint
		 * @returns {string} key
		 */
		this.setText = function(textElementDescription, format) {
			var artificalKey;
			var textKey;
			var updateTextAndMappingTable = function(textData, metadata, messageObject) {

				if (messageObject) {
					messageHandler.putMessage(messageObject);
				}

				if (textData) {
					hashTableForTexts.setItem(textData.TextElement, textData);
					textKey = textData.TextElement;
					//replace the temporary data with key!
					//keyMappingTable.setItem(artificalKey, textData.TextElement);
					//guidMappingTable.setItem(textData.TextElement, artificalKey);
				}
			};
			var data = {
				TextElement : "", //key should be filled automatically
				Language : sap.apf.core.constants.developmentLanguage,
				TextElementType : format.TextElementType,
				TextElementDescription : textElementDescription,
				MaximumLength : format.MaximumLength || 10,
				Application : applicationId,
				TranslationHint : format.TranslationHint || ""
			};

			if (!textElementDescription) {
				return sap.apf.core.constants.textKeyForInitialText;
			}
			textKey = findExistingTextElement(textElementDescription, format);
			if (textKey) {
				return textKey;
			}
			keyCounter++;
			artificalKey = "textKey" + keyCounter;

			// temporary set the data. this will be replaced, when creation on server succeeded;
			//this lives as long, as server request is not returned
			//keyMappingTable.setItem(artificalKey, 'UNMAPPED');
			persistenceProxy.create('texts', data, updateTextAndMappingTable, false);
			//return artificalKey;
			return textKey;
		};
		/**
		 * returns an array with keys of all texts of given
		 * @param {string} textElementType - optional
		 * @returns {string[]} array with text keys
		 */
		this.getTextKeys = function(textElementType) {
			var keys = hashTableForTexts.getKeys();
			var i, text, len = keys.length;
			var textKeys = [];

			for(i = 0; i < len; i++) {
				text = hashTableForTexts.getItem(keys[i]);

				if (textElementType && text.TextElementType !== textElementType) {
					continue;
				}	
				
				if (guidMappingTable.hasItem(keys[i])) {
					textKeys.push(guidMappingTable.getItem(keys[i]));
				} else {
					textKeys.push(keys[i]);
				}

			}
			return textKeys;
		};

		/**
		 * return all texts with properties TextElement and TextElementDescription for given TextElementType and MaximumLength
		 * @param {string} textElementType
		 * @param {number} maximumLength
		 * @returns {object[]} textElements
		 */
		this.getTextsByTypeAndLength = function(textElementType, maximumLength) {
			var keys = hashTableForTexts.getKeys();
			var i, text, len = keys.length;
			var textElements = [];

			for(i = 0; i < len; i++) {
				text = hashTableForTexts.getItem(keys[i]);

				if (text.TextElementType === textElementType && text.MaximumLength === maximumLength) {
					if (guidMappingTable.hasItem(keys[i])) {
						textElements.push({
							TextElement : guidMappingTable.getItem(keys[i]),
							TextElementDescription : text.TextElementDescription
						});
					} else {
						textElements.push({
							TextElement : keys[i],
							TextElementDescription : text.TextElementDescription
						});
					}

				}
			}
			return textElements;
		};

		function initialize() {
			var i, len;

			len = existingTexts.length;
			for(i = 0; i < len; i++) {
				hashTableForTexts.setItem(existingTexts[i].TextElement, existingTexts[i]);
			}
		}

		initialize();
	};

}());

}; // end of sap/apf/modeler/core/textPool.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.ui.controller.configurationList.controller') ) {
  jQuery.sap.declare('sap.apf.modeler.ui.controller.configurationList.controller');
/*!
* SAP APF Analysis Path Framework
*
* (c) Copyright 2012-2014 SAP SE. All rights reserved
*/
/* globals window */




sap.ui.controller("sap.apf.modeler.ui.controller.configurationList", {
	onInit : function() {
		var oSelf = this;
		var oComponent = this.getOwnerComponent();
		if (oComponent !== undefined) {
			this.oCoreApi = oComponent.oCoreApi;
			this._setDisplayText();
		}
		this._instantiateToolbarView();
		this._instantiateAPFTree();
		this._instantiateTitleAndBreadCrumbView();
		this._addConfigStyleClass();
		this.oModel = new sap.ui.model.json.JSONModel({
			aConfigDetails : []
		});
		this.getView().setModel(this.oModel);
		this.bProgramaticSelection = false;
		//Attach router pattern match injects respective sub views based on url route mapping
		sap.apf.modeler.ui.utils.APFRouter.patternMatch(this);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_instantiateToolbarView
	 * @description Instantiates and injects toolbar view in configurationList view
	 * */
	_instantiateToolbarView : function() {
		var toolbarView = new sap.ui.view({
			viewName : "sap.apf.modeler.ui.view.toolbar",
			type : "XML",
			viewData : {
				oConfigListInstance : this
			}
		});
		this.toolbarController = toolbarView.getController();
		this.byId("idConfigMasterData").insertItem(toolbarView, 0);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_instantiateAPFTree
	 * @description Creates instance of custom APFTree control and calls property setters of custom APFTree control
	 * */
	_instantiateAPFTree : function() {
		this.oTreeInstance = this.byId("idConfigTree");
		this.oTreeInstance.setTranslationFunction(this.oCoreApi.getText);
		var sDefaultRepresentationType;
		if (this.oCoreApi.getRepresentationTypes()[0].metadata) {
			sDefaultRepresentationType = this.oCoreApi.getRepresentationTypes()[0].id;
		}
		this.oTreeInstance.setDefaultRepresentationType(sDefaultRepresentationType);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_instantiateTitleAndBreadCrumbView
	 * @description Instantiates and injects titleand BreadCrumb in configurationList view
	 * */
	_instantiateTitleAndBreadCrumbView : function() {
		this.oTitleBreadCrumbView = new sap.ui.view({
			viewName : "sap.apf.modeler.ui.view.titleBreadCrumb",
			type : "XML",
			viewData : {
				getText : this.oCoreApi.getText
			}
		});
		this.oTitleBreadCrumbController = this.oTitleBreadCrumbView.getController();
		this.byId("idConfigDetail").insertItem(this.oTitleBreadCrumbView, 0);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#setConfigListMasterTitle
	 * @param {String} String that has to be set as the title on master content of configuration list view
	 * @description Setter to set title to the configuration list view master content
	 * */
	setConfigListMasterTitle : function(sTitle) {
		this.byId("idConfigTitleMaster").setText(this.oCoreApi.getText("configurationObjectTitle") + " : " + sTitle);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#onAfterRendering
	 * @description After rendering of the view sets height to the tree
	 * */
	onAfterRendering : function() {
		var self = this;
		this.oTreeInstance.onAfterRendering = function() {
			self._setHeightForTree();
		};
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_setHeightForTree
	 * @params {Object} Tree Instance
	 * @description Sets height to the tree
	 * */
	_setHeightForTree : function() {
		var self = this;
		var oViewInstance = this;
		var oTreeInstance = this.oTreeInstance;
		var width = jQuery(oViewInstance.byId("idConfigMasterData").getDomRef()).width();
		var height = jQuery(window).height();
		var textContainer = 60; //Static Height for text container because the text gets rendered after AJAX request
		var toolBar = jQuery(oViewInstance.byId("idConfigMasterData").getItems()[0].getDomRef()).height();
		var header = jQuery(oViewInstance.byId("configPage").getDomRef()).find("header").height();
		var footer = jQuery(oViewInstance.byId("configPage").getDomRef()).find("footer").height();
		var offsetHeight;
		if(toolBar > 0){//Fall back if rendered DOM element has height defined as 0 or undefined
			offsetHeight = textContainer + toolBar + header + footer;
		}
		else{
			offsetHeight = 205; //Setting constant calculated value(165 for header and 40 for footer)
		}
		//set initial height and width for config tree control
		oTreeInstance.setHeight(height - offsetHeight + "px");
		oTreeInstance.setWidth(width + "px");
		sap.apf.modeler.ui.utils.helper.onResize(function() {//on resize handle height and width accordingly by passing its parent dom reference
			width = jQuery(oViewInstance.byId("idConfigMasterData").getDomRef()).width();
			height = jQuery(oViewInstance.byId("configPage").getDomRef()).height();
			oTreeInstance.setHeight(height - offsetHeight + "px");
			oTreeInstance.setWidth(width + "px");
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_setDisplayText
	 * @description Sets texts for page title and save,cancel,export button 
	 * */
	_setDisplayText : function() {
		this.byId("configPage").setTitle(this.oCoreApi.getText("configModelerTitle"));
		this.byId("idSavebutton").setText(this.oCoreApi.getText("save"));
		this.byId("idCancelbutton").setText(this.oCoreApi.getText("cancel"));
		this.byId("idExportbutton").setText(this.oCoreApi.getText("export"));
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_addConfigStyleClass
	 * @description Adds style class to the page title, master and detail area
	 * */
	_addConfigStyleClass : function() {
		this.getView().addStyleClass("sapUiSizeCompact");//For non touch devices- compact style class increases the information density on the screen by reducing control dimensions
		this.byId("idConfigTree").addStyleClass("configTree");
		this.byId("idConfigTitleMaster").addStyleClass("configTitle");
		this.byId("idConfigMasterData").addStyleClass("configMasterData");
		this.byId("idConfigDetailData").addStyleClass("configDetailData");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_setSubViewContainerHeight
	 * @description Sets the height for the subview container
	 * @params Subview instance
	 * @returns Height of the subview container 
	 * */
	_setSubViewContainerHeight : function(oSubView) {
		var oSelf = this;
		var scrollContainer = oSubView.getContent()[0].getItems()[0];
		//height for the scroll container
		var height = jQuery(window).height();
		var textContainer = jQuery(this.byId("idConfigTitleMaster").getDomRef()).outerHeight() + jQuery(this.byId("idConfigTitleMaster").getDomRef()).offset().top;//height and the offset of the layout which contains breadcrumb and title of detail view
		var toolBar = jQuery(this.byId("idConfigMasterData").getItems()[0].getDomRef()).height();
		var header = jQuery(this.byId("configPage").getDomRef()).find("header").height();
		var footer = jQuery(this.byId("configPage").getDomRef()).find("footer").height();
		var offsetHeight;
		if(toolBar > 0){//Fall back if rendered DOM element has height defined as 0 or undefined
			offsetHeight = textContainer + toolBar + header + footer; 
		}
		else{
			offsetHeight = 265;//Setting constant calculated value(225 for header and 40 for footer)
		}
		var scrollContainerHeight = height - offsetHeight + "px";
		scrollContainer.setHeight(scrollContainerHeight);
		//width for the scroll container
		var width = jQuery(this.byId("configPage").getDomRef()).width();
		var detailPageWidth = jQuery(this.byId("idConfigDetailData").getDomRef()).width(); // width of config detail data page
		var offsetWidth = jQuery(this.byId("idConfigMasterData").getDomRef()).offset().left; //offset for the page
		var setWidth = detailPageWidth - offsetWidth;
		var scrollContainerWidth = setWidth + "px";
		scrollContainer.setWidth(scrollContainerWidth);
		sap.apf.modeler.ui.utils.helper.onResize(function() {//on resize handle height and width accordingly by passing its parent dom reference
			//height for the scroll container
			height = jQuery(oSelf.byId("configPage").getDomRef()).height();
			scrollContainerHeight = height - offsetHeight + "px";
			scrollContainer.setHeight(scrollContainerHeight);
			//width for the scroll container
			width = jQuery(oSelf.byId("configPage").getDomRef()).width();
			detailPageWidth = jQuery(oSelf.byId("idConfigDetailData").getDomRef()).width();
			setWidth = detailPageWidth - offsetWidth;
			scrollContainerWidth = setWidth + "px";
			scrollContainer.setWidth(scrollContainerWidth);
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_setSubView
	 * @param {Object} Subview instance 
	 * @description Sets the subview on navigation change 
	 * */
	_setSubView : function(oSubView) {
		this.oSubView = oSubView;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_getSubView
	 * @description Getter for current subview instance
	 * */
	_getSubView : function() {
		return this.oSubView;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateSubView
	 * @param {Object} URL context
	 * @description Injects the appropriate subview instance based on URL context change  
	 * */
	updateSubView : function(oParams) {
		var self = this;
		var oPrevSubView = this._getSubView();
		var oDetailView = this.byId("idConfigDetailData");
		var oValidURLContext = this.getSPathFromURL(oParams);
		// Destroying the previous sub-view if it exists.
		if (oPrevSubView) {
			oPrevSubView.destroy();
		}
		//Load the respective views for corresponding pattern names
		var oSubView = new sap.ui.view({
			viewName : "sap.apf.modeler.ui.view." + oValidURLContext.objectType,
			type : "XML",
			viewData : {
				oParams : oParams, //URL Params
				updateConfigTree : self.updateConfigTree.bind(self),
				updateSelectedNode : self.updateSelectedNode.bind(self),
				updateTitleAndBreadCrumb : self.updateTitleAndBreadCrumb.bind(self),
				updateTree : self.updateTree.bind(self),
				oConfigurationHandler : self.configurationHandler,
				oApplicationHandler : self.applicationHandler,
				oConfigurationEditor : self.configEditor,
				getText : self.oCoreApi.getText,
				getEntityTypeMetadata : self.oCoreApi.getEntityTypeMetadata,//required by representation subview 
				getRepresentationTypes : self.oCoreApi.getRepresentationTypes,//required by representation subview 
				oFooter : self.byId("idFooterBarMain"),//representation subview requires footer to insert and remove button 
				createMessageObject : self.oCoreApi.createMessageObject,//navigation target subview - message object creation required for failed call to INTEROP
				putMessage : self.oCoreApi.putMessage,//navigation target subview - message object creation required for failed call to INTEROP,
				getAllAvailableSemanticObjects : self.oCoreApi.getAllAvailableSemanticObjects,//navigation target subview : For getting list of semantic objects available
				getSemanticActions : self.oCoreApi.getSemanticActions
			//navigation target subview : For getting list of actions for a given semantic object
			}
		});
		if (oParams.name !== "applicationList") {
			oDetailView.removeAllContent(); //Remove All Previous Stacked View Content
			oSubView.placeAt(oDetailView); //Inject the view
			if (oDetailView.$().height() !== 0) { //Once Detail View is rendered then set scroll container height else retain the previous state
				this._setSubViewContainerHeight(oSubView);
			}
			this._setSubView(oSubView); //Set the sub view instance
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#clearTitleAndBreadCrumb
	 * @description Clears title and breadCrumb from the detail page
	 * */
	clearTitleAndBreadCrumb : function() {
		this.oTitleBreadCrumbView.byId("IdFormTitle").setText("");
		this.oTitleBreadCrumbView.byId("IdBreadCrumb").setText("");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateTitleAndBreadCrumb
	 * @param {String} Updated Title of the detail form
	 * @description Updates the title and breadcrumb of the detailpage
	 * */
	updateTitleAndBreadCrumb : function(sTitle) {
		var sFormTitle;
		var sBreadCrumb;
		var oSelectedNode = this.oTreeInstance.getSelection();
		var oSelectedNodeContext = oSelectedNode ? this.oTreeInstance.getNodeContext(oSelectedNode) : undefined;
		var nodeObjectType = oSelectedNodeContext ? oSelectedNodeContext.nodeObjectType : undefined;
		var oParentNodeContext = oSelectedNodeContext ? this.oTreeInstance.getParentNodeContext(oSelectedNodeContext) : undefined;
		//Update title
		if (sTitle) { //Updated title of node on handlechange from the subview
			sFormTitle = sTitle;
		} else { //text of the node
			if (nodeObjectType) {
				var text = oSelectedNode.getText();
				sFormTitle = this.oCoreApi.getText(nodeObjectType) + ": " + text;
			}
		}
		//Update BreadCrumb
		if (oParentNodeContext) {
			switch (nodeObjectType) { // based on the object type build the breadcrumb value
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
					sBreadCrumb = oParentNodeContext.configurationName;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
					sBreadCrumb = oParentNodeContext.configurationName + " > " + this.oCoreApi.getText("facetFilter") + " > " + oParentNodeContext.facetFilterName;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
					sBreadCrumb = oParentNodeContext.configurationName + " > " + this.oCoreApi.getText("category") + " > "+ oParentNodeContext.categoryName;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
					sBreadCrumb = oParentNodeContext.configurationName + " > " + oParentNodeContext.categoryName + " > " + oParentNodeContext.stepName;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
					sBreadCrumb = oParentNodeContext.configurationName + " > " + oParentNodeContext.categoryName + " > " + oParentNodeContext.stepName + " > " + oParentNodeContext.representationName;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
					sBreadCrumb = oParentNodeContext.configurationName + " > " + this.oCoreApi.getText("navigationTarget") + " > " + oParentNodeContext.navTargetName;
					break;
			}
		}
		this.oTitleBreadCrumbController.setTitleAndBreadCrumb(sFormTitle, sBreadCrumb);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#setSelectionOnTree
	 * @param {String} Binding context of the node which has to be shown selected in the tree
	 * @description Sets selection on the tree
	 * */
	setSelectionOnTree : function(sBindingContextOfSelectedNode) {
		this.toolbarController.enableCopyDeleteButton();
		this._enableExportButton();
		this.oTreeInstance.setSelectionOnTree(sBindingContextOfSelectedNode);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#removeSelectionOnTree
	 * @description Removes all selection from the tree
	 * */
	removeSelectionOnTree : function() {
		this.oTreeInstance.removeSelectionOnTree(this.selectedNode);
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateConfigTree
	 * @param {Object} Contains old and new context of the node which has to be updated in the tree
	 * @description Updates the tree when a category assigned to a step is changed
	 * */
	updateConfigTree : function(objectContexts) {//Set of step contexts and categories of steps
		var oldSPath, newSPath, aOldContextForSelectedNode, movedStepIndex, indexOfConfig, indexOfCategory, indexOfNewCategory, indexOfStep, existingStep, existingStepId;
		var self = this;
		objectContexts.forEach(function(oStepContext) {//For each step context, the step shall be added or removed in the category based on the removeStep boolean
			var bStepExists;
			oldSPath = self.getSPathFromURL(oStepContext.oldContext).sPath;
			aOldContextForSelectedNode = oldSPath.split("/");
			indexOfConfig = aOldContextForSelectedNode[2];
			indexOfCategory = aOldContextForSelectedNode[6];
			indexOfStep = aOldContextForSelectedNode[8];
			existingStep = jQuery.extend(true, {}, self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep]);
			existingStepId = existingStep.id;
			existingStep.isSelected = false;
			newSPath = self.getSPathFromURL(oStepContext.newContext).sPath;
			indexOfNewCategory = newSPath.split("/")[6];
			if (oStepContext.removeStep === undefined) {
				if (self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps) {
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps.forEach(function(step) {
						if (step.id === existingStepId) {
							bStepExists = true;
						}
					});
					if (bStepExists === undefined) {// If the step does not exist in the category it is added, else not added
						self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps.push(existingStep);
					}
				} else {//If there are no steps in the category, the step is added after creating the array steps
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps = [];
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps.push(existingStep);
				}
			} else if (oStepContext.removeStep === true) {// If the step exists in the category it is removed
				if (self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps) {
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps.forEach(function(step, index) {
						if (step.id === existingStepId) {
							var aStepsForCategory = self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps;
							var aStepToRemove = aStepsForCategory.splice(index, 1);
							self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfNewCategory].steps = aStepsForCategory;
						}
					});
					if (oStepContext.changeCategory === true) {// If the step is being removed from the present category, prepare context of the next category in which the step is present
						var categoryChangeSPath = self.getSPathFromURL(oStepContext.categoryChangeContext).sPath;
						var categoryChangeSelectedNodeContext = categoryChangeSPath.split("/");
						indexOfConfig = categoryChangeSelectedNodeContext[2];
						var indexOfChangedCategory = categoryChangeSelectedNodeContext[6];
						var indexOfNewStep = categoryChangeSelectedNodeContext[8];
						self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfChangedCategory].steps[indexOfNewStep].isSelected = true;
						self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfChangedCategory].expanded = true;
					}
				}
			}
		});
		this.oModel.updateBindings(); // Update the tree to reflect deletion or addition
		var noOfObjects = objectContexts.length;
		if (objectContexts[noOfObjects - 1].changeCategory) {
			sap.ui.core.UIComponent.getRouterFor(this).navTo(objectContexts[noOfObjects - 1].oldContext.name, objectContexts[noOfObjects - 1].categoryChangeContext.arguments);//If the step is being removed from the present category,, navigate to the next category in which the step is present
		}
		this.configEditor.setIsUnsaved();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateSelectedNode
	 * @param {Object} Label name and id of the node to be updated
	 * @param {Object} applicationId and temporary configuration id
	 * @description Updates node in the tree whenever title of node is changed from any of the detail subviews
	 * */
	updateSelectedNode : function(params, context) {
		if (params) {
			if (this.oTreeInstance.getSelection()) {
				this.selectedNode = this.oTreeInstance.getSelection();
			}
			if (this.selectedNode) {
				if (params.name && this.selectedNode.getBindingContext() && this.selectedNode.getBindingContext().getObject()) {
					this.selectedNode.getBindingContext().getObject().name = params.name;
					this.selectedNode.getBindingContext().getObject().isSelected = true;
					if (this.selectedNode.getBindingContext().getObject().type === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION) {
						this.selectedNode.getBindingContext().getObject().icon = params.icon;
					}
					this.oModel.updateBindings();
				}
				if (params.id && this.selectedNode.getBindingContext().getObject().id) {//if new object then update APF id for this in binding
					this.selectedNode.getBindingContext().getObject().id = params.id;
					if (this.selectedNode.getBindingContext().getObject().type === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION) {
						this.selectedNode.getBindingContext().getObject().icon = params.icon;
					}
				} else if (params.id && this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration) {
					this.selectedNode.getBindingContext().getObject().AnalyticalConfiguration = params.id;
					this.selectedNode.getBindingContext().getObject().expanded = true;
				}
			}
			if ((this.selectedNode.getBindingContext().getObject().type === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) && context) {
				sap.ui.core.UIComponent.getRouterFor(this).navTo(this.selectedNode.getBindingContext().getObject().type, context);
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#createConfigList
	 * @description Loads only list of all configurations in the tree
	 * */
	createConfigList : function() {//Loads only a list of configurations in the tree
		var self = this;
		this.configList = this.configurationHandler.getList();
		this.configList.forEach(function(config, index) {
			var oConfigDetails = {};
			oConfigDetails.AnalyticalConfiguration = config.AnalyticalConfiguration;
			oConfigDetails.name = config.AnalyticalConfigurationName;
			oConfigDetails.Application = config.Application;
			oConfigDetails.type = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;
			oConfigDetails.bIsLoaded = false; //boolean to check the creation of tree structure set to false
			oConfigDetails.bToggleState = false; // Toggle state boolean attached with each new node
			oConfigDetails.isSelected = false;
			oConfigDetails.expanded = false;
			oConfigDetails.selectable = true;
			oConfigDetails.hasExpander = true;
			self.oModel.getData().aConfigDetails.push(oConfigDetails);
		});
		this.oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#showNoConfigSelectedText
	 * @description Displays 'No COnfiguration Selected' text in detail area in case of multiple configurations
	 * */
	showNoConfigSelectedText : function() {
		this.byId("idConfigDetailData").removeAllContent(); //Remove All Previous Stacked Content from DOM
		this.clearTitleAndBreadCrumb();
		var noConfigSelected = new sap.m.Label().addStyleClass("noConfigSelected");
		noConfigSelected.setText(this.oCoreApi.getText("noConfigSelected"));
		noConfigSelected.placeAt(this.byId("idConfigDetailData"));
		this.toolbarController.disableCopyDeleteButton();
		this.disableExportButton();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateConfigListView
	 * @description In case of only one configuration loads it and sets as selected and in case of multiple configurations none is selected
	 * */
	updateConfigListView : function() {//In case of only one configuration; To load the configuration and set it as selected and In case of multiple configurations none selected
		this.selectedNode = this.oTreeInstance.getSelection();
		if (this.selectedNode === null) {//only case when first time coming from application list view otherwise there will always a node selected.
			if (this.configList.length > 1) { // if more than one configuration,show a message in detail area,no config selected
				this.showNoConfigSelectedText();
			} else { // If only one configuration, load the configuration and set selection and then expand the tree node by setting bExpand to true
				this.oModel.getData().aConfigDetails[0].isSelected = true;
				this.oModel.getData().aConfigDetails[0].expanded = true;
				this.configId = this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration;
				this.oModel.updateBindings();
				var context = {
					appId : this.appId,
					configId : this.oModel.getData().aConfigDetails[0].AnalyticalConfiguration
				};
				this.selectedNode = this.oTreeInstance.getNodes()[0];
				this.toolbarController.enableCopyDeleteButton();
				this._enableExportButton();
				sap.ui.core.UIComponent.getRouterFor(this).navTo(this.oModel.getData().aConfigDetails[0].type, context);
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_getNodeData
	 * @params {Object} params - id's of ancestor node to traverse through
	 * @params {String} type - define the node type like category, step etc
	 * @returns {Object} 
	 * 	nodeData {
	 * 			  index : index position of the node, 
	 * 			  id : unique id of the node passed, 
	 * 			  data : spliced model data of the node 
	 * 			 }  
	 * @description Returns the data which are relevant to the passed node
	 * */
	_getNodeData : function(params, type) {
		var configs = this.oModel.getData().aConfigDetails;
		var nodeData = {};
		var getConfigurationData = function(id) { //Get the configuration index
			var node = {};
			var configId = id || this.configId;
			for( var i = 0; i < configs.length; i++) {
				if (configs[i].AnalyticalConfiguration === configId) {
					node.index = i;
					node.data = configs[i];
					node.id = configs[i].AnalyticalConfiguration;
					break;
				}
			}
			return node;
		};
		var getFacetFilterData = function(id) { //Get the facetFilter index
			var indexOfConfig = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;
			var node = {};
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].filters instanceof Array) {
					node.indexConfigData = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].filters.length; j++) {
						if (configs[indexOfConfig].configData[i].filters[j].id === id) {
							node.index = j;
							node.data = configs[indexOfConfig].configData[i].filters[j];
							node.id = configs[indexOfConfig].configData[i].filters[j].id;
							node.ffExpansion = configs[indexOfConfig].configData[i].expanded;
						}
					}
				}
			}
			return node;
		};
		var getCategoryData = function(id) { //Get the cateogry index
			var indexOfConfig = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;
			var node = {};
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].categories instanceof Array) {
					node.indexConfigData = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].categories.length; j++) {
						if (configs[indexOfConfig].configData[i].categories[j].id === id) {
							node.index = j;
							node.data = configs[indexOfConfig].configData[i].categories[j];
							node.id = configs[indexOfConfig].configData[i].categories[j].id;
							node.categoryExpansion = configs[indexOfConfig].configData[i].expanded;
						}
					}
				}
			}
			return node;
		};
		var getStepData = function(id) {//Get the step index
			var indexOfConfig = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;
			var indexOfConfigData = getCategoryData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;
			var indexOfCategory = getCategoryData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;
			var node = {};
			for( var i = 0; i < configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps.length; i++) {
				if (configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[i].id === id) {
					node.index = i;
					node.data = configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[i];
					node.id = configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[i].id;
				}
			}
			return node;
		};
		var getRepresentationData = function(id) {//Get the representation index
			var indexOfConfig = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;
			var indexOfConfigData = getCategoryData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).indexConfigData;
			var indexOfCategory = getCategoryData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]).index;
			var indexOfStep = getStepData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]).index;
			var node = {};
			for( var i = 0; i < configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[indexOfStep].representations.length; i++) {
				if (configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[indexOfStep].representations[i].id === id) {
					node.index = i;
					node.data = configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[indexOfStep].representations[i];
					node.id = configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[indexOfStep].representations[i].id;
				}
			}
			return node;
		};
		var getNavigationTargetData = function(id) { //Get the facetFilter index
			var indexOfConfig = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]).index;
			var node = {};
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].navTargets instanceof Array) {
					node.indexConfigData = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].navTargets.length; j++) {
						if (configs[indexOfConfig].configData[i].navTargets[j].id === id) {
							node.index = j;
							node.data = configs[indexOfConfig].configData[i].navTargets[j];
							node.id = configs[indexOfConfig].configData[i].navTargets[j].id;
							node.nTExpansion = configs[indexOfConfig].configData[i].expanded;
						}
					}
				}
			}
			return node;
		};
		switch (type) {
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
				nodeData = getConfigurationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION]);
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
				nodeData = getFacetFilterData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER]);
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
				nodeData = getCategoryData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY]);
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
				nodeData = getStepData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP]);
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
				nodeData = getRepresentationData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION]);
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
				nodeData = getNavigationTargetData.call(this, params[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET]);
				break;
		}
		return nodeData;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_retainNodeState
	 * @params {String} params - comprise all the node id from its parent
	 * @params {String} type - define the node type like category, step etc
	 * @description Retains the expansion state from its previous model if it exists
	 * */
	_retainNodeState : function(params, type) {
		var oModel = this.oModel;
		var configId = params.configId;
		var indexName = "";
		var configIndexInTree = this._getNodeData(params, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;
		//Check if the config editor is loaded else return empty object
		if (!this.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded) {
			return {};
		}
		var nodeData = this._getNodeData(params, type);
		//nodeData is empty then return empty object
		if (!nodeData.data) {
			return {};
		}
		return {
			expanded : nodeData.data.expanded,
			isSelected : nodeData.data.isSelected
		};
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#updateTree
	 * @description Prepare the model for tree with editor instance passed 
	 * it also retains the expansion and selection state if there is any
	 * existing model
	 * */
	updateTree : function() {
		var self = this;
		var categories = [], aSteps = [], aFacetFilters = [], aNavigationTargets = [], aCategoryWithStepDetails = [], allCategoryInConfig = [], stepWithRepresentation = [];
		this.oTextPool = this.configurationHandler.getTextPool();
		var oParams = {};
		oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION] = this.configId;
		var configIndexInTree = self._getNodeData(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION).index;
		var bFFExpansionState = false;
		var bnTExpansionState = false;
		var bCategoryExpansionState = false;
		categories = this.configEditor.getCategories();
		aFacetFilters = this.configEditor.getFacetFilters();
		aNavigationTargets = this.configEditor.getNavigationTargets();
		var oRepnMetaData = this.oCoreApi.getRepresentationTypes();
		var oRepnIconMap = {};
		//Create Representation ID/Icon Map
		oRepnMetaData.forEach(function(o) {
			var sId = o.id;
			oRepnIconMap[sId] = o.picture;
		});
		categories.forEach(function(category) {
			oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY] = category.getId();
			var oCategory = category;
			var sCategoryId = oCategory.getId();
			stepWithRepresentation = [];
			self.configEditor.getCategoryStepAssignments(sCategoryId).forEach(function(sStepId) {
				var oStep = self.configEditor.getStep(sStepId);
				oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY] = sCategoryId;
				oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP] = oStep.getId();
				var stepState = self._retainNodeState(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP);
				var aRepresentations = oStep.getRepresentations();
				var aRepData = aRepresentations.map(function(oRepresentation) {
					oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION] = oRepresentation.getId();
					var representationState = self._retainNodeState(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION);
					return {
						id : oRepresentation.getId(),
						name : self.oCoreApi.getText(oRepresentation.getRepresentationType()),
						type : "representation",
						isSelected : representationState.isSelected || false,
						expanded : representationState.expanded || false,
						selectable : true,
						icon : oRepnIconMap[oRepresentation.getRepresentationType()]
					};
				});
				stepWithRepresentation.push({
					id : oStep.getId(),
					name : self.oTextPool.get(oStep.getTitleId()) ? self.oTextPool.get(oStep.getTitleId()).TextElementDescription : oStep.getTitleId(),
					type : "step",
					representations : aRepData,
					isSelected : stepState.isSelected || false,
					expanded : stepState.expanded || false,
					selectable : true
				});
			});
			var categoryState = self._retainNodeState(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);
			//Check if the config editor is loaded then check expansion state of root node 
			if (self.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded) {
				var categoryRootNode = self._getNodeData(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY);
				if (categoryRootNode.categoryExpansion) {
					bCategoryExpansionState = true; //Overall Category Node Expansion State
				}
			}
			aCategoryWithStepDetails.push({
				id : category.getId(),
				name : self.oTextPool.get(category.labelKey) ? self.oTextPool.get(category.labelKey).TextElementDescription : category.labelKey,
				type : "category",
				steps : stepWithRepresentation,
				isSelected : categoryState.isSelected || false,
				expanded : categoryState.expanded || false,
				selectable : true
			});
		});
		var aFacetFilter = [];
		aFacetFilters.forEach(function(oFacetFilter) {
			oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER] = oFacetFilter.getId();
			var facetFilterState = self._retainNodeState(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER);
			//Check if the config editor is loaded then check expansion state of root node 
			if (self.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded) {
				var ffRootNode = self._getNodeData(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER);
				if (ffRootNode.ffExpansion) {
					bFFExpansionState = true; //Overall Facet Filter Node Expansion State
				}
			}
			aFacetFilter.push({
				id : oFacetFilter.getId(),
				name : self.oTextPool.get(oFacetFilter.getLabelKey()) ? self.oTextPool.get(oFacetFilter.getLabelKey()).TextElementDescription : oFacetFilter.getLabelKey(),
				type : "facetFilter",
				isSelected : facetFilterState.isSelected || false,
				expanded : facetFilterState.expanded || false,
				selectable : true
			});
		});
		allCategoryInConfig.push({
			filters : aFacetFilter,
			name : self.oCoreApi.getText("facetFilters"),
			expanded : bFFExpansionState,
			selectable : false
		});
		allCategoryInConfig.push({
			categories : aCategoryWithStepDetails,
			name : self.oCoreApi.getText("categories"),
			expanded : bCategoryExpansionState,
			selectable : false
		});
		var aNavigationTarget = [];
		//Takes a list of semantic actions and the navigation target; Compares the action of navigation target with the list to find the description or text 
		var populateNavTargets = function(aSemanticActions, oNavigationTarget) {
			oParams[sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET] = oNavigationTarget.getId();
			var navigationTargetState = self._retainNodeState(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);
			//Check if the config editor is loaded then check expansion state of root node 
			if (self.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded) {
				var nTRootNode = self._getNodeData(oParams, sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET);
				if (nTRootNode.nTExpansion) {
					bnTExpansionState = true; //Overall Facet Filter Node Expansion State
				}
			}
			var i, navTargetName;
			for(i = 0; i < aSemanticActions.length; i++) {
				if (aSemanticActions[i].id === oNavigationTarget.getAction()) {
					navTargetName = aSemanticActions[i].text;
					break;
				}
			}
			aNavigationTarget.push({
				id : oNavigationTarget.getId(),
				name : navTargetName || oNavigationTarget.getSemanticObject(),//Push the action description here, if action description not available use the semantic object
				type : "navigationTarget",
				isSelected : navigationTargetState.isSelected || false,
				expanded : navigationTargetState.expanded || false,
				selectable : true
			});
		};
		var orderNavTargets = function() {
			var aNavTargetIds = aNavigationTargets.map(function(oNavTarget) {
				return oNavTarget.getId();
			});
			var oTemp = [];
			for( var i = 0; i < aNavTargetIds.length; i++) {
				for( var j = 0; j < aNavigationTarget.length; j++) {
					if (aNavTargetIds[i] === aNavigationTarget[j].id) {
						oTemp[i] = aNavigationTarget[j];
						break;
					}
				}
			}
			aNavigationTarget = oTemp;
		};
		var updateModel = function() {
			var oConfigDetails = {};
			oConfigDetails.configData = allCategoryInConfig;
			self.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded = true;// Configuration Loaded boolean for configuration is set to true
			var oTemp = self.oModel.getData().aConfigDetails[configIndexInTree];
			jQuery.extend(oTemp, oConfigDetails);
			self.oModel.getData().aConfigDetails[configIndexInTree] = oTemp;
			self.oModel.getData().aConfigDetails[configIndexInTree].name = self.configurationHandler.getConfiguration(self.configId).AnalyticalConfigurationName; // Update the title of configuration while updating the model
			self.oModel.updateBindings();
		};
		aNavigationTargets.forEach(function(oNavigationTarget) {
			var oPromise = self.oCoreApi.getSemanticActions(oNavigationTarget.getSemanticObject());
			oPromise.then(function(aSemanticActions) {
				populateNavTargets(aSemanticActions.semanticActions, oNavigationTarget);
				if (aNavigationTarget.length === aNavigationTargets.length) {//Once all the navigation targets are populated push them into allCategoryInConfig
					orderNavTargets();
					if (allCategoryInConfig[2]) {
						allCategoryInConfig.splice(2, 2);//Remove the empty nav targets array
						allCategoryInConfig.push({
							navTargets : aNavigationTarget,
							name : self.oCoreApi.getText("navigationTargets"),
							expanded : bnTExpansionState,
							selectable : false
						});
						updateModel();//Update the model after nav targets are populated
						var currentUrlParams = sap.apf.modeler.ui.utils.APFRouter.params;
						if (currentUrlParams.name === "navigationTarget") {
							sap.apf.modeler.ui.utils.APFRouter.setCurrentSelectionState(currentUrlParams, self);
						}
					}
				}
			});
		});
		allCategoryInConfig.push({
			navTargets : aNavigationTarget,
			name : self.oCoreApi.getText("navigationTargets"),
			expanded : bnTExpansionState,
			selectable : false
		});
		updateModel();//Update the model before nav targets are populated
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_handleToggleTreeNode
	 * @description On expand stores the binding context of the nodes which could be used later to set the state of the tree
	 * */
	_handleToggleTreeNode : function(oEvent) { // on expand stores the binding context of the nodes which could be used later to set the state of the tree
		var self = this;
		var oCurrentNode = oEvent.getSource();
		oCurrentNode.setExpanded(!oCurrentNode.getExpanded());
		var sPathOfCurrentNode = oCurrentNode.getBindingContext().sPath;
		var selectedObjectType = oCurrentNode.getBindingContext().getObject().type;
		if (selectedObjectType === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) { //if configuration is expanded, the child nodes has to be expanded
			var configIndexInTree = sPathOfCurrentNode.split('/')[2];
			if (self.oModel.getData().aConfigDetails[configIndexInTree].bIsLoaded === true) { //If the tree structure has been created
				this.oModel.updateBindings(); //Update the tree 
			} else { // If the tree structure has not been created
				this.configurationHandler.loadConfiguration(this.oModel.getData().aConfigDetails[configIndexInTree].AnalyticalConfiguration, function(configurationEditor) { // Sets the configEditor only once in case of existing configuration
					self.configEditor = configurationEditor;
					self.configId = self.oModel.getData().aConfigDetails[configIndexInTree].AnalyticalConfiguration;
					self.updateTree();
				});
			}
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#getSPathForConfig
	 * @arams Configuration Id for which sPath has to be derieved
	 * @description Returns sPath of the selected configuration
	 * @returns {String} Returns sPath of the configuration node
	 * */
	getSPathForConfig : function(configId) {
		var sPath;
		this.oModel.getData().aConfigDetails.forEach(function(config, index) {
			if (config.AnalyticalConfiguration === configId) {
				sPath = "/aConfigDetails/" + index;
			}
		});
		return sPath;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#getSPathFromURL
	 * @arams URL context
	 * @description Returns a valid sPath from the URL context
	 * */
	getSPathFromURL : function(params) {
		var oValidURL = {
			sPath : undefined,
			objectType : undefined
		};
		var self = this;
		this.oModel.getData().aConfigDetails.forEach(function(config, index) {
			if (config.AnalyticalConfiguration === params.arguments.configId) {
				oValidURL.sPath = "/aConfigDetails/" + index;
				oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION;
				self.oModel.getData().aConfigDetails[index].expanded = true;
				if (params.arguments.categoryId !== undefined) {
					self.oModel.getData().aConfigDetails[index].configData[1].categories.forEach(function(category, categoryIndex) {
						if (category.id === params.arguments.categoryId) {
							oValidURL.sPath = oValidURL.sPath.concat("/configData/1/categories/" + categoryIndex);
							oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY;
							self.oModel.getData().aConfigDetails[index].configData[1].expanded = true;
							if (params.arguments.stepId !== undefined) {
								self.oModel.getData().aConfigDetails[index].configData[1].categories[categoryIndex].steps.forEach(function(step, stepIndex) {
									if (step.id === params.arguments.stepId) {
										oValidURL.sPath = oValidURL.sPath.concat("/steps/" + stepIndex);
										oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP;
										self.oModel.getData().aConfigDetails[index].configData[1].categories[categoryIndex].expanded = true;
										if (params.arguments.representationId !== undefined) {
											self.oModel.getData().aConfigDetails[index].configData[1].categories[categoryIndex].steps[stepIndex].representations.forEach(function(representation, representationIndex) {
												if (representation.id === params.arguments.representationId) {
													self.oModel.getData().aConfigDetails[index].configData[1].categories[categoryIndex].steps[stepIndex].expanded = true;
													oValidURL.sPath = oValidURL.sPath.concat("/representations/" + representationIndex);
													oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION;
												}
											});
										}
									}
								});
							}
						}
					});
				}
				if (params.arguments.facetFilterId !== undefined) {
					self.oModel.getData().aConfigDetails[index].configData[0].filters.forEach(function(facetFilter, facetFilterIndex) {
						if (facetFilter.id === params.arguments.facetFilterId) {
							oValidURL.sPath = oValidURL.sPath.concat("/configData/0/filters/" + facetFilterIndex);
							oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER;
							self.oModel.getData().aConfigDetails[index].configData[0].expanded = true;
						}
					});
				}
				if (params.arguments.navTargetId !== undefined) {
					self.oModel.getData().aConfigDetails[index].configData[2].navTargets.forEach(function(navTarget, navTargetIndex) {
						if (navTarget.id === params.arguments.navTargetId) {
							oValidURL.sPath = oValidURL.sPath.concat("/configData/2/navTargets/" + navTargetIndex);
							oValidURL.objectType = sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET;
							self.oModel.getData().aConfigDetails[index].configData[2].expanded = true;
						}
					});
				}
			}
		});
		return oValidURL;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_navHandleExpandDelete
	 * @params {Object} node context
	 * @params {Object} Route params context
	 * @params {Boolean} Whether configuration is switched or not
	 * @description Set the expansion state of selected node + delete the new node or config
	 * */
	_navHandleExpandDelete : function(node, params, isSwitchConfig) {
		var self = this;
		var configs = this.oModel.getData().aConfigDetails;
		var bIsDifferntConfig = isSwitchConfig || this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode, this.selectedNode);
		var getConfigurationIndex = function(id) { //Get the configuration index
			var index;
			for( var i = 0; i < configs.length; i++) {
				if (configs[i].AnalyticalConfiguration === id) {
					index = i;
					break;
				}
			}
			return index;
		};
		var getFacetFilterIndex = function(id) { //Get the facetFilter index
			var indexOfConfig = getConfigurationIndex.call(this, params.configId);
			var indexConfig, indexFilter;
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].filters instanceof Array) {
					indexConfig = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].filters.length; j++) {
						if (configs[indexOfConfig].configData[i].filters[j].id === id) {
							indexFilter = j;
							break;
						} else {
							indexFilter = j;
						}
					}
				}
			}
			return {
				indexConfig : indexConfig,
				indexFilter : indexFilter
			};
		};
		var getNavTargetIndex = function(id) { //Get the navigation Target index
			var indexOfConfig = getConfigurationIndex.call(this, params.configId);
			var indexConfig, indexNavTarget;
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].navTargets instanceof Array) {
					indexConfig = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].navTargets.length; j++) {
						if (configs[indexOfConfig].configData[i].navTargets[j].id === id) {
							indexNavTarget = j;
							break;
						} else {
							indexNavTarget = j;
						}
					}
				}
			}
			return {
				indexConfig : indexConfig,
				indexNavTarget : indexNavTarget
			};
		};
		var getCategoryIndex = function(id) { //Get the category index
			var indexOfConfig = getConfigurationIndex.call(this, params.configId);
			var indexConfig, indexCategory;
			for( var i = 0; i < configs[indexOfConfig].configData.length; i++) {
				if (configs[indexOfConfig].configData[i].categories instanceof Array) {
					indexConfig = i;
					for( var j = 0; j < configs[indexOfConfig].configData[i].categories.length; j++) {
						if (configs[indexOfConfig].configData[i].categories[j].id === id) {
							indexCategory = j;
							break;
						} else {
							indexCategory = j;
						}
					}
				}
			}
			return {
				indexConfig : indexConfig,
				indexCategory : indexCategory
			};
		};
		var getStepIndex = function(id) {//Get the step index
			var indexOfConfig = getConfigurationIndex.call(this, params.configId);
			var indexOfConfigData = getCategoryIndex.call(this, params.categoryId).indexConfig;
			var indexOfCategory = getCategoryIndex.call(this, params.categoryId).indexCategory;
			var indexStep;
			for( var i = 0; i < configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps.length; i++) {
				if (configs[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[i].id === id) {
					indexStep = i;
					break;
				} else {
					indexStep = i;
				}
			}
			return indexStep;
		};
		if (params.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0 && bIsDifferntConfig) {
			this.configurationHandler.removeConfiguration(params.configId, function(id) {
				var aConfigForTree = self.oModel.getData().aConfigDetails;
				var indexOfConfig = getConfigurationIndex.call(self, params.configId);
				aConfigForTree.splice(indexOfConfig, 1);
				self.oModel.getData().aConfigDetails = aConfigForTree;
			});
		} else {
			var indexOfConfig, indexOfConfigData, indexOfFacetFilter, indexOfCategory, indexOfStep, indexOfNavTarget;
			switch (node.nodeObjectType) {
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					this.oModel.getData().aConfigDetails[indexOfConfig].isSelected = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					indexOfConfigData = getFacetFilterIndex.call(this, params.facetFilterId).indexConfig;
					indexOfFacetFilter = getFacetFilterIndex.call(this, params.facetFilterId).indexFilter;
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].filters[indexOfFacetFilter].expanded = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					indexOfConfigData = getCategoryIndex.call(this, params.categoryId).indexConfig;
					indexOfCategory = getCategoryIndex.call(this, params.categoryId).indexCategory;
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].expanded = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					indexOfConfigData = getCategoryIndex.call(this, params.categoryId).indexConfig;
					indexOfCategory = getCategoryIndex.call(this, params.categoryId).indexCategory;
					indexOfStep = getStepIndex.call(this, params.stepId);
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].expanded = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					indexOfConfigData = getCategoryIndex.call(this, params.categoryId).indexConfig;
					indexOfCategory = getCategoryIndex.call(this, params.categoryId).indexCategory;
					indexOfStep = getStepIndex.call(this, params.stepId);
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].categories[indexOfCategory].steps[indexOfStep].expanded = true;
					break;
				case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
					indexOfConfig = getConfigurationIndex.call(this, params.configId);
					indexOfConfigData = getNavTargetIndex.call(this, params.navTargetId).indexConfig;
					indexOfNavTarget = getNavTargetIndex.call(this, params.navTargetId).indexNavTarget;
					this.oModel.getData().aConfigDetails[indexOfConfig].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].expanded = true;
					this.oModel.getData().aConfigDetails[indexOfConfig].configData[indexOfConfigData].navTargets[indexOfNavTarget].expanded = true;
					break;
			}
		}
		this.oModel.updateBindings();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_isNewSubView
	 * @params {Object} Route context 
	 * @description Check whether the sub view is new or existing
	 * */
	_isNewSubView : function(params) {
		var isNew = false;
		if (params.arguments.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //Check the prefix apf1972- for new 
			isNew = true;
		} else {
			if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) {
				isNew = (this.configurationHandler.getConfiguration(params.arguments.configId) !== undefined) ? false : true;
			} else if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY) {
				isNew = (this.configEditor.getCategory(params.arguments.categoryId) !== undefined) ? false : true;
			} else if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER) {
				isNew = (this.configEditor.getFacetFilter(params.arguments.facetFilterId) !== undefined) ? false : true;
			} else if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP) {
				isNew = (this.configEditor.getStep(params.arguments.stepId) !== undefined) ? false : true;
			} else if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION) {
				isNew = (this.configEditor.getRepresentation(params.arguments.representationId) !== undefined) ? false : true;
			} else if (params.name === sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET) {
				isNew = (this.configEditor.getNavigationTarget(params.arguments.navTargetId) !== undefined) ? false : true;
			}
		}
		return isNew;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_getCurrentConfigurationNode
	 * @description Return the configuration tree node 
	 * */
	_getCurrentConfigurationNode : function() {
		var parentNodes = this.oTreeInstance.getNodes();
		var configId = this.configId;
		for( var i = 0; i < parentNodes.length; i++) {
			if (configId === parentNodes[i].getBindingContext().getObject().AnalyticalConfiguration) {
				return parentNodes[i];
			}
		}
		return undefined;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_navMandatoryResetState
	 * @params {Object} Configuration List instance
	 * @params {Function} Callback function to be executed once the configuration is reset
	 * @returns {Object} {
	 * 		isNewView : new view or not
	 * 		bIsSaved : Configuration is saved or not
	 * } 
	 * @description On mandatory state reset the configuration and prepare new tree structure
	 * */
	_navMandatoryResetState : function(context, callback) {
		var self = context;
		self.bIsSaved = self.configEditor ? self.configEditor.isSaved() : undefined;
		var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
		var isNewView = this._isNewSubView(subViewInstance.oViewData.oParams);
		if (!isNewView) {
			self.updateTree();
			var selectedNode = self.selectedNode.getBindingContext().getObject();
			if (selectedNode) { // If node exists then set it to be selected else make the parent config node as selected cause the selected node has been deleted
				selectedNode.isSelected = true;
				subViewInstance.oConfigurationEditor = self.configEditor;
				subViewInstance.setDetailData.call(subViewInstance);
				self.updateTitleAndBreadCrumb();
			} else {
				self.oTreeInstance.setSelection(self._getCurrentConfigurationNode());
			}
			if (typeof callback === "function") {
				callback();
			}
		} else {
			self.handleConfirmDeletion();
		}
		return {
			bIsSaved : self.bIsSaved,
			isNewView : isNewView
		};
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_navSaveState
	 * @param {Function} Callback to save the editor instance
	 * @description Save the editor instance
	 * */
	_navSaveState : function(saveEditor) {
		saveEditor();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_navConfigResetState
	 * @params {Object} configuration list instance
	 * @params {Function} Callback function once the configuration is reset
	 * @description Reset the configuration and delete the respective node if its new view
	 * */
	_navConfigResetState : function(context, callback) {
		var self = context;
		var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
		var isNewView = this._isNewSubView(subViewInstance.oViewData.oParams);
		if (!isNewView) {
			self.configurationHandler.loadConfiguration(self.configId, function(configurationEditor) {
				var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
				self.configEditor = configurationEditor;
				self.updateTree();
				var selectedNode = self.selectedNode.getBindingContext().getObject();
				if (selectedNode) { // If node exists then set it to be selected else make the parent config node as selected cause the selected node has been deleted
					selectedNode.isSelected = true;
					subViewInstance.oConfigurationEditor = self.configEditor;
					subViewInstance.setDetailData.call(subViewInstance);
					self.updateTitleAndBreadCrumb();
				} else {
					self.oTreeInstance.setSelection(self._getCurrentConfigurationNode());
				}
				if (typeof callback === "function") {
					callback();
				}
			});
		} else {
			self.handleConfirmDeletion();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#getRouteContext
	 * @params {Object} node context
	 * @description returns the route context 
	 * */
	getRouteContext : function(nodeContext) {
		var self = this;
		if (!nodeContext) { //If node context undefined bookmark scenario
			this.oSelectedNodeDetails = this.oTreeInstance.getNodeContext(this.oTreeInstance.getSelection());
			this.oParentNodeDetails = this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);
			nodeContext = this.oParentNodeDetails;
		}
		var routeContext = {
			appId : self.appId,
			configId : nodeContext.configurationId,
			categoryId : nodeContext.categoryId,
			facetFilterId : nodeContext.facetFilterId,
			stepId : nodeContext.stepId,
			representationId : nodeContext.representationId
		};
		return routeContext;
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_onTreeNodeSelection
	 * @description On tree node selection performs action like navigate to view and performs checks for navigation scenarios
	 * */
	_onTreeNodeSelection : function(oEvent) {
		this.selectedNode = oEvent.getParameter("node");
		var self = this;
		if (!this.bProgramaticSelection) {
			this.oPreviousSelectedNode = this.oTreeInstance.getSelection();
			this.bIsDifferntConfig = this.oTreeInstance.isConfigurationSwitched(this.oPreviousSelectedNode, this.selectedNode);
			var selectedObjectType = oEvent.getParameters().nodeContext.getObject().type;
			this.oSelectedNodeDetails = this.oTreeInstance.getNodeContext(this.selectedNode);
			this.oParentNodeDetails = this.oTreeInstance.getParentNodeContext(this.oSelectedNodeDetails);
			this.toolbarController.enableCopyDeleteButton();
			this._enableExportButton();
			var subViewInstance;
			if (this.byId("idConfigDetailData").getContent().length >= 1) {
				subViewInstance = (typeof this.byId("idConfigDetailData").getContent()[0].getController === "function") ? this.byId("idConfigDetailData").getContent()[0].getController() : undefined;
			}
			var currNodeId = this.selectedNode ? this.selectedNode.getId() : null;
			var prevNodeId = this.oPreviousSelectedNode ? this.oPreviousSelectedNode.getId() : null;
			//Set the selection back to the previous node 
			//Used on scenario of navigation switch back to 
			//previous node on cancel state
			var resetSelectionToPreviousNode = function() {
				var prevSelectedNode = self.oPreviousSelectedNode.getBindingContext().getObject();
				var selectedNode = self.selectedNode.getBindingContext().getObject();
				prevSelectedNode.isSelected = true;
				selectedNode.isSelected = false;
				self.oModel.updateBindings();
			};
			//If not the same node selected 
			if (currNodeId !== prevNodeId || this.bNavDeletionMode) {
				//check if there is any unsaved change
				var navigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
				var isMandatoryFilled = (subViewInstance !== undefined) ? (typeof subViewInstance.getValidationState === "function" ? subViewInstance.getValidationState.call(subViewInstance) : true) : true;
				this.bIsSaved = this.configEditor ? this.configEditor.isSaved() : undefined;
				var onConfigSwitchState;
				var isDirtyState = false;
				var configList = this.configurationHandler.getList();
				if (!isMandatoryFilled && (configList.length > 0)) { //check mandatory state || if configuration list exists
					navigationHandlerInstance.throwMandatoryPopup(self, {
						yes : function() {
							var routeContext = self.getRouteContext(self.oParentNodeDetails);
							var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
							var isNewView = self._isNewSubView(subViewInstance.oViewData.oParams);
							if (!isNewView) {
								var yesAction = function(callback) {
									if (typeof callback === "function") {
										callback();
									}
									this.updateTree();
									var selectedNode = this.selectedNode.getBindingContext().getObject();
									this.navigateToDifferntView(this.oParentNodeDetails, this.oSelectedNodeDetails);
									selectedNode.isSelected = true;
									this.oModel.updateBindings();
								};
								if (!self.bIsSaved && self.bIsDifferntConfig) { //If it still dirty then call switch state dialog & different config
									onConfigSwitchState(false, function() {
										yesAction.call(self, callback);
									});
								} else {
									yesAction.call(self);
								}
							} else {
								if (!self.bIsSaved && self.bIsDifferntConfig) { //If it still dirty then call switch state dialog & different config
									onConfigSwitchState(false, function() {
										var selectContext = self.selectedNode.getBindingContext().sPath;
										var prevContext = self.oPreviousSelectedNode;
										self.handleConfirmDeletion(prevContext, selectContext);
									});
								} else {
									var selectContext = self.selectedNode.getBindingContext().sPath;
									var prevContext = self.oPreviousSelectedNode;
									self.handleConfirmDeletion(prevContext, selectContext);
								}
							}
							self._navHandleExpandDelete.call(self, self.oSelectedNodeDetails, routeContext);
						},
						no : function() {
							resetSelectionToPreviousNode();
						}
					});
					isDirtyState = true;
				}
				//on configuration switch throw loss of data pop up 
				onConfigSwitchState = function(callback) {
					navigationHandlerInstance.throwLossOfDataPopup(self, {
						yes : function(saveEditor) {
							var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
							var getValidStateOfSubView = (subViewInstance !== undefined) ? (typeof subViewInstance.getValidationState === "function" ? subViewInstance.getValidationState.call(subViewInstance) : true) : true;
							if (typeof callback === "function") {
								callback(function() {
									saveEditor(function() {
										if (self.oPreviousSelectedNode) {
											var sBindingContext = self.oPreviousSelectedNode.getBindingContext().sPath;
											var aContextForSelectedNode = sBindingContext.split("/");
											var indexOfConfig = aContextForSelectedNode[2];
										}
										self.oModel.getData().aConfigDetails[indexOfConfig].AnalyticalConfiguration = self.configId;
									});
								});
							} else {
								saveEditor(function() {
									if (self.oPreviousSelectedNode) {
										var sBindingContext = self.oPreviousSelectedNode.getBindingContext().sPath;
										var aContextForSelectedNode = sBindingContext.split("/");
										var indexOfConfig = aContextForSelectedNode[2];
									}
									self.oModel.getData().aConfigDetails[indexOfConfig].AnalyticalConfiguration = self.configId;
									var selectedNode = self.selectedNode.getBindingContext().getObject();
									self.navigateToDifferntView(self.oParentNodeDetails, self.oSelectedNodeDetails);
									selectedNode.isSelected = true;
									self.oModel.updateBindings();
								});
							}
						},
						no : function() {
							var subViewInstance = (typeof self.byId("idConfigDetailData").getContent()[0].getController === "function") ? self.byId("idConfigDetailData").getContent()[0].getController() : undefined;
							var routeContext = self.getRouteContext(self.oParentNodeDetails);
							self.configurationHandler.loadConfiguration(self.configId, function(configurationEditor) {
								self.configEditor = configurationEditor;
								if (self.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //If new confiuration splice from model before navigating 
									self._navHandleExpandDelete.call(self, {}, {
										configId : self.configId
									}, routeContext);
								} else {
									self.updateTree();
								}
								self.navigateToDifferntView(self.oParentNodeDetails, self.oSelectedNodeDetails);
								self._navHandleExpandDelete.call(self, self.oSelectedNodeDetails, routeContext);
							});
						},
						cancel : function() {
							resetSelectionToPreviousNode();
						}
					});
				};
				//if unsaved state while switching throw loss of data pop up
				if (!self.bIsSaved && self.bIsDifferntConfig && isMandatoryFilled) {
					onConfigSwitchState();
					isDirtyState = true;
				}
				if (!isDirtyState) {//In clean state navigate to respective node selected  
					if (this.oPreviousSelectedNode && this.oPreviousSelectedNode.getId() !== this.selectedNode.getId()) {
						var bPrevSelectedNode = this.oPreviousSelectedNode.getBindingContext().getObject();
						if (bPrevSelectedNode) {
							this.oPreviousSelectedNode.getBindingContext().getObject().isSelected = false;
							this.oPreviousSelectedNode.setIsSelected(false);
						}
					} else {
						this.selectedNode.getBindingContext().getObject().isSelected = true;
					}
					this.navigateToDifferntView(this.oParentNodeDetails, this.oSelectedNodeDetails, this.bIsSaved, this.bIsDifferntConfig);
				}
			}
		}
		this.bProgramaticSelection = false;//reset flag for programatic selection
		this.bNavDeletionMode = false; //to check navigation in delete mode
	},
	navigateToDifferntView : function(oParentNodeDetails, oSelectedNodeDetails, bIsSaved, bIsDifferntConfig) {
		var context = {
			appId : this.appId,
			configId : oParentNodeDetails.configurationId,
			categoryId : oParentNodeDetails.categoryId,
			facetFilterId : oParentNodeDetails.facetFilterId,
			stepId : oParentNodeDetails.stepId,
			representationId : oParentNodeDetails.representationId,
			navTargetId : oParentNodeDetails.navTargetId
		};
		if ((!jQuery.isEmptyObject(context) && (bIsSaved === undefined || bIsSaved)) || (!bIsDifferntConfig)) { //If context is not equal to empty traverse to view
			sap.ui.core.UIComponent.getRouterFor(this).navTo(oSelectedNodeDetails.nodeObjectType, context);
		}
	},
	handleConfirmDeletion : function(selectedNode, selectContext) { //event handler for confirmation dialog from delete button in the toolbar
		var selectedTreeNodeDetails = ((selectedNode === undefined) || (typeof selectedNode.preventDefault === "function")) ? this.oTreeInstance.getNodeContext(this.oTreeInstance.getSelection()) : this.oTreeInstance.getNodeContext(selectedNode);
		var self = this;
		this.selectedNode = this.oTreeInstance.getSelection();
		var newContextForCopiedNode, aNewContextForSelectedNode, aOldContextForSelectedNode, oldContextForSelectedNode, indexOfConfig, indexOffacetFilter, indexOfCategory, indexOfNavTarget, indexOfStep, indexOfRep;
		oldContextForSelectedNode = selectedTreeNodeDetails.nodeContext;
		aOldContextForSelectedNode = oldContextForSelectedNode.split("/");
		indexOfConfig = aOldContextForSelectedNode[2];
		switch (selectedTreeNodeDetails.nodeObjectType) {
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.FACETFILTER:
				this.configEditor.removeFacetFilter(selectedTreeNodeDetails.nodeAPFId);
				indexOffacetFilter = aOldContextForSelectedNode[6];
				var aFacetFilterForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[0].filters;
				aFacetFilterForTree.splice(indexOffacetFilter, 1);
				this.oModel.getData().aConfigDetails[indexOfConfig].configData[0].filters = aFacetFilterForTree;
				aNewContextForSelectedNode = aOldContextForSelectedNode.slice(0, 3);
				newContextForCopiedNode = aNewContextForSelectedNode.join("/");
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CATEGORY:
				this.configEditor.removeCategory(selectedTreeNodeDetails.nodeAPFId);
				indexOfCategory = aOldContextForSelectedNode[6];
				var aCategoryForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories;
				aCategoryForTree.splice(indexOfCategory, 1);
				this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories = aCategoryForTree;
				aNewContextForSelectedNode = aOldContextForSelectedNode.slice(0, 3);
				newContextForCopiedNode = aNewContextForSelectedNode.join("/");
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.NAVIGATIONTARGET:
				this.configEditor.removeNavigationTarget(selectedTreeNodeDetails.nodeAPFId);
				indexOfNavTarget = aOldContextForSelectedNode[6];
				var aNavTargetForTree = this.oModel.getData().aConfigDetails[indexOfConfig].configData[2].navTargets;
				aNavTargetForTree.splice(indexOfNavTarget, 1);
				this.oModel.getData().aConfigDetails[indexOfConfig].configData[2].navTargets = aNavTargetForTree;
				aNewContextForSelectedNode = aOldContextForSelectedNode.slice(0, 3);
				newContextForCopiedNode = aNewContextForSelectedNode.join("/");
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.STEP://Finds the step in all the categories it is present in and deletes it
				var step = this.configEditor.getStep(selectedTreeNodeDetails.nodeAPFId);
				var aStepCategories = this.configEditor.getCategoriesForStep(selectedTreeNodeDetails.nodeAPFId);
				var aStepContext = selectedTreeNodeDetails.nodeContext.split("/");
				indexOfConfig = aStepContext[2];
				aStepCategories.forEach(function(stepCategoryId) {
					self.configEditor.removeCategoryStepAssignment(stepCategoryId, selectedTreeNodeDetails.nodeAPFId);
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories.forEach(function(category, categoryIndex) {
						if (category.id === stepCategoryId) {
							self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps.forEach(function(step, stepIndex) {
								if (step.id === selectedTreeNodeDetails.nodeAPFId) {
									var aStepForTree = self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps;
									aStepForTree.splice(stepIndex, 1);
									self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps = aStepForTree;
								}
							});
						}
					});
				});
				aNewContextForSelectedNode = aOldContextForSelectedNode.slice(0, 7);
				newContextForCopiedNode = aNewContextForSelectedNode.join("/");
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.REPRESENTATION://Finds the representation in all the categories it is present in and deletes it
				indexOfCategory = aOldContextForSelectedNode[6];
				indexOfStep = aOldContextForSelectedNode[8];
				indexOfRep = aOldContextForSelectedNode[10];
				var oParentStepIdForRep = this.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[indexOfCategory].steps[indexOfStep].id;
				var oParentStep = this.configEditor.getStep(oParentStepIdForRep);
				var aParentStepCategories = this.configEditor.getCategoriesForStep(oParentStepIdForRep);
				oParentStep.removeRepresentation(selectedTreeNodeDetails.nodeAPFId);
				aParentStepCategories.forEach(function(stepCategoryId) {
					self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories.forEach(function(category, categoryIndex) {
						if (category.id === stepCategoryId) {
							self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps.forEach(function(step, stepIndex) {
								if (step.id === oParentStepIdForRep) {
									self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps[stepIndex].representations.forEach(function(representation, representationIndex) {
										if (representation.id === selectedTreeNodeDetails.nodeAPFId) {
											var aRepForTree = self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps[stepIndex].representations;
											aRepForTree.splice(representationIndex, 1);
											self.oModel.getData().aConfigDetails[indexOfConfig].configData[1].categories[categoryIndex].steps[stepIndex].representations = aRepForTree;
										}
									});
								}
							});
						}
					});
				});
				aNewContextForSelectedNode = aOldContextForSelectedNode.slice(0, 9);
				newContextForCopiedNode = aNewContextForSelectedNode.join("/");
				break;
			case sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION:
				var isNew = false;
				if (selectedTreeNodeDetails.nodeAPFId.indexOf("newConfig") === 0) {
					isNew = true;
				}
				if (!isNew) {
					this.configurationHandler.removeConfiguration(selectedTreeNodeDetails.nodeAPFId, function(id) {
						var noConfigSelected;
						var aConfigForTree = self.oModel.getData().aConfigDetails;
						var configListExists = (self.configurationHandler.getList().length > 0) ? true : false;
						aConfigForTree.splice(indexOfConfig, 1);
						self.oModel.getData().aConfigDetails = aConfigForTree;
						self.oModel.updateBindings();
						if (selectContext) {
							var context = {
								appId : self.appId,
								configId : self.selectedNode.getBindingContext().getObject().AnalyticalConfiguration
							};
							sap.ui.core.UIComponent.getRouterFor(self).navTo(self.selectedNode.getBindingContext().getObject().type, context);
						} else {
							self.clearTitleAndBreadCrumb();
							self.byId("idConfigDetailData").removeAllContent(); //Remove All Previous Stacked Content from DOM
							if (configListExists) {
								noConfigSelected = new sap.m.Label().addStyleClass("noConfigSelected");
								noConfigSelected.setText(self.oCoreApi.getText("noConfigSelected"));
								noConfigSelected.placeAt(self.byId("idConfigDetailData"));
								self.toolbarController.disableCopyDeleteButton();
								self.disableExportButton();
							} else {
								noConfigSelected = new sap.m.Label().addStyleClass("addNewConfig");
								noConfigSelected.setText(self.oCoreApi.getText("addNewConfig"));
								noConfigSelected.placeAt(self.byId("idConfigDetailData"));
								self.toolbarController.disableCopyDeleteButton();
								self.disableExportButton();
							}
						}
					});
				} else {
					var noConfigSelected;
					var aConfigForTree = self.oModel.getData().aConfigDetails;
					aConfigForTree.splice(indexOfConfig, 1);
					self.oModel.getData().aConfigDetails = aConfigForTree;
					self.oModel.updateBindings();
					if (selectContext) {
						var context = {
							appId : self.appId,
							configId : self.selectedNode.getBindingContext().getObject().AnalyticalConfiguration
						};
						sap.ui.core.UIComponent.getRouterFor(self).navTo(self.selectedNode.getBindingContext().getObject().type, context);
					} else {
						self.clearTitleAndBreadCrumb();
						self.byId("idConfigDetailData").removeAllContent(); //Remove All Previous Stacked Content from DOM
						var configListExists = (this.configurationHandler.getList().length > 0) ? true : false;
						if (configListExists) {
							noConfigSelected = new sap.m.Label().addStyleClass("noConfigSelected");
							noConfigSelected.setText(self.oCoreApi.getText("noConfigSelected"));
							noConfigSelected.placeAt(self.byId("idConfigDetailData"));
							self.toolbarController.disableCopyDeleteButton();
							self.disableExportButton();
						} else {
							noConfigSelected = new sap.m.Label().addStyleClass("addNewConfig");
							noConfigSelected.setText(self.oCoreApi.getText("addNewConfig"));
							noConfigSelected.placeAt(self.byId("idConfigDetailData"));
							self.toolbarController.disableCopyDeleteButton();
							self.disableExportButton();
						}
					}
				}
			case "default":
				break;
		}
		if (selectContext) {
			this.bNavDeletionMode = true; //On deletion selected and previous node are same in order to bypass set this boolean
		}
		if (selectedTreeNodeDetails.nodeObjectType !== sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.CONFIGURATION) {
			this.configEditor.setIsUnsaved();
			this.clearTitleAndBreadCrumb();
			this.byId("idConfigDetailData").removeAllContent();
			newContextForCopiedNode = selectContext || newContextForCopiedNode;
			this.oModel.updateBindings(); // Update the tree to reflect deletion
			this.selectedNode = this.oTreeInstance.getNodeByContext(newContextForCopiedNode);
			this.bProgramaticSelection = false;
			this.oTreeInstance.setSelection(this.selectedNode);
			if (selectContext) {
				this.selectedNode.getBindingContext().getObject().isSelected = true; //On Nav make the selected node to be selected
				this.oModel.updateBindings(); // Update the tree to reflect deletion
			}
		}
		var confirmationDialog = (this.toolbarController.confirmationDialog === undefined) ? false : this.toolbarController.confirmationDialog.isOpen;
		if (confirmationDialog && !selectContext) {
			this.toolbarController.confirmationDialog.close();
		}
	},
	handleNavBack : function() {
		var subViewInstance;
		var self = this;
		if (this.byId("idConfigDetailData").getContent().length >= 1) {
			subViewInstance = (typeof this.byId("idConfigDetailData").getContent()[0].getController === "function") ? this.byId("idConfigDetailData").getContent()[0].getController() : undefined;
		}
		//check if there is any unsaved change
		var navigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
		var isMandatoryFilled = (subViewInstance !== undefined) ? (typeof subViewInstance.getValidationState === "function" ? subViewInstance.getValidationState.call(subViewInstance) : true) : true;
		this.bIsSaved = this.configEditor ? this.configEditor.isSaved() : undefined;
		var configListExists = (self.configurationHandler.getList().length > 0) ? true : false;
		var isDirtyState = false;
		var navAppList = function(context) {
			if (this.selectedNode) {//Clear the selectedNode
				this.selectedNode = null;
			}
			this.oModel = new sap.ui.model.json.JSONModel({
				aConfigDetails : []
			});
			this.getView().setModel(this.oModel);
			sap.ui.core.UIComponent.getRouterFor(this).navTo("applicationList");
		};
		if (configListExists) { //if config list exists then perform other checks
			if (!isMandatoryFilled) { //check mandatory state
				navigationHandlerInstance.throwMandatoryPopup(self, {
					yes : function() {
						var navState = self._navMandatoryResetState(self);
						var configList = self.configurationHandler.getList();
						if (navState.bIsSaved === false && configList.length > 0) {
							navigationHandlerInstance.throwLossOfDataPopup(self, {
								yes : function(saveEditor) {
									saveEditor();
									navAppList.call(self);
								},
								no : function() {
									var routeContext = self.getRouteContext(self.oParentNodeDetails);
									self.configurationHandler.resetConfiguration(self.configId);
									if (self.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //If new confiuration splice from model before navigating 
										self._navHandleExpandDelete.call(self, {}, {
											configId : self.configId
										}, routeContext);
									}
									navAppList.call(self);
								}
							});
						} else {
							navAppList.call(self);
						}
					}
				});
				isDirtyState = true;
			}
			var bSavedState = (self.bIsSaved === undefined) ? true : self.bIsSaved;
			//On check of saved state and mandatory field filled
			if (!bSavedState && isMandatoryFilled) {
				navigationHandlerInstance.throwLossOfDataPopup(self, {
					yes : function(saveEditor) {
						saveEditor();
						navAppList.call(self);
					},
					no : function() {
						var routeContext = self.getRouteContext(self.oParentNodeDetails);
						self.configurationHandler.resetConfiguration(self.configId);
						if (self.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //If new confiuration splice from model before navigating 
							self._navHandleExpandDelete.call(self, {}, {
								configId : self.configId
							}, routeContext);
						}
						navAppList.call(self);
					}
				});
				isDirtyState = true;
			}
		}
		if (!isDirtyState) { //In clean state proceed to app list view
			navAppList.call(self);
		}
	},
	handleSavePress : function() { //Need to be refactored currently comprises of logic to close delete dialog and navigate to different which defeats purpose of its use
		var subViewInstance;
		var self = this;
		this.selectedNode = this.oTreeInstance.getSelection();
		if (this.selectedNode) {
			var sBindingContext = this.selectedNode.getBindingContext().sPath;
			var aContextForSelectedNode = sBindingContext.split("/");
			var indexOfConfig = aContextForSelectedNode[2];
		}
		if (this.byId("idConfigDetailData").getContent().length >= 1) {
			subViewInstance = (typeof this.byId("idConfigDetailData").getContent()[0].getController === "function") ? this.byId("idConfigDetailData").getContent()[0].getController() : undefined;
		}
		var saveAction = function() {
			var self = this;
			self.configEditor.save(function(id, metadata, messageObject) {
				if (messageObject === undefined) {
					self.oModel.getData().aConfigDetails[indexOfConfig].AnalyticalConfiguration = id;
					self.oModel.updateBindings();
					self.oSelectedNodeDetails = self.oTreeInstance.getNodeContext(self.selectedNode);
					self.oParentNodeDetails = self.oTreeInstance.getParentNodeContext(self.oSelectedNodeDetails);
					self.navigateToDifferntView(self.oParentNodeDetails, self.oSelectedNodeDetails, true, false);
					var successMessageOnSave = self.oCoreApi.getText("successOnSave");
					sap.m.MessageToast.show(successMessageOnSave, {
						width : "20em"
					});
				} else {
					var oMessageObject = self.oCoreApi.createMessageObject({
						code : "12000"
					});
					oMessageObject.setPrevious(messageObject);
					self.oCoreApi.putMessage(oMessageObject);
					var errorMessageOnSave = self.oCoreApi.getText("errorOnSave");
					sap.m.MessageToast.show(errorMessageOnSave, {
						width : "20em"
					});
				}
			});
		};
		//check if there is any unsaved change
		var navigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
		var isMandatoryFilled = (subViewInstance !== undefined) ? (typeof subViewInstance.getValidationState === "function" ? subViewInstance.getValidationState.call(subViewInstance) : true) : true;
		this.bIsSaved = this.configEditor ? this.configEditor.isSaved() : undefined;
		var isDirtyState = false;
		if (!isMandatoryFilled) { //check mandatory state
			navigationHandlerInstance.throwMandatoryPopup(self, {
				yes : function() {
					self._navMandatoryResetState(self);
					saveAction.call(self);
				}
			});
			isDirtyState = true;
		}
		if (!isDirtyState) {
			saveAction.call(this);
			this.toolbarController.closeDialog();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_handleExportButtonPress
	 * @description Handler for press of export button
	 * */
	_handleExportButtonPress : function() {
		var subViewInstance;
		var self = this;
		if (this.byId("idConfigDetailData").getContent().length >= 1) {
			subViewInstance = (typeof this.byId("idConfigDetailData").getContent()[0].getController === "function") ? this.byId("idConfigDetailData").getContent()[0].getController() : undefined;
		}
		//check if there is any unsaved change
		var navigationHandlerInstance = sap.apf.modeler.ui.utils.navigationHandler.getInstance();
		var isMandatoryFilled = (subViewInstance !== undefined) ? (typeof subViewInstance.getValidationState === "function" ? subViewInstance.getValidationState.call(subViewInstance) : true) : true;
		this.bIsSaved = this.configEditor ? this.configEditor.isSaved() : undefined;
		var isDirtyState = false;
		var exportAction = function() {
			if (!this.exportConfigurationDialog) {
				this.exportConfigurationDialog = sap.ui.xmlfragment("idExportConfigurationFragment", "sap.apf.modeler.ui.fragment.exportConfiguration", this);
				this.getView().addDependent(this.exportConfigurationDialog);
				this._setExportConfigDialogText();
				this._addStyleClassForExportDialog();
			}
			jQuery.sap.syncStyleClass("sapUiSizeCompact", this.getView(), this.exportConfigurationDialog);
			this.exportConfigurationDialog.open();
		};
		var disableBtnOnNoConfigSelected = function() {
			var noConfigSelected = new sap.m.Label().addStyleClass("noConfigSelected");
			noConfigSelected.setText(self.oCoreApi.getText("noConfigSelected"));
			noConfigSelected.placeAt(self.byId("idConfigDetailData"));
			self.toolbarController.disableCopyDeleteButton();
			self.disableExportButton();
		};
		var onUnsavedState;
		if (!isMandatoryFilled) { //check mandatory state
			navigationHandlerInstance.throwMandatoryPopup(self, {
				yes : function() {
					var navState = self._navMandatoryResetState(self);
					var configListExists = (self.configurationHandler.getList().length > 0) ? true : false;
					if (configListExists) {
						if (!navState.bIsSaved) {
							onUnsavedState(self); //Throw loss of data pop up
						} else {
							if (self.oParentNodeDetails.configurationId.indexOf("newConfig") !== 0) {
								exportAction.call(self);
							}
						}
					} else {
						disableBtnOnNoConfigSelected();
					}
				}
			});
			isDirtyState = true;
		}
		onUnsavedState = function(context) {
			navigationHandlerInstance.throwLossOfDataPopup(context, {
				yes : function(saveEditor) {
					self._navSaveState(function() {
						saveEditor(function(id) {
							if (self.selectedNode) {
								var sBindingContext = self.selectedNode.getBindingContext().sPath;
								var aContextForSelectedNode = sBindingContext.split("/");
								var indexOfConfig = aContextForSelectedNode[2];
							}
							self.oModel.getData().aConfigDetails[indexOfConfig].AnalyticalConfiguration = self.configId;
							self.oModel.updateBindings();
							exportAction.call(self);
						});
					});
				},
				no : function() {
					var routeContext = self.getRouteContext(self.oParentNodeDetails);
					if (self.configId.indexOf(sap.apf.modeler.ui.utils.CONSTANTS.configurationObjectTypes.ISNEWCONFIG) === 0) { //If new confiuration splice from model before navigating 
						self._navHandleExpandDelete.call(self, {}, {
							configId : self.configId
						}, routeContext);
						self.clearTitleAndBreadCrumb();
						self.byId("idConfigDetailData").removeAllContent(); //Remove All Previous Stacked Content from DOM
						var configListExists = (self.configurationHandler.getList().length > 0) ? true : false;
						var noConfigSelected;
						if (!configListExists) {
							disableBtnOnNoConfigSelected();
						}
					} else {
						self._navConfigResetState(self, function() {
							self._navHandleExpandDelete.call(self, self.oSelectedNodeDetails, routeContext);
							exportAction.call(self);
						});
					}
				}
			});
		};
		//On check of saved state and mandatory field filled
		if (!self.bIsSaved && isMandatoryFilled) {
			onUnsavedState(self);
			isDirtyState = true;
		}
		if (!isDirtyState) {//In clean state proceed to app list view
			exportAction.call(self);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_enableExportButton
	 * @description Enables export button
	 * */
	_enableExportButton : function() {
		if (!this.byId("idExportbutton").getEnabled()) {
			this.byId("idExportbutton").setEnabled(true);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#disableExportButton
	 * @description Disables export button
	 * */
	disableExportButton : function() {
		if (this.byId("idExportbutton").getEnabled()) {
			this.byId("idExportbutton").setEnabled(false);
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_setExportConfigDialogText
	 * @description Sets text for export dialog
	 * */
	_setExportConfigDialogText : function() {
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idExportConfigDialog").setTitle(this.oCoreApi.getText("exportConfig"));
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idOpenConfig").setText(this.oCoreApi.getText("openConfig"));
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idOpenTextProperty").setText(this.oCoreApi.getText("openTextProperty"));
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idCloseButton").setText(this.oCoreApi.getText("close"));
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_addStyleClassForExportDialog
	 * @description Adds style class to the export configuration dialog
	 * */
	_addStyleClassForExportDialog : function() {
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idOpenConfig").addStyleClass("configLink");
		sap.ui.core.Fragment.byId("idExportConfigurationFragment", "idOpenTextProperty").addStyleClass("textPropertyLink");
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_handleCloseOfExportDialog
	 * @description Handler for close of export configuration dialog
	 * */
	_handleCloseOfExportDialog : function() {
		if (this.exportConfigurationDialog.isOpen()) {
			this.exportConfigurationDialog.close();
		}
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_handleOpenConfigLinkPress
	 * @description Handler for press of configuration link  in export dialog
	 * */
	_handleOpenConfigLinkPress : function() {
		var self = this;
		this.configurationHandler.exportConfiguration(this.configId, function(configurationString) {
			self._openFile(configurationString);
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_handleCloseOfExportDialog
	 * @description Handler for press of text properties link  in export dialog
	 * */
	_handleOpenTextsLinkPress : function() {
		var self = this;
		this.configurationHandler.exportConfiguration(this.configId, function(configurationString) {
			var exportedTexts = self.configurationHandler.exportTexts();
			self._openFile(exportedTexts);
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.modeler.ui.controller.configurationList#_openFile
	 * @description Opens contents of the file in a new read only popup window
	 * */
	_openFile : function(file) {
		var encodedData = encodeURIComponent(file);
		var newTab;
		newTab = window.open("about:blank", "", "_blank");
		newTab.document.write("<textarea rows='50' cols='160'readonly>" + decodeURIComponent(encodedData) + "</textarea>");
	}
});

}; // end of sap/apf/modeler/ui/controller/configurationList.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.instance') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.apf.ui.instance");
//FIXME: Lazy load print only when required



//FIXME: Load vizhelper within each representation, where it is used.
//jQuery.sap.require('sap.apf.ui.representations.utils.vizHelper');
//FIXME: Lazy load representations when required








/**
 *@class Ui Component Instance
 *@name sap.apf.ui.Instance
 *@description Creation of new Ui Component Instance
 *@param {object} oInject - Core Instance
 */
sap.apf.ui.Instance = function(oInject) {
	oInject.uiApi = this;
	var oCoreApi = oInject.oCoreApi;
	var oComponent = oInject.oComponent;
	var oSBHandler = oInject.oSBHandler;
	var oStartParameter = oInject.oStartParameter;
	var stepContainer;
	var analysisPath;
	var messageHandler;
	var oSBEvaluation;
	var apfLocation = oCoreApi.getUriGenerator().getApfLocation();
	this.oEventCallbacks = {};
	//sap.ui.getCore().loadLibrary('sap.viz');
	jQuery.sap.includeStyleSheet(apfLocation + "resources/css/apfUi.css", "apfCss");
	jQuery.sap.includeStyleSheet(apfLocation + "resources/css/apfPrint.css", "printCss");
	jQuery("#printCss").attr("media", "print"); // @comment : Doesn't Support adding attribute
	/**
	 *@description Getter for Analysis Path layout
	 *@see sap.apf.ui.reuse.view.analysisPath
	 *@returns {analysisPath}
	 */
	this.getAnalysisPath = function() {
		if (analysisPath === undefined) {
			analysisPath = sap.ui.view({
				viewName : "sap.apf.ui.reuse.view.analysisPath",
				type : sap.ui.core.mvc.ViewType.JS,
				viewData : oInject
			});
		}
		return analysisPath;
	};
	/**
	 *@description Getter for Notification Bar
	 *@see sap.apf.ui.reuse.view.messageHandler
	 *@returns {oNotificationView }
	 */
	this.getNotificationBar = function() {
		if (messageHandler === undefined) {
			messageHandler = sap.ui.view({
				viewName : "sap.apf.ui.reuse.view.messageHandler",
				type : sap.ui.core.mvc.ViewType.JS,
				viewData : oInject
			});
		}
		return messageHandler;
	};
	/**
	 *@description Creates a step container to hold representation
	 *@see sap.apf.ui.reuse.view.stepContainer
	 *@returns {stepContainer}
	 */
	this.getStepContainer = function() {
		if (stepContainer === undefined) {
			stepContainer = sap.ui.view({
				viewName : "sap.apf.ui.reuse.view.stepContainer",
				type : sap.ui.core.mvc.ViewType.JS,
				viewData : oInject
			});
		}
		return stepContainer;
	};
	/**
	 *@memberOf sap.apf.Api#addMasterFooterContent
	 *@description Calls the updatePath with proper callback for UI. 
	 * 				It also refreshes the steps either from the active step or 
	 * 				all the steps depending on the boolean value passed.
	 *@param {boolean} 
	 */
	this.selectionChanged = function(bRefreshAllSteps) {
		if (bRefreshAllSteps) {
			this.getAnalysisPath().getController().refresh(0);
		} else {
			var nActiveStepIndex = oCoreApi.getSteps().indexOf(oCoreApi.getActiveStep());
			this.getAnalysisPath().getController().refresh(nActiveStepIndex + 1);
		}
		oCoreApi.updatePath(this.getAnalysisPath().getController().callBackForUpdatePath.bind(this.getAnalysisPath().getController()));
	};
	var applicationLayout;
	var oSBHelper;
	/**
	 *@class view
	 *@name view
	 *@memberOf sap.apf.ui
	 *@description holds views for ui
	 */
	/**
	 *@memberOf sap.apf.ui
	 *@description returns app
	 *@return Application
	 */
	var application = new sap.m.App().addStyleClass("sapApf");
	var bIsAppLayoutCreated = false;
	this.createApplicationLayout = function() {
		// Ensure layout page is added only once
		if (!bIsAppLayoutCreated) {
			application.addPage(this.getLayoutView());
			bIsAppLayoutCreated = true;
		}
		return application;
	};
	/**
	 *@memberOf sap.apf.ui
	 *@description Creates a main application layout with the header and main
	 *              view
	 *@return layout view
	 */
	this.getLayoutView = function() {
		if (applicationLayout === undefined) {
			applicationLayout = sap.ui.view({
				viewName : "sap.apf.ui.reuse.view.layout",
				type : sap.ui.core.mvc.ViewType.XML,
				viewData : oInject
			});
		}
		return applicationLayout;
	};
	/**
	 *@memberOf sap.apf.ui
	 *@description adds content to detail footer
	 *@param oControl
	 *            {object} Any valid UI5 control
	 */
	this.addDetailFooterContent = function(oControl) {
		this.getLayoutView().getController().addDetailFooterContentLeft(oControl);
	};
	/**
	 *@memberOf sap.apf.ui
	 *@description adds content to master footer
	 *@param oControl
	 *            {object} Any valid UI5 control
	 */
	this.addMasterFooterContentRight = function(oControl) {
		this.getLayoutView().getController().addMasterFooterContentRight(oControl);
	};
	/**
	 *@memberOf sap.apf.ui
	 *@description registers callback for event callback.
	 *@param fn callback
	 */
	this.setEventCallback = function(sEventType, fnCallback) {
		this.oEventCallbacks[sEventType] = fnCallback;
	};
	/**
	 *@memberOf sap.apf.ui
	 *@returns the registered callback for event callback.
	 */
	this.getEventCallback = function(sEventType) {
		return this.oEventCallbacks[sEventType];
	};
	var oFacetFilterHandler;
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui#initializeContextHandling
	 * @memberOf sap.apf.ui
	 * @param {Object} SB Handler Instance
	 * @param {String} Type of Navigation mode-Eg- Forward,Backward
	 * @description initializes the context handling by instantiating an initializing the facet filter handler.
	 */
	this.initializeContextHandling = function(oSBHandler, mode) {
		var dependency = {
			oCoreApi : oCoreApi,
			oPathContextHandler : oInject.oPathContextHandler,
			oSBHandler : oSBHandler,
			oUiApi : this,
			mode : mode
		};
		oFacetFilterHandler = new sap.apf.ui.utils.FacetFilterHandler(dependency);
		oFacetFilterHandler.initialize();
	};
	/**
	 * @private
	 * @experimental Refactoring trigerred by the Mozilla bug
	 * @name sap.apf.ui#drawFacetFilter
	 * @member of sap.apf.ui
	 * @param {Object} subHeaderInstance - Pass the sub header instance to add the facet filter view item
	 * @description draws facet filter on layout subHeader.
	 */
	this.drawFacetFilter = function(subHeaderInstance) {
		if (oFacetFilterHandler) {
			oFacetFilterHandler.drawFacetFilter(subHeaderInstance);
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui#contextChanged
	 * @param {boolean} bResetPath - True when new path is triggered.
	 * @memberOf sap.apf.ui
	 * @description Event to be called when the path context is changed/updated.
	 * Notifies facetfilterhandler and application of context change.
	 */
	this.contextChanged = function(bResetPath) {
		if (oFacetFilterHandler) {
			oFacetFilterHandler.contextChanged();
		}
		var fnCallback = this.getEventCallback(sap.apf.core.constants.eventTypes.contextChanged);
		if (typeof fnCallback === "function") {
			var oSerializedFilter;
			if (!bResetPath) {
				oSerializedFilter = oCoreApi.getContext().serialize();
			}
			fnCallback(oSerializedFilter);
		}
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui#getFormattedFilters
	 * @param {string} sProperty - Property name of filter.
	 * @memberOf sap.apf.ui
	 * @description Currently used by printHelper to get formatted filter values.
	 * @returns {Array} when property is available as a facet filter.
	 * 		Array will be of the form : [{
	 * 			name: "sPropertyText",
	 * 			operator: "EQ",
	 * 			value: "sKey - sText",
	 * 			formatted: true
	 * 		}] 
	 * null when property is not available as a facet filter.
	 * */
	this.getFormattedFilters = function(sProperty) {
		if (oFacetFilterHandler) {
			return oFacetFilterHandler.getFormattedFilters(sProperty);
		}
	};
	this.handleStartup = function(promise) {
		var that = this;
		var promiseUi = jQuery.Deferred();
		var promiseStartup = jQuery.Deferred();
		var oSBHandler;
		promise.done(function(mode) {
			if (mode.navigationMode === 'backward') {
				promiseUi.done(function() {
					that.getAnalysisPath().getController().bIsBackNavigation = true; //FIXME Boolean to set busy indicator to false
					oCoreApi.updatePath(that.getAnalysisPath().getController().callBackForUpdatePath.bind(that.getAnalysisPath().getController()));
					promiseStartup.resolve();
				});
			}
			if (mode.navigationMode === 'forward') {
				if (oStartParameter.getEvaluationId()) {
					var oSBHandlerDependencies = {
						getApplicationConfigProperties : oCoreApi.getApplicationConfigProperties,
						createReadRequestByRequiredFilter : oCoreApi.createReadRequestByRequiredFilter,
						getTextNotHtmlEncoded : oCoreApi.getTextNotHtmlEncoded,
						startParameter : oStartParameter,
						oMessageHandler : oCoreApi.getMessageHandler()
					};
					oSBHandler = new sap.apf.utils.SmartBusinessHandler(oSBHandlerDependencies);
				}
				promiseUi.done(function() {
					if(mode.sapApfCumulativeFilter){
						oInject.oPathContextHandler.update('ApfInitialContext', sap.apf.utils.Filter.createFilterFromSapUi5FilterJSON(oCoreApi.getMessageHandler(),mode.sapApfCumulativeFilter));
					}
					
					if (oCoreApi.getStartParameterFacade().getSteps()) {
						var stepId = oCoreApi.getStartParameterFacade().getSteps()[0].stepId;
						var repId = oCoreApi.getStartParameterFacade().getSteps()[0].representationId;
						var callback = that.getAnalysisPath().getController().callBackForUpdatePathAndSetLastStepAsActive.bind(that.getAnalysisPath().getController());
						oCoreApi.createFirstStep(stepId, repId, callback);
					}
					
					promiseStartup.resolve();
				});
			}
			that.initializeContextHandling(oSBHandler, mode.navigationMode);
			that.drawFacetFilter(that.getLayoutView().byId("subHeader"));
			if (oSBHandler) {
				oSBHandler.getAllFilters().then(function() {
					promiseUi.resolve();
				});
			} else {
				promiseUi.resolve();
			}
		});
		return promiseStartup.promise();
	};
};

}; // end of sap/apf/ui/instance.js
if ( !jQuery.sap.isDeclared('sap.apf.ui.reuse.controller.facetFilter.controller') ) {
  jQuery.sap.declare('sap.apf.ui.reuse.controller.facetFilter.controller');
/*!
* SAP APF Analysis Path Framework
* 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
*/

/**
* @class facetFilter
* @memberOf sap.apf.ui.reuse.controller
* @name facetFilter
* @description controller for view.facetFilter
*/
sap.ui.controller("sap.apf.ui.reuse.controller.facetFilter", {
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#onInit
	 * @description Called on initialization of the view.
	 * Instantiates all facet filter list related resources.
	 * Sets the initial binding.
	 * Populates value help and selected filters.
	 * */
	onInit : function() {
		var oSelf = this;
		this.oView = this.getView();
		this.oCoreApi = this.oView.oCoreApi;
		this.oUiApi = this.oView.oUiApi;
		this.oPathContextHandler = this.oView.oPathContextHandler;
		this.aFacetFilterListData = this.oView.aFacetFilterListData;
		this.aFacetFilterListControls = this.oView.aFacetFilterListControls;
		this.aFacetFilterListHandlers = this.aFacetFilterListData.map(function(oFacetFilterData) {
			return new sap.apf.ui.utils.FacetFilterListHandler(oSelf.oCoreApi, oSelf.oUiApi, oSelf.oPathContextHandler, oFacetFilterData);
		});
		this.aFacetFilterListDatasets = this.aFacetFilterListData.map(function() {
			return [];
		});
		this.aCachedSelections = this.aFacetFilterListData.map(function() {
			return [];
		});
		this.aSizeLimitForLists = this.aFacetFilterListData.map(function() {
			return 100; // Default Size Limit of sapUI5 controls.
		});
		this._setInitialBinding();
		this._populateValueHelpData();
		this._updateSelectedFilters();
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#_setInitialBinding
	 * @description Binds the appropriate JSONModel to facet filter list controls.
	 * */
	_setInitialBinding : function() {
		var oSelf = this;
		this.aFacetFilterListControls.forEach(function(oFacetFilterListControl, index) {
			oFacetFilterListControl.bindItems("/", new sap.m.FacetFilterItem({
				key : '{key}',
				text : '{text}',
				selected : '{selected}'
			}));
			var oModel = new sap.ui.model.json.JSONModel(oSelf.aFacetFilterListDatasets[index]);
			oFacetFilterListControl.setModel(oModel);
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#_populateValueHelpData
	 * @description Fetches value help data for all facet filter list controls.
	 * */
	_populateValueHelpData : function() {
		var oSelf = this;
		this.aFacetFilterListHandlers.forEach(function(oFflHandler, index) {
			oFflHandler.fetchValueHelpData().then(oSelf._populateValueHelpDataFor(index));
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#_updateSelectedFilters
	 * @description Updates selected filter data for all facet filter list controls.
	 * */
	_updateSelectedFilters : function() {
		var oSelf = this;
		this.aFacetFilterListHandlers.forEach(function(oFflHandler, index) {
			oFflHandler.fetchSelectedFilterData().then(oSelf._updateSelectedFilterFor(index));
		});
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#_populateValueHelpDataFor
	 * @param {integer} index of facet filter control.
	 * @description Returns a closure which will be invoked when value help promise is resolved.
	 * @returns {function}
	 * */
	_populateValueHelpDataFor : function(index) {
		var oFacetFilterListControl = this.aFacetFilterListControls[index];
		var oFacetFilterData = this.aFacetFilterListData[index];
		var aFacetFilterListDataSet = this.aFacetFilterListDatasets[index];
		var oFacetFilterListModel = oFacetFilterListControl.getModel();
		var nSizeLimitForList = this.aSizeLimitForLists[index];
		return function(aData) {
			aData.forEach(function(oData) {
				var bSelected = false;
				var nIndex = -1;
				aFacetFilterListDataSet.forEach(function(oDataRow, index) {
					if (oDataRow.key === oData.key) {
						nIndex = index;
						return;
					}
				});
				if (nIndex !== -1) {
					bSelected = aFacetFilterListDataSet[nIndex].selected;
					aFacetFilterListDataSet.splice(nIndex, 1);
				}
				aFacetFilterListDataSet.push({
					key : oData.key,
					text : oData.text,
					selected : bSelected
				});
			});
			//Modify the  size limit of the model based on the length of the data so that all values are shown in the facet filter list.
			if (nSizeLimitForList < aData.length) {
				nSizeLimitForList = aData.length;
				oFacetFilterListModel.setSizeLimit(nSizeLimitForList);
			}
			oFacetFilterListModel.updateBindings();
		};
	},
	/**
	 * @private
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#_updateSelectedFilterFor
	 * @param {integer} index of facet filter control.
	 * @description Returns a closure which will be invoked when selected filter promise is resolved.
	 * 				The facet filter will be removed from the facet filter list if it gets resolved with an error.
	 * @returns {function}
	 * */
	_updateSelectedFilterFor : function(index) {
		var oFacetFilterListControl = this.aFacetFilterListControls[index];
		var oFacetFilterData = this.aFacetFilterListData[index];
		var aFacetFilterListDataSet = this.aFacetFilterListDatasets[index];
		var oFacetFilterListModel = oFacetFilterListControl.getModel();
		var aCachedSelection = this.aCachedSelections[index];
		var nSizeLimitForList = this.aSizeLimitForLists[index];
		return function(aData, oError) {
			if (oError) {
				var oFacetFilterList = oFacetFilterListControl.getParent();
				oFacetFilterList.removeList(index);
				return;
			}
			aFacetFilterListDataSet.forEach(function(oDataRow) {
				oDataRow.selected = false;
			});
			aCachedSelection.splice(0, aCachedSelection.length);
			aData.forEach(function(oData) {
				var aMatchingDataRows = aFacetFilterListDataSet.filter(function(oDataRow) {
					return oDataRow.key === oData.key;
				});
				aMatchingDataRows.forEach(function(oDataRow) {
					oDataRow.selected = true;
				});
				if (!aMatchingDataRows.length) {
					aFacetFilterListDataSet.push({
						key : oData.key,
						text : oData.text,
						selected : true
					});
				}
				aCachedSelection.push(oData.key);
			});
			//Modify the  size limit of the model based on the length of the data so that all values are shown in the facet filter list.
			if (nSizeLimitForList < aData.length) {
				nSizeLimitForList = aData.length;
				oFacetFilterListModel.setSizeLimit(nSizeLimitForList);
			}
			oFacetFilterListModel.updateBindings();
		};
	},
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#onListClose
	 * @param {oEvent} List Close Event.
	 * @description Creates a sap.apf.core.Filter with selected values and update the context path handler.
	 * */
	onListClose : function(oEvent) {
		var oClosedListControl = oEvent.getSource();
		var nIndex = this.aFacetFilterListControls.indexOf(oClosedListControl);
		var sProperty = this.aFacetFilterListData[nIndex].property;
		var bIsAllSelected = oEvent.getParameter('allSelected');
		var aSelectedKeys = [];
		if (bIsAllSelected) {	// Fetch all item keys from model data.
			var oItemBinding = oClosedListControl.getBinding("items");
			var aAllItemData = oItemBinding.getModel().getData();
			aSelectedKeys = aAllItemData.map(function(oData) {
				return oData.key;
			});
		} else {	// Fetch only the selected item keys.
			var aSelectedItems = oEvent.getParameter('selectedItems');
			aSelectedKeys = aSelectedItems.map(function(oItem) {
				return oItem.getKey();
			});
		}
		var aCachedSelections = this.aCachedSelections[nIndex];
		/**
		 * Compare current selections with cache.
		 * */
		if (aSelectedKeys.length === aCachedSelections.length) {
			var sSortedSelectedKeys = JSON.stringify(aSelectedKeys.sort());
			var sSortedCachedSelections = JSON.stringify(aCachedSelections.sort());
			var bFiltersNotChanged = (sSortedSelectedKeys === sSortedCachedSelections);
			if (bFiltersNotChanged) {
				return;
			}
		}
		this.aCachedSelections[nIndex] = aSelectedKeys;
		var oFilter = this.oCoreApi.createFilter();
		var oOrTerm = oFilter.getTopAnd().addOr();
		aSelectedKeys.forEach(function(sValue) {
			oOrTerm.addExpression({
				name : sProperty,
				operator : "EQ",
				value : sValue
			});
		});
		this.oPathContextHandler.update(sProperty, oFilter);
		this.oUiApi.selectionChanged(true);
	},
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#onResetPress
	 * @description Reset the initial filter for all the facet filter list controls and triggers contextChanged.
	 * */
	onResetPress : function() {
		var aFilterProperties = this.aFacetFilterListData.map(function(oFacetFilterData) {
			return oFacetFilterData.property;
		});
		this.oPathContextHandler.restoreInitialContext(aFilterProperties);
		this.onContextChanged();
		this.oUiApi.selectionChanged(true);
	},
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#onContextChanged
	 * @description Invoked by facet filter handler when context is changed.
	 * Updates the facet filter list controls with new path context handler content.
	 * */
	onContextChanged : function() {
		/*this._populateValueHelpData(); UNCOMMENT TO TRIGGER VALUE HELP REQUESTS.*/
		this._updateSelectedFilters();
	},
	/**
	 * @public
	 * @function
	 * @name sap.apf.ui.reuse.controller.facetFilter#getFormattedFilters
	 * @param {string} sProperty - Property name of filter.
	 * @description Currently used by printHelper to get formatted filter values.
	 * @returns {Array} when property is available as a facet filter.
	 * 		Array will be of the form : [{
	 * 			name: "sPropertyText",
	 * 			operator: "EQ",
	 * 			value: "sKey - sText",
	 * 			formatted: true
	 * 		}] 
	 * null when property is not available as a facet filter.
	 * */
	getFormattedFilters : function(sProperty) {
		var aAllProperties = this.aFacetFilterListData.map(function(oFacetFilterListData) {
			return oFacetFilterListData.property;
		});
		var nFilterControlIndex = aAllProperties.indexOf(sProperty);
		if (nFilterControlIndex === -1) {
			return null;
		}
		var oFacetFilterListControl = this.aFacetFilterListControls[nFilterControlIndex];
		var aResultArray = oFacetFilterListControl.getSelectedItems().map(function(oItem) {
			return {
				name : oFacetFilterListControl.getTitle(),
				operator : "EQ",
				value : oItem.getText(),
				formatted : true
			// TODO Get information from facet filter list handler.
			};
		});
		return aResultArray;
	}
});

}; // end of sap/apf/ui/reuse/controller/facetFilter.controller.js
if ( !jQuery.sap.isDeclared('sap.apf.utils.filter') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

(function () {
    'use strict';

    jQuery.sap.declare('sap.apf.utils.filter');
    
    
    

    /**
     * @public
     * @class Filter object
     * @description It is designed to be used for supplying context information for
     *              the application. In addition, it can be used for exchanging
     *              filter values between the path and the facet filters. This function object supports the top down
     *              construction of filter expressions.
     * @name sap.apf.utils.Filter
     * @param {sap.apf.core.MessageHandler} oMessageHandler
     * @param {object} [oSelectionVariant] - optional parameter: selection variant from OpenIn
     * @returns {sap.apf.utils.Filter}
     */
    sap.apf.utils.Filter = function (oMessageHandler, oSelectionVariant) {
        
    	if(oSelectionVariant){
        	return createFromSelectionVariant(oMessageHandler, oSelectionVariant);
        }
        
        // Private vars
        var oTopAnd;
        var that = this;
        var initialize = function () {
            oTopAnd = new sap.apf.utils.FilterAnd(oMessageHandler, sap.apf.utils.Filter.topAndId);
        };
        // Public functions
        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#getById
         * @description Returns filter object or expression for a given ID, if exists.
         * @param {string} sId - ID of the object to be returned.
         * @returns {(sap.apf.utils.FilterAnd|sap.apf.utils.FilterOr|sap.apf.utils.FilterExpression|undefined)}
         */
        this.getById = function (sId) {
            if (oTopAnd) {
                if (sId === sap.apf.utils.Filter.topAndId) {
                    return oTopAnd;
                }
                return oTopAnd.getById(sId);
            } 
            return undefined;
        };
        /**
         * @public
         * @description Contains 'filter'
         * @returns {string}
         */
        this.type = "filter";
        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#getExpressions
         * @description Returns the logical operations and the boolean expressions of a Filter
         *              object as nested arrays for the logical operations and single level objects
         *              for the boolean expressions.
         *              Depending on the nesting level of the arrays the logical operators
         *              for the terms in the arrays alternates between AND and OR.
         *              The array on the highest level has the logical operator AND.
         *              It corresponds to the TopAnd filter term.
         *              Terms in general can be composed of the logical operation AND (see the FilterAnd object)
         *              or OR (see the FilterOr object) or be a boolean expression (see the FilterExpression object).
         *              AND and OR terms are returned as arrays; boolean expressions are returned as objects.
         * @returns {object[]} Array of AND terms, OR terms and expressions.
         */
        this.getExpressions = function () {
            if (oTopAnd) {
                return oTopAnd.getExpressions();
            }
            return [];
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.Filter#getInternalFilter
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {sap.apf.core.utils.Filter}
         */
        this.getInternalFilter = function () {
            return oTopAnd.getInternalFilter();
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#getTopAnd
         * @description Returns the top 'AND' object of the filter.
         * @returns {sap.apf.utils.FilterAnd}
         */
        this.getTopAnd = function () {
            return oTopAnd;
        };

        //fixme provide types for object member below in JSDOC
        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#updateExpression
         * @description Updates an expression.
         * @param {string} sId ID of expression to be updated
         * @param {object} oExpression Expression object containing the updated properties
         * @param oExpression.id Updated expression ID
         * @param oExpression.name Updated expression name
         * @param oExpression.operator Updated expression operator of type  {sap.apf.core.constants.FilterOperators}
         * @param oExpression.value Updated expression low value
         * @param oExpression.high Updated expression high value
         * @returns undefined
         */
        this.updateExpression = function (sId, oExpression) {
            oMessageHandler.check(sId === oExpression.id,
                "sId differs from oExpression.id");
            var oExpressionObject = this.getById(sId);
            oExpressionObject.update(oExpression);
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#updateValue
         * @description Updates a value of an expression object.
         * @param {string} sId ID of the expression object to be updated
         * @param {string} value The new low value for the expression (optional)
         * @param {string} high The new high value for the expression (optional)
         * @returns undefined
         */
        this.updateValue = function (sId, value, high) {
            oMessageHandler.check(sId !== undefined,
                "Filter updateValue: parameter id required");
            oMessageHandler.check(value !== undefined, "Filter updateValue: parameter value is required");
            var oExpressionObject = this.getById(sId);
            oMessageHandler.check(oExpressionObject !== undefined,
                "Filter updateValue: id for expression not valid");
            oExpressionObject.updateValue(value, high);
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.Filter#serialize
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {object}
         */
        this.serialize = function () {
            function getSerializableFilterObject(aCompoundExpressions, oTerm) {
                var oSerializableObject = {
                    id: oTerm.getId(),
                    type: oTerm.type,
                    expressions: [],
                    terms: []
                };
                aCompoundExpressions.forEach(function(compoundExpression,i){
                    if (compoundExpression instanceof Array) {
                        if (oTerm.type === "filterAnd") {
                            oSerializableObject.terms
                                .push(getSerializableFilterObject(
                                    compoundExpression, oTerm
                                        .getAndTerms()[i]));
                        } else if (oTerm.type === "filterOr") {
                            oSerializableObject.terms
                                .push(getSerializableFilterObject(
                                    compoundExpression, oTerm
                                        .getOrTerms()[i]));
                        }
                    } else {
                        oSerializableObject.expressions
                            .push(compoundExpression);
                    }
                });
                return oSerializableObject;
            }

            return getSerializableFilterObject(this.getTopAnd()
                .getExpression(), this.getTopAnd());
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.Filter#deserialize
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @param {object} oSerializableFilter
         * @returns {object}
         */
        this.deserialize = function (oSerializableFilter) {
            oTopAnd = undefined;
            initialize();
            function getDeserializedFilter(oSerializableFilter, oTerm) {
                if (oSerializableFilter.type === "filterAnd"
                    && oSerializableFilter.id !== sap.apf.utils.Filter.topAndId) {
                    oTerm = oTerm.addAnd(oSerializableFilter.id);
                } else if (oSerializableFilter.type === "filterOr"
                    && oSerializableFilter.id !== sap.apf.utils.Filter.topAndId) {
                    oTerm = oTerm.addOr(oSerializableFilter.id);
                }
                oSerializableFilter.expressions.forEach(function(expression){
                	oTerm.addExpression(expression);
                });
                oSerializableFilter.terms.forEach(function(term){
                	getDeserializedFilter(term, oTerm);
                });
            }

            getDeserializedFilter(oSerializableFilter, this.getTopAnd());
            return this;
        };

        /**
         * @private
         * @function
         * @deprecated
         * @name sap.apf.utils.Filter#addAnd
         * @description Deprecated since 1.23.0. Will be discarded with 1.26.0
         */
        this.addAnd = function (sId) {
            jQuery.sap.log.error("Method 'addAnd' is deprecated since 1.23.0", "Will be discarded with 1.26.0.");
        };

        /**
         * @public
         * @function
         * @name sap.apf.utils.Filter#intersectWith
         * @description Build the intersection of the this filter object with the supplied filter(s). The method does not change the "this"-instance.
         * @param args {(...sap.apf.utils.Filter|sap.apf.utils.Filter[])} Single filter object {@link sap.apf.utils.Filter}, a comma separated parameter list of filter objects, or an array of filter objects
         * @returns {sap.apf.utils.Filter} new filter object {@link sap.apf.utils.Filter} for the intersected filters
         */
        this.intersectWith = function (args) {

            var i = 0;
            var aFilter = [];
            var oFilter;
            var oResultFilter = new sap.apf.utils.Filter(oMessageHandler);
            var oResultSerialization = that.serialize(); // Start-result is from "that"-instance
            setNewIds(oResultSerialization);

            //Handle different call types
            switch (arguments.length) {
                case 1:
                    oFilter = arguments[0];
                    if (oFilter instanceof Array) {
                        aFilter = oFilter;
                    }                              //Call type III
                    else {
                        aFilter.push(oFilter);
                    }                          //Call type I
                    break;
                default:
                    aFilter = Array.prototype.slice.call(arguments, 0);  //Call type II
            }

            aFilter.forEach(
                function (oFilterItem) {
                    oMessageHandler.check((oFilterItem instanceof sap.apf.utils.Filter), "Parameter value is not of type sap.apf.utils.Filter");
                    var oItemSerialization = oFilterItem.serialize();
                    setNewIds(oItemSerialization);
                    //append the items of the second array to the first array:
                    Array.prototype.push.apply(oResultSerialization.expressions, oItemSerialization.expressions);
                    Array.prototype.push.apply(oResultSerialization.terms, oItemSerialization.terms);
                }
            );

            oResultFilter.deserialize(oResultSerialization);
            return oResultFilter;

            function setNewIds(oSerializedFilter) {
                if (oSerializedFilter.id !== sap.apf.utils.Filter.topAndId) {
                    oSerializedFilter.id = '#' + i++ + '#';
                }
                oSerializedFilter.terms.forEach(setNewIds);
            }
        };

        initialize();
        return this;
        
        //------------------------------------
        
        function createFromSelectionVariant (oMessageHandler, oSelectionVariant){
        	
        	if(!oSelectionVariant.operator || 
        	   oSelectionVariant.operator !== sap.apf.core.constants.BooleFilterOperators.AND ||
        	   !oSelectionVariant.terms ||
        	   !oSelectionVariant.terms instanceof Array){
        		oMessageHandler.check(false,"sap.apf.utils.Filter - createFromSelectionVariant - wrong structure of selection variant");  		
        	}
        	var result = new sap.apf.utils.Filter(oMessageHandler),
        	    filterOr;
        	oSelectionVariant.terms.forEach(function(oTerm){
        		if( !oTerm.property ||
        		    !oTerm.operator || 
        		     oTerm.operator !== sap.apf.core.constants.BooleFilterOperators.OR ||
        		    !oTerm.expressions ||
        		    !oTerm.terms instanceof Array){
        		   		oMessageHandler.check(false,"sap.apf.utilsFilter - createFromSelectionVariant - wrong structure of selection variant");  		
        		    }
          		filterOr = result.getTopAnd().addOr();
        		oTerm.expressions.forEach(function(oExpression){
        			if(!oExpression.option ||
        			   !oExpression.low ){
        		   		oMessageHandler.check(false,"sap.apf.utils.Filter - createFromSelectionVariant - wrong structure of selection variant");  		
    		        }
        			filterOr.addExpression({
    			    				name: 	  oTerm.property,
    			    				operator: oExpression.option,
    			    				value:    oExpression.low,
    			    				high:     oExpression.high
        						});
        		});
        	});
        	return result;
        }
    };
    
    function getFilterTerms(path, oFilter) {
		var result = [];
		var i, len;
		if (oFilter.filters) {
			oFilter.filters.forEach(function(filter) {
				result = result.concat(getFilterTerms(path, filter));
			});
			
			return result;
		} else if (oFilter.path) {
			if (oFilter.path === path) {
				return [ oFilter];
			} else {
				return [];
			}
		}
	}
    
    /**
     * @public
     * @function
     * @name sap.apf.utils.Filter#createFilterFromSapUi5FilterJSON
     * @description Creates a filter from json format, that comes from selection variant. Apf creates this filter format with
     * method sap.apf.core.utils.Filter#mapToSapUI5FilterExpression. See there for description of the format.
     * @returns {sap.apf.utils.Filter} 
     */
    sap.apf.utils.Filter.createFilterFromSapUi5FilterJSON = function(messageHandler, sapUi5FilterFormat) {
    	var result = new  sap.apf.utils.Filter(messageHandler);

  
    	function addNextLevel(filter, level, format) {
			var filterTerm;
			level++;
			if (format.filters) {
				if (format.and) {
					if (level !== 1) {
						filterTerm = filter.addAnd();
					} else {
						filterTerm = filter;
					}			
				} else {
					filterTerm = filter.addOr();
				}
				format.filters.forEach(function(element) {
					addNextLevel(filterTerm, level, element);
				});		
			} else {
				
				if(format.operator){ //TODO this is an additional check because mapToSapUI5FilterExpression() produces a an empty expression. Fix issue in mapToSapUI5FilterExpression()
					filter.addExpression({
						name : format.path,
						operator : format.operator,
						value : format.value1,
						high : format.value2
					});
				}
			}
		}

    	addNextLevel(result.getTopAnd(), 0, sapUi5FilterFormat);
    	return result;
    };
    
    /**
     * @public
     * @function
     * @name sap.apf.utils.Filter#getOperators
     * @description Convenience function to get the OData operators which are
     *              defined in {sap.apf.core.constants.FilterOperators}.
     * @returns {sap.apf.core.constants.FilterOperators} 
     */
    sap.apf.utils.Filter.getOperators = function () {
        return sap.apf.core.constants.FilterOperators;
    };
    sap.apf.utils.Filter.prototype.getOperators = sap.apf.utils.Filter.getOperators;
    
// Static public vars
    sap.apf.utils.Filter.topAndId = 'filterTopAnd';
    /**
     * @public
     * @class FilterAnd
     * @name sap.apf.utils.FilterAnd
     * @param {sap.apf.core.MessageHandler} oMessageHandler
     * @param {string} sId Identifier for the object
     * @returns {sap.apf.utils.FilterAnd}
     */
    sap.apf.utils.FilterAnd = function (oMessageHandler, sId) {
        // Private vars
        var id = sId;
        var aAndTerms = [];
        /** @type {sap.apf.utils.FilterAnd} */
        var that = this;

        // Private functions
        // Public functions
        /**
         * @public
         * @description Contains 'filter'
         * @returns {string}
         */
        this.type = "filterAnd";
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterAnd#getById
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @param {string} sId ID of the object to be returned
         * @returns {(sap.apf.utils.FilterAnd|sap.apf.utils.FilterOr|sap.apf.utils.FilterExpression|undefined)}
         */
        this.getById = function (sId) {
            if (sId === id) {
                return this;
            }
            var oTerm;
            var i;
            for (i = 0; i < aAndTerms.length; i++) {
                oTerm = aAndTerms[i].getById(sId);
                if (oTerm !== undefined) {
                    return oTerm;
                }
            }
            return undefined;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterAnd#getCompoundExpressions
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {object[]}
         */
        this.getExpressions = function () {
            // This method is only used for the topAnd filter expression due to compatibility requirements
            // It could be replaced by filterAnd.getExpression without these requirements.
            var aExpression = [];
            var oTerm;
            var i;
            for (i = 0; i < aAndTerms.length; i++) {
                oTerm = aAndTerms[i].getExpression();
                if (oTerm instanceof Array && oTerm.length === 0) {
                    continue;
                }
                if (oTerm instanceof Array) { aExpression.push(oTerm);}
                else{ aExpression.push([oTerm]); } //Compatibility mode with respect to older UI5 shipments
            }
            return aExpression;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterAnd#getExpressions
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {object[]} Array of expressions
         */
        this.getExpression = function () {
            var aExpression = [];
            var oTerm;
            var i;
            for (i = 0; i < aAndTerms.length; i++) {
                oTerm = aAndTerms[i].getExpression();
                if (oTerm instanceof Array && oTerm.length === 0) {
                    continue;
                }
                aExpression.push(oTerm);
            }
            return aExpression;
        };
        /**
         * @private
         * @function
         * @deprecated
         * @name sap.apf.utils.FilterAnd#getCompoundExpressions
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {object[]} Array of expressions
         */
        this.getCompoundExpressions = function () {
            jQuery.sap.log.error("Method 'getExpressions' is deprecated since 1.23.0", "Will be discarded with 1.26.0.");
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterAnd#getId
         * @description Returns ID of this filter object.
         * @returns {string}
         */
        this.getId = function () {
            return sId;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterAnd#getInternalFilter
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {sap.apf.core.utils.Filter}
         */
        this.getInternalFilter = function () {
            var oFilter = new sap.apf.core.utils.Filter(oMessageHandler);
            var len = aAndTerms.length;
            var i;
            for (i = 0; i < len; i++) {
                oFilter.addAnd(aAndTerms[i].getInternalFilter());
            }
            return oFilter;
        };
        /**
         * @private
         * @function
         * @deprecated
         * @name sap.apf.utils.FilterAnd#addAndTerm
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns undefined
         */
        this.addAndTerm = function (oTerm) {
            jQuery.sap.log.error("Method 'addAndTerm' is deprecated since 1.23.0", "Will be discarded with 1.26.0.");
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterAnd#getAndTerms
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {array}
         */
        this.getAndTerms = function () {
            return aAndTerms;
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterAnd#addOr
         * @description Adds an object of type {sap.apf.utils.FilterOr}.
         * @param {string} sId Identifier for the object to be added.
         * @returns {sap.apf.utils.FilterOr}
         */
        this.addOr = function (sId) {
            oMessageHandler.check(
                (sId === undefined || this.getById(sId) === undefined),
                "Filter includes duplicated identifiers (IDs)");
            var or = new sap.apf.utils.FilterOr(oMessageHandler, sId, that);
            aAndTerms.push(or);
            return or;
        };

        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterAnd#addExpression
         * @description Adds an expression object to this filter.
         * @param {object} oExpression Expression object
         * @param oExpression.id Expression ID
         * @param oExpression.name Expression name
         * @param oExpression.operator Expression operator of type  {sap.apf.core.constants.FilterOperators}
         * @param oExpression.value Expression value
         * @returns {sap.apf.utils.FilterAnd} this to allow method chaining
         */
        this.addExpression = function (oExpression) {
            if (oExpression.operator.length == 2) {
                oExpression.operator = oExpression.operator.toUpperCase();
            }

            oMessageHandler.check((oExpression.id === undefined || this
                    .getById(oExpression.id) === undefined),
                "Filter includes duplicated identifiers (IDs)");
            oMessageHandler.check((oExpression.operator !== undefined),
                "sap.apf.utils.Filter oExpression.operator undefined");
            oMessageHandler.check((jQuery.inArray(oExpression.operator,
                    sap.apf.core.constants.aSelectOpt) > -1),
                    "sap.apf.core.utils.Filter oExpression.operator "
                    + oExpression.operator + " not supported");
            aAndTerms.push(new sap.apf.utils.FilterExpression(oMessageHandler,
                oExpression));
            return this;
        };
    };
    /**
     * @public
     * @class FilterOr
     * @name sap.apf.utils.FilterOr
     * @param {sap.apf.core.MessageHandler} oMessageHandler
     * @param {string} sId Identifier for the object
     * @param {sap.apf.utils.FilterAnd} oAnd Parent object
     * @returns {sap.apf.utils.FilterOr}
     */
    sap.apf.utils.FilterOr = function (oMessageHandler, sId, oAnd) {
        // Private vars
        var id = sId;
        var aOrTerms = [];
        var oAndObject = oAnd;
        // Public functions
        /**
         * @description Contains 'filter'
         * @returns {string}
         */
        this.type = "filterOr";
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterOr#getById
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @param {string} sId ID of the object to be returned
         * @returns {(sap.apf.utils.FilterAnd|sap.apf.utils.FilterOr|sap.apf.utils.FilterExpression|undefined)}
         */
        this.getById = function (sId) {
            if (sId === id) {
                return this;
            }
            var oTerm;
            for (var i = 0; i < aOrTerms.length; i++) {
                oTerm = aOrTerms[i].getById(sId);
                if (oTerm !== undefined) {
                    return oTerm;
                }
            }
            return undefined;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterOr#getExpression
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {object[]} array of expressions
         */
        this.getExpression = function () {
            var aExpression = [];
            var oTerm;
            for (var i = 0; i < aOrTerms.length; i++) {
                oTerm = aOrTerms[i].getExpression();
                if (oTerm instanceof Array && oTerm.length === 0) {
                    continue;
                }
                aExpression.push(oTerm);
            }
            return aExpression;
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterOr#getId
         * @description Retrieves an ID of the term.
         * @returns {string} ID of the term.
         */
        this.getId = function () {
            return sId;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterOr#getInternalFilter
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {sap.apf.core.utils.Filter}
         */
        this.getInternalFilter = function () {
            var oFilter = new sap.apf.core.utils.Filter(oMessageHandler);
            for (var i = 0; i < aOrTerms.length; i++) {
                oFilter.addOr(aOrTerms[i].getInternalFilter());
            }
            return oFilter;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterOr#getAndObject
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {sap.apf.utils.FilterAnd}
         */
        this.getAndObject = function () {
            return oAndObject;
        };
        /**
         * @private
         * @function
         * @deprecated
         * @name sap.apf.utils.FilterOr#addOrTerm
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns undefined
         */
        this.addOrTerm = function (oTerm) {
            jQuery.sap.log.error("Method 'addOr' is deprecated since 1.23.0", "Will be discarded with 1.26.0.");
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterOr#getOrTerms
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @returns {array}
         */
        this.getOrTerms = function () {
            return aOrTerms;
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterOr#addExpression
         * @description Adds an expression object to this filter.
         * @param {object} oExpression Expression object
         * @param oExpression.id Expression ID
         * @param oExpression.name Expression name
         * @param oExpression.operator Expression operator of type  {sap.apf.core.constants.FilterOperators}
         * @param oExpression.value Expression value
         * @returns {sap.apf.utils.FilterOr} this to allow method chaining
         */
        this.addExpression = function (oExpression) {
            if (oExpression.operator.length == 2) {
                oExpression.operator = oExpression.operator.toUpperCase();
            }
            oMessageHandler.check((oExpression.id === undefined || this
                    .getAndObject().getById(oExpression.id) === undefined),
                "Filter includes duplicated identifiers (IDs)");
            oMessageHandler.check((oExpression.operator !== undefined),
                "sap.apf.utils.Filter oExpression.operator undefined");
            oMessageHandler.check((jQuery.inArray(oExpression.operator,
                    sap.apf.core.constants.aSelectOpt) > -1),
                    "sap.apf.core.utils.Filter oExpression.operator "
                    + oExpression.operator + " not supported");
            aOrTerms.push(new sap.apf.utils.FilterExpression(oMessageHandler,
                oExpression));
            return this;
        };
        /**
         * @public
         * @function
         * @name sap.apf.utils.FilterOr#addAnd
         * @description Adds an object of type {@link sap.apf.utils.FilterAnd}.
         * @param {string} sId Identifier for the object to be added.
         * @returns {sap.apf.utils.FilterAnd}
         */
        this.addAnd = function (sId) {
            oMessageHandler.check(
                (sId === undefined || this.getById(sId) === undefined),
                "Filter includes duplicated identifiers (IDs)");
            var and = new sap.apf.utils.FilterAnd(oMessageHandler, sId);
            aOrTerms.push(and);
            return and;
        };
    };
    /**
     * @public
     * @class Filter expression
     * @name sap.apf.utils.FilterExpression
     * @param {sap.apf.core.MessageHandler} oMessageHandler
     * @param {object} oExpression Expression object
     * @param oExpression.id Expression ID
     * @param oExpression.name Expression name
     * @param oExpression.operator Expression operator of type  {sap.apf.core.constants.FilterOperators}
     * @param oExpression.value Expression value
     * @param oExpression.high Expression high value
     * @returns {sap.apf.utils.FilterExpression}
     */
    sap.apf.utils.FilterExpression = function (oMessageHandler, oExpression) {
        // Checks
        checkHighValue(oExpression.high, oExpression.operator);
        // Private vars
        var sId = oExpression.id;
        var sName = oExpression.name;
        var sOperator = oExpression.operator;
        var sValue = oExpression.value;
        var sHighValue = oExpression.high;
        // Public functions
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterExpression#getById
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @param {string} id
         * @returns {sap.apf.utils.FilterExpression}
         */
        this.getById = function (id) {
            if (sId === id) {
                return this;
            } 
            return undefined;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterExpression#getExpression
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {object}
         */
        this.getExpression = function () {
            if (!sOperator || sOperator !== sap.apf.core.constants.FilterOperators.BT) {
                return {
                    name: sName,
                    operator: sOperator,
                    value: sValue
                };
            } 
            return {
                    name: sName,
                    operator: sOperator,
                    value: sValue,
                    high: sHighValue
                };
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterExpression#getInternalFilter
         * @description Do not use. Not part of the APF API. Method should only be called internally by APF.
         * @returns {sap.apf.core.utils.Filter}
         */
        this.getInternalFilter = function () {
            return new sap.apf.core.utils.Filter(oMessageHandler, sName, sOperator,
                sValue, sHighValue);
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterExpression#update
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @param {object} oExpression Expression object
         * @param oExpression.id Expression ID
         * @param oExpression.name Expression name
         * @param oExpression.operator Expression operator of type  {sap.apf.core.constants.FilterOperators}
         * @param oExpression.value Expression low value
         * @param oExpression.high Expression high value
         * @returns undefined
         */
        this.update = function (oExpression) {
            checkHighValue(oExpression.high, oExpression.operator);
            sName = oExpression.name;
            sOperator = oExpression.operator;
            sValue = oExpression.value;
            sHighValue = oExpression.high;
        };
        /**
         * @private
         * @function
         * @name sap.apf.utils.FilterExpression#updateValue
         * @description Do not use. Not part of the APF API. Method should only be
         *              called internally by APF.
         * @param {string} value The new value for the expression
         * @param {string} high The new high value for the expression
         * @returns undefined
         */
        this.updateValue = function (value, high) {
            sValue = value;
            if (high !== undefined) { sHighValue = high; }
            checkHighValue(sHighValue, sOperator);
        };

        function checkHighValue(high, operator) {
            if (!operator) { return; }
            if (operator === sap.apf.core.constants.FilterOperators.BT && (high === null || high === undefined)) {
                oMessageHandler
                    .check(false, "sap.apf.utils.FilterExpression: High value needed for 'between' selection");
            }
            else if (operator !== sap.apf.core.constants.FilterOperators.BT && (high !== null && high !== undefined)) {
                oMessageHandler
                    .check(false, "sap.apf.utils.FilterExpression: High value only needed for 'between' selection");
            }

        }
    };

}());

}; // end of sap/apf/utils/filter.js
if ( !jQuery.sap.isDeclared('sap.apf.core.binding') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.binding");






/** 
 * @class The binding manages the different representations, that are assigned to a step.
 * @param {sap.apf.core.Instance} oInject.coreApi provides the core api.
 * @param {sap.apf.core.MessageHandler} oInject.messageHandler provides the message handler.
 * @param {object} oBindingConfig The configuration object of the binding from the analytical configuration.
 * @param oBindingConfig.oTitle Title of binding
 * @param oBindingConfig.oLongTitle Longtitle of binding
 * @param oBindingConfig.representations Configuration of the representations
 * @param oBindingConfig.requiredFilters {string[]} required filters - Array with properties, that define the filter properties, that shall be returned.
 * @param {sap.apf.core.ConfigurationFactory} oFactory reference 
 */
sap.apf.core.Binding = function(oInject, oBindingConfig, oFactory) {
    var that = this;
	this.type = "binding";
	var nSelectedRepresentation = 0;
	var aRepresentationInstances = [];
	var aRepresentationInfo = [];
	var aCachedData = [];
	var oCachedMetadata;
	var oStartFilter;

	this.oTitle = oBindingConfig.oTitle;
	this.oLongTitle = oBindingConfig.oLongTitle;
	var aRequiredFilters = oBindingConfig.requiredFilters;

	/**
	 * @see sap.apf.core.Step#getFilter
	 */
	this.getFilter = function() {
		var oSelectedRepresentation = this.getSelectedRepresentation();
		var methodTypes = sap.apf.core.constants.filterMethodTypes;
		var aIndices = [];

		if (oSelectedRepresentation.getFilterMethodType() === methodTypes.filter) {
			var oFilterFromRepresentation = oSelectedRepresentation.getFilter().getInternalFilter();
			if (oStartFilter) {
				return oStartFilter.getInternalFilter().overwriteWith(oFilterFromRepresentation);
			} else {
				return oFilterFromRepresentation;
			}
		}
		if (oSelectedRepresentation.getSelectionAsArray) {
			aIndices = oSelectedRepresentation.getSelectionAsArray();
		} else {
			return new sap.apf.core.utils.Filter(oInject.messageHandler);
		}
		// CONTRACT: undefined = empty selection corresponds to empty rectangle in a scatter
		// following steps should get no data
		if (aIndices === undefined) {
			return sap.apf.core.utils.Filter.createEmptyFilter(oInject.messageHandler, aRequiredFilters);
		}
		// CONTRACT: nothing selected also means, that nothing is excluded -> all shall be taken over to next selection
		if (aIndices.length === aCachedData.length || aIndices.length === 0) {
			return new sap.apf.core.utils.Filter(oInject.messageHandler);
		}
		// DEFAULT: 
		return sap.apf.core.utils.Filter.createFromArray(oInject.messageHandler, aRequiredFilters, aCachedData, aIndices);
	};

	/**
	 * @description Request option like $top, $skip and $orderby are returned by the actual representation. This
	 * is required to create the OData request.
	 */
	this.getRequestOptions = function() {
		if (jQuery.isFunction(this.getSelectedRepresentation().getRequestOptions)) {
			return this.getSelectedRepresentation().getRequestOptions();
		}
		return {};
	};

	function isRepresentationForInitialStep(oRepresentation) {
		return oRepresentation.getFilterMethodType() === sap.apf.core.constants.filterMethodTypes.startFilter;
	}
	/**
	 * @see sap.apf.core.Step#setFilter
	 */
	this.setFilter = function(oFilter) {
		var oRepresentation = this.getSelectedRepresentation();
		oStartFilter = oFilter;
		if (isRepresentationForInitialStep(oRepresentation)) {
			oRepresentation.setFilter(oStartFilter);
		}
	};
	/**
	 * @see sap.apf.core.Step#setData
	 */
	this.setData = function(oDataResponse) {
		oInject.messageHandler.check(oDataResponse !== undefined, "aDataResponse is undefined (binding function setData)");
		aCachedData = oDataResponse.data;
		oCachedMetadata = oDataResponse.metadata;
		this.getSelectedRepresentation().setData(oDataResponse.data, oDataResponse.metadata);
	};

	/**
	 * @see sap.apf.core.Step#getRepresentationInfo
	 */
	this.getRepresentationInfo = function() {
		var aReprInfo = jQuery.extend(true, [], aRepresentationInfo); // clone deep
		for( var i = 0; i < aReprInfo.length; i++) {
			delete aReprInfo[i].id;
			delete aReprInfo[i].type;
			delete aReprInfo[i].constructor;
		}
		return aReprInfo;
	};

	/**
	 * @see sap.apf.core.Step#getSelectedRepresentationInfo
	 */
	this.getSelectedRepresentationInfo = function() {
		oInject.messageHandler.check(0 <= nSelectedRepresentation && nSelectedRepresentation < aRepresentationInfo.length, "index in array boundaries");
		
		var oRepType = jQuery.extend(true, {}, aRepresentationInfo[nSelectedRepresentation]);
		delete oRepType.id;
		delete oRepType.type;
		delete oRepType.constructor;
		return oRepType;
	};

	/**
	 * @see sap.apf.core.Step#getSelectedRepresentation
	 */
	this.getSelectedRepresentation = function() {
		oInject.messageHandler.check(0 <= nSelectedRepresentation && nSelectedRepresentation < aRepresentationInstances.length, "selectedRepresentation in array boundaries");
		return aRepresentationInstances[nSelectedRepresentation];
	};

	/**
	 * @see sap.apf.core.Step#setSelectedRepresentation
	 */
	this.setSelectedRepresentation = function(sRepresentationId) {
		oInject.messageHandler.check(typeof sRepresentationId === "string", "setSelectedRepresentation() - sRepresentationId missing");
		var that = this;
		var oCurrentInstance = this.getSelectedRepresentation();
		var oSwitchParameters = determineSwitchParameters(sRepresentationId, oBindingConfig.representations);
		var oNewInstance = setNewInstance(oSwitchParameters);

		nSelectedRepresentation = oSwitchParameters.index;
		if (aCachedData !== undefined && oCachedMetadata !== undefined) {
			oNewInstance.setData(aCachedData, oCachedMetadata);
		}
		if (oNewInstance.adoptSelection) {
			oNewInstance.adoptSelection(oCurrentInstance);
		}

		function determineSwitchParameters(sRepresentationId, aRepresentationConfig) {
			for( var i = 0; i < aRepresentationConfig.length; i++) {
				if (sRepresentationId === aRepresentationConfig[i].id) {
					return {
						config : aRepresentationConfig[i],
						constructor : oFactory.getConfigurationById(aRepresentationConfig[i].representationTypeId).constructor,
						index : i
					};
				}
			}
			oInject.messageHandler.check(false, "Representation config not found");
		}
		function setNewInstance(oSwitchParam) {
			var oConvertedParameter;
			if (aRepresentationInstances[oSwitchParam.index] === undefined) {
				if (oSwitchParam.config.parameter && oSwitchParam.config.parameter.alternateRepresentationTypeId) {
					oSwitchParam.config.parameter.alternateRepresentationType = oFactory.getConfigurationById(oSwitchParam.config.parameter.alternateRepresentationTypeId);
				}
				oSwitchParam.config.parameter.requiredFilters = oBindingConfig.requiredFilters;
				oConvertedParameter = that.convertSortToOrderBy(oSwitchParam.config.parameter);
				aRepresentationInstances[oSwitchParam.index] = oInject.coreApi.createRepresentation(oSwitchParam.constructor, oConvertedParameter);
				return aRepresentationInstances[oSwitchParam.index];
			} else {
				return aRepresentationInstances[oSwitchParam.index];
			}
		}
	};
	/**
	 * @description Serializes a binding object.
	 * @returns {object} serialized binding object with a serializable selectedRepresentation and the selectedRepresentationId
	 */
	this.serialize = function() {
		return {
			selectedRepresentation : that.getSelectedRepresentation().serialize(),
			selectedRepresentationId : that.getSelectedRepresentationInfo().representationId
		};
	};
	/**
	 * @description Deserialize a serializable binding object.
	 * @param {object} oSerializableBinding serializable binding object to be deserialized
	 * @returns {object} deserialized binding runtime object
	 */
	this.deserialize = function(oSerializableBinding) {
		that.setSelectedRepresentation(oSerializableBinding.selectedRepresentationId);
		that.getSelectedRepresentation().deserialize(oSerializableBinding.selectedRepresentation);
		return that;
	};
	
	/**
	 * @private 
	 * @description For old file based configurations we need to convert the sort to an orderby attribute.
	 * @param {object} oParameter - parameter part of the representation object
	 * @returns{object} - New object (except for alternateRepresentationType) where the sort attribute is migrated to orderby
	 */
	this.convertSortToOrderBy = function(oParameter){
		var result;
	
		if(oParameter.sort && !oParameter.orderby){
			result = jQuery.extend(true, {}, oParameter);
			if(oParameter.alternateRepresentationType){
			  result.alternateRepresentationType = oParameter.alternateRepresentationType;
			}
			result.orderby = [{property : oParameter.sort.sortField, ascending : !oParameter.sort.descending}];
		    delete result.sort;                        
			return result;
		}
		
		result = oParameter;
		return result;
	};

	aRepresentationInstances[0] = undefined;
	for( var index in oBindingConfig.representations) {
		var sRepTypeId = oBindingConfig.representations[index].representationTypeId;
        aRepresentationInfo[index] = jQuery.extend(true, {}, oFactory.getConfigurationById(sRepTypeId)); // return clone
		aRepresentationInfo[index].representationId = oBindingConfig.representations[index].id;
		aRepresentationInfo[index].representationLabel = oBindingConfig.representations[index].label;
		aRepresentationInfo[index].thumbnail = oBindingConfig.representations[index].thumbnail;
		aRepresentationInfo[index].parameter =  jQuery.extend(true, {}, oBindingConfig.representations[index].parameter);
	}
	if (aRepresentationInfo.length > 0) {
		this.setSelectedRepresentation(aRepresentationInfo[0].representationId);
	}
};

}; // end of sap/apf/core/binding.js
if ( !jQuery.sap.isDeclared('sap.apf.core.request') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

/*global sap, jQuery, OData */
jQuery.sap.declare("sap.apf.core.request");



jQuery.sap.require('sap.ui.thirdparty.datajs'); // unlisted dependency retained


(function () {
    'use strict';
    /**
     * @class The Request object represents an OData GET request. It receives a
     *        filter which is then mapped to a URI query and appended to the request
     *        URI. Its role is to send an asynchronous OData request to the server,
     *        receive the response, parse it and provision it as an array of
     *        objects. The request will use a callback mechanism handling the
     *        asynchronous request behavior. The callback routes control back to the
     *        Path object.
     * @param {Object} oInject - references to other handlers
     * @param oConfig - Configuration Object for a Request.
     */
    sap.apf.core.Request = function (oInject, oConfig) {
        var oMessageHandler = oInject.messageHandler;
        var oCoreApi = oInject.coreApi;
        var sServiceRootPath = oConfig.service;
        
        var selectProperties = oConfig.selectProperties;
        var oUriGenerator = oCoreApi.getUriGenerator();
        var oMessageObject;
        if (sServiceRootPath === undefined) {
            oMessageObject = oMessageHandler.createMessageObject({
                code: "5015",
                aParameters: [oConfig.id]
            });
            oMessageHandler.putMessage(oMessageObject);
        }
        var oMetadata = oCoreApi.getMetadata(sServiceRootPath);
        var entityType = oMetadata.patchEntitySetName(oConfig.entityType);
        oMessageHandler.check(entityType !== undefined, "Invalid request configuration entityset does not exist under the service" + oConfig.entityType);
        this.type = oConfig.type;
        /**
         * @description A request object that can send (many) asynchronous OData GET requests to the server. It uses a POST $batch operation wrapping the GET.
         * @param {Object} oFilter - An sap.apf.core.utils filter object.
         * @param {Function} fnCallback - A function called after the response was successfully received and parsed.
         * @param {Object} oRequestOptions - An optional object containing additional query string options
         * Format: { orderby : [{ property : <property_name>, order : <asc|desc>}], top : <integer>, skip : <integer> }
         */
        this.sendGetInBatch = function (oFilter, fnCallback, oRequestOptions) {
            var oParameters = retrieveParameters(oFilter);
            var oReducedFilter;
            checkFilterForRequiredProperties(oFilter);
            if (oFilter && oFilter.getProperties) {
                oReducedFilter = oFilter.reduceToProperty(oMetadata.getFilterableProperties(entityType));
            }

            checkRequestOptionsConsistency(oRequestOptions);
            var oPaging = oRequestOptions && oRequestOptions.paging;
            var oSortingFields = oRequestOptions && oRequestOptions.orderby;
            var sUriSuffix = oMetadata.getUriSuffix(entityType);
            var sUrlEntityType = oUriGenerator.buildUri(oMessageHandler, entityType, selectProperties, oReducedFilter, oParameters, oSortingFields, oPaging, undefined, formatValue, sUriSuffix);
            var oRequest = {
                method: 'POST',
                headers: {
                    "x-csrf-token": oCoreApi.getXsrfToken(sServiceRootPath)
                },
                requestUri: oUriGenerator.getAbsolutePath(sServiceRootPath) + '$batch',
                data: {
                    __batchRequests: [
                        {
                            requestUri: sUrlEntityType,
                            method: 'GET',
                            headers: {
                                "Accept-Language": sap.ui.getCore().getConfiguration().getLanguage(),
                                "x-csrf-token": oCoreApi.getXsrfToken(sServiceRootPath)
                            }
                        }
                    ]
                }
            };
            var fnSuccess = function (data, response) {
                var oResponse = {};
                var sUrl = "";
                if (data && data.__batchResponses && data.__batchResponses[0].data) {
                    oResponse.data = data.__batchResponses[0].data.results;
                    oResponse.metadata = oCoreApi.getEntityTypeMetadata(oConfig.service, oConfig.entityType);
                    if (data.__batchResponses[0].data.__count) {
                        oResponse.count = parseInt(data.__batchResponses[0].data.__count, 10);
                    }
                } else if (data && data.__batchResponses[0] && data.__batchResponses[0].response && data.__batchResponses[0].message) {
                    sUrl = response.requestUri;
                    var sMessage = data.__batchResponses[0].message;
                    var sErrorDetails = data.__batchResponses[0].response.body;
                    var sHttpStatusCode = data.__batchResponses[0].response.statusCode;
                    oResponse = oMessageHandler.createMessageObject({
                        code: "5001",
                        aParameters: [ sHttpStatusCode, sMessage, sErrorDetails, sUrl ]
                    });
                } else {
                    sUrl = response.requestUri || sUrlEntityType;
                    oResponse = oMessageHandler.createMessageObject({
                        code: "5001",
                        aParameters: [ "unknown", "unknown error", "unknown error", sUrl ]
                    });
                }
                fnCallback(oResponse, false);
            };
            var fnError = function (error) {
                var sMessage = "unknown error";
                var sErrorDetails = "unknown error";
                var sUrl = sUrlEntityType;
                if (error.message !== undefined) {
                    sMessage = error.message;
                }
                var sHttpStatusCode = "unknown";
                if (error.response && error.response.statusCode) {
                    sHttpStatusCode = error.response.statusCode;
                    sErrorDetails = error.response.statusText || "";
                    sUrl = error.response.requestUri || sUrlEntityType;
                }

                if (error.messageObject && error.messageObject.type === "messageObject") {
                    fnCallback(error.messageObject);
                } else {
                    fnCallback(oMessageHandler.createMessageObject({
                        code: "5001",
                        aParameters: [ sHttpStatusCode, sMessage, sErrorDetails, sUrl ]
                    }));
                }

            };
            oCoreApi.odataRequest(oRequest, fnSuccess, fnError, OData.batchHandler);
        };

        function formatValue(sProperty, value) {
            var strDelimiter = "'";
            var oEntityMetadata = oMetadata.getPropertyMetadata(entityType, sProperty);
            if (oEntityMetadata && oEntityMetadata.dataType) {
                return sap.apf.utils.formatValue(value, oEntityMetadata.dataType.type);
            } else {
                if (typeof value === 'number') {
                    return value;
                } else {
                    return strDelimiter + sap.apf.utils.escapeOdata(value) + strDelimiter;
                }
            }

        }

        function checkRequestOptionsConsistency(oRequestOptions) {

            var aPropertyNames, i;

            if (!oRequestOptions) {
                return;
            }
            aPropertyNames = Object.getOwnPropertyNames(oRequestOptions);
            for (i = 0; i < aPropertyNames.length; i++) {
                if (aPropertyNames[i] !== 'orderby' && aPropertyNames[i] !== 'paging') {
                    oMessageHandler.putMessage(oMessageHandler.createMessageObject({
                        code: '5032',
                        aParameters: [ entityType, aPropertyNames[i] ]
                    }));
                }
            }
        }


        function checkFilterForRequiredProperties(oFilter) {
            var aFilterableProperties = oMetadata.getFilterableProperties(entityType);
            var sRequiredFilterProperty = "";
            var oEntityTypeMetadata = oMetadata.getEntityTypeMetadata(entityType);
            var oMessageObject2;
            if (oEntityTypeMetadata.requiresFilter !== undefined && oEntityTypeMetadata.requiresFilter === "true") {
                if (oEntityTypeMetadata.requiredProperties !== undefined) {
                    sRequiredFilterProperty = oEntityTypeMetadata.requiredProperties;
                }
            }
            if (sRequiredFilterProperty === "") {
                return;
            }
            if (jQuery.inArray(sRequiredFilterProperty, aFilterableProperties) === -1) {
                oMessageObject2 = oMessageHandler.createMessageObject({
                    code: "5006",
                    aParameters: [ entityType, sRequiredFilterProperty ]
                });
                oMessageHandler.putMessage(oMessageObject2);
            }
            var aPropertiesInFilter = oFilter.getProperties();
            // test, whether all required properties are in filter
            if (jQuery.inArray(sRequiredFilterProperty, aPropertiesInFilter) === -1) {
                oMessageObject2 = oMessageHandler.createMessageObject({
                    code: "5005",
                    aParameters: [ entityType, sRequiredFilterProperty ]
                });
                oMessageHandler.putMessage(oMessageObject2);
            }
        }

        function retrieveParameters(oFilter) {
            var oParameters = {};
            var aParameters;
            var numberOfParameters;
            var aTermsContainingParameter,
                i,
                oParameterTerm;
            function addParameter(index, value) {
                if (aParameters[index].dataType.type === 'Edm.String') {
                    oParameters[aParameters[index].name] = (jQuery.sap.encodeURL("'" + sap.apf.utils.escapeOdata(value) + "'"));
                } else if (aParameters[index].dataType.type) {
                    oParameters[aParameters[index].name] = sap.apf.utils.formatValue(value, aParameters[index].dataType.type);
                } else {
                    if (typeof value === "string") {
                        oParameters[aParameters[index].name] = jQuery.sap.encodeURL(sap.apf.utils.escapeOdata(value));
                    } else {
                        oParameters[aParameters[index].name] = value;
                    }
                }
            }

            aParameters = oMetadata.getParameterEntitySetKeyProperties(entityType);
            if (aParameters !== undefined) {
                numberOfParameters = aParameters.length;
            } else {
                numberOfParameters = 0;
            }
            if (numberOfParameters > 0) {
                for (i = 0; i < numberOfParameters; i++) {
                    if (oFilter && oFilter instanceof sap.apf.core.utils.Filter) {
                        aTermsContainingParameter = oFilter.getFilterTermsForProperty(aParameters[i].name);
                        oParameterTerm = aTermsContainingParameter[aTermsContainingParameter.length - 1];
                    }
                    if (oParameterTerm instanceof sap.apf.core.utils.FilterTerm) {
                        addParameter(i, oParameterTerm.getValue());
                    } else if (aParameters[i].defaultValue) {
                        addParameter(i, aParameters[i].defaultValue);
                    } else {
                        oMessageHandler.putMessage(
                            oMessageHandler.createMessageObject({
                                code: "5016",
                                aParameters: [ aParameters[i].name ]
                            }));
                    }
                }
            }
            return oParameters;
        }
    };
}());

}; // end of sap/apf/core/request.js
if ( !jQuery.sap.isDeclared('sap.apf.core.resourcePathHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap */

(function () {
    'use strict';

    jQuery.sap.declare("sap.apf.core.resourcePathHandler");
    
    
     // ctor called
     // constants used
    
    
        
    
    

    /**
     * @class Holds all paths for the message configuration, the message text bundles, other ui texts for apf, and for extensions.
     * Furthermore it  holds the information about persistence configuration.
     */
    sap.apf.core.ResourcePathHandler = function (oInject) {
        var thisModule = this;
        
        var coreApi = oInject.coreApi;
        var messageHandler = oInject.messageHandler;

        var oHT = new sap.apf.utils.Hashtable(messageHandler);

        var oConfigurationProperties;
        var oPersistenceConfiguration;
        var oSmartBusinessConfiguration = null;
        var oAnalyticalConfiguration;
        var sApplicationConfigurationURL = "";
        var bConfigurationLoaded = false;
        var bIsAnalyticalConfigRequested = false;

        //noinspection JSLint
        setDefaultLocations();

        /**
         * @description returns the url of the application configuration
         * @returns {string} url
         */
        this.getApplicationConfigurationURL = function () {
            return sApplicationConfigurationURL;
        };
        /**
         * @description Loads a new  application configuration in JSON format.
         * Loads only once. When called twice or more then skips processing and returns immediately.
         * @param {string} sFilePath The absolute path of application configuration file. Host and port will be added in front of this path.
         */
        this.loadConfigFromFilePath = function (sFilePath) {
        	if (bConfigurationLoaded) {
        		return;
        	}
            if(coreApi.getStartParameterFacade().getAnalyticalConfigurationId()) {
            	bIsAnalyticalConfigRequested = true;
            }
            var sUrl = sFilePath;
            //noinspection ReuseOfLocalVariableJS
            sApplicationConfigurationURL = sFilePath;
            jQuery.ajax({
                url: sUrl,
                dataType: "json",
                success: parseConfigurationFile,
                error: function (oJqXHR, sStatus, sError) {
                    var oMessageObject = messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorLoadingRessource,
                        rawText: "Error " + sError + " when loading the configuration of the resource location: " + sUrl
                    });
                    messageHandler.putMessage(oMessageObject);
                },
                async: false
            });
            configureMessageHandling();
            if(bIsAnalyticalConfigRequested) {
            	loadAnalyticalConfigFromService();
            } else {
            	loadAnalyticalConfigFromFile();
            }
            bConfigurationLoaded = true;

            // --- function declarations only ----------------------------
            //noinspection JSUnusedLocalSymbols,FunctionWithMoreThanThreeNegationsJS
            function parseConfigurationFile(oData, sStatus, oJqXHR) //noinspection JSLint
            {
            	
                var oMessage = sap.apf.core.utils.checkForTimeout(oJqXHR);
                if (oMessage) {
                    messageHandler.putMessage(messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorStartUp,
                        rawText: "Timeout when loading application configuration from " + sFilePath + "."
                    }));
                }

                if (!oData || !oData.applicationConfiguration) {
                    messageHandler.putMessage(messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorStartUp,
                        rawText: "The application configuration from " + sFilePath + " has no valid format."
                    }));
                    return;

                }
                if (oData.applicationConfiguration.textResourceLocations === undefined) {
                    messageHandler.putMessage(messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorStartUp,
                        rawText: "The textResourceLocations is missing in the application configuration from " + sFilePath + "."
                    }));
                    return;
                }

                var oApplicationConfiguration = oData.applicationConfiguration;
                saveRestrictedCopyOfApplicationConfiguration(oApplicationConfiguration);

                var oTextResourceLocations = oData.applicationConfiguration.textResourceLocations;
                oPersistenceConfiguration = oData.applicationConfiguration.persistence;
                checkPersistenceConfiguration(oPersistenceConfiguration);
                if(!oPersistenceConfiguration.path.entitySet){
                	oPersistenceConfiguration.path.entitySet = sap.apf.core.constants.entitySets.analysisPath;
                }

                if (oData.applicationConfiguration.smartBusiness) {
                    oSmartBusinessConfiguration = oData.applicationConfiguration.smartBusiness;
                    checkSmartBusinessConfiguration(oSmartBusinessConfiguration);
                }
                if (oPersistenceConfiguration.analyticalConfiguration) {
                	oAnalyticalConfiguration = oPersistenceConfiguration.analyticalConfiguration;
                }
                
                var oMessageObject;
                var sUrl;
                var oProperty;
                for (oProperty in sap.apf.core.constants.resourceLocation) {
                    if (!sap.apf.core.constants.resourceLocation.hasOwnProperty(oProperty)) {
                        continue;
                    }
                    //noinspection JSUnfilteredForInLoop
                    if (oApplicationConfiguration[oProperty] !== undefined) {
                        //noinspection JSUnfilteredForInLoop
                        sUrl = oApplicationConfiguration[oProperty];
                    } else { //noinspection JSUnfilteredForInLoop
                        if (oTextResourceLocations[oProperty] !== undefined) {
                            //noinspection JSUnfilteredForInLoop
                            sUrl = oTextResourceLocations[oProperty];
                        }
                        else {
                            continue;
                        }
                    }
                    if (sap.apf.core.utils.fileExists(sUrl)) {
                        //noinspection JSUnfilteredForInLoop
                        oHT.setItem(oProperty, sUrl);
                    } else {
                        if(!bIsAnalyticalConfigRequested) {
	                        oMessageObject = messageHandler.createMessageObject({
	                            code: sap.apf.core.constants.message.code.wrongRessourcePath,
	                            rawText: "The path " + sUrl + " for resource location " + oProperty + "is not valid."
	                        });
	                        messageHandler.putMessage(oMessageObject);
                        }
                    }
                }
            }

            function saveRestrictedCopyOfApplicationConfiguration(oApplicationConfiguration) {
                oConfigurationProperties = jQuery.extend(true, {}, oApplicationConfiguration);
                delete oConfigurationProperties.type;
                delete oConfigurationProperties.analyticalConfigurationLocation;
                delete oConfigurationProperties.applicationMessageDefinitionLocation;
                delete oConfigurationProperties.textResourceLocations;
                delete oConfigurationProperties.persistence;
            }
        };
        function loadAnalyticalConfigFromService() {
    		var odataProxy = new sap.apf.core.OdataProxy(
        			{
        				serviceRoot : oPersistenceConfiguration.path.service,
        				entityTypes : {
        					configuration: sap.apf.core.constants.entitySets.configuration,
        					texts: sap.apf.core.constants.entitySets.texts
        				}
        			}, 
        			{
        				instance : {
        					coreApi : coreApi,
        					messageHandler : messageHandler
        				}
        			}
        	);
        	odataProxy.readEntity(
        			"configuration", 
        			function(result, metadata, messageObject) {
        				if(messageObject) {
        	                messageHandler.putMessage(messageHandler.createMessageObject({
        	                    code: "5022",
        	                    aParameters : [coreApi.getStartParameterFacade().getAnalyticalConfigurationId()]
        	                }));
        				} else {
        					var analyticalConfiguration = JSON.parse(result.SerializedAnalyticalConfiguration);
        					coreApi.loadAnalyticalConfiguration(JSON.parse(result.SerializedAnalyticalConfiguration));
        					loadTextFromService(result.Application, odataProxy);
        					if(analyticalConfiguration.applicationTitle) {
        					    oConfigurationProperties.appName = analyticalConfiguration.applicationTitle.key;
        					    oConfigurationProperties.appTitle = analyticalConfiguration.applicationTitle.key;
        					}
        				}
        			},
        			[{
        				name : "AnalyticalConfiguration",
        				value: coreApi.getStartParameterFacade().getAnalyticalConfigurationId()
        			}],
        			undefined, 
        			false //sync call  			
        	);
        }      
        function loadTextFromService( applicationId, odataProxy ){
        	
        	var filterApplication = new sap.apf.core.utils.Filter(messageHandler, 'Application', 'eq', applicationId);
			var filter = new sap.apf.core.utils.Filter(messageHandler, 'Language', 'eq', sap.apf.core.constants.developmentLanguage);
			filter.addAnd(filterApplication);

			var selectList = [ "TextElement", "TextElementDescription" ];
			
			odataProxy.readCollection('texts', function(result, metadata, messageObject) {
				if(messageObject) {
	                messageHandler.putMessage(messageHandler.createMessageObject({
	                    code: "5023",
	                    aParameters : [sap.apf.utils.uriParameter.getConfigurationId()]
	                }));
				} else {
					coreApi.loadTextElements(result);
				}	
			}, undefined, selectList, filter, false);
        }
        function loadAnalyticalConfigFromFile() {
            var sUrl = thisModule.getResourceLocation(sap.apf.core.constants.resourceLocation.analyticalConfigurationLocation);
            var oMessageObject;

            if (sUrl !== "") {
                jQuery.ajax({
                    url: sUrl,
                    dataType: "json",
                    success: function(oData, sStatus, oJqXHR) {
                    	if(oData) {
                    		coreApi.loadAnalyticalConfiguration(oData);
                    		if(oData.applicationTitle) {
                    		    oConfigurationProperties.appName = oData.applicationTitle.key;
                    		    oConfigurationProperties.appTitle = oData.applicationTitle.key;
                    		}
                    	} else {
                            oMessageObject = messageHandler.createMessageObject({
                                code: sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,
                                rawText: "No data received when loading analytical configuration file" + sUrl
                            });
                            messageHandler.putMessage(oMessageObject);
                    	}
                    },
                    error: function (oJqXHR, sStatus, sError) {
                        oMessageObject = messageHandler.createMessageObject({
                            code: sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,
                            rawText: "Error " + sError + " when loading analytical configuration file" + sUrl
                        });
                        messageHandler.putMessage(oMessageObject);
                    },
                    async: false
                });
            } else {  // the case of the default value which is set by this module when the file path was undefined in the config file
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.missingAnalyticalConfig,
                    rawText: "No analytical configuration defined in the application configuration"
                });
                messageHandler.putMessage(oMessageObject);
            }
        }
        function configureMessageHandling() {
            coreApi.loadMessageConfiguration(sap.apf.core.messageDefinition, true);
            loadMessagesFromConfigurationFile(sap.apf.core.constants.resourceLocation.applicationMessageDefinitionLocation, false);
        }
        function loadMessagesFromConfigurationFile(sResourceLocation, bResetRegistry) {
            var sUrl = thisModule.getResourceLocation(sResourceLocation);
            if (sUrl !== "") {
                jQuery.ajax({
                    url: sUrl,
                    dataType: "json",
                    success: parseMessageConfigurationFile,
                    error: function (oJqXHR, sStatus, sError) {
                        var oMessageObject = messageHandler.createMessageObject({
                            code: sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,
                            rawText: "Error " + sError + " when loading message configuration file" + sUrl
                        });
                        messageHandler.putMessage(oMessageObject);
                    },
                    async: false
                });
            }
            //noinspection JSUnusedLocalSymbols
            function parseMessageConfigurationFile(oData, sStatus, oJqXHR) {
                var oMessageObject;
                var oMessage = sap.apf.core.utils.checkForTimeout(oJqXHR);
                if (!oMessage) {
                    if (oData.messageConfiguration) {
                        coreApi.loadMessageConfiguration(oData.messageConfiguration.definitions, bResetRegistry);
                    }
                } else {
                    oMessageObject = messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorLoadingAnalyticalConfig,
                        rawText: "Timeout error when loading message configuration file" + sUrl
                    });
                    messageHandler.putMessage(oMessageObject);
                }
            }
        }

        //noinspection FunctionWithMoreThanThreeNegationsJS
        function checkPersistenceConfiguration(oConfig) {
            var oMessageObject;

            if (!oConfig || !oConfig.path) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "persistence path configuration is missing in the application configuration"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (!oConfig.path.service) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "service in persistence path configuration is missing"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (!oConfig.logicalSystem) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "logical system configuration is missing in the application configuration"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (!oConfig.logicalSystem.service && oConfig.logicalSystem.service !== null) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "service is missing in logical system configuration  in the application configuration"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (oConfig.analyticalConfiguration) {
            	if(!oConfig.analyticalConfiguration.service) {
                    oMessageObject = messageHandler.createMessageObject({
                        code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                        rawText: "service or entity set are missing in analytical configuration in the application configuration"
                    });
                    messageHandler.putMessage(oMessageObject);
            	}
            }
        }

        function checkSmartBusinessConfiguration(oConfig) {
            var oMessageObject;

            if (oConfig.evaluations && !oConfig.evaluations.service) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "service in Smart Business service root configuration is missing"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (oConfig.evaluations && (!oConfig.evaluations.type || oConfig.evaluations.type !== "smartBusinessRequest")) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "type in Smart Business configuration is not smartBusinessRequest"
                });
                messageHandler.putMessage(oMessageObject);
            }
            if (oConfig.evaluations && !oConfig.evaluations.entityType) {
                oMessageObject = messageHandler.createMessageObject({
                    code: sap.apf.core.constants.message.code.errorInAnalyticalConfig,
                    rawText: "entityType in Smart Business service root configuration is missing"
                });
                messageHandler.putMessage(oMessageObject);
            }
        }

        /**
         * @description This function returns the path of a specified resource.
         * @param {string} sResourceIdentifier type sap.apf.core.constants.resourceLocation.*
         * @returns {string} Resource path
         */
        this.getResourceLocation = function (sResourceIdentifier) {
            return oHT.getItem(sResourceIdentifier);
        };
        /**
         * @description This function returns the configuration for the persistence (of the path).
         * @returns {object} persistence configuration object
         */
        this.getPersistenceConfiguration = function () {
            messageHandler.check(bConfigurationLoaded, "RessourcePathHandler: configuration must be loaded before access to ressources");
            return oPersistenceConfiguration;
        };
        /**
         * @description This function returns the properties of the configuration file, which are not used internally.
         * @returns {object} Copy of properties in configuration
         */
        this.getConfigurationProperties = function () {
            return oConfigurationProperties;
        };
        function setDefaultLocations() {
            var sApfLocation = coreApi.getUriGenerator().getApfLocation();

            oHT.setItem(sap.apf.core.constants.resourceLocation.apfUiTextBundle, sApfLocation + "resources/i18n/apfUi.properties");
            oHT.setItem(sap.apf.core.constants.resourceLocation.applicationMessageDefinitionLocation, "");
            oHT.setItem(sap.apf.core.constants.resourceLocation.applicationMessageTextBundle, "");
            oHT.setItem(sap.apf.core.constants.resourceLocation.applicationUiTextBundle, "");
            oHT.setItem(sap.apf.core.constants.resourceLocation.analyticalConfigurationLocation, "");
        }
    };

}());

}; // end of sap/apf/core/resourcePathHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.core.sessionHandler') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.sessionHandler");



/**
 * @class Handles the session of an APF based application. e.g. the XSRF token handling
 */
sap.apf.core.SessionHandler = function(oInject) {
	// private vars
	var that = this;
	var sXsrfToken = "";
	var sServiceRootPath = "";
	var oHashTableXsrfToken = new sap.apf.utils.Hashtable(oInject.messageHandler);
	var nFetchTryCounter = 0;
	var sLogicalSystem = "";
	var oCoreApi = oInject.coreApi;
	var oMessageHandler = oInject.messageHandler;
	var oContextFilter = new sap.apf.utils.Filter(oMessageHandler);
	var sSapClient = "";
	// public vars
	/**
	 * @description Returns the type
	 * @returns {String}
	 */
	this.type = "sessionHandler";
	// public function
	/**
	 * @see sap.apf.core.ajax
	 */
	this.ajax = function(oSettings){
		sap.apf.core.ajax(oSettings);
	};
	/**
	 * @see sap.apf.core.odataRequestWrapper
	 */
	this.odata = function(oRequest, fnOnSuccess, fnError){
		oCoreApi.odataRequest(oRequest, fnOnSuccess, fnError);
	};
	
	/**
	 * @description Returns the XSRF token as string for a given OData service root path
	 * @param {String} serviceRootPath OData service root path
	 * @returns {String}
	 */
	this.getXsrfToken = function(serviceRootPath) {
		sServiceRootPath = serviceRootPath;
		if(oHashTableXsrfToken.hasItem(sServiceRootPath)){
			return oHashTableXsrfToken.getItem(sServiceRootPath);
		} else {
			that.fetchXcsrfToken();
			oHashTableXsrfToken.setItem(sServiceRootPath, sXsrfToken);
			return sXsrfToken;
		}
	};

	/**
	 * returns the rfc destination of the r3 system, that is exposed by the odata services.
	 * This corresponds to t000-logsys. The logical system is the identifier for the system/server, on which the application runs.
	 * @returns {string} logical system destination
	 */
	this.getLogicalSystem = function() {
		return sLogicalSystem;
	};

	/**
	 * @description sets the Context
	 * @param {sap.apf.utils.Filter} oFilter filter, that stores all context information
	 */
	this.setContext = function(oFilter) {
		oContextFilter = oFilter;
        var aTerms = oContextFilter.getInternalFilter().getFilterTermsForProperty('SAPClient');
        if (aTerms && aTerms.length === 1) {
            initLogicalSystem();
        }
		oCoreApi.updatePath(function() {
		}, true);
	};
	/**
	 * @description gets the Context
	 */
	this.getContext = function() {
		return oContextFilter;
	};
	/**
	 * @description fetches XSRF token from XSE
	 */
	this.fetchXcsrfToken = function() {
		that.ajax({
			url : oCoreApi.getUriGenerator().getAbsolutePath(sServiceRootPath),
			type : "GET",
			beforeSend : function(xhr) {
				xhr.setRequestHeader("x-csrf-token", "Fetch");
			},
			success : onFetchXsrfTokenResponse,
			error : onError,
			async : false
		});
		nFetchTryCounter = nFetchTryCounter + 1;
	};
	// private functions
	var onError = function(oJqXHR, sStatus, sErrorThrown) {
		if ((sXsrfToken.length === 0 || sXsrfToken === "unsafe") && nFetchTryCounter < 2) {
			setTimeout(that.fetchXcsrfToken, 500 + Math.random() * 1500);
		} else {
			oMessageHandler.check(false, "No XSRF Token available!", 5101);
		}
	};
    var onFetchXsrfTokenResponse = function(oData, sStatus, oXMLHttpRequest) {
        sXsrfToken = oXMLHttpRequest.getResponseHeader("x-csrf-token");
        /*
        * In case XSRF prevention flag is not set in .xsaccess file for the service, then no "x-csrf-token" field is returned in response header. 
         * For robustness, XSRF token is set to empty string. Every request triggered by APF contains then a "x-csrf-token" request header field containing an empty string. 
         */
        if(sXsrfToken === null){
               sXsrfToken = "";
        }else if ((sXsrfToken.length === 0 || sXsrfToken === "unsafe") && nFetchTryCounter < 2) {
               setTimeout(that.fetchXcsrfToken, 500 + Math.random() * 1500);
        }
    };
	var getSAPClientFromContextFilter = function() {
		var aTerms = oContextFilter.getInternalFilter().getFilterTermsForProperty('SAPClient');
		if (aTerms === undefined || aTerms.length !== 1) {
			oMessageHandler.putMessage(oMessageHandler.createMessageObject({
				code : "5025"
			}));
		}
		return aTerms[0].getValue();
	};

	var initLogicalSystem = function() {
		var sServiceRoot = oCoreApi.getPersistenceConfiguration().logicalSystem.service;
		var sEntityType = oCoreApi.getPersistenceConfiguration().logicalSystem.entityType;
		var sSapClientFromFilter = getSAPClientFromContextFilter();

		if(sServiceRoot === null){
			sLogicalSystem = sSapClientFromFilter;
			return;
		}		
		
		if(sEntityType === undefined) {
			sEntityType = sap.apf.core.constants.entitySets.logicalSystem;
		}
		
		if (sSapClient === sSapClientFromFilter) {
			return;
		}
		
		sSapClient = sSapClientFromFilter;
		var oFilter = new sap.apf.core.utils.Filter(oMessageHandler, "SAPClient", 'eq', sSapClient);
		var sUrl = oCoreApi.getUriGenerator().getAbsolutePath(sServiceRoot);
		sUrl = sUrl + oCoreApi.getUriGenerator().buildUri(oMessageHandler, sEntityType, [ 'LogicalSystem' ], oFilter, undefined, undefined, undefined, undefined, undefined, 'Results');
		var oRequest = {
			requestUri : sUrl,
			method : "GET",
			headers : {
				"x-csrf-token" : sXsrfToken
			},
			async : false
		};
		var fnOnSuccess = function(oData) {
			if (oData && oData.results && oData.results instanceof Array && oData.results.length === 1 && oData.results[0].LogicalSystem) {
				sLogicalSystem = oData.results[0].LogicalSystem;
			} else {
				oMessageHandler.putMessage(oMessageHandler.createMessageObject({
					code : "5026",
					aParameters : [ sSapClient ]
				}));
			}
		};
		var fnError = function(oError) {
			var oMessageObject = oMessageHandler.createMessageObject({
				code : "5026",
				aParameters : [ sSapClient ]
			});
			if (oError.messageObject !== undefined && oError.messageObject.type === "messageObject" ) {
				oMessageObject.setPrevious(oError.messageObject);
			}
			
			oMessageHandler.putMessage(oMessageObject);
		};
		that.odata(oRequest, fnOnSuccess, fnError);
	};
};
}; // end of sap/apf/core/sessionHandler.js
if ( !jQuery.sap.isDeclared('sap.apf.core.step') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global sap, jQuery */
jQuery.sap.declare("sap.apf.core.step");


(function() {
    'use strict';
/**
 * @private
 * @class A step is a runtime container for binding and request. 
 * @name sap.apf.core.Step
 * @param {object} oMessageHandler Message handler instance
 * @param {object} oStepConfig Step configuration object from analytical content configuration
 * @param {sap.apf.core.ConfigurationFactory} oFactory
 * @returns {sap.apf.core.Step} 
 */
sap.apf.core.Step = function(oMessageHandler, oStepConfig, oFactory) {
	oMessageHandler.check(oStepConfig !== undefined, "Step: step configuration is missing");
	oMessageHandler.check(oStepConfig.binding !== undefined, "No binding assigned to step " + oStepConfig.id + " in analytical configuration", sap.apf.core.constants.message.code.errorCheckConfiguration);

	var oBinding, oRequest, oCachedFilter, oCachedRequestOptions;
	var oAdditionalConfigurationProperties = jQuery.extend(true, {}, oStepConfig);
	// delete properties from step template which are not needed in step instance
	delete oAdditionalConfigurationProperties.id;
	delete oAdditionalConfigurationProperties.picture;
	delete oAdditionalConfigurationProperties.hoverPicture;
	delete oAdditionalConfigurationProperties.title;
	delete oAdditionalConfigurationProperties.longTitle;
	delete oAdditionalConfigurationProperties.type;
	delete oAdditionalConfigurationProperties.thumbnail;
	delete oAdditionalConfigurationProperties.categories;
	
	/**
	 * @private
     * @description Contains 'step'
	 * @returns {string}
	 */
	this.type = oStepConfig.type;

	/**
     * @private
	 * @description Contains 'title'
	 * @returns {string}
	 */
	this.title = jQuery.extend(true, {}, oStepConfig.title);
	
	/**
     * @private
     * @description Contains 'longTitle'
	 * @returns {string}
	 */
	this.longTitle = undefined;
	if (oStepConfig.longTitle) {
		this.longTitle = jQuery.extend(true, {}, oStepConfig.longTitle);
	}
	
	/**
     * @private
	 * @description Contains 'thumbnail'
	 * @returns {string}
	 */
	this.thumbnail = jQuery.extend(true, {}, oStepConfig.thumbnail);

	/**
     * @private
	 * @description Contains 'categories'
	 * @returns {object[]}
	 */
	this.categories = oStepConfig.categories;

	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#getAdditionalConfigurationProperties
	 * @description Returns additional properties from step template
	 * @returns {object}
	 */
	this.getAdditionalConfigurationProperties = function() {
		return oAdditionalConfigurationProperties;
	};

	/** 
	 * @private
	 * @function
	 * @name sap.apf.core.Step#update
	 * @description Do not use. Not part of the APF API. 
	 * Method should only be called internally by APF. 
	 * APF consumers must call sap.apf.updatePath() instead.
	 * @returns undefined
	 */
	this.update = function(oFilterForRequest, callbackAfterRequest) {
		var oCurrentRequestOptions = oBinding.getRequestOptions();

		var bFilterChanged = !oFilterForRequest.isEqual(oCachedFilter);
		var bRequestOptionsChanged = !areRequestOptionsEqual(oCachedRequestOptions, oCurrentRequestOptions);

		if (oRequest && (bFilterChanged || bRequestOptionsChanged)) {
			oRequest.sendGetInBatch(oFilterForRequest, callbackAfterRequest, oCurrentRequestOptions);
		} else {
			callbackAfterRequest({}, true);
		}
 	};
 	/**
 	 * @private
 	 * @function
 	 * @name sap.apf.core.Step#determineFilters
 	 * @description Do not used. Not part of the APF API.
 	 * Called APF internally from path update to invoke filter calculation on step.
 	 * @param {sap.apf.utils.Filter} oFilter
 	 * @returns undefined
 	 */
 	this.determineFilter = function(oCumulatedFilter, callbackFromStepFilterProcessing) {
 		if(mappingRequired() && this.getFilter().toUrlParam()) {
	 		var callbackAfterMappingRequest = function(oResponse){
	 	 		var aData = [];
	 	 		var aTarget;
	 	 		var oFilter;
	 	 		if (oResponse && oResponse.type && oResponse.type === "messageObject") {
	 	 			oMessageHandler.putMessage(oResponse); // technically logging
	 	 		}else{
	 	 			aData =  oResponse.data;
	 	 			aTarget = oStepConfig.filterMapping.target;
	 	 			oFilter = new sap.apf.core.utils.Filter(oMessageHandler);
	 	 			for(var i=0; i < aData.length; i++){
	 	 				var oFilterAnd = new sap.apf.core.utils.Filter(oMessageHandler);
	 	 				for(var j=0; j < aTarget.length; j++){
	 	 					oFilterAnd.addAnd(new sap.apf.core.utils.Filter(oMessageHandler, aTarget[j], sap.apf.core.constants.FilterOperators.EQ, aData[i][aTarget[j]]));
	 	 				}
	 	 				oFilter.addOr(oFilterAnd);
	 	 			}
	 	 			if(oStepConfig.filterMapping.keepSource === 'true') {
	 	 				oFilter = this.getFilter().addAnd(oFilter);
	 	 			}
	 	 			callbackFromStepFilterProcessing(oFilter);
	 	 		}
	 		};
 			var oRequestConfig = oFactory.getConfigurationById(oStepConfig.filterMapping.requestForMappedFilter);
 			oRequestConfig.selectProperties = oStepConfig.filterMapping.target;
 			var oMergedFilter = oCumulatedFilter.addAnd(this.getFilter()); 	
 			oFactory.createRequest(oRequestConfig).sendGetInBatch(oMergedFilter, callbackAfterMappingRequest.bind(this));
 		} else {
 			callbackFromStepFilterProcessing(this.getFilter());
 		}
 	}; 	
	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#setFilter
	 * @description Sets the cumulative filter.
	 * @param {sap.apf.utils.Filter} oFilter
	 * @returns undefined
	 */
	this.setFilter = function(oFilter) {
		return oBinding.setFilter(oFilter);
	};
	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#getFilter
	 * @description Fetches the selection from the representation. 
	 * @returns {sap.apf.core.utils.Filter} 
	 */
	this.getFilter = function() {
		return oBinding.getFilter();
	};

	/** 
	 * @private
	 * @function
	 * @name sap.apf.core.Step#setData
	 * @description Do not use. Not part of the APF API. 
	 * Method should only be called internally by APF.
	 * @returns undefined
	 */
	this.setData = function(oDataResponse, oFilterThatHasBeenUsedToRetrieveData) {
		oCachedFilter = oFilterThatHasBeenUsedToRetrieveData.copy();
		oCachedRequestOptions = jQuery.extend({}, oBinding.getRequestOptions());
		oBinding.setData(oDataResponse);
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#getRepresentationInfo
	 * @description Returns an array of representation information objects.
	 * @returns {object[]}
	 */
	this.getRepresentationInfo = function() {
		return oBinding.getRepresentationInfo();
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#getSelectedRepresentationInfo
	 * @description Returns the representation information object of the selected representation. 
	 * @returns {object}
	 */
	this.getSelectedRepresentationInfo = function() {
		return oBinding.getSelectedRepresentationInfo();
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#getSelectedRepresentation
	 * @description Returns the selected representation object. 
	 * @returns {sap.apf.ui.representations.representationInterface}
	 */
	this.getSelectedRepresentation = function() {
		return oBinding.getSelectedRepresentation();
	};

	/**
	 * @private
	 * @function
	 * @name sap.apf.core.Step#setSelectedRepresentation
	 * @description Sets the selected representation via representation id. 
	 * The selected representation receives the response data through setData().  
	 * @param {string} sRepresentationId The representation id used to identify the representation. 
	 * @returns {undefined}
	 */
	this.setSelectedRepresentation = function(sRepresentationId) {
		oBinding.setSelectedRepresentation(sRepresentationId);
	};
	/** 
	 * @private
	 * @function
	 * @name sap.apf.core.Step#serialize
	 * @description Do not use. Not part of the APF API. 
	 * Method should only be called internally by APF.
	 * @returns {object}
	 */
	this.serialize = function() {
		return {
            stepId : oStepConfig.id,
            binding : oBinding.serialize()
        };
	};
	/** 
	 * @private
	 * @function
	 * @name sap.apf.core.Step#deserialize
	 * @description Do not use. Not part of the APF API. 
	 * Method should only be called internally by APF.
	 * @returns {object}
	 */
	this.deserialize = function(oSerializableStep) {
		oBinding.deserialize(oSerializableStep.binding);
		oMessageHandler.check(oStepConfig.id, oSerializableStep.stepId, "sap.apf.core.step.deserialize inconsistent serialization data - id " + oSerializableStep.stepId);
		return this;
	};
	initialize();

	// private functions
	
	function initialize() {
		oBinding = oFactory.createBinding(oStepConfig.binding);
		delete oAdditionalConfigurationProperties.binding;
		if (oStepConfig.request !== undefined && oStepConfig.request !== "") {
			oRequest = oFactory.createRequest(oStepConfig.request);
			delete oAdditionalConfigurationProperties.request;
		}
	}
	function areRequestOptionsEqual(oOptions1, oOptions2) {
		var nLength1 = 0;
		var nLength2 = 0;
		var property;
		for(property in oOptions1) {
			nLength1++;
		}
		for(property in oOptions2) {
			nLength2++;
		}
		if (nLength1 !== nLength2) {
			return false;
		}
		for(property in oOptions1) {
            if(!oOptions1.hasOwnProperty(property)) {
                continue;
            }
			if (typeof oOptions1[property] === 'object') {
				if(!areRequestOptionsEqual(oOptions1[property], oOptions2[property])) {
					return false;
				}
			} else {
				if (oOptions1[property] !== oOptions2[property]) {
					return false;
				}
			}
		}
		return true;
	}
	function mappingRequired() {
		if(oStepConfig.filterMapping) {
			if(oStepConfig.filterMapping.requestForMappedFilter &&
			   oStepConfig.filterMapping.target instanceof Array &&
			   oStepConfig.filterMapping.keepSource) {
				return true;
			} else {
 				oMessageHandler.putMessage(oMessageHandler.createMessageObject({
					code : "5104"
				}));
 				return false;
			}
		} else {
			return false;
		}
	}
};

}());
}; // end of sap/apf/core/step.js
if ( !jQuery.sap.isDeclared('sap.apf.core.configurationFactory') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global sap, apf, modeler, jQuery*/

(function () {
    'use strict';

    jQuery.sap.declare("sap.apf.core.configurationFactory");
    
    
    
    
    
    
    

    /**
     * @private
     * @class This class loads the configuration object, registers its properties and provides getters to receive references or copies of them.
     */
    sap.apf.core.ConfigurationFactory = function (oInject) {
        // Private Variables and functions
        var that = this;
        var idRegistry = new sap.apf.utils.Hashtable(oInject.messageHandler);
        var setItem = function (oItem) {
            oInject.messageHandler.check(oItem !== undefined && oItem.hasOwnProperty("id") !== false, "oItem is undefined or property 'id' is missing", sap.apf.core.constants.message.code.errorCheckConfiguration);
            if (!idRegistry) {
                idRegistry = new sap.apf.utils.Hashtable(oInject.messageHandler);
            }
            var result = idRegistry.setItem(oItem.id, oItem);
            oInject.messageHandler.check((result === undefined), "Configuration includes duplicated identifiers (IDs)", sap.apf.core.constants.message.code.errorCheckConfigurationWarning);
        };
        var getItemsByType = function (type) {
            var aResults = [];
            if (idRegistry.getNumberOfItems() !== 0) {
                idRegistry.each(function (index, element) {
                    if (element.type === type) {
                        aResults.push(element);
                    }
                });
                return aResults;
            }
            oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                code: "5020"
            }));
            return aResults;
        };

        function loadStep(oStep) {
            if (oStep.type === undefined) {
                oStep.type = "step";
            }
            setItem(oStep);
        }

        function loadSteps(aSteps) {
            oInject.messageHandler.check(aSteps !== undefined && aSteps instanceof Array !== false, "aSteps is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aSteps.forEach(function (step) {
                loadStep(step);
            });
        }

        function loadRequest(oRequest) {
            if (oRequest.type === undefined) {
                oRequest.type = "request";
            }
        	if(oRequest.entitySet) {
        		oRequest.entityType = oRequest.entitySet;
        		delete oRequest.entitySet;
        	}
            setItem(oRequest);
        }

        function loadNavigationTarget(navigationTarget) {
        	if (navigationTarget.type  === undefined) {
        		navigationTarget.type = "navigationTarget";
        	}
        	setItem(navigationTarget);
        }
        function loadRequests(aRequests) {
            oInject.messageHandler.check(aRequests !== undefined && aRequests instanceof Array !== false, "aRequests is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aRequests.forEach(function (request) {
                loadRequest(request);
            });
        }

        function loadBinding(oBinding) {
            function checkRepresentationForID() {
                var representationRegistry = new sap.apf.utils.Hashtable(oInject.messageHandler);
                oBinding.representations.forEach(function (representation) {
                    //check for existing id
                    if (!(representation.id && typeof representation.id === "string")) {
                        oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                            code: "5028",
                            aParameters: [ oBinding.id ]
                        }));
                    }
                    //check for duplicated id
                    if (representationRegistry.setItem(representation.id, representation.id)) {
                        oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                            code: "5029",
                            aParameters: [ oBinding.id ]
                        }));
                    }
                });
            }

            if (oBinding.type === undefined) {
                oBinding.type = "binding";
            }
            oInject.messageHandler.check(oBinding.id !== undefined, "binding has no id");
            oInject.messageHandler.check(oBinding.representations !== undefined && oBinding.representations instanceof Array !== false, "representations for binding " + oBinding.id + " not defined", sap.apf.core.constants.message.code.errorCheckConfiguration);

            checkRepresentationForID();
            setItem(oBinding);
        }

        function loadBindings(aBindings) {
            oInject.messageHandler.check(aBindings !== undefined && aBindings instanceof Array !== false, "aBindings is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aBindings.forEach(function (binding) {
                loadBinding(binding);
            });
        }

        function loadNavigationTargets(navigationTargets) {
        	oInject.messageHandler.check(navigationTargets !== undefined && navigationTargets instanceof Array !== false, "navigationTarget is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
        	navigationTargets.forEach(function (navigationTarget) {
        		loadNavigationTarget(navigationTarget);
        	});
        }
        function loadCategory(oCategoryConfig) {
            if (oCategoryConfig.type === undefined) {
                oCategoryConfig.type = "category";
            }
            setItem(oCategoryConfig);
        }

        function loadCategories(aCategories) {
            oInject.messageHandler.check(aCategories !== undefined && aCategories instanceof Array !== false, "aCategories is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aCategories.forEach(function (category) {
            	var aSteps = category.steps;
                oInject.messageHandler.check(aSteps !== undefined && aSteps instanceof Array !== false, "steps for category " + category.id + " are missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
                aSteps.forEach(function(step){
                	oInject.messageHandler.check(step.type && step.type === "step" && step.id, "step with wrong format assigned to category '" + category.id + "'");
                	oInject.messageHandler.check(that.existsConfiguration(step.id), "step with id '" + step.id + "' which is assigned to category '" + category.id + "' does not exist");
                });
                loadCategory(category);
            });
        }

        function isPredefinedRepresentation(representationTypeId) {
            var result = false;
            var aRepresentationTypes = sap.apf.core.representationTypes();
            aRepresentationTypes.forEach(function (representationTypeConfig) {
                if (representationTypeId === representationTypeConfig.id) {
                    result = true;
                }
            });
            return result;
        }

        function loadRepresentationType(oRepresentationTypeConfig) {
            var representationConstructorCandidate;
            if (oRepresentationTypeConfig.type === undefined) {
                oRepresentationTypeConfig.type = "representationType";
            }
            if (!isPredefinedRepresentation(oRepresentationTypeConfig.id)) {
                representationConstructorCandidate = sap.apf.utils.extractFunctionFromModulePathString(oRepresentationTypeConfig.constructor);
                if (!jQuery.isFunction(representationConstructorCandidate)) {
                    oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({code: '5030', parameters: [oRepresentationTypeConfig.id]}));
                }
            }
            setItem(oRepresentationTypeConfig);
        }

        function loadRepresentationTypes(aRepresentationTypes) {
            oInject.messageHandler.check(aRepresentationTypes !== undefined && aRepresentationTypes instanceof Array !== false, "aRepresentationInfo is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aRepresentationTypes.forEach(function (representationType) {
                loadRepresentationType(representationType);
            });
        }

        function loadFacetFilter(oFacetFilter) {
            if (oFacetFilter.type === undefined) {
                oFacetFilter.type = "facetFilter";
            }
            that.addObject(oFacetFilter);
        }

        function loadFacetFilters(aFacetFilters) {
            oInject.messageHandler.check(aFacetFilters !== undefined && aFacetFilters instanceof Array !== false, "Facet filter configuration is missing or not an Array", sap.apf.core.constants.message.code.errorCheckConfiguration);
            aFacetFilters.forEach(function (facetFilter) {
                loadFacetFilter.call(that, facetFilter);
            });
        }

        var loadPredefinedRepresentationTypes = function (aRepresentationTypes) {
            loadRepresentationTypes(aRepresentationTypes);
        };
        /**
         * @private
         * @class Step templates are runtime objects, which contain analysis step information based on the analytical content configuration.
         * @name sap.apf.core.configurationFactory~StepTemplate
         */
        function StepTemplate (oStepConfig, oFactory) {
            function getRepresentations(oStepConfig, oConfigurationFactory) {
                var aRepresentations = oConfigurationFactory.getConfigurationById(oStepConfig.binding).representations;
                if (aRepresentations) {
                    return aRepresentations;
                }
                oInject.messageHandler.check(false, 'Binding of step with ID "' + oStepConfig.id + '" does not contain any representations.', sap.apf.core.constants.message.code.errorCheckConfigurationWarning);

            }

            function getRepresentationInfo(oStepConfig, oConfigurationFactory) {
                var aRepresentations;
                var localRepresentationInfo = [];
                if (oStepConfig.binding) {
                    aRepresentations = getRepresentations(oStepConfig, oConfigurationFactory);
                    aRepresentations.forEach(function (representation) {
                        var oRepresentationType = jQuery.extend(true, {}, oConfigurationFactory.getConfigurationById(representation.representationTypeId));
                        oRepresentationType.representationId = representation.id;
                        oRepresentationType.representationLabel = representation.label;
                        oRepresentationType.parameter =  jQuery.extend(true, {}, representation.parameter);
                        localRepresentationInfo.push(oRepresentationType);
                    });
                    return localRepresentationInfo;
                }
                oInject.messageHandler.check(false, 'Step with ID "' + oStepConfig.id + '" does not contain any binding references.',
                    sap.apf.core.constants.message.code.errorCheckConfigurationWarning);
            }

            var oStepTemplate = jQuery.extend(true, {}, oStepConfig);
            var aRepresentationInfo = getRepresentationInfo(oStepConfig, oFactory);
            delete oStepTemplate.request;
            delete oStepTemplate.binding;
            delete oStepTemplate.thumbnail;
            delete oStepTemplate.longTitle;
            /**
             * @memberOf StepTemplate
             * @description Contains 'stepTemplate'
             * @returns {string}
             */
            oStepTemplate.type = "stepTemplate";

            /**
             * @private
             * @function
             * @memberOf sap.apf.core.configurationFactory~StepTemplate
             * @name sap.apf.core.configurationFactory~StepTemplate#getRepresentationInfo
             * @description Returns all representation information that is configured for the step.
             * @returns {object[]}
             */
            oStepTemplate.getRepresentationInfo = function () {
                var aReprInfo = jQuery.extend(true, [], aRepresentationInfo); // clone deep
                aReprInfo.forEach(function (info) {
                    delete info.id;
                    delete info.type;
                    delete info.constructor;
                });
                return aReprInfo;
            };

            return oStepTemplate;
        }
        // Private Func
        // Constructor functions
        var Category = function (oCategoryConfig, context) {
        	var that = this;
            this.type = oCategoryConfig.type;
            this.id = oCategoryConfig.id;
            this.label = oCategoryConfig.label;
            this.stepTemplates = [];
            oCategoryConfig.steps.forEach(function(stepReference){
            	var step = context.getConfigurationById(stepReference.id);
            	that.stepTemplates.push(new StepTemplate(step, context));
            });
            return this;
        };
        var Thumbnail = function (oThumbnailConfig, oFactory) { // oFactory needed when accessing object of configurationFactory!
            this.type = "thumbnail";
            if (oThumbnailConfig === undefined) {
                return this;
            }
            this.leftUpper = oFactory.createLabel(oThumbnailConfig.leftUpper);
            this.rightUpper = oFactory.createLabel(oThumbnailConfig.rightUpper);
            this.leftLower = oFactory.createLabel(oThumbnailConfig.leftLower);
            this.rightLower = oFactory.createLabel(oThumbnailConfig.rightLower);
            this.altTitle = oFactory.createLabel(oThumbnailConfig.altTitle);
            return this;
        };
        /**
         * @private
         * @description Creates and returns a new thumbnail object.
         * @param oThumbnailConfig
         * @return Object
         */
        this.createThumbnail = function (oThumbnailConfig) {
            return new Thumbnail(oThumbnailConfig, this);
        };
        function Label (oLabelConfig) {
            this.type = "label";
            this.kind = oLabelConfig.kind;
            if (this.kind === "text") {
                this.file = oLabelConfig.file;
                this.key = oLabelConfig.key;
            } else if (this.kind === "property") {
                this.property = oLabelConfig.property;
            } else if (this.kind === "sapLabel") {
                this.labelOf = oLabelConfig.labelOf;
            }
        }
        /**
         * @private
         * @param oLabelConfig
         * @return {Object|undefined} New Object of type Label
         */
        this.createLabel = function (oLabelConfig) {
            return new Label(oLabelConfig, this);
        };
        // Public Func
        /**
         * @private
         * @description Loads all properties of the input configuration object, which can also include custom error texts.
         * Note: For a request object in oConfiguration.requests, the property entityType is deprecated. Instead of entityType, the property entitySet shall be used. 
         * @param oConfiguration configuration object
         */
        this.loadConfig = function (oConfiguration) {
            idRegistry = new sap.apf.utils.Hashtable(oInject.messageHandler);
            if(oConfiguration.applicationTitle) {
            	idRegistry.setItem('applicationTitle', oConfiguration.applicationTitle);
            }
            
           	var inject = { constructor : { hashtable      : sap.apf.utils.Hashtable},
     			           instance :    { messageHandler : oInject.messageHandler}};
            sap.apf.utils.migrateConfigToCategoryStepAssignment(oConfiguration, inject);	
        	
            var aRepresentationTypes = sap.apf.core.representationTypes();
            loadPredefinedRepresentationTypes(aRepresentationTypes);
            loadSteps(oConfiguration.steps);
            loadCategories(oConfiguration.categories);
            loadRequests(oConfiguration.requests);
            loadBindings(oConfiguration.bindings);
            if (oConfiguration.representationTypes) {
                loadRepresentationTypes(oConfiguration.representationTypes);
            }
            if (oConfiguration.facetFilters) {
                loadFacetFilters.call(this, oConfiguration.facetFilters);
            }
            if (oConfiguration.navigationTargets) {
            	loadNavigationTargets(oConfiguration.navigationTargets);
            }
        };
        /**
         * @private
         * @description Adds an object to the configuration factory
         * @param {object} configurationObject - Must contain valid values for 'type'-property and 'id'.
         * Further properties are type specific.
         * @returns undefined
         */
        this.addObject = function (configurationObject) {
            if(!sap.apf.core.constants.configurationObjectTypes.hasOwnProperty(configurationObject.type)) {
//            if (!(configurationObject.type in sap.apf.core.constants.configurationObjectTypes)) {
                oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                    code: "5033",
                    aParams: [configurationObject.type]
                }));
            }
            if (!(configurationObject.property)) {
                oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({
                    code: "5034"
                }));
            }
            idRegistry.setItem(configurationObject.id, configurationObject);
        };
        /**
         * @private
         * @description Returns a reference of a configuration object. Not a copy.
         * @param sId
         * @returns Object
         */
        this.getConfigurationById = function (sId) {
            return idRegistry.getItem(sId);
        };

        /**
         * @private
         * @description Returns true, if configuration object exists.
         * @param sId
         * @returns {boolean}
         */
        this.existsConfiguration = function (sId) {
            return idRegistry.hasItem(sId);
        };

        /**
         * @private
         * @description Returns service documents
         * @returns {Array}
         */
        this.getServiceDocuments = function () {
            var aRequestItems = getItemsByType("request");
            var aServiceDocuments = [];
            aRequestItems.forEach(function (item) {
                aServiceDocuments.push(item.service);
            });
            return sap.apf.utils.eliminateDuplicatesInArray(oInject.messageHandler, aServiceDocuments);
        };

        /**
         * @private
         * @description Returns the navigation targets. Currently no parameters are supported.
         * @returns Array of navigation targets
         */
        this.getNavigationTargets = function() {
        	var navigationTargets = getItemsByType("navigationTarget");
        	return jQuery.extend(true, [], navigationTargets);
        };
        /**
         * @private
         * @description Returns new step templates created from all step configuration objects, containing static information only.
         *      Note that a step config object is used to create an object of type stepTemplate as well as a runtime object of type step.
         * @returns Array of objects
         */
        this.getStepTemplates = function () {
            var aItems = getItemsByType("step");
            var aStepTemplates = [];
            aItems.forEach(function (item, stepConfig) {
                aStepTemplates[stepConfig] = new StepTemplate(item, that);
            });
            return aStepTemplates;
        };
        /**
         * @private
         * @description Returns array of cloned facet filter configurations
         * @returns Array of objects
         */
        this.getFacetFilterConfigurations = function () {
            var facetFilters = getItemsByType("facetFilter");
            var resolvedFunction;
            facetFilters = jQuery.extend(true, [], facetFilters);
            facetFilters.forEach(function (facetFilter) {
                if (facetFilter.preselectionFunction) {
                    resolvedFunction = sap.apf.utils.extractFunctionFromModulePathString(facetFilter.preselectionFunction);
                    if (!jQuery.isFunction(resolvedFunction)) {
                        oInject.messageHandler.putMessage(oInject.messageHandler.createMessageObject({code: '5035', parameters: [facetFilter.id]}));
                        facetFilter.preselectionFunction = undefined;
                    } else {
                        facetFilter.preselectionFunction = resolvedFunction;
                    }
                }
            });
            return facetFilters;
        };
        /**
         * @private
         * @description Returns new category objects of all loaded category configuration objects.
         * @returns Array
         */
        this.getCategories = function () {
            var aItems = getItemsByType("category");
            var aCategories = [];
            aItems.forEach(function (item, inx) {
                aCategories[inx] = new Category(item, that);
            });
            return aCategories;
        };
        /**
         * @private
         * @description Creates and returns a new step object from its specified configuration object.
         * @param sStepId Identifies the configuration object. If the step id is not known an error will be thrown.
         * @returns Object
         */
        this.createStep = function (sStepId) {
            var oStepConfig = this.getConfigurationById(sStepId);
            oInject.messageHandler.check((oStepConfig !== undefined && oStepConfig.type === "step"), "Error - referenced object is undefined or has not type step", sap.apf.core.constants.message.code.errorCheckConfiguration);
            oInject.messageHandler.check(sap.apf.core.Step !== undefined, "Step must be defined ", sap.apf.core.constants.message.code.errorCheckConfiguration);
            oInject.messageHandler.check(typeof sap.apf.core.Step === "function", "Step must be Ctor function");
            return new sap.apf.core.Step(oInject.messageHandler, oStepConfig, this);
        };
        /**
         * @private
         * @description Creates and returns a new binding object, by the identified configuration object.
         * @param sBindingId Identifies the configuration object. If the id is not known an error will be thrown.
         * @param oTitle Short title, type label.
         * @param oLongTitle Long title, type label.
         * @returns {Object}
         */
        this.createBinding = function (sBindingId, oTitle, oLongTitle) {
            var oBindingConfig = this.getConfigurationById(sBindingId);
            oInject.messageHandler.check((oBindingConfig !== undefined && oBindingConfig.type === "binding"), "Error - oBindingConfig is undefined or has not type binding", sap.apf.core.constants.message.code.errorCheckConfiguration);
            oBindingConfig.oTitle = oTitle;
            oBindingConfig.oLongTitle = oLongTitle;
            return new sap.apf.core.Binding(oInject, oBindingConfig, this);
        };
        /**
         * @private
         * @description Creates and returns a new request object.
         * Note: For the request object, the property entityType is deprecated. Instead of entityType, the property entitySet shall be used. 
         * @param {String|Object} request - Request id or request object. If the step id is not known an error will be thrown.
         * @param {Object} request.type {String}
         * @param {Object} request.id {String}
         * @param {Object} request.service {String}
         * @param {Object} request.entitySet}
         * @returns {Object|undefined}
         */
        this.createRequest = function (request) {
        	if(request.entitySet) { // robustness: runtime only handles entityTypes internally -> set entitySet to entityType
        		request.entityType = request.entitySet;
        		delete request.entitySet;
        	}
            var oMessageObject;
            var oRequestConfig;
            function getUniqueId() {
                var date = new Date();
                return Math.random() * date.getTime();
            }
            if (typeof request === "string") {
                oRequestConfig = this.getConfigurationById(request);
                if (!(oRequestConfig !== undefined && oRequestConfig.type === "request")) {
                    oMessageObject = oInject.messageHandler.createMessageObject({
                        code: "5004",
                        aParameters: [ request ]
                    });
                    oInject.messageHandler.putMessage(oMessageObject);
                    return undefined;
                }
            } else {
                oRequestConfig = request;
                oInject.messageHandler.check(oRequestConfig.type && oRequestConfig.type === "request" &&
                        oRequestConfig.service && oRequestConfig.entityType,
                    'Wrong request configuration when creating a new request');
                if (!oRequestConfig.id) {
                    oRequestConfig.id = getUniqueId();
                    setItem(oRequestConfig);
                }

            }
            return new sap.apf.core.Request(oInject, oRequestConfig);
        };

       
        if (oInject.constructor.registryProbe) {
            this.getRegistry = function () {
                return new oInject.constructor.registryProbe(idRegistry);
            };
        }
    };
}());

}; // end of sap/apf/core/configurationFactory.js
if ( !jQuery.sap.isDeclared('sap.apf.core.readRequest') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.readRequest");



/**
 * @public
 * @class Facade for sap.apf.core.Request for getting data via the OData protocol. This corresponds to a normal HTTP GET method. Creation is done via APF API.
 * @name sap.apf.core.ReadRequest
 * @param {object} oInject Injection object.
 * @param {object} oInject.coreApi Instance of core API.
 * @param {object} oInject.oMessageHandler The APF Message handler.
 * @param {object} oRequest The object represents an OData GET request.
 * @param {string} sService Service defined by the analytical content configuration.
 * @param {string} sEntityType Entity type defined by the analytical content configuration.
 * @returns {sap.apf.core.ReadRequest}
 */
sap.apf.core.ReadRequest = function (oInject, oRequest, sService, sEntityType) {
	var oCoreApi = oInject.coreApi;
	var oMessageHandler = oInject.messageHandler;
	/**
	 * @description Contains 'readRequest'
	 * @returns {string}
	 */
	this.type = "readRequest";
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.ReadRequest#send
	 * @description Executes an OData request.
	 * @param [{sap.apf.utils.Filter}] oFilter
	 * @param {function} fnCallback  The first argument of the callback function is the received data (as Array). The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is {sap.apf.core.MessageObject}. 
	 * @param {Object} oRequestOptions - An optional object containing additional query string options
	 * Format: { orderby : [{ property : <property_name>, order : <asc|desc>}], top : <integer>, skip : <integer> }  
	 * @returns undefined
	 */
	this.send = function (oFilter, fnCallback, oRequestOptions) {
		var filter;
		var callbackForRequest = function (oResponse, bNotUpdated) {
			var oMessageObject;
			var oEntityTypeMetadata;
			var aData = [];
			if (oResponse && oResponse.type && oResponse.type === "messageObject") {
				oMessageHandler.putMessage(oResponse); // technically logging
				oMessageObject = oResponse;
			} else {
				aData = oResponse.data;
				oEntityTypeMetadata = oResponse.metadata;
			}
			fnCallback(aData, oEntityTypeMetadata, oMessageObject);
		};
		if (oFilter) {
			filter = oFilter.getInternalFilter()
		} else {
			filter = new sap.apf.core.utils.Filter(oMessageHandler);
		}
		oRequest.sendGetInBatch(filter, callbackForRequest, oRequestOptions);
	};
	/**
	 * @private
     * @deprecated since Version 1.23.1.
	 * @function
	 * @name sap.apf.core.ReadRequest#getMetadata
	 * @description Returns the corresponding meta data object for the read request.
	 * @returns {sap.apf.core.EntityTypeMetadata}
	 */
	this.getMetadata = function () {
		return oCoreApi.getEntityTypeMetadata(sService, sEntityType);
	};
    /**
     * @public
     * @function
     * @name sap.apf.core.ReadRequest#getMetadataFacade
     * @description Returns {sap.apf.core.MetadataFacade} which provides convenience methods for accessing metadata
     * (only for the service document, which is assigned to this read request instance).
     * @param {string} sService Service defined by the request configuration.
     * @returns {sap.apf.core.MetadataFacade}
     */
    this.getMetadataFacade = function () {
        return oCoreApi.getMetadataFacade(sService);
    };
};

}; // end of sap/apf/core/readRequest.js
if ( !jQuery.sap.isDeclared('sap.apf.core.readRequestByRequiredFilter') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */

jQuery.sap.declare("sap.apf.core.readRequestByRequiredFilter");



/**
 * @public
 * @class Facade for sap.apf.core.Request for getting data via the OData protocol. This corresponds to a normal HTTP GET method. Creation is done via APF API.
 * In addition to the handed over filter argument in method send(), the required filters and parameter entity set key properties of the configured entity type are applied, which are determined from path filter. 
 * @name sap.apf.core.ReadRequestByRequiredFilter
 * @param {object} oInject Injection object.
 * @param {object} oInject.coreApi Instance of core API.
 * @param {object} oInject.oMessageHandler The APF Message handler.
 * @param {object} oRequest The object represents an OData GET request.
 * @param {string} sService Service defined by the analytical content configuration.
 * @param {string} sEntityType Entity type defined by the analytical content configuration.
 * @returns {sap.apf.core.ReadRequestByRequiredFilter}
 */
sap.apf.core.ReadRequestByRequiredFilter = function (oInject, oRequest, sService, sEntityType) {
	var oCoreApi = oInject.coreApi;
	var oMessageHandler = oInject.messageHandler;
	var oMetadata;
	
	/**
	 * @description Contains 'readRequestByRequiredFilter'
	 * @returns {string}
	 */
	this.type = "readRequestByRequiredFilter";
	/**
	 * @public
	 * @function
	 * @name sap.apf.core.ReadRequestByRequiredFilter#send
	 * @description Executes an OData request.
	 * @param [{sap.apf.utils.Filter}] oFilter
	 * @param {function} fnCallback The first argument of the callback function is the received data (as Array). The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is {sap.apf.core.MessageObject}. 
	 * @param {Object} oRequestOptions An optional object containing additional query string options
	 * Format: { orderby : [{ property : <property_name>, order : <asc|desc>}], top : <integer>, skip : <integer> }  
	 * @returns undefined
	 */
	this.send = function (oFilter, fnCallback, oRequestOptions) {
		var oRequestFilter;
		var callbackForRequest = function (oResponse, bNotUpdated) {
			var oMessageObject;
			var oEntityTypeMetadata;
			var aData = [];
			if (oResponse && oResponse.type && oResponse.type === "messageObject") {
				oMessageHandler.putMessage(oResponse); // technically logging
				oMessageObject = oResponse;
			} else {
				aData = oResponse.data;
				oEntityTypeMetadata = oResponse.metadata;
			}
			fnCallback(aData, oEntityTypeMetadata, oMessageObject);
		};
		
		if (!oMetadata) {
			oMetadata = oCoreApi.getMetadata(sService);
		}
		
//		Get parameter entity set key properties
		var aParameterEntitySetKeyProperties = oMetadata.getParameterEntitySetKeyProperties(sEntityType);
		
//		Get required filters
		var sRequiredFilterProperty = "";
		var oEntityTypeMetadata = oMetadata.getEntityTypeMetadata(sEntityType);
		if (oEntityTypeMetadata.requiresFilter !== undefined && oEntityTypeMetadata.requiresFilter === "true") {
			if (oEntityTypeMetadata.requiredProperties !== undefined) {
				sRequiredFilterProperty = oEntityTypeMetadata.requiredProperties;
			}
		}
		
//		Join parameter entity set key properties & Required filters
		var aRequiredProperties = sRequiredFilterProperty.split(',');
		aParameterEntitySetKeyProperties.forEach(function(property){
			aRequiredProperties.push(property.name); 
		});
		
//		Reduce the context filter to {parameter entity set key properties + Required filters}
		var oProjectedContextFilter = oCoreApi.getContext().getInternalFilter().reduceToProperty(aRequiredProperties);
		
//		Intersect both filters.
		
		if (oFilter) {
			oRequestFilter = oFilter.getInternalFilter();
			oRequestFilter.addAnd(oProjectedContextFilter);
		} else {
			oRequestFilter = oProjectedContextFilter;
		}
		
		
		oRequest.sendGetInBatch(oRequestFilter, callbackForRequest, oRequestOptions);

	};
	/**
     * @public
     * @function
     * @name sap.apf.core.ReadRequestByRequiredFilter#getMetadataFacade
     * @description Returns {sap.apf.core.MetadataFacade} which provides convenience methods for accessing metadata
     * (only for the service document, which is assigned to this read request instance).
     * @param {string} sService Service defined by the request configuration.
     * @returns {sap.apf.core.MetadataFacade}
     */
    this.getMetadataFacade = function () {
        return oCoreApi.getMetadataFacade(sService);
    };
};

}; // end of sap/apf/core/readRequestByRequiredFilter.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.core.instance') ) {
/*!
 * SAP APF Analysis Path Framework
 *
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global sap, apf, modeler, core, OData, jQuery*/


jQuery.sap.declare("sap.apf.modeler.core.instance");

(function () {
    'use strict';

    jQuery.sap.require('sap.ui.thirdparty.datajs'); // unlisted dependency retained

    
    
      
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    /**
     * @class Minimal core object that provides services for error handling, access to ajax/odata and text resources
     * @param {object} persistenceConfiguration Configuration of the persistence service
     * @param {object} inject Constructors, instances and functions, that shall be used
     */
    sap.apf.modeler.core.Instance = function(persistenceConfiguration, inject) {

        var that = this;

        var	ApplicationHandler,
            ConfigurationHandler,
            ConfigurationEditor,
            ConfigurationObjects,
            ConfigurationFactory,
            Step,
            FacetFilter,
            NavigationTarget,
            Representation,
            ElementContainer,
            Hashtable,
            RegistryProbe,
        	Metadata,
			EntityTypeMetadata,
			MetadataFacade,
			MetadataProperty,
			MetadataFactory,
			LazyLoader,
            textHandler,
            messageHandler,
            sessionHandler,
            persistenceProxy,
            metadataFactory,
            injectForFollowUp,
            injectMetadataFactory,
            injectLazyLoader,
            fnOdataRequestWrapper,
            fnAjax,
            fnLoadApplicationHandler,
            fnLoadConfigurationHandler,
            lazyLoaderForApplicationHandler,
            lazyLoaderForConfigurationHandler,
            actionsPerSemanticObjectHashTable,
            allAvailableSemanticObjects;


        //constructors
        ApplicationHandler = (inject && inject.constructor && inject.constructor.applicationHandler) || sap.apf.modeler.core.ApplicationHandler;
        ConfigurationHandler = (inject && inject.constructor && inject.constructor.configurationHandler) || sap.apf.modeler.core.ConfigurationHandler;
        ConfigurationEditor = (inject && inject.constructor && inject.constructor.configurationEditor) || sap.apf.modeler.core.ConfigurationEditor;
        ConfigurationObjects = (inject && inject.constructor && inject.constructor.configurationObjects) || sap.apf.modeler.core.ConfigurationObjects;
        ConfigurationFactory = (inject && inject.constructor && inject.constructor.configurationFactory) || sap.apf.core.ConfigurationFactory;
        ElementContainer = (inject && inject.constructor && inject.constructor.elementContainer) || sap.apf.modeler.core.ElementContainer;
        Step = (inject && inject.constructor && inject.constructor.step) || sap.apf.modeler.core.Step;
        FacetFilter = (inject && inject.constructor && inject.constructor.facetFilter) || sap.apf.modeler.core.FacetFilter;
        NavigationTarget = (inject && inject.constructor && inject.constructor.navigationTarget) || sap.apf.modeler.core.NavigationTarget;
        Representation = (inject && inject.constructor && inject.constructor.representation) || sap.apf.modeler.core.Representation;
        Hashtable = (inject && inject.constructor && inject.constructor.hashtable) || sap.apf.utils.Hashtable;
        RegistryProbe = (inject && inject.constructor && inject.constructor.registryProbe) || sap.apf.modeler.core.RegistryWrapper;
        LazyLoader = (inject && inject.constructor && inject.constructor.LazyLoader) || sap.apf.modeler.core.LazyLoader;
        Metadata = (inject && inject.constructor && inject.constructor.metadata) || sap.apf.core.Metadata;
        EntityTypeMetadata = (inject && inject.constructor && inject.constructor.entityTypeMetadata) || sap.apf.core.EntityTypeMetadata;
        MetadataFacade = (inject && inject.constructor && inject.constructor.metadataFacade) || sap.apf.core.MetadataFacade;
        MetadataProperty = (inject && inject.constructor && inject.constructor.metadataProperty) || sap.apf.core.MetadataProperty;
        MetadataFactory = (inject && inject.constructor && inject.constructor.metadataFactory) || sap.apf.core.MetadataFactory;

        //instances
        if (inject && inject.constructor && inject.constructor.textHandler) {
            textHandler = new inject.constructor.textHandler();
        } else {
            textHandler = new sap.apf.modeler.core.TextHandler();
        }

        if (inject && inject.constructor && inject.constructor.messageHandler) {
            messageHandler = new inject.constructor.messageHandler(true);
        } else {
            messageHandler = new sap.apf.core.MessageHandler(true);
        }

        messageHandler.setTextResourceHandler(textHandler);
        messageHandler.loadConfig(sap.apf.core.messageDefinition);
        messageHandler.loadConfig(sap.apf.modeler.core.messageDefinition);
        messageHandler.activateOnErrorHandling(true);

       injectForFollowUp = {
            instance : {
                messageHandler : messageHandler,
                coreApi : that
            }
        };

        if (inject && inject.constructor && inject.constructor.persistenceProxy) {
            persistenceProxy = new inject.constructor.persistenceProxy(persistenceConfiguration, injectForFollowUp);
        } else {
            persistenceProxy = new sap.apf.core.OdataProxy(persistenceConfiguration, injectForFollowUp);
        }

        //TODO Apply one consistent inject object concept also in sessionHandler
        if (inject && inject.constructor && inject.constructor.sessionHandler) {
            sessionHandler = new inject.constructors.sessionHandler(injectForFollowUp.instance);
        } else {
            sessionHandler = new sap.apf.core.SessionHandler(injectForFollowUp.instance);
        }

        //TODO Apply one consistent inject object concept also in MetadataFactory	
        injectMetadataFactory = {
            entityTypeMetadata : sap.apf.core.EntityTypeMetadata,
            hashtable : Hashtable,
            metadata : sap.apf.core.Metadata,
            metadataFacade : sap.apf.core.MetadataFacade,
            metadataProperty : sap.apf.core.MetadataProperty,
            messageHandler : messageHandler,
            coreApi : that,
            datajs : OData,
        	configurationFactory : { // Fake configurationFactory needed for getEntityTypeMetadata()
                getServiceDocuments : function() {
        			return [persistenceConfiguration.serviceRoot];
        		}
            },
            deactivateFatalError : true
        };

        metadataFactory = new sap.apf.core.MetadataFactory(injectMetadataFactory);
        
        // Lazy loader
        injectLazyLoader = {
        		constructor : { hashtable      : Hashtable },
        		instance    : { messageHandler : messageHandler}
        };
   
        // ... for applicationHandler
        fnLoadApplicationHandler = (inject && inject.functions && inject.functions.loadApplicationHandler) || loadApplicationHandler;
        function loadApplicationHandler(id, callbackAfterLoad){
        	 new ApplicationHandler({
                   instance: {
                       messageHandler: messageHandler,
                       persistenceProxy: persistenceProxy
                   },
                   constructor: {
                       hashtable: Hashtable
                   },
                   functions: {
						resetConfigurationHandler : resetConfigurationHandler
                   }
                   }, setInitializedApplicationHandler);
			function setInitializedApplicationHandler(applicationHandler, messageObject) {
			  callbackAfterLoad(id, applicationHandler, messageObject);
			}
		    function resetConfigurationHandler(application){
		    	if (lazyLoaderForConfigurationHandler.getId() === application){
		    		lazyLoaderForConfigurationHandler.getInstance().removeAllConfigurations( );
		    		lazyLoaderForConfigurationHandler.reset();
		    	}
		    }
        }
        lazyLoaderForApplicationHandler = new LazyLoader(injectLazyLoader, fnLoadApplicationHandler);
        
     // ... for configurationHandler
        fnLoadConfigurationHandler = (inject && inject.functions && inject.functions.loadConfigurationHandler) || loadConfigurationHandler;
        function loadConfigurationHandler(applicationId, callbackAfterLoad, oldConfigurationHandler){
        	var initTextPoolAndConfigurationHandler = function(data, messageObject) {

				var textPool, injectTextPool;
				var existingAnalyticalConfigurations;
				var existingTexts;
				var configurationHandler = oldConfigurationHandler;
				
				if (messageObject) {
					callbackAfterLoad(applicationId, undefined, messageObject);
				} else {
					existingAnalyticalConfigurations = data[0];
					existingTexts = data[1];
					injectTextPool = {
							instance : {
								messageHandler : messageHandler,
								persistenceProxy : persistenceProxy
							},
							constructor : {
								hashtable : Hashtable
							}
					};
					textPool = new sap.apf.modeler.core.TextPool(injectTextPool, applicationId, existingTexts);

					if (!configurationHandler) {
						configurationHandler = new ConfigurationHandler({
							instance : {
								messageHandler : messageHandler,
								persistenceProxy : persistenceProxy,
								datajs : OData,
								coreApi : that, 
								metadataFactory : metadataFactory
							},
							constructor : {
								configurationEditor: ConfigurationEditor,
								configurationFactory: ConfigurationFactory, 
								configurationObjects: ConfigurationObjects,
				        		elementContainer: ElementContainer,
				        		entityTypeMetadata : EntityTypeMetadata,
                                facetFilter : FacetFilter,
                                navigationTarget : NavigationTarget,
				        		hashtable: Hashtable,
                                representation: Representation,
                                registryProbe: RegistryProbe,
                                step: Step,
								lazyLoader : LazyLoader
							}, 
							functions : {
								getApplication : lazyLoaderForApplicationHandler.getInstance().getApplication
							}
						});
					}
					configurationHandler.setApplicationIdAndContext(applicationId, existingAnalyticalConfigurations, textPool);
					callbackAfterLoad(applicationId, configurationHandler, messageObject);
				}

			};
			

			var filterApplication = new sap.apf.core.utils.Filter(messageHandler, 'Application', 'eq', applicationId);
			var filterLanguage = new sap.apf.core.utils.Filter(messageHandler, 'Language', 'eq', sap.apf.core.constants.developmentLanguage);
			filterLanguage.addAnd(filterApplication);

			var requestConfigurations = [];
			var selectList = [ "AnalyticalConfiguration", "AnalyticalConfigurationName", "Application", "CreatedByUser", "CreationUTCDateTime", "LastChangeUTCDateTime", "LastChangedByUser" ];
			requestConfigurations.push({
				entitySetName : "configuration",
				filter : filterApplication,
				selectList : selectList
			});
			requestConfigurations.push({
				entitySetName : 'texts',
				filter : filterLanguage
			});

			persistenceProxy.readCollectionsInBatch(requestConfigurations, initTextPoolAndConfigurationHandler, true);
        }
        
        lazyLoaderForConfigurationHandler = new LazyLoader(injectLazyLoader, fnLoadConfigurationHandler);

        //functions
        fnOdataRequestWrapper = (inject && inject.functions && inject.functions.odataRequestWrapper) || sap.apf.core.odataRequestWrapper;
        fnAjax = (inject && inject.functions && inject.functions.ajax) || sap.apf.core.ajax;
        

		//core interface
		/**
		 * @see sap.apf.core.ajax
		 */
		this.ajax = function(oSettings) {
			return fnAjax(oSettings);
		};

		/**
		 * @see sap.apf.core.odataRequestWrapper
		 */
		this.odataRequest = function(oRequest, fnSuccess, fnError, oBatchHandler) {
			fnOdataRequestWrapper(messageHandler, oRequest, fnSuccess, fnError, oBatchHandler);
		};
		
		/**
		 * @see sap.apf.core.checkForTimeout
		 */
		this.checkForTimeout = function(oServerResponse) {
			var messageObject = sap.apf.core.utils.checkForTimeout(oServerResponse);
			// up to now, the error handling was hard coded in checkForTimeout
			if (messageObject) {
				messageHandler.putMessage(messageObject);
			}
			return messageObject;
		};
		/**
		 * @see sap.apf.core.MetadataFactory#getEntityTypeMetadata
		 */
		this.getEntityTypeMetadata = function(sAbsolutePathToServiceDocument, sEntityType) {
			return metadataFactory.getEntityTypeMetadata(sAbsolutePathToServiceDocument, sEntityType);
		};
		/**
		 * @see sap.apf.core.SessionHandler#getXsrfToken
		 */
		this.getXsrfToken = function(sServiceRootPath) {
			return sessionHandler.getXsrfToken(sServiceRootPath);
		};
		/**
		 * @description Returns the instance of the UriGenerator. For internal core using only.
		 */
		this.getUriGenerator = function() {
			return sap.apf.core.utils.uriGenerator;
		};
		/**
		 * @description Returns text
		 * @param {string} sRessourceKey - Key of the message in the Ressourcefile
		 * @param {string[]} [aParameters] - Parameter for placeholder replacement in the message bundle
		 * @returns {string}
		 */
		this.getText = function(sRessourceKey, aParameters) {
			return textHandler.getText(sRessourceKey, aParameters);
		};
		/**
		 * @see sap.apf#putMessage for api definition.
		 * @see sap.apf.core.MessageHandler#putMessage for implementation.
		 */
		this.putMessage = function(oMessage) {
			return messageHandler.putMessage(oMessage);
		};
		/**
		 * @see sap.apf.core.MessageHandler#check
		 */
		this.check = function(bExpression, sMessage, sCode) {
			return messageHandler.check(bExpression, sMessage, sCode);
		};

		/**
		 * @see sap.apf#createMessageObject for api definition.
		 * @see sap.apf.core.MessageHandler#createMessageObject
		 */
		this.createMessageObject = function(config) {
			return messageHandler.createMessageObject(config);
		};
		/**
		 * @see sap.apf.core.MessageHandler#setMessageCallback
		 */
		this.setCallbackForMessageHandling = function(fnCallback) {
			messageHandler.setMessageCallback(fnCallback);
		};
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#importTexts
         * @description Receives a string containing text property file for an existing application. Loads the texts and saves them.
         * @param {string} textFileString stringified property file
         * @param {functio({undefined|messageObject})} callbackImport Called after import of text file finished. Contains success        
         */
		this.importTexts = function(textFileString, callbackImport) {
			var messageObject;
			var i;
			var len;
			var textFileInformation;
			var applicationId;

			function loadTexts(existingTexts, metadata, messageObject) {
				var injectTextPool;
				var textPool;

				if (messageObject) {
					callbackImport(messageObject);
				} else {
					injectTextPool = {
						instance : {
							messageHandler : messageHandler,
							persistenceProxy : persistenceProxy
						},
						constructor : {
							hashtable : Hashtable
						}
					};
					textPool = new sap.apf.modeler.core.TextPool(injectTextPool, applicationId, existingTexts);
					textPool.addTextsAndSave(textFileInformation.TextElements, callbackImport);
				}

			}
			function callbackApplicationHandler(applicationHandler, msgObject) {
				if (msgObject) {
					callbackImport(msgObject);
					return;
				}
				var messageObject;
				var application = applicationHandler.getApplication(applicationId);
				if (!application) {
					messageObject = messageHandler.createMessageObject({
						code : 11021
					});
					callbackImport(messageObject);
					return;

				}

				if (lazyLoaderForConfigurationHandler.getId() === applicationId) {					
					lazyLoaderForConfigurationHandler.getInstance().getTextPool().addTextsAndSave(textFileInformation.TextElements, callbackImport);
				} else {
					var filterApplication = new sap.apf.core.utils.Filter(messageHandler, 'Application', 'eq', applicationId);
					var filterLanguage = new sap.apf.core.utils.Filter(messageHandler, 'Language', 'eq', sap.apf.core.constants.developmentLanguage);
					filterLanguage.addAnd(filterApplication);
					persistenceProxy.readCollection("texts", loadTexts, undefined, undefined, filterLanguage, true);
				}	
			}

			textFileInformation = sap.apf.modeler.core.parseTextPropertyFile(textFileString, {
				instance : {
					messageHandler : messageHandler
				}
			});
			if (textFileInformation.Messages.length > 0) {

				messageObject = messageHandler.createMessageObject({
					code : 11020
				});
				len = textFileInformation.Messages.length;
				for(i = 0; i < len - 1; i++) {
					textFileInformation.Messages[i + 1].setPrevious(textFileInformation.Messages[i]);

				}
				messageObject.setPrevious(textFileInformation.Messages[len - 1]);
				callbackImport(messageObject);
			} else {
				applicationId = textFileInformation.Application;
				this.getApplicationHandler(callbackApplicationHandler);
			}
		};
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#importConfiguration
         * @description Receives a string containing analytical configuration and assigned modeler administration data. Contents are saved implicitly. 
         * @param {string} configuration JSON format defined by exportConfiguration method 
         * @param {function(<tbd after alignment, which collision information should be provided>)} callbackConfirmOverwrite Called if configuration contains an already existing configurationID 
         * @param {function(configuration, metadata, messageObject)} callbackImport Called after configuration is saved. Returns configurationID in success case
         */
		this.importConfiguration = function(configuration, callbackConfirmOverwrite, callbackImport) {
            var configObject = JSON.parse(configuration);
            var configHeader = configObject.configHeader;
            var applicationId;
            
            if(!guidsAreValid(configObject, callbackImport)){
            	return;
            }
            
            this.getApplicationHandler(callbackApplicationHandler);

            function guidsAreValid(configObject, callbackImport){
            	var messageObjects = [],
            	    guidsAreValid = true,
            	    textKeys;
            	if(!sap.apf.utils.isValidGuid(configObject.configHeader.Application)){
            		messageObjects.push( messageHandler.createMessageObject({
					        				code : 11037,
					        				aParameters : [ configObject.configHeader.Application ]
					        			}));
            		guidsAreValid = false;
            	}
            	if(!sap.apf.utils.isValidGuid(configObject.configHeader.AnalyticalConfiguration)){
            		messageObjects.push( messageHandler.createMessageObject({
					        				code : 11038,
					        				aParameters : [ configObject.configHeader.AnalyticalConfiguration ]
					        			}));
            		guidsAreValid = false;
            	}
            	textKeys = sap.apf.modeler.core.ConfigurationObjects.getTextKeysFromConfiguration(configObject);
            	textKeys.forEach(function(textKey){
            		var hashTab = new Hashtable(messageHandler);
            		if(!hashTab.hasItem(textKey)){
            			hashTab.setItem(textKey, textKey);
            			if(!sap.apf.utils.isValidGuid(textKey)){
                    		messageObjects.push( messageHandler.createMessageObject({
        					        				code : 11039,
        					        				aParameters : [ textKey ]
        					        			}));
                    		guidsAreValid = false;
                    	}
            		}
            	});
            	if(guidsAreValid){
                	return guidsAreValid;	
            	}
            	messageObjects.forEach(function(messageObject, itemNumber, messageObjects){
            		if(itemNumber){
            			messageObject.setPrevious(messageObjects[itemNumber - 1]);
            		}
            	});
            	callbackImport(configuration, undefined, messageObjects[messageObjects.length - 1]);
            	return guidsAreValid;
            }
                        
            function callbackApplicationHandler(applicationHandler, messageObject){
            	
            	if (messageObject) {
            		callbackImport(undefined, undefined, messageObject);
            		return;
            	}
                var appExists = false;
                var appList = applicationHandler.getList();
                applicationId = configHeader.Application;
                appList.forEach(function(app){
                   if(app.Application === configHeader.Application){
                       appExists = true;
                   }
                });

                if(appExists){
                    that.getConfigurationHandler(configHeader.Application, callbackConfigurationHandler);
                }else{
                    var appObject = {
                        ApplicationName : configHeader.ApplicationName,
                        SemanticObject : configHeader.SemanticObject
                    };
                    applicationHandler.setAndSave(appObject, callbackSetAndSave, configHeader.Application, true);
                }
            }
            function callbackSetAndSave(ApplicationId, metadata, messageObject){
            	
            	if (messageObject) {
            		callbackImport(undefined, undefined, messageObject);
            		return;
            	}
                that.getConfigurationHandler(configHeader.Application, callbackConfigurationHandler);
            }
            function callbackConfigurationHandler(configurationHandler, messageObject){
            	
            	if (messageObject) {
            		callbackImport(undefined, undefined, messageObject);
            		return;
            	}
                var analyticalContent = jQuery.extend({}, configObject, true);
                delete analyticalContent.configHeader;
                var configExists = false;
                var configList = configurationHandler.getList();
                configList.forEach(function(config){
                    if(config.AnalyticalConfiguration === configHeader.AnalyticalConfiguration){
                        configExists = true;
                    }
                });
                if(configExists){
                    callbackConfirmOverwrite(callbackOverwrite, callbackCreateNew);
                }else{
                    configurationHandler.setConfiguration({AnalyticalConfigurationName: configHeader.AnalyticalConfigurationName}, configHeader.AnalyticalConfiguration);
                    var configurationToLoad = {
                        id: configHeader.AnalyticalConfiguration,
                        creationDate: configHeader.CreationUTCDateTime,
                        lastChangeDate: configHeader.LastChangeUTCDateTime,
                        content: analyticalContent
                    };
                    configurationHandler.loadConfiguration(configurationToLoad, callbackLoadConfiguration);
                }
                function callbackOverwrite(){
                    configurationHandler.setConfiguration({AnalyticalConfigurationName: configHeader.AnalyticalConfigurationName}, configHeader.AnalyticalConfiguration);
                    var configurationToLoad = {
                        updateExisting : true,
                        id: configHeader.AnalyticalConfiguration,
                        creationDate: configHeader.CreationUTCDateTime,
                        lastChangeDate: configHeader.LastChangeUTCDateTime,
                        content: analyticalContent
                    };
                    configurationHandler.loadConfiguration(configurationToLoad, callbackLoadConfiguration);
                }
                function callbackCreateNew(){
                    var tempId = configurationHandler.setConfiguration({AnalyticalConfigurationName: configHeader.AnalyticalConfigurationName});
                    var configuration = {
                    		id: tempId, 
                        content: analyticalContent
                    };
                    configurationHandler.loadConfiguration(configuration, callbackLoadConfiguration);
                }
            }
            function callbackLoadConfiguration(configEditor, messageObject) {
            	if (messageObject) {
            		callbackImport(undefined, undefined, messageObject);
            		return;
            	}
                configEditor.save(callbackImport);
            }
           
		};
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#getApplicationHandler
         * @description Application Handler which manages the applications of the APF Configuration Modeler
         * @param {function(sap.apf.modeler.core.ApplicationHandler, sap.apf.core.MessageObject)} initCallback Function is called after ApplicationHandler is initialized 
         */
		this.getApplicationHandler = function(initCallback) {
			lazyLoaderForApplicationHandler.asyncGetInstance("ApplicationHandlerId", function(instance, messageObject) {
				initCallback(instance, messageObject);
				
			});
		};
	
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#getConfigurationHandler
         * @description Configuration Handler which manages the configurations of the APF Configuration Modeler
         * @param {string} applicationId
         * @param {function(sap.apf.modeler.core.ConfigurationHandler, sap.apf.core.MessageObject)} callback Function is called after ConfigurationHandler is initialized
         */
		this.getConfigurationHandler = function(applicationId, callback) {
            lazyLoaderForConfigurationHandler.asyncGetInstance(applicationId, function(instance, messageObject) {
            	callback(instance, messageObject);
            });
		};
		
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#getUnusedTextKeys
         * @description Return all unused text keys from the text pool for a certain application 
         * 				application handler needs to be initialized
         * 				only text key usages form the saved configuration data for the application is considered
         * 				unsaved usages are not considered as usages
         * @param {string} applicationId
         * @param {function({Array}, {sap.apf.core.MessageObject})} callback function is called after text keys have been identified
         */
		this.getUnusedTextKeys = function(applicationId, callbackAfterGetUnused) {
			var injectForConfObj = { instance :    {messageHandler   : messageHandler,
			    	                             	persistenceProxy : persistenceProxy},
			    	                 constructor : {hashtable        : Hashtable} };
			var configurationObject = new ConfigurationObjects(injectForConfObj);
					
			var usedTextKeys         = null,
		        messageObject        = null,
		        configurationHandler = null;
			
			// first asynchronous operation: getTextKeysFromAllConfigurations 
			configurationObject.getTextKeysFromAllConfigurations(applicationId, function(textKeys, messageObj){
				 if(messageObject){
					 return;
				 }
				 usedTextKeys  = textKeys;
				 messageObject = messageObj;
				 if(messageObj || configurationHandler){
					 finalizeProcessing(); 
				 }
			 });
			 
			// second asynchronous operation: getConfigurationHandler
			 this.getConfigurationHandler(applicationId, function(confHandler, messageObj){
				 if(messageObject){
					 return;
				 }
				 configurationHandler = confHandler;
				 messageObject        = messageObj;
				 if(messageObj || usedTextKeys){
					 finalizeProcessing(); 
				 }
			 });
			 
			// finalize after both asynchronous operations finished or after first error occurred
			function finalizeProcessing(){
				var unusedTextKeys = [];
			  	if(messageObject){
			   		callbackAfterGetUnused(undefined, messageObject);
			   		return;
			   	}
			  	configurationHandler.getTextPool().getTextKeys().forEach(function(textKey){
			  		if(!usedTextKeys.hasItem(textKey)){
			  			unusedTextKeys.push(textKey);
			  		}
			  	});
			  	callbackAfterGetUnused(unusedTextKeys, undefined);
			 }
				 
		};
		
		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#resetConfigurationHandler
         * @description Reset the configuration handler instance 
         */
		this.resetConfigurationHandler = function( ) {
			lazyLoaderForConfigurationHandler.reset();
		};

		/**
         * @private
         * @function
         * @name sap.apf.modeler.core.instance#getRepresentationTypes
         * @description Return the available representation types 
         */
		 this.getRepresentationTypes = function() {
	        	var origRepresentationTypes = sap.apf.core.representationTypes();
	        	var represenationTypes = [];
	        	jQuery.extend(true, represenationTypes, origRepresentationTypes );
	        	return represenationTypes;  	
	     };
	      
	     /**
	         * @private
	         * @function
	         * @name sap.apf.modeler.core.instance#getAllAvailableSemanticObjects
	         * @description Returns all available semantic objects with id and text by callback function
	         * @param {function(semanticObjects, sap.apf.core.MessageObject)} fnCallback The first argument of the callback function is filled 
	         * with tuples with property id and text of the semantic objects. The second argument is filled in case of errors with 
	         * a messageObject of type sap.apf.core.MessageObject. 
	         */
	     this.getAllAvailableSemanticObjects = function(fnCallback) {
	    	 function returnSemanticObjects(oData, results) { 
	    		 allAvailableSemanticObjects = oData.results;
	    		 fnCallback(oData.results, undefined);
	    	 }
	    	 function returnErrors (oError) { 
	    		 var messageObject;
	    		 if (oError.messageObject) {
	    			 messageObject = oError.messageObject;
	    		 } else {
	    			messageObject = messageHandler.createMessageObject({ code : "11041"});
	    		 }
	    		 fnCallback([], messageObject);
	    	 }
	    	 
	    	 if (allAvailableSemanticObjects) {	    		
	    		 fnCallback(allAvailableSemanticObjects, undefined);
	    		 return;
	    	 }
	    	 var request = {
	    			 requestUri : "/sap/opu/odata/UI2/INTEROP/SemanticObjects?$format=json&$select=id,text",
	    			 method : "GET",
	    			 headers : { "x-csrf-token" : sessionHandler.getXsrfToken("/sap/opu/odata/UI2/INTEROP/SemanticObjects")}
	    	 };
	    	 that.odataRequest(request, returnSemanticObjects, returnErrors);
	     };
	     
	     /**
	         * @private
	         * @function
	         * @name sap.apf.modeler.core.instance#getSemanticActions
	         * @description Returns all available semantic actions for given object with id and text by callback function
	         * @param {string} semanticObject Technical name of a semantic object
	         * @returns promise The argument of the done function is filled 
	         * with array semanticActions (tuples with property id and text of the semantic actions) and semanticObject with id and text. 
	         * Example: { semanticActions : [  { id: "action1", text : "someDescription" }, ...], semanticObject : { id : "someId, text: "objectDescription" }}
	         * The callback function of fail receives as argument the message object!
	         */
	     this.getSemanticActions = function(semanticObject) {
    		 
    		 var cachedSemanticActions;
    		 var deferred = jQuery.Deferred();
    		 
    		 if (!actionsPerSemanticObjectHashTable) {
    			 actionsPerSemanticObjectHashTable = new Hashtable(messageHandler);
    		 }
    		 cachedSemanticActions = actionsPerSemanticObjectHashTable.getItem(semanticObject);
    		 if (cachedSemanticActions) {
    			 
    			 deferred.resolve(cachedSemanticActions);
    			 return deferred.promise();
    		 }
    		 
    		 that.getAllAvailableSemanticObjects(returnActionsWithObject);
    		 
    		 return deferred.promise();
    		 
    		 function returnActionsWithObject(semanticObjects, messageObject) {
    			 
    			 if (messageObject) {
    				 fnCallback(undefined, messageObject);
    				 return;
    			 }
    			 
    			 var navigationService = sap.ushell && sap.ushell.Container && sap.ushell.Container.getService("CrossApplicationNavigation");
        		 var semanticObjectProperties;
        		 var i;
        		 
        		 if (!navigationService) {
        			 fnCallback( undefined, messageHandler.createMessageObject({ code : "5038"}));
        			 return;
        		 }
        		 
        		 for (i = 0; i < semanticObjects.length; i++) {
        			if (semanticObjects[i].id === semanticObject) {
        				semanticObjectProperties = semanticObjects[i];
        				break;
        			}
        		 }
        		 navigationService.getSemanticObjectLinks(semanticObject, undefined, true, inject.instances.component, undefined)
     		 	.done(	function(aIntents) { 
     		 				var semanticActions = [];
     		 			
     		 				aIntents.forEach(function(intentDefinition){
     		 					var actionWithParameters = intentDefinition.intent.split("-");
     		 					var action = actionWithParameters[1].split("?");
     		 					var action = action[0].split("~");
     		 					semanticActions.push({ id : action[0], text  : intentDefinition.text });
     		 				});
     		 				actionsPerSemanticObjectHashTable.setItem(semanticObject, {semanticObject : semanticObjectProperties, semanticActions : semanticActions });
     		 				deferred.resolve({semanticObject : semanticObjectProperties, semanticActions : semanticActions });
     		 	}).fail(function() { 
     		 		deferred.rejectWith(  messageHandler.createMessageObject({ code : "11042"}));
     		 	});
    		 }
    		 
	     };
// -----------------------------------------------------------------------------------------------------		
	    if (inject && inject.probe) {
            //noinspection JSHint,JSLint
            new inject.probe({
                constructor: {
                    applicationHandler: ApplicationHandler,
                    configurationHandler: ConfigurationHandler,
                    configurationEditor: ConfigurationEditor,
                    configurationObjects: ConfigurationObjects,
                    configurationFactory: ConfigurationFactory,
					metadataFactory: MetadataFactory,
					metadata: Metadata,
					entityTypeMetadata : EntityTypeMetadata,
					metadataFacade: MetadataFacade,
					metadataProperty: MetadataProperty,
                    step: Step,
                    facetFilter: FacetFilter,
                    navigationTarget: NavigationTarget,
                    representation: Representation,
                    elementContainer: ElementContainer,
                    hashtable: Hashtable,
                    lazyLoader: LazyLoader,
                    registryProbe: RegistryProbe
                },
                textHandler: textHandler,
                messageHandler: messageHandler,
                sessionHandler: sessionHandler,
                persistenceProxy : persistenceProxy,
                applicationHandler: lazyLoaderForApplicationHandler.getInstance(), 
                configurationHandler: lazyLoaderForConfigurationHandler.getInstance(),
                metadataFactory : metadataFactory,
                injectForFollowUp: injectForFollowUp,
                injectMetadataFactory: injectMetadataFactory,
                fnOdataRequestWrapper: fnOdataRequestWrapper,
                ajax : fnAjax,
                odataRequestWrapper: fnOdataRequestWrapper
			});
		}
		
	};

}());

}; // end of sap/apf/modeler/core/instance.js
if ( !jQuery.sap.isDeclared('sap.apf.core.instance') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap, OData */

jQuery.sap.declare("sap.apf.core.instance");




















/**
 * @class Core Component Instance
 * @name sap.apf.core.Instance
 * @description Creation of new Core Component Instance
 */
sap.apf.core.Instance = function (oApiInject) {
    'use strict';
    var that = this;
    var oMessageHandler = oApiInject.messageHandler;
    var oStartParameter = oApiInject.startParameter;
    var oRememberedPath;
    var oInject = {
        messageHandler: oMessageHandler,
        coreApi: that

    };
    var oResourcePathHandler;
    var oMetadataFactory;
    var oTextResourceHandler;
    var oConfigurationFactory;
    var oPath;
    var oSessionHandler;
    var oPersistence;
    /**
     * @see sap.apf.core.ajax
     */
    this.ajax = function (oSettings) {
        return sap.apf.core.ajax(oSettings);
    };

    /**
     * @see sap.apf.core.odataRequestWrapper
     */
    this.odataRequest = function (oRequest, fnSuccess, fnError, oBatchHandler) {
        sap.apf.core.odataRequestWrapper(oMessageHandler, oRequest, fnSuccess, fnError, oBatchHandler);
    };

    /**
     * @see sap.apf.utils.startParameter
     */
    this.getStartParameterFacade = function () {
        return oStartParameter;
    };

    this.getMessageHandler = function () {
        return oMessageHandler;
    };
    /**
     * @see sap.apf#putMessage for api definition.
     * @see sap.apf.core.MessageHandler#putMessage for implementation.
     */
    this.putMessage = function (oMessage) {
        return oMessageHandler.putMessage(oMessage);
    };
    /**
     * @see sap.apf.core.MessageHandler#check
     */
    this.check = function (bExpression, sMessage, sCode) {
        return oMessageHandler.check(bExpression, sMessage, sCode);
    };

    /**
     * @see sap.apf#createMessageObject for api definition.
     * @see sap.apf.core.MessageHandler#createMessageObject
     */
    this.createMessageObject = function (oConfig) {
        return oMessageHandler.createMessageObject(oConfig);
    };

    /**
     * @see sap.apf.core.MessageHandler#activateOnErrorHandling
     */
    this.activateOnErrorHandling = function (bOnOff) {
        oMessageHandler.activateOnErrorHandling(bOnOff);
    };

    /**
     * @see sap.apf.core.MessageHandler#setMessageCallback
     */
    this.setCallbackForMessageHandling = function (fnCallback) {
        oMessageHandler.setMessageCallback(fnCallback);
    };

    /**
     * @see sap.apf.core.MessageHandler#setApplicationMessageCallback
     */
    this.setApplicationCallbackForMessageHandling = function (fnCallback) {
        oMessageHandler.setApplicationMessageCallback(fnCallback);
    };

    /**
     * @see sap.apf.core.MessageHandler#getLogMessages
     */
    this.getLogMessages = function () {
        return oMessageHandler.getLogMessages();
    };

    /**
     * @see sap.apf.core.checkForTimeout
     */
    this.checkForTimeout = function (oServerResponse) {
        var oMessageObject = sap.apf.core.utils.checkForTimeout(oServerResponse);
        // up to now, the error handling was hard coded in checkForTimeout
        if (oMessageObject) {
            oMessageHandler.putMessage(oMessageObject);
        }
        return oMessageObject;
    };
    /**
     * @description Returns the instance of the UriGenerator. For internal core using only.
     */
    this.getUriGenerator = function () {
        return sap.apf.core.utils.uriGenerator;
    };

    /**
     * @see sap.apf.core.MetadataFactory#getMetadata
     */
    this.getMetadata = function (sAbsolutePathToServiceDocument) {
        return oMetadataFactory.getMetadata(sAbsolutePathToServiceDocument);
    };

    /**
     * @see sap.apf.core.MetadataFactory#getMetadataFacade
     */
    this.getMetadataFacade = function () {
        return oMetadataFactory.getMetadataFacade();
    };

    /**
     * @see sap.apf.core.MetadataFactory#getEntityTypeMetadata
     */
    this.getEntityTypeMetadata = function (sAbsolutePathToServiceDocument, sEntityType) {
        return oMetadataFactory.getEntityTypeMetadata(sAbsolutePathToServiceDocument, sEntityType);
    };

    /**
     * @see sap.apf.core.ResourcePathHandler#loadConfigFromFilePath
     */
    this.loadApplicationConfig = function (sFilePath) {
        oResourcePathHandler.loadConfigFromFilePath(sFilePath);
    };

    /**
     * @see sap.apf.core.TextResourceHandler#loadTextElements
     */
    this.loadTextElements = function (textElements) {
        oTextResourceHandler.loadTextElements(textElements);
    };
    /**
     * @see sap.apf.core.ResourcePathHandler#getConfigurationProperties
     */
    this.getApplicationConfigProperties = function () {
        return oResourcePathHandler.getConfigurationProperties();
    };

    /**
     * @see sap.apf.core.ResourcePathHandler#getResourceLocation
     */
    this.getResourceLocation = function (sResourceIdentifier) {
        return oResourcePathHandler.getResourceLocation(sResourceIdentifier);
    };

    /**
     * @see sap.apf.core.ResourcePathHandler#getPersistenceConfiguration
     */
    this.getPersistenceConfiguration = function () {
        return oResourcePathHandler.getPersistenceConfiguration();
    };
    /**
     * @see sap.apf.core.ResourcePathHandler#getApplicationConfigurationURL
     */
    this.getApplicationConfigurationURL = function () {
        return oResourcePathHandler.getApplicationConfigurationURL();
    };

    // ConfigurationFactory API

    /**
     * @see sap.apf.core.ConfigurationFactory#getCategories
     */
    this.getCategories = function () {
        return oConfigurationFactory.getCategories();
    };
    /**
     * @see sap.apf.core.ConfigurationFactory#existsConfiguration
     */
    this.existsConfiguration = function (sId) {
        return oConfigurationFactory.existsConfiguration(sId);
    };
    /**
     * @see sap.apf.core.ConfigurationFactory#getStepTemplates
     */
    this.getStepTemplates = function () {
        return oConfigurationFactory.getStepTemplates();
    };
    /**
     * @see sap.apf.core.ConfigurationFactory#getFacetFilterConfigurations
     */
    this.getFacetFilterConfigurations = function () {
        return oConfigurationFactory.getFacetFilterConfigurations();
    };

    /**
     * @see sap.apf.core.ConfigurationFactory#getNavigationTargets
     */
    this.getNavigationTargets = function () {
        return oConfigurationFactory.getNavigationTargets();
    };

    /**
     * @description Creates a step object from the configuration object and adds it to the path.
     * @param {string} sStepId Step id as defined in the analytical configuration.
     * @param {function} fnStepProcessedCallback Callback function for path update.
     * @param {string} [sRepresentationId] Parameter, that allows definition of the representation id that shall initially be selected. If omitted the first configured representation will be selected.
     * @returns {sap.apf.core.Step} oStep Created step.
     */
    this.createStep = function (sStepId, fnStepProcessedCallback, sRepresentationId) {
        var oStepInstance;

        function setRepresentationById() {
            var aRepresentationInfo;
            var matchedRepresentationId;
            if (oStepInstance && sRepresentationId) {
                aRepresentationInfo = oStepInstance.getRepresentationInfo();
                aRepresentationInfo.forEach(function (representationInfo) {
                    if (representationInfo.representationId === sRepresentationId) {
                        matchedRepresentationId = sRepresentationId;
                    }
                });
                if (matchedRepresentationId) {
                    oStepInstance.setSelectedRepresentation(matchedRepresentationId);
                } else {
                    oMessageHandler.putMessage(oMessageHandler.createMessageObject({
                        code: '5037',
                        aParameters: [sRepresentationId]
                    }));
                }
            }
        }

        oMessageHandler.check(sStepId !== undefined && typeof sStepId === "string" && sStepId.length !== 0, "sStepID is  unknown or undefined");
        oStepInstance = oConfigurationFactory.createStep(sStepId);

        setRepresentationById();

        oPath.addStep(oStepInstance, fnStepProcessedCallback);
        return oStepInstance;
    };

    // Path API
    /**
     * @see sap.apf.core.Path#getSteps
     */
    this.getSteps = function () {
        return oPath.getSteps();
    };

    /**
     * @see sap.apf.core.Path#moveStepToPosition
     */
    this.moveStepToPosition = function (oStep, nPosition, fnStepProcessedCallback) {
        oPath.moveStepToPosition(oStep, nPosition, fnStepProcessedCallback);
    };

    /**
     * @function
     * @name sap.apf.core.Instance#updatePath
     * @see sap.apf.core.Path#update
     */
    this.updatePath = function (fnStepProcessedCallback, bContextChanged) {
        oPath.update(fnStepProcessedCallback, bContextChanged);
    };

    /**
     * @see sap.apf.core.Path#removeStep
     */
    this.removeStep = function (oStep, fnStepProcessedCallback) {
        oPath.removeStep(oStep, fnStepProcessedCallback);
    };

    /**
     * @description Creates a new Path instance
     * @param {boolean} [bRememberActualPath] if true, then the path can be restored
     *
     */
    this.resetPath = function (bRememberActualPath) {
        if (bRememberActualPath) {
            oRememberedPath = jQuery.extend(true, {}, oPath);
        }
        oPath = new sap.apf.core.Path(oInject);
    };
    /**
     * if resetPath has been called with bRememberActualPath, then the old path
     * can be restored
     */
    this.restoreOriginalPath = function () {
        if (oRememberedPath) {
            oPath = oRememberedPath;
        }
    };
    /**
     * @see sap.apf.core.Path#stepIsActive
     */
    this.stepIsActive = function (oStep) {
        return oPath.stepIsActive(oStep);
    };

    /**
     * @see sap.apf.core.Path#serializePath
     */
    this.serializePath = function () {
        return oPath.serialize();
    };

    /**
     * @see sap.apf.core.Path#deserializePath
     */
    this.deserializePath = function (oSerializedAnalysisPath) {
        oPath.deserialize(oSerializedAnalysisPath);
    };
    // Text Resource Handler API
    /**
     * @see sap.apf#getTextNotHtmlEncoded
     * @see sap.apf.core.TextResourceHandler#getTextNotHtmlEncoded
     */
    this.getTextNotHtmlEncoded = function (oLabel, aParameters) {
        return oTextResourceHandler.getTextNotHtmlEncoded(oLabel, aParameters);
    };

    /**
     * @see sap.apf#getTextHtmlEncoded
     * @see sap.apf.core.TextResourceHandler#getTextHtmlEncoded
     */
    this.getTextHtmlEncoded = function (oLabel, aParameters) {
        return oTextResourceHandler.getTextHtmlEncoded(oLabel, aParameters);
    };

    /**
     * returns true, if this is the text key for the initial text. Initial text means empty string.
     */
    this.isInitialTextKey = function (textKey) {
        return (textKey === sap.apf.core.constants.textKeyForInitialText);
    };
    /**
     * @see sap.apf.core.TextResourceHandler#getMessageText
     */
    this.getMessageText = function (sCode, aParameters) {
        return oTextResourceHandler.getMessageText(sCode, aParameters);
    };

    /**
     * @see sap.apf.core.SessionHandler#getXsrfToken
     */
    this.getXsrfToken = function (sServiceRootPath) {
        return oSessionHandler.getXsrfToken(sServiceRootPath);
    };
    /**
     * @see sap.apf.core.SessionHandler#setContext
     */
    this.setContext = function (oContextFilter) {
        oSessionHandler.setContext(oContextFilter);
    };

    /**
     * @see sap.apf.core.SessionHandler#getContext
     */
    this.getContext = function () {
        return oSessionHandler.getContext();
    };
    /**
     * @see sap.apf.core.SessionHandler#getLogicalSystem
     */
    this.getLogicalSystem = function () {
        return oSessionHandler.getLogicalSystem();
    };

    /**
     * @see sap.apf#createReadRequest
     * @description Creates an object for performing an Odata Request get operation.
     * @param {String|Object} sRequestConfigurationId - identifies a request configuration, which is contained in the analytical configuration.
     *                        or the request configuration is directly passed as an object oRequestConfiguration.
     * @returns {sap.apf.core.ReadRequest}
     */
    this.createReadRequest = function (/* sRequestConfigurationId | oRequestConfiguration */ requestConfiguration) {
        var oRequest = oConfigurationFactory.createRequest(requestConfiguration);
        var oRequestConfiguration;
        if (typeof requestConfiguration === 'string') {
            oRequestConfiguration = oConfigurationFactory.getConfigurationById(requestConfiguration);
        }
        else {
            oRequestConfiguration = requestConfiguration;
        }
        return new sap.apf.core.ReadRequest(oInject, oRequest, oRequestConfiguration.service, oRequestConfiguration.entityType);
    };
    /**
     * @see sap.apf#createReadRequestByRequiredFilter
     * @description Creates an object for performing an Odata Request get operation with required filter for parameter entity set key properties & required filters.
     * @param {String|Object} sRequestConfigurationId - identifies a request configuration, which is contained in the analytical configuration.
     *                        or the request configuration is directly passed as an object oRequestConfiguration.
     * @returns {sap.apf.core.ReadRequestByRequiredFilter}
     */
    this.createReadRequestByRequiredFilter = function (/* sRequestConfigurationId | oRequestConfiguration */ requestConfiguration) {
        var oRequest = oConfigurationFactory.createRequest(requestConfiguration);
        var oRequestConfiguration;
        if (typeof requestConfiguration === 'string') {
            oRequestConfiguration = oConfigurationFactory.getConfigurationById(requestConfiguration);
        }
        else {
            oRequestConfiguration = requestConfiguration;
        }
        return new sap.apf.core.ReadRequestByRequiredFilter(oInject, oRequest, oRequestConfiguration.service, oRequestConfiguration.entityType);
    };
    /**
     * @description Message configurations are loaded.
     * @see sap.apf.core.MessageHandler#loadConfig
     */
    this.loadMessageConfiguration = function (aMessages, bResetRegistry) {
        oMessageHandler.loadConfig(aMessages, bResetRegistry);
    };
    /**
     * @see sap.apf.core.ConfigurationFactory#loadConfig
     */
    this.loadAnalyticalConfiguration = function (oConfig) {
        oConfigurationFactory.loadConfig(oConfig);
    };
    /**
     * @see sap.apf.core#savePath for api definition.
     * @see sap.apf.core.Persistence#createPath
     */
    this.savePath = function (arg1, arg2, arg3, arg4) {
        var sPathId;
        var sName;
        var fnCallback;
        var oExternalObject;
        if (typeof arg1 === 'string' && typeof arg2 === 'string' && typeof arg3 === 'function') {
            sPathId = arg1;
            sName = arg2;
            fnCallback = arg3;
            oExternalObject = arg4;
            oPersistence.modifyPath(sPathId, sName, fnCallback, oExternalObject);
        } else if (typeof arg1 === 'string' && typeof arg2 === 'function') {
            sName = arg1;
            fnCallback = arg2;
            oExternalObject = arg3;
            oPersistence.createPath(sName, fnCallback, oExternalObject);
        } else {
            oMessageHandler.putMessage(sap.apf.core.createMessageObject({
                code: "5027",
                aParameters: [arg1, arg2, arg3]
            }));
        }
    };
    /**
     * @see sap.apf.core.Persistence#readPaths
     */
    this.readPaths = function (fnCallback) {
        oPersistence.readPaths(fnCallback);
    };
    /**
     * @see sap.apf.core.Persistence#openPath
     */
    this.openPath = function (sPathId, fnCallback, nActiveStep) {
        return oPersistence.openPath(sPathId, fnCallback, nActiveStep);
    };
    /**
     * @see sap.apf.core.Persistence#deletePath
     */
    this.deletePath = function (sPathId, fnCallback) {
        oPersistence.deletePath(sPathId, fnCallback);
    };

    /**
     * @see sap.apf#createFilter for api definition
     * @see sap.apf.utils.Filter
     */
    this.createFilter = function (oSelectionVariant) {
        return new sap.apf.utils.Filter(oMessageHandler, oSelectionVariant);
    };
    /**
     * @public
     * @function
     * @name sap.apf.core#getActiveStep
     * @description Returns active step, currently selected step, of analysis path.
     * @returns {sap.apf.core.Step}
     */
    this.getActiveStep = function () {
        return oPath.getActiveSteps()[0];
    };

    /**
     * @public
     * @function
     * @name sap.apf.core#getCumulativeFilterUpToActiveStep
     * @description Returns the cumulative filter up to the active step (included) and the context
     * @returns {sap.apf.core.utils.Filter} cumulativeFilter
     */
    this.getCumulativeFilterUpToActiveStep = function () {
        return oPath.getCumulativeFilterUpToActiveStep();
    };
    /**
     * @public
     * @function
     * @name sap.apf.core#setActiveStep
     * @description Sets handed over step as the active one.
     * @param {sap.apf.core.Step} oStep The step to be set as active
     * @returns undefined
     */
    this.setActiveStep = function (oStep) {
        oPath.makeStepActive(oStep);
        var aActiveSteps = oPath.getActiveSteps();
        var i;
        for (i = 0; i < aActiveSteps.length; ++i) {
            oPath.makeStepInactive(aActiveSteps[i]);
        }
        return oPath.makeStepActive(oStep);
    };
    
    /**
     * @public
     * @function
     * @name sap.apf.core.Instance#createFirstStep
     * @description Method to be used APF internally by the binding class to create instances from representation constructors.
     */
    this.createFirstStep = function (sStepId, sRepId, callback) {
        var isValidStepId = false;
        var stepTemplates;
        
        stepTemplates = that.getStepTemplates();
        
        stepTemplates.forEach(function(item){
            isValidStepId = item.id === sStepId ? true : isValidStepId;
        });
        
        if (!isValidStepId) {
			oMessageHandler.putMessage(oMessageHandler.createMessageObject({
        		code : '5036',
        		aParameters : [sStepId]
			}));
        } else {
        	that.createStep(sStepId, callback, sRepId);
        }
    };

    // create local singleton instances...
    oResourcePathHandler = new sap.apf.core.ResourcePathHandler(oInject);
    oTextResourceHandler = new sap.apf.core.TextResourceHandler(oInject);
    oMessageHandler.setTextResourceHandler(oTextResourceHandler);

    oConfigurationFactory = new sap.apf.core.ConfigurationFactory(oInject);

    var oInjectMetadataFactory = {
        entityTypeMetadata: sap.apf.core.EntityTypeMetadata,
        hashtable: sap.apf.utils.Hashtable,
        metadata: sap.apf.core.Metadata,
        metadataFacade: sap.apf.core.MetadataFacade,
        metadataProperty: sap.apf.core.MetadataProperty,
        messageHandler: oInject.messageHandler,
        coreApi: that,
        datajs: OData,
        configurationFactory: oConfigurationFactory
    };
    oMetadataFactory = new sap.apf.core.MetadataFactory(oInjectMetadataFactory);

    oPath = new sap.apf.core.Path(oInject);
    oSessionHandler = new sap.apf.core.SessionHandler(oInject);
    oPersistence = new sap.apf.core.Persistence(oInject);
};

}; // end of sap/apf/core/instance.js
if ( !jQuery.sap.isDeclared('sap.apf.modeler.Component') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP SE. All rights reserved
 */
/*global jQuery, sap */
(function() {
	'use strict';
	jQuery.sap.declare("sap.apf.modeler.Component");
	jQuery.sap.require('sap.ui.core.UIComponent'); // unlisted dependency retained

	
	jQuery.sap.require('sap.m.routing.RouteMatchedHandler'); // unlisted dependency retained

	
	
	
	/**
	 * @private
	 * @class Base Component for APF Modeler.
	 * @name sap.apf.modeler.Component
	 * @extends sap.ui.core.UIComponent
	 */
	sap.ui.core.UIComponent.extend("sap.apf.modeler.Component", {
		oCoreApi : null,
		metadata : {
			"dependencies" : {
				"libs" : [ "sap.m", "sap.ui.layout"]
			},
			"config" : {
				"fullWidth" : true
			},
			routing : {
				"config" : {
					viewType : "XML",
					viewPath : "sap.apf.modeler.ui.view",
					clearTarget : false
				},
				"routes" : {
					// contains routing configuration objects
					"applicationList" : {
						pattern : "",
						view : "applicationList",
						targetAggregation : "pages",
						targetControl : "applicationList",
						"subroutes" : [ {
							pattern : "app/{appId}",
							view : "configurationList",
							name : "configurationList",
							targetAggregation : "pages"
						}, {
							pattern : "app/{appId}/config/{configId}",
							view : "configurationList",
							name : "configuration",
							targetAggregation : "pages"
						}, {
							pattern : "app/{appId}/config/{configId}/category/{categoryId}",
							view : "configurationList",
							name : "category",
							targetAggregation : "pages"
						}, {
							pattern : "app/{appId}/config/{configId}/facetFilter/{facetFilterId}",
							view : "configurationList",
							name : "facetFilter",
							targetAggregation : "pages"
						}, {
							pattern : "app/{appId}/config/{configId}/category/{categoryId}/step/{stepId}",
							view : "configurationList",
							name : "step",
							targetAggregation : "pages"
						}, {
							pattern : "app/{appId}/config/{configId}/category/{categoryId}/step/{stepId}/repn/{representationId}",
							view : "configurationList",
							name : "representation",
							targetAggregation : "pages"
						} , {
							pattern : "app/{appId}/config/{configId}/navigationTarget/{navTargetId}",
							view : "configurationList",
							name : "navigationTarget",
							targetAggregation : "pages"
						}]
					}
				}
			}
		},
		/**
		 * @private
		 * @description Initialize the Component instance after creation. The component, that extends this component should call this method.
		 * @function
		 * @name sap.apf.modeler.Component.prototype.init
		 */
		init : function() {
			var persistenceConfiguration = {
				/*This serviceRoot is used only for the modeler, the runtime has a different root
				 reason: user roles with different authorizations, change configuration or read only*/
				serviceRoot : "/sap/hba/r/apf/core/odata/modeler/AnalyticalConfiguration.xsodata"
			};
			var inject = {
					instances : { component : this }
			};
			this.oCoreApi = new sap.apf.modeler.core.Instance(persistenceConfiguration, inject);
			var apfLocation = this.oCoreApi.getUriGenerator().getApfLocation();
			jQuery.sap.includeStyleSheet(apfLocation + "modeler/resources/css/configModeler.css", "configModelerCss");
			sap.ui.core.UIComponent.prototype.init.apply(this, arguments);
			//initialize the router
			var oRouter = this.getRouter();
			this.oRouteHandler = new sap.m.routing.RouteMatchedHandler(oRouter);
			oRouter.initialize();
		},
		/**
		 * @private
		 * @description Creates the content of the component. A component, that extends this component should call this method.
		 * @function
		 * @name sap.apf.modeler.Component.prototype.createContent
		 * @returns {sap.ui.core.Control} the content
		 */
		createContent : function() {
			if (applicationListView === undefined) {
				var applicationListView = sap.ui.view({
					viewName : "sap.apf.modeler.ui.view.applicationList",
					type : "XML",
					viewData : this.oCoreApi
				});
			}
			var apfLocation = this.oCoreApi.getUriGenerator().getApfLocation();
			return applicationListView;
		}
	});
}());

}; // end of sap/apf/modeler/Component.js
if ( !jQuery.sap.isDeclared('sap.apf.api') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap */

(function () {
    'use strict';

    jQuery.sap.declare('sap.apf.api');

    
    
    
    
    
    
    
    
    

    
    
    
    
    
    
    
    
    

    /**
     * @public
     * @class Official API for Analysis Path Framework (APF)<br>
     * <p>
     * The APF API provides a consuming application access to the functionality of the APF. It is assumed that the consuming application extends type {@link sap.apf.Component}.
     * The API reference is returned by method {@link sap.apf.Component#getApi}.
     * <br>
     * Objects and types returned by methods of APF API or passed in parameters of APF API method also belong to the API.
     * These objects and types are documented in their respective sections of this documentation.
     * All methods, objects or types that are not explicitly documented as public are strictly internal and may be changed without prior notice.
     * This also includes all methods, objects or types being classified as experimental.<br>
     * Furthermore there is no need to instantiate required entities directly by applying the JavaScript 'new'-operator on their respective constructors.
     * Instead they should be created by consumers using a create method available on API-level, such as e.g. {@link sap.apf.Api#createMessageObject} for {@link sap.apf.core.MessageObject} or {@link sap.apf.Api#createFilter} for {@link sap.apf.utils.Filter}.
     * </p>
     * @name sap.apf.Api
     * @param {sap.apf.Component} oComponent - A reference to the calling Component.js. The reference provides access to parameters and context.
     * @param {Object} [injectedConstructors] - injected constructors for testing.
     */
    sap.apf.Api = function (oComponent, injectedConstructors) {

        var probe = null;
        var oMessageHandler;
        var oCoreApi;
        var oStartParameter;
        var oNavigationHandler;

        /**
         * @public
         * @description Contains 'api'
         * @returns {string}
         */
        this.type = 'api';

        /**
         * @public
         * @deprecated since Version 1.23.1. Use sap.apf.core.constants instead.
         * @name sap.apf.constants
         * @description Constants to be used by APF consumers.
         * @type {Object}
         */
        this.constants = {};
        /**
         * @public
         * @deprecated since Version 1.23.1. Use sap.apf.core.constants instead.
         * @name sap.apf.constants.eventTypes
         * @description Constants for events used by APF consumers.
         */
        this.constants.eventTypes = sap.apf.core.constants.eventTypes;

        oStartParameter = new sap.apf.utils.StartParameter(oComponent);
        oMessageHandler = new sap.apf.core.MessageHandler();
        oCoreApi = new sap.apf.core.Instance({
        	startParameter : oStartParameter,
        	messageHandler : oMessageHandler 
        });
        
        /**
         * @public
         * @experimental Revision planned by moving the method into apf.Component.js.
         * @function
         * @name sap.apf.Api#activateOnErrorHandling
         * @description The handling of the window.onerror by the message handler is
         *              either switched on or off. Per default the handling is deactivated.
         * @param {boolean} bHandling Boolean true switches the winow.onerror handling on
         * @returns undefined
         */
        this.activateOnErrorHandling = function (bHandling) {
            return oCoreApi.activateOnErrorHandling(bHandling);
        };

        // --------------- Begin of DEPRECATED -------------------------------- */
        /**
         * @private
         * @function
         * @name sap.apf.Api#getStartParameterFacade
         * @description Returns start parameter which are passed by component or url parameter
         * @returns {sap.apf.utils.startParameter}
         */
        this.getStartParameterFacade = function () {
            return oCoreApi.getStartParameterFacade();
        };
        
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#setCallbackForMessageHandling
         * @description Sets a callback function, so that a message can be further
         *              processed.
         * @param {function} fnCallback
         *            The callback function will be called with the messageObject of type {sap.apf.core.MessageObject}.
         * @returns undefined
         */
        this.setCallbackForMessageHandling = function (fnCallback) {
        	return oCoreApi.setCallbackForMessageHandling(fnCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#setApplicationCallbackForMessageHandling
         * @description Sets an application callback function, which allows applications to register a message callback.
         * @param {function} fnCallback
         *            The callback function will be called with the messageObject of type {sap.apf.core.MessageObject}.
         * @returns undefined
         */
        this.setApplicationCallbackForMessageHandling = function (fnCallback) {
            return oCoreApi.setApplicationCallbackForMessageHandling(fnCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getLogMessages
         * @description Returns a copy of APF log messages with severity 'fatal'.
         * @returns {string[]} Array containing the message log. The message put last is at first array position.
         */
        this.getLogMessages = function () {
            return oCoreApi.getLogMessages();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#createStep
         * @description Creates a step object from the configuration object and adds it to the path.
         * @param {string} sStepId Step ID as defined in the analytical content configuration.
         * @param {function} fnStepProcessedCallback Callback for update of steps. Same semantics as in {@link sap.apf.Api#updatePath}
         * @param {string} [sRepresentationId] Parameter that allows definition of the representation id that shall
         * initially be selected. If omitted, the first configured representation will be selected.
         * @return {sap.apf.core.Step}
         */
        this.createStep = function (sStepId, fnStepProcessedCallback, sRepresentationId) {
            return oCoreApi.createStep(sStepId, fnStepProcessedCallback, sRepresentationId);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getActiveStep
         * @description Returns active step, currently selected step, of analysis path.
         * @returns {sap.apf.core.Step}
         */
        this.getActiveStep = function () {
            return oCoreApi.getActiveStep();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getCategories
         * @description Returns category objects of all loaded category configuration objects.
         * @returns {object[]} Object with configuration information about a category.
         */
        this.getCategories = function () {
            return oCoreApi.getCategories();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1. NOT REFERENCED
         * @function
         * @name sap.apf.Api#getContext
         * @description Returns a copy of the APF internal context.
         * The content corresponds to the values that have been passed to the APF instance by the latest call of method setContext().
         * @returns {sap.apf.utils.Filter}
         */
        this.getContext = function () {
            return jQuery.extend({}, oCoreApi.getContext());
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getSteps
         * @description Gets the ordered sequence of all steps contained in the analysis path.
         * Each step is a reference to the object in the path.
         * Each step shall always be identified by the reference to its step object,
         * e.g. in methods like removeStep, moveStepToPosition, setActiveStep, etc.
         * @returns {sap.apf.core.Step[]}
         */
        this.getSteps = function () {
            return oCoreApi.getSteps();
        };
        //noinspection JSValidateJSDoc
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getStepTemplates
         * @description Returns step templates based on all steps configured in the analytical content configuration.
         * A step template contains static information and convenience functions.
         * @returns {sap.apf.core.configurationFactory.StepTemplate[]}
         */
        this.getStepTemplates = function () {
            return oCoreApi.getStepTemplates();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getFacetFilterConfigurations
         * @description Returns all facet filters configured in the analytical content configuration.
         * @returns {Array} Contains facet filter configuration objects
         */
        this.getFacetFilterConfigurations = function () {
            return oCoreApi.getFacetFilterConfigurations();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getApplicationConfigProperties
         * @description This function returns those properties of the application configuration file that are not internally used.
         * @returns {object}
         */
        this.getApplicationConfigProperties = function () {
            return oCoreApi.getApplicationConfigProperties();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#moveStepToPosition
         * @description Moves a step in the analysis path to the specified target position.
         * @param {sap.apf.core.Step} oStep The step object to be moved
         * @param {number} nPosition The target position. Must be a valid position in the path, between zero and length-1.
         * @param {function} fnStepProcessedCallback Callback for update of steps. Same semantics as in {@link sap.apf.Api#updatePath}
         * @returns undefined
         */
        this.moveStepToPosition = function (oStep, nPosition, fnStepProcessedCallback) {
            return oCoreApi.moveStepToPosition(oStep, nPosition, fnStepProcessedCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#removeStep
         * @description Removes a step from the analysis path.
         * @param {sap.apf.core.Step} oStep The step object to be removed. The reference must be an object contained in the path. Otherwise, a message will be put.
         * @param {function} fnStepProcessedCallback Callback for update of steps. Same semantics as in {@link sap.apf.Api#updatePath}
         * @returns undefined
         */
        this.removeStep = function (oStep, fnStepProcessedCallback) {
            return oCoreApi.removeStep(oStep, fnStepProcessedCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#resetPath
         * @description Removes all steps from the path and removes active step.
         * @returns undefined
         */
        this.resetPath = function () {
            return oCoreApi.resetPath();
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#setActiveStep
         * @description Sets handed over step as the active one.
         * @param {sap.apf.core.Step} oStep The step to be set as active
         * @returns undefined
         */
        this.setActiveStep = function (oStep) {
            return oCoreApi.setActiveStep(oStep);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#stepIsActive
         * @description Checks whether a step is active or not.
         * @param {sap.apf.core.Step} oStep Step reference
         * @returns {boolean}
         */
        this.stepIsActive = function (oStep) {
            return oCoreApi.stepIsActive(oStep);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#updatePath
         * @description The steps in the path will be updated sequentially - starting with the analysis step at position 0.
         * Update of a step means sending an OData request and providing the step representation with the request response data.
         * Actual filter values that need to be sent with the request for a specific step in the update sequence are determined by transforming selections on step
         * representations of all precedent steps into a cumulative filter expression.
         * Furthermore the representation of the current step is queried for request options.
         * <br>
         * Following aspects of analysis path update are noteworthy:
         * <ul>
         * <li>An OData request for update of a specific step will only be sent if at least one of both determined values, cumulative Filter or request options,
         * has changed between the last update for this step where a request was sent and the current update cycle.</li>
         * <li>Because transformation of selections on a UI representation into a filter expression is based on current
         * data, OData requests need to be sent sequentially following the order of steps in the analysis path.
         * In other words: request for step n can earliest be sent once data for step n-1 has been received and evaluated</li>
         * </ul>
         * @param {function} fnStepProcessedCallback Callback function that is called for each step during the update of an analysis path.
         * First argument of the callback function is the step instance.
         * The second argument is a boolean indicator, telling whether data for the step has been updated with current request response data or not.
         * Data of a step will not be updated if there is no difference in OData request attributes between previous and current (potential) update.
         * @returns undefined
         */
        this.updatePath = function (fnStepProcessedCallback) {
            return oCoreApi.updatePath(fnStepProcessedCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getApfLocation
         * @description Returns the location of the APF library on the server.
         * @returns {string}
         */
        this.getApfLocation = function () {
            return oCoreApi.getUriGenerator().getApfLocation();
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#readPaths
         * @description Reads all stored paths of the currently logged on user from server.
         * Result is returned as a list sorted by last changed date and time of a saved path in descending order.
         * @param {function} fnCallback The first argument of the callback function is an object with property paths and status.
         * The second argument is {sap.apf.core.EntityTypeMetadata}.
         * The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
         * @returns undefined
         */
        this.readPaths = function (fnCallback) {
            return oCoreApi.readPaths(fnCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#savePath
         * @description Saves or modifies the current path on server side under the provided name.
         * @param {string} [sPathId] If provided the path identified by the ID is modified with the current path.
         * If omitted the current path will be created as new saved path with a new ID.
         * @param {string} sName Name of the path to be saved
         * @param {function} fnCallback The first argument of the callback function is an object with property AnalysisPath and status.
         * The second argument is {sap.apf.core.EntityTypeMetadata}.
         * The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
         * @returns undefined
         */
        this.savePath = function (sPathId, sName, fnCallback) {
            oCoreApi.savePath(sPathId, sName, fnCallback);
        };
        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#openPath
         * @description Opens a path, that has been stored on server side and replaces the current path.
         * @param {string} sPathId Identifies the analysis path to be opened
         * @param {function} fnCallback The first argument of the callback function is a JS object with property path, that holds the stored path and status. The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
         * @param {number} [nActiveStep] Sets the active step.
         * @returns undefined
         */
        this.openPath = function (sPathId, fnCallback, nActiveStep) {
            return oCoreApi.openPath(sPathId, fnCallback, nActiveStep);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#deletePath
         * @description Deletes the path with the given ID on server
         * @param {string} sPathId Identifies the analysis path to be deleted
         * @param {function} fnCallback The first argument of the callback function is a JS object, that holds the property status. The second argument is {sap.apf.core.EntityTypeMetadata}. The third argument is undefined or {sap.apf.core.MessageObject} if a message occurred.
         * @returns undefined
         * @deprecated since Version 1.23.1.
         */
        this.deletePath = function (sPathId, fnCallback) {
            return oCoreApi.deletePath(sPathId, fnCallback);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#setContext
         * @description Sets an initial path filter for an APF instance.
         * @param {sap.apf.utils.Filter} oFilter  Filter containing initial values that are used for each OData request during update of analysis path.
         * Contained values are automatically applied to parameter entity set key properties and filter properties of an OData request.
         * Furthermore the values are used for determination of the logical system.
         * The filter object shall be created by method {@link sap.apf.Api#createFilter}
         * @returns undefined
         */
        this.setContext = function (oFilter) {
            oPathContextHandler.update('ApfInitialContext', oFilter);
        };

        /**
         * @private
         * @deprecated since Version 1.23.1. Remains in api in order to maintain downward compatibility to 3 Wave 5 apps.
         * @function
         * @name sap.apf.Api#addFacetFilter
         * @description Injects the application facet filter component into APF layout placeholder
         * @returns undefined
         */
        this.addFacetFilter = function (facetFilter) {
            oUiApi.getLayoutView().getController().addFacetFilter(facetFilter);
        };        /**
         * @private
         * @deprecated since Version 1.23.1.
         * @function
         * @name sap.apf.Api#getEventCallback
         * @param {sap.apf.core.constants.eventTypes} sEventType is the type of event for registering the fnCallback for that particular event type
         * @returns the callback registered for the particular event type.
         */
        this.getEventCallback = function (sEventType) {
            return oUiApi.getEventCallback(sEventType);
        };

// --------------- end of DEPRECATED ------------------------------------------ */

  	
        /**
         * @public
         * @function
         * @name sap.apf.Api#putMessage
         * @description A message is passed to the APF message handler for further processing.
         *              All message specific settings (e.g. message code or severity) need to be passed within an APF message object instance.
         * @param {sap.apf.core.MessageObject} oMessage The message object shall be created by method {@link sap.apf.Api#createMessageObject}.
         * @returns undefined
         */
        this.putMessage = function (oMessage) {
            return oCoreApi.putMessage(oMessage);
        };
        /**
         * @public
         * @function
         * @name sap.apf.Api#createMessageObject
         * @description Creates a message object, which is the mandatory parameter for API method putMessage.
         *              So first create the message object and afterwards call putMessage with the message object as argument.
         * @param {object} oConfig Configuration object for the message object.
         * @param {string} oConfig.code The message is classified by its code. The code identifies an entry in the message configuration.
         * @param {array} [oConfig.aParameters] Additional parameters for the message. The parameters are filled into the message text,
         *                                      when the message will be processed by the text resource handler.
         * @param {object} [oConfig.oCallingObject] Reference of the calling object. This can be used later to visualize on the user interface, where the message occurred.
         * @param {string} [oConfig.rawText] Raw text for non translated messages.
         * @returns {sap.apf.core.MessageObject}
         */
        this.createMessageObject = function (oConfig) {
            return oCoreApi.createMessageObject(oConfig);
        };

        /**
         * @public
         * @function
         * @name sap.apf.Api#getTextHtmlEncoded
         * @description Retrieves a text and applies HTML encoding
         * @param {object} oLabel || {string} Label object or text key
         * @param {string[]} aParameters Array with parameters to replace place holders in text.
         * @returns {string}
         */
        this.getTextHtmlEncoded = function (oLabel, aParameters) {
            return oCoreApi.getTextHtmlEncoded(oLabel, aParameters);
        };
        /**
         * @public
         * @function
         * @name sap.apf.Api#getTextNotHtmlEncoded
         * @description Retrieves a text without application of HTML encoding
         * @param {object} oLabel || {string} Label object or text key
         * @param {string[]} aParameters Array with parameters to replace place holders in text.
         * @returns {string}
         */
        this.getTextNotHtmlEncoded = function (oLabel, aParameters) {
            return oCoreApi.getTextNotHtmlEncoded(oLabel, aParameters);
        };
        /**
         * @public
         * @experimental Revision planned by moving the method into apf.Component.js.
         * @deprecated since Version 1.23.1.
//         * FIXME The apf.api instance loads the configuration file provided the filePath is configured in the component parameters.
         * @function
         * @name sap.apf.Api#loadApplicationConfig
         * @description Loads a new  application configuration in JSON format. When called many times, the file is loaded only the first time.
         * @param {string} sFilePath The absolute path of an application configuration file. Host and port will be added in front of this path.
         */
        this.loadApplicationConfig = function (sFilePath) {
            oCoreApi.loadApplicationConfig(sFilePath);
        };

        /**
         * @public
         * @function
         * @name sap.apf.Api#createFilter
         * @description Creates an empty filter object.
         * Its methods can be used to create a logical filter expression.
         * @returns {sap.apf.utils.Filter}
         */
        this.createFilter = function () {
            return oCoreApi.createFilter();
        };

        /**
         * @public
         * @function
         * @name sap.apf.Api#addPathFilter
         * @param {sap.apf.utils.Filter} filter
         * @description  Adds a path filter fragment for a path context.
         * Creates a unique fragment and a corresponding identifier.
         * Subsequent changes need to be done by the update method providing the identifier.
         * @returns  {number} ID to be provided for later updates of the same fragment.
         */
        this.addPathFilter = function (filter) {
            return oPathContextHandler.add(filter);
        };
        /**
         * @public
         * @function
         * @name sap.apf.Api#updatePathFilter
         * @param {number|string} id Identifier of the path filter fragment as it was returned by addPathFilter method.
         * When using an ID of type string the caller must ensure that it is unique.
         * @param {sap.apf.utils.Filter} filter
         * @description Updates or creates a path filter fragment for the given identifier by fully replacing the existing one.
         * @returns {string} id for update
         */
        this.updatePathFilter = function (id, filter) {
            oPathContextHandler.update(id, filter);
        };
        /**
         * @public
         * @function
         * @name sap.apf.Api#getPathFilter
         * @param {number|string} id - Identifier of the path filter fragment as it was returned by addPathFilter method.
         * @description Gets a path filter fragment for the given identifier by fully replacing the existing one.
         * @returns {sap.apf.utils.Filter} filter for id
         */
        this.getPathFilter = function (id) {
            return oPathContextHandler.get(id);
        };
        /**
         * @public
         * @see sap.apf#createReadRequest
         * @description Creates an object for performing an Odata Request get operation.
         * @param {String|Object} requestConfiguration - identifies a request configuration, which is contained in the analytical configuration.
         *                        or the request configuration is directly passed as an object oRequestConfiguration.
         * @returns {sap.apf.core.ReadRequest}
         */
        this.createReadRequest = function (requestConfiguration) {
            return oCoreApi.createReadRequest(requestConfiguration);
        };
        /**
         * @public
         * @see sap.apf#createReadRequestByRequiredFilter
         * @description Creates an object for performing an Odata Request get operation with required filter for parameter entity set key properties & required filters.
         * @param {String|Object} requestConfiguration - identifies a request configuration, which is contained in the analytical configuration.
         *                        or the request configuration is directly passed as an object oRequestConfiguration.
         * @returns {sap.apf.core.ReadRequestByRequiredFilter}
         */
        this.createReadRequestByRequiredFilter = function (requestConfiguration) {
            return oCoreApi.createReadRequestByRequiredFilter(requestConfiguration);
        };

        var oPathContextHandler = new sap.apf.utils.PathContextHandler({ setContext: oCoreApi.setContext }, oCoreApi.getMessageHandler());
        
        oNavigationHandler = new sap.apf.utils.NavigationHandler({
            instances : {
                messageHandler : oMessageHandler,
                component : oComponent
            },
            functions : {
            	getCumulativeFilterUpToActiveStep : oCoreApi.getCumulativeFilterUpToActiveStep,
                getNavigationTargets : oCoreApi.getNavigationTargets,
                serializePath : oCoreApi.serializePath,
                serializeContext : oPathContextHandler.serialize,
                deserializePath : oCoreApi.deserializePath,
                deserializeContext : oPathContextHandler.deserialize
            }
        });
        
        
        var oSerializationMediator = new sap.apf.utils.SerializationMediator({coreApi : oCoreApi, pathContextHandler : oPathContextHandler}); 
        var dependencies = {
            oCoreApi: oCoreApi,
            oPathContextHandler: oPathContextHandler,
            oSerializationMediator: oSerializationMediator,
            oNavigationHandler : oNavigationHandler,
            oComponent: oComponent,
            oStartParameter: oStartParameter
        };
        var oUiApi = new sap.apf.ui.Instance(dependencies);

        /**
         * @private
         * @experimental Not yet final
         * @function
         * @name sap.apf.core.Instance#createRepresentation
         * @description Method to be used APF internally by the binding class to create instances from representation constructors.
         * Reason for declaring the method here, in the scope of APF API, and assigning it to the sap.apf.core-instance, is that the method requires
         * the core and the UI instance to be passed to the representation constructors.
         * @param {string} sRepresentationConstructorPath - A string maintained in the analytical configuration that contains the module path of the respective representation.
         * @param {object} oConfig - The representation specific configuration object as maintained in the analytical configuration.
         * @returns {sap.apf.ui.representations.representationInterface}
         */
        oCoreApi.createRepresentation = function (sRepresentationConstructorPath, oConfig) {
            var interfaceProxy = new sap.apf.ui.representations.RepresentationInterfaceProxy(oCoreApi, oUiApi);
            var Representation = sap.apf.utils.extractFunctionFromModulePathString(sRepresentationConstructorPath);
            return new Representation(interfaceProxy, oConfig);
        };


        /**
         * @public
         * @experimental Method name tentative.
         * @function
         * @name sap.apf.Api#selectionChanged
         * @description Calls the sap.apf.core.instance#updatePath (also see {@link sap.apf.core.Path#update}) with proper callback for UI.
         *                It also refreshes the steps either from the active step or
         *                all the steps depending on the boolean value passed.
         * @param {boolean} bRefreshAllSteps
         */
        this.selectionChanged = function (bRefreshAllSteps) {
            oUiApi.selectionChanged(bRefreshAllSteps);
        };

        /**
         * @private
         * @experimental Revision planned by moving the method into apf.Component.js.
         * @function
         * @name sap.apf.Api#createApplicationLayout
         * @description Creates the APF application layout.
         * @returns {sap.m.App} - the root element of a UI5 mobile application
         */
        this.createApplicationLayout = function () {
        	// Create and return APF UI Content
            return oUiApi.createApplicationLayout();
        };
        
        /**
         * @private
         * @function
         * @name sap.apf.Api#startApf
         * @description Triggers the start-up of APF content creation and calls back APFContentCreated
         * @returns {sap.m.App} - the APF content
         */
        this.startApf = function() {
        	var that = this;
            // Notify applications before APF start-up
            if (this.fnBeforeApfStartupCallback && typeof this.fnBeforeApfStartupCallback === "function") {
            	this.fnBeforeApfStartupCallback.apply(oComponent, [this]);
            }        	
        	
        	// Create APF UI Content
            var oApfContent = this.createApplicationLayout();
            
            var deferredMode = oNavigationHandler.checkMode();
            
            // Handle APF Start-up based on mode
            var promiseStartup = oUiApi.handleStartup(deferredMode);
            
            // Notify applications after APF start-up
            promiseStartup.done(function() {
            	if (that.fnAfterApfStartupCallback && typeof that.fnAfterApfStartupCallback === "function") {
            		that.fnAfterApfStartupCallback.apply(oComponent, [that]);
            	}
            });
            
            // Return APF UI Content
            return oApfContent;
        };

        /**
         * @public
         * @experimental Revision planned for method name.
         * @deprecated since Version 1.23.1. Remains in api in order to maintain downward compatibility to 3 Wave 5 apps.
         * @function
         * @name sap.apf.Api#addMasterFooterContent
         * @description Adds an element to the footer area.
         * @param {object} oControl any valid UI5 control.
         */
        this.addMasterFooterContent = function (oControl) {
            return oUiApi.addMasterFooterContentRight(oControl);
        };

        /**
         * @public
         * @experimental Revision planned for all parameter objects of callback function.
         * @function
         * @name sap.apf.Api#setEventCallback
         * @description Register the function callback to be executed on the given event type.
         *                fnCallback will be executed under a context and will be passed with arguments depending on the event type.
         * @param {sap.apf.core.constants.eventTypes} sEventType is the type of event for registering the fnCallback for that particular event type
         *                    printTriggered - Registers a callback for initial page print, this callback returns
         *                                     2d array
         *                    contextChanged : Registers a callback for context change, which will set the context of the application
         * @param {function} fnCallback that will be executed depending on the event type.
         * @returns {boolean} true or false based on success or failure of registering the listener.
         */
        this.setEventCallback = function (sEventType, fnCallback) {
            switch (sEventType) {
                case sap.apf.core.constants.eventTypes.contextChanged:
                    oUiApi.setEventCallback(sEventType, fnCallback);
                    return true;
                case sap.apf.core.constants.eventTypes.printTriggered:
                    oUiApi.setEventCallback(sEventType, fnCallback);
                    return true;
                case sap.apf.core.constants.eventTypes.format:
                    oUiApi.setEventCallback(sEventType, fnCallback);
                    return true;
                default:
                    return false;
            }
        };
        
        /**
         * @public
         * @function
         * @name sap.apf.Api#setCallbackBeforeApfStartup
         * @description Register the function callback to be executed before APF start-up.
		 * 				Callback is called with APF API instance as parameter and 'this' set to the Component instance.
         * @param {function} fnCallback that will be executed before APF start-up.
         */
        this.setCallbackBeforeApfStartup = function (fnCallback) {
        	this.fnBeforeApfStartupCallback = fnCallback;
        };
        
        /**
         * @public
         * @function
         * @name sap.apf.Api#setCallbackAfterApfStartup
         * @description Register the function callback to be executed after APF start-up and content has been created.
		 * 				Callback is called with APF API instance as parameter and 'this' set to the Component instance.
         * @param {function} fnCallback that will be executed after APF start-up and content has been created.
         */
        this.setCallbackAfterApfStartup = function (fnCallback) {
        	this.fnAfterApfStartupCallback = fnCallback;
        };

        /**
         * Injects all internal references to a probe object whose constructor is injected.
         */
        if ( injectedConstructors ) {
            if ( injectedConstructors.probe ) {
                //noinspection JSUnusedAssignment
                probe = new injectedConstructors.probe({
                    coreApi: oCoreApi,
                    component: oComponent,
                    uiApi: oUiApi,
                    pathContextHandler: oPathContextHandler,
                    serializationMediator: oSerializationMediator,
                    navigationHandler: oNavigationHandler
                });
            }
        }
    };
}());

}; // end of sap/apf/api.js
if ( !jQuery.sap.isDeclared('sap.apf.Component') ) {
/*!
 * SAP APF Analysis Path Framework
 * 
 * (c) Copyright 2012-2014 SAP AG. All rights reserved
 */
/*global jQuery, sap */
(function() {
	'use strict';
	jQuery.sap.declare("sap.apf.Component");
	jQuery.sap.require('sap.ui.core.UIComponent'); // unlisted dependency retained

	
	/**
	 * @public
	 * @class Base Component for all APF based applications.
	 * @name sap.apf.Component
	 * @extends sap.ui.core.UIComponent
	 */
	sap.ui.core.UIComponent.extend("sap.apf.Component", {
		oApi : null,
		metadata : {
			"config" : {
				"fullWidth" : true
			},
			"name" : "CoreComponent",
			"version" : "0.0.1",
			"publicMethods" : [ "getApi" ],
			"dependencies" : {
				"libs" : [ "sap.m", "sap.ui.layout", "sap.ca.ui", "sap.viz" ]
			}
		},
		/**
		 * @public
		 * @description Initialize the Component instance after creation. The component, that extends this component should call this method.
		 * @function
		 * @name sap.apf.Component.prototype.init
		 */
		init : function() {
            if (! this.oApi ) {
                this.oApi = new sap.apf.Api(this);
            }
			this.oApi.activateOnErrorHandling(true);
			
			// APF loads application configuration if sap-apf-app-config-path is provided via start parameters
			var appConfigPath = this.oApi.getStartParameterFacade().getApplicationConfigurationPath();
			if (appConfigPath) {
				this.oApi.loadApplicationConfig(appConfigPath);
			}
			sap.ui.core.UIComponent.prototype.init.apply(this, arguments);
		},
		/**
		 * @public
		 * @description Creates the content of the component. A component, that extends this component should call this method.
		 * @function
		 * @name sap.apf.Component.prototype.createContent
		 * @returns {sap.ui.core.Control} the content
		 */
		createContent : function() {
			sap.ui.core.UIComponent.prototype.createContent.apply(this, arguments);

            //this.getApi().loadApplicationConfig(sap.apf.core.constants.applicationConfiguration.applicationConfigPath);  // FIXME activate command !!!
            // Trigger APF start-up and return APF UI Content
			return this.oApi.startApf();
		},
		/**
		 * @public
		 * @function
		 * @name sap.apf.Component#getApi
		 * @description Returns the instance of the APF API.
		 * @returns {sap.apf.Api}
		 */
		getApi : function() {
			return this.oApi;
		}
	});
}());

}; // end of sap/apf/Component.js

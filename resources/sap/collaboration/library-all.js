/*!
 * @copyright@
 */
sap.ui.controller("sap.collaboration.components.fiori.feed.app.App",{onInit:function(){this.oApp=this.getView().oApp;this.oOdataModel=this.getView().getViewData().odataModel;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.sAppType=this.getView().getViewData().appType;this.sFeedType=this.getView().getViewData().feedType;this.sGroupIds=this.getView().getViewData().groupIds;this.oBusinessObject=this.getView().getViewData().object;},onBeforeRendering:function(){try{this.initializeUtils();this.createDetailPage();}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.onBeforeRendering()");this.oCommonUtil.displayError();}},initializeUtils:function(){if(!this.oODataUtil){this.oODataUtil=new sap.collaboration.components.utils.OdataUtil();}if(!this.oCommonUtil){this.oCommonUtil=this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();}},createDetailPage:function(){try{var v=this.sPrefixId+"detailView";if(!this.oApp.getPage(v)){this.initOData();var d=sap.ui.view({id:v,viewData:{controlId:this.sPrefixId,jamURL:this.sJamUrl,jamToken:this.sJamToken,appType:this.sAppType,feedType:this.sFeedType,groupIds:this.sGroupIds,object:this.oBusinessObject,langBundle:this.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});this.oApp.addPage(d);this.oApp.setInitialPage(d);}}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.createDetailPage()");throw e;}},getGroupIds:function(){var g;if(this.sFeedType===sap.collaboration.FeedType.group&&(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/Groups");this.sGroupIds=this.oODataUtil.getGroupIds(g);}else if(this.sFeedType===sap.collaboration.FeedType.objectGroup&&(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");this.sGroupIds=this.oODataUtil.getGroupIds(g);}else if(this.sFeedType===sap.collaboration.FeedType.objectGroup&&!(this.sGroupIds===undefined||this.sGroupIds==="")){g=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");var c=this.oODataUtil.getGroupIds(g);this.sGroupIds=this.filterGroupIds(c);}},filterGroupIds:function(c){var g;var C=c.split(",");var I=this.sGroupIds.split(",");for(var i=0;i<I.length;i++){if(C.indexOf(I[i])===-1){I.splice(i,1);i=i-1;}}if(I.length!==0){g=I.join();}else{g="";}return g;},initOData:function(){var s=this;var b=[];var a=false;var p=function(c){s.parseBatchResults(c);};var B=function(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component.initOdata(), fnBatchErrorCallback()");throw e;};try{b=this.createBatchRequests();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,b,p,a,B);}catch(i){jQuery.sap.log.error(i,"","sap.collaboration.components.fiori.feed.app.App.controller.initOdata()");throw i;}},createBatchRequests:function(){var s=this;var b=[];try{if(!s.sJamUrl){b.push(s.oODataUtil.createJamUrlBatchOperation(s.oOdataModel));}b.push(s.oODataUtil.createJamTokenBatchOperation(s.oOdataModel));switch(s.sFeedType){case sap.collaboration.FeedType.object:b=b.concat(s.createExternalUrlBatchRequest(s.oODataUtil,s.oBusinessObject));break;case sap.collaboration.FeedType.group:b.push(s.oODataUtil.createGetGroupsDataBatchOperation(s.oOdataModel));break;case sap.collaboration.FeedType.objectGroup:b.push(s.createObjectGroupBatchRequest(s.oODataUtil,s.oBusinessObject));break;}}catch(c){jQuery.sap.log.error(c,"","sap.collaboration.components.fiori.feed.app.App.controller.createBatchRequests()");throw c;}return b;},createExternalUrlBatchRequest:function(o,b){var s=this;var B=[];if(o&&b){if(b.id){B.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,b.id));}if(b.type){B.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,b.type));}}return B;},createObjectGroupBatchRequest:function(o,b){var s=this;var B;if(o&&b&&b.id){B=o.createGetObjectGroupsBatchOperation(s.oOdataModel,b.id);}else{var e=new Error("Missing parameters. Cannot create a batch request for Object Group.");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.app.App.controller.createObjectGroupBatchRequest()");throw e;}return B;},parseBatchResults:function(b){var s=this;var i=0;if(!s.sJamUrl){if(b[i].error){throw new Error(b[i].error);}else{s.sJamUrl=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetCollaborationHostUrl].Url;}i++;}if(b[i].error){throw new Error(b[i].error);}else{s.sJamToken=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetSingleUseToken].Id;}i++;if(s.sFeedType==sap.collaboration.FeedType.object){if(b[i].error){throw new Error(b[i].error);}else{s.oBusinessObject.id=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.odata_url=s.oBusinessObject.id;}i++;if(b[i].error){throw new Error(b[i].error);}else{s.oBusinessObject.type=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.metadata_url=s.oBusinessObject.type;}}else if(s.sFeedType==sap.collaboration.FeedType.group||s.sFeedType==sap.collaboration.FeedType.objectGroup){if(b[i].error){throw new Error(b[i].error);}else{var a=s.oODataUtil.getGroupIds(b[i].results);if(!s.sGroupIds){s.sGroupIds=a;}else{s.sGroupIds=s.filterGroupIds(a);}}}}});sap.ui.jsview("sap.collaboration.components.fiori.feed.app.App",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.app.App";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.oApp=new sap.m.App(this.sPrefixId+"app");return this.oApp;}});sap.ui.jsview("sap.collaboration.components.fiori.feed.commons.Detail",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.commons.Detail";},createContent:function(c){var l=this.getViewData().langBundle;this.sPrefixId=this.getViewData().controlId;this.oDetailPage=new sap.m.Page(this.sPrefixId+"feedDetailsPage",{title:l.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"),enableScrolling:false,content:[new sap.m.ScrollContainer(this.sPrefixId+"widgetContainer",{width:"100%",height:"100%",horizontal:false,vertical:false})]});return this.oDetailPage;}});sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster",{onInit:function(){this.sJamToken=this.getView().getViewData().jamToken;this.sPrefixId=this.getView().getViewData().controlId;this.oBusinessObject=this.getView().getViewData().object;},listItemPress:function(f){if(f===sap.collaboration.FeedType.follows||f===sap.collaboration.FeedType.company){this.getJamWidget(f);this.setDetailPageTitle(f);}else{this.navigateToGroupMaster(f);}},getJamWidget:function(f){var j=new sap.collaboration.components.utils.JamUtil();var w=j.prepareWidgetData(this.sJamToken,f,"",this.oBusinessObject);j.createJamWidget(this.sPrefixId+"widgetContainer",w);},setDetailPageTitle:function(f){var d;f===sap.collaboration.FeedType.follows?d=this.getView().oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"):d=this.getView().oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_COMPANY");sap.ui.getCore().byId(this.sPrefixId+"feedDetailsPage").setTitle(d);},navigateToGroupMaster:function(f){var n=this.createNavigationData(f);sap.ui.getCore().getEventBus().publish("nav","to",n);},createNavigationData:function(f){var d;f===sap.collaboration.FeedType.group?d={viewName:"sap.collaboration.components.fiori.feed.splitApp.GroupMaster",viewId:this.sPrefixId+"groupMasterView",data:{feedType:sap.collaboration.FeedType.group,lanBundle:this.getView().oLangBundle,groupMasterPageTitle:this.getView().oLangBundle.getText("GROUP_MASTER_PAGE_GROUP_TITLE")}}:d={viewName:"sap.collaboration.components.fiori.feed.splitApp.GroupMaster",viewId:this.sPrefixId+"groupMasterView",data:{feedType:sap.collaboration.FeedType.object,lanBundle:this.getView().oLangBundle,groupMasterPageTitle:this.getView().oLangBundle.getText("GROUP_MASTER_PAGE_BO_TITLE")}};return d;}});sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster";},createContent:function(c){this.oLangBundle=this.getViewData().langBundle;this.sPrefixId=this.getViewData().controlId;return new sap.m.Page(this.sPrefixId+"feedTypePage",{title:this.oLangBundle.getText("FEED_MASTER_PAGE_TITLE"),content:[new sap.m.List(this.sPrefixId+"FeedTypes",{inset:true,items:[new sap.m.StandardListItem({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_FOLLOWS"),type:sap.m.ListType.Active,selected:true,press:function(){c.listItemPress("follows");}}),new sap.m.StandardListItem({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_COMPANY"),type:sap.m.ListType.Active,press:function(){c.listItemPress("company");}}),new sap.m.StandardListItem({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_GROUP"),type:sap.m.ListType.Active,press:function(){c.listItemPress("group");}}),new sap.m.StandardListItem({title:this.oLangBundle.getText("FRV_DOMAIN_DATA_FEED_TYPES_BO"),type:sap.m.ListType.Active,press:function(){c.listItemPress("context");}})]})]});}});sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.GroupMaster",{onInit:function(){this.oOdataModel=this.getView().getViewData().odataModel;this.oBusinessObject=this.getView().getViewData().object;this.sFeedType=this.getView().getViewData().feedType;this.sPageTitle=this.getView().getViewData().pageTitle;this.sJamToken=this.getView().getViewData().jamToken;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;},onBeforeRendering:function(){var s=this;this.getView().groupMasterPage.setTitle(this.sPageTitle);this.initializeUtils();this.setViewModel();var S=new sap.m.StandardListItem();S.bindProperty("title","Name");S.setType(sap.m.ListType.Active);S.attachPress(function(){var g=this.getBindingContext().getProperty(this.getBindingContext().getPath()).Id;var G=this.getBindingContext().getProperty(this.getBindingContext().getPath()).Name;var w=s.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g);s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);sap.ui.getCore().byId(s.sPrefixId+"feedDetailsPage").setTitle(G);});sap.ui.getCore().byId(this.sPrefixId+"groupsList").bindItems("/groupsData",S);var o=new sap.m.StandardListItem({title:this.oLangBundle.getText("GROUP_MASTER_LIST_All_GROUPS")});o.setType(sap.m.ListType.Active);o.attachPress(function(){var g=s.oODataUtil.getGroupIds(s.aGroupData);var w=s.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g);s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);sap.ui.getCore().byId(s.sPrefixId+"feedDetailsPage").setTitle(s.oLangBundle.getText("GROUP_MASTER_LIST_All_GROUPS"));});sap.ui.getCore().byId(this.sPrefixId+"groupsList").insertItem(o,0);},onAfterRendering:function(){},initializeUtils:function(){this.oODataUtil=new sap.collaboration.components.utils.OdataUtil();this.oJamUtil=new sap.collaboration.components.utils.JamUtil();},setViewModel:function(){this.aGroupData;this.sFeedType===sap.collaboration.FeedType.group?this.aGroupData=this.oODataUtil.getGroupsData(this.oOdataModel,"/Groups"):this.aGroupData=this.oODataUtil.getGroupsData(this.oOdataModel,"/BusinessObjects('"+this.oBusinessObject.id+"')/AssignedGroups");this.oViewData={groupsData:this.aGroupData};this.oViewModel=new sap.ui.model.json.JSONModel(this.oViewData);this.getView().setModel(this.oViewModel);},onNavButtonTap:function(){sap.ui.getCore().getEventBus().publish("nav","back");}});sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.GroupMaster",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.GroupMaster";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.groupMasterPage=new sap.m.Page(this.sPrefixId+"groupPage",{title:this.getViewData().groupMasterpageTitle,showNavButton:true,navButtonPress:c.onNavButtonTap,content:[new sap.m.List(this.sPrefixId+"groupsList",{inset:true})]});return this.groupMasterPage;}});sap.ui.controller("sap.collaboration.components.fiori.feed.splitApp.SplitApp",{onInit:function(){this.oSplitApp=this.getView().oSplitApp;this.sAppType=this.getView().getViewData().appType;this.oOdataModel=this.getView().getViewData().odataModel;this.oBusinessObject=this.getView().getViewData().object;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.oEventBus=sap.ui.getCore().getEventBus();this.oEventBus.subscribe("nav","to",this.navToHandler,this);this.oEventBus.subscribe("nav","back",this.navBackHandler,this);},onBeforeRendering:function(){this.createMasterDetail();},createMasterDetail:function(){var o=new sap.collaboration.components.utils.OdataUtil();var j=o.getJamUrl(this.oOdataModel);this.sJamToken=o.getJamToken(this.oOdataModel);var m=sap.ui.view({id:this.sPrefixId+"masterView",viewData:{controlId:this.sPrefixId,jamToken:this.sJamToken,langBundle:this.oLangBundle,object:this.oBusinessObject},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster"});var d=sap.ui.view({id:this.sPrefixId+"detailView",viewData:{controlId:this.sPrefixId,appType:this.sAppType,jamURL:j,jamToken:this.sJamToken,langBundle:this.oLangBundle,object:this.oBusinessObject},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});this.oSplitApp.addDetailPage(d);this.oSplitApp.addMasterPage(m);this.oSplitApp.setInitialDetail(d);this.oSplitApp.setInitialMaster(m);},navToHandler:function(c,e,d){if(d&&d.viewId===this.sPrefixId+"groupMasterView"){if(!sap.ui.getCore().byId(d.viewId)){var v=sap.ui.view({id:d.viewId,viewData:{controlId:this.sPrefixId,odataModel:this.oOdataModel,object:this.oBusinessObject,feedType:d.data.feedType,pageTitle:d.data.groupMasterPageTitle,jamToken:this.sJamToken,langBundle:this.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:d.viewName});this.oSplitApp.addMasterPage(v);}else{sap.ui.getCore().byId(d.viewId).getController().sFeedType=d.data.feedType;sap.ui.getCore().byId(d.viewId).getController().sPageTitle=d.data.groupMasterPageTitle;sap.ui.getCore().byId(d.viewId).rerender();}this.oSplitApp.to(d.viewId);}else{jQuery.sap.log.error("nav-to event cannot be processed. Invalid data: "+d);}},navBackHandler:function(){this.oSplitApp.backMaster();}});sap.ui.jsview("sap.collaboration.components.fiori.feed.splitApp.SplitApp",{getControllerName:function(){return"sap.collaboration.components.fiori.feed.splitApp.SplitApp";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.oSplitApp=new sap.m.SplitApp(this.sPrefixId+"splitApp");return this.oSplitApp;}});sap.ui.controller("sap.collaboration.components.fiori.sharing.FolderSelection",{constants:{top:20},onInit:function(){this.oLangBundle=this.getView().getViewData().languageBundle;this.oODataModel=this.getView().getViewData().oDataModel;this.oODataUtil=this.getView().getViewData().oDataUtil;this.sGroupId=this.getView().getViewData().groupId;this.oFolderSelectionDialog=this.getView().getViewData().folderSelectionDialog;this.sCurrentFolderId='';this.aFolderBuffer=[];},onBeforeRendering:function(){this.refreshFolderSelection(this.sCurrentFolderId);},onAfterRendering:function(){},refreshFolderSelection:function(c){var f=this.buildFolderList(c);this.setViewModel(f);this.bindFoldersList();this.refreshHeaderBar(c);},buildFolderList:function(f){var s=[];var F=this.getFolder(f);s=this.getSubFolders(F);if(F.subFolderCount>s.length){var d=F.subFolderCount-s.length;for(var i=0;i<d;i++){s.push({});}}return s;},setViewModel:function(f){this.oViewData={folders:f};this.oViewModel=new sap.ui.model.json.JSONModel(this.oViewData);this.getView().setModel(this.oViewModel);},bindFoldersList:function(){var s=this;var i=new sap.m.StandardListItem({title:"{name}",icon:"{icon}",type:sap.m.ListType.Navigation,press:s.selectFolder()});this.getView().oFoldersList.bindAggregation("items","/folders",i);},refreshHeaderBar:function(f){if(!f==""){var F=this.getFolder(f);this.setFolderSelectionDialogTitle(F.name);this.setFolderSelectionDialogBackButtonVisibility(true);}else{this.setFolderSelectionDialogTitle(this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"));this.setFolderSelectionDialogBackButtonVisibility(false);}},selectFolder:function(e){var s=this;return function(e){var f=e.oSource.getBindingContext().getObject().id;s.refreshFolderSelection(f);s.sCurrentFolderId=f;};},navigateBack:function(e){var c=this.getFolder(this.sCurrentFolderId);var p=c.parent;this.refreshFolderSelection(p);this.sCurrentFolderId=p;},setFolderSelectionDialogTitle:function(f){var h=this.oFolderSelectionDialog.getCustomHeader();var t=h.getContentMiddle()[0];t.setText(f);},setFolderSelectionDialogBackButtonVisibility:function(i){var h=this.oFolderSelectionDialog.getCustomHeader();var b=h.getContentLeft()[0];b.setVisible(i);},getCurrentFolder:function(){if(this.sCurrentFolderId===''){return{name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:""};}return this.getFolder(this.sCurrentFolderId);},updateStarted:function(c){if(c.mParameters.reason=='Growing'){var s=[];var f=this.getFolderFromBuffer(this.sCurrentFolderId);var a=this.getSubFoldersFromBuffer(this.sCurrentFolderId).length;if(f.subFolderCount!=a){s=this.fetchSubFolders(this.sCurrentFolderId,a);}if(s.length>0){this.addFoldersToBuffer(s);for(var i=0;i<s.length;i++){this.oViewData.folders[i+a]=s[i];}}}},addFoldersToBuffer:function(f){if(!this.aFolderBuffer){this.aFolderBuffer=[];}for(var i=0;i<f.length;i++){this.aFolderBuffer.push(f[i]);}},getSubFoldersFromBuffer:function(f){var i='';if(f){i=f;}var h=function(a){return a.parent==i;};return this.aFolderBuffer.filter(h);},getFolderFromBuffer:function(f){var h=function(a){return a.id==f;};var F=this.aFolderBuffer.filter(h);return F[0];},getFolder:function(f){var a=this.getFolderFromBuffer(f);if(!a&&f==''){var r=this.oODataUtil.getSubFolders(this.oODataModel,this.sGroupId,null,'0',this.constants.top);a={name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:'',parent:'0',subFolderCount:r.count,icon:"sap-icon://folder"};this.addFoldersToBuffer([a]);var s=this.convertFolderEntities(r.folders,'');this.addFoldersToBuffer(s);}if(a.subFolderCount==undefined){var r=this.oODataUtil.getSubFolders(this.oODataModel,null,f,'0',this.constants.top);a.subFolderCount=r.count;var s=this.convertFolderEntities(r.folders,f);this.addFoldersToBuffer(s);}return a;},getSubFolders:function(f){var s=[];if(f.subFolderCount>0){s=this.getSubFoldersFromBuffer(f.id);}return s;},convertFolderEntities:function(f,p){var c=[];for(var i=0;i<f.length;i++){c.push({name:f[i].Name,id:f[i].Id,parent:p,icon:"sap-icon://folder"});}return c;},fetchSubFolders:function(f,s){var S=[];if(!f||f==''){S=this.oODataUtil.getSubFolders(this.oODataModel,this.sGroupId,null,s,this.constants.top).folders;S=this.convertFolderEntities(S,'');}else{S=this.oODataUtil.getSubFolders(this.oODataModel,null,f,s,this.constants.top).folders;S=this.convertFolderEntities(S,f);}return S;},clearFolderBuffer:function(){this.oFolderSelectionDialog.getContent()[0].getController().clearFolderBuffer();}});sap.ui.jsview("sap.collaboration.components.fiori.sharing.FolderSelection",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.FolderSelection";},createContent:function(c){var p=this.getViewData().controlId;this.oFoldersList=new sap.m.List(p+"_FoldersList",{inset:false,showNoData:false,growing:true,growingThreshold:c.constants.top,updateStarted:function(C){c.updateStarted(C);}});var d=new sap.m.VBox(p+"_DisplayFoldersLayout",{width:"100%",height:"100%",items:[this.oFoldersList]});return d;}});sap.ui.jsview("sap.collaboration.components.fiori.sharing.NoGroups",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.NoGroups";},createContent:function(c){var p=this.getViewData().controlId;this.oNoGroupsVBox=new sap.m.VBox(p+"_NoGroupsVbox");this.oNoGroupsVBox.addItem(this.createNoDataLayout());return this.oNoGroupsVBox;},createNoDataLayout:function(c){var p=this.getViewData().controlId;var l=this.getViewData().langBundle;var j=this.getViewData().jamUrl;this.oNoDataLayout=new sap.ui.layout.VerticalLayout(p+"_NoDataLayout",{width:"100%",content:[new sap.ui.core.HTML(p+"_NoDataDiv",{content:"<div>"+l.getText("No_GROUPS_ERROR")+"</div>"}),new sap.m.VBox(p+"_LinkVbox",{alignItems:sap.m.FlexAlignItems.End,items:[new sap.m.Link(p+"_JamLink",{text:l.getText("JAM_URL_TEXT"),target:"_blank",href:j})]}).addStyleClass("linkVBox")]});return this.oNoDataLayout;}});sap.ui.jsview("sap.collaboration.components.fiori.sharing.Sharing",{getControllerName:function(){return"sap.collaboration.components.fiori.sharing.Sharing";},createContent:function(c){var p=this.getViewData().controlId;this.oSharingVBox=new sap.m.VBox(p+"_SharingVbox");this.createSharingVBoxContent(c);return this.oSharingVBox;},createSharingVBoxContent:function(c){var p=this.getViewData().controlId;var l=this.getViewData().langBundle;var j=this.getViewData().jamUrl;this.oObjectDisplay=this.getViewData().objectDisplay;if(this.oObjectDisplay){this.oSharingVBox.addItem(this.oObjectDisplay);}var g=new sap.m.Label(p+"_GroupLabel",{text:l.getText("GRP_SELECT_LABEL"),required:true,width:"100%"});this.oGroupSelect=new sap.m.Input(p+"_GroupSelect",{width:"100%",type:sap.m.InputType.Text,placeholder:l.getText("GRP_SELECT_BUTTON_TEXT"),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(C){c.onGroupSelectValueHelpPress(C);}});var G=new sap.ui.layout.VerticalLayout(p+"_GroupSelectionLayout",{width:"100%",layoutData:new sap.m.FlexItemData({growFactor:1}),content:[g,this.oGroupSelect]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(G);var a=new sap.m.Label(p+"_AttachmentsLabel",{text:l.getText("ATTACHMENTS_LABEL"),required:false,width:"100%"});this.oAttachmentsInput=new sap.m.Input(p+"_AttachmentsInput",{width:"100%",type:sap.m.InputType.Text,placeholder:l.getText("ATTACHMENTS_FIELD_TEXT",[""]),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(C){c.onAttachmentsValueHelpPress(C);}});this.AttachmentsInputLayout=new sap.ui.layout.VerticalLayout(p+"_AttachmentsInputLayout",{width:"100%",layoutData:new sap.m.FlexItemData({growFactor:1}),content:[a,this.oAttachmentsInput]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(this.AttachmentsInputLayout);var t=new sap.m.Label(p+"_TargetFolderLabel",{text:l.getText("TARGET_FOLDER_LABEL"),required:false,width:"100%"});this.oTargetFolderInput=new sap.m.Input(p+"_TargetFolderInput",{width:"100%",type:sap.m.InputType.Text,placeholder:l.getText("TARGET_FOLDER_FIELD_TEXT"),showValueHelp:true,enabled:true,editable:true,valueHelpOnly:true,valueHelpRequest:function(C){c.onTargetFolderValueHelpPress(C);}});this.oTargetFolderInputLayout=new sap.ui.layout.VerticalLayout(p+"_TargetFolderInputLayout",{width:"100%",layoutData:new sap.m.FlexItemData({growFactor:1}),content:[t,this.oTargetFolderInput]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(this.oTargetFolderInputLayout);var n=new sap.m.Label(p+"_NoteLabel",{text:l.getText("ADD_NOTE_LABEL"),width:"100%"});var o;this.getViewData().objectId?o=this.getViewData().objectId.length:o=0;var N=1000-o-1;this.oNoteTextArea=new sap.m.TextArea(p+"_NoteTextArea",{value:this.getViewData().objectShare,rows:6,width:"100%",maxLength:N});var b=new sap.ui.layout.VerticalLayout(p+"_NoteLayout",{width:"100%",layoutData:new sap.m.FlexItemData({growFactor:2}),content:[n,this.oNoteTextArea]}).addStyleClass("sharingVBox");this.oSharingVBox.addItem(b);this.oAttachmentCB=new sap.m.CheckBox(p+"_AttchmentCB",{text:l.getText("SHARE_ATTACHMENTS_ONLY_LABEL"),enabled:false,select:function(){c.onAttachmentCheckBoxSelected();}});this.oSharingVBox.addItem(this.oAttachmentCB);}});sap.ui.jsview("sap.collaboration.components.socialprofile.SocialProfile",{getControllerName:function(){return"sap.collaboration.components.socialprofile.SocialProfile";},createContent:function(c){this._sPrefixId=this.getId();this._oVBox=new sap.m.VBox(this._sPrefixId+"_VBox").addStyleClass("vbox");this._createVBoxContent();return this._oVBox;},_createVBoxContent:function(){this._oVBox.addItem(this._createHBoxHeader());var c=new sap.m.Label(this._sPrefixId+"_ContactDetailsLabel",{text:this.getViewData().langBundle.getText("SP_CONTACT_DETAILS_LABEL")}).addStyleClass("heading");var m=new sap.m.Label(this._sPrefixId+"_MobileLabel",{text:this.getViewData().langBundle.getText("SP_MOBILE_LABEL")}).addStyleClass("label");var M=new sap.m.Text(this._sPrefixId+"_MobileNumber",{text:"{/MemberProfile/PhoneNumbers/Mobile}"});var w=new sap.m.Label(this._sPrefixId+"_WorkLabel",{text:this.getViewData().langBundle.getText("SP_WORK_LABEL")}).addStyleClass("label");var W=new sap.m.Text(this._sPrefixId+"_WorkNumber",{text:"{/MemberProfile/PhoneNumbers/Work}"});var e=new sap.m.Label(this._sPrefixId+"_EmailLabel",{text:this.getViewData().langBundle.getText("SP_EMAIL_LABEL")}).addStyleClass("label");var E=new sap.m.Link(this._sPrefixId+"_Email",{text:"{/Email}",press:function(){this.setHref("mailto:"+this.getText());}});var C=new sap.m.Label(this._sPrefixId+"_CompanyDetailsLabel",{text:this.getViewData().langBundle.getText("SP_COMPANY_DETAILS_LABEL")}).addStyleClass("heading");var o=new sap.m.Label(this._sPrefixId+"_CompanyAddressLabel",{text:this.getViewData().langBundle.getText("SP_COMPANY_ADDRESS_LABEL")}).addStyleClass("label");var a=new sap.m.Text(this._sPrefixId+"_CompanyAddress",{text:"{/MemberProfile/Address}"});this._oVBox.addItem(c).addItem(m).addItem(M).addItem(w).addItem(W).addItem(e).addItem(E).addItem(C).addItem(o).addItem(a);},_createHBoxHeader:function(){var h=new sap.m.VBox(this._sPrefixId+"_HeaderVBox").addStyleClass("headervbox");var f=new sap.m.Text(this._sPrefixId+"_FullName",{text:"{/FullName}"}).addStyleClass("fullname");var r=new sap.m.Text(this._sPrefixId+"_Role",{text:"{/Title}"}).addStyleClass("role");h.addItem(f).addItem(r);var H=new sap.m.HBox(this._sPrefixId+"_HeaderHBox",{height:"48px"});var u=new sap.m.Image(this._sPrefixId+"_HeaderUserImage",{alt:"{/FullName}",width:"48px",height:"48px"}).addStyleClass("image");var n=new sap.m.ObjectStatus(this._sPrefixId+"_NoUserHeader",{text:this.getViewData().langBundle.getText("SP_NO_USER"),state:"Warning",icon:"sap-icon://alert",visible:false});H.addItem(u).addItem(h).addItem(n);return H;},resetHeader:function(){var n=sap.ui.getCore().byId(this._sPrefixId+"_NoUserHeader");if(n.getVisible()===true){n.setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_HeaderVBox").setVisible(true);sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setVisible(true);}},setHeaderNoUser:function(){var u=sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage");if(u.getVisible()===true){u.setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_HeaderVBox").setVisible(false);sap.ui.getCore().byId(this._sPrefixId+"_NoUserHeader").setVisible(true);}}});jQuery.sap.declare('sap.collaboration.library-all');jQuery.sap.declare('sap.collaboration.components.fiori.feed.app.App.controller');jQuery.sap.declare('sap.collaboration.components.fiori.feed.app.App.view');jQuery.sap.declare('sap.collaboration.components.fiori.feed.commons.Detail.view');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster.controller');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.FeedTypeMaster.view');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.GroupMaster.controller');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.GroupMaster.view');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.SplitApp.controller');jQuery.sap.declare('sap.collaboration.components.fiori.feed.splitApp.SplitApp.view');jQuery.sap.declare('sap.collaboration.components.fiori.sharing.FolderSelection.controller');jQuery.sap.declare('sap.collaboration.components.fiori.sharing.FolderSelection.view');jQuery.sap.declare('sap.collaboration.components.fiori.sharing.NoGroups.view');jQuery.sap.declare('sap.collaboration.components.fiori.sharing.Sharing.view');jQuery.sap.declare('sap.collaboration.components.socialprofile.SocialProfile.view');if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.notification.NotificationContainer')){jQuery.sap.declare("sap.collaboration.components.fiori.notification.NotificationContainer");sap.ui.core.Control.extend("sap.collaboration.components.fiori.notification.NotificationContainer",{metadata:{properties:{styleClassPrefix:{type:"string"}},aggregations:{"content":{singularName:"content"}}},renderer:function(r,c){r.write("<div");r.writeControlData(c);r.addClass(c.getStyleClassPrefix()+"ContainerBox");r.writeClasses();r.writeStyles();r.write(">");var C=c.getContent();for(var i=0,l=C.length;i<l;i++){r.renderControl(C[i]);}r.write("</div>");}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentConstructorArgumentsException')){jQuery.sap.declare("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentConstructorArgumentsException");sap.ui.base.Object.extend("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentConstructorArgumentsException",{constructor:function(){this.exceptionName="InvalidAttachmentConstructorArgumentsException";}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException')){jQuery.sap.declare("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException");sap.ui.base.Object.extend("sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException",{constructor:function(p){this.exceptionName="InvalidAttachmentParameterException: "+p;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.helper.ShareUtil')){jQuery.sap.declare("sap.collaboration.components.fiori.sharing.helper.ShareUtil");sap.ui.base.Object.extend("sap.collaboration.components.fiori.sharing.helper.ShareUtil",{constructor:function(l,o,s,c,j,C){this._bIsOkToRefreshSecurityToken=true;this.iGrowingThreshold=10;this.oLangBundle=l;this.oODataUtil=o;this.oSMIODataModel=s;this.oJamODataModel=j;this.oCollaborationHostRestService=C;this.oCommonUtil=c;this.bShareError=false;this.bShareBusinessObjShared;this.bFileUploaded;this.aUploadAttachmentsUploaded=[];this.IdisplaySuccessMessageIntervalId;},shareBusinessObject:function(s){var a=this;if(s.mappedExternalObject){if(s.feedContent!==undefined&&s.feedContent.uiUrl!==undefined){this.oJamODataModel.create('/ExternalObjects',s.mappedExternalObject,{async:true,success:function(d,r){a._bIsOkToRefreshSecurityToken=true;a._featureExternalObjectToGroup(s,d.results.Id);},error:function(e){if(e.response.statusCode===403&&a._bIsOkToRefreshSecurityToken){a.oJamODataModel.refreshSecurityToken(function(){a._bIsOkToRefreshSecurityToken=false;a.shareBusinessObject(s);},function(e){a._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);},true);}else{a._bIsOkToRefreshSecurityToken=true;a._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);}}});}else{jQuery.sap.log.error("feedContent.uiUrl parameter should not be undefined when sharing an external object","sap.collaboration.components.fiori.sharing.helper.ShareUtil.shareBusinessObject()");this.displayErrorMessage();}}else{this._createFeedEntry_ShareObjectLink(s);}},_featureExternalObjectToGroup:function(s,e){var a=this;this.oJamODataModel.create("/Groups('"+s.groupId+"')/$links/FeaturedExternalObjects",{uri:"ExternalObjects('"+e+"')"},{async:true,success:function(d,r){a._createGroupFeedEntry_SharedExternalObject(s);},error:function(E){if(E.response.statusCode==409||E.response.statusCode==400||E.response.statusCode==404){a._createGroupFeedEntry_SharedExternalObject(s);}else{a._checkAuthorizationAndDisplayErrorMessage(E.response.statusCode);}}});},_createGroupFeedEntry_SharedExternalObject:function(s){var x='<?xml version="1.0" encoding="UTF-8"?>'+'<feed xmlns="http://www.w3.org/2005/Atom" xmlns:activity="http://activitystrea.ms/spec/1.0/">'+'<entry>'+'<title> </title>'+'<content type="html">'+jQuery.sap.encodeXML(s.feedContent.note)+'</content>'+'<author>'+'<email>'+jQuery.sap.encodeXML(s.memberEmail)+'</email>'+'<activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>'+'</author>'+'<activity:verb>http://activitystrea.ms/schema/1.0/share</activity:verb>'+'<activity:object>'+'<id>'+jQuery.sap.encodeXML(s.mappedExternalObject.Exid)+'</id>'+'<title type="html">'+jQuery.sap.encodeXML(s.externalObject.name)+'</title>'+'<activity:object-type>'+jQuery.sap.encodeXML(s.mappedExternalObject.ObjectType)+'</activity:object-type>'+'<link type="text/html" rel="alternate" href="'+jQuery.sap.encodeXML(s.feedContent.uiUrl)+'"/>'+'<link rel="http://www.odata.org" href="'+jQuery.sap.encodeXML(s.mappedExternalObject.ODataLink)+'"/>'+'<link rel="http://www.odata.org/metadata" href="'+jQuery.sap.encodeXML(s.mappedExternalObject.ODataMetadata)+'"/>'+'<link rel="http://www.odata.org/annotation" href="'+jQuery.sap.encodeXML(s.mappedExternalObject.ODataAnnotations)+'"/>'+'<source>'+'<id>tag:www.cubetree.com,2013:/groups/'+jQuery.sap.encodeXML(s.groupId)+'</id>'+'</source>'+'</activity:object>'+'</entry>'+'</feed>';var a=this;var o=function(){if(this.readyState==4){if(this.status==200){a.bShareBusinessObjShared=true;a.displaySuccessMessage(s.groupName);}else{a._checkAuthorizationAndDisplayErrorMessage(this.status);}}};this._createFeedEntryViaRestAPI(x,o);},_createFeedEntry_ShareObjectLink:function(s){this.bShareBusinessObjShared=false;if(s.feedContent){if(s.feedContent.note!==undefined){var c=s.feedContent.note;if(s.feedContent.uiUrl){c=c+"<br/><a href='"+s.feedContent.uiUrl.replace(/'/g,"&apos;")+"'>"+this.oLangBundle.getText("SHARE_OBJECT_LINK")+'</a>';}var x='<?xml version="1.0" encoding="UTF-8"?>'+'<feed xmlns="http://www.w3.org/2005/Atom" xmlns:activity="http://activitystrea.ms/spec/1.0/">'+'<entry>'+'<title>'+jQuery.sap.encodeXML(this.oLangBundle.getText("SHARE_OBJECT_LINK_TITLE"))+'</title>'+'<content type="html">'+jQuery.sap.encodeXML(c)+'</content>'+'<author>'+'<email>'+jQuery.sap.encodeXML(s.memberEmail)+'</email>'+'<activity:object-type>http://activitystrea.ms/schema/1.0/person</activity:object-type>'+'</author>'+'<activity:verb>http://activitystrea.ms/schema/1.0/share</activity:verb>'+'<activity:object>'+'<source>'+'<id>tag:www.cubetree.com,2013:/groups/'+jQuery.sap.encodeXML(s.groupId)+'</id>'+'</source>'+'</activity:object>'+'</entry>'+'</feed>';var a=this;var o=function(){if(this.readyState==4){if(this.status==200){a.bShareBusinessObjShared=true;a._bIsOkToRefreshSecurityToken=true;a.displaySuccessMessage(s.groupName);}else{if(this.status==403&&a._bIsOkToRefreshSecurityToken){a.oJamODataModel.refreshSecurityToken(function(){a._bIsOkToRefreshSecurityToken=false;a._createFeedEntry_ShareObjectLink(s);},function(e){a._checkAuthorizationAndDisplayErrorMessage(e.response.statusCode);},true);}else{a._bIsOkToRefreshSecurityToken=true;a._checkAuthorizationAndDisplayErrorMessage(this.status);}}}};this._createFeedEntryViaRestAPI(x,o);}else{jQuery.sap.log.error("feedContent.note parameter should not be undefined","sap.collaboration.components.fiori.sharing.helper.ShareUtil._createFeedEntry_ShareObjectLink()");this.displayErrorMessage();}}else{jQuery.sap.log.error("feedContent parameter should not be undefined","sap.collaboration.components.fiori.sharing.helper.ShareUtil._createFeedEntry_ShareObjectLink()");this.displayErrorMessage();}},_createFeedEntryViaRestAPI:function(x,o){var a={'Accept':'application/atom+xml','Content-Type':'application/atom+xml','x-csrf-token':this.oJamODataModel.getSecurityToken()};var f=this.oCollaborationHostRestService.url+"/feed/post";if(this.oCollaborationHostRestService.urlParams!=undefined&&this.oCollaborationHostRestService.urlParams!=""){f=f+"?"+this.oCollaborationHostRestService.urlParams;}var b=new window.XMLHttpRequest();b.open("POST",f,true);for(var h in a){b.setRequestHeader(h,a[h]);}b.onreadystatechange=o;b.send(x);},uploadAttachments:function(s){var a=this;var g=s.groupId;var f=s.folderId;for(var i in s.aFilesToUpload){this.oSMIODataModel.create('/UploadTargetFile',null,{async:true,success:function(d,r){jQuery.sap.log.debug('File was uploaded',"sap.collaboration.components.fiori.sharing.helper.ShareUtil.uploadAttachments()");},error:function(e){jQuery.sap.log.error('Error, file was not uploaded',"sap.collaboration.components.fiori.sharing.helper.ShareUtil.uploadAttachments()");},urlParameters:{FileMimeType:"'"+s.aFilesToUpload[i].mimeType+"'",FileName:"'"+s.aFilesToUpload[i].name+"'",FileURL:"'"+s.aFilesToUpload[i].url+"'",FolderId:"'"+s.folderId+"'",GroupId:"'"+s.groupId+"'"}});}},createGroupSelectionDialog:function(p,i,s,w,h,o){var a=this;var b=function(e){var v=e.getParameter("value");a.oGroupSelectionDialog.bindAggregation("items","/Groups/?$filter=substringof('"+v.replace(/'/g,"''")+"',Name)",i);};this.oGroupSelectionDialog=new sap.m.SelectDialog(p+"_GroupSelectionDialog",{multiSelect:false,noDataText:this.oLangBundle.getText("GRP_NO_GROUPS_FOUND_TEXT"),rememberSelections:false,growingThreshold:this.iGrowingThreshold,title:this.oLangBundle.getText("GROUP_SELECTION_DIALOG_TITLE"),confirm:s,search:b,liveChange:b}).addStyleClass("sapUiPopupWithPadding");if(w){this.oGroupSelectionDialog.setContentWidth(w.toString()+"px");}if(h){this.oGroupSelectionDialog.setContentHeight(h.toString()+"px");}this.oGroupSelectionDialog.setModel(o);this.oGroupSelectionDialog.bindAggregation("items","/Groups",i);return this.oGroupSelectionDialog;},displaySuccessMessage:function(g){var b=true;if(!(this.bShareBusinessObjShared===true||this.bShareBusinessObjShared===undefined)){b=false;}var f=true;if(!(this.bFileUploaded===true||this.bFileUploaded===undefined)){b=false;}if(this.bShareError===false){if(b===true&&f===true){this.oCommonUtil.showMessage(this.oLangBundle.getText("SHARING_SUCCESS_MSG",[g]),{width:"20em",autoClose:false});clearInterval(this.IdisplaySuccessMessageIntervalId);}}else{clearInterval(this.IdisplaySuccessMessageIntervalId);}},displayErrorMessage:function(){if(!this.bShareError){var e=this.oLangBundle.getText("SHARING_FAILURE_MSG");this.oCommonUtil.displayError(e);}this.bShareError=true;},_checkAuthorizationAndDisplayErrorMessage:function(s){var a=this;if(s==401||s==403){a.oCommonUtil.displayError(a.oLangBundle.getText("SHARE_AUTHORIZATION_FAILURE_MSG"));}else{a.displayErrorMessage();}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.annotations.Metadata')){jQuery.sap.require('sap.ui.base.Object');jQuery.sap.declare("sap.collaboration.components.socialtimeline.annotations.Metadata");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.annotations.Metadata",{constructor:function(o){this._oIncludedSchemaAliasMap={};this._oSchemaAliasMap={};this._oODataMetadata=o;this._parseODataMetadata();},_parseODataMetadata:function(){this._parseReferenceElements(this._oODataMetadata.extensions);this._parseDataServicesElement(this._oODataMetadata.dataServices);},_parseReferenceElements:function(r){for(var R in r){this._parseReferenceElement(r[R]);}},_parseReferenceElement:function(r){for(var R in r.children){this._parseReferenceElementChild(r.children[R]);}},_parseReferenceElementChild:function(r){if(r.name==="Include"){this._parseIncludeElement(r);}else{return;}},_parseIncludeElement:function(i){var I=null;var s=null;for(var a in i.attributes){if(i.attributes[a].name==="Namespace"){I=i.attributes[a].value;}else{s=i.attributes[a].value;}}this._oIncludedSchemaAliasMap[I]=s;},_parseDataServicesElement:function(d){this._parseSchemaElements(d.schema);},_parseSchemaElements:function(s){for(var S in s){this._parseSchemaElement(s[S]);}},_parseSchemaElement:function(s){if(s.alias===undefined){this._oSchemaAliasMap[s.namespace]=null;}else{this._oSchemaAliasMap[s.namespace]=s.alias;}this._parseEntityTypeElements(s.entityType);},_parseEntityTypeElements:function(e){for(var E in e){this._parseEntityTypeElement(e[E]);}},_parseEntityTypeElement:function(){},isSchemaIncluded:function(n){return(this._oIncludedSchemaAliasMap[n]!==undefined);}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.annotations.MetadataException')){jQuery.sap.require('sap.ui.base.Object');jQuery.sap.declare("sap.collaboration.components.socialtimeline.annotations.MetadataException");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.annotations.MetadataException",{constructor:function(e){this._sClassName="sap.collaboration.components.socialtimeline.annotations.MetadataException";this._sExceptionMessage=e;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility",{constructor:function(s,S){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility");this._oServiceMetadata=s;this._oServiceAnnotations=S;this._oEntityMappings={};this.sSchemaNamespace="com.sap.vocabularies.Collaboration.v1";var o=this._getIncludedSchema(this.sSchemaNamespace);if(!(o&&o.schemaNamespace===this.sSchemaNamespace)){var e="Schema with namespace "+this.sSchemaNamespace+" wasn't in an Include in the service's metadata document.";this._oLogger.error(e);throw new sap.collaboration.components.socialtimeline.annotations.MetadataException(e);}},getTimelineEntryNavigationPath:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}return m.timelineEntryNavigationPath;},getTimelineEntryFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryFields;if(!t){var T=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!T){T=this._oServiceAnnotations[m.timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}t=this._mapEntityFields(T);this._oEntityMappings[e].timelineEntryFields=t;}return t;},getTimelineEntryDetailFields:function(e){if(!e){var E=new Error('Parameter sEntityCollection is undefined');this._oLogger.error(E.message);throw E;}var m=this._oEntityMappings[e];if(!m){m=this._buildMapping(e);}var t=this._oEntityMappings[e].timelineEntryDetailFields;if(!t){var T=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this.sSchemaNamespace+".TimelineDetailPropertyValueChange"];if(!T){T=this._oServiceAnnotations[m.timelineEntryDetailEntityTypeFull][this._getCollaborationAlias()+".TimelineDetailPropertyValueChange"];}t=this._mapEntityFields(T);this._oEntityMappings[e].timelineEntryDetailFields=t;}return t;},_buildMapping:function(e){this._oEntityMappings[e]={};this._oEntityMappings[e].entityCollection=e;this._oEntityMappings[e].entityTypeFull=this._getEntityTypeFull(e);this._oEntityMappings[e].namespace=this._oEntityMappings[e].entityTypeFull.split(".")[0];this._oEntityMappings[e].entityType=this._oEntityMappings[e].entityTypeFull.split(".")[1];var E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this.sSchemaNamespace+".TimelineNavigationPath"];if(!E){E=this._oServiceAnnotations[this._oEntityMappings[e].entityTypeFull][this._getCollaborationAlias()+".TimelineNavigationPath"];}this._oEntityMappings[e].timelineEntryNavigationPath=E.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].entityType,this._oEntityMappings[e].timelineEntryNavigationPath);this._oEntityMappings[e].timelineEntryEntityType=this._oEntityMappings[e].timelineEntryEntityTypeFull.split(".")[1];this._oEntityMappings[e].timelineEntryFields=undefined;var t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this.sSchemaNamespace+".TimelineEntry"];if(!t){t=this._oServiceAnnotations[this._oEntityMappings[e].timelineEntryEntityTypeFull][this._getCollaborationAlias()+".TimelineEntry"];}this._oEntityMappings[e].timelineEntryDetailNavigationPath=t.TimelineDetailNavigationPath.NavigationPropertyPath;this._oEntityMappings[e].timelineEntryDetailEntityTypeFull=this._getChildEntityTypeFull(this._oEntityMappings[e].timelineEntryEntityType,this._oEntityMappings[e].timelineEntryDetailNavigationPath);this._oEntityMappings[e].timelineEntryDetailFields=undefined;return this._oEntityMappings[e];},_getEntityTypeFull:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityContainer){var E=m.entityContainer[0].entitySet;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j].entityType;}}}}throw new Error("Entity collection '"+e+"' could not be found in service");},_getChildEntityTypeFull:function(e,n){var E=this._getEntityTypeObject(e);var N=this._getNavigationProperty(E,n);var a=this._getAssociationEnd(N.toRole);return a.type;},_getEntityTypeObject:function(e){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.entityType){var E=m.entityType;for(var j=E.length-1;j>=0;j--){if(E[j].name===e){return E[j];}}}}throw new Error("Entity Type '"+e+"' could not be found in service");},_getNavigationProperty:function(e,n){if(e.navigationProperty){for(var k=e.navigationProperty.length-1;k>=0;k--){if(e.navigationProperty[k].name===n){return e.navigationProperty[k];}}}throw new Error("Navigation property '"+n+"' could not be found for entity '"+e.name+"'.");},_getAssociationEnd:function(r){for(var i=this._oServiceMetadata.dataServices.schema.length-1;i>=0;i--){var m=this._oServiceMetadata.dataServices.schema[i];if(m.association){for(var j=m.association.length-1;j>=0;j--){for(var k=m.association[j].end.length-1;k>=0;k--){if(m.association[j].end[k].role===r){return m.association[j].end[k];}}}}}throw new Error("Association with role '"+r+"' could not be found in service.");},_mapEntityFields:function(e){var f={};for(var p in e){if(e.hasOwnProperty(p)){if(e[p].Path){f[p]=e[p].Path;}else if(e[p].PropertyPath){f[p]=e[p].PropertyPath;}else if(e[p].EnumMember){f[p]=e[p].EnumMember;}else if(e[p].NavigationPropertyPath){f[p]=e[p].NavigationPropertyPath;}}}return f;},_getCollaborationAlias:function(){var a=this._oServiceAnnotations.aliasDefinitions;for(var b in a){if(a[b].indexOf("com.sap.vocabularies.Collaboration.v1")>-1){return b;}}},_getIncludedSchema:function(s){var i=0;var j=0;var k=0;var r;var R;var I;var S={schemaNamespace:undefined,schemaAlias:undefined};if(this._oServiceMetadata&&this._oServiceMetadata.extensions){for(i=0;i<this._oServiceMetadata.extensions.length;++i){r=this._oServiceMetadata.extensions[i];for(j=0;j<r.children.length;++j){R=r.children[j];if(R.name=="Include"){for(k=0;k<R.attributes.length;++k){I=R.attributes[k];if(I.name=="Namespace"){S.schemaNamespace=I.value;}if(I.name=="Alias"){S.schemaAlias=I.value;}}if(S.schemaNamespace==s){return S;}}}}return undefined;}return undefined;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.controls.TimelineEntryControlRenderer')){jQuery.sap.declare("sap.collaboration.components.socialtimeline.controls.TimelineEntryControlRenderer");sap.collaboration.components.socialtimeline.controls.TimelineEntryControlRenderer={};sap.collaboration.components.socialtimeline.controls.TimelineEntryControlRenderer.render=function(r,c){r.renderControl(c._oFlexbox);};};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler')){jQuery.sap.declare("sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler",{constructor:function(b,t){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler");this._oBOModel=b;this._oTimelineTermsUtility=t;},readTimelineEntries:function(e,b,o,s,t){var a=this;var p=new jQuery.Deferred();var E=this._buildTimelineEntriesEndpoint(e,b,o,s,t);var P={context:null,urlParameters:null,async:true,filters:[],sorters:[],success:function(d,r){var R=d;if(d.__next){var n=a._resolveResponseNextLink(d.__next,e,b);R.results=R.results.concat(n.results);}p.resolve(R.results);},error:function(c){a._oLogger.error(c.body);p.reject(c);}};return{request:this._oBOModel.read(E,P),promise:p};},_resolveResponseNextLink:function(n,e,b){var s=this;var r=[];var N=n.slice(n.indexOf(e+"("+jQuery.sap.encodeURL(b)+")")-1);var p={context:null,urlParameters:null,async:false,filters:[],sorters:[],success:function(d,a){r=d;if(d.__next){var o=s._resolveResponseNextLink(d.__next,e,b);r.results=r.results.concat(o.results);}},error:function(E){s._oLogger.error(E.body);}};this._oBOModel.read(N,p);return r;},_buildTimelineEntriesEndpoint:function(e,b,o,s,t){var a="/"+e+"("+jQuery.sap.encodeURL(b)+")"+"/"+this._oTimelineTermsUtility.getTimelineEntryNavigationPath(e)+"?$expand="+this._oTimelineTermsUtility.getTimelineEntryFields(e).TimelineDetailNavigationPath;if(s!=undefined){a+="&$skip="+s;}if(t!=undefined){a+="&$top="+t;}if(o!=undefined){a+="&$filter="+o;}this._oLogger.info("Timeline Entries Endpoint: "+a);return a;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.utils.JamUtil')){
/*!
 * @copyright@
 */
jQuery.sap.declare("sap.collaboration.components.utils.JamUtil");sap.ui.base.Object.extend("sap.collaboration.components.utils.JamUtil",{FeedRenderedControllerConstants:{jamWidgetCSS:{avatar:false,skin:"gr",post_mode:"inline",reply_mode:"inline",mobile_mode:true,live_update:true}},JamFeedType:{Follows:"follows",Company:"company",Group:"group",ObjectGroup:"context",Object:"external"},JamCallback:{autocomplete:"autocomplete",post_status:"post_status",link:"link"},JamEventType:{mouseover:"mouseover",mouseout:"mouseout",click:"click"},loadFeedWidgetScript:function(j,l,L){var s=this;var S=j+"/assets/feed_widget_v1.js";jQuery.sap.includeScript(S,"sap.collaboration.feed.JamFeedWidget",l,L);jQuery.sap.log.info("Jam Feed Widget Script Loading Asynchronously","sap.collaboration.components.utils.JamUtil.loadFeedWidgetScript()");},initializeJamWidget:function(sJamURL){try{this.sapjam=eval('sapjam');this.sapjam.feedWidget.init(sJamURL+"/widget/v1/feed","single_use_token");jQuery.sap.log.info("Jam Feed Widget Initialized","sap.collaboration.components.utils.JamUtil.initializeJamWidget()");}catch(oError){jQuery.sap.log.error(oError,"","sap.collaboration.components.utils.JamUtil.initializeJamWidget()");throw oError;}},createJamWidget:function(sWidgetContainerID,oWidgetData){try{jQuery.sap.log.debug("Jam Feed Widget Properties:","","sap.collaboration.components.utils.JamUtil.createJamWidget()");jQuery.sap.log.debug("type: "+JSON.stringify(oWidgetData.type));jQuery.sap.log.debug("group_id: "+JSON.stringify(oWidgetData.group_id));jQuery.sap.log.debug("external_id: "+JSON.stringify(oWidgetData.external_id));jQuery.sap.log.debug("external_type: "+JSON.stringify(oWidgetData.external_type));jQuery.sap.log.debug("external_object: "+JSON.stringify(oWidgetData.external_object));this.sapjam=eval('sapjam');this.sapjam.feedWidget.create(sWidgetContainerID,oWidgetData);}catch(oError){jQuery.sap.log.error(oError,"","sap.collaboration.components.utils.JamUtil.createJamWidget()");throw oError;}},prepareWidgetData:function(j,f,g,b){var w;w={type:f,avatar:this.FeedRenderedControllerConstants.jamWidgetCSS.avatar,live_update:this.FeedRenderedControllerConstants.jamWidgetCSS.live_update,post_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.post_mode,reply_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.reply_mode,mobile_mode:this.FeedRenderedControllerConstants.jamWidgetCSS.mobile_mode,hide_bookmark:true,single_use_token:j};switch(f){case sap.collaboration.FeedType.follows:case sap.collaboration.FeedType.company:w.type=f;break;case sap.collaboration.FeedType.group:case sap.collaboration.FeedType.objectGroup:w.type=this.JamFeedType.Group;w.group_id=g;break;case sap.collaboration.FeedType.object:w.type=this.JamFeedType.Object;if(!b){var E=new Error("Object is undefined");jQuery.sap.log.error(E,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw E;}if(!b.id){var o=new Error("Property 'id' is undefined");jQuery.sap.log.error(o,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw o;}if(!b.type){var a=new Error("Property 'type' is undefined");jQuery.sap.log.error(a,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw a;}try{w.external_id=b.id;w.external_type=b.type;w.external_object=b;}catch(c){jQuery.sap.log.error(c,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw c;}break;default:var e="Feed Type not supported";jQuery.sap.log.error(e,"","sap.collaboration.components.utils.JamUtil.prepareWidgetData()");throw new Error(e);}return w;},getJamSinglelUseTokens:function(c,a,A,C){var s=this;var x=new window.XMLHttpRequest();var S=c+"/single_use_tokens";x.open("POST",S,A);x.onreadystatechange=a;x.setRequestHeader("x-csrf-token",C);x.send();},getCSRFToken:function(e,a,A){var s=this;var x=new window.XMLHttpRequest();x.open("GET",e,A);x.onreadystatechange=a;x.setRequestHeader("x-csrf-token","fetch");x.send();}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.utils.MessageQueueUtil')){jQuery.sap.require('sap.m.MessageBox');jQuery.sap.require('sap.m.MessageToast');jQuery.sap.declare("sap.collaboration.components.utils.MessageQueueUtil");sap.ui.base.Object.extend("sap.collaboration.components.utils.MessageQueueUtil",{messageTypes:{messageToast:"MToast",messageBox:"MBox"},aMessageQueue:[],displayMessage:function(m,o,t){var l=o;l.onClose=this.afterMessageClose();this.addMessageToQueue(m,l,t);if(this.aMessageQueue.length==1){if(this.aMessageQueue[0].type==this.messageTypes.messageBox){sap.m.MessageBox.show(this.aMessageQueue[0].message,this.aMessageQueue[0].options);}else if(this.aMessageQueue[0].type==this.messageTypes.messageToast){sap.m.MessageToast.show(this.aMessageQueue[0].message,this.aMessageQueue[0].options);}}},addMessageToQueue:function(m,l,t){this.aMessageQueue.push({message:m,options:l,type:t});},afterMessageClose:function(){var s=this;return function(){s.aMessageQueue.shift();if(s.aMessageQueue.length!=0){if(s.aMessageQueue[0].type==s.messageTypes.messageBox){sap.m.MessageBox.show(s.aMessageQueue[0].message,s.aMessageQueue[0].options);}else if(s.aMessageQueue[0].type==s.messageTypes.messageToast){sap.m.MessageToast.show(s.aMessageQueue[0].message,s.aMessageQueue[0].options);}}};}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.utils.NotificationTypeUtil')){jQuery.sap.declare("sap.collaboration.components.utils.NotificationTypeUtil");sap.ui.base.Object.extend("sap.collaboration.components.utils.NotificationTypeUtil",{map:{AbuseReported:[],AcceptAddedAsAssistant:["SenderFullName"],AcceptAddedAsMgr:["SenderFullName"],AcceptAddedAsReport:["SenderFullName"],AddedAsAssistant:["SenderFullName"],AddedAsMgr:["SenderFullName"],AddedAsReport:["SenderFullName"],AutoGroupAdmin:["SenderFullName"],AutoGroupMember:["SenderFullName"],CommentInDiscussion:["SenderFullName"],CrossCompanyInviteToGroup:["SenderFullName","ObjName"],FeatureInGroup:["SenderFullName"],GoalMigrated:[],GroupContentPendingApproval:[],GroupAccessRequest:["ObjName"],InviteToFollow:["SenderFullName"],InviteToInactiveGroup:["SenderFullName"],InviteToGroup:["SenderFullName"],Like:["SenderFullName"],MarkComment:["SenderFullName"],MarkCommentSimple:["SenderFullName"],MentionInFeed:["SenderFullName"],ReceiveKudoType:["SenderFullName","ObjName"],ReceivedKudo:["SenderFullName","ObjName"],ReceiveKudo:["SenderFullName","ObjName"],RejectAddedAsAssistant:["SenderFullName"],RejectAddedAsMgr:["SenderFullName"],RejectAddedAsReport:["SenderFullName"],ReplyInFeed:["SenderFullName"],RemovedAsAssistant:["SenderFullName"],RemovedAsMgr:["SenderFullName"],RemovedAsReport:["SenderFullName"],RejectPendingContent:["ObjName"],RequestToBeGroupAdmin:["SenderFullName"],SkillNudge:["SenderFullName"],SubscribedToFeed:["SenderFullName"],SuggestTopic:["SenderFullName","ObjName"],send_nudge:["custom_brand_name"],TaskAssigned:["SenderFullName"],TaskNudge:["SenderFullName"],user_new_features:["custom_brand_name"]},getRequiredNotificationPropertyNames:function(n){return this.map[n]?this.map[n]:[];}});};if(!jQuery.sap.isDeclared('sap.collaboration.library')){jQuery.sap.declare("sap.collaboration.library");jQuery.sap.require('sap.ui.core.Core');jQuery.sap.require('sap.ui.core.library');jQuery.sap.require('sap.suite.ui.commons.library');sap.ui.getCore().initLibrary({name:"sap.collaboration",dependencies:["sap.ui.core","sap.suite.ui.commons"],types:["sap.collaboration.AppType","sap.collaboration.FeedType"],interfaces:[],controls:[],elements:[],version:"1.28.1"});jQuery.sap.declare("sap.collaboration.AppType");sap.collaboration.AppType={split:"split",widget:"widget"};jQuery.sap.declare("sap.collaboration.FeedType");sap.collaboration.FeedType={follows:"follows",company:"company",group:"group",objectGroup:"objectGroup",object:"object"};};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.feed.commons.Detail.controller')){jQuery.sap.declare('sap.collaboration.components.fiori.feed.commons.Detail.controller');sap.ui.controller("sap.collaboration.components.fiori.feed.commons.Detail",{onInit:function(){this.sJamToken=this.getView().getViewData().jamToken;this.sJamURL=this.getView().getViewData().jamURL;this.oLangBundle=this.getView().getViewData().langBundle;this.sPrefixId=this.getView().getViewData().controlId;this.oBusinessObject=this.getView().getViewData().businessObject;this.bJamWidgetInitialized=false;if(this.getView().getViewData().appType===sap.collaboration.AppType.split){this.sFeedType=sap.collaboration.FeedType.follows;}else{this.sFeedType=this.getView().getViewData().feedType;this.getView().oDetailPage.setShowHeader(false);}this.oJamUtil=new sap.collaboration.components.utils.JamUtil();},onBeforeRendering:function(){},onAfterRendering:function(){try{this.loadFeedWidget(this.sJamURL);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.onInit()");throw e;}},loadFeedWidget:function(j){var s=this;try{var g=s.getView().getViewData().groupIds;var w=this.oJamUtil.prepareWidgetData(s.sJamToken,s.sFeedType,g,s.oBusinessObject);var l=function(r){jQuery.sap.log.info("Jam Feed Widget Loaded Successfully","sap.collaboration.components.fiori.feed.commons.Detail.onInit()");s.oJamUtil.initializeJamWidget(s.sJamURL);s.bJamWidgetInitialized=true;s.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);};var L=function(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.loadFeedWidgetScript()");throw e;};if(this.bJamWidgetInitialized===false){this.oJamUtil.loadFeedWidgetScript(j,l,L);}else{this.oJamUtil.createJamWidget(s.sPrefixId+"widgetContainer",w);}}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.commons.Detail.loadFeedWidgetScript()");throw e;}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.notification.Notification.view')){jQuery.sap.declare('sap.collaboration.components.fiori.notification.Notification.view');sap.ui.jsview("sap.collaboration.components.fiori.notification.Notification",{getControllerName:function(){return"sap.collaboration.components.fiori.notification.Notification";},createContent:function(c){this.sPrefixId=this.getViewData().controlId;this.oLangBundle=this.getViewData().langBundle;this.sStyleClassPrefix=this.getViewData().styleClassPrefix;this.iNumberOfNotifications=this.getViewData().numberOfNotifications;this.sNotificationsTargetURL=this.getViewData().notificationsTargetUrl;var C=this.createContainerBox();return C;},createContainerBox:function(){var s=this;this.aProfilePhotos=this.createProfilePhotos();this.oNotificationTypeText=this.createNotificationTypeText();this.oNotificationMessageText=this.createNotificationMessageText();var n=this.createNotificationUnreadCountVBox();var a=this.createNotificationAgeAndGroupVBox();var c=new sap.collaboration.components.fiori.notification.NotificationContainer(this.sPrefixId+"_ContainerBox",{styleClassPrefix:this.sStyleClassPrefix});for(var i=0;i<this.aProfilePhotos.length;++i){c.addContent(this.aProfilePhotos[i]);}c.addContent(this.oNotificationTypeText);c.addContent(this.oNotificationMessageText);c.addContent(n);c.addContent(a);return c;},createProfilePhotos:function(){var p=[];for(var i=0;i<this.iNumberOfNotifications;++i){p.push(new sap.m.Image(this.sPrefixId+"_ProfileImage"+i,{densityAware:false,decorative:true}).addStyleClass(this.sStyleClassPrefix+"ProfileImage").addStyleClass(this.sStyleClassPrefix+"ProfileImageHidden").addStyleClass(this.sStyleClassPrefix+"CursorPointer"));}return p;},createNotificationTypeText:function(){return new sap.m.Text(this.sPrefixId+"_NotificationType").addStyleClass(this.sStyleClassPrefix+"NotificationTypeText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationMessageText:function(){return new sap.m.Text(this.sPrefixId+"_NotificationMessage").addStyleClass(this.sStyleClassPrefix+"NotificationMessageText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationUnreadCountText:function(){return new sap.m.Text(this.sPrefixId+"_NotificationUnreadCount").addStyleClass(this.sStyleClassPrefix+"NotificationUnreadCountText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationNewNotificationOrErrorText:function(){return new sap.m.Text(this.sPrefixId+"_NewNotificationOrErrorText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");},createNotificationUnreadCountVBox:function(){this.oNotificationUnreadCountText=this.createNotificationUnreadCountText();this.oNotificationNewNotificationOrErrorText=this.createNotificationNewNotificationOrErrorText();var n=new sap.m.VBox(this.sPrefixId+"_UnreadCountVBox",{items:[this.oNotificationUnreadCountText,this.oNotificationNewNotificationOrErrorText]}).addStyleClass(this.sStyleClassPrefix+"NotificationUnreadContainer");return n;},createNotificationAgeAndGroupVBox:function(){this.oNotificationAgeText=new sap.m.Text(this.sPrefixId+"_NotificationAge",{textAlign:sap.ui.core.TextAlign.Right,}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");this.oNotificationGroupText=new sap.m.Text(this.sPrefixId+"_NotificationGroup",{textAlign:sap.ui.core.TextAlign.Right,}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupText").addStyleClass(this.sStyleClassPrefix+"CursorPointer");var a=new sap.m.VBox(this.sPrefixId+"_AgeAndGroupVBox",{items:[this.oNotificationAgeText,this.oNotificationGroupText]}).addStyleClass(this.sStyleClassPrefix+"NotificationAgeAndGroupContainer");return a;},ontap:function(){window.open(this.sNotificationsTargetURL,window.name);}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.attachment.Attachment')){jQuery.sap.declare("sap.collaboration.components.fiori.sharing.attachment.Attachment");sap.ui.base.Object.extend("sap.collaboration.components.fiori.sharing.attachment.Attachment",{constructor:function(n,m,u){if(arguments.length===3&&Object.prototype.toString.call(n)==="[object String]"&&Object.prototype.toString.call(m)==="[object String]"&&Object.prototype.toString.call(u)==="[object String]"){this.name=n;this.mimeType=m;this.url=u;}else{throw new sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentConstructorArgumentsException();}},getName:function(){return this.name;},getMimeType:function(){return this.mimeType;},getUrl:function(){return this.url;},setName:function(n){if(arguments.length===1&&Object.prototype.toString.call(n)==="[object String]"){this.name=n;}else{throw new sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException("name");}},setMimeType:function(m){if(arguments.length===1&&Object.prototype.toString.call(m)==="[object String]"){this.mimeType=m;}else{throw new sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException("mimeType");}},setUrl:function(u){if(arguments.length===1&&Object.prototype.toString.call(u)==="[object String]"){this.url=u;}else{throw new sap.collaboration.components.fiori.sharing.attachment.InvalidAttachmentParameterException("url");}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.utils.CommonUtil')){jQuery.sap.require('sap.m.MessageBox');jQuery.sap.declare("sap.collaboration.components.utils.CommonUtil");sap.ui.base.Object.extend("sap.collaboration.components.utils.CommonUtil",{constructor:function(){this.MessageQueueUtil=new sap.collaboration.components.utils.MessageQueueUtil();},getLanguageBundle:function(){if(!this.oLangBundle){jQuery.sap.require("jquery.sap.resources");var l=sap.ui.getCore().getConfiguration().getLanguage();this.oLangBundle=jQuery.sap.resources({url:jQuery.sap.getModulePath("sap.collaboration.components")+"/resources/i18n/messagebundle.properties",locale:l});}return this.oLangBundle;},displayError:function(e){var s=this;var m="";var o={icon:sap.m.MessageBox.Icon.ERROR,title:s.getLanguageBundle().getText("SYSTEM_ERROR_MESSAGEBOX_TITLE")};if(!e||e===""){m=s.getLanguageBundle().getText("SYSTEM_ERROR_MESSAGEBOX_GENERAL_TEXT");}else{m=e;}this.MessageQueueUtil.displayMessage(m,o,"MBox");},showMessage:function(m,o){this.MessageQueueUtil.displayMessage(m,o,"MToast");},isValidDate:function(d){if(Object.prototype.toString.call(d)!=="[object Date]"||isNaN(d.getTime())){jQuery.sap.log.error("DateUtils invalid date="+d);return false;}return true;},formatDateToString:function(d){var D=sap.ui.core.format.DateFormat.getDateInstance({style:"short",relative:true},sap.ui.getCore().getConfiguration().getLocale());var t=sap.ui.core.format.DateFormat.getTimeInstance({style:"short"},sap.ui.getCore().getConfiguration().getLocale());var s=D.format(d)+" at "+t.format(d);var p=/[A-Za-z]/;if(s.charAt(0).match(p)){s=s.charAt(0).toUpperCase()+s.slice(1);}return s;},getIconFromMimeType:function(v){var i="";if(!v){return"sap-icon://document";}if(v.indexOf('image')===0){i="sap-icon://attachment-photo";}else if(v.indexOf('video')===0){i="sap-icon://attachment-video";}else if(v.indexOf('text')===0){i="sap-icon://attachment-text-file";}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio";}else if(v.indexOf('audio')===0){i="sap-icon://attachment-audio";}else if(v.indexOf('application')===0){switch(v){case'application/vnd.openxmlformats-officedocument.presentationml.presentation':case'application/vnd.ms-powerpoint':case'application/vnd.openxmlformats-officedocument.presentationml.template':i="sap-icon://ppt-attachment";break;case'application/msword':case'application/vnd.openxmlformats-officedocument.wordprocessingml.document':case'application/vnd.openxmlformats-officedocument.wordprocessingml.template':i="sap-icon://doc-attachment";break;case'application/vnd.ms-excel':case'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':case'application/vnd.openxmlformats-officedocument.spreadsheetml.template':i="sap-icon://excel-attachment";break;case'application/pdf':i="sap-icon://pdf-attachment";break;case'application/xhtml+xml':i="sap-icon://attachment-html";break;case'application/zip':case'application/gzip':i="sap-icon://attachment-zip-file";break;default:i="sap-icon://document";}}else{i="sap-icon://document";}return i;},areArraysEqual:function(a,b){var o=function(x,y){var o=true;for(var p in x){if(x[p]!==y[p]){o=false;break;}}return o;};if(a.length!==b.length){return false;}for(var i=0;i<a.length;i++){if(!o(a[i],b[i])){return false;}}return true;},b64toBlob:function(b,c,s){c=c||'';s=s||512;var a=window.atob(b);var d=[];for(var o=0;o<a.length;o+=s){var e=a.slice(o,o+s);var f=new Array(e.length);for(var i=0;i<e.length;i++){f[i]=e.charCodeAt(i);}var g=new window.Uint8Array(f);d.push(g);}var h=new window.Blob(d,{type:c});return h;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.utils.OdataUtil')){jQuery.sap.declare("sap.collaboration.components.utils.OdataUtil");sap.ui.base.Object.extend("sap.collaboration.components.utils.OdataUtil",{OdataUtilConstants:{HttpStatusCode:{success:200,created:201},EndPoint:{AssignedGroups:"AssignedGroups",BusinessObjects:"BusinessObjects",ContentItems:"ContentItems",PostContentItem:"PostContentItem",Feed:"Feed",Folders:"Folders",GetCollaborationHostUrl:"GetCollaborationHostURL",MapInternalBOToExternalBO:"MapInternalBOToExternalBO",GetExternalODataURL:"GetExternalODataURL",GetSingleUseToken:"GetSingleUseToken",Groups:"Groups",GroupsCount:"Groups/$count",GetNotificationUnreadCount:"GetNoticeUnreadCount",Notifications:"Notices",FeaturedExternalObjects:"FeaturedExternalObjects",GroupsAsFeatured:"GroupsAsFeatured",ExternalObjects:"ExternalObjects",Activities:"Activities",ExternalObjects_FindByExidAndObjectType:"ExternalObjects_FindByExidAndObjectType"},HttpMethod:{GET:"GET",POST:"POST"},ResponseType:{blob:"blob",arraybuffer:"arraybuffer"}},constructor:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.bError=false;},getJamUrl:function(o,p,a){var e="";var j="";var s=function(d,r){if(p){p.resolve(d.GetCollaborationHostURL.URL);}else{j=d.GetCollaborationHostURL.URL;}};var E=function(b){jQuery.sap.log.error(JSON.stringify(b));e=b.response.statusCode;if(p){p.reject(e);}};o.read("/"+this.OdataUtilConstants.EndPoint.GetCollaborationHostUrl,{success:s,error:E,async:a});if(!p){return j;}},createJamUrlBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetCollaborationHostUrl,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createJamUrlBatchOperation()");throw e;}return b;},getJamToken:function(o){var j="";var e="";var s=function(d,r){j=d.GetSingleUseToken.Id;};var E=function(a){jQuery.sap.log.error(JSON.stringify(a));e=a.response.statusCode;};o.read("/"+this.OdataUtilConstants.EndPoint.GetSingleUseToken,null,null,false,s,E);if(e){throw new Error(e);}return j;},createJamTokenBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetSingleUseToken,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createJamTokenBatchOperation()");throw e;}return b;},getGroupsData:function(o,O){var g;var e="";var s=function(d,r){g=d.results;};var E=function(a){jQuery.sap.log.error(JSON.stringify(a));e=a.response.statusCode;};o.read(O,null,null,false,s,E);if(e){throw new Error(e);}return g;},createGetGroupsDataBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.Groups,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetGroupsDataBatchOperation()");throw e;}return b;},createGetGroupsCountBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GroupsCount,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetGroupsCountDataBatchOperation()");throw e;}return b;},createGetGroupsLinkedToBOBatchOperation:function(o,e){var d=null;var p=null;var b;var O="/"+this.OdataUtilConstants.EndPoint.ExternalObjects+"(ApplicationContext='"+jQuery.sap.encodeURL(e.appContext.replace(/'/g,"''"))+"',"+"OdataServicePath='"+jQuery.sap.encodeURL(e.odataServicePath.replace(/'/g,"''"))+"',"+"OdataCollection='"+jQuery.sap.encodeURL(e.collection.replace(/'/g,"''"))+"',"+"OdataKey='"+jQuery.sap.encodeURL(e.key.replace(/'/g,"''"))+"')/"+this.OdataUtilConstants.EndPoint.GroupsAsFeatured;b=o.createBatchOperation(O,this.OdataUtilConstants.HttpMethod.GET,d,p);return b;},createGetObjectGroupsBatchOperation:function(o,b){var d=null;var p=null;var B;try{B=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.BusinessObjects+"('"+jQuery.sap.encodeURL(b)+"')/"+this.OdataUtilConstants.EndPoint.AssignedGroups,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGetObjectGroupsBatchOperation()");throw e;}return B;},getGroupIds:function(g){var G="";for(var i=0;i<g.length;i++){if(i==0){G+=g[i].Id;}else{G+=","+g[i].Id;}}return G;},createGroupFeed:function(o,g,f){var O="/"+this.OdataUtilConstants.EndPoint.Groups+"("+jQuery.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.Feed;var p={"Text":f};var s=undefined;var S=function(){s=true;};var e=function(E){jQuery.sap.log.error(JSON.stringify(E.response.body));s=false;};o.create(O,p,null,S,e);return s;},executeODataBatchRequest:function(o,r,p,a,e){var s=this;var R;var S=function(d){R=s.parseBatchResponse(d.__batchResponses);p(R);};var E=function(d){if(d.response){jQuery.sap.log.error(JSON.stringify(d.response.body));}else{jQuery.sap.log.error(JSON.stringify(d.message));}e(d);};var b=[];var c=[];for(var i in r){if(r[i].method==this.OdataUtilConstants.HttpMethod.GET){b.push(r[i]);}else if(r[i].method==this.OdataUtilConstants.HttpMethod.POST){c.push(r[i]);}}if(b.length>0){o.addBatchReadOperations(b);}for(var i=0;i<c.length;i++){o.addBatchChangeOperations([c[i]]);}if(a===true){o.submitBatch(S,E,true);}else{o.submitBatch(S,E,false);}},parseBatchResponse:function(b){var s=this;var r=[];jQuery.sap.each(b,function(i,R){if(R.statusCode&&R.statusCode.match(s.OdataUtilConstants.HttpStatusCode.success)){r.push(R.data);}else if(R.__changeResponses){for(var i=0;i<R.__changeResponses.length;i++){if(R.__changeResponses[i].statusCode&&(R.__changeResponses[i].statusCode.match(s.OdataUtilConstants.HttpStatusCode.created)||R.__changeResponses[i].statusCode.match(s.OdataUtilConstants.HttpStatusCode.success))){r.push(R.__changeResponses[i].data);}else{r.push({error:R.__changeResponses[i].response.body});jQuery.sap.log.error(JSON.stringify(R.__changeResponses[i].response.body),"sap.collaboration.components.utils.OdataUtil.parseBatchResponse()");}}}else{r.push({error:R.response.body});jQuery.sap.log.error(JSON.stringify(R.response.body),"sap.collaboration.components.utils.OdataUtil.parseBatchResponse()");}});return r;},createExternalOdataUrlBatchOperation:function(o,r){var p=null;var d=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetExternalODataURL+"/?RelativePath='"+jQuery.sap.encodeURL(r)+"'",this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createExternalOdataUrlBatchOperation()");throw e;}return b;},getExternalOdataUrl:function(o,r){var e="";var E="";var u={};u["RelativePath"]="'"+r+"'";var s=function(d,a){e=d.GetExternalODataURL.URL;};var f=function(a){jQuery.sap.log.error(JSON.stringify(a));E=a.response.statusCode;};o.read("/"+this.OdataUtilConstants.EndPoint.GetExternalODataURL,null,u,false,s,f);if(E){throw new Error(E);}return e;},createNotificationUnreadCountBatchOperation:function(o){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.GetNotificationUnreadCount,this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createNotificationUnreadCountBatchOperation()");throw e;}return b;},createNotificationBatchOperation:function(o,n){var d=null;var p=null;var b;try{b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.Notifications+"?$top="+jQuery.sap.encodeURL(n.toString()),this.OdataUtilConstants.HttpMethod.GET,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createNotificationBatchOperation()");throw e;}return b;},createGroupFeedBatchOperation:function(o,g,f){var O="/"+this.OdataUtilConstants.EndPoint.Groups+"("+jQuery.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.Feed;var d={"Text":f.note,"UiUrl":f.uiUrl};var p=null;var b;try{b=o.createBatchOperation(O,this.OdataUtilConstants.HttpMethod.POST,d,p);}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.utils.OdataUtil.createGroupFeedBatchOperation()");throw e;}return b;},createUploadFileBatchOperation:function(o,a,g,f){var d=null;var p=null;var b;b=o.createBatchOperation("/"+this.OdataUtilConstants.EndPoint.PostContentItem+"/?name='"+jQuery.sap.encodeURL(a.name)+"'&"+"groupId='"+jQuery.sap.encodeURL(g)+"'&"+"mimeType='"+jQuery.sap.encodeURL(a.mimeType)+"'&"+"folderId='"+jQuery.sap.encodeURL(f)+"'&"+"url='"+jQuery.sap.encodeURL(a.url)+"'",this.OdataUtilConstants.HttpMethod.POST,d,p);return b;},uploadFile:function(o,a,g,f,s,e,A){var O=this.OdataUtilConstants.EndPoint.PostContentItem;var u=function(){s();};var U=function(){jQuery.sap.log.error(a.name+" was not uploaded","","sap.collaboration.components.utils.OdataUtil.uploadFile()");e();};o.callFunction(O,'POST',{name:a.name,groupId:g,mimeType:a.mimeType,url:a.url,folderId:f},null,u,U,A);},getSubFolders:function(o,g,f,s,t){var O;if(!f&&g){O="/"+this.OdataUtilConstants.EndPoint.Groups+"('"+jQuery.sap.encodeURL(g)+"')/"+this.OdataUtilConstants.EndPoint.Folders;}else{O="/"+this.OdataUtilConstants.EndPoint.Folders+"(Id='"+jQuery.sap.encodeURL(f)+"',FolderType='Folder')/"+this.OdataUtilConstants.EndPoint.Folders;}O=O+'?$skip='+s+'&$top='+t+'&$inlinecount=allpages';var F=[];var c=0;var e="";var S=function(d,r){if(d){F=d.results;c=parseInt(JSON.parse(r.body).d.__count);}};var E=function(a){jQuery.sap.log.error(JSON.stringify(a));e=a.response.statusCode;};o.read(O,null,null,false,S,E);if(e){throw new Error(e);}return{folders:F,count:c};},createShareFeaturedObjectBatchOperation:function(o,e,g){var O="/"+this.OdataUtilConstants.EndPoint.Groups+"("+jQuery.sap.encodeURL(g)+")/"+this.OdataUtilConstants.EndPoint.FeaturedExternalObjects;var d={"ApplicationContext":e.appContext,"OdataServicePath":e.odataServicePath,"OdataCollection":e.collection,"OdataKey":e.key,"Name":e.name,"Summary":e.summary,"UiUrl":e.uiUrl,"Comment":e.note};var p=null;var b;b=o.createBatchOperation(O,this.OdataUtilConstants.HttpMethod.POST,d,p);return b;},getExternalObjectMapping:function(o,i,p){var O="/"+this.OdataUtilConstants.EndPoint.MapInternalBOToExternalBO;var u={};u["ApplicationContext"]="'"+i.appContext+"'";u["ODataCollection"]="'"+i.collection+"'";u["ODataKeyPredicate"]="'"+i.key+"'";u["ODataServicePath"]="'"+i.odataServicePath+"'";var e="";var s=function(d,r){p.resolve(d.MapInternalBOToExternalBO);};var E=function(a){jQuery.sap.log.error(JSON.stringify(a));e=a.response.statusCode;p.reject(e);};o.read(O,null,u,true,s,E);},_GetJamExternalObject:function(o,e,E,s,f){var O="/"+this.OdataUtilConstants.EndPoint.ExternalObjects_FindByExidAndObjectType+"/?Exid='"+jQuery.sap.encodeURL(e)+"'&"+"ObjectType='"+jQuery.sap.encodeURL(E);var S=function(){s();};var a=function(b){jQuery.sap.log.error(JSON.stringify(b.response.body));f();};o.read(O,null,null,false,S,a);}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.feed.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.declare("sap.collaboration.components.fiori.feed.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.feed.Component",{metadata:{properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:""},height:{type:"sap.ui.core.CSSSize",defaultValue:""},oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_SRV"},feedType:{type:"string"},groupIds:{type:"string"},object:{type:"object"}},aggregations:{},events:{}},init:function(){this.CollaborationFeedConstants={defaultWidth:'100%',defaultHeight:'100%'};this.setWidth(this.CollaborationFeedConstants.defaultWidth);this.setHeight(this.CollaborationFeedConstants.defaultHeight);this.mode=sap.collaboration.AppType.widget;this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();sap.ui.core.UIComponent.prototype.init.apply(this);},setSettings:function(s){this.setODataServiceUrl(s.oDataServiceUrl);this.setFeedType(s.feedType);this.setGroupIds(s.groupIds);this.setObject(s.object);},onBeforeRendering:function(){var a=true;try{this.bStopRendering=false;this.validateInputParameters();this.sODataServiceUrl=this.getODataServiceUrl();if(!this.oOdataModel){this.oOdataModel=new sap.ui.model.odata.ODataModel(this.sODataServiceUrl,a);}}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.onBeforeRendering()");this.bStopRendering=true;this.oCommonUtil.displayError(e);}if(sap.ui.getCore().byId(this.getId()+"_oAppView")){sap.ui.getCore().byId(this.getId()+"_oAppView").destroy();}if(sap.ui.getCore().byId(this.getId()+"_oSplitAppView")){sap.ui.getCore().byId(this.getId()+"_oSplitAppView").destroy();}},onAfterRendering:function(){if(!this.bStopRendering){jQuery.sap.log.debug("Feed Component properties:","","sap.collaboration.components.fiori.feed.Component.onAfterRendering()");jQuery.sap.log.debug("width: "+this.getWidth());jQuery.sap.log.debug("height: "+this.getHeight());jQuery.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());jQuery.sap.log.debug("feedType: "+this.getFeedType());jQuery.sap.log.debug("groupIds: "+this.getGroupIds());jQuery.sap.log.debug("object: "+JSON.stringify(this.getObject()));try{if(this.getMode()===sap.collaboration.AppType.widget){var a=sap.ui.view({id:this.getId()+"_oAppView",viewData:{controlId:this.getId(),odataModel:this.oOdataModel,appType:this.getMode(),feedType:this.getFeedType(),groupIds:this.getGroupIds(),object:this.getObject(),langBundle:this.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.app.App"});a.placeAt(this.getId());}else if(this.getMode()===sap.collaboration.AppType.split){var s=sap.ui.view({id:this.getId()+"_oSplitAppView",viewData:{controlId:this.getId(),odataModel:this.oOdataModel,appType:this.getMode(),object:this.getObject(),langBundle:this.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.splitApp.SplitApp"});s.placeAt(this.getId());}}catch(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.onAfterRendering()");this.oCommonUtil.displayError(e);}}},render:function(r){r.write("<div id='"+this.getId()+"' style='width:"+this.getWidth()+";height:"+this.getHeight()+"'");r.write(">");r.write("</div>");},getMode:function(){return this.mode;},validateInputParameters:function(){var e;if(this.getFeedType()==sap.collaboration.FeedType.object||this.getFeedType()==sap.collaboration.FeedType.objectGroup){if(!this.getObject()){e=new Error("Object is undefined or null");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}else if(!this.getObject().id){e=new Error("Missing Object ID");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}}if(this.getFeedType()==sap.collaboration.FeedType.object){if(!this.getObject().type){e=new Error("Missing Object Type");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.Component.validateInputParameters()");throw e;}}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.feed.dialog.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.declare("sap.collaboration.components.fiori.feed.dialog.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.feed.dialog.Component",{metadata:{includes:["../../../resources/css/Sharing.css"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"575px"},height:{type:"sap.ui.core.CSSSize",defaultValue:"605px"},feedType:{type:"string",defaultValue:sap.collaboration.FeedType.object},groupIds:{type:"string"},object:{type:"object"},businessObject:{type:"object"}},aggregations:{},events:{}},systemSettings:{oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",oCollaborationHostRestService:"/sap/bc/ui2/smi/rest_tunnel/Jam//v1",oCollaborationHostODataService:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData"},init:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oJamUtil=new sap.collaboration.components.utils.JamUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sJamUrl=undefined;this.sJamToken=undefined;this.oOdataModel=undefined;this.oODataUtil=undefined;this.oBusinessObject={};sap.ui.core.UIComponent.prototype.init.apply(this);},setSettings:function(s){if(s){this.setFeedType(s.feedType);this.setGroupIds(s.groupIds);this.setObject(s.object);this.setBusinessObject(s.businessObject);}else{var e=new Error("Settings object is undefined");jQuery.sap.log.error(e.stack);}},open:function(){this._logComponentProperties();try{this._validateInputParameters(this.mProperties);this._createFeedDialog();this._requestWidgetData();this.oFeedDialog.open();}catch(e){jQuery.sap.log.error(e.stack);this.oCommonUtil.displayError();}},onBeforeRendering:function(){},onAfterRendering:function(){},render:function(r){},_requestWidgetData:function(){var c=this._getCSRFToken();var s=this;var a=true;var C=this.systemSettings.oCollaborationHostRestService;this._initOData();if(this.getObject()){this._getObjectWithoutMapping();}else if(this.getBusinessObject()){this._getObjectWithMapping();}var A=function(){if(this.readyState==4){if(this.status==201){s.sJamToken=this.responseXML.getElementsByTagName('single_use_token')[0].attributes[0].value;if(s.sJamUrl&&s.oBusinessObject.odata_url&&s.oBusinessObject.metadata_url){s._createFeedView();s.oFeedDialog.addContent(s.oFeedView);setTimeout(function(){s.oFeedDialog.setBusy(false);},3000);}}else{var e="The single use token from SAP Jam was not returned successfully";jQuery.sap.log.error(e,"","sap.collaboration.components.utils.JamUtil.getJamSinglelUseTokens()");if(s.oFeedDialog.isOpen()===true){s.oFeedDialog.close();}s.oCommonUtil.displayError();}}};this.oJamUtil.getJamSinglelUseTokens(C,A,a,c);},_getObjectWithoutMapping:function(){var s=this;var a=true;var b=[];var p=function(c){s._parseBatchResults(c);if(s.sJamToken){s._createFeedView();s.oFeedDialog.addContent(s.oFeedView);setTimeout(function(){s.oFeedDialog.setBusy(false);},3000);}};var B=function(e){jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component._getObjectWithoutMapping(), fnBatchErrorCallback()");throw e;};b=this._createBatchRequests();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,b,p,a,B);},_getObjectWithMapping:function(){var s=this;var g=new jQuery.Deferred();g.done(function(j){s.sJamUrl=j;});var a=new jQuery.Deferred();a.done(function(m){s._setMappedObject(m);});jQuery.when(g,a).fail(function(S){if(s.oFeedDialog&&s.oFeedDialog.isOpen()){s.oFeedDialog.close();}s.oCommonUtil.displayError();});this.oODataUtil.getJamUrl(this.oOdataModel,g);this.oODataUtil.getExternalObjectMapping(this.oOdataModel,this.getBusinessObject(),a);},_setMappedObject:function(m){var s=this;this.oBusinessObject.id=m.Exid;this.oBusinessObject.type=m.ObjectType;this.oBusinessObject.odata_url=this.oBusinessObject.id;this.oBusinessObject.metadata_url=this.oBusinessObject.type;if(this.sJamToken){this._createFeedView();this.oFeedDialog.addContent(this.oFeedView);setTimeout(function(){s.oFeedDialog.setBusy(false);},3000);}},_initOData:function(){var a=true;var o=this.systemSettings.oDataServiceUrl;if(!this.oOdataModel){this.oOdataModel=new sap.ui.model.odata.ODataModel(o,a);}if(!this.oOdataModel.oMetadata.oMetadata){var e=new Error("Metadata is undefined");jQuery.sap.log.error(e,"","sap.collaboration.components.fiori.feed.dialog.Component._requestWidgetData()");throw e;}if(!this.oODataUtil){this.oODataUtil=new sap.collaboration.components.utils.OdataUtil();}},_getCSRFToken:function(){var c="";var C=this.systemSettings.oCollaborationHostODataService;var a=function(d){if(this.readyState==4){if(this.status==200){c=this.getResponseHeader('x-csrf-token');}}};this.oJamUtil.getCSRFToken(C,a,false);return c;},_createBatchRequests:function(){var s=this;var b=[];if(!s.sJamUrl){b.push(s.oODataUtil.createJamUrlBatchOperation(s.oOdataModel));}b=b.concat(s._createExternalUrlBatchRequest(s.oODataUtil,s.getObject()));return b;},_createExternalUrlBatchRequest:function(o,b){var s=this;var B=[];if(o&&b){if(b.id){B.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,b.id));}if(b.type){B.push(o.createExternalOdataUrlBatchOperation(s.oOdataModel,b.type));}}return B;},_parseBatchResults:function(b){var s=this;var i=0;if(!s.sJamUrl){if(b[i].error){throw new Error(b[i].error);}else{s.sJamUrl=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetCollaborationHostUrl].URL;}i++;}if(b[i].error){throw new Error(b[i].error);}else{s.oBusinessObject.id=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.odata_url=s.oBusinessObject.id;}i++;if(b[i].error){throw new Error(b[i].error);}else{s.oBusinessObject.type=b[i][s.oODataUtil.OdataUtilConstants.EndPoint.GetExternalODataURL].URL;s.oBusinessObject.metadata_url=s.oBusinessObject.type;}},_createFeedView:function(){var s=this;if(!s.oFeedView){s.oFeedView=sap.ui.view({id:s.getId()+"_FeedView",height:"100%",viewData:{controlId:s.getId(),jamURL:s.sJamUrl,jamToken:s.sJamToken,appType:sap.collaboration.AppType.widget,feedType:s.getFeedType(),groupIds:s.getGroupIds(),businessObject:s.oBusinessObject,langBundle:s.oLangBundle},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.feed.commons.Detail"});}else{s.oFeedView.getController().sFeedType=s.getFeedType();s.oFeedView.getViewData().groupIds=s.getGroupIds();s.oFeedView.getController().oBusinessObject=s.oBusinessObject;}},_createFeedDialog:function(){var s=this;if(!this.oFeedDialog){this.oFeedDialog=new sap.m.Dialog(this.getId()+"FeedDialog",{title:this.oLangBundle.getText("FEED_DIALOG_TITLE"),stretch:false,contentWidth:this.getWidth(),contentHeight:this.getHeight(),content:[],endButton:new sap.m.Button({text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){s.oFeedDialog.close();}})});if(sap.ui.Device.system.phone){this.oFeedDialog.setStretch(true);}}this.oFeedDialog.setBusy(true);},_validateInputParameters:function(i){var e;if(!i){e=new Error("Input paremeters are undefined");jQuery.sap.log.error(e.stack);throw e;}else if(i.businessObject){var b=i.businessObject;if(jQuery.isEmptyObject(b)){e=new Error("Business Object is empty");jQuery.sap.log.error(e.stack);throw e;}if(!b.appContext){e=new Error("Application context is undefined");jQuery.sap.log.error(e.stack);throw e;}if(!b.odataServicePath){e=new Error("OData Service Path is undefined");jQuery.sap.log.error(e.stack);throw e;}if(!b.collection){e=new Error("Collection is undefined");jQuery.sap.log.error(e.stack);throw e;}if(!b.key){e=new Error("Key is undefined");jQuery.sap.log.error(e.stack);throw e;}if(!b.name){e=new Error("Name is undefined");jQuery.sap.log.error(e.stack);throw e;}}else if(i.object){var o=i.object;if(jQuery.isEmptyObject(o)){e=new Error("Business Object is empty");jQuery.sap.log.error(e.stack);throw e;}if(!o.id){e=new Error("Object is undefined");jQuery.sap.log.error(e.stack);throw e;}if(!o.type){e=new Error("Missing Object Type");jQuery.sap.log.error(e.stack);throw e;}}else{e=new Error("Neither an Object nor a Business Object was passed");throw e;}},_logComponentProperties:function(){jQuery.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.dialog.Component._logComponentProperties()");jQuery.sap.log.debug("width: "+this.getWidth());jQuery.sap.log.debug("height: "+this.getHeight());jQuery.sap.log.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);jQuery.sap.log.debug("feedType: "+this.getFeedType());jQuery.sap.log.debug("groupIds: "+this.getGroupIds());jQuery.sap.log.debug("object: "+JSON.stringify(this.getObject()));jQuery.sap.log.debug("businessObject: "+JSON.stringify(this.getBusinessObject()));}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.notification.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.require('sap.ui.commons.Button');jQuery.sap.declare("sap.collaboration.components.fiori.notification.Component");jQuery.sap.require('sap.m.MessageBox');sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.notification.Component",{metadata:{properties:{oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_SRV"},numberOfNotifications:{type:"int",defaultValue:10},transitionInterval:{type:"int",defaultValue:10},refreshInterval:{type:"int",defaultValue:300},notificationsTargetUrl:{type:"sap.ui.core.URI"}}},init:function(){this.iMillisecondsPerSecond=1000;this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sStyleClassPrefix="sapClbNotif";},onBeforeRendering:function(){},onAfterRendering:function(){jQuery.sap.log.debug("Notification Component properties:",this.mProperties.toString(),"sap.collaboration.components.fiori.notification.Component.onAfterRendering()");jQuery.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());jQuery.sap.log.debug("numberOfNotifications: "+this.getNumberOfNotifications());jQuery.sap.log.debug("transitionInterval: "+this.getTransitionInterval());jQuery.sap.log.debug("refreshInterval: "+this.getRefreshInterval());jQuery.sap.log.debug("notificationsTargetUrl: "+this.getNotificationsTargetUrl());if(!this.oNotificationView){this.oNotificationView=sap.ui.view({id:this.getId()+"_NotificationView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,oDataServiceUrl:this.getODataServiceUrl(),numberOfNotifications:this.getNumberOfNotifications(),transitionInterval:this.getTransitionInterval()*this.iMillisecondsPerSecond,refreshInterval:this.getRefreshInterval()*this.iMillisecondsPerSecond,notificationsTargetUrl:this.getNotificationsTargetUrl(),styleClassPrefix:this.sStyleClassPrefix},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.notification.Notification"});}this.oNotificationView.placeAt(this.getId());},exit:function(){this.deactivateNotificationRefreshAndTransition();this.oNotificationView.destroy();},render:function(r){r.write("<div id='"+this.getId()+"'");r.addClass(this.sStyleClassPrefix+"Component");r.addClass(this.sStyleClassPrefix+"CursorPointer");r.writeClasses();r.write(">");r.write("</div>");},deactivateNotificationRefreshAndTransition:function(){this.oNotificationView.getController().deactivateNotificationTransition();this.oNotificationView.getController().deactivateNotificationRefresh();}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.notification.Notification.controller')){jQuery.sap.declare('sap.collaboration.components.fiori.notification.Notification.controller');sap.ui.controller("sap.collaboration.components.fiori.notification.Notification",{onInit:function(){this.initializeRefreshAndTransitionState();this.sPrefixId=this.getView().getViewData().controlId;this.oView=this.getView();this.oLangBundle=this.oView.oLangBundle;this.sOdataServiceUrl=this.getView().getViewData().oDataServiceUrl;this.iTransitionInterval=this.getView().getViewData().transitionInterval;this.iRefreshInterval=this.getView().getViewData().refreshInterval;this.sProfilePhotoHiddenStyleClass=this.oView.sStyleClassPrefix+"ProfileImageHidden";this.sLoadingAnimationDummyTextStyleClass=this.oView.sStyleClassPrefix+"LoadingText";this.sNewNotificationTextStyleClass=this.oView.sStyleClassPrefix+"NewNotificationText";this.sErrorTextStyleClass=this.oView.sStyleClassPrefix+"ErrorText";this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sLoadingAnimationDummyTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(". . . . . . . . . . . .");this.oView.oNotificationNewNotificationOrErrorText.setBusy(true);this.oNotificationTypeUtil=new sap.collaboration.components.utils.NotificationTypeUtil();},initializeRefreshAndTransitionState:function(){this.bErrorInUnreadCountODataResponse=true;this.bErrorInNoticesODataResponse=true;this.bErrorInODataResponse=true;this.iNotificationCurrentIndex=undefined;this.iNotificationPreviousIndex=undefined;this.aNotifications=undefined;this.bIsTransitionActive=false;this.iNotificationsTransitionCallbackRegistrationId=undefined;this.bIsRefreshActive=false;this.iNotificationsRefreshCallbackRegistrationId=undefined;this.iNotificationUnreadCount=undefined;this.iMaxNotificationsToDisplay=this.getView().getViewData().numberOfNotifications;this.aImageControls=this.getView().getViewData().aProfilePhotos;this.iNotificationsToDisplay=undefined;this.aUsedImageControls=[];},onBeforeRendering:function(){this.initializeCommonUtil();this.initializeOdataModel();this.initializeOdataUtils();},onAfterRendering:function(){this.fetchNotificationData();},initializeOdataModel:function(){var a=true;this.oOdataModel=new sap.ui.model.odata.ODataModel(this.sOdataServiceUrl,a);},initializeOdataUtils:function(){this.oODataUtil=new sap.collaboration.components.utils.OdataUtil();},initializeCommonUtil:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();},fetchNotificationData:function(){var r=[];var n=this.oODataUtil.createNotificationUnreadCountBatchOperation(this.oOdataModel);var N=this.oODataUtil.createNotificationBatchOperation(this.oOdataModel,this.iMaxNotificationsToDisplay);r.push(n);r.push(N);var p=this.getFunctionParseResult();var e=this.getFunctionErrorCallBack();this.oODataUtil.executeODataBatchRequest(this.oOdataModel,r,p,true,e);},getFunctionParseResult:function(){var s=this;return function(r){s.oView.oNotificationNewNotificationOrErrorText.setBusy(false);s.oView.oNotificationNewNotificationOrErrorText.setText("");s.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(s.sLoadingAnimationDummyTextStyleClass);s.initializeRefreshAndTransitionState();if(r[0].error&&!r[1].error){s.bErrorInNoticesODataResponse=false;s.aNotifications=r[1].results;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else if(!r[0].error&&r[1].error){s.bErrorInUnreadCountODataResponse=false;s.iNotificationUnreadCount=r[0].GetNoticeUnreadCount.UnreadCount;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else if(r[0].error&&r[1].error){s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();}else{s.bErrorInUnreadCountODataResponse=false;s.bErrorInNoticesODataResponse=false;s.bErrorInODataResponse=false;s.aNotifications=r[1].results;s.iNotificationUnreadCount=r[0].GetNoticeUnreadCount.UnreadCount;if(s.iMaxNotificationsToDisplay>0){if(s.aNotifications.length>0){if(s.iNotificationUnreadCount>0){s.iNotificationsToDisplay=Math.min(s.iMaxNotificationsToDisplay,s.aNotifications.length,s.iNotificationUnreadCount);s.iNotificationCurrentIndex=0;s.iNotificationPreviousIndex=s.iNotificationsToDisplay-1;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setProfilePhotosSrc();s.setUiContent();s.activateNotificationTransition();s.activateNotificationRefresh();}else{s.iNotificationsToDisplay=1;s.iNotificationCurrentIndex=0;s.iNotificationPreviousIndex=s.iNotificationsToDisplay-1;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setProfilePhotosSrc();s.setUiContent();s.activateNotificationRefresh();}}else{s.iNotificationsToDisplay=0;s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.activateNotificationRefresh();}}else{s.iNotificationsToDisplay=0;s.clearAllUiTexts();s.hideAllProfilePhotoControls();}}};},getFunctionErrorCallBack:function(){var s=this;return function(e){s.initializeRefreshAndTransitionState();s.clearAllUiTexts();s.hideAllProfilePhotoControls();s.setUiContent();s.activateNotificationRefresh();};},setProfilePhotosSrc:function(){var s;var S;var p;for(var i=0;i<this.iNotificationsToDisplay;++i){s=this.aNotifications[i].SenderId;S=this.aNotifications[i].SenderFullName;p=this.getProfilePhotoURL(S,s);this.oView.aProfilePhotos[i].addStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.aProfilePhotos[i].setSrc(p);}},getProfilePhotoURL:function(s,S){if(s!==""){return this.sOdataServiceUrl+"/Members("+S+")/ProfilePhoto/$value";}else{return sap.ui.resource('sap.collaboration.components',"images/Anonymous.png");}},hideAllProfilePhotoControls:function(){for(var i=0;i<this.oView.aProfilePhotos.length;++i){this.oView.aProfilePhotos[i].addStyleClass(this.sProfilePhotoHiddenStyleClass);}},clearAllUiTexts:function(){this.oView.oNotificationTypeText.setText("");this.oView.oNotificationMessageText.setText("");this.oView.oNotificationUnreadCountText.setText("");this.oView.oNotificationNewNotificationOrErrorText.setText("");this.oView.oNotificationAgeText.setText("");this.oView.oNotificationGroupText.setText("");},setUiContent:function(){if(this.bErrorInODataResponse){this.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(this.sNewNotificationTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sErrorTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(this.oLangBundle.getText("NOTIF_ERROR_MESSAGE"));}else{var n=this.aNotifications[this.iNotificationCurrentIndex];var N="NOTIF_"+n.EventType.toUpperCase();var s=n.Message;var a;if(this.iNotificationUnreadCount>999){a=this.oLangBundle.getText("NOTIF_MORE_THAN_999_NEW_NOTIFICATIONS");}else{a=this.iNotificationUnreadCount;}var c=n.CreatedAt;var g=n.GroupName;var b=this.oNotificationTypeUtil.getRequiredNotificationPropertyNames(n.EventType);var d=this.getNotificationPropertyValues(b,n);this.oView.oNotificationTypeText.setText(this.oLangBundle.getText(N,d));this.oView.oNotificationMessageText.setText(s);this.oView.aProfilePhotos[this.iNotificationPreviousIndex].addStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.aProfilePhotos[this.iNotificationCurrentIndex].removeStyleClass(this.sProfilePhotoHiddenStyleClass);this.oView.oNotificationUnreadCountText.setText(a);this.oView.oNotificationNewNotificationOrErrorText.removeStyleClass(this.sErrorTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.addStyleClass(this.sNewNotificationTextStyleClass);this.oView.oNotificationNewNotificationOrErrorText.setText(this.oLangBundle.getText("NOTIF_NEW_NOTIFICATIONS"));var e=this.calculateNotificationAge(c,g).split("\n");var f=e[0];var h="";if(e.length>1){h=e[1];}this.oView.oNotificationAgeText.setText(f);this.oView.oNotificationGroupText.setText(h);this.iNotificationPreviousIndex=this.iNotificationCurrentIndex;this.iNotificationCurrentIndex=(this.iNotificationCurrentIndex+1)%this.iNotificationsToDisplay;}},getNotificationPropertyValues:function(n,N){var a=[];for(var i=0;i<n.length;i++){a.push(N[n[i]]);}return a;},calculateNotificationAge:function(c,g){if(!this.oCommonUtil.isValidDate(c)){return"";}var n=new Date();c.setMilliseconds(0);n.setMilliseconds(0);var a=60000;var b=a*60;var d=b*24;var e=n.getTime()-c.getTime();if(e>=d){var f=Math.round(parseFloat(e/d,10));if(f===1){if(g!==""){return this.oLangBundle.getText("NOTIF_DAY_AGO_GRP",[f.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_DAY_AGO_NO_GRP",[f.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_DAYS_AGO_GRP",[f.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_DAYS_AGO_NO_GRP",[f.toString()]);}}}else if(e>=b){var h=Math.round(parseFloat(e/b,10));if(h===1){if(g!==""){return this.oLangBundle.getText("NOTIF_HOUR_AGO_GRP",[h.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_HOUR_AGO_NO_GRP",[h.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_HOURS_AGO_GRP",[h.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_HOURS_AGO_NO_GRP",[h.toString()]);}}}else{var i=Math.round(parseFloat(e/a,10));if(i===1){if(g!==""){return this.oLangBundle.getText("NOTIF_MINUTE_AGO_GRP",[i.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_MINUTE_AGO_NO_GRP",[i.toString()]);}}else{if(g!==""){return this.oLangBundle.getText("NOTIF_MINUTES_AGO_GRP",[i.toString(),g]);}else{return this.oLangBundle.getText("NOTIF_MINUTES_AGO_NO_GRP",[i.toString()]);}}}},activateNotificationTransition:function(){if(!this.bIsTransitionActive){this.iNotificationsTransitionCallbackRegistrationId=this.getTransitionRegistrationId();this.bIsTransitionActive=true;}},getTransitionRegistrationId:function(){return setInterval(this.setUiContent.bind(this),this.iTransitionInterval);},deactivateNotificationTransition:function(){if(this.bIsTransitionActive){clearInterval(this.iNotificationsTransitionCallbackRegistrationId);this.bIsTransitionActive=false;}},activateNotificationRefresh:function(){if(!this.bIsRefreshActive){this.iNotificationsRefreshCallbackRegistrationId=this.getRefreshRegistrationId();this.bIsRefreshActive=true;}},getRefreshRegistrationId:function(){return setInterval(this.refreshNotification.bind(this),this.iRefreshInterval);},deactivateNotificationRefresh:function(){if(this.bIsRefreshActive){clearInterval(this.iNotificationsRefreshCallbackRegistrationId);this.bIsRefreshActive=false;}},refreshNotification:function(){this.deactivateNotificationTransition();this.deactivateNotificationRefresh();this.fetchNotificationData();}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.declare("sap.collaboration.components.fiori.sharing.Component");jQuery.sap.require('sap.m.MessageBox');sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.sharing.Component",{metadata:{includes:["../../resources/css/Sharing.css"],properties:{width:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},height:{type:"sap.ui.core.CSSSize",defaultValue:"100%"},oDataServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV"},tunnelServiceUrl:{type:"sap.ui.core.URI",defaultValue:"/sap/bc/z_sail_httproxy/Jam/api/v1/OData"},object:{type:"object"},attachments:{type:"object"},externalObject:{type:"object"}}},init:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();this.sODataServiceUrl=undefined;this.sTunnelServiceUrl=undefined;this.sJamUrl=undefined;this.oODataUtil=undefined;this.oSharingView=undefined;this.oView=undefined;this.aJamGroups=[];this.bOdataOn=true;},onBeforeRendering:function(){},onAfterRendering:function(){this.logComponentProperties();if(this.bStopRendering===undefined||this.bStopRendering===false){this.oSharingView=this.getSharingView();this.oSharingView.placeAt(this.getId());}},exit:function(){this.oSharingView.destroy();},setSettings:function(s){this.setODataServiceUrl(s.oDataServiceUrl);this.setTunnelServiceUrl(s.tunnelServiceUrl);this.setObject(s.object);this.setAttachments(s.attachments);this.setExternalObject(s.externalObject);},render:function(r){r.write("<div id='"+this.getId()+"' style='width:"+this.getWidth()+";height:"+this.getHeight()+"'");r.write(">");r.write("</div>");},getSharingView:function(){var o;var O;var s;var a=this.getObject();if(a){s=a.id;o=a.display;O=a.share;}var c=this.getComponentData();if(c){this.oDialogComponent=c.dialogComponent;}var b=this;var n=function(){if(!b.oNoGroupsView){b.oNoGroupsView=sap.ui.view({id:b.getId()+"_NoGroupsView",viewData:{controlId:b.getId(),langBundle:b.oLangBundle,jamUrl:b.oSharingView.getController().sJamUrl,},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"});}b.oSharingView.destroy();b.oSharingView=undefined;b.oNoGroupsView.placeAt(b.getId());};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.getODataServiceUrl(),tunnelServiceUrl:this.getTunnelServiceUrl(),langBundle:this.oLangBundle,jamGroups:this.aJamGroups,noGroupsCallBack:n,objectDisplay:o,objectShare:O,objectId:s,dialogComponent:this.oDialogComponent,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"});}else{this.oSharingView.getViewData().objectId=s;this.oSharingView.getViewData().objectShare=O;this.oSharingView.getViewData().objectDisplay=o;this.oSharingView.getViewData().externalObject=this.getExternalObject();}if(this.oNoGroupsView){this.oNoGroupsView.destroy();this.oNoGroupsView=undefined;}return this.oSharingView;},shareToJam:function(){this.oSharingView.getController().shareToJam();},logComponentProperties:function(){jQuery.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component.logComponentProperties()");jQuery.sap.log.debug("width: "+this.getWidth());jQuery.sap.log.debug("height: "+this.getHeight());jQuery.sap.log.debug("oDataServiceUrl: "+this.getODataServiceUrl());jQuery.sap.log.debug("tunnelServiceUrl: "+this.getTunnelServiceUrl());if(this.getObject()){jQuery.sap.log.debug("object->id: "+this.getObject().id);jQuery.sap.log.debug("object->display: "+this.getObject().display);jQuery.sap.log.debug("object->share: "+this.getObject().share);}else{jQuery.sap.log.debug("object: undefined");}if(this.getAttachments()&&this.getAttachments().attachmentsArray){jQuery.sap.log.debug("Attachments:");var a=this.getAttachments().attachmentsArray;for(var i=0;i<a.length;i++){jQuery.sap.log.debug("Attachments"+(i+1)+":");jQuery.sap.log.debug(a[i].mimeType);jQuery.sap.log.debug(a[i].name);jQuery.sap.log.debug(a[i].url);}}else{jQuery.sap.log.debug("attachments: undefined");}if(this.getExternalObject()){jQuery.sap.log.debug("externalObject->appContext: "+this.getObject().appContext);jQuery.sap.log.debug("externalObject->odataServicePath: "+this.getObject().odataServicePath);jQuery.sap.log.debug("externalObject->collection: "+this.getObject().collection);jQuery.sap.log.debug("externalObject->key: "+this.getObject().key);jQuery.sap.log.debug("object->name: "+this.getObject().name);jQuery.sap.log.debug("object->summary: "+this.getObject().summary);}else{jQuery.sap.log.debug("externalObject: undefined");}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.NoGroups.controller')){jQuery.sap.declare('sap.collaboration.components.fiori.sharing.NoGroups.controller');sap.ui.controller("sap.collaboration.components.fiori.sharing.NoGroups",{onInit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){},onExit:function(){this.getView().destroyContent();}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.dialog.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.require('sap.m.MessageToast');jQuery.sap.declare("sap.collaboration.components.fiori.sharing.dialog.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.fiori.sharing.dialog.Component",{metadata:{includes:["../../../resources/css/Sharing.css"],properties:{attachments:{type:"object"},object:{type:"object"},externalObject:{type:"object"}},aggregations:{},events:{}},systemSettings:{width:"400px",height:"",oDataServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",collaborationHostODataServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",collaborationHostRestService:{url:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1",urlParams:""}},init:function(){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=this.oCommonUtil.getLanguageBundle();},setSettings:function(s){this.setObject(s.object);this.setAttachments(s.attachments);if(JSON.stringify(s.externalObject)==='{}'){this.setExternalObject(undefined);}else{this.setExternalObject(s.externalObject);}},createSharingView:function(){var s=this;var o;var O;var a;var b=this.getObject();if(b){a=b.id;o=b.display;O=b.share;}var n=function(){s.close();s.openoNoGroupsDialog(s.oSharingView.getController().sJamUrl);};if(!this.oSharingView){this.oSharingView=sap.ui.view({id:this.getId()+"_SharingView",viewData:{controlId:this.getId(),odataServiceUrl:this.systemSettings.oDataServiceUrl,collaborationHostODataServiceUrl:this.systemSettings.collaborationHostODataServiceUrl,collaborationHostRestService:this.systemSettings.collaborationHostRestService,langBundle:this.oLangBundle,jamGroups:this.aJamGroups,sharingDialog:this.oSharingDialog,noGroupsCallBack:n,objectDisplay:o,objectShare:O,objectId:a,attachments:this.getAttachments(),externalObject:this.getExternalObject()},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.Sharing"});}else{this.oSharingView.getViewData().objectId=a;this.oSharingView.getViewData().objectShare=O;this.oSharingView.getViewData().objectDisplay=o;this.oSharingView.getViewData().externalObject=this.getExternalObject();this.oSharingView.getViewData().attachments=this.getAttachments();}},createSharingDialog:function(){var s=new sap.m.Dialog(this.getId()+"_SharingDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),contentWidth:this.systemSettings.width,stretch:false,afterClose:function(){}}).addStyleClass("sapUiPopupWithPadding");return s;},createNoGroupsDialog:function(j){if(!this.oNoGroupsView){this.oNoGroupsView=sap.ui.view({id:this.getId()+"_NoGroupsView",viewData:{controlId:this.getId(),langBundle:this.oLangBundle,jamUrl:j},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.NoGroups"});}var n=new sap.m.Dialog(this.getId()+"_NoGroupsDialog",{title:this.oLangBundle.getText("SHARING_PAGE_TITLE"),stretch:false,content:this.oNoGroupsView,beginButton:new sap.m.Button(this.getId()+"_CloseButton",{text:this.oLangBundle.getText("CLOSE_BUTTON_TEXT"),press:function(){n.close();}})}).addStyleClass("sapUiPopupWithPadding");return n;},open:function(){if(this.bStopRendering===undefined||this.bStopRendering===false){if(!this.oSharingDialog){this.logComponentProperties();this.oSharingDialog=this.createSharingDialog();}this.createSharingView();this.oSharingDialog.addContent(this.oSharingView);this.oSharingDialog.setInitialFocus(this.oSharingView);this.createDialogButtons();if(sap.ui.Device.system.phone){this.oSharingDialog.setStretch(true);}try{this.oSharingDialog.open();}catch(e){this.oCommonUtil.displayError();}}},close:function(){if(this.oSharingDialog){this.oSharingDialog.close();}},openoNoGroupsDialog:function(j){this.oSharingDialog.removeAllContent();if(!this.oNoGroupsDialog){this.oNoGroupsDialog=this.createNoGroupsDialog(j);}this.oNoGroupsDialog.open();},createDialogButtons:function(){var s=this;if(!sap.ui.getCore().byId(this.getId()+"_LeftButton")){this.oLeftButton=new sap.m.Button(this.getId()+"_LeftButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),enabled:false,press:function(){s.oSharingView.getController().shareToJam();s.oSharingDialog.close();}});this.oSharingDialog.setBeginButton(this.oLeftButton);}if(!this.oRightButton){this.oRightButton=new sap.m.Button(this.getId()+"_RightButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:function(){s.oSharingDialog.close();}});this.oSharingDialog.setEndButton(this.oRightButton);}},setDialogButtons:function(){},setCloseButton:function(){this.oSharingDialog.destroyBeginButton();this.oSharingDialog.setEndButton(this.oCloseButton);},logComponentProperties:function(){jQuery.sap.log.debug("Share Component properties:","","sap.collaboration.components.fiori.sharing.Component.logComponentProperties()");jQuery.sap.log.debug("width: "+this.systemSettings.width);jQuery.sap.log.debug("height: "+this.systemSettings.height);jQuery.sap.log.debug("oDataServiceUrl: "+this.systemSettings.oDataServiceUrl);jQuery.sap.log.debug("collaborationHostODataServiceUrl: "+this.systemSettings.collaborationHostODataServiceUrl);jQuery.sap.log.debug("collaborationHostRestService: "+this.systemSettings.collaborationHostRestService.url+this.systemSettings.collaborationHostRestService.urlParams);if(this.getObject()){jQuery.sap.log.debug("object->id: "+this.getObject().id);jQuery.sap.log.debug("object->display: "+this.getObject().display);jQuery.sap.log.debug("object->share: "+this.getObject().share);}else{jQuery.sap.log.debug("object: undefined");}if(this.getAttachments()&&this.getAttachments().attachmentsArray){jQuery.sap.log.debug("Attachments:");var a=this.getAttachments().attachmentsArray;for(var i=0;i<a.length;i++){jQuery.sap.log.debug("Attachments"+(i+1)+":");jQuery.sap.log.debug(a[i].mimeType);jQuery.sap.log.debug(a[i].name);jQuery.sap.log.debug(a[i].url);}}else{jQuery.sap.log.debug("attachments: undefined");}if(this.getExternalObject()){jQuery.sap.log.debug("externalObject->appContext: "+this.getExternalObject().appContext);jQuery.sap.log.debug("externalObject->odataServicePath: "+this.getExternalObject().odataServicePath);jQuery.sap.log.debug("externalObject->collection: "+this.getExternalObject().collection);jQuery.sap.log.debug("externalObject->key: "+this.getExternalObject().key);jQuery.sap.log.debug("object->name: "+this.getExternalObject().name);jQuery.sap.log.debug("object->summary: "+this.getExternalObject().summary);}else{jQuery.sap.log.debug("externalObject: undefined");}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil')){jQuery.sap.declare("sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil");sap.ui.base.Object.extend("sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil",{constructor:function(l,o,j){this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oLangBundle=l;this.oODataUtil=o;this.oJamODataModel=j;},createFileSelectionDialog:function(p,a,o,w,h){var b=function(e){var v=e.getParameter("value");var f=new sap.ui.model.Filter("name",sap.ui.model.FilterOperator.Contains,v);var B=e.getSource().getBinding("items");B.filter([f]);};this.oFileSelectionDialog=new sap.m.SelectDialog(p+"_FileSelectionDialog",{multiSelect:true,noDataText:this.oLangBundle.getText("NO_ATTACHMENTS_FOUND_TEXT"),rememberSelections:true,title:this.oLangBundle.getText("ATTACHMENTS_FIELD_TEXT",[""]),confirm:o,search:b,liveChange:b});if(w){this.oFileSelectionDialog.setContentWidth(w.toString()+"px");}if(h){this.oFileSelectionDialog.setContentHeight(h.toString()+"px");}var i=new sap.m.StandardListItem({title:"{name}",icon:"{icon}",iconDensityAware:false,iconInset:true,type:sap.m.ListType.Active});this.oFileSelectionDialog.setModel(a);this.oFileSelectionDialog.bindAggregation("items","/attachments",i);return this.oFileSelectionDialog;},createAttachmentsModel:function(f){var a=[];for(var i=0;i<f.length;i++){a.push({name:f[i].getName(),mimeType:f[i].getMimeType(),url:f[i].getUrl(),icon:this.oCommonUtil.getIconFromMimeType(f[i].getMimeType())});}var A=new sap.ui.model.json.JSONModel({attachments:a});return A;},createFolderSelectionDialog:function(p,g,o,O,w,h){var s=this;var b=function(e){s.oFolderSelectionDialog.getContent()[0].getController().navigateBack();};var H=new sap.m.Bar(p+"_FolderSelectionDialogHeaderBar",{contentLeft:[new sap.m.Button(p+"_FolderSelectionDialogHeaderBarBackButton",{type:sap.m.ButtonType.Back,visible:false,press:b})],contentMiddle:[new sap.m.Label(p+"_FolderSelectionDialogHeaderBarTitle",{text:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT")})]});var a=new sap.m.Button(p+"_FolderSelectionDialogOKButton",{text:this.oLangBundle.getText("OK_BUTTON_TEXT"),press:function(e){o(e);s.oFolderSelectionDialog.close();}});var c=new sap.m.Button(p+"_FolderSelectionDialogCancelButton",{text:this.oLangBundle.getText("CANCEL_BUTTON_TEXT"),press:function(e){O(e);s.oFolderSelectionDialog.close();}});this.oFolderSelectionDialog=new sap.m.Dialog(p+"_FolderSelectionDialog",{beginButton:a,endButton:c,customHeader:H}).addStyleClass("sapUiPopupWithPadding");var f=this.createFolderSelectionView(p,g,w,h);this.oFolderSelectionDialog.addContent(f);if(sap.ui.Device.system.phone){this.oFolderSelectionDialog.setStretch(true);}return this.oFolderSelectionDialog;},createFolderSelectionView:function(p,g,w,h){var f=sap.ui.view({id:p+"_FolderSelectionView",viewData:{controlId:p,groupId:g,languageBundle:this.oLangBundle,oDataUtil:this.oODataUtil,oDataModel:this.oJamODataModel,folderSelectionDialog:this.oFolderSelectionDialog},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.fiori.sharing.FolderSelection"});if(w){f.setWidth(w.toString()+"px");}if(h){f.setHeight(h.toString()+"px");}return f;},getCurrentFolder:function(){if(this.oFolderSelectionDialog){return this.oFolderSelectionDialog.getContent()[0].getController().getCurrentFolder();}return{name:this.oLangBundle.getText("TARGET_FOLDER_FIELD_TEXT"),id:""};},getCurrentGroupId:function(){return this.oFolderSelectionDialog.getContent()[0].getController().sGroupId;},resetFolderSelection:function(g){if(this.oFolderSelectionDialog){this.oFolderSelectionDialog.getContent()[0].getController().sGroupId=g;this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId='';this.oFolderSelectionDialog.getContent()[0].getController().aFolderBuffer=[];}},setCurrentFolderId:function(f){this.oFolderSelectionDialog.getContent()[0].getController().sCurrentFolderId=f;}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialprofile.Component')){jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.declare("sap.collaboration.components.socialprofile.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.socialprofile.Component",{metadata:{version:"1.0",includes:["../resources/css/SocialProfile.css"],aggregations:{},properties:{placement:{type:"sap.m.PlacementType",group:"Misc",defaultValue:sap.m.PlacementType.Auto},memberId:{type:"string",group:"Misc"},memberInfo:{type:"object",group:"Misc"},openingControl:{type:"object",group:"Misc"},height:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"380px"},width:{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:"300px"}}},_defaultAttributes:{collaborationHostServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",smiServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV"},init:function(){this._oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this._oLangBundle=this._oCommonUtil.getLanguageBundle();},exit:function(){},onBeforeRendering:function(){},onAfterRendering:function(){},open:function(){try{this._logComponentProperties();this._validateInputParameters();this._createView();this._createSocialPopover();this._oPopover.openBy(this.getOpeningControl());}catch(e){jQuery.sap.log.error(e.stack);this._oCommonUtil.displayError();}},setSettings:function(s){try{if(s){this.setPlacement(s.placement);this.setMemberId(s.memberId);this.setMemberInfo(s.memberInfo);this.setOpeningControl(s.openingControl);this.setHeight(s.height);this.setWidth(s.width);}else{throw new Error("Settings object is undefined");}}catch(e){jQuery.sap.log.error(e.stack);this._oCommonUtil.displayError();}},_createView:function(){if(!this._oPopoverView){this._oPopoverView=new sap.ui.view({id:this.getId()+"_PopoverView",viewData:{collaborationHostServiceUrl:this._defaultAttributes.collaborationHostServiceUrl,smiServiceUrl:this._defaultAttributes.smiServiceUrl,langBundle:this._oLangBundle,memberId:this.getMemberId(),memberInfo:this.getMemberInfo(),popoverPrefix:this.getId()},type:sap.ui.core.mvc.ViewType.JS,viewName:"sap.collaboration.components.socialprofile.SocialProfile"});}else{this._oPopoverView.getViewData().memberId=this.getMemberId();this._oPopoverView.getViewData().memberInfo=this.getMemberInfo();}},_createSocialPopover:function(){if(!this._oPopover){var h=new sap.m.Bar(this.getId()+"_HeaderBar",{contentMiddle:new sap.m.Text({text:this._oLangBundle.getText("SP_TITLE")}).addStyleClass("popoverheader")});this._oPopover=new sap.m.ResponsivePopover(this.getId()+"_Popover",{customHeader:h,content:[this._oPopoverView],placement:this.getPlacement(),beginButton:new sap.m.Button(this.getId()+"_JamButton",{text:this._oLangBundle.getText("SP_OPEN_JAM_BUTTON"),enabled:false}),showCloseButton:true,contentHeight:this.getHeight(),contentWidth:this.getWidth()}).addStyleClass("popover");}if(this._oPopover.getPlacement()!==this.getPlacement()){this._oPopover.setPlacement(this.getPlacement());}if(this._oPopover.getContentHeight()!==this.getHeight()){this._oPopover.setContentHeight(this.getHeight());}if(this._oPopover.getContentWidth()!==this.getWidth()){this._oPopover.setContentWidth(this.getWidth());}},_logComponentProperties:function(){jQuery.sap.log.debug("Social Profile Component properties:","","sap.collaboration.components.socialprofile.Component._logComponentProperties()");jQuery.sap.log.debug("placement: "+this.getPlacement());jQuery.sap.log.debug("memberId: "+this.getMemberId());jQuery.sap.log.debug("openingControl: "+this.getOpeningControl());jQuery.sap.log.debug("height: "+this.getHeight());jQuery.sap.log.debug("width: "+this.getWidth());},_validateInputParameters:function(){var e;if(!this.getMemberId()){throw new Error("MemberId is undefined");}if(!this.getOpeningControl()){throw new Error("Opening control is undefined");}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialprofile.SocialProfile.controller')){jQuery.sap.declare('sap.collaboration.components.socialprofile.SocialProfile.controller');sap.ui.controller("sap.collaboration.components.socialprofile.SocialProfile",{onInit:function(){this._sJamODataServiceUrl=this.getView().getViewData().collaborationHostServiceUrl;this._oODataUtil=new sap.collaboration.components.utils.OdataUtil();this._oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this._sPrefixId=this.getView().getId();this._sJamURL="";this._sJamUserId="";this._sPopoverPrefix=this.getView().getViewData().popoverPrefix;},onBeforeRendering:function(){if(!this._oJamODataModel){this._initializeJamODataModel();}if(!this._oSMIODataModel){this._initializeSMIODataModel();}if(!this._oJSONModel){this._initializeJSONModel();}if(!this._sJamURL){this._fetchJamURL();this._attachJamButtonPress();}if(this._memberId!==this.getView().getViewData().memberId){this.getView().resetHeader();this._clearViewData();this._memberId=this.getView().getViewData().memberId;var m=this.getView().getViewData().memberInfo;if(!m){this._fetchData();}else{this._fillData(m);}}},_initializeJamODataModel:function(){var a=true;this._sJamODataServiceUrl=this.getView().getViewData().collaborationHostServiceUrl;this._oJamODataModel=new sap.ui.model.odata.ODataModel(this._sJamODataServiceUrl,a);},_initializeSMIODataModel:function(){var a=true;this._sSMIODataServiceUrl=this.getView().getViewData().smiServiceUrl;this._oSMIODataModel=new sap.ui.model.odata.ODataModel(this._sSMIODataServiceUrl,a);},_initializeJSONModel:function(){this._oJSONModel=new sap.ui.model.json.JSONModel({});this.getView().setModel(this._oJSONModel);},_attachJamButtonPress:function(){var s=this;var j=sap.ui.getCore().byId(this._sPopoverPrefix+"_JamButton");j.attachPress(function(){window.open(s._sJamURL+"/profile/wall/"+s._sJamUserId,"_blank");});},_fetchJamURL:function(){var a=true;var s=this;var f=new jQuery.Deferred();f.done(function(j){s._sJamURL=j;});f.fail(function(e){jQuery.sap.log.error("SAP Jam request failed at sap.collaboration.components.socialprofile.SocialProfileController._fetchJamURL()");s._oCommonUtil.displayError();});this._oODataUtil.getJamUrl(this._oSMIODataModel,f,a);},_fetchData:function(){var s=this;if(this._oSocialProfileRequest){this._oSocialProfileRequest.abort();}this._oSocialProfileRequest=this._oJamODataModel.read("Members_Autocomplete",{success:function(d,r){var j=d.results[0];var R=sap.ui.getCore().byId(s._sPopoverPrefix+"_Popover");s._oJSONModel.setData(j);if(d.results[0]){var i=s._sJamODataServiceUrl+"/ThumbnailImages"+"(Id='"+jQuery.sap.encodeURL(j.ThumbnailImage.Id)+"',ThumbnailImageType='"+jQuery.sap.encodeURL(j.ThumbnailImage.ThumbnailImageType)+"')/$value";sap.ui.getCore().byId(s._sPrefixId+"_HeaderUserImage").setSrc(i);s._sJamUserId=j.Id;R.getBeginButton().setEnabled(true);s._fetchMemberPhoneNumbers(s._sJamUserId,s._oJSONModel);}else{s.getView().setHeaderNoUser();}},error:function(e){if(e.response&&e.response.statusCode){jQuery.sap.log.error("SAP Jam request failed at sap.collaboration.components.socialprofile.SocialProfileController._fetchData()");s._oCommonUtil.displayError();}},urlParameters:{"Query":"'"+this._memberId+"'","$expand":"ThumbnailImage,MemberProfile"}});},_fetchMemberPhoneNumbers:function(j,_){var s=this;this._oJamODataModel.read("MemberProfiles('"+j+"')"+"/PhoneNumbers",{success:function(d,r){var J=d.results;var w="";var m="";for(var i=0,R=J.length;i<R;i++){if(J[i]['PhoneNumberType']==='Work'){w=J[i]['PhoneNumber'];}if(J[i]['PhoneNumberType']==='Mobile'){m=J[i]['PhoneNumber'];}}_.setProperty("/MemberProfile/PhoneNumbers",{Work:w,Mobile:m});},error:function(e){jQuery.sap.log.error("SAP Jam request failed at sap.collaboration.components.socialprofile.SocialProfileController._fetchMemberPhoneNumbers()");s._oCommonUtil.displayError();}});},_fillData:function(m){var M={"Id":m.id,"FullName":m.fullname,"Title":m.title,"Email":m.email,"MemberProfile":{"Address":m.address,"PhoneNumbers":{}}};this._oJSONModel.setData(M);sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setSrc(m.picture);this._sJamUserId=m.id;var r=sap.ui.getCore().byId(this._sPopoverPrefix+"_Popover");r.getBeginButton().setEnabled(true);this._fetchMemberPhoneNumbers(this._sJamUserId,this._oJSONModel);},_clearViewData:function(){sap.ui.getCore().byId(this._sPrefixId+"_HeaderUserImage").setSrc();sap.ui.getCore().byId(this._sPrefixId+"_FullName").setText();sap.ui.getCore().byId(this._sPrefixId+"_Role").setText();sap.ui.getCore().byId(this._sPrefixId+"_MobileNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_WorkNumber").setText();sap.ui.getCore().byId(this._sPrefixId+"_Email").setText();sap.ui.getCore().byId(this._sPrefixId+"_CompanyAddress").setText();sap.ui.getCore().byId(this._sPopoverPrefix+"_Popover").getBeginButton().setEnabled(false);}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.controls.TimelineEntryControl')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
jQuery.sap.declare("sap.collaboration.components.socialtimeline.controls.TimelineEntryControl");jQuery.sap.require('sap.ui.core.Control');sap.ui.core.Control.extend("sap.collaboration.components.socialtimeline.controls.TimelineEntryControl",{metadata:{publicMethods:[],library:"sap.collaboration",properties:{"timelineEntry":{type:"object",group:"data"}},aggregations:{}}});sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype.init=function(){this._oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this._oLangBundle=this._oCommonUtil.getLanguageBundle();};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype.onBeforeRendering=function(){if(!this._oFlexbox){this._oFlexbox=new sap.m.FlexBox(this.getId()+"_flexbox",{direction:"Column"});this._fillFlexbox();}};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype.exit=function(){if(this._oFlexbox){this._oFlexbox.destroy();if(this._oPopover){this._oPopover.destroy();}}};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype._fillFlexbox=function(){var t=this.getTimelineEntry();if(t.timelineEntryDetails!=undefined&&t.timelineEntryDetails.length>0){var f=this._parseTimelineEntryDetail(t.timelineEntryDetails[0]);this._oFlexbox.addItem(new sap.m.Text({text:f}));if(t.timelineEntryDetails.length>1){var l=this._createLink(t.timelineEntryDetails);this._oFlexbox.addItem(l);}}else{this._oFlexbox.addItem(new sap.m.Text({text:t.text}));}};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype._createLink=function(t){var s=this;var a=t.length-1;var l=new sap.m.Link(this.getId()+"_PopoverLink",{text:this._oLangBundle.getText("TE_LINK_TEXT",a)});l.attachPress(function(){if(!s._oPopover){s._oPopover=s._createPopover(t);}s._oPopover.openBy(l);});return l;};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype._createPopover=function(t){var c=new sap.m.List(this.getId()+"_ChangeList",{inset:false});for(var e in t){var E=this._parseTimelineEntryDetail(t[e]);var l=new sap.m.FeedListItem({text:E,showIcon:false});c.addItem(l);}var S="20em";var p=new sap.m.Popover(this.getId()+"_Popover",{contentWidth:S,placement:sap.m.PlacementType.Auto,title:this._oLangBundle.getText("TE_DETAILS_POPOVER_HEADER")+"("+t.length+")",content:[c]});return p;};sap.collaboration.components.socialtimeline.controls.TimelineEntryControl.prototype._parseTimelineEntryDetail=function(d){var t="";switch(d.changeType){case"U":t=this._oLangBundle.getText("TE_DETAILS_CHANGED",[d.propertyLabel,d.beforeValue,d.afterValue]);break;case"I":t=this._oLangBundle.getText("TE_DETAILS_SET",[d.propertyLabel,d.afterValue]);break;case"D":t=this._oLangBundle.getText("TE_DETAILS_CLEARED",[d.propertyLabel,d.beforeValue]);break;}return t;};};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler')){jQuery.sap.declare("sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler",{constructor:function(c){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler");this._oOdataUtil=new sap.collaboration.components.utils.OdataUtil();this._oCollabModel=c;this._oExternalBObuffer={};},addPostToExternalObject:function(c,e){var s=this;var a=this.getExternalObject(e).then(function(E){return s.postFeedEntryToObject(c,E);}).then(function(p){return p.promise;}).then(function(d,r){return d.results;}).fail(function(E){return E;});return a;},getExternalObject:function(e){var s=this;var b=e.ObjectType+e.Exid;var p=new jQuery.Deferred();if(!this._oExternalBObuffer[b]){var g=this.getExternalObjectByExidAndObjectType(e.Exid,e.ObjectType);g.promise.done(function(d,r){var E=d.results;s._oExternalBObuffer[b]=E;p.resolve(E);});g.promise.fail(function(E){if(E.response.statusCode==404){var c=s.postExternalObject(e);c.promise.done(function(d,r){var o=d.results;s._oExternalBObuffer[b]=o;p.resolve(o);});c.promise.fail(function(E){p.reject(E);});}else{p.reject(E);}});}else{p.resolve(this._oExternalBObuffer[b]);}return p;},getExternalObjectByExidAndObjectType:function(e,o){var s=this;var E="/ExternalObjects_FindByExidAndObjectType";var p=new jQuery.Deferred();var g=function(d,r){s._oLogger.info("External object found: "+d.results.Name);p.resolve(d,r);};var a=function(b){s._oLogger.error(b.response.statusText);p.reject(b);};var P={context:null,urlParameters:{"Exid":"'"+e.replace(/'/g,"''")+"'","ObjectType":"'"+o.replace(/'/g,"''")+"'"},async:true,filters:[],sorters:[],success:g,error:a};return{request:this._oCollabModel.read(E,P),promise:p};},getFeedEntries:function(e,n){var s=this;var E="";if(n){E=n;}else{E="/ExternalObjects"+"('"+jQuery.sap.encodeURL(e.Id)+"')/FeedEntries";}var p=new jQuery.Deferred();var S=function(d,r){s._oLogger.info("Feed entries were successfully retrieved.");p.resolve(d,r);};var f=function(o){s._oLogger.error("Failed to retrieve feed entries: "+o.response.statusText);p.reject(o);};var P={context:null,urlParameters:{"$expand":"Creator/ThumbnailImage,Creator/MemberProfile"},async:true,success:S,error:f};return{request:this._oCollabModel.read(E,P),promise:p};},getSuggestions:function(v){var s=this;var e="/Members_Autocomplete";var p=new jQuery.Deferred();var S=function(d,r){p.resolve(d,r);};var E=function(o){p.reject(o);};var P={urlParameters:{"Query":"'"+v+"'"},async:true,success:S,error:E};return{request:this._oCollabModel.read(e,P),promise:p};},getFeedEntryFromActivity:function(a){var s=this;var e="/Activities('"+jQuery.sap.encodeURL(a)+"')/FeedEntry";var p=new jQuery.Deferred();var S=function(d,r){p.resolve(d,r);};var E=function(o){s._oLogger.error("Failed to get the feed entry: "+o.response.statusText);p.reject(o);};var P={urlParameters:{$expand:"Creator/ThumbnailImage"},async:true,success:S,error:E};return{request:this._oCollabModel.read(e,P),promise:p};},getReplies:function(f){var s=this;var e="/FeedEntries('"+jQuery.sap.encodeURL(f)+"')/Replies";var p=new jQuery.Deferred();var S=function(d,r){s._oLogger.info("Replies were successfully retrieved.");p.resolve(d,r);};var E=function(o){s._oLogger.error("Failed to retrieve replies: "+o.response.statusText,o.stack);p.reject(o);};var u={'$top':100,'$orderby':'CreatedAt desc','$expand':'Creator,ThumbnailImage'};var P={context:null,urlParameters:u,async:true,success:S,error:E};return{request:this._oCollabModel.read(e,P),promise:p};},getMemberByAutocomplete:function(u){var s=this;var e="/Members_Autocomplete";var U={"Query":"'"+u+"'","$expand":"ThumbnailImage,MemberProfile"};var p=new jQuery.Deferred();var S=function(d,r){p.resolve(d,r);};var E=function(o){s._oLogger.error("Failed to get member information: "+o.response.statusText);p.reject(o);};var P={urlParameters:U,async:true,success:S,error:E};return{request:this._oCollabModel.read(e,P),promise:p};},getUserInfoBatch:function(u){var s=this;var b=[];u.forEach(function(U){var E="/Members_Autocomplete?Query='"+jQuery.sap.encodeURL(U)+"'&$expand=ThumbnailImage,MemberProfile";var m="GET";var d=null;var P=null;b.push(s._oCollabModel.createBatchOperation(E,m,d,P));});this._oCollabModel.addBatchReadOperations(b);var a=true;var p=new jQuery.Deferred();var S=function(d,r){var R=s._oOdataUtil.parseBatchResponse(d.__batchResponses);p.resolve(R,r);};var e=function(E){s._oLogger.error("Failed to get member information: "+E.response.statusText);p.reject(E);};return{request:this._oCollabModel.submitBatch(S,e,a),promise:p};},getSender:function(){var s=this;var e="/Self";var p=new jQuery.Deferred();var S=function(d,r){s._oLogger.info("The reply was successfully posted.");p.resolve(d.results);};var E=function(o){s._oLogger.error("Failed to retrieve the sender: "+o.response.statusText,o.stack);p.reject(o);};var P={urlParameters:null,async:true,success:S,error:E};return{request:this._oCollabModel.read(e,P),promise:p};},postExternalObject:function(e){var s=this;var E="/ExternalObjects";var d=e;var p=new jQuery.Deferred();var a=function(D,r){s._oLogger.info("External object created. "+D.results.Name);p.resolve(D,r);};var b=function(o){s._oLogger.error("Failed to create external object: "+o.response.statusText);p.reject(o);};var P={context:null,urlParameters:null,async:true,success:a,error:b};return{request:this._oCollabModel.create(E,d,P),promise:p};},postFeedEntryToObject:function(c,e){var s=this;var E="/Activities";var d={"Content":c,"Object":e,"Verb":"comment"};var p=new jQuery.Deferred();var S=function(D,r){p.resolve(D,r);};var f=function(o){s._oLogger.error("Failed to get the activity: "+o.response.statusText);p.reject(o);};var P={context:null,urlParameters:null,async:true,success:S,error:f};return{request:this._oCollabModel.create(E,d,P),promise:p};},postReply:function(f,r){var s=this;var e="/FeedEntries('"+jQuery.sap.encodeURL(f)+"')/Replies";var d={"Text":r};var p=new jQuery.Deferred();var S=function(D,a){s._oLogger.info("The reply was successfully posted.");p.resolve(D);};var E=function(o){s._oLogger.error("Failed to post reply: "+o.response.statusText,o.stack);p.reject(o);};var P={context:null,urlParameters:null,async:true,success:S,error:E};return{request:this._oCollabModel.create(e,d,P),promise:p};}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler')){jQuery.sap.declare("sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler",{constructor:function(s){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler");this._oSMIntegrationModel=s;this._oOdataUtil=new sap.collaboration.components.utils.OdataUtil();this._oExternalBOMappingBuffer={};this.oJamConfigurationStatusMap={configurationOk:0,configuartionError:1};},mapInternalBOToExternalBO:function(i){var b=i.appContext+i.collection+i.key+i.odataServicePath;var s=this;var p;if(!this._oExternalBOMappingBuffer[b]){p=this.getExternalObjectMapping(i).promise.then(function(d,r){s._oLogger.info("External business object mapping was found.");s._oExternalBOMappingBuffer[b]=d.MapInternalBOToExternalBO;return s._oExternalBOMappingBuffer[b];});}else{p=new jQuery.Deferred();p.resolve(this._oExternalBOMappingBuffer[b]);}return p;},getJamConfigurationStatus:function(c,C){var o="/GetJamConfigurationStatus";var s=this;var p={async:false,success:function(d,r){if(d.GetJamConfigurationStatus.StatusCode===s.oJamConfigurationStatusMap.configurationOk){c(true);}else{c(false);}},error:function(e){s._oLogger.error(JSON.stringify(e));C();}};this._oSMIntegrationModel.read(o,p);},getExternalObjectMapping:function(i){var s=this;var e="/MapInternalBOToExternalBO";var p=new jQuery.Deferred();var u={};u["ApplicationContext"]="'"+i.appContext+"'";u["ODataCollection"]="'"+i.collection+"'";u["ODataKeyPredicate"]="'"+i.key+"'";u["ODataServicePath"]="'"+i.odataServicePath+"'";var S=function(d,r){s._oLogger.info("External object mapping found");p.resolve(d,r);};var E=function(o){s._oLogger.error(o.response.statusText);p.reject(o);};var P={context:null,urlParameters:u,async:true,filters:[],sorters:[],success:S,error:E};return{request:this._oSMIntegrationModel.read(e,P),promise:p};}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler')){jQuery.sap.declare("sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler");sap.ui.base.Object.extend("sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler",{constants:{FILTER_JAM_ALL:"filter_jam_all",FILTER_BACKEND_ALL:"filter_backend_all"},constructor:function(b,j,s,p,e){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler");this._oBusinessObjectMap=b;this._sBusinessObjectKey="";this._oBOModel=this._oBusinessObjectMap.serviceModel;this._oCollabModel=j._oCollabModel;this._oSMIntegrationModel=s;this._oJamDataHandler=j;this._iPageSize=p;this._iTimelineEntriesPageSize=p;this._iTimelineEntriesSkip=0;this._iFeedEntriesPageSize=p*2;this._sFeedEntriesNextLink="";this._fCustomActionCallBack=b.customActionCallback;this._bEnableSocial=e;this._oTimelineTermsUtility=new sap.collaboration.components.socialtimeline.annotations.TimelineTermsUtility(this._oBOModel.getServiceMetadata(),this._oBOModel.getServiceAnnotations());this._oServiceDataHandler=new sap.collaboration.components.socialtimeline.datahandlers.ServiceDataHandler(this._oBOModel,this._oTimelineTermsUtility);this._oSMIntegrationDataHandler=new sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler(this._oSMIntegrationModel);this._aTimelineEntries=[];this._aFeedEntries=[];this._oMemberDataBuffer={};},setBusinessObjectKey:function(k){this.reset();this._sBusinessObjectKey=k;if(this._oTimelineEntriesReadRequest){this._oTimelineEntriesReadRequest.abort();}if(this._oFeedEntriesReadRequest){this._oFeedEntriesReadRequest.abort();}},getTimelineData:function(f){var s=this;var p=jQuery.Deferred();var r=new jQuery.Deferred();var a=new jQuery.Deferred();if(this._bEnableSocial===true&&!f.backend){var g=this._getFeedEntries();g.done(function(F){var t=s._mapFeedEntriesToTimelineItems(F);a.resolve(t);});g.fail(function(e){p.reject(e);});}else{a.resolve([]);}if(!f.jam){var b=this._getTimelineEntries(f.backend);b.done(function(t){var T=s._mapTimelineEntriesToTimelineItems(t);if(s._bEnableSocial===true){var c=s._fillPicturesForTimelineItems(T);c.always(function(d){r.resolve(d);});}else{r.resolve(T);}s._iTimelineEntriesSkip+=s._iTimelineEntriesPageSize;});b.fail(function(e){p.reject(e);});}else{r.resolve([]);}jQuery.when(r,a).then(function(t,F){var T=s._mergeEntries(t,F);p.resolve(T);},function(e){p.reject(e);});return p;},addTopLevelPost:function(c,i){var s=this;return this._oSMIntegrationDataHandler.mapInternalBOToExternalBO(i).then(function(e){return s._oJamDataHandler.addPostToExternalObject(c,e);});},reset:function(){this._iTimelineEntriesSkip=0;this._sFeedEntriesNextLink="";this._aTimelineEntries=[];this._aFeedEntries=[];},_getFeedEntries:function(){var s=this;var i={"appContext":this._oBusinessObjectMap.applicationContext,"collection":this._oBusinessObjectMap.collection,"key":this._sBusinessObjectKey,"odataServicePath":this._oBusinessObjectMap.servicePath};var p=this._oSMIntegrationDataHandler.mapInternalBOToExternalBO(i).then(function(e){return s._oJamDataHandler.getExternalObject(e);}).then(function(e){if(s._sFeedEntriesNextLink==undefined){var g=new jQuery.Deferred();g.resolve({"results":[]},null);return{request:null,promise:g};}else if(s._sFeedEntriesNextLink==""){return s._oJamDataHandler.getFeedEntries(e);}else{return s._oJamDataHandler.getFeedEntries(e,s._sFeedEntriesNextLink);}}).then(function(g){s._oFeedEntriesReadRequest=g.request;return g.promise;}).then(function(f){s._sFeedEntriesNextLink=f.__next;return f.results;});return p;},_mapFeedEntriesToTimelineItems:function(f){var s=this;var t=[];f.forEach(function(F){var T={};T.timelineItemData=s._mapFeedEntryToTimelineItem(F);T._feedEntryData=F;t.push(T);});return t;},_mapFeedEntryToTimelineItem:function(f){var P="sap-icon://post";if(!this.getUserInfoFromBuffer(f.Creator.Email)){this.addUserInfoToBuffer(f.Creator);}var t={dateTime:f.CreatedAt,userName:f.Creator.FullName,userEmail:f.Creator.Email,title:f.Action,text:f.Text,icon:P};t.userPicture=this.getUserPicture(t.userEmail);return t;},_mapTimelineEntriesToTimelineItems:function(t){var s=this;var T=[];t.forEach(function(o){var a={};a.timelineItemData=s._mapTimelineEntryToTimelineItem(o);var c=undefined;if(s._fCustomActionCallBack){c=s._fCustomActionCallBack(o);if(c&&!jQuery.isArray(c)){s._oLogger.error("The property customActionCallback does not return an array.");}else if(c){c.oDataEntry=o;a.timelineItemData.customActionData=c;}}T.push(a);});return T;},_mapTimelineEntryToTimelineItem:function(t){var T=this._oTimelineTermsUtility.getTimelineEntryFields(this._oBusinessObjectMap.collection);var o={dateTime:t[T.TimeStamp],userName:t[T.ActorName],userEmail:t[T.ActorExtID].toLowerCase(),title:t[T.ActionText],text:t[T.SummaryText],icon:t[T.Icon],timelineEntryDetails:this._processTimelineEntryDetails(t[T.TimelineDetailNavigationPath].results,this._oBusinessObjectMap.collection)};o.userPicture=this.getUserPicture(o.userEmail);return o;},_processTimelineEntryDetails:function(t,e){var s=this;var T=[];var o=s._oTimelineTermsUtility.getTimelineEntryDetailFields(e);t.forEach(function(a){var d={};d.afterValue=a[o.AfterValue];d.beforeValue=a[o.BeforeValue];d.changeType=a[o.ChangeType];d.propertyLabel=a[o.PropertyLabel];T.push(d);});return T;},_mergeEntries:function(t,f){this._aTimelineEntries=this._aTimelineEntries.concat(t);this._aFeedEntries=this._aFeedEntries.concat(f);var T=[];var o=this._aTimelineEntries.shift();var F=this._aFeedEntries.shift();do{if(!o&&!F){break;}else if(!o&&F){T.push(F);F=this._aFeedEntries.shift();}else if(o&&!F){T.push(o);o=this._aTimelineEntries.shift();}else{if(o.timelineItemData.dateTime==F.timelineItemData.dateTime){T.push(F);F=this._aFeedEntries.shift();}else if(o.timelineItemData.dateTime>F.timelineItemData.dateTime){T.push(o);o=this._aTimelineEntries.shift();}else if(o.timelineItemData.dateTime<F.timelineItemData.dateTime){T.push(F);F=this._aFeedEntries.shift();}}}while(T.length<this._iPageSize);if(o){this._aTimelineEntries.unshift(o);}if(F){this._aFeedEntries.unshift(F);}return T;},_fillPicturesForTimelineItems:function(t){var s=this;var p=jQuery.Deferred();var e=[];t.forEach(function(T){if(!T.timelineItemData.userPicture){e.push(T.timelineItemData.userEmail);}});var u=e.filter(function(a,i){return e.indexOf(a)==i;});if(u.length>0){var g=this._oJamDataHandler.getUserInfoBatch(u);g.promise.done(function(U){U=jQuery.grep(U,function(o){return o.results.length>0});U.forEach(function(o){s.addUserInfoToBuffer(o.results[0]);});t.forEach(function(T){if(!T.timelineItemData.userPicture){T.timelineItemData.userPicture=s.getUserPicture(T.timelineItemData.userEmail);}});p.resolve(t);});g.promise.fail(function(E){p.resolve(t);});}else{p.resolve(t);}return p;},_getTimelineEntries:function(f){if(f===this.constants.FILTER_BACKEND_ALL){f=undefined;}var r=this._oServiceDataHandler.readTimelineEntries(this._oBusinessObjectMap.collection,this._sBusinessObjectKey,f,this._iTimelineEntriesSkip,this._iTimelineEntriesPageSize);this._oTimelineEntriesReadRequest=r.request;return r.promise;},getUserPicture:function(u){var m=this.getUserInfoFromBuffer(u);if(!m){return"";}return m.picture;},buildImageUrl:function(i,I){return this._oCollabModel.sServiceUrl+"/ThumbnailImages"+"(Id='"+jQuery.sap.encodeURL(i)+"',ThumbnailImageType='"+jQuery.sap.encodeURL(I)+"')/$value";},addUserInfoToBuffer:function(m){var u=this.buildImageUrl(m.ThumbnailImage.Id,m.ThumbnailImage.ThumbnailImageType);var U=m.Email.toLowerCase();this._oMemberDataBuffer[U]={"email":U,"fullname":m.FullName,"id":m.Id,"address":m.MemberProfile.Address,"title":m.Title,"role":m.Role,"picture":u};},getUserInfoFromBuffer:function(u){var U=u.toLowerCase();return this._oMemberDataBuffer[U];},getJamConfigurationStatus:function(c,C){var s=function(b){c(b);};var e=function(E){C(E);};this._oSMIntegrationDataHandler.getJamConfigurationStatus(this._oSMIntegrationModel,s,e);}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.fiori.sharing.Sharing.controller')){jQuery.sap.declare('sap.collaboration.components.fiori.sharing.Sharing.controller');
/*!
 * @copyright@
 */
jQuery.sap.require('sap.m.MessageToast');sap.ui.controller("sap.collaboration.components.fiori.sharing.Sharing",{onInit:function(){this.oNoteTextArea=this.getView().oNoteTextArea;this.oAttachmentsInput=this.getView().oAttachmentsInput;this.oTargetFolderInput=this.getView().oTargetFolderInput;this.oODataUtil=undefined;this.sPrefixId=this.getView().getViewData().controlId;this.oLangBundle=this.getView().getViewData().langBundle;this.iJamGroupsCount=0;this.sObjectId=this.getView().getViewData().objectId;this.sObjectShare=this.getView().getViewData().objectShare;this.oObjectDisplay=this.getView().getViewData().objectDisplay;this.oExternalObject=undefined;this.oMappedExternalObject=undefined;this.sMemberEmail=undefined;this.oSharingDialog=this.getView().getViewData().sharingDialog;this.fNoGroupsCallBack=this.getView().getViewData().noGroupsCallBack;this.oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this.oAttachments=this.getView().getViewData().attachments;this.bAttachmentsCB=false;this.aFiles=[];this.aSelectedFiles=[];this.sSelectedFolderId='';this.oItemTemplate=undefined;this.oSelectedGroup=undefined;},onBeforeRendering:function(){try{this.sSelectedGroupId='';this.sSelectedGroupName='';if(!this.oSMIODataModel){this.initializeOdataModel();}if(!this.oODataUtil){this.initializeOdataUtils();}if(!this.oAttachmentsUtil){this.initializeAttachmentsUtil();}this.initializeShareUtil();this.preRenderSetup();this.fetchData();this.clearAttachmentsData();this.oAttachments=this.getView().getViewData().attachments;if(this.oAttachments&&this.oAttachments.attachmentsArray){this.aFiles=this.oAttachments.attachmentsArray;if(this.aFiles.length>0){this.getView().oAttachmentsInput.setEnabled(true);}else{this.getView().oAttachmentsInput.setEnabled(false);}if(this.oFileSelectionDialog){var a=this.oAttachmentsUtil.createAttachmentsModel(this.aFiles);this.oFileSelectionDialog.setModel(a);}this.showAttachmentsFields(true);}else{this.showAttachmentsFields(false);}if(this.sObjectId!=this.getView().getViewData().objectId){this.sObjectId=this.getView().getViewData().objectId;}if(this.sObjectShare!=this.getView().getViewData().objectShare||sap.ui.getCore().byId(this.sPrefixId+"_NoteTextArea").setValue!==this.getView().getViewData().objectShare){this.sObjectShare=this.getView().getViewData().objectShare;sap.ui.getCore().byId(this.sPrefixId+"_NoteTextArea").setValue(this.sObjectShare);}if(this.oObjectDisplay!=this.getView().getViewData().objectDisplay){if(this.oObjectDisplay!=undefined){this.getView().oSharingVBox.removeItem(0);}this.oObjectDisplay=this.getView().getViewData().objectDisplay;this.getView().oSharingVBox.insertItem(this.oObjectDisplay,0);}}catch(e){if(this.oSharingDialog){throw e;}this.oCommonUtil.displayError(e);}},onAfterRendering:function(){setTimeout(function(){sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect").focus();}.bind(this),1);},onExit:function(){this.getView().destroyContent();},preRenderSetup:function(){this.getView().oGroupSelect.setEnabled(false);this.setGroupSelectionText("");if(this.oAttachments&&this.oAttachments.attachmentsArray){this.getView().oTargetFolderInput.setEnabled(false);}this.getView().oNoteTextArea.setEnabled(false);if(this.oSharingDialog){this.oSharingDialog.getBeginButton().setEnabled(false);}},fetchData:function(){var s=this;var g=new jQuery.Deferred();g.done(function(c){s.iJamGroupsCount=c;if(s.iJamGroupsCount>0){s.postFetchSetup();setTimeout(function(){s.oSharingDialog.getContent()[0].getContent()[0].getItems()[1].getContent()[1].focus();},50);}else{if(s.fNoGroupsCallBack){s.fNoGroupsCallBack();}}});var a=new jQuery.Deferred();a.done(function(u){if(!s.sJamUrl){s.sJamUrl=u;}});var m=new jQuery.Deferred();m.done(function(e){s.oMappedExternalObject=e;});m.fail(function(){s.oMappedExternalObject=undefined;jQuery.sap.log.debug('Mapping Internal BO to External BO failed');});var b=new jQuery.Deferred();b.done(function(e){if(!s.sMemberEmail){s.sMemberEmail=e;}});jQuery.when(g,a,m).fail(function(e){if(s.oSharingDialog){s.oSharingDialog.close();}if(e.statusCode===401||e.statusCode===403){s.oCommonUtil.displayError(s.oLangBundle.getText("SHARE_AUTHORIZATION_FAILURE_MSG"));}else{s.oCommonUtil.displayError();}});this.oJamODataModel.read('/Groups/$count',{success:function(d,r){g.resolve(parseInt(r.body));},error:function(e){g.reject(e.response);}});this.oJamODataModel.read('/Self',{success:function(d,r){b.resolve(d.results.Email);},error:function(e){b.reject(e.response);}});if(!this.sJamUrl){this.oSMIODataModel.read('/GetCollaborationHostURL',{success:function(d,r){a.resolve(d.GetCollaborationHostURL.URL);},error:function(e){a.reject(e.response);}});}else{a.resolve();}this.oExternalObject=this.getView().getViewData().externalObject;if(this.oExternalObject){this.oSMIODataModel.read('/MapInternalBOToExternalBO',{urlParameters:{ApplicationContext:"'"+s.oExternalObject.appContext+"'",ODataCollection:"'"+s.oExternalObject.collection+"'",ODataKeyPredicate:"'"+s.oExternalObject.key+"'",ODataServicePath:"'"+s.oExternalObject.odataServicePath+"'"},success:function(d,r){m.resolve(d.MapInternalBOToExternalBO);},error:function(e){m.reject(e.response);}});}},postFetchSetup:function(){this.setGroupSelectionEnabled(true);},initializeOdataModel:function(){var a=true;this.sSMIODataServiceUrl=this.getView().getViewData().odataServiceUrl;this.oSMIODataModel=new sap.ui.model.odata.ODataModel(this.sSMIODataServiceUrl,a);this.sJamODataServiceUrl=this.getView().getViewData().collaborationHostODataServiceUrl;this.oJamODataModel=new sap.ui.model.odata.ODataModel(this.sJamODataServiceUrl,a);this.oJamODataModel.setDefaultCountMode(sap.ui.model.odata.CountMode.Inline);},initializeOdataUtils:function(){this.oODataUtil=new sap.collaboration.components.utils.OdataUtil();},initializeAttachmentsUtil:function(){this.oAttachmentsUtil=new sap.collaboration.components.fiori.sharing.helper.AttachmentsUtil(this.oLangBundle,this.oODataUtil,this.oJamODataModel);},initializeShareUtil:function(){this.oShareUtil=new sap.collaboration.components.fiori.sharing.helper.ShareUtil(this.oLangBundle,this.oODataUtil,this.oSMIODataModel,this.oCommonUtil,this.oJamODataModel,this.getView().getViewData().collaborationHostRestService);},setGroupSelectionText:function(t){var g=sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect");g.setValue(t);},setGroupSelectionEnabled:function(e){var g=sap.ui.getCore().byId(this.sPrefixId+"_GroupSelect");g.setEnabled(e);},setFolderSelectionEnabled:function(e){this.oTargetFolderInput.setEnabled(e);},showAttachmentsFields:function(v){this.getView().AttachmentsInputLayout.setVisible(v);this.getView().oTargetFolderInputLayout.setVisible(v);this.getView().oAttachmentCB.setVisible(v);},clearAttachmentsData:function(){this.aFiles=[];this.aSelectedFiles=[];this.sSelectedFolderId='';this.bAttachmentsCB=false;this.oAttachmentsInput.setValue("");this.getView().oAttachmentCB.setSelected(this.bAttachmentsCB);this.getView().oAttachmentCB.setEnabled(false);this.oTargetFolderInput.setValue("");if(this.oFolderSelectionDialog){this.oAttachmentsUtil.resetFolderSelection(this.getSelectedGroupId());}},onAttachmentsValueHelpPress:function(c){if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var S=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oFileSelectionDialog){var a=this.oAttachmentsUtil.createAttachmentsModel(this.aFiles);this.oFileSelectionDialog=this.oAttachmentsUtil.createFileSelectionDialog(this.sPrefixId,a,this.onFileSelectionDialogConfirm(),S,s);}var b=this.oFileSelectionDialog.getBinding("items");b.filter([]);this.oFileSelectionDialog.open();},onFileSelectionDialogConfirm:function(){var s=this;return function(e){s.aSelectedFiles=[];var c=e.getParameter("selectedContexts");for(var i=0;i<c.length;i++){s.aSelectedFiles.push(c[i].getObject());}if(s.aSelectedFiles&&s.aSelectedFiles.length>0){s.postFileSelectionSetup(true);}else{s.postFileSelectionSetup(false);}};},postFileSelectionSetup:function(f){if(f===true){if(this.aSelectedFiles.length==1){this.oAttachmentsInput.setValue(this.oLangBundle.getText("SELECTED_ATTACHMENT_FIELD_TEXT",[this.aSelectedFiles.length]));}else{this.oAttachmentsInput.setValue(this.oLangBundle.getText("SELECTED_ATTACHMENTS_FIELD_TEXT",[this.aSelectedFiles.length]));}this.getView().oAttachmentCB.setEnabled(true);if(this.sSelectedGroupId!==''){this.setFolderSelectionEnabled(true);}}else{this.oAttachmentsInput.setValue("");this.bAttachmentsCB=false;this.getView().oAttachmentCB.setSelected(this.bAttachmentsCB);this.postAttachmentCheckBoxSelection();this.getView().oAttachmentCB.setEnabled(false);this.setFolderSelectionEnabled(false);}},onGroupSelectValueHelpPress:function(e){if(!this.oItemTemplate){this.oItemTemplate=new sap.m.StandardListItem({title:{parts:["Name","GroupType"],formatter:function(n,g){return n+" ("+g+")";}},type:sap.m.ListType.Active});}if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var S=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oGroupSelectionDialog){this.oGroupSelectionDialog=this.oShareUtil.createGroupSelectionDialog(this.sPrefixId,this.oItemTemplate,this._onGroupSelectionDialogConfirm(),S,s,this.oJamODataModel);}else{this.oGroupSelectionDialog.setModel(this.oJamODataModel);this.oGroupSelectionDialog.bindAggregation("items","/Groups",this.oItemTemplate);}this.oGroupSelectionDialog.open();},_onGroupSelectionDialogConfirm:function(){var s=this;return function(e){var c=e.getParameter("selectedContexts");for(var i=0;i<c.length;i++){s.oSelectedGroup=c[i].getObject();}if(s.oSelectedGroup){s.postGroupSelectionSetup(true);}else{s.postGroupSelectionSetup(false);}};},postGroupSelectionSetup:function(g){if(g===true){if(this.oSelectedGroup!==undefined){this.sSelectedGroupId=this.oSelectedGroup.Id.toString();this.sSelectedGroupName=this.oSelectedGroup.Name.toString();this.setGroupSelectionText(this.sSelectedGroupName);}if(this.oAttachments&&this.oAttachments.attachmentsArray){this.sSelectedFolderId='';this.oAttachmentsUtil.resetFolderSelection(this.getSelectedGroupId());var s=this.oAttachmentsUtil.getCurrentFolder();this.oTargetFolderInput.setValue(s.name);}if(this.aSelectedFiles&&this.aSelectedFiles.length>0){this.setFolderSelectionEnabled(true);}if(this.bAttachmentsCB===false){this.getView().oNoteTextArea.setEnabled(true);}if(this.oSharingDialog){this.oSharingDialog.getBeginButton().setEnabled(true);}}else{this.setFolderSelectionEnabled(false);this.getView().oNoteTextArea.setEnabled(false);}},onTargetFolderValueHelpPress:function(c){if(this.oSharingDialog){var s=this.oSharingDialog.getContent()[0].getDomRef().offsetHeight;var S=this.oSharingDialog.getContent()[0].getDomRef().offsetWidth;}if(!this.oFolderSelectionDialog){this.oFolderSelectionDialog=this.oAttachmentsUtil.createFolderSelectionDialog(this.sPrefixId,this.getSelectedGroupId(),this.onFolderSelectionDialogConfirm(),this.onFolderSelectionDialogCancel(),S,s);this.sSelectedFolderId='';}this.oFolderSelectionDialog.getContent()[0].oController.setFolderSelectionDialogTitle(this.oTargetFolderInput.getValue());this.oFolderSelectionDialog.open();},onFolderSelectionDialogConfirm:function(e){var s=this;return function(){var S=s.oAttachmentsUtil.getCurrentFolder();s.sSelectedFolderId=S.id;s.oTargetFolderInput.setValue(S.name);};},onFolderSelectionDialogCancel:function(e){var s=this;return function(e){s.oAttachmentsUtil.setCurrentFolderId(s.sSelectedFolderId);};},onAttachmentCheckBoxSelected:function(){this.bAttachmentsCB=this.getView().oAttachmentCB.getSelected();this.postAttachmentCheckBoxSelection();},postAttachmentCheckBoxSelection:function(){if(this.bAttachmentsCB===true){this.getView().oNoteTextArea.setEnabled(false);}else{if(this.sSelectedGroupId!==''){this.getView().oNoteTextArea.setEnabled(true);}}},getSharingData:function(){var f;if((this.oNoteTextArea.getValue()!==undefined&&this.oNoteTextArea.getValue()!=="")||(this.sObjectId!==undefined&&this.sObjectId!=="")){f={note:this.oNoteTextArea.getValue(),uiUrl:this.sObjectId};}if(JSON.stringify(this.oExternalObject)==='{}'){this.oExternalObject=undefined;}return{feedContent:f,groupId:this.getSelectedGroupId(),folderId:this.getSelectedFolderId(),aFilesToUpload:this.aSelectedFiles,externalObject:this.oExternalObject,mappedExternalObject:this.oMappedExternalObject,groupName:this.getSelectedGroupName(),memberEmail:this.sMemberEmail};},getSelectedGroupId:function(){return this.sSelectedGroupId;},getSelectedGroupName:function(){return this.sSelectedGroupName;},getSelectedFolderId:function(){return this.sSelectedFolderId;},shareToJam:function(){var s=this.getSharingData();var a=this;if(s.aFilesToUpload.length===0&&(!s.feedContent||(!s.feedContent.uiUrl&&s.feedContent.note.trim()===""))&&!s.externalObject){var r=a.oLangBundle.getText("SHARING_NOTHING_TO_SHARE_MSG");this.oCommonUtil.showMessage(r,{duration:3000,autoclose:false});}else{if(!this.bAttachmentsCB){this.oShareUtil.shareBusinessObject(s);}if(s.aFilesToUpload.length>0){this.oShareUtil.uploadAttachments(s);var r=this.oLangBundle.getText("SHARING_ACKNOWLEDGMENT_MSG");setTimeout(function(){a.oCommonUtil.showMessage(r,{duration:3000,width:"30em",autoClose:false});},500);}}}});};if(!jQuery.sap.isDeclared('sap.collaboration.components.socialtimeline.Component')){
/*!
 * SAP UI development toolkit for HTML5 (SAPUI5) (c) Copyright 2009-2014 SAP AG. All rights reserved
 */
jQuery.sap.require('sap.ui.core.UIComponent');jQuery.sap.require('sap.suite.ui.commons.Timeline');jQuery.sap.require('sap.suite.ui.commons.TimelineItem');jQuery.sap.declare("sap.collaboration.components.socialtimeline.Component");sap.ui.core.UIComponent.extend("sap.collaboration.components.socialtimeline.Component",{metadata:{version:"1.0",dependencies:{libs:[],components:[],ui5version:""},config:{},customizing:{},rootView:null,publicMethods:["setBusinessObjectKey","setBusinessObjectMap","updateTimelineEntry","deleteTimelineEntry"],aggregations:{},properties:{"enableSocial":{type:"boolean",group:"Misc",defaultValue:true},"alignment":{type:"sap.suite.ui.commons.TimelineAlignment",group:"Misc",defaultValue:sap.suite.ui.commons.TimelineAlignment.Right},"axisOrientation":{type:"sap.suite.ui.commons.TimelineAxisOrientation",group:"Misc",defaultValue:sap.suite.ui.commons.TimelineAxisOrientation.Vertical},"noDataText":{type:"string",group:"Misc",defaultValue:null},"showIcons":{type:"boolean",group:"Misc",defaultValue:true},"visible":{type:"boolean",group:"Appearance",defaultValue:true},"width":{type:"sap.ui.core.CSSSize",group:"Dimension",defaultValue:'100%'},"customFilter":{type:"object",group:"Misc"}},events:{"customActionPress":{}}},_defaultAttributes:{collaborationHostServiceUrl:"/sap/bc/ui2/smi/rest_tunnel/Jam/api/v1/OData",smiServiceUrl:"/sap/opu/odata/sap/SM_INTEGRATION_V2_SRV",pageSize:10},init:function(){this._oLogger=jQuery.sap.log.getLogger("sap.collaboration.components.socialtimeline.Component");this._oCollabHostModel;this._oSMIntegrationModel;this._oTimeline;this._oTimelineModelData={timelineData:[],filterData:[],suggestions:[]};this._oTimelineModel=new sap.ui.model.json.JSONModel(this._oTimelineModelData);this._iGrowingThreshold=this._defaultAttributes.pageSize;this._oFilter={"backend":undefined,"jam":undefined};this._oBusinessObjectMap={};this._sBusinessObjectKey=undefined;this._oCommonUtil=new sap.collaboration.components.utils.CommonUtil();this._oLanguageBundle=this._oCommonUtil.getLanguageBundle();this._oTimelineDataHandler;this._oJamDataHandler;this._oSocialProfile;this._oTimelineUser={};this._bEnableSocial;this._initialize();sap.ui.core.UIComponent.prototype.init.apply(this);},exit:function(){},onBeforeRendering:function(){this._oLogger.info("Creating Timeline Control with parameters");this._oLogger.info("enableSocial: "+this.getEnableSocial());this._oLogger.info("alignment: "+this.getAlignment());this._oLogger.info("axisOrientation: "+this.getAxisOrientation());this._oLogger.info("noDataText: "+this.getNoDataText());this._oLogger.info("showIcons: "+this.getShowIcons());this._oLogger.info("visible: "+this.getVisible());this._oLogger.info("width: "+this.getWidth());this._validateInputParameters();if(this._bEnableSocial===undefined){this._setEnableSocial();}this._oTimeline.setEnableSocial(this._bEnableSocial);this._oTimeline.setAlignment(this.getAlignment());this._oTimeline.setAxisOrientation(this.getAxisOrientation());this._oTimeline.setEnableBackendFilter(true);this._oTimeline.setEnableScroll(false);this._oTimeline.setForceGrowing(true);this._oTimeline.setGrowingThreshold(this._iGrowingThreshold);this._oTimeline.setNoDataText(this.getNoDataText());this._oTimeline.setShowIcons(this.getShowIcons());this._oTimeline.setVisible(this.getVisible());this._oTimeline.setWidth(this.getWidth());this._oTimeline.setShowHeaderBar(false);this._getLoggedInUser();this._setTimelineModel();this._buildFilter();},onAfterRendering:function(){},createContent:function(){return this._createTimeline();},setBusinessObjectMap:function(b){this._oLogger.info("servicePath: "+b.servicePath);this._oLogger.info("collection: "+b.collection);this._oLogger.info("applicationContext: "+b.applicationContext);if(this._bEnableSocial===undefined){this._setEnableSocial();}this._oBusinessObjectMap=b;if(this._oBusinessObjectMap.customActionCallback&&typeof(this._oBusinessObjectMap.customActionCallback)!=='function'){this._oLogger.error("The property customActionCallback is not a function.");this.destroy();}this._oTimelineDataHandler=new sap.collaboration.components.socialtimeline.datahandlers.TimelineDataHandler(this._oBusinessObjectMap,this._oJamDataHandler,this._oSMIntegrationModel,this._iGrowingThreshold,this._bEnableSocial);},setBusinessObjectKey:function(k){this._oLogger.info("Business Object Key: "+k);if(!this._oTimelineDataHandler){this._oLogger.error("Function setBusinessObjectMap must be called before calling setBusinessObjectKey for the first time.");}this._sBusinessObjectKey=k;this._oTimelineDataHandler.setBusinessObjectKey(k);this._refreshTimelineModel();this._oTimeline.setShowHeaderBar(true);},updateTimelineEntry:function(t,I){var T=sap.ui.getCore().byId(I);var e=T.getAggregation('embeddedControl');var f=e._oFlexbox.getItems();f[0].setText(t);if(f.length>1){for(var i=1;i<f.length;i++){f[i].destroy();}}var s=T.getBindingContext().getPath();var o=T.getModel();o.getProperty(s).timelineItemData.text=t;o.getProperty(s).timelineItemData.timelineEntryDetails=[];},deleteTimelineEntry:function(i){var t=sap.ui.getCore().byId(i);var T=t.getBindingContext().getPath();var o=t.getModel();var a=o.getProperty(T);var b=o.getData().timelineData.indexOf(a);o.getData().timelineData.splice(b,1);t.destroy();},_setEnableSocial:function(){if(this._checkJamConfiguration()){this._bEnableSocial=this.getEnableSocial();}else{this._bEnableSocial=false;}},_checkJamConfiguration:function(){var s=true;var a=this;var S=function(c){if(c===false){s=false;}};var e=function(E){a._oCommonUtil.displayError();};this._oSMIntegrationDataHandler=new sap.collaboration.components.socialtimeline.datahandlers.SMIntegrationDataHandler(this._oSMIntegrationModel);this._oSMIntegrationDataHandler.getJamConfigurationStatus(S,e);return s;},_initialize:function(){var a=true;if(!this._oCollabHostModel){this._oCollabHostModel=new sap.ui.model.odata.ODataModel(this._defaultAttributes.collaborationHostServiceUrl,a);}if(!this._oSMIntegrationModel){this._oSMIntegrationModel=new sap.ui.model.odata.ODataModel(this._defaultAttributes.smiServiceUrl,a);}if(!this._oJamDataHandler){this._oJamDataHandler=new sap.collaboration.components.socialtimeline.datahandlers.JamDataHandler(this._oCollabHostModel);}},_createTimeline:function(){this._oTimeline=new sap.suite.ui.commons.Timeline(this.getId()+"_timeline",{data:[],filterSelectionChange:this._onFilterSelectionChange.bind(this),grow:this._onGrow.bind(this),addPost:this._onAddPost.bind(this),suggest:this._onSuggest.bind(this)});return this._oTimeline;},_refreshTimelineModel:function(){var s=this;this._oTimeline.setBusyIndicatorDelay(0).setBusy(true);this._oTimelineDataHandler.getTimelineData(this._oFilter).then(function(t){s._oTimeline.setBusy(false);s._oTimelineModelData.timelineData=t;s._oTimelineModel.setData(s._oTimelineModelData);s._hideReplyFromJamBarInTLItems();},function(e){s._oCommonUtil.displayError();s._oTimeline.setBusy(false);});},_setTimelineModel:function(){var c=new sap.ui.core.CustomData({key:"{key}",value:"{value}"});var t=new sap.suite.ui.commons.TimelineItem({dateTime:"{timelineItemData/dateTime}",userName:"{timelineItemData/userName}",title:"{timelineItemData/title}",icon:"{timelineItemData/icon}",filterValue:"{timelineItemData/filterValue}",userNameClickable:this._bEnableSocial,userNameClicked:this._onUserNameClicked,userPicture:"{timelineItemData/userPicture}",embeddedControl:this._createEmbeddedControl(),customAction:{template:c,path:"timelineItemData/customActionData"},customActionClicked:this._onCustomActionClicked.bind(this),replyCount:"{_feedEntryData/RepliesCount}",replyListOpen:this._onReplyListOpen.bind(this),replyList:new sap.m.List({showNoData:false,width:"20rem"}),replyPost:this._onReplyPost.bind(this),suggest:this._onSuggest.bind(this)});this._oTimeline.setModel(this._oTimelineModel);this._oTimeline.bindAggregation("content",{path:"/timelineData",template:t});var f=new sap.suite.ui.commons.TimelineFilterListItem({key:"{key}",text:"{text}"});this._oTimeline.bindAggregation("filterList",{path:"/filterData",template:f});},_createEmbeddedControl:function(){return new sap.collaboration.components.socialtimeline.controls.TimelineEntryControl(this.getId()+"_embeddedControl",{timelineEntry:"{timelineItemData}"});},_buildFilter:function(){var f=[];var d=[{key:0,text:this._oCommonUtil.getLanguageBundle().getText('TE_FILTER_DISCUSSION_POSTS'),value:""},{key:1,text:this._oCommonUtil.getLanguageBundle().getText('TE_FILTER_SYSTEM_UPDATES'),value:""}];if(this._bEnableSocial===false){for(var i=0;i<d.length;i++){if(d[i].text===this._oCommonUtil.getLanguageBundle().getText('TE_FILTER_DISCUSSION_POSTS')){d.splice(i,1);break;}}}var c=this.getCustomFilter();var C=d.length;if(c){for(var i=0;i<c.length;i++){c[i].key=C;C++;}}f=d.concat(c);this._setFilterData(f);},_setFilterData:function(f){this._oTimelineModelData.filterData=this._oTimelineModelData.filterData.concat(f);this._oTimelineModel.setData(this._oTimelineModelData);},_hideReplyFromJamBarInTLItems:function(){var s=this;var t=this._oTimeline.getContent();t.forEach(function(T){var o=T.getBindingContext().getObject();if(!o._feedEntryData){s._hideReply(T);}});},_hideReply:function(t){t._replyLink.setVisible(false);},_getFeedId:function(t){var p=t.getBindingContext().getPath();var P=p.split("/");var s=P[P.length-1];var f=t.getModel().getData().timelineData[s]._feedEntryData.Id;return f;},_getLoggedInUser:function(){var s=this;var g=this._oJamDataHandler.getSender();g.promise.done(function(j,r){s._oTimelineUser=j;});g.promise.fail(function(e){s._oLogger.error('Failed to get the sender',e.stack);});},_onGrow:function(){var s=this;this._oTimelineDataHandler.getTimelineData(this._oFilter).then(function(t){var d=s._oTimelineModel.getData();d.timelineData=d.timelineData.concat(t);s._oTimelineModel.setData(d);s._hideReplyFromJamBarInTLItems();},function(e){s._oCommonUtil.displayError();});},_onFilterSelectionChange:function(e){this._oFilter={"backend":undefined,"jam":undefined};this._oTimelineDataHandler.reset();var s=e.getParameter('selectedItem');if(s.getProperty('key')){var S=parseInt(s.getProperty('key'));switch(S){case 0:this._oFilter.jam=this._oTimelineDataHandler.constants.FILTER_JAM_ALL;break;case 1:this._oFilter.backend=this._oTimelineDataHandler.constants.FILTER_BACKEND_ALL;break;default:var f=this._oTimelineModelData.filterData;var n=f.length;var N=this.getCustomFilter().length;var I=n-N;for(var i=I;i<f.length;i++){if(S==f[i].key){this._oFilter.backend=f[i].value;break;}}}}this._refreshTimelineModel();},_onUserNameClicked:function(c){var s=c.getSource().getParent().getParent();if(!s._oSocialProfile){s._oSocialProfile=sap.ui.getCore().createComponent({name:"sap.collaboration.components.socialprofile",id:this.getId()+"_socialProfile"});s._oSocialProfile._defaultAttributes=s._defaultAttributes;}var S={openingControl:c.getSource()._userNameLink,memberId:c.getSource().getBindingContext().getObject().timelineItemData.userEmail};S.memberInfo=s._oTimelineDataHandler.getUserInfoFromBuffer(S.memberId);s._oSocialProfile.setSettings(S);s._oSocialProfile.open();},_onAddPost:function(c){if(!this._sBusinessObjectKey){this._oLogger.error("The business object key is undefined");this._oCommonUtil.displayError(this._oLanguageBundle.getText('ST_ADD_POST_NO_OBJECT_ERROR'));return;}var i={"appContext":this._oBusinessObjectMap.applicationContext,"collection":this._oBusinessObjectMap.collection,"key":this._sBusinessObjectKey,"odataServicePath":this._oBusinessObjectMap.servicePath};var s=this;var C=c.getParameter("value");var e=function(){s._oCommonUtil.displayError();s._oTimeline.setBusy(false);};if(C&&C.trim()!==""){var a=this._oTimelineDataHandler.addTopLevelPost(C,i);if(!this._oFilter.backend){this._oTimeline.setBusyIndicatorDelay(0).setBusy(true);a.then(function(A){return s._oJamDataHandler.getFeedEntryFromActivity(A.Id);},e).then(function(f){f.promise.done(function(d,r){var j=d.results;var I=s._oTimelineDataHandler.buildImageUrl(j.Creator.ThumbnailImage.Id,j.Creator.ThumbnailImage.ThumbnailImageType);var F={_feedEntryData:j,timelineItemData:{dateTime:j.CreatedAt,icon:"sap-icon://post",text:j.Text,title:j.Action,userEmail:j.Creator.Email,userName:j.Creator.FullName,userPicture:I}};var m=s._oTimeline.getModel().getData();m.timelineData.push(F);s._oTimeline.setBusy(false);var t=new sap.suite.ui.commons.TimelineItem({dateTime:new Date(j.CreatedAt),userName:j.Creator.FullName,title:j.Action,text:j.Text,icon:"sap-icon://post",userNameClickable:true,userNameClicked:s._onUserNameClicked,userPicture:I,replyCount:"{_feedEntryData/RepliesCount}",replyListOpen:s._onReplyListOpen.bind(s),replyList:new sap.m.List({showNoData:false,width:"20rem"}),replyPost:s._onReplyPost.bind(s),suggest:s._onSuggest.bind(s)});s._oTimeline.addContent(t);if(!s._oTimelineDataHandler.getUserInfoFromBuffer(j.Creator.Email)){s._oTimelineDataHandler.addUserInfoToBuffer(j.Creator);}var b=m.timelineData.indexOf(F);t.getParent().getModel().createBindingContext("/timelineData/"+b);var o=new sap.ui.model.Context(t.getParent().getModel(),"/timelineData/"+b);t.setBindingContext(o);});f.promise.fail(e);});}}},_onSuggest:function(e){if(!e.getSource().getBinding('suggestionItems')){var s=new sap.m.StandardListItem({title:"{name}",description:"{email}"});e.getSource().bindAggregation("suggestionItems",{path:"/suggestions",template:s});}if(this.gettingSuggestions){this.gettingSuggestions.request.abort();}var v=e.getParameter("suggestValue").substring(1);var t=this._oTimelineModel.getData();if(v.length==1){t.suggestions=[];this._oTimelineModel.setData(t);}var a=this;this.gettingSuggestions=this._oJamDataHandler.getSuggestions(v);this.gettingSuggestions.promise.done(function(d,r){var j=d.results;var S=[];t.suggestions=[];for(var i=0;i<j.length;i++){S.push({"name":j[i].FullName,"email":j[i].Email});}t.suggestions=t.suggestions.concat(S);a._oTimelineModel.setData(t);});this.gettingSuggestions.promise.fail(function(E){if(E.response&&E.response.statusCode){a._oCommonUtil.displayError();}});},_onCustomActionClicked:function(c){var C={};var b=c.getSource().getBindingContext();var B=b.getPath();var o=c.getSource().getModel().getProperty(B+"/timelineItemData/customActionData/oDataEntry");C.oDataEntry=o;C.timelineEntryId=c.getParameters().id;C.key=c.getParameters().key;this.fireCustomActionPress(C);},_onReplyListOpen:function(e){var s=this;var t=e.getSource();try{var f=this._getFeedId(t);if(!f){throw new Error('Failed to get the feed entry ID.');}}catch(E){this._oLogger.error('Failed to get the feed entry ID');this._oCommonUtil.displayError(this._oLanguageBundle.getText('ST_GET_REPLIES_FAILED'));return;}t.getReplyList().setBusyIndicatorDelay(0).setBusy(true);var g=this._oJamDataHandler.getReplies(f);g.promise.done(function(j,r){var J=j.results;J.reverse();t.getReplyList().removeAllItems();for(var i=0;i<J.length;i++){var R=J[i];t.getReplyList().addItem(new sap.m.FeedListItem({text:R.Text,icon:s._oTimelineDataHandler.buildImageUrl(R.ThumbnailImage.Id,R.ThumbnailImage.ThumbnailImageType),timestamp:s._oCommonUtil.formatDateToString(R.CreatedAt),sender:R.Creator.FullName,iconActive:false,senderActive:false}));}t.getReplyList().setBusy(false);});g.promise.fail(function(){s._oLogger.error('Failed to get the replies.');s._oCommonUtil.displayError(s._oCommonUtil.getLanguageBundle().getText('ST_GET_REPLIES_FAILED'));});},_onReplyPost:function(e){var s=this;var r=e.getParameter("value");if(r&&r.trim()!==""){var t=e.getSource();try{var f=this._getFeedId(t);if(!f){throw new Error('Failed to get the feed entry ID.');}}catch(E){this._oLogger.error('Failed to get the feed entry ID');this._oCommonUtil.displayError(this._oLanguageBundle.getText('ST_POST_REPLY_FAILED'));return;}var p=this._oJamDataHandler.postReply(f,r);p.promise.done(function(j,a){t.getReplyList().addItem(new sap.m.FeedListItem({text:r,icon:"{timelineItemData/userPicture}",timestamp:s._oCommonUtil.formatDateToString(new Date()),sender:s._oTimelineUser.FullName,iconActive:false,senderActive:false}));t.setReplyCount(t.getReplyList().getItems().length);});p.promise.fail(function(){s._oLogger.error('Failed to post the reply.');s._oCommonUtil.displayError(s._oCommonUtil.getLanguageBundle().getText('ST_POST_REPLY_FAILED'));});}},_appendListObserver:function(l){var s=this;var M=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var r=l.getParent();var R=r.getDomRef();var t=l.getParent().getContent()[1];s.oListObserver=new M(function(m){var i=false;m.forEach(function(a){if(!i&&a.type==='attributes'){t.getParent().focus();t.focus();s.oListObserver.takeRecords();s.oListObserver.disconnect();i=true;}});});s.oListObserver.observe(R,{childList:false,attributes:true,subTree:false});},_validateInputParameters:function(){var c=this.getCustomFilter();if(c){if(!jQuery.isArray(c)){this._oLogger.error("The type defined for the property customFilter is not an array and not be included in the filter.");this.setCustomFilter([]);}else{for(var i=0;i<c.length;i++){if(!c[i].value||!c[i].text||typeof(c[i].value)!=="string"||typeof(c[i].text)!=="string"){this._oLogger.error("The value or text for the filter "+JSON.stringify(c[i])+" is not defined or not a string. It has been removed from the filter list.");c.splice(i,1);i--;}}}}else{this.setCustomFilter([]);}}});};
